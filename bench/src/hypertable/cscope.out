cscope 15 /scratch/galtekar/src/logreplay/bench/src/hypertable -q 0000005951 0001480970
	@/home/galtekar/src/logreplay/bench/src/hypertable/cmake/CheckBoost.cc

1 
	~<boo¡/v”siÚ.hµ
>

2 
	~<¡dio.h
>

5 
	$maš
() {

6 
majÜ
 = 
BOOST_VERSION
 / 100000;

7 
mšÜ
 = 
BOOST_VERSION
 / 100 % 1000;

8 
	`puts
(
BOOST_LIB_VERSION
);

9  
majÜ
 =ğ1 && 
mšÜ
 >= 34 ? 0 : 1;

10 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/examples/apache_log/apache_log_load.cc

21 
	~<c¡ršg
>

22 
	~<io¡»am
>

24 
	~"CommÚ/E¼Ü.h
"

25 
	~"CommÚ/Sy¡em.h
"

27 
	~"Hy³¹abË/Lib/A·cheLogP¬£r.h
"

28 
	~"Hy³¹abË/Lib/Cl›Á.h
"

29 
	~"Hy³¹abË/Lib/KeyS³c.h
"

31 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

32 
usšg
 
Çme¥aû
 
	g¡d
;

34 
	gÇme¥aû
 {

40 cÚ¡ *
exŒaù_»que¡ed_·ge
(*
»que¡
) {

41 *
	gba£
, *
	g±r
;

42 ià(!
¡ºcmp
(
»que¡
, "GET ", 4)) {

43 
	gba£
 = 
»que¡
 + 4;

44 ià((
	g±r
 = 
¡rchr
(
ba£
, ' ')) != 0)

45 *
±r
 = 0;

46  
	gba£
;

55 cÚ¡ *
exŒaù_tİËv–_u£r_ag’t
(*
u£r_ag’t
) {

56 *
	g±r
;

57 ià(
	gu£r_ag’t
) {

58 ià((
	g±r
 = 
¡rchr
(
u£r_ag’t
, '(')) != 0)

59 *
±r
 = 0;

60  
	gu£r_ag’t
;

76 
	$maš
(
¬gc
, **
¬gv
) {

77 
”rÜ
;

78 
A·cheLogP¬£r
 
·r£r
;

79 
A·cheLogEÁryT
 
’Œy
;

80 
Cl›ÁPŒ
 
hy³¹abË_ş›Á_±r
;

81 
TabËPŒ
 
bË_±r
;

82 
TabËMutÜPŒ
 
mutÜ_±r
;

83 
KeyS³c
 
key
;

85 ià(
¬gc
 <= 1) {

86 
cout
 << "u§ge:‡·che_log_lßd <fe1>" << 
’dl
;

90 
Œy
 {

93 
hy³¹abË_ş›Á_±r
 = 
Ãw
 
Hy³¹abË
::
	`Cl›Á
(
¬gv
[0]);

96 ià((
”rÜ
 = 
hy³¹abË_ş›Á_±r
->
	`İ’_bË
("WebS”v”Log", 
bË_±r
)è!ğ
E¼Ü
::
OK
) {

97 
û¼
 << "E¼Ü: uÇbËØİ’abË 'WebS”v”Log' - " << 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
è<< 
’dl
;

102 ià((
”rÜ
 = 
bË_±r
->
	`ü—‹_mutÜ
(
mutÜ_±r
)è!ğ
E¼Ü
::
OK
) {

103 
û¼
 << "E¼Ü:…robËm c»©šg mutÜ oÀbË 'WebS”v”Log' - " << 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
è<< 
’dl
;

108 
	`ÿtch
 (
¡d
::
exû±iÚ
 &
e
) {

109 
û¼
 << "”rÜ: " << 
e
.
	`wh©
(è<< 
’dl
;

114 
	`mem£t
(&
key
, 0, (key));

115 
key
.
cŞumn_çmy
 = "RequestInfo";

118 
·r£r
.
	`lßd
(
¬gv
[1]);

121 
·r£r
.
	`Ãxt
(
’Œy
)) {

124 ià((
key
.
row
 = 
	`exŒaù_»que¡ed_·ge
(
’Œy
.
»que¡
)) == 0)

126 
key
.
row_Ën
 = 
	`¡¾’
((cÚ¡ *)key.
row
);

129 
Œy
 {

130 
¡d
::
¡ršg
 
¡r
;

131 
¡r
 +ğ(
’Œy
.
_add»ss
) ?ƒntry.ip_address : "-";

132 
¡r
 += " ";

133 
¡r
 +ğ(
’Œy
.
»ã»r
) ?ƒntry.referer : "-";

134 
¡r
 += " ";

135 
¡r
 +ğ
	`exŒaù_tİËv–_u£r_ag’t
(
’Œy
.
u£r_ag’t
);

136 
mutÜ_±r
->
	`£t
(
’Œy
.
time¡amp
, 
key
, 
¡r
.
	`c_¡r
(), sŒ.
	`Ëngth
());

138 
	`ÿtch
 (
Hy³¹abË
::
Exû±iÚ
 &
e
) {

139 
û¼
 << "”rÜ: " << 
E¼Ü
::
	`g‘_‹xt
(
e
.
	`code
()è<< " - " <<ƒ.
	`wh©
(è<< 
’dl
;

145 
Œy
 {

146 
mutÜ_±r
->
	`æush
();

148 
	`ÿtch
 (
Hy³¹abË
::
Exû±iÚ
 &
e
) {

149 
û¼
 << "”rÜ: " << 
E¼Ü
::
	`g‘_‹xt
(
e
.
	`code
()è<< " - " <<ƒ.
	`wh©
(è<< 
’dl
;

154 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/examples/apache_log/apache_log_query.cc

21 
	~<c¡dio
>

23 
	~"CommÚ/E¼Ü.h
"

24 
	~"CommÚ/Sy¡em.h
"

26 
	~"Hy³¹abË/Lib/Cl›Á.h
"

28 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

29 
usšg
 
Çme¥aû
 
	g¡d
;

37 
	$maš
(
¬gc
, **
¬gv
) {

38 
”rÜ
;

39 
Cl›ÁPŒ
 
hy³¹abË_ş›Á_±r
;

40 
TabËPŒ
 
bË_±r
;

41 
TabËSÿÂ”PŒ
 
sÿÂ”_±r
;

42 
SÿnS³cifiÿtiÚT
 
sÿn_¥ec
;

43 
C–lT
 
ûÎ
;

44 
ušt32_t
 
n£c
;

45 
time_t
 
unix_time
;

46 
tm
 
tms
;

48 ià(
¬gc
 <= 1) {

49 
cout
 << "u§ge:‡·che_log_qu”y <·ge>" << 
’dl
;

53 
Œy
 {

56 
hy³¹abË_ş›Á_±r
 = 
Ãw
 
	`Cl›Á
(
¬gv
[0]);

59 ià((
”rÜ
 = 
hy³¹abË_ş›Á_±r
->
	`İ’_bË
("WebS”v”Log", 
bË_±r
)è!ğ
E¼Ü
::
OK
) {

60 
û¼
 << "E¼Ü: uÇbËØİ’abË 'WebS”v”Log' - " << 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
è<< 
’dl
;

65 
sÿn_¥ec
.
rowLim™
 = 1;

66 
sÿn_¥ec
.
max_v”siÚs
 = 0;

67 
sÿn_¥ec
.
¡¬tRow
 = sÿn_¥ec.
’dRow
 = 
¬gv
[1];

68 
sÿn_¥ec
.
¡¬tRowInşusive
 = sÿn_¥ec.
’dRowInşusive
 = 
Œue
;

69 
sÿn_¥ec
.
š‹rv®
.
fœ¡
 = sÿn_¥ec.š‹rv®.
£cÚd
 = 0;

70 
sÿn_¥ec
.
»tuº_d–‘es
 = 
çl£
;

73 ià((
”rÜ
 = 
bË_±r
->
	`ü—‹_sÿÂ”
(
sÿn_¥ec
, 
sÿÂ”_±r
)è!ğ
E¼Ü
::
OK
) {

74 
û¼
 << "E¼Ü:…robËm c»©šg sÿÂ” oÀbË 'WebS”v”Log' - " << 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
è<< 
’dl
;

78 
	`ÿtch
 (
¡d
::
exû±iÚ
 &
e
) {

79 
û¼
 << "”rÜ: " << 
e
.
	`wh©
(è<< 
’dl
;

84 
sÿÂ”_±r
->
	`Ãxt
(
ûÎ
)) {

85 
n£c
 = 
ûÎ
.
time¡amp
 % 1000000000LL;

86 
unix_time
 = 
ûÎ
.
time¡amp
 / 1000000000LL;

87 
	`loÿÉime_r
(&
unix_time
, &
tms
);

88 
	`´štf
("%d-%02d-%02d %02d:%02d:%02d.%09d", 
tms
.
tm_y—r
+1900,ms.
tm_mÚ
+1,ms.
tm_mday
,ms.
tm_hour
,ms.
tm_mš
,ms.
tm_£c
, 
n£c
);

89 
	`´štf
("\t%s\t%s", 
ûÎ
.
row_key
, c–l.
cŞumn_çmy
);

90 ià(*
ûÎ
.
cŞumn_qu®if›r
)

91 
	`´štf
(":%s", 
ûÎ
.
cŞumn_qu®if›r
);

92 
	`´štf
("\t%s\n", 
¡d
::
	`¡ršg
((cÚ¡ *)
ûÎ
.
v®ue
, c–l.
v®ue_Ën
).
	`c_¡r
());

96 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/attic/Tools/hyperspace/CommandAttrDel.cc

23 
	~<¡dio.h
>

24 
	~<¡ršg.h
>

27 
	~"CommÚ/U§ge.h
"

29 
	~"Hy³r¥aû/Hy³r¥aûCl›Á.h
"

31 
	~"CommªdA‰rD–.h
"

33 
usšg
 
Çme¥aû
 
Hy³¹abË
;

35 
	gÇme¥aû
 {

36 cÚ¡ *
	gu§ge
[] = {

48 
	gHy³¹abË
::
CommªdA‰rD–
(
Hy³r¥aûCl›Á
 *
ş›Á
, 
veùÜ
<cÚ¡ *> &
¬gs
) {

50 ià(
	g¬gs
.
size
() != 2)

51 
U§ge
::
DumpAndEx™
(
u§ge
);

53  
	gş›Á
->
A‰rD–
(
¬gs
[0],‡rgs[1]);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/attic/Tools/hyperspace/CommandAttrDel.h

22 
	~<veùÜ
>

24 
Çme¥aû
 
	gHy³¹abË
 {

25 
şass
 
	gHy³r¥aûCl›Á
;

26 
CommªdA‰rD–
(
Hy³r¥aûCl›Á
 *
ş›Á
, 
¡d
::
veùÜ
<cÚ¡ *> &
¬gs
);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/attic/Tools/hyperspace/CommandAttrGet.cc

22 
	~<io¡»am
>

25 
	~<¡dio.h
>

26 
	~<¡ršg.h
>

29 
	~"CommÚ/DyÇmicBufãr.h
"

30 
	~"CommÚ/E¼Ü.h
"

31 
	~"CommÚ/U§ge.h
"

33 
	~"Hy³r¥aû/Hy³r¥aûCl›Á.h
"

35 
	~"CommªdA‰rG‘.h
"

37 
usšg
 
Çme¥aû
 
Hy³¹abË
;

40 
	gÇme¥aû
 {

41 cÚ¡ *
	gu§ge
[] = {

52 
	gHy³¹abË
::
CommªdA‰rG‘
(
Hy³r¥aûCl›Á
 *
ş›Á
, 
veùÜ
<cÚ¡ *> &
¬gs
) {

53 
DyÇmicBufãr
 
v®ueBuf
(0);

55 ià(
	g¬gs
.
size
() != 2)

56 
U§ge
::
DumpAndEx™
(
u§ge
);

58 
	g”rÜ
 = 
ş›Á
->
A‰rG‘
(
¬gs
[0],‡rgs[1], 
v®ueBuf
);

60 ià(
	g”rÜ
 !ğ
E¼Ü
::
OK
)

61  
”rÜ
;

63 ià(
	gv®ueBuf
.
fl
() == 0)

64 
cout
 << "[NULL]" << 
’dl
;

66 
	gcout
 << (*)
	gv®ueBuf
.
	gbuf
 << 
	g’dl
;

68  
	g”rÜ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/attic/Tools/hyperspace/CommandAttrGet.h

22 
	~<veùÜ
>

24 
Çme¥aû
 
	gHy³¹abË
 {

25 
şass
 
	gHy³r¥aûCl›Á
;

26 
CommªdA‰rG‘
(
Hy³r¥aûCl›Á
 *
ş›Á
, 
¡d
::
veùÜ
<cÚ¡ *> &
¬gs
);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/attic/Tools/hyperspace/CommandAttrSet.cc

22 
	~<¡dio.h
>

23 
	~<¡ršg.h
>

26 
	~"CommÚ/U§ge.h
"

28 
	~"Hy³r¥aû/Hy³r¥aûCl›Á.h
"

30 
	~"CommªdA‰rS‘.h
"

32 
usšg
 
Çme¥aû
 
Hy³¹abË
;

34 
	gÇme¥aû
 {

35 cÚ¡ *
	gu§ge
[] = {

48 
	gHy³¹abË
::
CommªdA‰rS‘
(
Hy³r¥aûCl›Á
 *
ş›Á
, 
veùÜ
<cÚ¡ *> &
¬gs
) {

50 ià(
	g¬gs
.
size
() != 3)

51 
U§ge
::
DumpAndEx™
(
u§ge
);

53  
	gş›Á
->
A‰rS‘
(
¬gs
[0],‡rgs[1],‡rgs[2]);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/attic/Tools/hyperspace/CommandAttrSet.h

22 
	~<veùÜ
>

24 
Çme¥aû
 
	gHy³¹abË
 {

25 
şass
 
	gHy³r¥aûCl›Á
;

26 
CommªdA‰rS‘
(
Hy³r¥aûCl›Á
 *
ş›Á
, 
¡d
::
veùÜ
<cÚ¡ *> &
¬gs
);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/attic/Tools/hyperspace/CommandCreate.cc

23 
	~<¡dio.h
>

24 
	~<¡ršg.h
>

27 
	~"CommÚ/U§ge.h
"

29 
	~"Hy³r¥aû/Hy³r¥aûCl›Á.h
"

31 
	~"CommªdC»©e.h
"

33 
usšg
 
Çme¥aû
 
Hy³¹abË
;

35 
	gÇme¥aû
 {

36 cÚ¡ *
	gu§ge
[] = {

48 
	gHy³¹abË
::
CommªdC»©e
(
Hy³r¥aûCl›Á
 *
ş›Á
, 
veùÜ
<cÚ¡ *> &
¬gs
) {

50 ià(
	g¬gs
.
size
() < 1)

51 
	gU§ge
::
DumpAndEx™
(
u§ge
);

53  
	gş›Á
->
C»©e
(
¬gs
[0]);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/attic/Tools/hyperspace/CommandCreate.h

22 
	~<veùÜ
>

24 
Çme¥aû
 
	gHy³¹abË
 {

25 
şass
 
	gHy³r¥aûCl›Á
;

26 
CommªdC»©e
(
Hy³r¥aûCl›Á
 *
ş›Á
, 
¡d
::
veùÜ
<cÚ¡ *> &
¬gs
);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/attic/Tools/hyperspace/CommandDelete.cc

23 
	~<¡dio.h
>

24 
	~<¡ršg.h
>

27 
	~"CommÚ/U§ge.h
"

29 
	~"Hy³r¥aû/Hy³r¥aûCl›Á.h
"

31 
	~"CommªdD–‘e.h
"

33 
usšg
 
Çme¥aû
 
Hy³¹abË
;

35 
	gÇme¥aû
 {

36 cÚ¡ *
	gu§ge
[] = {

48 
	gHy³¹abË
::
CommªdD–‘e
(
Hy³r¥aûCl›Á
 *
ş›Á
, 
veùÜ
<cÚ¡ *> &
¬gs
) {

50 ià(
	g¬gs
.
size
() < 1)

51 
	gU§ge
::
DumpAndEx™
(
u§ge
);

53  
	gş›Á
->
D–‘e
(
¬gs
[0]);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/attic/Tools/hyperspace/CommandDelete.h

22 
	~<veùÜ
>

24 
Çme¥aû
 
	gHy³¹abË
 {

25 
şass
 
	gHy³r¥aûCl›Á
;

26 
CommªdD–‘e
(
Hy³r¥aûCl›Á
 *
ş›Á
, 
¡d
::
veùÜ
<cÚ¡ *> &
¬gs
);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/attic/Tools/hyperspace/CommandExists.cc

23 
	~<¡dio.h
>

24 
	~<¡ršg.h
>

27 
	~"CommÚ/E¼Ü.h
"

28 
	~"CommÚ/U§ge.h
"

30 
	~"Hy³r¥aû/Hy³r¥aûCl›Á.h
"

32 
	~"CommªdExi¡s.h
"

34 
usšg
 
Çme¥aû
 
Hy³¹abË
;

37 
	gÇme¥aû
 {

38 cÚ¡ *
	gu§ge
[] = {

49 
	gHy³¹abË
::
CommªdExi¡s
(
Hy³r¥aûCl›Á
 *
ş›Á
, 
veùÜ
<cÚ¡ *> &
¬gs
) {

51 ià(
	g¬gs
.
size
() < 1)

52 
	gU§ge
::
DumpAndEx™
(
u§ge
);

54 
	g”rÜ
 = 
ş›Á
->
Exi¡s
(
¬gs
[0]);

55 ià(
	g”rÜ
 =ğ
E¼Ü
::
HYPERSPACE_FILE_NOT_FOUND
)

56 
cout
 << "çl£" << 
’dl
;

57 ià(
	g”rÜ
 =ğ
E¼Ü
::
OK
)

58 
cout
 << "Œue" << 
’dl
;

60  
	g”rÜ
;

62  
	g”rÜ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/attic/Tools/hyperspace/CommandExists.h

22 
	~<veùÜ
>

24 
Çme¥aû
 
	gHy³¹abË
 {

25 
şass
 
	gHy³r¥aûCl›Á
;

26 
CommªdExi¡s
(
Hy³r¥aûCl›Á
 *
ş›Á
, 
¡d
::
veùÜ
<cÚ¡ *> &
¬gs
);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/attic/Tools/hyperspace/CommandMkdirs.cc

22 
	~<¡dio.h
>

23 
	~<¡ršg.h
>

26 
	~"CommÚ/U§ge.h
"

28 
	~"Hy³r¥aû/Hy³r¥aûCl›Á.h
"

30 
	~"CommªdMkdœs.h
"

32 
usšg
 
Çme¥aû
 
Hy³¹abË
;

35 
	gÇme¥aû
 {

36 cÚ¡ *
	gu§ge
[] = {

47 
	gHy³¹abË
::
CommªdMkdœs
(
Hy³r¥aûCl›Á
 *
ş›Á
, 
veùÜ
<cÚ¡ *> &
¬gs
) {

49 ià(
	g¬gs
.
size
() < 1)

50 
	gU§ge
::
DumpAndEx™
(
u§ge
);

52  
	gş›Á
->
Mkdœs
(
¬gs
[0]);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/attic/Tools/hyperspace/CommandMkdirs.h

22 
	~<veùÜ
>

24 
Çme¥aû
 
	gHy³¹abË
 {

25 
şass
 
	gHy³r¥aûCl›Á
;

26 
CommªdMkdœs
(
Hy³r¥aûCl›Á
 *
ş›Á
, 
¡d
::
veùÜ
<cÚ¡ *> &
¬gs
);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/attic/Tools/hyperspace/hsTest.cc

21 
	~<¡ršg
>

22 
	~<veùÜ
>

25 
	~<sys/pŞl.h
>

28 
	~<boo¡/th»ad/exû±iÚs.hµ
>

30 
	~"AsyncComm/Comm.h
"

31 
	~"CommÚ/DyÇmicBufãr.h
"

32 
	~"CommÚ/E¼Ü.h
"

33 
	~"CommÚ/Logg”.h
"

34 
	~"CommÚ/Prİ”t›s.h
"

35 
	~"CommÚ/Sy¡em.h
"

36 
	~"CommÚ/Te¡H¬Ãss.h
"

37 
	~"CommÚ/U§ge.h
"

39 
	~"Hy³r¥aû/Hy³r¥aûCl›Á.h
"

40 
	~"Hy³r¥aû/Hy³r¥aûPrÙocŞ.h
"

41 
	~"CommªdC»©e.h
"

42 
	~"CommªdMkdœs.h
"

43 
	~"CommªdA‰rS‘.h
"

44 
	~"CommªdA‰rG‘.h
"

45 
	~"CommªdA‰rD–.h
"

46 
	~"CommªdExi¡s.h
"

48 
usšg
 
Çme¥aû
 
Hy³¹abË
;

49 
usšg
 
Çme¥aû
 
	g¡d
;

52 
	gÇme¥aû
 {

54 cÚ¡ *
	gu§ge
[] = {

73 
	$maš
(
¬gc
, **
¬gv
) {

74 
Prİ”t›s
 *
´İs
 = 
Ãw
 
	`Prİ”t›s
();

75 
Comm
 *
comm
;

76 
CÚÃùiÚMªag”
 *
cÚnMªag”
;

77 
Hy³r¥aûCl›Á
 *
ş›Á
;

78 
”rÜ
;

79 
¡ršg
 
cÚfigFe
 = "";

80 
boŞ
 
gŞd’
 = 
çl£
;

82 
Sy¡em
::
	`In™Ÿlize
(
¬gv
[0]);

83 
R—ùÜFaùÜy
::
	`In™Ÿlize
(2);

85 
i
=1; i<
¬gc
; i++) {

86 ià(!
	`¡ºcmp
(
¬gv
[
i
], "--config=", 9))

87 
cÚfigFe
 = &
¬gv
[
i
][9];

88 ià(!
	`¡rcmp
(
¬gv
[
i
], "--golden"))

89 
gŞd’
 = 
Œue
;

91 
U§ge
::
	`DumpAndEx™
(
u§ge
);

94 ià(
cÚfigFe
 != "")

95 
´İs
->
	`lßd
(
cÚfigFe
);

97 
comm
 = 
Ãw
 
	`Comm
();

99 
cÚnMªag”
 = 
Ãw
 
	`CÚÃùiÚMªag”
(
comm
);

101 
ş›Á
 = 
Ãw
 
	`Hy³r¥aûCl›Á
(
cÚnMªag”
, 
´İs
);

103 ià(!
ş›Á
->
	`Wa™FÜCÚÃùiÚ
(30))

104 
dÚe
;

106 
”rÜ
 = 
ş›Á
->
	`Exi¡s
("test");

107 ià(
”rÜ
 =ğ
E¼Ü
::
HYPERSPACE_FILE_NOT_FOUND
) {

108 ià((
”rÜ
 = 
ş›Á
->
	`Mkdœs
("‹¡")è!ğ
E¼Ü
::
OK
) {

109 
	`LOG_VA_ERROR
("ProbËm c»©šge¡ dœeùÜy - %s", 
E¼Ü
::
	`G‘Text
(
”rÜ
));

110 
	`ex™
(1);

113 ià(
”rÜ
 =ğ
E¼Ü
::
OK
) {

114 
ş›Á
->
	`D–‘e
("foo");

115 
ş›Á
->
	`D–‘e
("bar");

118 
	`LOG_VA_ERROR
("ProbËme¡šg fÜƒxi¡ªû oà‹¡ dœeùÜy - %s", 
E¼Ü
::
	`G‘Text
(
”rÜ
));

119 
	`ex™
(1);

123 
Te¡H¬Ãss
 
	`h¬Ãss
("hsTest");

124 
DyÇmicBufãr
 
	`dbuf
(0);

126 
”rÜ
 = 
ş›Á
->
	`C»©e
("foo");

127 
	`LOG_VA_INFO
("CREATE 'foo' - %s", 
E¼Ü
::
	`G‘Text
(
”rÜ
));

129 
”rÜ
 = 
ş›Á
->
	`Exi¡s
("foo");

130 
	`LOG_VA_INFO
("EXISTS 'foo' - %s", 
E¼Ü
::
	`G‘Text
(
”rÜ
));

132 
”rÜ
 = 
ş›Á
->
	`D–‘e
("bar");

133 
	`LOG_VA_INFO
("DELETE 'b¬' - %s", 
E¼Ü
::
	`G‘Text
(
”rÜ
));

135 
”rÜ
 = 
ş›Á
->
	`Exi¡s
("bar");

136 
	`LOG_VA_INFO
("EXISTS 'b¬' - %s", 
E¼Ü
::
	`G‘Text
(
”rÜ
));

138 
”rÜ
 = 
ş›Á
->
	`A‰rS‘
("foo", "name", "Doug Judd");

139 
	`LOG_VA_INFO
("ATTRSET foo.Çm- %s", 
E¼Ü
::
	`G‘Text
(
”rÜ
));

141 ià((
”rÜ
 = 
ş›Á
->
	`A‰rG‘
("foo", "Çme", 
dbuf
)è=ğ
E¼Ü
::
OK
) {

142 
	`LOG_VA_INFO
("foo.Çmğ'%s'", (cÚ¡ *)
dbuf
.
buf
);

145 
	`LOG_VA_INFO
("ATTRGET foo.Çm- %s", 
E¼Ü
::
	`G‘Text
(
”rÜ
));

148 
”rÜ
 = 
ş›Á
->
	`A‰rS‘
("foo", "address", "2999 Canyon Rd. Burlingame CA 94010");

149 
	`LOG_VA_INFO
("ATTRSET foo.add»s - %s", 
E¼Ü
::
	`G‘Text
(
”rÜ
));

151 ià((
”rÜ
 = 
ş›Á
->
	`A‰rG‘
("foo", "add»ss", 
dbuf
)è=ğ
E¼Ü
::
OK
) {

152 
	`LOG_VA_INFO
("foo.add»s ğ'%s'", (cÚ¡ *)
dbuf
.
buf
);

155 
	`LOG_VA_INFO
("ATTRGET foo.add»s - %s", 
E¼Ü
::
	`G‘Text
(
”rÜ
));

158 
”rÜ
 = 
ş›Á
->
	`A‰rG‘
("foo", "phÚe", 
dbuf
);

159 
	`LOG_VA_INFO
("ATTRGET foo.phÚ- %s", 
E¼Ü
::
	`G‘Text
(
”rÜ
));

161 
”rÜ
 = 
ş›Á
->
	`A‰rD–
("foo", "phone");

162 
	`LOG_VA_INFO
("ATTRDEL foo.phÚ- %s", 
E¼Ü
::
	`G‘Text
(
”rÜ
));

164 
”rÜ
 = 
ş›Á
->
	`A‰rD–
("foo", "name");

165 
	`LOG_VA_INFO
("ATTRDEL foo.Çm- %s", 
E¼Ü
::
	`G‘Text
(
”rÜ
));

167 
”rÜ
 = 
ş›Á
->
	`D–‘e
("foo");

168 
	`LOG_VA_INFO
("DELETE foØ- %s", 
E¼Ü
::
	`G‘Text
(
”rÜ
));

170 
”rÜ
 = 
ş›Á
->
	`Mkdœs
("chumba/wumba");

171 
	`LOG_VA_INFO
("MKDIRS chumba/wumb¨- %s", 
E¼Ü
::
	`G‘Text
(
”rÜ
));

173 
”rÜ
 = 
ş›Á
->
	`D–‘e
("chumba");

174 
	`LOG_VA_INFO
("DELETE chumb¨- %s", 
E¼Ü
::
	`G‘Text
(
”rÜ
));

176 
”rÜ
 = 
ş›Á
->
	`D–‘e
("chumba/wumba");

177 
	`LOG_VA_INFO
("DELETE chumba/wumb¨- %s", 
E¼Ü
::
	`G‘Text
(
”rÜ
));

179 
”rÜ
 = 
ş›Á
->
	`D–‘e
("chumba");

180 
	`LOG_VA_INFO
("DELETE chumb¨- %s", 
E¼Ü
::
	`G‘Text
(
”rÜ
));

182 ià(!
gŞd’
)

183 
h¬Ãss
.
	`V®id©eAndEx™
("hsTest.golden");

185 
h¬Ãss
.
	`Reg’”©eGŞd’Fe
("hsTest.golden");

189 
dÚe
:

190 
d–‘e
 
ş›Á
;

191 
d–‘e
 
comm
;

192 
d–‘e
 
´İs
;

194 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/attic/Tools/hyperspace/hyperspace.cc

22 
	~<¡ršg
>

23 
	~<veùÜ
>

26 
	~<sys/pŞl.h
>

29 
	~<boo¡/th»ad/exû±iÚs.hµ
>

31 
	~"AsyncComm/Comm.h
"

32 
	~"CommÚ/E¼Ü.h
"

33 
	~"CommÚ/Logg”.h
"

34 
	~"CommÚ/Prİ”t›s.h
"

35 
	~"CommÚ/Sy¡em.h
"

36 
	~"CommÚ/U§ge.h
"

38 
	~"Hy³r¥aû/Hy³r¥aûCl›Á.h
"

39 
	~"Hy³r¥aû/Hy³r¥aûPrÙocŞ.h
"

40 
	~"CommªdC»©e.h
"

41 
	~"CommªdD–‘e.h
"

42 
	~"CommªdMkdœs.h
"

43 
	~"CommªdA‰rS‘.h
"

44 
	~"CommªdA‰rG‘.h
"

45 
	~"CommªdA‰rD–.h
"

46 
	~"CommªdExi¡s.h
"

48 
usšg
 
Çme¥aû
 
Hy³¹abË
;

49 
usšg
 
Çme¥aû
 
	g¡d
;

52 
	gÇme¥aû
 {

54 cÚ¡ *
	gu§ge
[] = {

85 
	$maš
(
¬gc
, **
¬gv
) {

86 
Prİ”t›s
 *
´İs
 = 
Ãw
 
	`Prİ”t›s
();

87 
Comm
 *
comm
;

88 
CÚÃùiÚMªag”
 *
cÚnMªag”
;

89 
Hy³r¥aûCl›Á
 *
hy³r¥aûCl›Á
;

90 
”rÜ
;

91 cÚ¡ *
commªd
 = 0;

92 
¡ršg
 
cÚfigFe
;

93 
veùÜ
<cÚ¡ *> 
¬gs
;

95 ià(
¬gc
 == 1)

96 
U§ge
::
	`DumpAndEx™
(
u§ge
);

98 
Sy¡em
::
	`In™Ÿlize
(
¬gv
[0]);

99 
R—ùÜFaùÜy
::
	`In™Ÿlize
(1);

101 
cÚfigFe
 = 
Sy¡em
::
š¡®lDœ
 + "/conf/hypertable.cfg";

103 
i
=1; i<
¬gc
; i++) {

104 ià(!
	`¡ºcmp
(
¬gv
[
i
], "--config=", 9))

105 
cÚfigFe
 = &
¬gv
[
i
][9];

106 ià(
commªd
 == 0)

107 
commªd
 = 
¬gv
[
i
];

109 
¬gs
.
	`push_back
(
¬gv
[
i
]);

112 ià(
commªd
 == 0)

113 
U§ge
::
	`DumpAndEx™
(
u§ge
);

115 
´İs
->
	`lßd
(
cÚfigFe
);

117 
comm
 = 
Ãw
 
	`Comm
();

119 
cÚnMªag”
 = 
Ãw
 
	`CÚÃùiÚMªag”
(
comm
);

121 
hy³r¥aûCl›Á
 = 
Ãw
 
	`Hy³r¥aûCl›Á
(
cÚnMªag”
, 
´İs
);

123 ià(!
hy³r¥aûCl›Á
->
	`Wa™FÜCÚÃùiÚ
(30))

124 
dÚe
;

126 ià(!
	`¡rcmp
(
commªd
, "mkdirs"))

127 
”rÜ
 = 
	`CommªdMkdœs
(
hy³r¥aûCl›Á
, 
¬gs
);

128 ià(!
	`¡rcmp
(
commªd
, "touch"))

129 
”rÜ
 = 
	`CommªdC»©e
(
hy³r¥aûCl›Á
, 
¬gs
);

130 ià(!
	`¡rcmp
(
commªd
, "delete"))

131 
”rÜ
 = 
	`CommªdD–‘e
(
hy³r¥aûCl›Á
, 
¬gs
);

132 ià(!
	`¡rcmp
(
commªd
, "attrset"))

133 
”rÜ
 = 
	`CommªdA‰rS‘
(
hy³r¥aûCl›Á
, 
¬gs
);

134 ià(!
	`¡rcmp
(
commªd
, "attrget"))

135 
”rÜ
 = 
	`CommªdA‰rG‘
(
hy³r¥aûCl›Á
, 
¬gs
);

136 ià(!
	`¡rcmp
(
commªd
, "attrdel"))

137 
”rÜ
 = 
	`CommªdA‰rD–
(
hy³r¥aûCl›Á
, 
¬gs
);

138 ià(!
	`¡rcmp
(
commªd
, "exists"))

139  
	`CommªdExi¡s
(
hy³r¥aûCl›Á
, 
¬gs
);

141 
	`LOG_VA_ERROR
("UÄecognized commªd '%s'", 
commªd
);

142 
	`ex™
(1);

145 ià(
”rÜ
 !ğ
E¼Ü
::
OK
)

146 
û¼
 << "ProbËmƒxecutšg commªd - " << 
E¼Ü
::
	`G‘Text
(
”rÜ
è<< 
’dl
;

148 
dÚe
:

149 
d–‘e
 
hy³r¥aûCl›Á
;

150 
d–‘e
 
comm
;

151 
d–‘e
 
´İs
;

152  
”rÜ
;

153 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/ApplicationHandler.h

21 #iâdeà
HYPERTABLE_APPLICATIONHANDLER_H


22 
	#HYPERTABLE_APPLICATIONHANDLER_H


	)

24 
	~<boo¡/sh¬ed_±r.hµ
>

26 
	~"Ev’t.h
"

28 
Çme¥aû
 
	gHy³¹abË
 {

42 şas 
	cAµliÿtiÚHªdËr
 {

44 
	gpublic
:

50 
AµliÿtiÚHªdËr
(
Ev’tPŒ
 &
ev’tPŒ
è: 
m_ev’t_±r
(eventPtr) { ; }

53 
	gvœtu®
 ~
AµliÿtiÚHªdËr
() { ; }

58 
vœtu®
 
run
() = 0;

63 
ušt64_t
 
g‘_th»ad_group
(è{  (
	gm_ev’t_±r
è? m_ev’t_±r->
	gth»adGroup
 : 0; }

65 
	g´Ùeùed
:

66 
Ev’tPŒ
 
m_ev’t_±r
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/ApplicationQueue.h

21 #iâdeà
HYPERTABLE_APPLICATIONQUEUE_H


22 
	#HYPERTABLE_APPLICATIONQUEUE_H


	)

24 
	~<ÿs£¹
>

25 
	~<li¡
>

26 
	~<ext/hash_m­
>

28 
	~<boo¡/th»ad/cÚd™iÚ.hµ
>

29 
	~<boo¡/th»ad/mu‹x.hµ
>

30 
	~<boo¡/th»ad/th»ad.hµ
>

32 
	~"CommÚ/Reã»nûCouÁ.h
"

33 
	~"CommÚ/SŒšgExt.h
"

35 
	~"AµliÿtiÚHªdËr.h
"

37 
Çme¥aû
 
	gHy³¹abË
 {

43 şas 
	cAµliÿtiÚQueue
 : 
public
 
Reã»nûCouÁ
 {

45 şas 
	cU§geRec
 {

46 
public
:

47 
U§geRec
(è: 
th»adGroup
(0), 
ruÂšg
(
çl£
), 
out¡ªdšg
(1) { ; }

48 
ušt64_t
 
	gth»adGroup
;

49 
boŞ
 
	gruÂšg
;

50 
	gout¡ªdšg
;

53 
	g__gnu_cxx
::
	thash_m­
<
	tušt64_t
, 
	tU§geRec
 *> 
	tU§geRecM­T
;

55 şas 
	cWÜkRec
 {

56 
	gpublic
:

57 
WÜkRec
(
AµliÿtiÚHªdËr
 *
ah
è: 
hªdËr
×h), 
u§ge
(0) { ; }

58 ~
WÜkRec
(è{ 
d–‘e
 
	ghªdËr
; }

59 
AµliÿtiÚHªdËr
 *
	ghªdËr
;

60 
U§geRec
 *
	gu§ge
;

63 şas 
	cAµliÿtiÚQueueS‹
 {

64 
	gpublic
:

65 
AµliÿtiÚQueueS‹
(è: 
queue
(), 
u§geM­
(), 
queueMu‹x
(), 
u§geMu‹x
(), 
cÚd
(), 
shutdown
(
çl£
) { ; }

66 
	gli¡
<
	gWÜkRec
 *> 
	gqueue
;

67 
U§geRecM­T
 
	gu§geM­
;

68 
	gboo¡
::
mu‹x
 
queueMu‹x
;

69 
	gboo¡
::
mu‹x
 
u§geMu‹x
;

70 
	gboo¡
::
cÚd™iÚ
 
cÚd
;

71 
boŞ
 
	gshutdown
;

74 şas 
	cWÜk”
 {

76 
	gpublic
:

78 
WÜk”
(
AµliÿtiÚQueueS‹
 &
q¡©e
è: 
m_¡©e
(qstate) {

82 
İ”©Ü
()() {

83 
WÜkRec
 *
	g»c
 = 0;

84 
	gli¡
<
	gWÜkRec
 *>::
™”©Ü
 
™”
;

86 
	gŒue
) {

89 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_¡©e
.
queueMu‹x
);

91 
	gm_¡©e
.
	gqueue
.
em±y
()) {

92 ià(
	gm_¡©e
.
	gshutdown
) {

93 
	gû¼
 << "shutdown!!!" << 
	g’dl
;

96 
	gm_¡©e
.
	gcÚd
.
wa™
(
lock
);

100 
	gboo¡
::
mu‹x
::
scİed_lock
 
ulock
(
m_¡©e
.
u§geMu‹x
);

102 
	g™”
 = 
m_¡©e
.
queue
.
begš
(); i‹¸!ğm_¡©e.queue.
’d
(); iter++) {

103 
	g»c
 = (*
™”
);

104 ià(
	g»c
->
	gu§ge
 =ğ0 || !
»c
->
u§ge
->
ruÂšg
) {

105 ià(
»c
->
u§ge
)

106 
»c
->
u§ge
->
ruÂšg
 = 
Œue
;

107 
	gm_¡©e
.
	gqueue
.
”a£
(
™”
);

110 
	g»c
 = 0;

115 ià(
	g»c
) {

116 
	g»c
->
	ghªdËr
->
run
();

117 ià(
	g»c
->
	gu§ge
) {

118 
	gboo¡
::
mu‹x
::
scİed_lock
 
ulock
(
m_¡©e
.
u§geMu‹x
);

119 
	g»c
->
	gu§ge
->
	gruÂšg
 = 
çl£
;

120 
	g»c
->
	gu§ge
->
	gout¡ªdšg
--;

121 ià(
	g»c
->
	gu§ge
->
	gout¡ªdšg
 == 0) {

122 
m_¡©e
.
u§geM­
.
”a£
(
»c
->
u§ge
->
th»adGroup
);

123 
d–‘e
 
	g»c
->
	gu§ge
;

126 
d–‘e
 
	g»c
;

130 
	gû¼
 << "th»adƒx™" << 
	g’dl
;

133 
	g´iv©e
:

134 
AµliÿtiÚQueueS‹
 &
m_¡©e
;

137 
	gboo¡
::
mu‹x
 
m_mu‹x
;

138 
AµliÿtiÚQueueS‹
 
	gm_¡©e
;

139 
	gboo¡
::
th»ad_group
 
m_th»ads
;

140 
boŞ
 
	gjošed
;

142 
	gpublic
:

150 
AµliÿtiÚQueue
(
wÜk”_couÁ
è: 
jošed
(
çl£
) {

151 
WÜk”
 WÜk”(
m_¡©e
);

152 
as£¹
 (
wÜk”_couÁ
 > 0);

153 
	gi
=0; i<
	gwÜk”_couÁ
; ++i)

154 
	gm_th»ads
.
ü—‹_th»ad
(
WÜk”
);

163 
shutdown
() {

164 
	gm_¡©e
.
	gshutdown
 = 
Œue
;

165 
	gm_¡©e
.
	gcÚd
.
nÙify_®l
();

172 
još
() {

173 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

174 ià(!
	gjošed
) {

175 
	gm_th»ads
.
još_®l
();

176 
	gjošed
 = 
Œue
;

186 
add
(
AµliÿtiÚHªdËr
 *
­pHªdËr
) {

187 
	gU§geRecM­T
::
™”©Ü
 
u™”
;

188 
ušt64_t
 
	gth»adGroup
 = 
­pHªdËr
->
g‘_th»ad_group
();

189 
WÜkRec
 *
	g»c
 = 
Ãw
 WÜkRec(
­pHªdËr
);

190 
	g»c
->
	gu§ge
 = 0;

192 ià(
	gth»adGroup
 != 0) {

193 
boo¡
::
mu‹x
::
scİed_lock
 
ulock
(
m_¡©e
.
u§geMu‹x
);

194 ià((
	gu™”
 = 
m_¡©e
.
u§geM­
.
fšd
(
th»adGroup
)è!ğm_¡©e.u§geM­.
’d
()) {

195 
»c
->
u§ge
 = (*
u™”
).
£cÚd
;

196 
	g»c
->
	gu§ge
->
	gout¡ªdšg
++;

199 
	g»c
->
	gu§ge
 = 
Ãw
 
U§geRec
();

200 
	g»c
->
	gu§ge
->
	gth»adGroup
 = 
th»adGroup
;

201 
	gm_¡©e
.
	gu§geM­
[
th»adGroup
] = 
»c
->
u§ge
;

206 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_¡©e
.
queueMu‹x
);

207 
	gm_¡©e
.
	gqueue
.
push_back
(
»c
);

208 
	gm_¡©e
.
	gcÚd
.
nÙify_Úe
();

212 
	gboo¡
::
	tšŒusive_±r
<
	tAµliÿtiÚQueue
> 
	tAµliÿtiÚQueuePŒ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/Comm.cc

23 
	~<ÿs£¹
>

24 
	~<io¡»am
>

25 
usšg
 
Çme¥aû
 
	g¡d
;

28 #ià
defšed
(
__APPLE__
)

29 
	~<¬·/š‘.h
>

31 
	~<”ºo.h
>

32 
	~<fú.h
>

33 
	~<Ãtdb.h
>

34 
	~<Ãtš‘/š.h
>

35 
	~<Ãtš‘/tı.h
>

36 
	~<pŞl.h
>

37 
	~<¡ršg.h
>

38 
	~<sys/sock‘.h
>

39 
	~<sys/ty³s.h
>

40 
	~<¬·/š‘.h
>

43 
	~"CommÚ/E¼Ü.h
"

44 
	~"CommÚ/IÃtAddr.h
"

45 
	~"CommÚ/FeUts.h
"

46 
	~"CommÚ/Sy¡em.h
"

48 
	~"R—ùÜFaùÜy.h
"

49 
	~"R—ùÜRuÂ”.cc
"

50 
	~"Comm.h
"

51 
	~"IOHªdËrAcû±.h
"

52 
	~"IOHªdËrD©a.h
"

54 
usšg
 
Çme¥aû
 
Hy³¹abË
;

56 
©omic_t
 
	gComm
::
ms_Ãxt_»que¡_id
 = 
ATOMIC_INIT
(1);

61 
	gComm
::
	$Comm
() {

62 ià(
R—ùÜFaùÜy
::
ms_»aùÜs
.
	`size
() == 0) {

63 
	`HT_ERROR
("ReactorFactory::initialize must be called before creating AsyncComm::comm object");

64 
DUMP_CORE
;

66 
R—ùÜFaùÜy
::
	`g‘_»aùÜ
(
m_tim”_»aùÜ_±r
);

67 
m_hªdËr_m­_±r
 = 
R—ùÜRuÂ”
::
ms_hªdËr_m­_±r
;

68 
	}
}

75 
	gComm
::~
	$Comm
() {

77 
£t
<
IOHªdËr
 *> 
hªdËrs
;

78 
m_hªdËr_m­_±r
->
	`decomissiÚ_®l
(
hªdËrs
);

79 
£t
<
IOHªdËr
 *>::
™”©Ü
 
™”
 = 
hªdËrs
.
	`begš
(); i‹¸!ğhªdËrs.
	`’d
(); ++iter)

80 (*
™”
)->
	`shutdown
();

86 
	}
}

92 
	gComm
::
	$cÚÃù
(
sockaddr_š
 &
addr
, 
Di¥©chHªdËrPŒ
 &
deçuÉ_hªdËr_±r
) {

93 
sd
;

95 ià(
m_hªdËr_m­_±r
->
	`cÚšs_hªdËr
(
addr
))

96  
E¼Ü
::
COMM_ALREADY_CONNECTED
;

98 ià((
sd
 = 
	`sock‘
(
AF_INET
, 
SOCK_STREAM
, 
IPPROTO_TCP
)) < 0) {

99 
û¼
 << "sock‘(èçu»: " << 
	`¡»¼Ü
(
”ºo
è<< 
’dl
;

100 
	`ex™
(1);

103  
	`cÚÃù_sock‘
(
sd
, 
addr
, 
deçuÉ_hªdËr_±r
);

104 
	}
}

111 
	gComm
::
	$cÚÃù
(
sockaddr_š
 &
addr
, sockaddr_š &
loÿl_addr
, 
Di¥©chHªdËrPŒ
 &
deçuÉ_hªdËr_±r
) {

112 
sd
;

114 ià(
m_hªdËr_m­_±r
->
	`cÚšs_hªdËr
(
addr
))

115  
E¼Ü
::
COMM_ALREADY_CONNECTED
;

117 ià((
sd
 = 
	`sock‘
(
AF_INET
, 
SOCK_STREAM
, 
IPPROTO_TCP
)) < 0) {

118 
	`HT_ERRORF
("sock‘(èçu»: %s", 
	`¡»¼Ü
(
”ºo
));

119 
	`ex™
(1);

123 ià((
	`bšd
(
sd
, (cÚ¡ 
sockaddr
 *)&
loÿl_addr
, (
sockaddr_š
))) < 0) {

124 
	`HT_ERRORF
("bšd(èçu»: %s", 
	`¡»¼Ü
(
”ºo
));

125 
	`ex™
(1);

128  
	`cÚÃù_sock‘
(
sd
, 
addr
, 
deçuÉ_hªdËr_±r
);

129 
	}
}

135 
	gComm
::
	$li¡’
(
sockaddr_š
 &
addr
, 
CÚÃùiÚHªdËrFaùÜyPŒ
 &
chf_±r
) {

136 
Di¥©chHªdËrPŒ
 
	`nuÎHªdËrPŒ
(0);

137  
	`li¡’
(
addr
, 
chf_±r
, 
nuÎHªdËrPŒ
);

138 
	}
}

144 
	gComm
::
	$£t_®Ÿs
(
sockaddr_š
 &
addr
, sockaddr_š &
®Ÿs
) {

145 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

146  
m_hªdËr_m­_±r
->
	`£t_®Ÿs
(
addr
, 
®Ÿs
);

147 
	}
}

153 
	gComm
::
	$li¡’
(
sockaddr_š
 &
addr
, 
CÚÃùiÚHªdËrFaùÜyPŒ
 &
chf_±r
, 
Di¥©chHªdËrPŒ
 &
deçuÉ_hªdËr_±r
) {

154 
IOHªdËrPŒ
 
hªdËrPŒ
;

155 
IOHªdËrAcû±
 *
acû±HªdËr
;

156 
Úe
 = 1;

157 
sd
;

159 ià((
sd
 = 
	`sock‘
(
AF_INET
, 
SOCK_STREAM
, 
IPPROTO_TCP
)) < 0) {

160 
û¼
 << "sock‘(èçu»: " << 
	`¡»¼Ü
(
”ºo
è<< 
’dl
;

161 
	`ex™
(1);

164 #ià
	`defšed
(
__lšux__
)

165 ià(
	`£tsockİt
(
sd
, 
SOL_TCP
, 
TCP_NODELAY
, &
Úe
, (one)) < 0)

166 
û¼
 << "£tsockİt(TCP_NODELAYèçu»: " << 
	`¡»¼Ü
(
”ºo
è<< 
’dl
;

167 #–ià
	`defšed
(
__APPLE__
)

168 ià(
	`£tsockİt
(
sd
, 
SOL_SOCKET
, 
SO_NOSIGPIPE
, &
Úe
, (one)) < 0)

169 
	`HT_WARNF
("£tsockİt(SO_NOSIGPIPEèçu»: %s", 
	`¡»¼Ü
(
”ºo
));

172 ià(
	`£tsockİt
(
sd
, 
SOL_SOCKET
, 
SO_REUSEADDR
, &
Úe
, (one)) < 0)

173 
û¼
 << "£tsockİt(SO_REUSEADDRèçu»: " << 
	`¡»¼Ü
(
”ºo
è<< 
’dl
;

176 ià((
	`bšd
(
sd
, (cÚ¡ 
sockaddr
 *)&
addr
, (
sockaddr_š
))) < 0) {

177 
û¼
 << "bšd(èçu»: " << 
	`¡»¼Ü
(
”ºo
è<< 
’dl
;

178 
	`ex™
(1);

181 ià(::
	`li¡’
(
sd
, 64) < 0) {

182 
û¼
 << "li¡’(èçu»: " << 
	`¡»¼Ü
(
”ºo
è<< 
’dl
;

183 
	`ex™
(1);

186 
hªdËrPŒ
 = 
acû±HªdËr
 = 
Ãw
 
	`IOHªdËrAcû±
(
sd
, 
addr
, 
deçuÉ_hªdËr_±r
, 
m_hªdËr_m­_±r
, 
chf_±r
);

187 
m_hªdËr_m­_±r
->
	`š£¹_hªdËr
(
acû±HªdËr
);

188 
acû±HªdËr
->
	`¡¬t_pŞlšg
();

190  
E¼Ü
::
OK
;

191 
	}
}

195 
	gComm
::
	$£nd_»que¡
(
sockaddr_š
 &
addr
, 
time_t
 
timeout
, 
CommBufPŒ
 &
cbuf_±r
, 
Di¥©chHªdËr
 *
»¥Ú£HªdËr
) {

196 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

197 
IOHªdËrD©aPŒ
 
d©aHªdËrPŒ
;

198 
H—d”
::
H—d”T
 *
mh—d”
 = (H—d”::H—d”T *)
cbuf_±r
->
d©a
;

199 
”rÜ
 = 
E¼Ü
::
OK
;

201 
cbuf_±r
->
	`»£t_d©a_poš‹rs
();

203 ià(!
m_hªdËr_m­_±r
->
	`lookup_d©a_hªdËr
(
addr
, 
d©aHªdËrPŒ
)) {

204 
	`HT_ERRORF
("NØcÚÃùiÚ fÜ %s:%d", 
	`š‘_Áß
(
addr
.
sš_addr
), 
	`Áohs
×ddr.
sš_pÜt
));

205  
E¼Ü
::
COMM_NOT_CONNECTED
;

208 
mh—d”
->
æags
 |ğ
H—d”
::
FLAGS_BIT_REQUEST
;

209 ià(
»¥Ú£HªdËr
 == 0)

210 
mh—d”
->
æags
 |ğ
H—d”
::
FLAGS_BIT_IGNORE_RESPONSE
;

211 
mh—d”
->
id
 = 
	`©omic_šc_»tuº
(&
ms_Ãxt_»que¡_id
);

212 ià(
mh—d”
->
id
 == 0)

213 
mh—d”
->
id
 = 
	`©omic_šc_»tuº
(&
ms_Ãxt_»que¡_id
);

215 ià((
”rÜ
 = 
d©aHªdËrPŒ
->
	`£nd_mes§ge
(
cbuf_±r
, 
timeout
, 
»¥Ú£HªdËr
)è!ğ
E¼Ü
::
OK
)

216 
d©aHªdËrPŒ
->
	`shutdown
();

218  
”rÜ
;

219 
	}
}

222 
	gComm
::
	$£nd_»¥Ú£
(
sockaddr_š
 &
addr
, 
CommBufPŒ
 &
cbuf_±r
) {

223 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

224 
IOHªdËrD©aPŒ
 
d©aHªdËrPŒ
;

225 
H—d”
::
H—d”T
 *
mh—d”
 = (H—d”::H—d”T *)
cbuf_±r
->
d©a
;

226 
”rÜ
 = 
E¼Ü
::
OK
;

228 
cbuf_±r
->
	`»£t_d©a_poš‹rs
();

230 ià(!
m_hªdËr_m­_±r
->
	`lookup_d©a_hªdËr
(
addr
, 
d©aHªdËrPŒ
)) {

231 
	`HT_ERRORF
("NØcÚÃùiÚ fÜ %s:%d", 
	`š‘_Áß
(
addr
.
sš_addr
), 
	`Áohs
×ddr.
sš_pÜt
));

232  
E¼Ü
::
COMM_NOT_CONNECTED
;

235 
mh—d”
->
æags
 &ğ
H—d”
::
FLAGS_MASK_REQUEST
;

237 ià((
”rÜ
 = 
d©aHªdËrPŒ
->
	`£nd_mes§ge
(
cbuf_±r
)è!ğ
E¼Ü
::
OK
)

238 
d©aHªdËrPŒ
->
	`shutdown
();

240  
”rÜ
;

241 
	}
}

248 
	gComm
::
	$ü—‹_d©ag¿m_»ûive_sock‘
(
sockaddr_š
 *
addr
, 
Di¥©chHªdËrPŒ
 &
di¥©chHªdËrPŒ
) {

249 
IOHªdËrPŒ
 
hªdËrPŒ
;

250 
IOHªdËrD©ag¿m
 *
d©ag¿mHªdËr
;

251 
Úe
 = 1;

252 
sd
;

254 ià((
sd
 = 
	`sock‘
(
AF_INET
, 
SOCK_DGRAM
, 0)) < 0) {

255 
	`HT_ERRORF
("sock‘(èçu»: %s", 
	`¡»¼Ü
(
”ºo
));

256 
	`ex™
(1);

260 
FeUts
::
	`£t_æags
(
sd
, 
O_NONBLOCK
);

262 
bufsize
 = 4*32768;

263 ià(
	`£tsockİt
(
sd
, 
SOL_SOCKET
, 
SO_SNDBUF
, (*)&
bufsize
, (bufsize)) < 0) {

264 
	`HT_ERRORF
("£tsockİt(SO_SNDBUFèçed - %s", 
	`¡»¼Ü
(
”ºo
));

266 ià(
	`£tsockİt
(
sd
, 
SOL_SOCKET
, 
SO_RCVBUF
, (*)&
bufsize
, (bufsize)) < 0) {

267 
	`HT_ERRORF
("£tsockİt(SO_RCVBUFèçed - %s", 
	`¡»¼Ü
(
”ºo
));

270 ià(
	`£tsockİt
(
sd
, 
SOL_SOCKET
, 
SO_REUSEADDR
, &
Úe
, (one)) < 0) {

271 
	`HT_WARNF
("£tsockİt(SO_REUSEADDRèçu»: %s", 
	`¡»¼Ü
(
”ºo
));

275 ià((
	`bšd
(
sd
, (cÚ¡ 
sockaddr
 *)
addr
, (
sockaddr_š
))) < 0) {

276 
	`HT_ERRORF
("bšd(èçu»: %s", 
	`¡»¼Ü
(
”ºo
));

277 
	`ex™
(1);

280 
hªdËrPŒ
 = 
d©ag¿mHªdËr
 = 
Ãw
 
	`IOHªdËrD©ag¿m
(
sd
, *
addr
, 
di¥©chHªdËrPŒ
);

282 
hªdËrPŒ
->
	`g‘_loÿl_add»ss
(
addr
);

284 
m_hªdËr_m­_±r
->
	`š£¹_d©ag¿m_hªdËr
(
d©ag¿mHªdËr
);

285 
d©ag¿mHªdËr
->
	`¡¬t_pŞlšg
();

287  
E¼Ü
::
OK
;

288 
	}
}

294 
	gComm
::
	$£nd_d©ag¿m
(
sockaddr_š
 &
addr
, sockaddr_š &
£nd_addr
, 
CommBufPŒ
 &
cbuf_±r
) {

295 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

296 
IOHªdËrD©ag¿mPŒ
 
d©ag¿mHªdËrPŒ
;

297 
H—d”
::
H—d”T
 *
mh—d”
 = (H—d”::H—d”T *)
cbuf_±r
->
d©a
;

298 
”rÜ
 = 
E¼Ü
::
OK
;

300 
cbuf_±r
->
	`»£t_d©a_poš‹rs
();

302 ià(!
m_hªdËr_m­_±r
->
	`lookup_d©ag¿m_hªdËr
(
£nd_addr
, 
d©ag¿mHªdËrPŒ
)) {

303 
¡d
::
¡ršg
 
¡r
;

304 
	`HT_ERRORF
("D©ag¿m s’d‡dd»s % nÙ„egi¡”ed", 
IÃtAddr
::
	`¡ršg_fÜm©
(
¡r
, 
£nd_addr
));

305 
DUMP_CORE
;

308 
mh—d”
->
æags
 |ğ(
H—d”
::
FLAGS_BIT_REQUEST
|H—d”::
FLAGS_BIT_IGNORE_RESPONSE
);

310 ià((
”rÜ
 = 
d©ag¿mHªdËrPŒ
->
	`£nd_mes§ge
(
addr
, 
cbuf_±r
)è!ğ
E¼Ü
::
OK
)

311 
d©ag¿mHªdËrPŒ
->
	`shutdown
();

313  
”rÜ
;

314 
	}
}

321 
	gComm
::
	$£t_tim”
(
ušt64_t
 
du¿tiÚ_mlis
, 
Di¥©chHªdËr
 *
hªdËr
) {

322 
Tim”T
 
tim”
;

323 
boo¡
::
	`xtime_g‘
(&
tim”
.
expœeTime
, boo¡::
TIME_UTC
);

324 
tim”
.
expœeTime
.
£c
 +ğ
du¿tiÚ_mlis
 / 1000LL;

325 
tim”
.
expœeTime
.
n£c
 +ğ(
du¿tiÚ_mlis
 % 1000LL) * 1000000LL;

326 
tim”
.
hªdËr
 = handler;

327 
m_tim”_»aùÜ_±r
->
	`add_tim”
(
tim”
);

328  
E¼Ü
::
OK
;

329 
	}
}

336 
	gComm
::
£t_tim”_absŞu‹
(
boo¡
::
xtime
 
expœe_time
, 
Di¥©chHªdËr
 *
hªdËr
) {

337 
Tim”T
 
	gtim”
;

338 
memıy
(&
tim”
.
expœeTime
, &
expœe_time
, (
boo¡
::
xtime
));

339 
	gtim”
.
	ghªdËr
 = 
hªdËr
;

340 
	gm_tim”_»aùÜ_±r
->
add_tim”
(
tim”
);

341  
	gE¼Ü
::
OK
;

347 
	gComm
::
	$g‘_loÿl_add»ss
(
sockaddr_š
 
addr
, sockaddr_š *
loÿl_addr
) {

348 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

349 
IOHªdËrD©aPŒ
 
d©aHªdËrPŒ
;

351 ià(!
m_hªdËr_m­_±r
->
	`lookup_d©a_hªdËr
(
addr
, 
d©aHªdËrPŒ
)) {

352 
	`HT_ERRORF
("NØcÚÃùiÚ fÜ %s:%d", 
	`š‘_Áß
(
addr
.
sš_addr
), 
	`Áohs
×ddr.
sš_pÜt
));

353  
E¼Ü
::
COMM_NOT_CONNECTED
;

356 
d©aHªdËrPŒ
->
	`g‘_loÿl_add»ss
(
loÿl_addr
);

358  
E¼Ü
::
OK
;

359 
	}
}

365 
	gComm
::
	$şo£_sock‘
(
sockaddr_š
 &
addr
) {

366 
IOHªdËrPŒ
 
hªdËrPŒ
;

368 ià(!
m_hªdËr_m­_±r
->
	`decomissiÚ_hªdËr
(
addr
, 
hªdËrPŒ
))

369  
E¼Ü
::
COMM_NOT_CONNECTED
;

371 
hªdËrPŒ
->
	`shutdown
();

373  
E¼Ü
::
OK
;

374 
	}
}

385 
	gComm
::
	$cÚÃù_sock‘
(
sd
, 
sockaddr_š
 &
addr
, 
Di¥©chHªdËrPŒ
 &
deçuÉ_hªdËr_±r
) {

386 
IOHªdËrPŒ
 
hªdËrPŒ
;

387 
IOHªdËrD©a
 *
d©aHªdËr
;

388 
Úe
 = 1;

391 
FeUts
::
	`£t_æags
(
sd
, 
O_NONBLOCK
);

393 #ià
	`defšed
(
__lšux__
)

394 ià(
	`£tsockİt
(
sd
, 
SOL_TCP
, 
TCP_NODELAY
, &
Úe
, (one)) < 0)

395 
û¼
 << "£tsockİt(TCP_NODELAYèçu»: " << 
	`¡»¼Ü
(
”ºo
è<< 
’dl
;

396 #–ià
	`defšed
(
__APPLE__
)

397 ià(
	`£tsockİt
(
sd
, 
SOL_SOCKET
, 
SO_NOSIGPIPE
, &
Úe
, (one)) < 0)

398 
	`HT_WARNF
("£tsockİt(SO_NOSIGPIPEèçu»: %s", 
	`¡»¼Ü
(
”ºo
));

401 
hªdËrPŒ
 = 
d©aHªdËr
 = 
Ãw
 
	`IOHªdËrD©a
(
sd
, 
addr
, 
deçuÉ_hªdËr_±r
);

402 
m_hªdËr_m­_±r
->
	`š£¹_hªdËr
(
d©aHªdËr
);

404 ::
	`cÚÃù
(
sd
, (
sockaddr
 *)&
addr
, (
sockaddr_š
)) < 0) {

405 ià(
”ºo
 =ğ
EINTR
) {

406 
	`pŞl
(0, 0, 1000);

409 ià(
”ºo
 =ğ
EINPROGRESS
) {

410 
d©aHªdËr
->
	`¡¬t_pŞlšg
();

411 
d©aHªdËr
->
	`add_pŞl_š‹»¡
(
R—ùÜ
::
READ_READY
|R—ùÜ::
WRITE_READY
);

412  
E¼Ü
::
OK
;

414 
	`HT_ERRORF
("cÚÃù(èçu» : %s", 
	`¡»¼Ü
(
”ºo
));

415 
	`ex™
(1);

418 
d©aHªdËr
->
	`¡¬t_pŞlšg
();

420  
E¼Ü
::
OK
;

421 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/Comm.h

21 #iâdeà
HYPERTABLE_COMMENGINE_H


22 
	#HYPERTABLE_COMMENGINE_H


	)

24 
	~<¡ršg
>

26 
	~<boo¡/th»ad/mu‹x.hµ
>

27 
	~<boo¡/th»ad/xtime.hµ
>

30 
	~<¡dšt.h
>

33 
	~"CommÚ/Reã»nûCouÁ.h
"

35 
	~"Di¥©chHªdËr.h
"

36 
	~"CommBuf.h
"

37 
	~"CÚÃùiÚHªdËrFaùÜy.h
"

38 
	~"HªdËrM­.h
"

40 
usšg
 
Çme¥aû
 
¡d
;

42 
Çme¥aû
 
	gHy³¹abË
 {

51 şas 
	cComm
 : 
public
 
Reã»nûCouÁ
 {

53 
public
:

55 
Comm
();

57 ~
Comm
();

69 
cÚÃù
(
sockaddr_š
 &
addr
, 
Di¥©chHªdËrPŒ
 &
deçuÉ_hªdËr_±r
);

83 
cÚÃù
(
sockaddr_š
 &
addr
, sockaddr_š &
loÿl_addr
, 
Di¥©chHªdËrPŒ
 &
deçuÉ_hªdËr_±r
);

92 
£t_®Ÿs
(
sockaddr_š
 &
addr
, sockaddr_š &
®Ÿs
);

105 
li¡’
(
sockaddr_š
 &
addr
, 
CÚÃùiÚHªdËrFaùÜyPŒ
 &
chf_±r
);

120 
li¡’
(
sockaddr_š
 &
addr
, 
CÚÃùiÚHªdËrFaùÜyPŒ
 &
chf_±r
, 
Di¥©chHªdËrPŒ
 &
deçuÉ_hªdËr_±r
);

152 
£nd_»que¡
(
sockaddr_š
 &
addr
, 
time_t
 
timeout
, 
CommBufPŒ
 &
cbuf_±r
, 
Di¥©chHªdËr
 *
»¥Ú£_hªdËr
);

175 
£nd_»¥Ú£
(
sockaddr_š
 &
addr
, 
CommBufPŒ
 &
cbuf_±r
);

185 
g‘_loÿl_add»ss
(
sockaddr_š
 
addr
, sockaddr_š *
loÿl_addr
);

197 
ü—‹_d©ag¿m_»ûive_sock‘
(
sockaddr_š
 *
addr
, 
Di¥©chHªdËrPŒ
 &
hªdËr_±r
);

210 
£nd_d©ag¿m
(
sockaddr_š
 &
addr
, sockaddr_š &
£nd_addr
, 
CommBufPŒ
 &
cbuf_±r
);

221 
£t_tim”
(
ušt64_t
 
du¿tiÚ_mlis
, 
Di¥©chHªdËr
 *
hªdËr
);

232 
£t_tim”_absŞu‹
(
boo¡
::
xtime
 
expœe_time
, 
Di¥©chHªdËr
 *
hªdËr
);

243 
şo£_sock‘
(
sockaddr_š
 &
addr
);

245 
	g´iv©e
:

247 
cÚÃù_sock‘
(
sd
, 
sockaddr_š
 &
addr
, 
Di¥©chHªdËrPŒ
 &
deçuÉ_hªdËr_±r
);

249 
©omic_t
 
	gms_Ãxt_»que¡_id
;

251 
	gboo¡
::
mu‹x
 
m_mu‹x
;

252 
HªdËrM­PŒ
 
	gm_hªdËr_m­_±r
;

253 
R—ùÜPŒ
 
	gm_tim”_»aùÜ_±r
;

255 
	gboo¡
::
	tšŒusive_±r
<
	tComm
> 
	tCommPŒ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/CommBuf.h

21 #iâdeà
HYPERTABLE_COMMBUF_H


22 
	#HYPERTABLE_COMMBUF_H


	)

24 
	~<¡ršg
>

26 
	~<boo¡/sh¬ed_±r.hµ
>

29 
	~<¡dšt.h
>

30 
	~<¡dlib.h
>

31 
	~<¡ršg.h
>

34 
	~"CommÚ/By‹SŒšg.h
"

35 
	~"CommÚ/Logg”.h
"

37 
	~"H—d”Bud”.h
"

38 
	~"S”Ÿliz©iÚ.h
"

40 
Çme¥aû
 
Hy³¹abË
 {

71 şas 
	cCommBuf
 {

72 
public
:

88 
CommBuf
(
H—d”Bud”
 &
hbud”
, 
ušt32_t
 
Ën
, cÚ¡ *
_ex
=0, ušt32_ˆ
_exL’
=0) {

89 
Ën
 +ğ
hbud”
.
h—d”_Ëngth
();

90 
d©a
 = 
d©aPŒ
 = 
Ãw
 
ušt8_t
 [ 
Ën
 ];

91 
d©aL’
 = 
Ën
;

92 
ext
 = 
extPŒ
 = (cÚ¡ 
ušt8_t
 *)
_ex
;

93 
extL’
 = 
_exL’
;

94 
hbud”
.
£t_tÙ®_Ën
(
Ën
+
extL’
);

95 
hbud”
.
’code
(&
d©aPŒ
);

101 ~
CommBuf
() {

102 
d–‘e
 [] 
d©a
;

103 
d–‘e
 [] 
ext
;

112 
»£t_d©a_poš‹rs
() {

113 
d©aPŒ
 = (
ušt8_t
 *)
d©a
;

114 
extPŒ
 = 
ext
;

120 *
g‘_d©a_±r
(è{  
d©aPŒ
; }

125 
ušt8_t
 **
g‘_d©a_±r_add»ss
(è{  &
d©aPŒ
; }

133 *
advªû_d©a_±r
(
size_t
 
Ën
è{ 
d©aPŒ
 +=†en;  dataPtr; }

141 
­³nd_boŞ
(
boŞ
 
bv®
è{ 
S”Ÿliz©iÚ
::
’code_boŞ
(&
d©aPŒ
, bval); }

149 
­³nd_by‹
(
ušt8_t
 
bv®
è{ *
d©aPŒ
++ = bval; }

158 
­³nd_by‹s
(
ušt8_t
 *
by‹s
, 
ušt32_t
 
Ën
è{ 
memıy
(
d©aPŒ
, bytes,†en); dataPtr +=†en; }

166 
­³nd_shÜt
(
ušt16_t
 
sv®
è{ 
S”Ÿliz©iÚ
::
’code_shÜt
(&
d©aPŒ
, sval); }

174 
­³nd_št
(
ušt32_t
 
iv®
è{ 
S”Ÿliz©iÚ
::
’code_št
(&
d©aPŒ
, ival); }

182 
­³nd_lÚg
(
ušt64_t
 
lv®
è{ 
S”Ÿliz©iÚ
::
’code_lÚg
(&
d©aPŒ
,†val); }

192 
­³nd_by‹_¬¿y
(cÚ¡ *
d©a
, 
št32_t
 
Ën
è{ 
S”Ÿliz©iÚ
::
’code_by‹_¬¿y
(&
d©aPŒ
, data,†en); }

202 
­³nd_¡ršg
(cÚ¡ *
¡r
è{ 
S”Ÿliz©iÚ
::
’code_¡ršg
(&
d©aPŒ
, str); }

212 
­³nd_¡ršg
(cÚ¡ 
¡d
::
¡ršg
 &
¡r
è{ 
S”Ÿliz©iÚ
::
’code_¡ršg
(&
d©aPŒ
, sŒ.
c_¡r
()); }

214 
ä›nd
 
şass
 
IOHªdËrD©a
;

216 cÚ¡ 
ušt8_t
 *
d©a
;

217 
ušt32_t
 
d©aL’
;

218 cÚ¡ 
ušt8_t
 *
ext
;

219 
ušt32_t
 
extL’
;

221 
´Ùeùed
:

222 
ušt8_t
 *
d©aPŒ
;

223 cÚ¡ 
ušt8_t
 *
extPŒ
;

226 
boo¡
::
	tsh¬ed_±r
<
	tCommBuf
> 
	tCommBufPŒ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/ConnectionHandlerFactory.h

22 #iâdeà
HYPERTABLE_CONNECTIONHANDLERFACTORY_H


23 
	#HYPERTABLE_CONNECTIONHANDLERFACTORY_H


	)

25 
	~"CommÚ/Reã»nûCouÁ.h
"

27 
	~"Di¥©chHªdËr.h
"

29 
Çme¥aû
 
	gHy³¹abË
 {

31 şas 
	cCÚÃùiÚHªdËrFaùÜy
 : 
public
 
Reã»nûCouÁ
 {

32 
public
:

33 
vœtu®
 ~
CÚÃùiÚHªdËrFaùÜy
() { }

34 
vœtu®
 
g‘_š¡ªû
(
Di¥©chHªdËrPŒ
 &
dhp
) = 0;

36 
	gboo¡
::
	tšŒusive_±r
<
	tCÚÃùiÚHªdËrFaùÜy
> 
	tCÚÃùiÚHªdËrFaùÜyPŒ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/ConnectionManager.cc

21 
	~<c¡dlib
>

22 
	~<io¡»am
>

25 
	~<pŞl.h
>

26 
	~<sys/ty³s.h
>

27 
	~<sys/sock‘.h
>

28 
	~<Ãtš‘/š.h
>

29 
	~<¬·/š‘.h
>

32 
	~"CommÚ/E¼Ü.h
"

33 
	~"CommÚ/Logg”.h
"

35 
	~"AsyncComm/Comm.h
"

37 
	~"CÚÃùiÚMªag”.h
"

39 
usšg
 
Çme¥aû
 
Hy³¹abË
;

40 
usšg
 
Çme¥aû
 
	g¡d
;

45 
	gCÚÃùiÚMªag”
::
	$add
(
sockaddr_š
 &
addr
, 
time_t
 
timeout
, cÚ¡ *
£rviûName
, 
Di¥©chHªdËrPŒ
 &
hªdËrPŒ
) {

46 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_im¶
->mutex);

47 
SockAddrM­T
<
CÚÃùiÚS‹PŒ
> 
™”
;

48 
CÚÃùiÚS‹
 *
cÚnS‹
;

50 ià(
m_im¶
->
cÚnM­
.
	`fšd
(
addr
è!ğm_im¶->cÚnM­.
	`’d
())

53 
cÚnS‹
 = 
Ãw
 
	`CÚÃùiÚS‹
();

54 
cÚnS‹
->
cÚÃùed
 = 
çl£
;

55 
cÚnS‹
->
addr
 =‡ddr;

56 
	`mem£t
(&
cÚnS‹
->
loÿlAddr
, 0, (
sockaddr_š
));

57 
cÚnS‹
->
timeout
 =imeout;

58 
cÚnS‹
->
hªdËrPŒ
 = handlerPtr;

59 
cÚnS‹
->
£rviûName
 = (serviceName) ? serviceName : "";

60 
boo¡
::
	`xtime_g‘
(&
cÚnS‹
->
ÃxtR‘ry
, boo¡::
TIME_UTC
);

62 
m_im¶
->
cÚnM­
[
addr
] = 
	`CÚÃùiÚS‹PŒ
(
cÚnS‹
);

65 
boo¡
::
mu‹x
::
scİed_lock
 
	`cÚnLock
(
cÚnS‹
->mutex);

66 
	`£nd_cÚÃù_»que¡
(
cÚnS‹
);

68 
	}
}

73 
	gCÚÃùiÚMªag”
::
	$add
(
sockaddr_š
 &
addr
, 
time_t
 
timeout
, cÚ¡ *
£rviûName
) {

74 
Di¥©chHªdËrPŒ
 
nuÎDi¥©chHªdËr
;

75 
	`add
(
addr
, 
timeout
, 
£rviûName
, 
nuÎDi¥©chHªdËr
);

76 
	}
}

83 
	gCÚÃùiÚMªag”
::
	$add
(
sockaddr_š
 &
addr
, sockaddr_š &
loÿlAddr
, 
time_t
 
timeout
, cÚ¡ *
£rviûName
, 
Di¥©chHªdËrPŒ
 &
hªdËrPŒ
) {

84 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_im¶
->mutex);

85 
SockAddrM­T
<
CÚÃùiÚS‹PŒ
> 
™”
;

86 
CÚÃùiÚS‹
 *
cÚnS‹
;

88 ià(
m_im¶
->
cÚnM­
.
	`fšd
(
addr
è!ğm_im¶->cÚnM­.
	`’d
())

91 
cÚnS‹
 = 
Ãw
 
	`CÚÃùiÚS‹
();

92 
cÚnS‹
->
cÚÃùed
 = 
çl£
;

93 
cÚnS‹
->
addr
 =‡ddr;

94 
cÚnS‹
->
loÿlAddr
 =†ocalAddr;

95 
cÚnS‹
->
timeout
 =imeout;

96 
cÚnS‹
->
hªdËrPŒ
 = handlerPtr;

97 
cÚnS‹
->
£rviûName
 = (serviceName) ? serviceName : "";

98 
boo¡
::
	`xtime_g‘
(&
cÚnS‹
->
ÃxtR‘ry
, boo¡::
TIME_UTC
);

100 
m_im¶
->
cÚnM­
[
addr
] = 
	`CÚÃùiÚS‹PŒ
(
cÚnS‹
);

103 
boo¡
::
mu‹x
::
scİed_lock
 
	`cÚnLock
(
cÚnS‹
->mutex);

104 
	`£nd_cÚÃù_»que¡
(
cÚnS‹
);

106 
	}
}

112 
	gCÚÃùiÚMªag”
::
	$add
(
sockaddr_š
 &
addr
, sockaddr_š &
loÿlAddr
, 
time_t
 
timeout
, cÚ¡ *
£rviûName
) {

113 
Di¥©chHªdËrPŒ
 
nuÎDi¥©chHªdËr
;

114 
	`add
(
addr
, 
loÿlAddr
, 
timeout
, 
£rviûName
, 
nuÎDi¥©chHªdËr
);

115 
	}
}

120 
boŞ
 
	gCÚÃùiÚMªag”
::
	$wa™_fÜ_cÚÃùiÚ
(
sockaddr_š
 &
addr
, 
maxWa™Secs
) {

121 
CÚÃùiÚS‹PŒ
 
cÚnS‹PŒ
;

124 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_im¶
->mutex);

125 
SockAddrM­T
<
CÚÃùiÚS‹PŒ
>::
™”©Ü
 
™”
 = 
m_im¶
->
cÚnM­
.
	`fšd
(
addr
);

126 ià(
™”
 =ğ
m_im¶
->
cÚnM­
.
	`’d
())

127  
çl£
;

128 
cÚnS‹PŒ
 = (*
™”
).
£cÚd
;

132 
boo¡
::
mu‹x
::
scİed_lock
 
	`cÚnLock
(
cÚnS‹PŒ
->mutex);

133 
boo¡
::
xtime
 
drİTime
, 
now
;

135 
boo¡
::
	`xtime_g‘
(&
drİTime
, boo¡::
TIME_UTC
);

136 
drİTime
.
£c
 +ğ
maxWa™Secs
;

138 !
cÚnS‹PŒ
->
cÚÃùed
) {

139 
cÚnS‹PŒ
->
cÚd
.
	`timed_wa™
(
cÚnLock
, 
drİTime
);

140 
boo¡
::
	`xtime_g‘
(&
now
, boo¡::
TIME_UTC
);

141 ià(
	`xtime_cmp
(
now
, 
drİTime
) >= 0)

142  
çl£
;

146  
Œue
;

147 
	}
}

158 
	gCÚÃùiÚMªag”
::
	$£nd_cÚÃù_»que¡
(
CÚÃùiÚS‹
 *
cÚnS‹
) {

159 
”rÜ
;

160 
Di¥©chHªdËrPŒ
 
	`hªdËrPŒ
(
this
);

162 ià(
cÚnS‹
->
loÿlAddr
.
sš_pÜt
 != 0)

163 
”rÜ
 = 
m_im¶
->
comm
->
	`cÚÃù
(
cÚnS‹
->
addr
, cÚnS‹->
loÿlAddr
, 
hªdËrPŒ
);

165 
”rÜ
 = 
m_im¶
->
comm
->
	`cÚÃù
(
cÚnS‹
->
addr
, 
hªdËrPŒ
);

167 ià(
”rÜ
 =ğ
E¼Ü
::
COMM_ALREADY_CONNECTED
) {

168 
cÚnS‹
->
cÚÃùed
 = 
Œue
;

169 
cÚnS‹
->
cÚd
.
	`nÙify_®l
();

171 ià(
”rÜ
 !ğ
E¼Ü
::
OK
) {

172 ià(
cÚnS‹
->
£rviûName
 != "") {

173 
	`HT_ERRORF
("Connection‡ttempto %s‡t %s:%d failed - %s. Will„etry‡gain in %d seconds...",

174 
cÚnS‹
->
£rviûName
.
	`c_¡r
(), 
	`š‘_Áß
(cÚnS‹->
addr
.
sš_addr
), 
	`Áohs
(cÚnS‹->addr.
sš_pÜt
),

175 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
), 
cÚnS‹
->
timeout
);

178 
	`HT_ERRORF
("Connection‡ttempto service‡t %s:%d failed - %s. Will„etry‡gain in %d seconds...",

179 
	`š‘_Áß
(
cÚnS‹
->
addr
.
sš_addr
), 
	`Áohs
(cÚnS‹->addr.
sš_pÜt
),

180 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
), 
cÚnS‹
->
timeout
);

184 
boo¡
::
	`xtime_g‘
(&
cÚnS‹
->
ÃxtR‘ry
, boo¡::
TIME_UTC
);

185 
št32_t
 
£c_add™iÚ
;

186 ià(
	`¿nd
() % 2)

187 
£c_add™iÚ
 = 
cÚnS‹
->
timeout
 + (
	`¿nd
() % 2);

189 
£c_add™iÚ
 = 
cÚnS‹
->
timeout
 - (
	`¿nd
() % 2);

190 ià(
£c_add™iÚ
 < 1)

191 
£c_add™iÚ
 = 1;

192 
cÚnS‹
->
ÃxtR‘ry
.
£c
 +ğ
£c_add™iÚ
;

193 
cÚnS‹
->
ÃxtR‘ry
.
n£c
 = ((
št64_t
)
	`¿nd
() << 32) |„and();

196 
m_im¶
->
»ŒyQueue
.
	`push
(
cÚnS‹
);

197 
m_im¶
->
»ŒyCÚd
.
	`nÙify_Úe
();

200 
	}
}

207 
	gCÚÃùiÚMªag”
::
	$»move
(
sockaddr_š
 &
addr
) {

208 
boŞ
 
doClo£
 = 
çl£
;

209 
”rÜ
 = 
E¼Ü
::
OK
;

212 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_im¶
->mutex);

213 
SockAddrM­T
<
CÚÃùiÚS‹PŒ
>::
™”©Ü
 
™”
 = 
m_im¶
->
cÚnM­
.
	`fšd
(
addr
);

215 ià(
™”
 !ğ
m_im¶
->
cÚnM­
.
	`’d
()) {

216 
boo¡
::
mu‹x
::
scİed_lock
 
	`cÚnLock
((*
™”
).
£cÚd
->mutex);

217 ià((*
™”
).
£cÚd
->
cÚÃùed
)

218 
doClo£
 = 
Œue
;

220 (*
™”
).
£cÚd
->
cÚÃùed
 = 
Œue
;

221 
m_im¶
->
cÚnM­
.
	`”a£
(
™”
);

225 ià(
doClo£
)

226 
”rÜ
 = 
m_im¶
->
comm
->
	`şo£_sock‘
(
addr
);

228  
”rÜ
;

229 
	}
}

242 
	gCÚÃùiÚMªag”
::
	$hªdË
(
Ev’tPŒ
 &
ev’tPŒ
) {

243 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_im¶
->mutex);

244 
SockAddrM­T
<
CÚÃùiÚS‹PŒ
>::
™”©Ü
 
™”
 = 
m_im¶
->
cÚnM­
.
	`fšd
(
ev’tPŒ
->
addr
);

246 ià(
™”
 !ğ
m_im¶
->
cÚnM­
.
	`’d
()) {

247 
boo¡
::
mu‹x
::
scİed_lock
 
	`cÚnLock
((*
™”
).
£cÚd
->mutex);

248 
CÚÃùiÚS‹
 *
cÚnS‹
 = (*
™”
).
£cÚd
.
	`g‘
();

250 ià(
ev’tPŒ
->
ty³
 =ğ
Ev’t
::
CONNECTION_ESTABLISHED
) {

251 
cÚnS‹
->
cÚÃùed
 = 
Œue
;

252 
cÚnS‹
->
cÚd
.
	`nÙify_®l
();

254 ià(
ev’tPŒ
->
ty³
 =ğ
Ev’t
::
ERROR
 ||ƒv’tPŒ->ty³ =ğEv’t::
DISCONNECT
) {

255 ià(!
m_im¶
->
qu›tMode
) {

256 
	`HT_INFOF
("%s; Problem connectingo %s, will„etry in %d seconds...",

257 
ev’tPŒ
->
	`toSŒšg
().
	`c_¡r
(), 
cÚnS‹
->
£rviûName
.c_¡r(), cÚnS‹->
timeout
);

259 
cÚnS‹
->
cÚÃùed
 = 
çl£
;

264 
boo¡
::
	`xtime_g‘
(&
cÚnS‹
->
ÃxtR‘ry
, boo¡::
TIME_UTC
);

265 
cÚnS‹
->
ÃxtR‘ry
.
£c
 +ğcÚnS‹->
timeout
;

267 
m_im¶
->
»ŒyQueue
.
	`push
(
cÚnS‹
);

268 
m_im¶
->
»ŒyCÚd
.
	`nÙify_Úe
();

272 ià(
cÚnS‹
->
hªdËrPŒ
)

273 
cÚnS‹
->
hªdËrPŒ
->
	`hªdË
(
ev’tPŒ
);

276 
	`HT_WARNF
("UÇbËØfšd cÚÃùiÚ fÜ %s:%d iÀm­.", 
	`š‘_Áß
(
ev’tPŒ
->
addr
.
sš_addr
), 
	`Áohs
Óv’tPŒ->addr.
sš_pÜt
));

278 
	}
}

285 
	gCÚÃùiÚMªag”
::
	$İ”©Ü
()() {

286 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_im¶
->mutex);

287 
CÚÃùiÚS‹PŒ
 
cÚnS‹PŒ
;

289 
Œue
) {

291 
m_im¶
->
»ŒyQueue
.
	`em±y
())

292 
m_im¶
->
»ŒyCÚd
.
	`wa™
(
lock
);

294 
cÚnS‹PŒ
 = 
m_im¶
->
»ŒyQueue
.
	`tİ
();

296 ià(!
cÚnS‹PŒ
->
cÚÃùed
) {

298 
boo¡
::
mu‹x
::
scİed_lock
 
	`cÚnLock
(
cÚnS‹PŒ
->mutex);

299 
boo¡
::
xtime
 
now
;

300 
boo¡
::
	`xtime_g‘
(&
now
, boo¡::
TIME_UTC
);

302 ià(
	`xtime_cmp
(
cÚnS‹PŒ
->
ÃxtR‘ry
, 
now
) <= 0) {

303 
m_im¶
->
»ŒyQueue
.
	`pİ
();

310 
	`£nd_cÚÃù_»que¡
(
cÚnS‹PŒ
.
	`g‘
());

314 
m_im¶
->
»ŒyCÚd
.
	`timed_wa™
(
lock
, 
cÚnS‹PŒ
->
ÃxtR‘ry
);

317 
m_im¶
->
»ŒyQueue
.
	`pİ
();

319 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/ConnectionManager.h

21 #iâdeà
HYPERTABLE_CONNECTIONMANAGER_H


22 
	#HYPERTABLE_CONNECTIONMANAGER_H


	)

24 
	~<queue
>

25 
	~<¡ršg
>

27 
	~<boo¡/sh¬ed_±r.hµ
>

28 
	~<boo¡/th»ad/cÚd™iÚ.hµ
>

29 
	~<boo¡/th»ad/mu‹x.hµ
>

30 
	~<boo¡/th»ad/th»ad.hµ
>

31 
	~<boo¡/th»ad/xtime.hµ
>

34 
	~<time.h
>

35 
	~<sys/time.h
>

38 
	~"CommÚ/Reã»nûCouÁ.h
"

39 
	~"CommÚ/SockAddrM­.h
"

41 
	~"Di¥©chHªdËr.h
"

43 
Çme¥aû
 
Hy³¹abË
 {

45 
şass
 
Comm
;

46 
şass
 
Ev’t
;

53 şas 
	cCÚÃùiÚMªag”
 : 
public
 
Di¥©chHªdËr
 {

55 
public
:

57 şas 
	cCÚÃùiÚS‹
 : 
public
 
Reã»nûCouÁ
 {

58 
public
:

59 
boŞ
 
cÚÃùed
;

60 
sockaddr_š
 
addr
;

61 
sockaddr_š
 
loÿlAddr
;

62 
time_t
 
timeout
;

63 
Di¥©chHªdËrPŒ
 
hªdËrPŒ
;

64 
boo¡
::
mu‹x
 mutex;

65 
boo¡
::
cÚd™iÚ
 
cÚd
;

66 
boo¡
::
xtime
 
ÃxtR‘ry
;

67 
¡d
::
¡ršg
 
£rviûName
;

69 
boo¡
::
	tšŒusive_±r
<
	tCÚÃùiÚS‹
> 
	tCÚÃùiÚS‹PŒ
;

72 
	sÉCÚÃùiÚS‹
 {

73 
boŞ
 
İ”©Ü
()(cÚ¡ 
CÚÃùiÚS‹PŒ
 &
cs1
, cÚ¡ CÚÃùiÚS‹PŒ &
cs2
) const {

74  
xtime_cmp
(
cs1
->
ÃxtR‘ry
, 
cs2
->nextRetry) >= 0;

79 
Comm
 *
comm
;

80 
boo¡
::
mu‹x
 mutex;

81 
boo¡
::
cÚd™iÚ
 
»ŒyCÚd
;

82 
boo¡
::
th»ad
 *thread;

83 
SockAddrM­T
<
CÚÃùiÚS‹PŒ
> 
cÚnM­
;

84 
¡d
::
´iÜ™y_queue
<
CÚÃùiÚS‹PŒ
, std::
veùÜ
<CÚÃùiÚS‹PŒ>, 
ÉCÚÃùiÚS‹
> 
»ŒyQueue
;

85 
boŞ
 
qu›tMode
;

86 } 
	tSh¬edIm¶T
;

93 
CÚÃùiÚMªag”
(
Comm
 *
comm
) {

94 
m_im¶
 = 
Ãw
 
Sh¬edIm¶T
;

95 
m_im¶
->
comm
 = comm;

96 
m_im¶
->
th»ad
 = 
Ãw
 
boo¡
::th»ad(*
this
);

97 
m_im¶
->
qu›tMode
 = 
çl£
;

103 
CÚÃùiÚMªag”
(cÚ¡ CÚÃùiÚMªag” &
cm
) {

104 
m_im¶
 = 
cm
.m_impl;

105 
šŒusive_±r_add_»f
(
this
);

111 
vœtu®
 ~
CÚÃùiÚMªag”
() {

129 
add
(
sockaddr_š
 &
addr
, 
time_t
 
timeout
, cÚ¡ *
£rviûName
);

139 
add
(
sockaddr_š
 &
addr
, 
time_t
 
timeout
, cÚ¡ *
£rviûName
, 
Di¥©chHªdËrPŒ
 &
hªdËrPŒ
);

156 
add
(
sockaddr_š
 &
addr
, sockaddr_š &
loÿlAddr
, 
time_t
 
timeout
, cÚ¡ *
£rviûName
);

167 
add
(
sockaddr_š
 &
addr
, sockaddr_š &
loÿlAddr
, 
time_t
 
timeout
, cÚ¡ *
£rviûName
, 
Di¥©chHªdËrPŒ
 &
hªdËrPŒ
);

175 
»move
(
sockaddr_š
 &
addr
);

187 
boŞ
 
wa™_fÜ_cÚÃùiÚ
(
sockaddr_š
 &
addr
, 
maxWa™Secs
);

194 
Comm
 *
g‘_comm
(è{  
m_im¶
->
comm
; }

203 
£t_qu›t_mode
(
boŞ
 
mode
è{ 
m_im¶
->
qu›tMode
 = mode; }

209 
vœtu®
 
hªdË
(
Ev’tPŒ
 &
ev’t
);

215 
İ”©Ü
()();

217 
´iv©e
:

219 
£nd_cÚÃù_»que¡
(
CÚÃùiÚS‹
 *
cÚnS‹
);

221 
Sh¬edIm¶T
 *
m_im¶
;

224 
boo¡
::
	tšŒusive_±r
<
	tCÚÃùiÚMªag”
> 
	tCÚÃùiÚMªag”PŒ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/DispatchHandler.h

21 #iâdeà
HYPERTABLE_DISPATCHHANDLER_H


22 
	#HYPERTABLE_DISPATCHHANDLER_H


	)

24 
	~"CommÚ/Reã»nûCouÁ.h
"

26 
	~"Ev’t.h
"

28 
Çme¥aû
 
	gHy³¹abË
 {

37 şas 
	cDi¥©chHªdËr
 : 
public
 
Reã»nûCouÁ
 {

38 
public
:

46 
vœtu®
 
hªdË
(
Ev’tPŒ
 &
ev’tPŒ
) = 0;

48 
	gvœtu®
 ~
Di¥©chHªdËr
() { ; }

50 
	gboo¡
::
	tšŒusive_±r
<
	tDi¥©chHªdËr
> 
	tDi¥©chHªdËrPŒ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/DispatchHandlerSynchronizer.cc

21 
	~"CommÚ/E¼Ü.h
"

22 
	~"CommÚ/Logg”.h
"

24 
	~"Di¥©chHªdËrSynchrÚiz”.h
"

25 
	~"PrÙocŞ.h
"

27 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

33 
	gDi¥©chHªdËrSynchrÚiz”
::
	$Di¥©chHªdËrSynchrÚiz”
(è: 
	`m_»ûive_queue
(), 
	`m_mu‹x
(), 
	$m_cÚd
() {

35 
	}
}

42 
	gDi¥©chHªdËrSynchrÚiz”
::
	$hªdË
(
Ev’tPŒ
 &
ev’tPŒ
) {

43 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

44 
m_»ûive_queue
.
	`push
(
ev’tPŒ
);

45 
m_cÚd
.
	`nÙify_Úe
();

46 
	}
}

53 
boŞ
 
	gDi¥©chHªdËrSynchrÚiz”
::
	$wa™_fÜ_»¶y
(
Ev’tPŒ
 &
ev’tPŒ
) {

54 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

56 
m_»ûive_queue
.
	`em±y
())

57 
m_cÚd
.
	`wa™
(
lock
);

59 
ev’tPŒ
 = 
m_»ûive_queue
.
	`äÚt
();

60 
m_»ûive_queue
.
	`pİ
();

62 ià(
ev’tPŒ
->
ty³
 =ğ
Ev’t
::
MESSAGE
 && 
PrÙocŞ
::
	`»¥Ú£_code
Óv’tPŒ.
	`g‘
()è=ğ
E¼Ü
::
OK
)

63  
Œue
;

65  
çl£
;

66 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/DispatchHandlerSynchronizer.h

21 #iâdeà
DISPATCHHANDLERSYNCHRONIZER_H


22 
	#DISPATCHHANDLERSYNCHRONIZER_H


	)

24 
	~<queue
>

26 
	~<boo¡/th»ad/cÚd™iÚ.hµ
>

27 
	~<boo¡/th»ad/mu‹x.hµ
>

29 
	~"Di¥©chHªdËr.h
"

30 
	~"Ev’t.h
"

32 
Çme¥aû
 
	gHy³¹abË
 {

59 şas 
	cDi¥©chHªdËrSynchrÚiz”
 : 
public
 
Di¥©chHªdËr
 {

61 
public
:

65 
Di¥©chHªdËrSynchrÚiz”
();

76 
vœtu®
 
hªdË
(
Ev’tPŒ
 &
ev’tPŒ
);

90 
boŞ
 
wa™_fÜ_»¶y
(
Ev’tPŒ
 &
ev’tPŒ
);

92 
	g´iv©e
:

93 
¡d
::
queue
<
Ev’tPŒ
> 
m_»ûive_queue
;

94 
	gboo¡
::
mu‹x
 
m_mu‹x
;

95 
	gboo¡
::
cÚd™iÚ
 
m_cÚd
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/Event.cc

22 
	~<io¡»am
>

23 
usšg
 
Çme¥aû
 
	g¡d
;

26 
	~<sys/ty³s.h
>

27 
	~<sys/sock‘.h
>

28 
	~<Ãtš‘/š.h
>

29 
	~<¬·/š‘.h
>

32 
	~"CommÚ/E¼Ü.h
"

33 
	~"CommÚ/SŒšgExt.h
"

35 
	~"Ev’t.h
"

37 
Çme¥aû
 
Hy³¹abË
 {

39 
¡d
::
¡ršg
 
Ev’t
::
toSŒšg
() {

40 
¡ršg
 
d¡r
;

42 
d¡r
 = "Event:ype=";

43 ià(
ty³
 =ğ
CONNECTION_ESTABLISHED
)

44 
d¡r
 += "CONNECTION_ESTABLISHED";

45 ià(
ty³
 =ğ
DISCONNECT
)

46 
d¡r
 += "DISCONNECT";

47 ià(
ty³
 =ğ
MESSAGE
) {

48 
d¡r
 += "MESSAGE…rotocol=";

49 ià(
h—d”
->
´ÙocŞ
 < 
H—d”
::
PROTOCOL_MAX
)

50 
d¡r
 +ğ
H—d”
::
´ÙocŞSŒšgs
[
h—d”
->
´ÙocŞ
];

52 
d¡r
 += "unknown";

53 
d¡r
 +ğ(
¡d
::
¡ršg
)" id=" + ()
h—d”
->
id
;

54 
d¡r
 +ğ(
¡d
::
¡ršg
)" gid=" + ()
h—d”
->
gid
;

55 
d¡r
 +ğ(
¡d
::
¡ršg
)" h—d”L’=" + ()
h—d”
->
h—d”L’
;

56 
d¡r
 +ğ(
¡d
::
¡ršg
)"Ù®L’=" + ()
h—d”
->
tÙ®L’
;

58 ià(
ty³
 =ğ
TIMER
)

59 
d¡r
 += "TIMER";

60 ià(
ty³
 =ğ
ERROR
)

61 
d¡r
 += "ERROR";

63 
d¡r
 +ğ()
ty³
;

65 ià(
”rÜ
 !ğ
E¼Ü
::
OK
)

66 
d¡r
 +ğ(
¡d
::
¡ršg
)" \"" + 
E¼Ü
::
g‘_‹xt
(
”rÜ
) + "\"";

68 ià(
ty³
 !ğ
TIMER
) {

69 
d¡r
 += " from=";

70 
d¡r
 +ğ(
¡d
::
¡ršg
)
š‘_Áß
(
addr
.
sš_addr
è+ ":" + ()
Áohs
×ddr.
sš_pÜt
);

73  
d¡r
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/Event.h

21 #iâdeà
HYPERTABLE_EVENT_H


22 
	#HYPERTABLE_EVENT_H


	)

24 
	~<io¡»am
>

25 
	~<¡ršg
>

28 
	~<¡dšt.h
>

29 
	~<Ãtš‘/š.h
>

32 
	~"CommÚ/Reã»nûCouÁ.h
"

34 
usšg
 
Çme¥aû
 
¡d
;

36 
	~"H—d”.h
"

38 
Çme¥aû
 
	gHy³¹abË
 {

44 şas 
	cEv’t
 : 
public
 
Reã»nûCouÁ
 {

46 
public
:

48 
	eTy³
 { 
CONNECTION_ESTABLISHED
, 
	gDISCONNECT
, 
	gMESSAGE
, 
	gERROR
, 
	gTIMER
 };

65 
Ev’t
(
Ty³
 
ù
, 
cid
, 
sockaddr_š
 &
a
, 
”r
=0, 
H—d”
::
H—d”T
 *
h
=0)

66 : 
ty³
(
ù
), 
addr
(
a
), 
cÚnId
(
cid
), 
”rÜ
(
”r
), 
h—d”
(
h
) {

67 ià(
	gh
 != 0) {

68 
mes§ge
 = ((
ušt8_t
 *)
h—d”
è+ h—d”->
h—d”L’
;

69 
	gmes§geL’
 = 
h—d”
->
tÙ®L’
 - h—d”->
h—d”L’
;

70 ià(
	gh—d”
->
	ggid
 != 0)

71 
th»adGroup
 = ((
ušt64_t
)
cÚnId
 << 32è| 
h—d”
->
gid
;

73 
	gth»adGroup
 = 0;

76 
	gmes§ge
 = 0;

77 
	gmes§geL’
 = 0;

78 
	gth»adGroup
 = 0;

87 
Ev’t
(
Ty³
 
ù
, 
”r
=0è: 
ty³
(ù), 
”rÜ
(err) {

88 
	gh—d”
 = 0;

89 
	gmes§ge
 = 0;

90 
	gmes§geL’
 = 0;

91 
	gth»adGroup
 = 0;

92 
	gcÚnId
 = 0;

97 ~
Ev’t
() {

98 
	gd–‘e
 [] 
	gh—d”
;

104 
Ty³
 
	gty³
;

107 
sockaddr_š
 
	gaddr
;

110 
sockaddr_š
 
	gloÿlAddr
;

113 
	gcÚnId
;

118 
	g”rÜ
;

121 
	gH—d”
::
H—d”T
 *
h—d”
;

124 
ušt8_t
 *
	gmes§ge
;

127 
size_t
 
	gmes§geL’
;

137 
ušt64_t
 
	gth»adGroup
;

144 
	g¡d
::
¡ršg
 
toSŒšg
();

148 
di¥Ïy
(è{ 
	gû¼
 << 
toSŒšg
(è<< 
	g’dl
; }

151 
	gboo¡
::
	tšŒusive_±r
<
	tEv’t
> 
	tEv’tPŒ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/HandlerMap.h

21 #iâdeà
HYPERTABLE_HANDLERMAP_H


22 
	#HYPERTABLE_HANDLERMAP_H


	)

24 
	~<ÿs£¹
>

28 
	~<boo¡/th»ad/cÚd™iÚ.hµ
>

29 
	~<boo¡/th»ad/mu‹x.hµ
>

31 
	~"CommÚ/E¼Ü.h
"

32 
	~"CommÚ/IÃtAddr.h
"

33 
	~"CommÚ/Logg”.h
"

34 
	~"CommÚ/Reã»nûCouÁ.h
"

35 
	~"CommÚ/SockAddrM­.h
"

37 
	~"IOHªdËrD©a.h
"

38 
	~"IOHªdËrD©ag¿m.h
"

40 
Çme¥aû
 
	gHy³¹abË
 {

42 şas 
	cHªdËrM­
 : 
public
 
Reã»nûCouÁ
 {

44 
public
:

46 
š£¹_hªdËr
(
IOHªdËr
 *
hªdËr
) {

47 
boo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

48 
as£¹
(
m_hªdËr_m­
.
fšd
(
hªdËr
->
g‘_add»ss
()è=ğm_hªdËr_m­.
’d
());

49 
	gm_hªdËr_m­
[
hªdËr
->
g‘_add»ss
()] = handler;

52 
£t_®Ÿs
(
sockaddr_š
 &
addr
, sockaddr_š &
®Ÿs
) {

53 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

54 
	gSockAddrM­T
<
	gIOHªdËrPŒ
>::
™”©Ü
 
™”
;

56 ià(
	gm_hªdËr_m­
.
fšd
(
®Ÿs
è!ğ
m_hªdËr_m­
.
’d
())

57  
E¼Ü
::
COMM_CONFLICTING_ADDRESS
;

59 ià((
	g™”
 = 
m_hªdËr_m­
.
fšd
(
addr
)è=ğm_hªdËr_m­.
’d
())

60  
E¼Ü
::
COMM_NOT_CONNECTED
;

62 (*
	g™”
).
	g£cÚd
->
£t_®Ÿs
(
®Ÿs
);

63 
	gm_hªdËr_m­
[
®Ÿs
] = (*
™”
).
£cÚd
;

65  
	gE¼Ü
::
OK
;

68 
boŞ
 
cÚšs_hªdËr
(
sockaddr_š
 &
addr
) {

69 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

70  
lookup_hªdËr
(
addr
);

73 
boŞ
 
lookup_d©a_hªdËr
(
sockaddr_š
 &
addr
, 
IOHªdËrD©aPŒ
 &
ioHªdËrD©aPŒ
) {

74 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

75 
IOHªdËr
 *
	ghªdËr
 = 
lookup_hªdËr
(
addr
);

76 ià(
	ghªdËr
) {

77 
	gioHªdËrD©aPŒ
 = 
dyÇmic_ÿ¡
<
IOHªdËrD©a
 *>(
hªdËr
);

78 ià(
	gioHªdËrD©aPŒ
)

79  
	gŒue
;

81  
	gçl£
;

84 
š£¹_d©ag¿m_hªdËr
(
IOHªdËr
 *
hªdËr
) {

85 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

86 
as£¹
(
m_d©ag¿m_hªdËr_m­
.
fšd
(
hªdËr
->
g‘_loÿl_add»ss
()è=ğm_d©ag¿m_hªdËr_m­.
’d
());

87 
	gm_d©ag¿m_hªdËr_m­
[
hªdËr
->
g‘_loÿl_add»ss
()] = handler;

90 
boŞ
 
lookup_d©ag¿m_hªdËr
(
sockaddr_š
 &
addr
, 
IOHªdËrD©ag¿mPŒ
 &
ioHªdËrD©ag¿mPŒ
) {

91 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

92 
	gSockAddrM­T
<
	gIOHªdËrPŒ
>::
™”©Ü
 
™”
 = 
m_d©ag¿m_hªdËr_m­
.
fšd
(
addr
);

93 ià(
	g™”
 =ğ
m_hªdËr_m­
.
’d
())

94  
çl£
;

95 
	gioHªdËrD©ag¿mPŒ
 = (
IOHªdËrD©ag¿m
 *)(*
™”
).
£cÚd
.
g‘
();

96  
	gŒue
;

99 
boŞ
 
»move_hªdËr
(
sockaddr_š
 &
addr
, 
IOHªdËrPŒ
 &
hªdËrPŒ
) {

100 
	gSockAddrM­T
<
	gIOHªdËrPŒ
>::
™”©Ü
 
™”
;

101 ià((
	g™”
 = 
m_hªdËr_m­
.
fšd
(
addr
)è!ğm_hªdËr_m­.
’d
()) {

102 
hªdËrPŒ
 = (*
™”
).
£cÚd
;

103 
	gm_hªdËr_m­
.
”a£
(
™”
);

104 
sockaddr_š
 
	g®Ÿs
;

105 
	ghªdËrPŒ
->
g‘_®Ÿs
(&
®Ÿs
);

106 ià(
	g®Ÿs
.
	gsš_pÜt
 != 0) {

107 ià((
™”
 = 
m_hªdËr_m­
.
fšd
(
®Ÿs
)è!ğm_hªdËr_m­.
’d
())

108 
m_hªdËr_m­
.
”a£
(
™”
);

110 
	g¡d
::
¡ršg
 
”r_¡r
;

111 
HT_ERRORF
("UÇbËØfšd m­pšg fÜ‡lŸ (%sèš HªdËrM­", 
IÃtAddr
::
¡ršg_fÜm©
(
”r_¡r
, 
®Ÿs
));

115 ià((
	g™”
 = 
m_d©ag¿m_hªdËr_m­
.
fšd
(
addr
)è!ğm_d©ag¿m_hªdËr_m­.
’d
()) {

116 
hªdËrPŒ
 = (*
™”
).
£cÚd
;

117 
	gm_d©ag¿m_hªdËr_m­
.
”a£
(
™”
);

120  
	gçl£
;

121  
	gŒue
;

124 
boŞ
 
decomissiÚ_hªdËr
(
sockaddr_š
 &
addr
, 
IOHªdËrPŒ
 &
hªdËrPŒ
) {

125 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

127 ià(
»move_hªdËr
(
addr
, 
hªdËrPŒ
)) {

128 
	gm_decomissiÚed_hªdËrs
.
š£¹
(
hªdËrPŒ
);

129  
	gŒue
;

131  
	gçl£
;

134 
boŞ
 
decomissiÚ_hªdËr
(
sockaddr_š
 &
addr
) {

135 
IOHªdËrPŒ
 
	ghªdËrPŒ
;

136  
decomissiÚ_hªdËr
(
addr
, 
hªdËrPŒ
);

139 
purge_hªdËr
(
IOHªdËr
 *
hªdËr
) {

140 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

141 
IOHªdËrPŒ
 
	ghªdËrPŒ
 = 
hªdËr
;

142 
	gm_decomissiÚed_hªdËrs
.
”a£
(
hªdËrPŒ
);

143 ià(
	gm_decomissiÚed_hªdËrs
.
em±y
())

144 
	gm_cÚd
.
nÙify_®l
();

147 
decomissiÚ_®l
(
£t
<
IOHªdËr
 *> &
hªdËrs
) {

148 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

149 
	gSockAddrM­T
<
	gIOHªdËrPŒ
>::
™”©Ü
 
™”
;

152 
	g™”
 = 
m_hªdËr_m­
.
begš
(); i‹¸!ğm_hªdËr_m­.
’d
(); iter++) {

153 
	gm_decomissiÚed_hªdËrs
.
š£¹
((*
™”
).
£cÚd
);

154 
	ghªdËrs
.
š£¹
((*
™”
).
£cÚd
.
g‘
());

156 
	gm_hªdËr_m­
.
ş—r
();

159 
	g™”
 = 
m_d©ag¿m_hªdËr_m­
.
begš
(); i‹¸!ğm_d©ag¿m_hªdËr_m­.
’d
(); iter++) {

160 
	gm_decomissiÚed_hªdËrs
.
š£¹
((*
™”
).
£cÚd
);

161 
	ghªdËrs
.
š£¹
((*
™”
).
£cÚd
.
g‘
());

163 
	gm_d©ag¿m_hªdËr_m­
.
ş—r
();

166 
wa™_fÜ_em±y
() {

167 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

168 ià(!
	gm_decomissiÚed_hªdËrs
.
em±y
())

169 
	gm_cÚd
.
wa™
(
lock
);

172 
	g´iv©e
:

174 
IOHªdËr
 *
lookup_hªdËr
(
sockaddr_š
 &
addr
) {

175 
SockAddrM­T
<
IOHªdËrPŒ
>::
™”©Ü
 
™”
 = 
m_hªdËr_m­
.
fšd
(
addr
);

176 ià(
	g™”
 =ğ
m_hªdËr_m­
.
’d
())

178  (*
	g™”
).
	g£cÚd
.
g‘
();

181 
	gboo¡
::
mu‹x
 
m_mu‹x
;

182 
	gboo¡
::
cÚd™iÚ
 
m_cÚd
;

183 
	gSockAddrM­T
<
	gIOHªdËrPŒ
> 
	gm_hªdËr_m­
;

184 
	gSockAddrM­T
<
	gIOHªdËrPŒ
> 
	gm_d©ag¿m_hªdËr_m­
;

185 
	g£t
<
	gIOHªdËrPŒ
, 
	gÉiohp
> 
	gm_decomissiÚed_hªdËrs
;

187 
	gboo¡
::
	tšŒusive_±r
<
	tHªdËrM­
> 
	tHªdËrM­PŒ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/Header.cc

21 
	~"H—d”.h
"

23 
Çme¥aû
 
	gHy³¹abË
 {

24 cÚ¡ *
	gH—d”
::
´ÙocŞSŒšgs
[
PROTOCOL_MAX
] = {

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/Header.h

21 #iâdeà
HYPERTABLE_HEADER_H


22 
	#HYPERTABLE_HEADER_H


	)

25 
	~<¡dšt.h
>

28 
Çme¥aû
 
Hy³¹abË
 {

30 şas 
	cH—d”
 {

32 
public
:

34 cÚ¡ 
ušt8_t
 
VERSION
 = 1;

36 cÚ¡ 
ušt8_t
 
PROTOCOL_NONE
 = 0;

37 cÚ¡ 
ušt8_t
 
PROTOCOL_DFSBROKER
 = 1;

38 cÚ¡ 
ušt8_t
 
PROTOCOL_HYPERSPACE
 = 2;

39 cÚ¡ 
ušt8_t
 
PROTOCOL_HYPERTABLE_MASTER
 = 3;

40 cÚ¡ 
ušt8_t
 
PROTOCOL_HYPERTABLE_RANGESERVER
 = 4;

41 cÚ¡ 
ušt8_t
 
PROTOCOL_MAX
 = 5;

43 cÚ¡ 
ušt8_t
 
FLAGS_BIT_REQUEST
 = 0x01;

44 cÚ¡ 
ušt8_t
 
FLAGS_BIT_IGNORE_RESPONSE
 = 0x02;

46 cÚ¡ 
ušt8_t
 
FLAGS_MASK_REQUEST
 = 0xFE;

47 cÚ¡ 
ušt8_t
 
FLAGS_MASK_IGNORE_RESPONSE
 = 0xFD;

49 cÚ¡ *
´ÙocŞSŒšgs
[
PROTOCOL_MAX
];

52 
ušt8_t
 
v”siÚ
;

53 
ušt8_t
 
´ÙocŞ
;

54 
ušt8_t
 
æags
;

55 
ušt8_t
 
h—d”L’
;

56 
ušt32_t
 
id
;

57 
ušt32_t
 
gid
;

58 
ušt32_t
 
tÙ®L’
;

59 } 
	t__©Œibu‹__
((
	t·cked
)è
	tH—d”T
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/HeaderBuilder.cc

21 
	~"H—d”Bud”.h
"

23 
Çme¥aû
 
	gHy³¹abË
 {

25 
	gH—d”Bud”
::
’code
(
ušt8_t
 **
bufPŒ
) {

26 
H—d”
::
H—d”T
 *
mh—d”
;

27 
	gmh—d”
 = (
H—d”
::
H—d”T
 *)*
bufPŒ
;

28 
	gmh—d”
->
	gv”siÚ
 = 
H—d”
::
VERSION
;

29 
	gmh—d”
->
	g´ÙocŞ
 = 
m_´ÙocŞ
;

30 
	gmh—d”
->
	gæags
 = 
m_æags
;

31 
	gmh—d”
->
	gh—d”L’
 = (
H—d”
::
H—d”T
);

32 
	gmh—d”
->
	gid
 = 
m_id
;

33 
	gmh—d”
->
	ggid
 = 
m_group_id
;

34 
	gmh—d”
->
	gtÙ®L’
 = 
m_tÙ®_Ën
;

35 (*
	gbufPŒ
è+ğ(
H—d”
::
H—d”T
);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/HeaderBuilder.h

21 #iâdeà
HYPERTABLE_HEADERBUILDER_H


22 
	#HYPERTABLE_HEADERBUILDER_H


	)

24 
	~<io¡»am
>

25 
usšg
 
Çme¥aû
 
	g¡d
;

28 
	~<¡dšt.h
>

31 
	~"CommÚ/©omic.h
"

33 
	~"H—d”.h
"

35 
Çme¥aû
 
Hy³¹abË
 {

47 şas 
	cH—d”Bud”
 {

49 
public
:

53 
H—d”Bud”
(è: 
m_id
(0), 
m_group_id
(0), 
m_tÙ®_Ën
(0), 
m_´ÙocŞ
(0), 
m_æags
(0) {

66 
H—d”Bud”
(
ušt8_t
 
´ÙocŞ
, 
ušt32_t
 
gid
=0è: 
m_id
(0), 
m_group_id
(gid), 
m_tÙ®_Ën
(0), 
m_´ÙocŞ
ÕrÙocŞ), 
m_æags
(0) {

75 
š™Ÿlize_äom_»que¡
(
H—d”
::
H—d”T
 *
h—d”
) {

76 
m_id
 = 
h—d”
->
id
;

77 
m_group_id
 = 
h—d”
->
gid
;

78 
m_´ÙocŞ
 = 
h—d”
->
´ÙocŞ
;

79 
m_æags
 = 
h—d”
->
æags
;

80 
m_tÙ®_Ën
 = 0;

84 
size_t
 
h—d”_Ëngth
(è{  (
H—d”
::
H—d”T
); }

91 
’code
(
ušt8_t
 **
bufPŒ
);

99 
£t_æags
(
ušt8_t
 
æags
è{ 
m_æags
 = flags; }

105 
add_æag
(
ušt8_t
 
æags
è{ 
m_æags
 |= flags; }

111 
£t_´ÙocŞ
(
ušt8_t
 
´ÙocŞ
è{ 
m_´ÙocŞ
 =…rotocol; }

117 
£t_group_id
(
ušt32_t
 
group_id
è{ 
m_group_id
 = group_id; }

123 
£t_tÙ®_Ën
(
ušt32_t
 
tÙ®_Ën
è{ 
m_tÙ®_Ën
 =otal_len; }

125 
´Ùeùed
:

126 
ušt32_t
 
m_id
;

127 
ušt32_t
 
m_group_id
;

128 
ušt32_t
 
m_tÙ®_Ën
;

129 
ušt8_t
 
m_´ÙocŞ
;

130 
ušt8_t
 
m_æags
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/IOHandler.cc

22 
	~<c¡dio
>

23 
	~<io¡»am
>

24 
usšg
 
Çme¥aû
 
	g¡d
;

27 
	~<”ºo.h
>

28 #ià
defšed
(
__APPLE__
)

29 
	~<sys/ev’t.h
>

33 
	~"CommÚ/Logg”.h
"

35 
	~"IOHªdËr.h
"

36 
	~"R—ùÜ.h
"

37 
usšg
 
Çme¥aû
 
Hy³¹abË
;

39 #ià
defšed
(
__lšux__
)

41 
	gIOHªdËr
::
	$add_pŞl_š‹»¡
(
mode
) {

42 
•Şl_ev’t
 
ev’t
;

44 
m_pŞl_š‹»¡
 |ğ
mode
;

46 
	`mem£t
(&
ev’t
, 0, (
•Şl_ev’t
));

47 
ev’t
.
d©a
.
±r
 = 
this
;

48 
ev’t
.
ev’ts
 = 
EPOLLERR
 | 
EPOLLHUP
;

50 ià(
m_pŞl_š‹»¡
 & 
R—ùÜ
::
READ_READY
)

51 
ev’t
.
ev’ts
 |ğ
EPOLLIN
;

52 ià(
m_pŞl_š‹»¡
 & 
R—ùÜ
::
WRITE_READY
)

53 
ev’t
.
ev’ts
 |ğ
EPOLLOUT
;

55 ià(
	`•Şl_ùl
(
m_»aùÜ_±r
->
pŞlFd
, 
EPOLL_CTL_MOD
, 
m_sd
, &
ev’t
) < 0) {

62 
	}
}

66 
	gIOHªdËr
::
	$»move_pŞl_š‹»¡
(
mode
) {

67 
•Şl_ev’t
 
ev’t
;

69 
m_pŞl_š‹»¡
 &ğ~
mode
;

71 
	`mem£t
(&
ev’t
, 0, (
•Şl_ev’t
));

72 
ev’t
.
d©a
.
±r
 = 
this
;

73 
ev’t
.
ev’ts
 = 
EPOLLERR
 | 
EPOLLHUP
;

75 ià(
m_pŞl_š‹»¡
 & 
R—ùÜ
::
READ_READY
)

76 
ev’t
.
ev’ts
 |ğ
EPOLLIN
;

77 ià(
m_pŞl_š‹»¡
 & 
R—ùÜ
::
WRITE_READY
)

78 
ev’t
.
ev’ts
 |ğ
EPOLLOUT
;

80 ià(
	`•Şl_ùl
(
m_»aùÜ_±r
->
pŞlFd
, 
EPOLL_CTL_MOD
, 
m_sd
, &
ev’t
) < 0) {

81 
	`HT_ERRORF
("•Şl_ùl(EPOLL_CTL_MOD, sd=%dè(mode=%xè: %s", 
m_sd
, 
mode
, 
	`¡»¼Ü
(
”ºo
));

82 
	`ex™
(1);

84 
	}
}

88 
	gIOHªdËr
::
	$di¥Ïy_ev’t
(
•Şl_ev’t
 *
ev’t
) {

89 
buf
[128];

91 
buf
[0] = 0;

92 ià(
ev’t
->
ev’ts
 & 
EPOLLIN
)

93 
	`¡rÿt
(
buf
, "EPOLLIN ");

94 ià(
ev’t
->
ev’ts
 & 
EPOLLOUT
)

95 
	`¡rÿt
(
buf
, "EPOLLOUT ");

96 ià(
ev’t
->
ev’ts
 & 
EPOLLPRI
)

97 
	`¡rÿt
(
buf
, "EPOLLPRI ");

98 ià(
ev’t
->
ev’ts
 & 
EPOLLERR
)

99 
	`¡rÿt
(
buf
, "EPOLLERR ");

100 ià(
ev’t
->
ev’ts
 & 
EPOLLHUP
)

101 
	`¡rÿt
(
buf
, "EPOLLHUP ");

102 ià(
ev’t
->
ev’ts
 & 
EPOLLET
)

103 
	`¡rÿt
(
buf
, "EPOLLET ");

104 ià(
ev’t
->
ev’ts
 & 
EPOLLONESHOT
)

105 
	`¡rÿt
(
buf
, "EPOLLONESHOT ");

107 ià(
buf
[0] == 0)

108 
	`¥rštf
(
buf
, "0x%x ", 
ev’t
->
ev’ts
);

110 
şog
 << "•ŞÈev’t ğ" << 
buf
 << 
’dl
;

113 
	}
}

117 #–ià
defšed
(
__APPLE__
)

119 
	gIOHªdËr
::
	$add_pŞl_š‹»¡
(
mode
) {

120 
kev’t
 
ev’ts
[2];

121 
couÁ
=0;

122 ià(
mode
 & 
R—ùÜ
::
READ_READY
) {

123 
	`EV_SET
(&
ev’ts
[
couÁ
], 
m_sd
, 
EVFILT_READ
, 
EV_ADD
 | 
EV_ENABLE
, 0, 0, 
this
);

124 
couÁ
++;

126 ià(
mode
 & 
R—ùÜ
::
WRITE_READY
) {

127 
	`EV_SET
(&
ev’ts
[
couÁ
], 
m_sd
, 
EVFILT_WRITE
, 
EV_ADD
 | 
EV_ENABLE
, 0, 0, 
this
);

128 
couÁ
++;

130 
	`as£¹
(
couÁ
 > 0);

132 ià(
	`kev’t
(
m_»aùÜ_±r
->
kQueue
, 
ev’ts
, 
couÁ
, 0, 0, 0) == -1) {

133 
	`HT_ERRORF
("kev’t(sd=%dè(mode=%xè: %s", 
m_sd
, 
mode
, 
	`¡»¼Ü
(
”ºo
));

134 
	`ex™
(1);

136 
m_pŞl_š‹»¡
 |ğ
mode
;

137 
	}
}

139 
	gIOHªdËr
::
	$»move_pŞl_š‹»¡
(
mode
) {

140 
kev’t
 
dev’ts
[2];

141 
couÁ
 = 0;

143 ià(
mode
 & 
R—ùÜ
::
READ_READY
) {

144 
	`EV_SET
(&
dev’ts
[
couÁ
], 
m_sd
, 
EVFILT_READ
, 
EV_DELETE
, 0, 0, 0);

145 
couÁ
++;

148 ià(
mode
 & 
R—ùÜ
::
WRITE_READY
) {

149 
	`EV_SET
(&
dev’ts
[
couÁ
], 
m_sd
, 
EVFILT_WRITE
, 
EV_DELETE
, 0, 0, 0);

150 
couÁ
++;

153 ià(
	`kev’t
(
m_»aùÜ_±r
->
kQueue
, 
dev’ts
, 
couÁ
, 0, 0, 0è=ğ-1 && 
”ºo
 !ğ
ENOENT
) {

154 
	`HT_ERRORF
("kev’t(sd=%dè(mode=%xè: %s", 
m_sd
, 
mode
, 
	`¡»¼Ü
(
”ºo
));

155 
	`ex™
(1);

157 
	}
}

163 
	gIOHªdËr
::
	$di¥Ïy_ev’t
(
kev’t
 *
ev’t
) {

165 
şog
 << "kev’t: id’t=" << 
hex
 << ()
ev’t
->
id’t
;

167 
ev’t
->
f‹r
) {

168 
EVFILT_READ
:

169 
şog
 << ", EVFILT_READ, fflags=";

170 ià(
ev’t
->
fæags
 & 
NOTE_LOWAT
)

171 
şog
 << "NOTE_LOWAT";

173 
şog
 << 
ev’t
->
fæags
;

175 
EVFILT_WRITE
:

176 
şog
 << ", EVFILT_WRITE, fflags=";

177 ià(
ev’t
->
fæags
 & 
NOTE_LOWAT
)

178 
şog
 << "NOTE_LOWAT";

180 
şog
 << 
ev’t
->
fæags
;

182 
EVFILT_AIO
:

183 
şog
 << ", EVFILT_AIO, fæags=" << 
ev’t
->
fæags
;

185 
EVFILT_VNODE
:

186 
şog
 << ", EVFILT_VNODE, fflags={";

187 ià(
ev’t
->
fæags
 & 
NOTE_DELETE
)

188 
şog
 << " NOTE_DELETE";

189 ià(
ev’t
->
fæags
 & 
NOTE_WRITE
)

190 
şog
 << " NOTE_WRITE";

191 ià(
ev’t
->
fæags
 & 
NOTE_EXTEND
)

192 
şog
 << " NOTE_EXTEND";

193 ià(
ev’t
->
fæags
 & 
NOTE_ATTRIB
)

194 
şog
 << " NOTE_ATTRIB";

195 ià(
ev’t
->
fæags
 & 
NOTE_LINK
)

196 
şog
 << " NOTE_LINK";

197 ià(
ev’t
->
fæags
 & 
NOTE_RENAME
)

198 
şog
 << " NOTE_RENAME";

199 ià(
ev’t
->
fæags
 & 
NOTE_REVOKE
)

200 
şog
 << " NOTE_REVOKE";

201 
şog
 << " }";

203 
EVFILT_PROC
:

204 
şog
 << ", EVFILT_VNODE, fflags={";

205 ià(
ev’t
->
fæags
 & 
NOTE_EXIT
)

206 
şog
 << " NOTE_EXIT";

207 ià(
ev’t
->
fæags
 & 
NOTE_FORK
)

208 
şog
 << " NOTE_FORK";

209 ià(
ev’t
->
fæags
 & 
NOTE_EXEC
)

210 
şog
 << " NOTE_EXEC";

211 ià(
ev’t
->
fæags
 & 
NOTE_TRACK
)

212 
şog
 << " NOTE_TRACK";

213 ià(
ev’t
->
fæags
 & 
NOTE_TRACKERR
)

214 
şog
 << " NOTE_TRACKERR";

215 ià(
ev’t
->
fæags
 & 
NOTE_CHILD
)

216 
şog
 << " NOTE_CHILD";

217 
şog
 << "…id=" << (
ev’t
->
æags
 & 
NOTE_PDATAMASK
);

219 
EVFILT_SIGNAL
:

220 
şog
 << ", EVFILT_SIGNAL, fæags=" << 
ev’t
->
fæags
;

222 
EVFILT_TIMER
:

223 
şog
 << ", EVFILT_TIMER, fflags={";

224 ià(
ev’t
->
fæags
 & 
NOTE_SECONDS
)

225 
şog
 << " NOTE_SECONDS";

226 ià(
ev’t
->
fæags
 & 
NOTE_USECONDS
)

227 
şog
 << " NOTE_USECONDS";

228 ià(
ev’t
->
fæags
 & 
NOTE_NSECONDS
)

229 
şog
 << " NOTE_NSECONDS";

230 ià(
ev’t
->
fæags
 & 
NOTE_ABSOLUTE
)

231 
şog
 << " NOTE_ABSOLUTE";

232 
şog
 << " }";

236 if(
ev’t
->
æags
 != 0) {

237 
şog
 << ", flags=";

238 ià((
ev’t
->
æags
 & 
EV_EOF
è|| (ev’t->æag & 
EV_ERROR
)) {

239 
şog
 << "{";

240 ià(
ev’t
->
æags
 & 
EV_EOF
)

241 
şog
 << " EV_EOF";

242 ià(
ev’t
->
æags
 & 
EV_ERROR
)

243 
şog
 << " EV_ERROR";

244 
şog
 << "}";

247 
şog
 << 
hex
 << 
ev’t
->
æags
;

249 
şog
 << ", d©a=" << 
dec
 << ()
ev’t
->
d©a
 << 
’dl
;

250 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/IOHandler.h

22 #iâdeà
HYPERTABLE_IOHANDLER_H


23 
	#HYPERTABLE_IOHANDLER_H


	)

26 
	~<”ºo.h
>

27 
	~<sys/ty³s.h
>

28 
	~<sys/time.h
>

29 #ià
defšed
(
__APPLE__
)

30 
	~<sys/ev’t.h
>

32 #ià
defšed
(
__lšux__
)

33 
	~<sys/•Şl.h
>

37 
	~"CommÚ/Logg”.h
"

38 
	~"CommÚ/Reã»nûCouÁ.h
"

40 
	~"Di¥©chHªdËr.h
"

41 
	~"R—ùÜFaùÜy.h
"

42 
	~"Tim”.h
"

44 
Çme¥aû
 
Hy³¹abË
 {

49 şas 
	cIOHªdËr
 : 
public
 
Reã»nûCouÁ
 {

51 
public
:

53 
IOHªdËr
(
sd
, 
sockaddr_š
 &
addr
, 
Di¥©chHªdËrPŒ
 &
dhp
è: 
m_addr
×ddr), 
m_sd
(sd), 
m_di¥©ch_hªdËr_±r
(dhp) {

54 
R—ùÜFaùÜy
::
g‘_»aùÜ
(
m_»aùÜ_±r
);

55 
m_pŞl_š‹»¡
 = 0;

56 
sockËn_t
 
Çm–’
 = (
m_loÿl_addr
);

57 
g‘sockÇme
(
m_sd
, (
sockaddr
 *)&
m_loÿl_addr
, &
Çm–’
);

58 
mem£t
(&
m_®Ÿs
, 0, (m_alias));

61 #ià
defšed
(
__APPLE__
)

62 
vœtu®
 
boŞ
 
hªdË_ev’t
(
kev’t
 *
ev’t
) = 0;

63 #–ià
defšed
(
__lšux__
)

64 
vœtu®
 
boŞ
 
hªdË_ev’t
(
•Şl_ev’t
 *
ev’t
) = 0;

66 
Im¶em’tMe
;

69 
vœtu®
 ~
IOHªdËr
() { ; }

71 
d–iv”_ev’t
(
Ev’t
 *
ev’t
) {

72 
memıy
(&
ev’t
->
loÿlAddr
, &
m_loÿl_addr
, (m_local_addr));

73 ià(!
m_di¥©ch_hªdËr_±r
) {

74 
HT_INFOF
("%s", 
ev’t
->
toSŒšg
().
c_¡r
());

75 
d–‘e
 
ev’t
;

78 
Ev’tPŒ
 
ev’tPŒ
(
ev’t
);

79 
m_di¥©ch_hªdËr_±r
->
hªdË
(
ev’tPŒ
);

83 
d–iv”_ev’t
(
Ev’t
 *
ev’t
, 
Di¥©chHªdËr
 *
dh
) {

84 
memıy
(&
ev’t
->
loÿlAddr
, &
m_loÿl_addr
, (m_local_addr));

85 ià(!
dh
) {

86 ià(!
m_di¥©ch_hªdËr_±r
) {

87 
HT_INFOF
("%s", 
ev’t
->
toSŒšg
().
c_¡r
());

88 
d–‘e
 
ev’t
;

91 
Ev’tPŒ
 
ev’tPŒ
(
ev’t
);

92 
m_di¥©ch_hªdËr_±r
->
hªdË
(
ev’tPŒ
);

96 
Ev’tPŒ
 
ev’tPŒ
(
ev’t
);

97 
dh
->
hªdË
(
ev’tPŒ
);

101 
¡¬t_pŞlšg
() {

102 #ià
defšed
(
__APPLE__
)

103 
add_pŞl_š‹»¡
(
R—ùÜ
::
READ_READY
);

104 #–ià
defšed
(
__lšux__
)

105 
•Şl_ev’t
 
ev’t
;

106 
mem£t
(&
ev’t
, 0, (
•Şl_ev’t
));

107 
ev’t
.
d©a
.
±r
 = 
this
;

108 
ev’t
.
ev’ts
 = 
EPOLLIN
 | 
EPOLLERR
 | 
EPOLLHUP
;

109 ià(
•Şl_ùl
(
m_»aùÜ_±r
->
pŞlFd
, 
EPOLL_CTL_ADD
, 
m_sd
, &
ev’t
) < 0) {

110 
HT_ERRORF
("epoll_ctl(%d, EPOLL_CTL_ADD, %d, EPOLLIN|EPOLLERR|EPOLLHUP) failed : %s",

111 
m_»aùÜ_±r
->
pŞlFd
, 
m_sd
, 
¡»¼Ü
(
”ºo
));

112 
ex™
(1);

114 
m_pŞl_š‹»¡
 |ğ
R—ùÜ
::
READ_READY
;

118 
add_pŞl_š‹»¡
(
mode
);

120 
»move_pŞl_š‹»¡
(
mode
);

122 
sockaddr_š
 &
g‘_add»ss
(è{  
m_addr
; }

124 
sockaddr_š
 &
g‘_loÿl_add»ss
(è{  
m_loÿl_addr
; }

126 
g‘_loÿl_add»ss
(
sockaddr_š
 *
addrPŒ
) {

127 
memıy
(
addrPŒ
, &
m_loÿl_addr
, (
sockaddr_š
));

130 
£t_®Ÿs
(
sockaddr_š
 &
®Ÿs
) {

131 
memıy
(&
m_®Ÿs
, &
®Ÿs
, (m_alias));

134 
g‘_®Ÿs
(
sockaddr_š
 *
®Ÿ¥
) {

135 
memıy
(
®Ÿ¥
, &
m_®Ÿs
, (m_alias));

138 
g‘_sd
(è{  
m_sd
; }

140 
g‘_»aùÜ
(
R—ùÜPŒ
 &
»aùÜ_±r
è{„—ùÜ_±¸ğ
m_»aùÜ_±r
; }

142 
shutdown
() {

143 
Tim”T
 
tim”
;

144 
m_»aùÜ_±r
->
scheduË_»mov®
(
this
);

145 
boo¡
::
xtime_g‘
(&
tim”
.
expœeTime
, boo¡::
TIME_UTC
);

146 
tim”
.
expœeTime
.
n£c
 += 200000000LL;

147 
tim”
.
hªdËr
 = 0;

148 
m_»aùÜ_±r
->
add_tim”
(
tim”
);

151 
´Ùeùed
:

153 
¡İ_pŞlšg
() {

154 #ià
defšed
(
__APPLE__
)

155 
»move_pŞl_š‹»¡
(
R—ùÜ
::
READ_READY
|R—ùÜ::
WRITE_READY
);

156 #–ià
defšed
(
__lšux__
)

157 
•Şl_ev’t
 
ev’t
;

158 ià(
•Şl_ùl
(
m_»aùÜ_±r
->
pŞlFd
, 
EPOLL_CTL_DEL
, 
m_sd
, &
ev’t
) < 0) {

159 
HT_ERRORF
("epoll_ctl(%d, EPOLL_CTL_DEL, %d) failed : %s",

160 
m_»aùÜ_±r
->
pŞlFd
, 
m_sd
, 
¡»¼Ü
(
”ºo
));

161 
ex™
(1);

163 
m_pŞl_š‹»¡
 = 0;

167 
sockaddr_š
 
m_addr
;

168 
sockaddr_š
 
m_loÿl_addr
;

169 
sockaddr_š
 
m_®Ÿs
;

170 
m_sd
;

171 
Di¥©chHªdËrPŒ
 
m_di¥©ch_hªdËr_±r
;

172 
R—ùÜPŒ
 
m_»aùÜ_±r
;

173 
m_pŞl_š‹»¡
;

175 #ià
defšed
(
__APPLE__
)

176 
di¥Ïy_ev’t
(
kev’t
 *
ev’t
);

177 #–ià
defšed
(
__lšux__
)

178 
di¥Ïy_ev’t
(
•Şl_ev’t
 *
ev’t
);

181 
boo¡
::
	tšŒusive_±r
<
	tIOHªdËr
> 
	tIOHªdËrPŒ
;

183 
	sÉiohp
 {

184 
boŞ
 
İ”©Ü
()(cÚ¡ 
IOHªdËrPŒ
 &
p1
, cÚ¡ IOHªdËrPŒ &
p2
) const {

185  
p1
.
g‘
(è< 
p2
.get();

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/IOHandlerAccept.cc

21 
	~<io¡»am
>

22 
usšg
 
Çme¥aû
 
	g¡d
;

25 
	~<”ºo.h
>

26 
	~<Ãtš‘/tı.h
>

29 
	#DISABLE_LOG_DEBUG
 1

	)

31 
	~"CommÚ/E¼Ü.h
"

32 
	~"CommÚ/FeUts.h
"

33 
	~"CommÚ/Logg”.h
"

35 
	~"HªdËrM­.h
"

36 
	~"IOHªdËrAcû±.h
"

37 
	~"IOHªdËrD©a.h
"

38 
	~"R—ùÜFaùÜy.h
"

39 
usšg
 
Çme¥aû
 
Hy³¹abË
;

45 #ià
defšed
(
__APPLE__
)

46 
boŞ
 
	gIOHªdËrAcû±
::
	$hªdË_ev’t
(
kev’t
 *
ev’t
) {

48 ià(
ev’t
->
f‹r
 =ğ
EVFILT_READ
)

49  
	`hªdË_šcomšg_cÚÃùiÚ
();

50  
Œue
;

51 
	}
}

52 #–ià
defšed
(
__lšux__
)

53 
boŞ
 
	gIOHªdËrAcû±
::
	$hªdË_ev’t
(
•Şl_ev’t
 *
ev’t
) {

55  
	`hªdË_šcomšg_cÚÃùiÚ
();

56 
	}
}

58 
	gIm¶em’tMe
;

63 
boŞ
 
	gIOHªdËrAcû±
::
	$hªdË_šcomšg_cÚÃùiÚ
() {

64 
sd
;

65 
sockaddr_š
 
addr
;

66 
sockËn_t
 
addrL’
 = (
sockaddr_š
);

67 
Úe
 = 1;

68 
IOHªdËrD©a
 *
d©aHªdËr
;

70 ià((
sd
 = 
	`acû±
(
m_sd
, (
sockaddr
 *)&
addr
, &
addrL’
)) < 0) {

71 
	`HT_ERRORF
("acû±(èçu»: %s", 
	`¡»¼Ü
(
”ºo
));

72  
çl£
;

75 
	`HT_DEBUGF
("Ju¡‡cû±ed incomšg cÚÃùiÚ, fd=%d (%s:%d)", 
m_sd
, 
	`š‘_Áß
(
addr
.
sš_addr
), 
	`Áohs
×ddr.
sš_pÜt
));

78 
FeUts
::
	`£t_æags
(
sd
, 
O_NONBLOCK
);

80 #ià
	`defšed
(
__lšux__
)

81 ià(
	`£tsockİt
(
sd
, 
SOL_TCP
, 
TCP_NODELAY
, &
Úe
, (one)) < 0)

82 
	`HT_WARNF
("£tsockİt(TCP_NODELAYèçu»: %s", 
	`¡»¼Ü
(
”ºo
));

83 #–ià
	`defšed
(
__APPLE__
)

84 ià(
	`£tsockİt
(
sd
, 
SOL_SOCKET
, 
SO_NOSIGPIPE
, &
Úe
, (one)) < 0)

85 
	`HT_WARNF
("£tsockİt(SO_NOSIGPIPEèçu»: %s", 
	`¡»¼Ü
(
”ºo
));

88 
bufsize
 = 4*32768;

90 ià(
	`£tsockİt
(
sd
, 
SOL_SOCKET
, 
SO_SNDBUF
, (*)&
bufsize
, (bufsize)) < 0) {

91 
	`HT_WARNF
("£tsockİt(SO_SNDBUFèçed - %s", 
	`¡»¼Ü
(
”ºo
));

93 ià(
	`£tsockİt
(
sd
, 
SOL_SOCKET
, 
SO_RCVBUF
, (*)&
bufsize
, (bufsize)) < 0) {

94 
	`HT_WARNF
("£tsockİt(SO_RCVBUFèçed - %s", 
	`¡»¼Ü
(
”ºo
));

97 
Di¥©chHªdËrPŒ
 
dhp
;

98 
m_hªdËr_çùÜy_±r
->
	`g‘_š¡ªû
(
dhp
);

100 
d©aHªdËr
 = 
Ãw
 
	`IOHªdËrD©a
(
sd
, 
addr
, 
dhp
);

102 
IOHªdËrPŒ
 
	`hªdËrPŒ
Ğ
d©aHªdËr
 );

103 
m_hªdËr_m­_±r
->
	`š£¹_hªdËr
(
d©aHªdËr
);

104 
d©aHªdËr
->
	`¡¬t_pŞlšg
();

106 
	`d–iv”_ev’t
Ğ
Ãw
 
	`Ev’t
(
Ev’t
::
CONNECTION_ESTABLISHED
, 
d©aHªdËr
->
	`cÚÃùiÚ_id
(), 
addr
, 
E¼Ü
::
OK
) );

108  
çl£
;

109 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/IOHandlerAccept.h

22 #iâdeà
HYPERTABLE_IOHANDLERACCEPT_H


23 
	#HYPERTABLE_IOHANDLERACCEPT_H


	)

25 
	~"HªdËrM­.h
"

26 
	~"IOHªdËr.h
"

27 
	~"CÚÃùiÚHªdËrFaùÜy.h
"

30 
	~<¡dšt.h
>

33 
Çme¥aû
 
Hy³¹abË
 {

38 şas 
	cIOHªdËrAcû±
 : 
public
 
IOHªdËr
 {

40 
public
:

42 
IOHªdËrAcû±
(
sd
, 
sockaddr_š
 &
addr
, 
Di¥©chHªdËrPŒ
 &
dhp
, 
HªdËrM­PŒ
 &
hªdËr_m­_±r
, 
CÚÃùiÚHªdËrFaùÜyPŒ
 &
chfPŒ
è: 
IOHªdËr
(sd,‡ddr, dhp), 
m_hªdËr_m­_±r
(hªdËr_m­_±r), 
m_hªdËr_çùÜy_±r
(chfPtr) {

46 
vœtu®
 ~
IOHªdËrAcû±
() {

50 #ià
defšed
(
__APPLE__
)

51 
vœtu®
 
boŞ
 
hªdË_ev’t
(
kev’t
 *
ev’t
);

52 #–ià
defšed
(
__lšux__
)

53 
vœtu®
 
boŞ
 
hªdË_ev’t
(
•Şl_ev’t
 *
ev’t
);

55 
Im¶em’tMe
;

58 
boŞ
 
hªdË_šcomšg_cÚÃùiÚ
();

60 
´iv©e
:

61 
HªdËrM­PŒ
 
m_hªdËr_m­_±r
;

62 
CÚÃùiÚHªdËrFaùÜyPŒ
 
m_hªdËr_çùÜy_±r
;

65 
boo¡
::
	tšŒusive_±r
<
	tIOHªdËrAcû±
> 
	tIOHªdËrAcû±PŒ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/IOHandlerData.cc

22 
	~<ÿs£¹
>

23 
	~<io¡»am
>

24 
usšg
 
Çme¥aû
 
	g¡d
;

27 
	~<¬·/š‘.h
>

28 
	~<”ºo.h
>

29 
	~<Ãtš‘/š.h
>

30 
	~<sys/sock‘.h
>

31 
	~<sys/ty³s.h
>

32 #ià
defšed
(
__APPLE__
)

33 
	~<sys/ev’t.h
>

37 
	#DISABLE_LOG_DEBUG
 1

	)

39 
	~"CommÚ/E¼Ü.h
"

40 
	~"CommÚ/FeUts.h
"

41 
	~"CommÚ/IÃtAddr.h
"

43 
	~"IOHªdËrD©a.h
"

44 
usšg
 
Çme¥aû
 
Hy³¹abË
;

46 
©omic_t
 
	gIOHªdËrD©a
::
ms_Ãxt_cÚÃùiÚ_id
 = 
ATOMIC_INIT
(1);

48 #ià
defšed
(
__lšux__
)

50 
boŞ
 
	gIOHªdËrD©a
::
	$hªdË_ev’t
(
•Şl_ev’t
 *
ev’t
) {

54 ià(
ev’t
->
ev’ts
 & 
EPOLLOUT
) {

55 ià(
	`hªdË_wr™e_»adšess
()) {

56 
	`d–iv”_ev’t
Ğ
Ãw
 
	`Ev’t
(
Ev’t
::
DISCONNECT
, 
m_id
, 
m_addr
, 
E¼Ü
::
OK
) );

57  
Œue
;

61 ià(
ev’t
->
ev’ts
 & 
EPOLLIN
) {

62 
size_t
 
Ä—d
, 
tÙ®R—d
 = 0;

63 
Œue
) {

64 ià(!
m_gÙ_h—d”
) {

65 
ušt8_t
 *
±r
 = ((ušt8_ˆ*)&
m_mes§ge_h—d”
è+ ((
H—d”
::
H—d”T
è- 
m_mes§ge_h—d”_»maššg
);

66 
Ä—d
 = 
FeUts
::
	`»ad
(
m_sd
, 
±r
, 
m_mes§ge_h—d”_»maššg
);

67 ià(
Ä—d
 =ğ(
size_t
)-1) {

68 ià(
”ºo
 !ğ
ECONNREFUSED
) {

69 
	`HT_ERRORF
("FeUts::»ad(%d,†’=%dèçu» : %s", 
m_sd
, 
m_mes§ge_h—d”_»maššg
, 
	`¡»¼Ü
(
”ºo
));

71 
”rÜ
 = (
”ºo
 =ğ
ECONNREFUSED
è? 
E¼Ü
::
COMM_CONNECT_ERROR
 : E¼Ü::
OK
;

72 
	`d–iv”_ev’t
Ğ
Ãw
 
	`Ev’t
(
Ev’t
::
DISCONNECT
, 
m_id
, 
m_addr
, 
”rÜ
 ) );

73  
Œue
;

75 ià(
Ä—d
 =ğ0 && 
tÙ®R—d
 == 0) {

77 
	`d–iv”_ev’t
Ğ
Ãw
 
	`Ev’t
(
Ev’t
::
DISCONNECT
, 
m_id
, 
m_addr
, 
E¼Ü
::
OK
) );

78  
Œue
;

80 ià(
Ä—d
 < 
m_mes§ge_h—d”_»maššg
) {

81 
m_mes§ge_h—d”_»maššg
 -ğ
Ä—d
;

82  
çl£
;

85 
m_gÙ_h—d”
 = 
Œue
;

86 
m_mes§ge_h—d”_»maššg
 = 0;

87 
m_mes§ge
 = 
Ãw
 
ušt8_t
 [ 
m_mes§ge_h—d”
.
tÙ®L’
 ];

88 
	`memıy
(
m_mes§ge
, &
m_mes§ge_h—d”
, (
H—d”
::
H—d”T
));

89 
m_mes§ge_±r
 = 
m_mes§ge
 + (
H—d”
::
H—d”T
);

90 
m_mes§ge_»maššg
 = (
m_mes§ge_h—d”
.
tÙ®L’
è- (
H—d”
::
H—d”T
);

91 
tÙ®R—d
 +ğ
Ä—d
;

94 ià(
m_gÙ_h—d”
) {

95 
Ä—d
 = 
FeUts
::
	`»ad
(
m_sd
, 
m_mes§ge_±r
, 
m_mes§ge_»maššg
);

96 ià(
Ä—d
 < 0) {

97 
	`HT_ERRORF
("FeUts::»ad(%d,†’=%dèçu» : %s", 
m_sd
, 
m_mes§ge_h—d”_»maššg
, 
	`¡»¼Ü
(
”ºo
));

98 
	`d–iv”_ev’t
Ğ
Ãw
 
	`Ev’t
(
Ev’t
::
DISCONNECT
, 
m_id
, 
m_addr
, 
E¼Ü
::
OK
) );

99  
Œue
;

101 ià(
Ä—d
 =ğ0 && 
tÙ®R—d
 == 0) {

103 
	`d–iv”_ev’t
Ğ
Ãw
 
	`Ev’t
(
Ev’t
::
DISCONNECT
, 
m_id
, 
m_addr
, 
E¼Ü
::
OK
) );

104  
Œue
;

106 ià(
Ä—d
 < 
m_mes§ge_»maššg
) {

107 
m_mes§ge_±r
 +ğ
Ä—d
;

108 
m_mes§ge_»maššg
 -ğ
Ä—d
;

111 
Di¥©chHªdËr
 *
dh
 = 0;

112 
ušt32_t
 
id
 = ((
H—d”
::
H—d”T
 *)
m_mes§ge
)->id;

113 ià(
id
 != 0 &&

114 (((
H—d”
::
H—d”T
 *)
m_mes§ge
)->
æags
 & H—d”::
FLAGS_BIT_REQUEST
) == 0 &&

115 (
dh
 = 
m_»aùÜ_±r
->
	`»move_»que¡
(
id
)) == 0) {

116 ià((((
H—d”
::
H—d”T
 *)
m_mes§ge
)->
æags
 & H—d”::
FLAGS_BIT_IGNORE_RESPONSE
) == 0) {

117 
	`HT_WARNF
("Received„esponse for‚on-pendingƒvent (id=%d,version=%d,totalLen=%d)",

118 
id
, ((
H—d”
::
H—d”T
 *)
m_mes§ge
)->
v”siÚ
, ((H—d”::H—d”T *)m_mes§ge)->
tÙ®L’
);

120 
d–‘e
 [] 
m_mes§ge
;

123 
	`d–iv”_ev’t
Ğ
Ãw
 
	`Ev’t
(
Ev’t
::
MESSAGE
, 
m_id
, 
m_addr
, 
E¼Ü
::
OK
, (
H—d”
::
H—d”T
 *)
m_mes§ge
), 
dh
 );

124 
	`»£t_šcomšg_mes§ge_¡©e
();

126 
tÙ®R—d
 +ğ
Ä—d
;

131 ià(
ev’t
->
ev’ts
 & 
EPOLLERR
) {

132 
	`HT_WARNF
("Reûived EPOLLERR oÀdesütÜ %d (%s:%d)", 
m_sd
, 
	`š‘_Áß
(
m_addr
.
sš_addr
), 
	`Áohs
(m_addr.
sš_pÜt
));

133 
	`d–iv”_ev’t
Ğ
Ãw
 
	`Ev’t
(
Ev’t
::
DISCONNECT
, 
m_id
, 
m_addr
, 
E¼Ü
::
OK
) );

134  
Œue
;

137 ià(
ev’t
->
ev’ts
 & 
EPOLLHUP
) {

138 
	`HT_WARNF
("Reûived EPOLLHUP oÀdesütÜ %d (%s:%d)", 
m_sd
, 
	`š‘_Áß
(
m_addr
.
sš_addr
), 
	`Áohs
(m_addr.
sš_pÜt
));

139 
	`d–iv”_ev’t
Ğ
Ãw
 
	`Ev’t
(
Ev’t
::
DISCONNECT
, 
m_id
, 
m_addr
, 
E¼Ü
::
OK
) );

140  
Œue
;

143  
çl£
;

144 
	}
}

146 #–ià
defšed
(
__APPLE__
)

151 
boŞ
 
	gIOHªdËrD©a
::
	$hªdË_ev’t
(
kev’t
 *
ev’t
) {

155 
	`as£¹
(
m_sd
 =ğ()
ev’t
->
id’t
);

157 ià(
ev’t
->
æags
 & 
EV_EOF
) {

158 ià(!
m_cÚÃùed
)

159 
	`d–iv”_ev’t
Ğ
Ãw
 
	`Ev’t
(
Ev’t
::
DISCONNECT
, 
m_id
, 
m_addr
, 
E¼Ü
::
COMM_CONNECT_ERROR
) );

161 
	`d–iv”_ev’t
Ğ
Ãw
 
	`Ev’t
(
Ev’t
::
DISCONNECT
, 
m_id
, 
m_addr
, 
E¼Ü
::
OK
) );

162  
Œue
;

165 ià(
ev’t
->
f‹r
 =ğ
EVFILT_WRITE
) {

166 ià(
	`hªdË_wr™e_»adšess
()) {

167 
	`d–iv”_ev’t
Ğ
Ãw
 
	`Ev’t
(
Ev’t
::
DISCONNECT
, 
m_id
, 
m_addr
, 
E¼Ü
::
OK
) );

168  
Œue
;

172 ià(
ev’t
->
f‹r
 =ğ
EVFILT_READ
) {

173 
size_t
 
avaabË
 = (size_t)
ev’t
->
d©a
;

174 
size_t
 
Ä—d
;

175 
avaabË
 > 0) {

176 ià(!
m_gÙ_h—d”
) {

177 
ušt8_t
 *
±r
 = ((ušt8_ˆ*)&
m_mes§ge_h—d”
è+ ((
H—d”
::
H—d”T
è- 
m_mes§ge_h—d”_»maššg
);

178 ià(
m_mes§ge_h—d”_»maššg
 < 
avaabË
) {

179 
Ä—d
 = 
FeUts
::
	`»ad
(
m_sd
, 
±r
, 
m_mes§ge_h—d”_»maššg
);

180 ià(
Ä—d
 < 0) {

181 
	`HT_ERRORF
("FeUts::»ad(%d,†’=%dèçu» : %s", 
m_sd
, 
m_mes§ge_h—d”_»maššg
, 
	`¡»¼Ü
(
”ºo
));

182 
	`d–iv”_ev’t
Ğ
Ãw
 
	`Ev’t
(
Ev’t
::
DISCONNECT
, 
m_id
, 
m_addr
, 
E¼Ü
::
OK
) );

183  
Œue
;

185 
	`as£¹
(
Ä—d
 =ğ
m_mes§ge_h—d”_»maššg
);

186 
m_gÙ_h—d”
 = 
Œue
;

187 
avaabË
 -ğ
Ä—d
;

188 
m_mes§ge_h—d”_»maššg
 = 0;

189 
m_mes§ge
 = 
Ãw
 
ušt8_t
 [ 
m_mes§ge_h—d”
.
tÙ®L’
 ];

190 
	`memıy
(
m_mes§ge
, &
m_mes§ge_h—d”
, (
H—d”
::
H—d”T
));

191 
m_mes§ge_±r
 = 
m_mes§ge
 + (
H—d”
::
H—d”T
);

192 
m_mes§ge_»maššg
 = (
m_mes§ge_h—d”
.
tÙ®L’
è- (
H—d”
::
H—d”T
);

195 
Ä—d
 = 
FeUts
::
	`»ad
(
m_sd
, 
±r
, 
avaabË
);

196 ià(
Ä—d
 < 0) {

197 
	`HT_ERRORF
("FeUts::»ad(%d,†’=%dèçu» : %s", 
m_sd
, 
avaabË
, 
	`¡»¼Ü
(
”ºo
));

198 
	`d–iv”_ev’t
Ğ
Ãw
 
	`Ev’t
(
Ev’t
::
DISCONNECT
, 
m_id
, 
m_addr
, 
E¼Ü
::
OK
) );

199  
Œue
;

201 
	`as£¹
(
Ä—d
 =ğ
avaabË
);

202 
m_mes§ge_h—d”_»maššg
 -ğ
Ä—d
;

203  
çl£
;

206 ià(
m_gÙ_h—d”
) {

207 ià(
m_mes§ge_»maššg
 <ğ
avaabË
) {

208 
Ä—d
 = 
FeUts
::
	`»ad
(
m_sd
, 
m_mes§ge_±r
, 
m_mes§ge_»maššg
);

209 ià(
Ä—d
 < 0) {

210 
	`HT_ERRORF
("FeUts::»ad(%d,†’=%dèçu» : %s", 
m_sd
, 
m_mes§ge_»maššg
, 
	`¡»¼Ü
(
”ºo
));

211 
	`d–iv”_ev’t
Ğ
Ãw
 
	`Ev’t
(
Ev’t
::
DISCONNECT
, 
m_id
, 
m_addr
, 
E¼Ü
::
OK
) );

212  
Œue
;

214 
	`as£¹
(
Ä—d
 =ğ
m_mes§ge_»maššg
);

215 
avaabË
 -ğ
Ä—d
;

217 
Di¥©chHªdËr
 *
dh
 = 0;

218 
ušt32_t
 
id
 = ((
H—d”
::
H—d”T
 *)
m_mes§ge
)->id;

219 ià(
id
 != 0 &&

220 (((
H—d”
::
H—d”T
 *)
m_mes§ge
)->
æags
 & H—d”::
FLAGS_BIT_REQUEST
) == 0 &&

221 (
dh
 = 
m_»aùÜ_±r
->
	`»move_»que¡
(
id
)) == 0) {

222 ià((((
H—d”
::
H—d”T
 *)
m_mes§ge
)->
æags
 & H—d”::
FLAGS_BIT_IGNORE_RESPONSE
) == 0) {

223 
	`HT_WARNF
("Reûived„e¥Ú£ fÜ‚Ú-³ndšgƒv’ˆ(id=%d)", 
id
);

225 
d–‘e
 [] 
m_mes§ge
;

228 
	`d–iv”_ev’t
Ğ
Ãw
 
	`Ev’t
(
Ev’t
::
MESSAGE
, 
m_id
, 
m_addr
, 
E¼Ü
::
OK
, (
H—d”
::
H—d”T
 *)
m_mes§ge
), 
dh
 );

229 
	`»£t_šcomšg_mes§ge_¡©e
();

232 
Ä—d
 = 
FeUts
::
	`»ad
(
m_sd
, 
m_mes§ge_±r
, 
avaabË
);

233 ià(
Ä—d
 < 0) {

234 
	`HT_ERRORF
("FeUts::»ad(%d,†’=%dèçu» : %s", 
m_sd
, 
avaabË
, 
	`¡»¼Ü
(
”ºo
));

235 
	`d–iv”_ev’t
Ğ
Ãw
 
	`Ev’t
(
Ev’t
::
DISCONNECT
, 
m_id
, 
m_addr
, 
E¼Ü
::
OK
) );

236  
Œue
;

238 
	`as£¹
(
Ä—d
 =ğ
avaabË
);

239 
m_mes§ge_±r
 +ğ
Ä—d
;

240 
m_mes§ge_»maššg
 -ğ
Ä—d
;

241 
avaabË
 = 0;

247  
çl£
;

248 
	}
}

250 
	gIm¶em’tMe
;

254 
boŞ
 
	gIOHªdËrD©a
::
	$hªdË_wr™e_»adšess
() {

256 ià(
m_cÚÃùed
 =ğ
çl£
) {

257 
sockËn_t
 
ÇmeL’
 = (
m_loÿl_addr
);

259 
bufsize
 = 4*32768;

260 ià(
	`£tsockİt
(
m_sd
, 
SOL_SOCKET
, 
SO_SNDBUF
, (*)&
bufsize
, (bufsize)) < 0) {

261 
	`HT_ERRORF
("£tsockİt(SO_SNDBUFèçed - %s", 
	`¡»¼Ü
(
”ºo
));

263 ià(
	`£tsockİt
(
m_sd
, 
SOL_SOCKET
, 
SO_RCVBUF
, (*)&
bufsize
, (bufsize)) < 0) {

264 
	`HT_ERRORF
("£tsockİt(SO_RCVBUFèçed - %s", 
	`¡»¼Ü
(
”ºo
));

267 ià(
	`g‘sockÇme
(
m_sd
, (
sockaddr
 *)&
m_loÿl_addr
, &
ÇmeL’
) < 0) {

268 
	`HT_ERRORF
("g‘sockÇme(%dèçed - %s", 
m_sd
, 
	`¡»¼Ü
(
”ºo
));

269 
	`ex™
(1);

272 
m_cÚÃùed
 = 
Œue
;

273 
	`d–iv”_ev’t
Ğ
Ãw
 
	`Ev’t
(
Ev’t
::
CONNECTION_ESTABLISHED
, 
m_id
, 
m_addr
, 
E¼Ü
::
OK
) );

276 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

277 ià(
	`æush_£nd_queue
(è!ğ
E¼Ü
::
OK
)

278  
Œue
;

279 ià(
m_£nd_queue
.
	`em±y
())

280 
	`»move_pŞl_š‹»¡
(
R—ùÜ
::
WRITE_READY
);

282  
çl£
;

283 
	}
}

287 
	gIOHªdËrD©a
::
	$£nd_mes§ge
(
CommBufPŒ
 &
cbufPŒ
, 
time_t
 
timeout
, 
Di¥©chHªdËr
 *
di¥©chHªdËr
) {

288 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

289 
”rÜ
;

290 
boŞ
 
š™ŸÎyEm±y
 = 
m_£nd_queue
.
	`em±y
(è? 
Œue
 : 
çl£
;

291 
H—d”
::
H—d”T
 *
mh—d”
 = (H—d”::H—d”T *)
cbufPŒ
->
d©a
;

293 
HT_LOG_ENTER
;

296 ià(
mh—d”
->
id
 !ğ0 && 
di¥©chHªdËr
 !ğ0 && mh—d”->
æags
 & 
H—d”
::
FLAGS_BIT_REQUEST
) {

297 
boo¡
::
xtime
 
expœeTime
;

298 
boo¡
::
	`xtime_g‘
(&
expœeTime
, boo¡::
TIME_UTC
);

299 
expœeTime
.
£c
 +ğ
timeout
;

300 
m_»aùÜ_±r
->
	`add_»que¡
(
mh—d”
->
id
, 
this
, 
di¥©chHªdËr
, 
expœeTime
);

303 
m_£nd_queue
.
	`push_back
(
cbufPŒ
);

305 ià((
”rÜ
 = 
	`æush_£nd_queue
()è!ğ
E¼Ü
::
OK
)

306  
”rÜ
;

308 ià(
š™ŸÎyEm±y
 && !
m_£nd_queue
.
	`em±y
()) {

309 
	`add_pŞl_š‹»¡
(
R—ùÜ
::
WRITE_READY
);

312 ià(!
š™ŸÎyEm±y
 && 
m_£nd_queue
.
	`em±y
()) {

313 
	`»move_pŞl_š‹»¡
(
R—ùÜ
::
WRITE_READY
);

317  
E¼Ü
::
OK
;

318 
	}
}

322 
	gIOHªdËrD©a
::
	$æush_£nd_queue
() {

323 
ssize_t
 
nwr™‹n
, 
towr™e
;

324 
iovec
 
vec
[2];

325 
couÁ
;

327 !
m_£nd_queue
.
	`em±y
()) {

329 
CommBufPŒ
 &
cbufPŒ
 = 
m_£nd_queue
.
	`äÚt
();

331 
couÁ
 = 0;

332 
towr™e
 = 0;

333 ià(
cbufPŒ
->
d©aL’
 > 0) {

334 
vec
[0].
iov_ba£
 = (*)
cbufPŒ
->
d©a
;

335 
vec
[0].
iov_Ën
 = 
cbufPŒ
->
d©aL’
;

336 
towr™e
 = 
cbufPŒ
->
d©aL’
;

337 ++
couÁ
;

339 ià(
cbufPŒ
->
ext
 != 0) {

340 
ssize_t
 
»maššg
 = 
cbufPŒ
->
extL’
 - (cbufPŒ->
extPŒ
 - cbufPŒ->
ext
);

341 ià(
»maššg
 > 0) {

342 
vec
[
couÁ
].
iov_ba£
 = (*)
cbufPŒ
->
extPŒ
;

343 
vec
[
couÁ
].
iov_Ën
 = 
»maššg
;

344 
towr™e
 +ğ
»maššg
;

345 ++
couÁ
;

349 
nwr™‹n
 = 
FeUts
::
	`wr™ev
(
m_sd
, 
vec
, 
couÁ
);

350 ià(
nwr™‹n
 =ğ(
ssize_t
)-1) {

351 
	`HT_WARNF
("FeUts::wr™ev(%d,†’=%dèçed : %s", 
m_sd
, 
towr™e
, 
	`¡»¼Ü
(
”ºo
));

352  
E¼Ü
::
COMM_BROKEN_CONNECTION
;

354 ià(
nwr™‹n
 < 
towr™e
) {

355 ià(
nwr™‹n
 == 0)

357 ià(
cbufPŒ
->
d©aL’
 > 0) {

358 ià(
nwr™‹n
 < (
ssize_t
)
cbufPŒ
->
d©aL’
) {

359 
cbufPŒ
->
d©aL’
 -ğ
nwr™‹n
;

360 
cbufPŒ
->
d©a
 +ğ
nwr™‹n
;

364 
nwr™‹n
 -ğ
cbufPŒ
->
d©aL’
;

365 
cbufPŒ
->
d©aL’
 = 0;

368 ià(
cbufPŒ
->
ext
 != 0) {

369 
cbufPŒ
->
extPŒ
 +ğ
nwr™‹n
;

375 
m_£nd_queue
.
	`pİ_äÚt
();

378  
E¼Ü
::
OK
;

379 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/IOHandlerData.h

21 #iâdeà
HYPERTABLE_IOHANDLERDATA_H


22 
	#HYPERTABLE_IOHANDLERDATA_H


	)

24 
	~<li¡
>

27 
	~<Ãtdb.h
>

28 
	~<¡dšt.h
>

29 
	~<¡ršg.h
>

30 
	~<time.h
>

33 
	~"CommÚ/©omic.h
"

35 
	~"CommBuf.h
"

36 
	~"IOHªdËr.h
"

37 
	~"Reque¡Cache.h
"

39 
usšg
 
Çme¥aû
 
¡d
;

42 
Çme¥aû
 
	gHy³¹abË
 {

46 şas 
	cIOHªdËrD©a
 : 
public
 
IOHªdËr
 {

48 
public
:

50 
IOHªdËrD©a
(
sd
, 
sockaddr_š
 &
addr
, 
Di¥©chHªdËrPŒ
 &
dhp
)

51 : 
IOHªdËr
(
sd
, 
addr
, 
dhp
), 
m_»que¡_ÿche
(), 
m_£nd_queue
() {

52 
	gm_cÚÃùed
 = 
çl£
;

53 
»£t_šcomšg_mes§ge_¡©e
();

54 
	gm_id
 = 
©omic_šc_»tuº
(&
ms_Ãxt_cÚÃùiÚ_id
);

57 
»£t_šcomšg_mes§ge_¡©e
() {

58 
	gm_gÙ_h—d”
 = 
çl£
;

59 
	gm_mes§ge_h—d”_»maššg
 = (
H—d”
::
H—d”T
);

60 
	gm_mes§ge
 = 0;

61 
	gm_mes§ge_±r
 = 0;

62 
	gm_mes§ge_»maššg
 = 0;

65 
£nd_mes§ge
(
CommBufPŒ
 &
cbufPŒ
, 
time_t
 
timeout
=0, 
Di¥©chHªdËr
 *
di¥©chHªdËr
=0);

67 
æush_£nd_queue
();

69 #ià
defšed
(
__APPLE__
)

70 
vœtu®
 
boŞ
 
hªdË_ev’t
(
kev’t
 *
ev’t
);

71 #–ià
defšed
(
__lšux__
)

72 
vœtu®
 
boŞ
 
hªdË_ev’t
(
•Şl_ev’t
 *
ev’t
);

74 
	gIm¶em’tMe
;

77 
boŞ
 
hªdË_wr™e_»adšess
();

79 
cÚÃùiÚ_id
(è{  
	gm_id
; }

81 
	g´iv©e
:

83 
©omic_t
 
ms_Ãxt_cÚÃùiÚ_id
;

85 
boŞ
 
	gm_cÚÃùed
;

86 
	gboo¡
::
mu‹x
 
m_mu‹x
;

87 
	gH—d”
::
H—d”T
 
m_mes§ge_h—d”
;

88 
size_t
 
	gm_mes§ge_h—d”_»maššg
;

89 
boŞ
 
	gm_gÙ_h—d”
;

90 
ušt8_t
 *
	gm_mes§ge
;

91 
ušt8_t
 *
	gm_mes§ge_±r
;

92 
size_t
 
	gm_mes§ge_»maššg
;

93 
Reque¡Cache
 
	gm_»que¡_ÿche
;

94 
	gli¡
<
	gCommBufPŒ
> 
	gm_£nd_queue
;

95 
	gm_id
;

98 
	gboo¡
::
	tšŒusive_±r
<
	tIOHªdËrD©a
> 
	tIOHªdËrD©aPŒ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/IOHandlerDatagram.cc

22 
	~<ÿs£¹
>

23 
	~<io¡»am
>

24 
usšg
 
Çme¥aû
 
	g¡d
;

27 
	~<¬·/š‘.h
>

28 
	~<”ºo.h
>

29 
	~<Ãtš‘/š.h
>

30 
	~<sys/sock‘.h
>

31 
	~<sys/ty³s.h
>

32 #ià
defšed
(
__APPLE__
)

33 
	~<sys/ev’t.h
>

37 
	#DISABLE_LOG_DEBUG
 1

	)

39 
	~"CommÚ/E¼Ü.h
"

40 
	~"CommÚ/FeUts.h
"

42 
	~"IOHªdËrD©ag¿m.h
"

43 
	~"HªdËrM­.h
"

44 
usšg
 
Çme¥aû
 
Hy³¹abË
;

46 #ià
defšed
(
__lšux__
)

48 
boŞ
 
	gIOHªdËrD©ag¿m
::
	$hªdË_ev’t
(
•Şl_ev’t
 *
ev’t
) {

49 
”rÜ
;

53 ià(
ev’t
->
ev’ts
 & 
EPOLLOUT
) {

54 ià((
”rÜ
 = 
	`hªdË_wr™e_»adšess
()è!ğ
E¼Ü
::
OK
) {

55 
	`d–iv”_ev’t
Ğ
Ãw
 
	`Ev’t
(
Ev’t
::
ERROR
, 0, 
m_addr
, 
”rÜ
) );

56  
Œue
;

60 ià(
ev’t
->
ev’ts
 & 
EPOLLIN
) {

61 
ssize_t
 
Ä—d
;

62 
ušt8_t
 *
rmsg
;

63 
sockaddr_š
 
addr
;

64 
sockËn_t
 
äomËn
 = (
sockaddr_š
);

66 ià((
Ä—d
 = 
FeUts
::
	`»cväom
(
m_sd
, 
m_mes§ge
, 65536, (
sockaddr
 *)&
addr
, &
äomËn
)è=ğ(
ssize_t
)-1) {

67 
	`HT_ERRORF
("FeUts::»cväom(%dèçu» : %s", 
m_sd
, 
	`¡»¼Ü
(
”ºo
));

68 
	`d–iv”_ev’t
Ğ
Ãw
 
	`Ev’t
(
Ev’t
::
ERROR
, 
m_sd
, 
addr
, 
E¼Ü
::
COMM_RECEIVE_ERROR
) );

69  
Œue
;

72 
rmsg
 = 
Ãw
 
ušt8_t
 [ 
Ä—d
 ];

73 
	`memıy
(
rmsg
, 
m_mes§ge
, 
Ä—d
);

75 
	`d–iv”_ev’t
Ğ
Ãw
 
	`Ev’t
(
Ev’t
::
MESSAGE
, 0, 
addr
, 
E¼Ü
::
OK
, (
H—d”
::
H—d”T
 *)
rmsg
) );

77  
çl£
;

80 ià(
ev’t
->
ev’ts
 & 
EPOLLERR
) {

81 
	`HT_WARNF
("Reûived EPOLLERR oÀdesütÜ %d (%s:%d)", 
m_sd
, 
	`š‘_Áß
(
m_addr
.
sš_addr
), 
	`Áohs
(m_addr.
sš_pÜt
));

82 
	`d–iv”_ev’t
Ğ
Ãw
 
	`Ev’t
(
Ev’t
::
ERROR
, 0, 
m_addr
, 
E¼Ü
::
COMM_POLL_ERROR
) );

83  
Œue
;

86  
çl£
;

87 
	}
}

89 #–ià
defšed
(
__APPLE__
)

94 
boŞ
 
	gIOHªdËrD©ag¿m
::
	$hªdË_ev’t
(
kev’t
 *
ev’t
) {

95 
”rÜ
;

99 
	`as£¹
(
m_sd
 =ğ()
ev’t
->
id’t
);

101 
	`as£¹
((
ev’t
->
æags
 & 
EV_EOF
) == 0);

103 ià(
ev’t
->
f‹r
 =ğ
EVFILT_WRITE
) {

104 ià((
”rÜ
 = 
	`hªdË_wr™e_»adšess
()è!ğ
E¼Ü
::
OK
) {

105 
	`d–iv”_ev’t
Ğ
Ãw
 
	`Ev’t
(
Ev’t
::
ERROR
, 0, 
m_addr
, 
”rÜ
) );

106  
Œue
;

110 ià(
ev’t
->
f‹r
 =ğ
EVFILT_READ
) {

111 
size_t
 
avaabË
 = (size_t)
ev’t
->
d©a
;

112 
ssize_t
 
Ä—d
;

113 
ušt8_t
 *
rmsg
;

114 
sockaddr_š
 
addr
;

115 
sockËn_t
 
äomËn
 = (
sockaddr_š
);

117 ià((
Ä—d
 = 
FeUts
::
	`»cväom
(
m_sd
, 
m_mes§ge
, 65536, (
sockaddr
 *)&
addr
, &
äomËn
)è=ğ(
ssize_t
)-1) {

118 
	`HT_ERRORF
("FeUts::»cväom(%d,†’=%dèçu» : %s", 
m_sd
, 
avaabË
, 
	`¡»¼Ü
(
”ºo
));

119 
	`d–iv”_ev’t
Ğ
Ãw
 
	`Ev’t
(
Ev’t
::
ERROR
, 
m_sd
, 
addr
, 
E¼Ü
::
COMM_RECEIVE_ERROR
) );

120  
Œue
;

123 
rmsg
 = 
Ãw
 
ušt8_t
 [ 
Ä—d
 ];

124 
	`memıy
(
rmsg
, 
m_mes§ge
, 
Ä—d
);

126 
	`d–iv”_ev’t
Ğ
Ãw
 
	`Ev’t
(
Ev’t
::
MESSAGE
, 0, 
addr
, 
E¼Ü
::
OK
, (
H—d”
::
H—d”T
 *)
rmsg
) );

128  
çl£
;

131  
çl£
;

133 
	}
}

135 
	gIm¶em’tMe
;

139 
	gIOHªdËrD©ag¿m
::
	$hªdË_wr™e_»adšess
() {

140 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

141 
”rÜ
;

143 ià((
”rÜ
 = 
	`æush_£nd_queue
()è!ğ
E¼Ü
::
OK
)

144  
”rÜ
;

147 ià(
m_£nd_queue
.
	`em±y
())

148 
	`»move_pŞl_š‹»¡
(
R—ùÜ
::
WRITE_READY
);

150  
E¼Ü
::
OK
;

151 
	}
}

155 
	gIOHªdËrD©ag¿m
::
	$£nd_mes§ge
(
sockaddr_š
 &
addr
, 
CommBufPŒ
 &
cbufPŒ
) {

156 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

157 
”rÜ
;

158 
boŞ
 
š™ŸÎyEm±y
 = 
m_£nd_queue
.
	`em±y
(è? 
Œue
 : 
çl£
;

160 
HT_LOG_ENTER
;

165 
m_£nd_queue
.
	`push_back
(
	`S’dRecT
(
addr
, 
cbufPŒ
));

167 ià((
”rÜ
 = 
	`æush_£nd_queue
()è!ğ
E¼Ü
::
OK
)

168  
”rÜ
;

170 ià(
š™ŸÎyEm±y
 && !
m_£nd_queue
.
	`em±y
()) {

171 
	`add_pŞl_š‹»¡
(
R—ùÜ
::
WRITE_READY
);

174 ià(!
š™ŸÎyEm±y
 && 
m_£nd_queue
.
	`em±y
()) {

175 
	`»move_pŞl_š‹»¡
(
R—ùÜ
::
WRITE_READY
);

179  
E¼Ü
::
OK
;

180 
	}
}

184 
	gIOHªdËrD©ag¿m
::
	$æush_£nd_queue
() {

185 
ssize_t
 
n£Á
;

187 !
m_£nd_queue
.
	`em±y
()) {

189 
S’dRecT
 &
£ndRec
 = 
m_£nd_queue
.
	`äÚt
();

191 
	`as£¹
(
£ndRec
.
£cÚd
->
d©aL’
 > 0);

192 
	`as£¹
(
£ndRec
.
£cÚd
->
ext
 == 0);

194 
n£Á
 = 
FeUts
::
	`£ndto
(
m_sd
, 
£ndRec
.
£cÚd
->
d©a
, s’dRec.£cÚd->
d©aL’
,

195 (cÚ¡ 
sockaddr
*)&
£ndRec
.
fœ¡
, (
sockaddr_š
));

197 ià(
n£Á
 =ğ(
ssize_t
)-1) {

198 
	`HT_WARNF
("FeUts::£ndto(%d,†’=%d,‡ddr=%s:%dèçed : %s", 
m_sd
, 
£ndRec
.
£cÚd
->
d©aL’
,

199 
	`š‘_Áß
(
£ndRec
.
fœ¡
.
sš_addr
), 
	`Áohs
(£ndRec.fœ¡.
sš_pÜt
), 
	`¡»¼Ü
(
”ºo
));

200  
E¼Ü
::
COMM_SEND_ERROR
;

202 ià(
n£Á
 < (
ssize_t
)
£ndRec
.
£cÚd
->
d©aL’
) {

203 
	`HT_WARNF
("OÆy s’ˆ%d by‹s", 
n£Á
);

204 ià(
n£Á
 == 0)

206 
£ndRec
.
£cÚd
->
d©aL’
 -ğ
n£Á
;

207 
£ndRec
.
£cÚd
->
d©a
 +ğ
n£Á
;

214 
m_£nd_queue
.
	`pİ_äÚt
();

217  
E¼Ü
::
OK
;

218 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/IOHandlerDatagram.h

21 #iâdeà
HYPERTABLE_IOHANDLERDATAGRAM_H


22 
	#HYPERTABLE_IOHANDLERDATAGRAM_H


	)

24 
	~<li¡
>

25 
	~<ut™y
>

28 
	~<Ãtdb.h
>

29 
	~<¡dšt.h
>

30 
	~<¡ršg.h
>

31 
	~<time.h
>

34 
	~"CommBuf.h
"

35 
	~"IOHªdËr.h
"

37 
usšg
 
Çme¥aû
 
¡d
;

39 
Çme¥aû
 
	gHy³¹abË
 {

43 şas 
	cIOHªdËrD©ag¿m
 : 
public
 
IOHªdËr
 {

45 
public
:

47 
IOHªdËrD©ag¿m
(
sd
, 
sockaddr_š
 &
addr
, 
Di¥©chHªdËrPŒ
 &
dhp
è: 
IOHªdËr
(sd,‡ddr, dhp), 
m_£nd_queue
() {

48 
	gm_mes§ge
 = 
Ãw
 
ušt8_t
 [ 65536 ];

51 
	gvœtu®
 ~
IOHªdËrD©ag¿m
(è{ 
	gd–‘e
 [] 
	gm_mes§ge
; }

53 
£nd_mes§ge
(
sockaddr_š
 &
addr
, 
CommBufPŒ
 &
cbufPŒ
);

55 
æush_£nd_queue
();

57 #ià
defšed
(
__APPLE__
)

58 
vœtu®
 
boŞ
 
hªdË_ev’t
(
kev’t
 *
ev’t
);

59 #–ià
defšed
(
__lšux__
)

60 
vœtu®
 
boŞ
 
hªdË_ev’t
(
•Şl_ev’t
 *
ev’t
);

62 
	gIm¶em’tMe
;

65 
hªdË_wr™e_»adšess
();

67 
	g´iv©e
:

69 
¡d
::
	t·œ
<
	tsockaddr_š
, 
	tCommBufPŒ
> 
	tS’dRecT
;

71 
	gboo¡
::
mu‹x
 
m_mu‹x
;

72 
ušt8_t
 *
	gm_mes§ge
;

73 
	gli¡
<
	gS’dRecT
> 
	gm_£nd_queue
;

76 
	gboo¡
::
	tšŒusive_±r
<
	tIOHªdËrD©ag¿m
> 
	tIOHªdËrD©ag¿mPŒ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/PollTimeout.h

20 #iâdeà
HYPERTABLE_POLLTIMEOUT_H


21 
	#HYPERTABLE_POLLTIMEOUT_H


	)

24 
	~<io¡»am
>

26 
	~<boo¡/th»ad/xtime.hµ
>

28 
	~<ÿs£¹
>

30 
Çme¥aû
 
	gHy³¹abË
 {

32 şas 
	cPŞlTimeout
 {

34 
	gpublic
:

36 
PŞlTimeout
(è: 
ts_±r
(0), 
du¿tiÚ_mlis
(-1) { ; }

38 
£t
(
boo¡
::
xtime
 &
now
, boo¡::xtim&
expœe
) {

39 
as£¹
((
xtime_cmp
(
now
 , 
expœe
) <= 0));

40 ià(
	gnow
.
	g£c
 =ğ
expœe
.
£c
) {

41 
du¿tiÚ_ts
.
tv_£c
 = 0;

42 
	gdu¿tiÚ_ts
.
	gtv_n£c
 = 
expœe
.
n£c
 - 
now
.nsec;

45 
ušt64_t
 
	gÇnos
 = 
expœe
.
n£c
 + (1000000000LL - 
now
.nsec);

46 
	gdu¿tiÚ_ts
.
	gtv_£c
 = ((
expœe
.
£c
 - 
now
.£cè- 1è+ (
Çnos
 / 1000000000LL);

47 
	gdu¿tiÚ_ts
.
	gtv_n£c
 = 
Çnos
 % 1000000000LL;

49 
	gts_±r
 = &
du¿tiÚ_ts
;

50 
	gdu¿tiÚ_mlis
 = ()((
du¿tiÚ_ts
.
tv_£c
 * 1000è+ (du¿tiÚ_ts.
tv_n£c
 / 1000000));

51 
as£¹
(
du¿tiÚ_mlis
 >= 0);

54 
£t_šdefš™e
() {

55 
	gts_±r
 = 0;

56 
	gdu¿tiÚ_mlis
 = -1;

59 
g‘_mlis
(è{  
	gdu¿tiÚ_mlis
; }

61 
time¥ec
 *
g‘_time¥ec
(è{  
	gts_±r
; }

63 
	g´iv©e
:

65 
time¥ec
 *
ts_±r
;

66 
time¥ec
 
	gdu¿tiÚ_ts
;

67 
	gdu¿tiÚ_mlis
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/Protocol.cc

22 
	~<ÿs£¹
>

23 
	~<io¡»am
>

25 
	~"CommÚ/E¼Ü.h
"

26 
	~"CommÚ/Logg”.h
"

28 
	~"CommBuf.h
"

29 
	~"Ev’t.h
"

30 
	~"PrÙocŞ.h
"

31 
	~"S”Ÿliz©iÚ.h
"

33 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

34 
usšg
 
Çme¥aû
 
	g¡d
;

39 
št32_t
 
	gPrÙocŞ
::
	$»¥Ú£_code
(
Ev’t
 *
ev’t
) {

40 
št32_t
 
”rÜ
;

41 ià(
ev’t
->
ty³
 =ğ
Ev’t
::
ERROR
)

42  
ev’t
->
”rÜ
;

43 
ušt8_t
 *
msg
 = 
ev’t
->
mes§ge
;

44 
size_t
 
»maššg
 = 
ev’t
->
mes§geL’
;

45 ià(!
S”Ÿliz©iÚ
::
	`decode_št
(&
msg
, &
»maššg
, (
ušt32_t
 *)&
”rÜ
))

46  
E¼Ü
::
RESPONSE_TRUNCATED
;

47  
”rÜ
;

48 
	}
}

55 
	g¡d
::
¡ršg
 
PrÙocŞ
::
	$¡ršg_fÜm©_mes§ge
(
Ev’t
 *
ev’t
) {

56 
”rÜ
 = 0;

57 
ušt8_t
 *
msg
 = 
ev’t
->
mes§ge
;

58 
size_t
 
»maššg
 = 
ev’t
->
mes§geL’
;

60 ià(
ev’t
 == 0)

61  (
¡d
::
¡ršg
)"NULLƒvent";

63 ià(
ev’t
->
ty³
 !ğ
Ev’t
::
MESSAGE
)

64  
ev’t
->
	`toSŒšg
();

66 ià(!
S”Ÿliz©iÚ
::
	`decode_št
(&
msg
, &
»maššg
, (
ušt32_t
 *)&
”rÜ
))

67  (
¡d
::
¡ršg
)"Message Truncated";

69 ià(
”rÜ
 =ğ
E¼Ü
::
OK
)

70  (
¡d
::
¡ršg
)
E¼Ü
::
	`g‘_‹xt
(
”rÜ
);

72 cÚ¡ *
¡r
;

74 ià(!
S”Ÿliz©iÚ
::
	`decode_¡ršg
(&
msg
, &
»maššg
, &
¡r
))

75  (
¡d
::
¡ršg
)
E¼Ü
::
	`g‘_‹xt
(
”rÜ
) + " -runcated";

77  (
¡d
::
¡ršg
)
E¼Ü
::
	`g‘_‹xt
(
”rÜ
è+ " : " + 
¡r
;

79 
	}
}

86 
CommBuf
 *
	gPrÙocŞ
::
	$ü—‹_”rÜ_mes§ge
(
H—d”Bud”
 &
hbud”
, 
”rÜ
, cÚ¡ *
msg
) {

87 
CommBuf
 *
cbuf
 = 
Ãw
 
	`CommBuf
(
hbud”
, 4 + 
S”Ÿliz©iÚ
::
	`’coded_Ëngth_¡ršg
(
msg
));

88 
cbuf
->
	`­³nd_št
(
”rÜ
);

89 
cbuf
->
	`­³nd_¡ršg
(
msg
);

90  
cbuf
;

91 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/Protocol.h

21 #iâdeà
HYPERTABLE_PROTOCOL_H


22 
	#HYPERTABLE_PROTOCOL_H


	)

24 
	~<¡ršg
>

26 
	~"Ev’t.h
"

27 
	~"H—d”Bud”.h
"

29 
Çme¥aû
 
	gHy³¹abË
 {

31 
şass
 
	gCommBuf
;

33 şas 
	cPrÙocŞ
 {

35 
	gpublic
:

37 
vœtu®
 ~
PrÙocŞ
() { ; }

39 
št32_t
 
»¥Ú£_code
(
Ev’t
 *
ev’t
);

40 
št32_t
 
»¥Ú£_code
(
Ev’tPŒ
 &
ev’tPŒ
è{ „e¥Ú£_codeÓv’tPŒ.
g‘
()); }

42 
	g¡d
::
¡ršg
 
¡ršg_fÜm©_mes§ge
(
Ev’t
 *
ev’t
);

43 
	g¡d
::
¡ršg
 
¡ršg_fÜm©_mes§ge
(
Ev’tPŒ
 &
ev’tPŒ
è{  sŒšg_fÜm©_mes§geÓv’tPŒ.
g‘
()); }

45 
CommBuf
 *
ü—‹_”rÜ_mes§ge
(
H—d”Bud”
 &
hbud”
, 
”rÜ
, cÚ¡ *
msg
);

47 
vœtu®
 cÚ¡ *
commªd_‹xt
(
commªd
) = 0;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/Reactor.cc

21 
	~<ÿs£¹
>

22 
	~<c¡dio
>

23 
	~<io¡»am
>

24 
	~<£t
>

25 
usšg
 
Çme¥aû
 
	g¡d
;

28 
	~<¬·/š‘.h
>

29 
	~<”ºo.h
>

30 
	~<Ãtš‘/š.h
>

31 
	~<¡dio.h
>

32 
	~<¡dlib.h
>

33 
	~<sys/sock‘.h
>

34 
	~<sys/time.h
>

35 
	~<sys/ty³s.h
>

36 #ià
defšed
(
__APPLE__
)

37 
	~<sys/ev’t.h
>

41 
	~"CommÚ/E¼Ü.h
"

42 
	~"CommÚ/FeUts.h
"

43 
	~"CommÚ/Logg”.h
"

45 
	~"IOHªdËrD©a.h
"

46 
	~"R—ùÜ.h
"

47 
usšg
 
Çme¥aû
 
Hy³¹abË
;

49 cÚ¡ 
	gR—ùÜ
::
READ_READY
 = 0x01;

50 cÚ¡ 
	gR—ùÜ
::
WRITE_READY
 = 0x02;

56 
	gR—ùÜ
::
	$R—ùÜ
(è: 
	`m_mu‹x
(), 
	$m_š‹¼u±_š_´og»ss
(
çl£
) {

57 
sockaddr_š
 
addr
;

59 #ià
	`defšed
(
__lšux__
)

60 ià((
pŞlFd
 = 
	`•Şl_ü—‹
(256)) < 0) {

61 
	`³¼Ü
("epoll_create");

62 
	`ex™
(1);

64 #–ià
	`defšed
(
__APPLE__
)

65 
kQueue
 = 
	`kqueue
();

73 ià((
m_š‹¼u±_sd
 = 
	`sock‘
(
AF_INET
, 
SOCK_DGRAM
, 0)) < 0) {

74 
	`HT_ERRORF
("sock‘(èçu»: %s", 
	`¡»¼Ü
(
”ºo
));

75 
	`ex™
(1);

79 
FeUts
::
	`£t_æags
(
m_š‹¼u±_sd
, 
O_NONBLOCK
);

82 
	`mem£t
(&
addr
, 0 , (
sockaddr_š
));

83 
addr
.
sš_çmy
 = 
AF_INET
;

84 
addr
.
sš_addr
.
s_addr
 = 
	`š‘_addr
("127.0.0.1");

85 
addr
.
sš_pÜt
 = 0;

88 ià((
	`bšd
(
m_š‹¼u±_sd
, (cÚ¡ 
sockaddr
 *)&
addr
, (
sockaddr_š
))) < 0) {

89 
	`HT_ERRORF
("bšd(èçu»: %s", 
	`¡»¼Ü
(
”ºo
));

90 
	`ex™
(1);

93 #ià
	`defšed
(
__lšux__
)

94 
•Şl_ev’t
 
ev’t
;

95 
	`mem£t
(&
ev’t
, 0, (
•Şl_ev’t
));

96 
ev’t
.
ev’ts
 = 
EPOLLERR
 | 
EPOLLHUP
;

97 ià(
	`•Şl_ùl
(
pŞlFd
, 
EPOLL_CTL_ADD
, 
m_š‹¼u±_sd
, &
ev’t
) < 0) {

98 
	`HT_ERRORF
("epoll_ctl(%d, EPOLL_CTL_ADD, %d, EPOLLERR|EPOLLHUP) failed : %s",

99 
pŞlFd
, 
m_š‹¼u±_sd
, 
	`¡»¼Ü
(
”ºo
));

100 
	`ex™
(1);

104 
	`mem£t
(&
m_Ãxt_wakeup
, 0, (m_next_wakeup));

105 
	}
}

108 
	gR—ùÜ
::
	$hªdË_timeouts
(
PŞlTimeout
 &
ÃxtTimeout
) {

109 
veùÜ
<
Tim”T
> 
expœedTim”s
;

110 
Ev’tPŒ
 
ev’tPŒ
;

111 
boo¡
::
xtime
 
now
, 
ÃxtReque¡Timeout
;

112 
Tim”T
 
tim”
;

115 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

116 
IOHªdËr
 *
hªdËr
;

117 
Di¥©chHªdËr
 *
dh
;

119 
boo¡
::
	`xtime_g‘
(&
now
, boo¡::
TIME_UTC
);

121 (
dh
 = 
m_»que¡_ÿche
.
	`g‘_Ãxt_timeout
(
now
, 
hªdËr
, &
ÃxtReque¡Timeout
)) != 0) {

122 
hªdËr
->
	`d–iv”_ev’t
Ğ
Ãw
 
	`Ev’t
(
Ev’t
::
ERROR
, 0, ((
IOHªdËrD©a
 *)hªdËr)->
	`g‘_add»ss
(), 
E¼Ü
::
COMM_REQUEST_TIMEOUT
), 
dh
 );

125 ià(
ÃxtReque¡Timeout
.
£c
 != 0) {

126 
ÃxtTimeout
.
	`£t
(
now
, 
ÃxtReque¡Timeout
);

127 
	`memıy
(&
m_Ãxt_wakeup
, &
ÃxtReque¡Timeout
, (m_next_wakeup));

130 
ÃxtTimeout
.
	`£t_šdefš™e
();

131 
	`mem£t
(&
m_Ãxt_wakeup
, 0, (m_next_wakeup));

134 ià(!
m_tim”_h—p
.
	`em±y
()) {

135 
Tim”T
 
tim”
;

137 !
m_tim”_h—p
.
	`em±y
()) {

138 
tim”
 = 
m_tim”_h—p
.
	`tİ
();

139 ià(
	`xtime_cmp
(
tim”
.
expœeTime
, 
now
) > 0) {

140 ià(
ÃxtReque¡Timeout
.
£c
 =ğ0 || 
	`xtime_cmp
(
tim”
.
expœeTime
,‚extRequestTimeout) < 0) {

141 
ÃxtTimeout
.
	`£t
(
now
, 
tim”
.
expœeTime
);

142 
	`memıy
(&
m_Ãxt_wakeup
, &
tim”
.
expœeTime
, (m_next_wakeup));

146 
expœedTim”s
.
	`push_back
(
tim”
);

147 
m_tim”_h—p
.
	`pİ
();

156 
size_t
 
i
=0; i<
expœedTim”s
.
	`size
(); i++) {

157 
ev’tPŒ
 = 
Ãw
 
	`Ev’t
(
Ev’t
::
TIMER
, 
E¼Ü
::
OK
);

158 ià(
expœedTim”s
[
i
].
hªdËr
)

159 
expœedTim”s
[
i
].
hªdËr
->
	`hªdË
(
ev’tPŒ
);

163 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

165 ià(!
m_tim”_h—p
.
	`em±y
()) {

166 
tim”
 = 
m_tim”_h—p
.
	`tİ
();

167 ià(
ÃxtReque¡Timeout
.
£c
 =ğ0 || 
	`xtime_cmp
(
tim”
.
expœeTime
,‚extRequestTimeout) < 0) {

168 
ÃxtTimeout
.
	`£t
(
now
, 
tim”
.
expœeTime
);

169 
	`memıy
(&
m_Ãxt_wakeup
, &
tim”
.
expœeTime
, (m_next_wakeup));

173 
	`pŞl_loİ_cÚtšue
();

176 
	}
}

183 
	gR—ùÜ
::
	$pŞl_loİ_š‹¼u±
() {

185 
m_š‹¼u±_š_´og»ss
 = 
Œue
;

187 #ià
	`defšed
(
__lšux__
)

188 
•Şl_ev’t
 
ev’t
;

190 
	`mem£t
(&
ev’t
, 0, (
•Şl_ev’t
));

191 
ev’t
.
ev’ts
 = 
EPOLLOUT
 | 
EPOLLERR
 | 
EPOLLHUP
;

193 ià(
	`•Şl_ùl
(
pŞlFd
, 
EPOLL_CTL_MOD
, 
m_š‹¼u±_sd
, &
ev’t
) < 0) {

201 #–ià
	`defšed
(
__APPLE__
)

202 
kev’t
 
ev’t
;

204 
	`EV_SET
(&
ev’t
, 
m_š‹¼u±_sd
, 
EVFILT_WRITE
, 
EV_ADD
 | 
EV_ENABLE
, 0, 0, 0);

206 ià(
	`kev’t
(
kQueue
, &
ev’t
, 1, 0, 0, 0) == -1) {

207 
	`HT_ERRORF
("kev’t(sd=%dè: %s", 
m_š‹¼u±_sd
, 
	`¡»¼Ü
(
”ºo
));

208 
	`ex™
(1);

212 
	}
}

219 
	gR—ùÜ
::
	$pŞl_loİ_cÚtšue
() {

221 ià(!
m_š‹¼u±_š_´og»ss
)

224 #ià
	`defšed
(
__lšux__
)

225 
•Şl_ev’t
 
ev’t
;

227 
	`mem£t
(&
ev’t
, 0, (
•Şl_ev’t
));

228 
ev’t
.
ev’ts
 = 
EPOLLERR
 | 
EPOLLHUP
;

230 ià(
	`•Şl_ùl
(
pŞlFd
, 
EPOLL_CTL_MOD
, 
m_š‹¼u±_sd
, &
ev’t
) < 0) {

231 
	`HT_ERRORF
("•Şl_ùl(EPOLL_CTL_MOD, sd=%dè: %s", 
m_š‹¼u±_sd
, 
	`¡»¼Ü
(
”ºo
));

232 
	`ex™
(1);

234 #–ià
	`defšed
(
__APPLE__
)

235 
kev’t
 
dev’t
;

237 
	`EV_SET
(&
dev’t
, 
m_š‹¼u±_sd
, 
EVFILT_WRITE
, 
EV_DELETE
, 0, 0, 0);

239 ià(
	`kev’t
(
kQueue
, &
dev’t
, 1, 0, 0, 0è=ğ-1 && 
”ºo
 !ğ
ENOENT
) {

240 
	`HT_ERRORF
("kev’t(sd=%dè: %s", 
m_š‹¼u±_sd
, 
	`¡»¼Ü
(
”ºo
));

241 
	`ex™
(1);

244 
m_š‹¼u±_š_´og»ss
 = 
çl£
;

245 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/Reactor.h

21 #iâdeà
HYPERTABLE_REACTOR_H


22 
	#HYPERTABLE_REACTOR_H


	)

24 
	~<queue
>

25 
	~<£t
>

27 
	~<boo¡/th»ad/th»ad.hµ
>

29 
	~"CommÚ/Reã»nûCouÁ.h
"

31 
	~"PŞlTimeout.h
"

32 
	~"Reque¡Cache.h
"

33 
	~"Tim”.h
"

35 
Çme¥aû
 
	gHy³¹abË
 {

37 şas 
	cR—ùÜ
 : 
public
 
Reã»nûCouÁ
 {

39 
ä›nd
 
şass
 
R—ùÜFaùÜy
;

41 
	gpublic
:

43 cÚ¡ 
READ_READY
;

44 cÚ¡ 
	gWRITE_READY
;

46 
R—ùÜ
();

47 ~
R—ùÜ
() {

48 
pŞl_loİ_š‹¼u±
();

51 
İ”©Ü
()();

53 
add_»que¡
(
ušt32_t
 
id
, 
IOHªdËr
 *
hªdËr
, 
Di¥©chHªdËr
 *
dh
, 
boo¡
::
xtime
 &
expœe
) {

54 
boo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

55 
	gboo¡
::
xtime
 
now
;

56 
	gm_»que¡_ÿche
.
š£¹
(
id
, 
hªdËr
, 
dh
, 
expœe
);

57 
	gboo¡
::
xtime_g‘
(&
now
, 
boo¡
::
TIME_UTC
);

58 ià(
	gm_Ãxt_wakeup
.
	g£c
 =ğ0 || 
xtime_cmp
(
expœe
, 
m_Ãxt_wakeup
) < 0)

59 
pŞl_loİ_š‹¼u±
();

62 
Di¥©chHªdËr
 *
»move_»que¡
(
ušt32_t
 
id
) {

63 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

64  
	gm_»que¡_ÿche
.
»move
(
id
);

67 
ÿnûl_»que¡s
(
IOHªdËr
 *
hªdËr
) {

68 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

69 
	gm_»que¡_ÿche
.
purge_»que¡s
(
hªdËr
);

72 
add_tim”
(
Tim”T
 &
tim”
) {

73 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

74 
	gm_tim”_h—p
.
push
(
tim”
);

75 
pŞl_loİ_š‹¼u±
();

78 
scheduË_»mov®
(
IOHªdËr
 *
hªdËr
) {

79 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

80 
	gm_»moved_hªdËrs
.
š£¹
(
hªdËr
);

83 
g‘_»moved_hªdËrs
(
£t
<
IOHªdËr
 *> &
d¡
) {

84 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

85 
	gd¡
 = 
m_»moved_hªdËrs
;

86 
	gm_»moved_hªdËrs
.
ş—r
();

89 
hªdË_timeouts
(
PŞlTimeout
 &
ÃxtTimeout
);

91 #ià
defšed
(
__lšux__
)

92 
	gpŞlFd
;

93 #–ià
defšed
 (
__APPLE__
)

94 
	gkQueue
;

97 
pŞl_loİ_š‹¼u±
();

98 
pŞl_loİ_cÚtšue
();

100 
	g´Ùeùed
:

101 
boo¡
::
mu‹x
 
m_mu‹x
;

102 
Reque¡Cache
 
	gm_»que¡_ÿche
;

103 
	g¡d
::
´iÜ™y_queue
<
Tim”T
, std::
veùÜ
<Tim”T>, 
	gÉTim”
> 
	gm_tim”_h—p
;

104 
	gm_š‹¼u±_sd
;

105 
boŞ
 
	gm_š‹¼u±_š_´og»ss
;

106 
	gboo¡
::
xtime
 
m_Ãxt_wakeup
;

107 
	g£t
<
	gIOHªdËr
 *> 
	gm_»moved_hªdËrs
;

109 
	gboo¡
::
	tšŒusive_±r
<
	tR—ùÜ
> 
	tR—ùÜPŒ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/ReactorFactory.cc

21 
	~"HªdËrM­.h
"

22 
	~"R—ùÜFaùÜy.h
"

23 
	~"R—ùÜRuÂ”.h
"

24 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

26 
	~<ÿs£¹
>

29 
	~<sigÇl.h
>

32 
veùÜ
<
R—ùÜPŒ
> 
R—ùÜFaùÜy
::
ms_»aùÜs
;

33 
	gboo¡
::
th»ad_group
 
R—ùÜFaùÜy
::
ms_th»ads
;

34 
	gboo¡
::
mu‹x
 
R—ùÜFaùÜy
::
ms_mu‹x
;

35 
©omic_t
 
	gR—ùÜFaùÜy
::
ms_Ãxt_»aùÜ
 = 
ATOMIC_INIT
(0);

40 
	gR—ùÜFaùÜy
::
	$š™Ÿlize
(
ušt16_t
 
»aùÜ_couÁ
) {

41 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
ms_mu‹x
);

42 ià(!
ms_»aùÜs
.
	`em±y
())

44 
R—ùÜPŒ
 
»aùÜ_±r
;

45 
R—ùÜRuÂ”
 
¼uÂ”
;

46 
R—ùÜRuÂ”
::
ms_hªdËr_m­_±r
 = 
Ãw
 
	`HªdËrM­
();

47 
	`sigÇl
(
SIGPIPE
, 
SIG_IGN
);

48 
	`as£¹
(
»aùÜ_couÁ
 > 0);

49 
ušt16_t
 
i
=0; i<
»aùÜ_couÁ
; i++) {

50 
»aùÜ_±r
 = 
Ãw
 
	`R—ùÜ
();

51 
ms_»aùÜs
.
	`push_back
(
»aùÜ_±r
);

52 
¼uÂ”
.
	`£t_»aùÜ
(
»aùÜ_±r
);

53 
ms_th»ads
.
	`ü—‹_th»ad
(
¼uÂ”
);

55 
	}
}

57 
	gR—ùÜFaùÜy
::
	$de¡roy
() {

58 
R—ùÜRuÂ”
::
ms_shutdown
 = 
Œue
;

59 
size_t
 
i
=0; i<
ms_»aùÜs
.
	`size
(); i++)

60 
ms_»aùÜs
[
i
]->
	`pŞl_loİ_š‹¼u±
();

61 
ms_th»ads
.
	`još_®l
();

62 
ms_»aùÜs
.
	`ş—r
();

63 
R—ùÜRuÂ”
::
ms_hªdËr_m­_±r
 = 0;

64 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/ReactorFactory.h

22 #iâdeà
HYPERTABLE_REACTORFACTORY_H


23 
	#HYPERTABLE_REACTORFACTORY_H


	)

25 
	~<boo¡/th»ad/mu‹x.hµ
>

26 
	~<boo¡/th»ad/th»ad.hµ
>

29 
	~<¡dšt.h
>

32 
	~<ÿs£¹
>

33 
	~<veùÜ
>

34 
usšg
 
Çme¥aû
 
¡d
;

36 
	~"CommÚ/©omic.h
"

37 
	~"R—ùÜ.h
"

40 
Çme¥aû
 
	gHy³¹abË
 {

46 şas 
	cR—ùÜFaùÜy
 {

48 
	gpublic
:

55 
š™Ÿlize
(
ušt16_t
 
»aùÜ_couÁ
);

59 
de¡roy
();

65 
g‘_»aùÜ
(
R—ùÜPŒ
 &
»aùÜ_±r
) {

66 
as£¹
(
ms_»aùÜs
.
size
() > 0);

67 
	g»aùÜ_±r
 = 
ms_»aùÜs
[
©omic_šc_»tuº
(&
ms_Ãxt_»aùÜ
è% ms_»aùÜs.
size
()];

71 
	gveùÜ
<
	gR—ùÜPŒ
> 
	gms_»aùÜs
;

73 
	gboo¡
::
th»ad_group
 
ms_th»ads
;

75 
	g´iv©e
:

76 
boo¡
::
mu‹x
 
ms_mu‹x
;

77 
©omic_t
 
	gms_Ãxt_»aùÜ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/ReactorRunner.cc

22 
	~<”ºo.h
>

23 
	~<¡dlib.h
>

24 
	~<¡dio.h
>

25 
	~<sys/ty³s.h
>

26 
	~<sys/time.h
>

27 #ià
defšed
(
__APPLE__
)

28 
	~<sys/ev’t.h
>

32 
	#DISABLE_LOG_DEBUG
 1

	)

34 
	~"CommÚ/Logg”.h
"

36 
	~"HªdËrM­.h
"

37 
	~"IOHªdËr.h
"

38 
	~"IOHªdËrD©a.h
"

39 
	~"R—ùÜFaùÜy.h
"

40 
	~"R—ùÜRuÂ”.h
"

41 
usšg
 
Çme¥aû
 
Hy³¹abË
;

43 
boŞ
 
	gHy³¹abË
::
R—ùÜRuÂ”
::
ms_shutdown
 = 
çl£
;

44 
HªdËrM­PŒ
 
	gHy³¹abË
::
R—ùÜRuÂ”
::
ms_hªdËr_m­_±r
;

49 
	gR—ùÜRuÂ”
::
	$İ”©Ü
()() {

50 
n
;

51 
IOHªdËr
 *
hªdËr
;

52 
£t
<
IOHªdËr
 *> 
»movedHªdËrs
;

53 
PŞlTimeout
 
timeout
;

55 #ià
	`defšed
(
__lšux__
)

56 
•Şl_ev’t
 
ev’ts
[256];

58 (
n
 = 
	`•Şl_wa™
(
m_»aùÜ_±r
->
pŞlFd
, 
ev’ts
, 256, 
timeout
.
	`g‘_mlis
())è>ğ0 || 
”ºo
 =ğ
EINTR
) {

59 
m_»aùÜ_±r
->
	`g‘_»moved_hªdËrs
(
»movedHªdËrs
);

60 
	`HT_DEBUGF
("•Şl_wa™„‘uºed %dƒv’ts", 
n
);

61 
i
=0; i<
n
; i++) {

62 ià(
»movedHªdËrs
.
	`couÁ
((
IOHªdËr
 *)
ev’ts
[
i
].
d©a
.
±r
) == 0) {

63 
hªdËr
 = (
IOHªdËr
 *)
ev’ts
[
i
].
d©a
.
±r
;

64 ià(
hªdËr
 && hªdËr->
	`hªdË_ev’t
(&
ev’ts
[
i
])) {

65 
ms_hªdËr_m­_±r
->
	`decomissiÚ_hªdËr
(
hªdËr
->
	`g‘_add»ss
());

66 
»movedHªdËrs
.
	`š£¹
(
hªdËr
);

70 ià(!
»movedHªdËrs
.
	`em±y
())

71 
	`ş—nup_ªd_»move_hªdËrs
(
»movedHªdËrs
);

72 
m_»aùÜ_±r
->
	`hªdË_timeouts
(
timeout
);

73 ià(
ms_shutdown
)

77 
	`HT_ERRORF
("•Şl_wa™(%dèçed : %s", 
m_»aùÜ_±r
->
pŞlFd
, 
	`¡»¼Ü
(
”ºo
));

79 #–ià
	`defšed
(
__APPLE__
)

80 
kev’t
 
ev’ts
[32];

82 (
n
 = 
	`kev’t
(
m_»aùÜ_±r
->
kQueue
, 
NULL
, 0, 
ev’ts
, 32, 
timeout
.
	`g‘_time¥ec
())è>ğ0 || 
”ºo
 =ğ
EINTR
) {

83 
m_»aùÜ_±r
->
	`g‘_»moved_hªdËrs
(
»movedHªdËrs
);

84 
i
=0; i<
n
; i++) {

85 
hªdËr
 = (
IOHªdËr
 *)
ev’ts
[
i
].
ud©a
;

86 ià(
»movedHªdËrs
.
	`couÁ
(
hªdËr
) == 0) {

87 ià(
hªdËr
 && hªdËr->
	`hªdË_ev’t
(&
ev’ts
[
i
])) {

88 
ms_hªdËr_m­_±r
->
	`decomissiÚ_hªdËr
(
hªdËr
->
	`g‘_add»ss
());

89 
»movedHªdËrs
.
	`š£¹
(
hªdËr
);

93 ià(!
»movedHªdËrs
.
	`em±y
())

94 
	`ş—nup_ªd_»move_hªdËrs
(
»movedHªdËrs
);

95 
m_»aùÜ_±r
->
	`hªdË_timeouts
(
timeout
);

96 ià(
ms_shutdown
)

100 
	`HT_ERRORF
("kev’t(%dèçed : %s", 
m_»aùÜ_±r
->
kQueue
, 
	`¡»¼Ü
(
”ºo
));

103 
	}
}

107 
	gR—ùÜRuÂ”
::
ş—nup_ªd_»move_hªdËrs
(
£t
<
IOHªdËr
 *> &
hªdËrs
) {

108 
IOHªdËr
 *
hªdËr
;

110 
	g£t
<
	gIOHªdËr
 *>::
™”©Ü
 
™”
=
hªdËrs
.
begš
(); 
	g™”
!=hªdËrs.
’d
(); iter++) {

111 
	ghªdËr
 = *
™”
;

113 #ià
defšed
(
__lšux__
)

114 
•Şl_ev’t
 
	gev’t
;

115 
mem£t
(&
ev’t
, 0, (
•Şl_ev’t
));

116 ià(
•Şl_ùl
(
m_»aùÜ_±r
->
pŞlFd
, 
EPOLL_CTL_DEL
, 
hªdËr
->
g‘_sd
(), &
ev’t
) < 0) {

117 
HT_ERRORF
("•Şl_ùl(EPOLL_CTL_DEL, %dèçu», %s", 
hªdËr
->
g‘_sd
(), 
¡»¼Ü
(
”ºo
));

119 #–ià
defšed
(
__APPLE__
)

120 
kev’t
 
	gdev’ts
[2];

121 
EV_SET
(&
dev’ts
[0], 
hªdËr
->
g‘_sd
(), 
EVFILT_READ
, 
EV_DELETE
, 0, 0, 0);

122 
EV_SET
(&
dev’ts
[1], 
hªdËr
->
g‘_sd
(), 
EVFILT_WRITE
, 
EV_DELETE
, 0, 0, 0);

123 ià(
kev’t
(
m_»aùÜ_±r
->
kQueue
, 
dev’ts
, 2, 
NULL
, 0, NULLè=ğ-1 && 
”ºo
 !ğ
ENOENT
) {

124 
HT_ERRORF
("kev’t(%dè: %s", 
hªdËr
->
g‘_sd
(), 
¡»¼Ü
(
”ºo
));

127 
	gIm¶em’tMe
;

129 
şo£
(
hªdËr
->
g‘_sd
());

130 
	gms_hªdËr_m­_±r
->
purge_hªdËr
(
hªdËr
);

131 
	gm_»aùÜ_±r
->
ÿnûl_»que¡s
(
hªdËr
);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/ReactorRunner.h

21 #iâdeà
HYPERTABLE_REACTORRUNNER_H


22 
	#HYPERTABLE_REACTORRUNNER_H


	)

24 
	~"HªdËrM­.h
"

25 
	~"R—ùÜ.h
"

27 
Çme¥aû
 
	gHy³¹abË
 {

29 
şass
 
	gIOHªdËr
;

34 şas 
	cR—ùÜRuÂ”
 {

35 
	gpublic
:

36 
İ”©Ü
()();

37 
£t_»aùÜ
(
R—ùÜPŒ
 &
»aùÜ_±r
è{ 
	gm_»aùÜ_±r
 =„eactor_ptr; }

38 
boŞ
 
	gms_shutdown
;

39 
HªdËrM­PŒ
 
	gms_hªdËr_m­_±r
;

40 
	g´iv©e
:

41 
ş—nup_ªd_»move_hªdËrs
(
£t
<
IOHªdËr
 *> &
hªdËrs
);

42 
R—ùÜPŒ
 
	gm_»aùÜ_±r
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/RequestCache.cc

21 
	~<ÿs£¹
>

22 
	~<¡ršg.h
>

24 
usšg
 
Çme¥aû
 
	g¡d
;

26 
	#DISABLE_LOG_DEBUG
 1

	)

28 
	~"CommÚ/Logg”.h
"

30 
	~"Reque¡Cache.h
"

31 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

33 
	gReque¡Cache
::
š£¹
(
ušt32_t
 
id
, 
IOHªdËr
 *
hªdËr
, 
Di¥©chHªdËr
 *
dh
, 
boo¡
::
xtime
 &
expœe
) {

34 
CacheNodeT
 *
node
 = 
Ãw
 CacheNodeT;

36 
HT_DEBUGF
("Addšg id %d", 
id
);

38 
	gnode
->
	gid
 = 
id
;

39 
	gnode
->
	ghªdËr
 = 
hªdËr
;

40 
	gnode
->
	gdh
 = 
dh
;

41 
memıy
(&
node
->
expœe
, &expire, (expire));

43 ià(
	gm_h—d
 == 0) {

44 
node
->
Ãxt
 =‚ode->
´ev
 = 0;

45 
	gm_h—d
 = 
m_
 = 
node
;

48 
	gnode
->
	gÃxt
 = 
m_
;

49 
	gnode
->
	gÃxt
->
	g´ev
 = 
node
;

50 
	gnode
->
	g´ev
 = 0;

51 
	gm_
 = 
node
;

54 
	gm_id_m­
[
id
] = 
node
;

58 
Di¥©chHªdËr
 *
	gReque¡Cache
::
	$»move
(
ušt32_t
 
id
) {

60 
	`HT_DEBUGF
("Removšg id %d", 
id
);

62 
IdHªdËrM­T
::
™”©Ü
 
™”
 = 
m_id_m­
.
	`fšd
(
id
);

64 ià(
™”
 =ğ
m_id_m­
.
	`’d
()) {

65 
	`HT_DEBUGF
("ID %d‚Ù found iÀ»que¡ cache", 
id
);

69 
CacheNodeT
 *
node
 = (*
™”
).
£cÚd
;

71 ià(
node
->
´ev
 == 0)

72 
m_
 = 
node
->
Ãxt
;

74 
node
->
´ev
->
Ãxt
 =‚ode->next;

76 ià(
node
->
Ãxt
 == 0)

77 
m_h—d
 = 
node
->
´ev
;

79 
node
->
Ãxt
->
´ev
 =‚ode->prev;

81 
m_id_m­
.
	`”a£
(
™”
);

83 ià(
node
->
hªdËr
 != 0) {

84 
Di¥©chHªdËr
 *
dh
 = 
node
->dh;

85 
d–‘e
 
node
;

86  
dh
;

88 
d–‘e
 
node
;

90 
	}
}

94 
Di¥©chHªdËr
 *
	gReque¡Cache
::
g‘_Ãxt_timeout
(
boo¡
::
xtime
 &
now
, 
IOHªdËr
 *&
hªdË½
, boo¡::xtim*
ÃxtTimeout
) {

96 
m_h—d
 && 
xtime_cmp
(m_h—d->
expœe
, 
now
) <= 0) {

98 
IdHªdËrM­T
::
™”©Ü
 
™”
 = 
m_id_m­
.
fšd
(
m_h—d
->
id
);

99 
as£¹
 (
™”
 !ğ
m_id_m­
.
’d
());

100 
CacheNodeT
 *
	gnode
 = 
m_h—d
;

101 ià(
	gm_h—d
->
	g´ev
) {

102 
	gm_h—d
 = 
m_h—d
->
´ev
;

103 
	gm_h—d
->
	gÃxt
 = 0;

106 
	gm_h—d
 = 
m_
 = 0;

108 
	gm_id_m­
.
”a£
(
™”
);

110 ià(
	gnode
->
	ghªdËr
 != 0) {

111 
hªdË½
 = 
node
->
hªdËr
;

112 
Di¥©chHªdËr
 *
	gdh
 = 
node
->
dh
;

113 
d–‘e
 
	gnode
;

114  
	gdh
;

116 
d–‘e
 
	gnode
;

119 ià(
	gm_h—d
)

120 
memıy
(
ÃxtTimeout
, &
m_h—d
->
expœe
, (
boo¡
::
xtime
));

122 
mem£t
(
ÃxtTimeout
, 0, (
boo¡
::
xtime
));

129 
	gReque¡Cache
::
	$purge_»que¡s
(
IOHªdËr
 *
hªdËr
) {

130 
CacheNodeT
 *
node
 = 
m_
;‚od!ğ0;‚odğnode->
Ãxt
) {

131 ià(
node
->
hªdËr
 == handler) {

132 
	`HT_DEBUGF
("Purgšg„eque¡ id %d", 
node
->
id
);

133 
node
->
hªdËr
 = 0;

136 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/RequestCache.h

22 #iâdeà
HYPERTABLE_REQUESTCACHE_H


23 
	#HYPERTABLE_REQUESTCACHE_H


	)

25 
	~<boo¡/th»ad/mu‹x.hµ
>

26 
	~<boo¡/th»ad/xtime.hµ
>

28 
	~<ext/hash_m­
>

30 
	~"Di¥©chHªdËr.h
"

32 
Çme¥aû
 
	gHy³¹abË
 {

34 
şass
 
	gIOHªdËr
;

36 şas 
	cReque¡Cache
 {

38 
	sÿche_node
 {

39 
ÿche_node
 *
	g´ev
, *
	gÃxt
;

40 
	gboo¡
::
xtime
 
expœe
;

41 
ušt32_t
 
	gid
;

42 
IOHªdËr
 *
	ghªdËr
;

43 
Di¥©chHªdËr
 *
	gdh
;

44 } 
	tCacheNodeT
;

46 
	g__gnu_cxx
::
	thash_m­
<
	tušt32_t
, 
	tCacheNodeT
 *> 
	tIdHªdËrM­T
;

48 
	gpublic
:

50 
Reque¡Cache
(è: 
m_id_m­
(), 
m_h—d
(0), 
m_
(0) { ; }

52 
š£¹
(
ušt32_t
 
id
, 
IOHªdËr
 *
hªdËr
, 
Di¥©chHªdËr
 *
dh
, 
boo¡
::
xtime
 &
expœe
);

54 
Di¥©chHªdËr
 *
»move
(
ušt32_t
 
id
);

56 
Di¥©chHªdËr
 *
g‘_Ãxt_timeout
(
boo¡
::
xtime
 &
now
, 
IOHªdËr
 *&
hªdË½
, boo¡::xtim*
ÃxtTimeout
);

58 
purge_»que¡s
(
IOHªdËr
 *
hªdËr
);

60 
	g´iv©e
:

61 
IdHªdËrM­T
 
m_id_m­
;

62 
CacheNodeT
 *
	gm_h—d
, *
	gm_
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/ResponseCallback.cc

21 
	~"CommÚ/E¼Ü.h
"

23 
	~"CommBuf.h
"

24 
	~"PrÙocŞ.h
"

25 
	~"Re¥Ú£C®lback.h
"

27 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

29 
	gRe¥Ú£C®lback
::
”rÜ
(”rÜ, 
¡d
::
¡ršg
 
msg
) {

30 
hbud”_
.
š™Ÿlize_äom_»que¡
(
m_ev’t_±r
->
h—d”
);

31 
CommBufPŒ
 
cbufPŒ
Ğ
PrÙocŞ
::
ü—‹_”rÜ_mes§ge
(
hbud”_
, 
”rÜ
, 
msg
.
c_¡r
()) );

32  
	gm_comm
->
£nd_»¥Ú£
(
m_ev’t_±r
->
addr
, 
cbufPŒ
);

35 
	gRe¥Ú£C®lback
::
	$»¥Ú£_ok
() {

36 
hbud”_
.
	`š™Ÿlize_äom_»que¡
(
m_ev’t_±r
->
h—d”
);

37 
CommBufPŒ
 
	`cbufPŒ
Ğ
Ãw
 
	`CommBuf
(
hbud”_
, 4) );

38 
cbufPŒ
->
	`­³nd_št
(
E¼Ü
::
OK
);

39  
m_comm
->
	`£nd_»¥Ú£
(
m_ev’t_±r
->
addr
, 
cbufPŒ
);

40 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/ResponseCallback.h

21 #iâdeà
HYPERTABLE_RESPONSECALLBACK_H


22 
	#HYPERTABLE_RESPONSECALLBACK_H


	)

24 
	~<¡ršg
>

26 
	~"Comm.h
"

27 
	~"Ev’t.h
"

28 
	~"H—d”Bud”.h
"

30 
Çme¥aû
 
	gHy³¹abË
 {

36 şas 
	cRe¥Ú£C®lback
 {

38 
	gpublic
:

46 
Re¥Ú£C®lback
(
Comm
 *
comm
, 
Ev’tPŒ
 &
ev’tPŒ
è: 
m_comm
(comm), 
m_ev’t_±r
(eventPtr) { ; }

48 
	gvœtu®
 ~
Re¥Ú£C®lback
() { ; }

58 
”rÜ
(”rÜ, 
¡d
::
¡ršg
 
msg
);

67 
»¥Ú£_ok
();

73 
g‘_add»ss
(
sockaddr_š
 &
addr
è{ 
memıy
(&addr, &
m_ev’t_±r
->addr, (addr)); }

75 
	g´Ùeùed
:

76 
Comm
 *
m_comm
;

77 
Ev’tPŒ
 
	gm_ev’t_±r
;

78 
H—d”Bud”
 
	ghbud”_
;

82 
ušt8_t
 *
	gbuf
;

83 
ušt32_t
 
	gËn
;

84 } 
	tExtBufãrT
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/Serialization.h

21 #iâdeà
HYPERTABLE_SERIALIZATION_H


22 
	#HYPERTABLE_SERIALIZATION_H


	)

24 
	~<c¡ršg
>

25 
	~<¡ršg
>

27 
	~"CommÚ/By‹SŒšg.h
"

29 
Çme¥aû
 
	gHy³¹abË
 {

31 
Çme¥aû
 
	gS”Ÿliz©iÚ
 {

40 
šlše
 
’code_boŞ
(
ušt8_t
 **
bufPŒ
, 
boŞ
 
bv®
) {

41 *(*
	gbufPŒ
èğ(
bv®
) ? 1 : 0;

42 (*
	gbufPŒ
)++;

55 
šlše
 
boŞ
 
decode_boŞ
(
ušt8_t
 **
bufPŒ
, 
size_t
 *
»maššgPŒ
, boŞ *
boŞp
) {

56 ià(*
	g»maššgPŒ
 == 0)

57  
çl£
;

58 *
	gboŞp
 = (*(*
bufPŒ
è=ğ0è? 
çl£
 : 
Œue
;

59 (*
	gbufPŒ
)++;

60 (*
	g»maššgPŒ
)--;

61  
	gŒue
;

74 
šlše
 
boŞ
 
decode_by‹
(
ušt8_t
 **
bufPŒ
, 
size_t
 *
»maššgPŒ
, ušt8_ˆ*
by‹PŒ
) {

75 ià(*
	g»maššgPŒ
 == 0)

76  
çl£
;

77 *
	gby‹PŒ
 = *(*
bufPŒ
)++;

78 (*
	g»maššgPŒ
)--;

79  
	gŒue
;

90 
šlše
 
’code_shÜt
(
ušt8_t
 **
bufPŒ
, 
ušt16_t
 
sv®
) {

91 
memıy
(*
bufPŒ
, &
sv®
, 2);

92 (*
	gbufPŒ
) += 2;

105 
šlše
 
boŞ
 
decode_shÜt
(
ušt8_t
 **
bufPŒ
, 
size_t
 *
»maššgPŒ
, 
ušt16_t
 *
shÜtPŒ
) {

106 ià(*
	g»maššgPŒ
 < 2)

107  
	gçl£
;

108 
memıy
(
shÜtPŒ
, *
bufPŒ
, 2);

109 (*
	g»maššgPŒ
) -= 2;

110 (*
	gbufPŒ
) += 2;

111  
	gŒue
;

122 
šlše
 
’code_št
(
ušt8_t
 **
bufPŒ
, 
ušt32_t
 
iv®
) {

123 
memıy
(*
bufPŒ
, &
iv®
, 4);

124 *
	gbufPŒ
 += 4;

137 
šlše
 
boŞ
 
decode_št
(
ušt8_t
 **
bufPŒ
, 
size_t
 *
»maššgPŒ
, 
ušt32_t
 *
štPŒ
) {

138 ià(*
	g»maššgPŒ
 < 4)

139  
	gçl£
;

140 
memıy
(
štPŒ
, *
bufPŒ
, 4);

141 (*
	g»maššgPŒ
) -= 4;

142 (*
	gbufPŒ
) += 4;

143  
	gŒue
;

154 
šlše
 
’code_lÚg
(
ušt8_t
 **
bufPŒ
, 
ušt64_t
 
lv®
) {

155 
memıy
(*
bufPŒ
, &
lv®
, 8);

156 *
	gbufPŒ
 += 8;

169 
šlše
 
boŞ
 
decode_lÚg
(
ušt8_t
 **
bufPŒ
, 
size_t
 *
»maššgPŒ
, 
ušt64_t
 *
lÚgPŒ
) {

170 ià(*
	g»maššgPŒ
 < 8)

171  
	gçl£
;

172 
memıy
(
lÚgPŒ
, *
bufPŒ
, 8);

173 (*
	g»maššgPŒ
) -= 8;

174 (*
	gbufPŒ
) += 8;

175  
	gŒue
;

184 
šlše
 
size_t
 
’coded_Ëngth_by‹_¬¿y
(
št32_t
 
Ën
) {

185  
	gËn
 + 4;

198 
šlše
 
’code_by‹_¬¿y
(
ušt8_t
 **
bufPŒ
, cÚ¡ *
d©a
, 
št32_t
 
Ën
) {

199 
memıy
(*
bufPŒ
, &
Ën
, 4);

200 
memıy
((*
bufPŒ
)+4, (
ušt8_t
 *)
d©a
, 
Ën
);

201 *
	gbufPŒ
 +ğ
Ën
 + 4;

216 
šlše
 
boŞ
 
decode_by‹_¬¿y
(
ušt8_t
 **
bufPŒ
, 
size_t
 *
»maššgPŒ
, ušt8_ˆ**
d¡PŒ
, 
št32_t
 *
ËnPŒ
) {

218 ià(*
	g»maššgPŒ
 < 4)

219  
	gçl£
;

220 
memıy
(
ËnPŒ
, *
bufPŒ
, 4);

221 (*
	g»maššgPŒ
) -= 4;

222 (*
	gbufPŒ
) += 4;

224 ià(*
	g»maššgPŒ
 < (
	gsize_t
)*
	gËnPŒ
)

225  
	gçl£
;

226 *
	gd¡PŒ
 = (*
bufPŒ
);

227 (*
	g»maššgPŒ
è-ğ*
ËnPŒ
;

228 (*
	gbufPŒ
è+ğ*
ËnPŒ
;

229  
	gŒue
;

244 
šlše
 
boŞ
 
decode_by‹_¡ršg32
(cÚ¡ 
ušt8_t
 **
bufPŒ
, 
size_t
 *
»maššgPŒ
, 
By‹SŒšg32T
 **
bs32PŒ
) {

245 ià(*
	g»maššgPŒ
 < 4)

246  
	gçl£
;

247 *
	gbs32PŒ
 = (
By‹SŒšg32T
 *)*
bufPŒ
;

248 ià(*
	g»maššgPŒ
 < (*
	gbs32PŒ
)->
	gËn
 + 4)

249  
	gçl£
;

250 (*
	g»maššgPŒ
è-ğ
L’gth
(*
bs32PŒ
);

251 (*
	gbufPŒ
è+ğ
L’gth
(*
bs32PŒ
);

252  
	gŒue
;

262 
šlše
 
size_t
 
’coded_Ëngth_¡ršg
(cÚ¡ *
¡r
) {

263  2 + ((
	g¡r
 =ğ0è? 0 : 
¡¾’
(
¡r
)) + 1;

273 
šlše
 
size_t
 
’coded_Ëngth_¡ršg
(cÚ¡ 
¡d
::
¡ršg
 &
¡r
) {

274  
’coded_Ëngth_¡ršg
(
¡r
.
c_¡r
());

288 
šlše
 
’code_¡ršg
(
ušt8_t
 **
bufPŒ
, cÚ¡ *
¡r
) {

289 
ušt16_t
 
	gËn
 = (
¡r
 =ğ0è? 0 : 
¡¾’
(str);

292 
memıy
(*
bufPŒ
, &
Ën
, 2);

293 (*
	gbufPŒ
) += 2;

296 ià(
	gËn
 > 0) {

297 
memıy
(*
bufPŒ
, 
¡r
, 
Ën
);

298 (*
	gbufPŒ
è+ğ
Ën
;

302 *(*
	gbufPŒ
)++ = 0;

316 
šlše
 
’code_¡ršg
(
ušt8_t
 **
bufPŒ
, cÚ¡ 
¡d
::
¡ršg
 &
¡r
) {

317 
’code_¡ršg
(
bufPŒ
, 
¡r
.
c_¡r
());

333 
šlše
 
boŞ
 
decode_¡ršg
(
ušt8_t
 **
bufPŒ
, 
size_t
 *
»maššgPŒ
, cÚ¡ **
¡rPŒ
) {

334 
ušt16_t
 
	gËn
;

335 *
	g¡rPŒ
 = 0;

336 ià(*
	g»maššgPŒ
 < 3)

337  
	gçl£
;

338 
memıy
(&
Ën
, *
bufPŒ
, 2);

339 ià(*
	g»maššgPŒ
 < (
	gsize_t
)
	gËn
+3)

340  
	gçl£
;

341 *
	g¡rPŒ
 = (cÚ¡ *)((*
bufPŒ
)+2);

342 (*
	g»maššgPŒ
è-ğ(
size_t
)
Ën
+3;

343 (*
	gbufPŒ
è+ğ(
size_t
)
Ën
+3;

344  
	gŒue
;

358 
šlše
 
boŞ
 
decode_¡ršg
(
ušt8_t
 **
bufPŒ
, 
size_t
 *
»maššgPŒ
, 
¡d
::
¡ršg
 &
¡r
) {

359 cÚ¡ *
c¡r
;

360 ià(!
decode_¡ršg
(
bufPŒ
, 
»maššgPŒ
, &
c¡r
))

361  
	gçl£
;

362 
	g¡r
 = 
c¡r
;

363  
	gŒue
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/Timer.h

21 #iâdeà
HYPERTABLE_TIMER_H


22 
	#HYPERTABLE_TIMER_H


	)

24 
	~<boo¡/th»ad/xtime.hµ
>

26 
	~"Di¥©chHªdËr.h
"

28 
Çme¥aû
 
	gHy³¹abË
 {

30 
	sTim”T
 {

31 
	gboo¡
::
xtime
 
expœeTime
;

32 
Di¥©chHªdËr
 *
	ghªdËr
;

35 
	sÉTim”
 {

36 
boŞ
 
İ”©Ü
()(cÚ¡ 
	gTim”T
 &
	gt1
, cÚ¡ Tim”T &
	gt2
) const {

37  
xtime_cmp
(
t1
.
expœeTime
, 
t2
.expireTime) >= 0;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/sampleClient.cc

21 
	~<queue
>

22 
	~<c¡dio
>

23 
	~<io¡»am
>

24 
	~<f¡»am
>

25 
	~<¡ršg
>

26 
usšg
 
Çme¥aû
 
	g¡d
;

29 
	~<Ãtdb.h
>

30 
	~<”ºo.h
>

31 
	~<pŞl.h
>

32 
	~<±h»ad.h
>

33 
	~<¡dšt.h
>

34 
	~<¡ršg.h
>

35 
	~<time.h
>

38 
	~<boo¡/th»ad/cÚd™iÚ.hµ
>

39 
	~<boo¡/th»ad/mu‹x.hµ
>

40 
	~<boo¡/th»ad/th»ad.hµ
>

42 
	~"CommÚ/E¼Ü.h
"

43 
	~"CommÚ/IÃtAddr.h
"

44 
	~"CommÚ/Logg”.h
"

45 
	~"CommÚ/Sy¡em.h
"

46 
	~"CommÚ/U§ge.h
"

48 
	~"Di¥©chHªdËr.h
"

49 
	~"Comm.h
"

50 
	~"Ev’t.h
"

51 
	~"H—d”Bud”.h
"

52 
	~"S”Ÿliz©iÚ.h
"

54 
usšg
 
Çme¥aû
 
Hy³¹abË
;

56 
	gÇme¥aû
 {

57 cÚ¡ *
	gDEFAULT_HOST
 = "localhost";

58 cÚ¡ 
	gDEFAULT_PORT
 = 11255;

59 cÚ¡ 
	gDEFAULT_TIMEOUT
 = 10;

60 cÚ¡ *
	gu§ge
[] = {

81 
boŞ
 
	ggV”bo£
 = 
çl£
;

91 şas 
	cRe¥Ú£HªdËr
 : 
public
 
Di¥©chHªdËr
 {

93 
public
:

95 
	$Re¥Ú£HªdËr
(è: 
	`m_queue
(), 
	`m_mu‹x
(), 
	$m_cÚd
() { ; }

96 
vœtu®
 ~
	$Re¥Ú£HªdËr
(è{ ; 
	}
}

98 
vœtu®
 
hªdË
(
Ev’tPŒ
 &
ev’tPŒ
) = 0;

100 
vœtu®
 
boŞ
 
g‘_»¥Ú£
(
Ev’tPŒ
 &
ev’tPŒ
) = 0;

102 
	g´Ùeùed
:

103 
queue
<
Ev’tPŒ
> 
m_queue
;

104 
	gboo¡
::
mu‹x
 
m_mu‹x
;

105 
	gboo¡
::
cÚd™iÚ
 
m_cÚd
;

118 şas 
	cRe¥Ú£HªdËrTCP
 : 
public
 
Re¥Ú£HªdËr
 {

120 
public
:

122 
	$Re¥Ú£HªdËrTCP
(è: 
	`Re¥Ú£HªdËr
(), 
	$m_cÚÃùed
(
çl£
) { ; }

124 
vœtu®
 
	$hªdË
(
Ev’tPŒ
 &
ev’tPŒ
) {

125 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

126 ià(
ev’tPŒ
->
ty³
 =ğ
Ev’t
::
CONNECTION_ESTABLISHED
) {

127 ià(
gV”bo£
)

128 
	`HT_INFOF
("CÚÃùiÚ E¡ablished - %s", 
ev’tPŒ
->
	`toSŒšg
().
	`c_¡r
());

129 
m_cÚÃùed
 = 
Œue
;

130 
m_cÚd
.
	`nÙify_Úe
();

132 ià(
ev’tPŒ
->
ty³
 =ğ
Ev’t
::
DISCONNECT
) {

133 ià(
ev’tPŒ
->
”rÜ
 != 0) {

134 
	`HT_INFOF
("DiscÚÃù : %s", 
E¼Ü
::
	`g‘_‹xt
(
ev’tPŒ
->
”rÜ
));

137 
	`HT_INFO
("Disconnect.");

139 
m_cÚÃùed
 = 
çl£
;

140 
m_cÚd
.
	`nÙify_Úe
();

142 ià(
ev’tPŒ
->
ty³
 =ğ
Ev’t
::
ERROR
) {

143 
	`HT_INFOF
("E¼Ü : %s", 
E¼Ü
::
	`g‘_‹xt
(
ev’tPŒ
->
”rÜ
));

146 ià(
ev’tPŒ
->
ty³
 =ğ
Ev’t
::
MESSAGE
) {

147 
m_queue
.
	`push
(
ev’tPŒ
);

148 
m_cÚd
.
	`nÙify_Úe
();

150 
	}
}

152 
boŞ
 
	$wa™_fÜ_cÚÃùiÚ
() {

153 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

154 ià(
m_cÚÃùed
)

155  
Œue
;

156 
m_cÚd
.
	`wa™
(
lock
);

157  
m_cÚÃùed
;

158 
	}
}

160 
vœtu®
 
boŞ
 
	$g‘_»¥Ú£
(
Ev’tPŒ
 &
ev’tPŒ
) {

161 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

162 
m_queue
.
	`em±y
()) {

163 ià(
m_cÚÃùed
 =ğ
çl£
)

164  
çl£
;

165 
m_cÚd
.
	`wa™
(
lock
);

167 
ev’tPŒ
 = 
m_queue
.
	`äÚt
();

168 
m_queue
.
	`pİ
();

169  
Œue
;

170 
	}
}

172 
	g´iv©e
:

173 
boŞ
 
m_cÚÃùed
;

182 şas 
	cHªdËrFaùÜy
 : 
public
 
CÚÃùiÚHªdËrFaùÜy
 {

183 
public
:

184 
	$HªdËrFaùÜy
(
Di¥©chHªdËrPŒ
 &
dhp
) {

185 
m_di¥©ch_hªdËr_±r
 = 
dhp
;

187 
vœtu®
 
	$g‘_š¡ªû
(
Di¥©chHªdËrPŒ
 &
dhp
) {

188 
dhp
 = 
m_di¥©ch_hªdËr_±r
;

189 
	}
}

190 
	g´iv©e
:

191 
Di¥©chHªdËrPŒ
 
m_di¥©ch_hªdËr_±r
;

202 şas 
	cRe¥Ú£HªdËrUDP
 : 
public
 
Re¥Ú£HªdËr
 {

204 
public
:

206 
	$Re¥Ú£HªdËrUDP
(è: 
	$Re¥Ú£HªdËr
() { ; }

208 
vœtu®
 
	$hªdË
(
Ev’tPŒ
 &
ev’tPŒ
) {

209 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

210 ià(
ev’tPŒ
->
ty³
 =ğ
Ev’t
::
MESSAGE
) {

211 
m_queue
.
	`push
(
ev’tPŒ
);

212 
m_cÚd
.
	`nÙify_Úe
();

215 
	`HT_INFOF
("%s", 
ev’tPŒ
->
	`toSŒšg
().
	`c_¡r
());

218 
	}
}

220 
vœtu®
 
boŞ
 
	$g‘_»¥Ú£
(
Ev’tPŒ
 &
ev’tPŒ
) {

221 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

222 
m_queue
.
	`em±y
()) {

223 
m_cÚd
.
	`wa™
(
lock
);

225 
ev’tPŒ
 = 
m_queue
.
	`äÚt
();

226 
m_queue
.
	`pİ
();

227  
Œue
;

228 
	}
}

238 
	$maš
(
¬gc
, **
¬gv
) {

239 
Comm
 *
comm
;

240 
rv®
;

241 cÚ¡ *
ho¡
 = 
DEFAULT_HOST
;

242 
sockaddr_š
 
addr
;

243 
ušt16_t
 
pÜt
 = 
DEFAULT_PORT
;

244 
time_t
 
timeout
 = 
DEFAULT_TIMEOUT
;

245 
»aùÜCouÁ
 = 1;

246 cÚ¡ *
šputFe
 = 0;

247 
H—d”Bud”
 
hbud”
;

248 
”rÜ
;

249 
Ev’tPŒ
 
ev’tPŒ
;

250 
CÚÃùiÚHªdËrFaùÜyPŒ
 
chfPŒ
;

251 
Di¥©chHªdËrPŒ
 
dhp
;

252 
Re¥Ú£HªdËr
 *
»¥HªdËr
;

253 
boŞ
 
udpMode
 = 
çl£
;

254 
¡ršg
 
lše
;

255 
out¡ªdšg
 = 0;

256 
maxOut¡ªdšg
 = 50;

257 cÚ¡ *
¡r
;

258 
sockaddr_š
 
loÿlAddr
;

260 
	`mem£t
(&
loÿlAddr
, 0, (localAddr));

262 ià(
¬gc
 == 1)

263 
U§ge
::
	`dump_ªd_ex™
(
u§ge
);

265 
Sy¡em
::
	`š™Ÿlize
(
¬gv
[0]);

266 
R—ùÜFaùÜy
::
	`š™Ÿlize
(1);

268 
i
=1; i<
¬gc
; i++) {

269 ià(!
	`¡ºcmp
(
¬gv
[
i
], "--host=", 7))

270 
ho¡
 = &
¬gv
[
i
][7];

271 ià(!
	`¡ºcmp
(
¬gv
[
i
], "--port=", 7)) {

272 
rv®
 = 
	`©oi
(&
¬gv
[
i
][7]);

273 ià(
rv®
 <= 1024 ||„val > 65535) {

274 
û¼
 << "Inv®id…Üt. Mu¡ bšh¿ngoà1024-65535." << 
’dl
;

275 
	`ex™
(1);

277 
pÜt
 = 
rv®
;

279 ià(!
	`¡ºcmp
(
¬gv
[
i
], "--timeout=", 10))

280 
timeout
 = (
time_t
)
	`©oi
(&
¬gv
[
i
][10]);

281 ià(!
	`¡rcmp
(
¬gv
[
i
], "--udp"))

282 
udpMode
 = 
Œue
;

283 ià(!
	`¡ºcmp
(
¬gv
[
i
], "--reactors=", 11))

284 
»aùÜCouÁ
 = 
	`©oi
(&
¬gv
[
i
][11]);

285 ià(!
	`¡ºcmp
(
¬gv
[
i
], "--recv-addr=", 12)) {

286 ià(!
IÃtAddr
::
	`š™Ÿlize
(&
loÿlAddr
, &
¬gv
[
i
][12]))

287 
DUMP_CORE
;

289 ià(!
	`¡rcmp
(
¬gv
[
i
], "--verbose")) {

290 
gV”bo£
 = 
Œue
;

292 ià(
šputFe
 == 0)

293 
šputFe
 = 
¬gv
[
i
];

295 
U§ge
::
	`dump_ªd_ex™
(
u§ge
);

298 ià(
šputFe
 == 0)

299 
U§ge
::
	`dump_ªd_ex™
(
u§ge
);

301 ià(!
IÃtAddr
::
	`š™Ÿlize
(&
addr
, 
ho¡
, 
pÜt
))

302 
	`ex™
(1);

304 
comm
 = 
Ãw
 
	`Comm
();

306 
if¡»am
 
	`myfe
(
šputFe
);

308 ià(!
myfe
.
	`is_İ’
()) {

309 
	`HT_ERRORF
("UÇbËØİ’ f'%s' : %s", 
šputFe
, 
	`¡»¼Ü
(
”ºo
));

313 ià(
udpMode
) {

314 
	`as£¹
(
loÿlAddr
.
sš_pÜt
 == 0);

315 
»¥HªdËr
 = 
Ãw
 
	`Re¥Ú£HªdËrUDP
();

316 
dhp
 = 
»¥HªdËr
;

317 
pÜt
++;

318 
IÃtAddr
::
	`š™Ÿlize
(&
loÿlAddr
, 
INADDR_ANY
, 
pÜt
);

319 ià((
”rÜ
 = 
comm
->
	`ü—‹_d©ag¿m_»ûive_sock‘
(&
loÿlAddr
, 
dhp
)è!ğ
E¼Ü
::
OK
) {

320 
¡d
::
¡ršg
 
¡r
;

321 
	`HT_ERRORF
("ProbËm c»©šg UDP„eûivsock‘ % - %s", 
IÃtAddr
::
	`¡ršg_fÜm©
(
¡r
, 
loÿlAddr
), 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

322 
	`ex™
(1);

326 
»¥HªdËr
 = 
Ãw
 
	`Re¥Ú£HªdËrTCP
();

327 
dhp
 = 
»¥HªdËr
;

329 ià(
loÿlAddr
.
sš_pÜt
 == 0) {

330 ià((
”rÜ
 = 
comm
->
	`cÚÃù
(
addr
, 
dhp
)è!ğ
E¼Ü
::
OK
) {

331 
	`HT_ERRORF
("Comm::cÚÃùƒ¼Ü - %s", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

332 
	`ex™
(1);

336 
chfPŒ
 = 
Ãw
 
	`HªdËrFaùÜy
(
dhp
);

337 ià((
”rÜ
 = 
comm
->
	`li¡’
(
loÿlAddr
, 
chfPŒ
, 
dhp
)è!ğ
E¼Ü
::
OK
) {

338 
	`HT_ERRORF
("Comm::li¡’ƒ¼Ü - %s", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

339 
	`ex™
(1);

342 ià(!((
Re¥Ú£HªdËrTCP
 *)
»¥HªdËr
)->
	`wa™_fÜ_cÚÃùiÚ
())

343 
	`ex™
(1);

347 !
myfe
.
	`eof
() ) {

348 
	`g‘lše
 (
myfe
,
lše
);

349 ià(
lše
.
	`Ëngth
() > 0) {

350 
CommBufPŒ
 
	`cbufPŒ
Ğ
Ãw
 
	`CommBuf
(
hbud”
, 
S”Ÿliz©iÚ
::
	`’coded_Ëngth_¡ršg
(
lše
)) );

351 
cbufPŒ
->
	`­³nd_¡ršg
(
lše
);

352 
»Œ›s
 = 0;

354 ià(
udpMode
) {

355 ià((
”rÜ
 = 
comm
->
	`£nd_d©ag¿m
(
addr
, 
loÿlAddr
, 
cbufPŒ
)è!ğ
E¼Ü
::
OK
) {

356 
	`HT_ERRORF
("ProbËm s’dšg d©ag¿m - %s", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

361 (
”rÜ
 = 
comm
->
	`£nd_»que¡
(
addr
, 
timeout
, 
cbufPŒ
, 
»¥HªdËr
)è!ğ
E¼Ü
::
OK
) {

362 ià(
”rÜ
 =ğ
E¼Ü
::
COMM_NOT_CONNECTED
) {

363 ià(
»Œ›s
 == 5) {

364 
	`HT_ERROR
("Connectionimeout.");

367 
	`pŞl
(0, 0, 1000);

368 
»Œ›s
++;

371 
	`HT_ERRORF
("CommEngše::£nd_mes§g»tuºed '%s'", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

376 
out¡ªdšg
++;

378 ià(
out¡ªdšg
 > 
maxOut¡ªdšg
) {

379 ià(!
»¥HªdËr
->
	`g‘_»¥Ú£
(
ev’tPŒ
))

381 ià(!
S”Ÿliz©iÚ
::
	`decode_¡ršg
(&
ev’tPŒ
->
mes§ge
, &ev’tPŒ->
mes§geL’
, &
¡r
))

382 
cout
 << "ERROR: de£rŸliz©iÚ…robËm." << 
’dl
;

384 ià(*
¡r
 != 0)

385 
cout
 << "ECHO: " << 
¡r
 << 
’dl
;

387 
cout
 << "[NULL]" << 
’dl
;

389 
out¡ªdšg
--;

394 
out¡ªdšg
 > 0 && 
»¥HªdËr
->
	`g‘_»¥Ú£
(
ev’tPŒ
)) {

395 ià(!
S”Ÿliz©iÚ
::
	`decode_¡ršg
(&
ev’tPŒ
->
mes§ge
, &ev’tPŒ->
mes§geL’
, &
¡r
))

396 
cout
 << "ERROR: de£rŸliz©iÚ…robËm." << 
’dl
;

398 ià(
¡r
 != 0)

399 
cout
 << "ECHO: " << 
¡r
 << 
’dl
;

401 
cout
 << "[NULL]" << 
’dl
;

404 
out¡ªdšg
--;

408 
myfe
.
	`şo£
();

410 
d–‘e
 
comm
;

412 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/testServer.cc

21 
	~<io¡»am
>

22 
	~<queue
>

23 
	~<¡ršg
>

24 
usšg
 
Çme¥aû
 
	g¡d
;

27 
	~<¬·/š‘.h
>

28 
	~<Ãtš‘/š.h
>

29 
	~<pŞl.h
>

30 
	~<±h»ad.h
>

31 
	~<¡dšt.h
>

32 
	~<¡ršg.h
>

33 
	~<sys/sock‘.h
>

34 
	~<sys/ty³s.h
>

35 
	~<time.h
>

38 
	~"AsyncComm/AµliÿtiÚHªdËr.h
"

39 
	~"AsyncComm/AµliÿtiÚQueue.h
"

40 
	~"AsyncComm/CÚÃùiÚHªdËrFaùÜy.h
"

41 
	~"AsyncComm/H—d”Bud”.h
"

43 
	~"CommÚ/E¼Ü.h
"

44 
	~"CommÚ/IÃtAddr.h
"

45 
	~"CommÚ/Sy¡em.h
"

46 
	~"CommÚ/SockAddrM­.h
"

47 
	~"CommÚ/U§ge.h
"

49 
	~"Di¥©chHªdËr.h
"

50 
	~"Comm.h
"

51 
	~"Ev’t.h
"

52 
usšg
 
Çme¥aû
 
Hy³¹abË
;

55 
	gÇme¥aû
 {

57 
	ggD–ay
 = 0;

58 
boŞ
 
	ggV”bo£
 = 
çl£
;

59 cÚ¡ 
	gDEFAULT_PORT
 = 11255;

60 cÚ¡ *
	gu§ge
[] = {

84 şas 
	cReque¡HªdËr
 : 
public
 
AµliÿtiÚHªdËr
 {

85 
public
:

87 
Reque¡HªdËr
(
Comm
 *
comm
, 
Ev’tPŒ
 &
ev’tPŒ
è: 
AµliÿtiÚHªdËr
Óv’tPŒ), 
m_comm
(comm) { ; }

89 
vœtu®
 
run
() {

90 
	gm_h—d”_bud”
.
š™Ÿlize_äom_»que¡
(
m_ev’t_±r
->
h—d”
);

91 
CommBufPŒ
 
cbufPŒ
Ğ
Ãw
 
CommBuf
(
m_h—d”_bud”
, 
m_ev’t_±r
->
mes§geL’
) );

92 
	gcbufPŒ
->
­³nd_by‹s
((
ušt8_t
 *)
m_ev’t_±r
->
mes§ge
, m_ev’t_±r->
mes§geL’
);

93 
	g”rÜ
 = 
m_comm
->
£nd_»¥Ú£
(
m_ev’t_±r
->
addr
, 
cbufPŒ
);

94 ià(
	g”rÜ
 !ğ
E¼Ü
::
OK
) {

95 
HT_ERRORF
("Comm::£nd_»¥Ú£„‘uºed %s", 
E¼Ü
::
g‘_‹xt
(
”rÜ
));

98 
	g´iv©e
:

99 
Comm
 *
m_comm
;

100 
H—d”Bud”
 
	gm_h—d”_bud”
;

108 şas 
	cDi¥©ch”
 : 
public
 
Di¥©chHªdËr
 {

110 
public
:

112 
Di¥©ch”
(
Comm
 *
comm
, 
AµliÿtiÚQueue
 *
­pQueue
è: 
m_comm
(comm), 
m_­p_queue
(appQueue) { ; }

114 
vœtu®
 
hªdË
(
Ev’tPŒ
 &
ev’tPŒ
) {

115 ià(
	ggV”bo£
 && 
	gev’tPŒ
->
	gty³
 =ğ
Ev’t
::
CONNECTION_ESTABLISHED
) {

116 
HT_INFO
("Connection Established.");

118 ià(
	ggV”bo£
 && 
	gev’tPŒ
->
	gty³
 =ğ
Ev’t
::
DISCONNECT
) {

119 ià(
ev’tPŒ
->
”rÜ
 != 0) {

120 
HT_INFOF
("DiscÚÃù : %s", 
E¼Ü
::
g‘_‹xt
(
ev’tPŒ
->
”rÜ
));

123 
HT_INFO
("Disconnect.");

126 ià(
	gev’tPŒ
->
	gty³
 =ğ
Ev’t
::
ERROR
) {

127 
HT_WARNF
("E¼Ü : %s", 
E¼Ü
::
g‘_‹xt
(
ev’tPŒ
->
”rÜ
));

129 ià(
	gev’tPŒ
->
	gty³
 =ğ
Ev’t
::
MESSAGE
) {

130 ià(
m_­p_queue
 == 0) {

131 
m_h—d”_bud”
.
š™Ÿlize_äom_»que¡
(
ev’tPŒ
->
h—d”
);

132 
CommBufPŒ
 
cbufPŒ
Ğ
Ãw
 
CommBuf
(
m_h—d”_bud”
, 
ev’tPŒ
->
mes§geL’
) );

133 
	gcbufPŒ
->
­³nd_by‹s
((
ušt8_t
 *)
ev’tPŒ
->
mes§ge
,ƒv’tPŒ->
mes§geL’
);

134 ià(
	ggD–ay
 > 0)

135 
pŞl
(0, 0, 
gD–ay
);

136 
	g”rÜ
 = 
m_comm
->
£nd_»¥Ú£
(
ev’tPŒ
->
addr
, 
cbufPŒ
);

137 ià(
	g”rÜ
 !ğ
E¼Ü
::
OK
) {

138 
HT_ERRORF
("Comm::£nd_»¥Ú£„‘uºed %s", 
E¼Ü
::
g‘_‹xt
(
”rÜ
));

142 
	gm_­p_queue
->
add
Ğ
Ãw
 
Reque¡HªdËr
(
m_comm
, 
ev’tPŒ
) );

146 
	g´iv©e
:

147 
Comm
 *
m_comm
;

148 
AµliÿtiÚQueue
 *
	gm_­p_queue
;

149 
H—d”Bud”
 
	gm_h—d”_bud”
;

158 şas 
	cUdpDi¥©ch”
 : 
public
 
Di¥©chHªdËr
 {

159 
public
:

161 
UdpDi¥©ch”
(
Comm
 *
comm
è: 
m_comm
(comm) { ; }

163 
vœtu®
 
hªdË
(
Ev’tPŒ
 &
ev’tPŒ
) {

164 ià(
	gev’tPŒ
->
	gty³
 =ğ
Ev’t
::
MESSAGE
) {

165 
m_h—d”_bud”
.
š™Ÿlize_äom_»que¡
(
ev’tPŒ
->
h—d”
);

166 
CommBufPŒ
 
cbufPŒ
Ğ
Ãw
 
CommBuf
(
m_h—d”_bud”
, 
ev’tPŒ
->
mes§geL’
) );

167 
	gcbufPŒ
->
­³nd_by‹s
((
ušt8_t
 *)
ev’tPŒ
->
mes§ge
,ƒv’tPŒ->
mes§geL’
);

168 ià(
	ggD–ay
 > 0)

169 
pŞl
(0, 0, 
gD–ay
);

170 
	g”rÜ
 = 
m_comm
->
£nd_d©ag¿m
(
ev’tPŒ
->
addr
,ƒv’tPŒ->
loÿlAddr
, 
cbufPŒ
);

171 ià(
	g”rÜ
 !ğ
E¼Ü
::
OK
) {

172 
HT_ERRORF
("Comm::£nd_»¥Ú£„‘uºed %s", 
E¼Ü
::
g‘_‹xt
(
”rÜ
));

176 
HT_ERRORF
("E¼Ü : %s", 
ev’tPŒ
->
toSŒšg
().
c_¡r
());

180 
	g´iv©e
:

181 
Comm
 *
m_comm
;

182 
H—d”Bud”
 
	gm_h—d”_bud”
;

190 şas 
	cHªdËrFaùÜy
 : 
public
 
CÚÃùiÚHªdËrFaùÜy
 {

191 
public
:

192 
HªdËrFaùÜy
(
Di¥©chHªdËrPŒ
 &
dhp
è: 
m_di¥©ch_hªdËr_±r
(dhp) { ; }

194 
vœtu®
 
g‘_š¡ªû
(
Di¥©chHªdËrPŒ
 &
dhp
) {

195 
	gdhp
 = 
m_di¥©ch_hªdËr_±r
;

198 
	g´iv©e
:

199 
Di¥©chHªdËrPŒ
 
m_di¥©ch_hªdËr_±r
;

208 
	$maš
(
¬gc
, **
¬gv
) {

209 
Comm
 *
comm
;

210 
rv®
, 
”rÜ
;

211 
ušt16_t
 
pÜt
 = 
DEFAULT_PORT
;

212 
»aùÜCouÁ
 = 2;

213 
CÚÃùiÚHªdËrFaùÜyPŒ
 
chfPŒ
;

214 
AµliÿtiÚQueue
 *
­pQueue
 = 0;

215 
boŞ
 
udp
 = 
çl£
;

216 
Di¥©chHªdËrPŒ
 
dhp
;

217 
sockaddr_š
 
loÿlAddr
;

218 
sockaddr_š
 
ş›ÁAddr
;

220 
	`mem£t
(&
ş›ÁAddr
, 0, (clientAddr));

222 
i
=1; i<
¬gc
; i++) {

223 ià(!
	`¡rcmp
(
¬gv
[
i
], "--help"))

224 
U§ge
::
	`dump_ªd_ex™
(
u§ge
);

225 ià(!
	`¡rcmp
(
¬gv
[
i
], "--app-queue")) {

226 
­pQueue
 = 
Ãw
 
	`AµliÿtiÚQueue
(5);

228 ià(!
	`¡ºcmp
(
¬gv
[
i
], "--connect-to=", 13)) {

229 ià(!
IÃtAddr
::
	`š™Ÿlize
(&
ş›ÁAddr
, &
¬gv
[
i
][13]))

230 
DUMP_CORE
;

232 ià(!
	`¡ºcmp
(
¬gv
[
i
], "--port=", 7)) {

233 
rv®
 = 
	`©oi
(&
¬gv
[
i
][7]);

234 ià(
rv®
 <= 1024 ||„val > 65535) {

235 
û¼
 << "Inv®id…Üt. Mu¡ bšh¿ngoà1024-65535." << 
’dl
;

236 
	`ex™
(1);

238 
pÜt
 = (
ušt16_t
)
rv®
;

240 ià(!
	`¡ºcmp
(
¬gv
[
i
], "--reactors=", 11))

241 
»aùÜCouÁ
 = 
	`©oi
(&
¬gv
[
i
][11]);

242 ià(!
	`¡ºcmp
(
¬gv
[
i
], "--delay=", 8))

243 
gD–ay
 = 
	`©oi
(&
¬gv
[
i
][8]);

244 ià(!
	`¡rcmp
(
¬gv
[
i
], "--udp"))

245 
udp
 = 
Œue
;

246 ià(!
	`¡rcmp
(
¬gv
[
i
], "--verbose") || !strcmp(argv[i], "-v"))

247 
gV”bo£
 = 
Œue
;

249 
U§ge
::
	`dump_ªd_ex™
(
u§ge
);

252 
Sy¡em
::
	`š™Ÿlize
(
¬gv
[0]);

253 
R—ùÜFaùÜy
::
	`š™Ÿlize
(
»aùÜCouÁ
);

255 
comm
 = 
Ãw
 
	`Comm
();

257 ià(
gV”bo£
) {

258 
cout
 << "Li¡’šg oÀpÜˆ" << 
pÜt
 << 
’dl
;

259 ià(
gD–ay
)

260 
cout
 << "D–ay = " << 
gD–ay
 << 
’dl
;

263 
IÃtAddr
::
	`š™Ÿlize
(&
loÿlAddr
, "loÿlho¡", 
pÜt
);

265 ià(!
udp
) {

266 
dhp
 = 
Ãw
 
	`Di¥©ch”
(
comm
, 
­pQueue
);

268 ià(
ş›ÁAddr
.
sš_pÜt
 != 0) {

269 ià((
”rÜ
 = 
comm
->
	`cÚÃù
(
ş›ÁAddr
, 
loÿlAddr
, 
dhp
)è!ğ
E¼Ü
::
OK
) {

270 
	`HT_ERRORF
("Comm::cÚÃùƒ¼Ü - %s", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

271 
	`ex™
(1);

275 
chfPŒ
 = 
Ãw
 
	`HªdËrFaùÜy
(
dhp
);

276 ià((
”rÜ
 = 
comm
->
	`li¡’
(
loÿlAddr
, 
chfPŒ
, 
dhp
)è!ğ
E¼Ü
::
OK
) {

277 
	`HT_ERRORF
("Comm::li¡’ƒ¼Ü - %s", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

278 
	`ex™
(1);

283 
	`as£¹
(
ş›ÁAddr
.
sš_pÜt
 == 0);

284 
dhp
 = 
Ãw
 
	`UdpDi¥©ch”
(
comm
);

285 
”rÜ
 = 
comm
->
	`ü—‹_d©ag¿m_»ûive_sock‘
(&
loÿlAddr
, 
dhp
);

288 
	`pŞl
(0, 0, -1);

290 
d–‘e
 
comm
;

292 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/tests/CommTestDatagramThreadFunction.cc

21 
	~<io¡»am
>

22 
	~<f¡»am
>

23 
	~<queue
>

26 
	~<pŞl.h
>

29 
	~<boo¡/th»ad/cÚd™iÚ.hµ
>

30 
	~<boo¡/th»ad/mu‹x.hµ
>

31 
	~<boo¡/th»ad/th»ad.hµ
>

33 
	~"CommÚ/E¼Ü.h
"

34 
	~"CommÚ/IÃtAddr.h
"

36 
	~"AsyncComm/Comm.h
"

37 
	~"AsyncComm/Di¥©chHªdËr.h
"

38 
	~"AsyncComm/Ev’t.h
"

39 
	~"AsyncComm/H—d”Bud”.h
"

40 
	~"AsyncComm/S”Ÿliz©iÚ.h
"

42 
	~"CommTe¡D©ag¿mTh»adFunùiÚ.h
"

44 
usšg
 
Çme¥aû
 
Hy³¹abË
;

45 
usšg
 
Çme¥aû
 
	g¡d
;

47 
	gÇme¥aû
 {

55 şas 
	cRe¥Ú£HªdËr
 : 
public
 
Di¥©chHªdËr
 {

57 
public
:

59 
Re¥Ú£HªdËr
(è: 
m_queue
(), 
m_mu‹x
(), 
m_cÚd
() { ; }

61 
vœtu®
 
hªdË
(
Ev’tPŒ
 &
ev’tPŒ
) {

62 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

63 ià(
	gev’tPŒ
->
	gty³
 =ğ
Ev’t
::
MESSAGE
) {

64 
m_queue
.
push
(
ev’tPŒ
);

65 
	gm_cÚd
.
nÙify_Úe
();

68 
HT_INFOF
("%s", 
ev’tPŒ
->
toSŒšg
().
c_¡r
());

73 
vœtu®
 
boŞ
 
g‘_»¥Ú£
(
Ev’tPŒ
 &
ev’tPŒ
) {

74 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

75 
	gm_queue
.
em±y
()) {

76 
	gm_cÚd
.
wa™
(
lock
);

78 
	gev’tPŒ
 = 
m_queue
.
äÚt
();

79 
	gm_queue
.
pİ
();

80  
	gŒue
;

83 
	g´iv©e
:

84 
queue
<
Ev’tPŒ
> 
m_queue
;

85 
	gboo¡
::
mu‹x
 
m_mu‹x
;

86 
	gboo¡
::
cÚd™iÚ
 
m_cÚd
;

95 
	gCommTe¡D©ag¿mTh»adFunùiÚ
::
	$İ”©Ü
()() {

96 
H—d”Bud”
 
	`hbud”
(
H—d”
::
PROTOCOL_NONE
, 
	`¿nd
());

97 
”rÜ
;

98 
Ev’tPŒ
 
ev’tPŒ
;

99 
out¡ªdšg
 = 0;

100 
maxOut¡ªdšg
 = 50;

101 
¡ršg
 
lše
;

102 
if¡»am
 
	`šfe
(
m_šput_fe
);

103 
of¡»am
 
	`outfe
(
m_ouut_fe
);

104 cÚ¡ *
¡r
;

105 
n£Á
 = 0;

106 
sockaddr_š
 
loÿlAddr
;

107 
Re¥Ú£HªdËr
 *
»¥HªdËr
 = 
Ãw
 
	`Re¥Ú£HªdËr
();

108 
Di¥©chHªdËrPŒ
 
	`di¥©chHªdËrPŒ
(
»¥HªdËr
);

110 
IÃtAddr
::
	`š™Ÿlize
(&
loÿlAddr
, 
INADDR_ANY
, 
m_pÜt
);

112 ià((
”rÜ
 = 
m_comm
->
	`ü—‹_d©ag¿m_»ûive_sock‘
(&
loÿlAddr
, 
di¥©chHªdËrPŒ
)è!ğ
E¼Ü
::
OK
) {

113 
	`HT_ERRORF
("ProbËm o³nšg d©ag¿m„eûivpÜˆ%d - %s", 
m_pÜt
, 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

117 ià(
šfe
.
	`is_İ’
()) {

118 !
šfe
.
	`eof
(è&& 
n£Á
 < 
MAX_MESSAGES
) {

119 
	`g‘lše
 (
šfe
,
lše
);

120 ià(
šfe
.
	`ç
())

123 
CommBufPŒ
 
	`cbufPŒ
Ğ
Ãw
 
	`CommBuf
(
hbud”
, 
S”Ÿliz©iÚ
::
	`’coded_Ëngth_¡ršg
(
lše
)) );

124 
cbufPŒ
->
	`­³nd_¡ršg
(
lše
);

125 ià((
”rÜ
 = 
m_comm
->
	`£nd_d©ag¿m
(
m_addr
, 
loÿlAddr
, 
cbufPŒ
)è!ğ
E¼Ü
::
OK
) {

126 
	`HT_ERRORF
("ProbËm s’dšg d©ag¿m - %s", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

129 
out¡ªdšg
++;

131 ià(
out¡ªdšg
 > 
maxOut¡ªdšg
) {

132 ià(!
»¥HªdËr
->
	`g‘_»¥Ú£
(
ev’tPŒ
))

134 ià(!
S”Ÿliz©iÚ
::
	`decode_¡ršg
(&
ev’tPŒ
->
mes§ge
, &ev’tPŒ->
mes§geL’
, &
¡r
))

135 
outfe
 << "ERROR: de£rŸliz©iÚ…robËm." << 
’dl
;

137 ià(*
¡r
 != 0)

138 
outfe
 << 
¡r
 << 
’dl
;

140 
outfe
 << 
’dl
;

142 
out¡ªdšg
--;

144 
n£Á
++;

147 
šfe
.
	`şo£
();

150 
	`HT_ERRORF
("UÇbËØİ’ f'%s' : %s", 
m_šput_fe
, 
	`¡»¼Ü
(
”ºo
));

154 
out¡ªdšg
 > 0 && 
»¥HªdËr
->
	`g‘_»¥Ú£
(
ev’tPŒ
)) {

155 ià(!
S”Ÿliz©iÚ
::
	`decode_¡ršg
(&
ev’tPŒ
->
mes§ge
, &ev’tPŒ->
mes§geL’
, &
¡r
))

156 
outfe
 << "ERROR: de£rŸliz©iÚ…robËm." << 
’dl
;

158 ià(*
¡r
 != 0)

159 
outfe
 << 
¡r
 << 
’dl
;

161 
outfe
 << 
’dl
;

164 
out¡ªdšg
--;

166 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/tests/CommTestDatagramThreadFunction.h

22 
	~<Ãtš‘/š.h
>

25 
	#MAX_MESSAGES
 50000

	)

30 
Çme¥aû
 
Hy³¹abË
 {

31 
şass
 
Comm
;

34 şas 
	cCommTe¡D©ag¿mTh»adFunùiÚ
 {

35 
public
:

36 
CommTe¡D©ag¿mTh»adFunùiÚ
(
Hy³¹abË
::
Comm
 *
comm
, 
sockaddr_š
 &
addr
, cÚ¡ *
šput
è: 
m_comm
(comm), 
	$m_addr
(
addr
) {

37 
m_šput_fe
 = 
šput
;

38 
m_pÜt
 = 0;

40 
	$£t_ouut_fe
(cÚ¡ *
ouut
) {

41 
m_ouut_fe
 = 
ouut
;

42 
	}
}

43 
	$£t_»ûive_pÜt
(
ušt16_t
 
pÜt
è{ 
m_pÜt
 =…Üt; 
	}
}

44 
İ”©Ü
()();

46 
´iv©e
:

47 
Hy³¹abË
::
Comm
 *
m_comm
;

48 
sockaddr_š
 
m_addr
;

49 cÚ¡ *
m_šput_fe
;

50 cÚ¡ *
m_ouut_fe
;

51 
ušt16_t
 
m_pÜt
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/tests/CommTestThreadFunction.cc

21 
	~<io¡»am
>

22 
	~<f¡»am
>

23 
	~<queue
>

26 
	~<pŞl.h
>

29 
	~<boo¡/th»ad/cÚd™iÚ.hµ
>

30 
	~<boo¡/th»ad/mu‹x.hµ
>

31 
	~<boo¡/th»ad/th»ad.hµ
>

33 
	~"CommÚ/E¼Ü.h
"

35 
	~"AsyncComm/Comm.h
"

36 
	~"AsyncComm/Di¥©chHªdËr.h
"

37 
	~"AsyncComm/Ev’t.h
"

38 
	~"AsyncComm/H—d”Bud”.h
"

39 
	~"AsyncComm/S”Ÿliz©iÚ.h
"

41 
	~"CommTe¡Th»adFunùiÚ.h
"

43 
usšg
 
Çme¥aû
 
Hy³¹abË
;

44 
usšg
 
Çme¥aû
 
	g¡d
;

46 
	gÇme¥aû
 {

51 şas 
	cRe¥Ú£HªdËr
 : 
public
 
Di¥©chHªdËr
 {

53 
public
:

55 
Re¥Ú£HªdËr
(è: 
m_queue
(), 
m_mu‹x
(), 
m_cÚd
(), 
m_cÚÃùed
(
Œue
) { ; }

57 
vœtu®
 
hªdË
(
Ev’tPŒ
 &
ev’tPŒ
) {

58 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

59 ià(
	gev’tPŒ
->
	gty³
 =ğ
Ev’t
::
MESSAGE
) {

60 
m_queue
.
push
(
ev’tPŒ
);

61 
	gm_cÚd
.
nÙify_Úe
();

64 
	gev’tPŒ
->
di¥Ïy
();

65 
	gm_cÚÃùed
 = 
çl£
;

66 
	gm_cÚd
.
nÙify_Úe
();

70 
boŞ
 
g‘_»¥Ú£
(
Ev’tPŒ
 &
ev’tPŒ
) {

71 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

72 
	gm_queue
.
em±y
()) {

73 
	gm_cÚd
.
wa™
(
lock
);

74 ià(
	gm_cÚÃùed
 =ğ
çl£
)

75  
çl£
;

77 
	gev’tPŒ
 = 
m_queue
.
äÚt
();

78 
	gm_queue
.
pİ
();

79  
	gŒue
;

82 
	g´iv©e
:

83 
queue
<
Ev’tPŒ
> 
m_queue
;

84 
	gboo¡
::
mu‹x
 
m_mu‹x
;

85 
	gboo¡
::
cÚd™iÚ
 
m_cÚd
;

86 
boŞ
 
	gm_cÚÃùed
;

94 
	gCommTe¡Th»adFunùiÚ
::
	$İ”©Ü
()() {

95 
H—d”Bud”
 
	`hbud”
(
H—d”
::
PROTOCOL_NONE
, 
	`¿nd
());

96 
”rÜ
;

97 
Ev’tPŒ
 
ev’tPŒ
;

98 
out¡ªdšg
 = 0;

99 
maxOut¡ªdšg
 = 50;

100 
¡ršg
 
lše
;

101 
if¡»am
 
	`šfe
(
m_šput_fe
);

102 
of¡»am
 
	`outfe
(
m_ouut_fe
);

103 cÚ¡ *
¡r
;

104 
n£Á
 = 0;

105 
Re¥Ú£HªdËr
 *
»¥HªdËr
 = 
Ãw
 
	`Re¥Ú£HªdËr
();

106 
Di¥©chHªdËrPŒ
 
	`di¥©chHªdËrPŒ
(
»¥HªdËr
);

108 ià(
šfe
.
	`is_İ’
()) {

109 !
šfe
.
	`eof
(è&& 
n£Á
 < 
MAX_MESSAGES
) {

110 
	`g‘lše
 (
šfe
,
lše
);

111 ià(
šfe
.
	`ç
())

114 
CommBufPŒ
 
	`cbufPŒ
Ğ
Ãw
 
	`CommBuf
(
hbud”
, 
S”Ÿliz©iÚ
::
	`’coded_Ëngth_¡ršg
(
lše
)) );

115 
cbufPŒ
->
	`­³nd_¡ršg
(
lše
);

116 
»Œ›s
 = 0;

117 (
”rÜ
 = 
m_comm
->
	`£nd_»que¡
(
m_addr
, 30, 
cbufPŒ
, 
»¥HªdËr
)è!ğ
E¼Ü
::
OK
) {

118 ià(
”rÜ
 =ğ
E¼Ü
::
COMM_NOT_CONNECTED
) {

119 ià(
»Œ›s
 == 5) {

120 
	`HT_ERROR
("Connectionimeout.");

123 
	`pŞl
(0, 0, 1000);

124 
»Œ›s
++;

127 
	`HT_ERRORF
("CommEngše::£nd_mes§g»tuºed '%s'", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

131 
out¡ªdšg
++;

133 ià(
out¡ªdšg
 > 
maxOut¡ªdšg
) {

134 ià(!
»¥HªdËr
->
	`g‘_»¥Ú£
(
ev’tPŒ
))

136 ià(!
S”Ÿliz©iÚ
::
	`decode_¡ršg
(&
ev’tPŒ
->
mes§ge
, &ev’tPŒ->
mes§geL’
, &
¡r
))

137 
outfe
 << "ERROR: de£rŸliz©iÚ…robËm." << 
’dl
;

139 ià(*
¡r
 != 0)

140 
outfe
 << 
¡r
 << 
’dl
;

142 
outfe
 << 
’dl
;

144 
out¡ªdšg
--;

146 
n£Á
++;

148 
šfe
.
	`şo£
();

151 
	`HT_ERRORF
("UÇbËØİ’ f'%s' : %s", 
m_šput_fe
, 
	`¡»¼Ü
(
”ºo
));

155 
out¡ªdšg
 > 0 && 
»¥HªdËr
->
	`g‘_»¥Ú£
(
ev’tPŒ
)) {

156 ià(!
S”Ÿliz©iÚ
::
	`decode_¡ršg
(&
ev’tPŒ
->
mes§ge
, &ev’tPŒ->
mes§geL’
, &
¡r
))

157 
outfe
 << "ERROR: de£rŸliz©iÚ…robËm." << 
’dl
;

159 ià(*
¡r
 != 0)

160 
outfe
 << 
¡r
 << 
’dl
;

162 
outfe
 << 
’dl
;

165 
out¡ªdšg
--;

167 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/tests/CommTestThreadFunction.h

22 
	~<Ãtš‘/š.h
>

25 
	#MAX_MESSAGES
 50000

	)

30 
Çme¥aû
 
Hy³¹abË
 {

31 
şass
 
Comm
;

34 şas 
	cCommTe¡Th»adFunùiÚ
 {

35 
public
:

36 
CommTe¡Th»adFunùiÚ
(
Hy³¹abË
::
Comm
 *
comm
, 
sockaddr_š
 &
addr
, cÚ¡ *
šput
è: 
m_comm
(comm), 
	$m_addr
(
addr
) {

37 
m_šput_fe
 = 
šput
;

39 
	$£t_ouut_fe
(cÚ¡ *
ouut
) {

40 
m_ouut_fe
 = 
ouut
;

41 
	}
}

42 
İ”©Ü
()();

44 
´iv©e
:

45 
Hy³¹abË
::
Comm
 *
m_comm
;

46 
sockaddr_š
 
m_addr
;

47 cÚ¡ *
m_šput_fe
;

48 cÚ¡ *
m_ouut_fe
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/tests/commTest.cc

21 
	~<c¡dlib
>

24 
	~<pŞl.h
>

25 
	~<sigÇl.h
>

26 
	~<sys/ty³s.h
>

27 
	~<uni¡d.h
>

30 
	~<boo¡/th»ad/th»ad.hµ
>

32 
	~"CommÚ/E¼Ü.h
"

33 
	~"CommÚ/FeUts.h
"

34 
	~"CommÚ/IÃtAddr.h
"

35 
	~"CommÚ/Te¡H¬Ãss.h
"

36 
	~"CommÚ/SŒšgExt.h
"

37 
	~"CommÚ/Sy¡em.h
"

38 
	~"CommÚ/U§ge.h
"

40 
	~"AsyncComm/Comm.h
"

41 
	~"AsyncComm/CÚÃùiÚMªag”.h
"

42 
	~"AsyncComm/Ev’t.h
"

43 
	~"AsyncComm/R—ùÜFaùÜy.h
"

45 
	~"CommTe¡Th»adFunùiÚ.h
"

47 
usšg
 
Çme¥aû
 
Hy³¹abË
;

49 
	gÇme¥aû
 {

50 cÚ¡ *
	gu§ge
[] = {

57 cÚ¡ 
	gDEFAULT_PORT
 = 32998;

58 cÚ¡ *
	gDEFAULT_PORT_ARG
 = "--port=32998";

60 şas 
	cS”v”Launch”
 {

61 
	gpublic
:

62 
S”v”Launch”
() {

63 ià((
m_chd_pid
 = 
fÜk
()) == 0) {

64 
exeş
("./‹¡S”v”", "./‹¡S”v”", 
DEFAULT_PORT_ARG
, "--app-queue", (*)0);

66 
pŞl
(0,0,2000);

68 ~
S”v”Launch”
() {

69 ià(
kl
(
m_chd_pid
, 9) == -1)

70 
³¼Ü
("kill");

72 
	g´iv©e
:

73 
pid_t
 
m_chd_pid
;

79 
	$maš
(
¬gc
, **
¬gv
) {

80 
boo¡
::
th»ad
 *
th»ad1
, *
th»ad2
;

81 
sockaddr_š
 
addr
;

82 
S”v”Launch”
 
¦aunch”
;

83 
Comm
 *
comm
;

84 
CÚÃùiÚMªag”PŒ
 
cÚnMªag”PŒ
;

86 ià(
¬gc
 != 1)

87 
U§ge
::
	`dump_ªd_ex™
(
u§ge
);

89 
	`¤ªd
(8876);

91 
Sy¡em
::
	`š™Ÿlize
(
¬gv
[0]);

92 
R—ùÜFaùÜy
::
	`š™Ÿlize
(1);

94 
IÃtAddr
::
	`š™Ÿlize
(&
addr
, "loÿlho¡", 
DEFAULT_PORT
);

96 
comm
 = 
Ãw
 
	`Comm
();

98 
cÚnMªag”PŒ
 = 
Ãw
 
	`CÚÃùiÚMªag”
(
comm
);

99 
cÚnMªag”PŒ
->
	`add
(
addr
, 5, "testServer");

100 ià(!
cÚnMªag”PŒ
->
	`wa™_fÜ_cÚÃùiÚ
(
addr
, 30)) {

101 
	`HT_ERROR
("Connectƒrror");

105 
CommTe¡Th»adFunùiÚ
 
	`th»adFunc
(
comm
, 
addr
, "./words");

107 
th»adFunc
.
	`£t_ouut_fe
("commTest.output.1");

108 
th»ad1
 = 
Ãw
 
boo¡
::
	`th»ad
(
th»adFunc
);

110 
th»adFunc
.
	`£t_ouut_fe
("commTest.output.2");

111 
th»ad2
 = 
Ãw
 
boo¡
::
	`th»ad
(
th»adFunc
);

113 
th»ad1
->
	`još
();

114 
th»ad2
->
	`još
();

116 
¡d
::
¡ršg
 
tmpFe
 = (¡d::¡ršg)"/tmp/commTe¡" + ()
	`g‘pid
();

117 
¡d
::
¡ršg
 
commªdSŒ
 = (¡d::¡ršg)"h—d -" + ()
MAX_MESSAGES
 + " ./wÜd > " + 
tmpFe
 + " ; diff " +mpFile + " commTest.output.1";

119 ià(
	`sy¡em
(
commªdSŒ
.
	`c_¡r
()))

122 
commªdSŒ
 = (
¡d
::
¡ršg
)"uÆšk " + 
tmpFe
;

123 ià(
	`sy¡em
(
commªdSŒ
.
	`c_¡r
()))

126 ià(
	`sy¡em
("diff commTest.output.1 commTest.output.2"))

129 
R—ùÜFaùÜy
::
	`de¡roy
();

131 
d–‘e
 
comm
;

132 
d–‘e
 
th»ad1
;

133 
d–‘e
 
th»ad2
;

136 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/tests/commTestDatagram.cc

21 
	~<c¡dlib
>

24 
	~<pŞl.h
>

25 
	~<sigÇl.h
>

26 
	~<sys/ty³s.h
>

27 
	~<uni¡d.h
>

30 
	~<boo¡/th»ad/th»ad.hµ
>

32 
	~"CommÚ/E¼Ü.h
"

33 
	~"CommÚ/FeUts.h
"

34 
	~"CommÚ/Te¡H¬Ãss.h
"

35 
	~"CommÚ/SŒšgExt.h
"

36 
	~"CommÚ/Sy¡em.h
"

37 
	~"CommÚ/U§ge.h
"

39 
	~"AsyncComm/Comm.h
"

40 
	~"AsyncComm/CÚÃùiÚMªag”.h
"

41 
	~"AsyncComm/Ev’t.h
"

42 
	~"AsyncComm/R—ùÜFaùÜy.h
"

44 
	~"CommTe¡D©ag¿mTh»adFunùiÚ.h
"

46 
usšg
 
Çme¥aû
 
Hy³¹abË
;

48 
	gÇme¥aû
 {

49 cÚ¡ *
	gu§ge
[] = {

61 cÚ¡ 
	gDEFAULT_PORT
 = 32998;

62 cÚ¡ *
	gDEFAULT_PORT_ARG
 = "--port=32998";

64 şas 
	cS”v”Launch”
 {

65 
	gpublic
:

66 
S”v”Launch”
() {

67 ià((
m_chd_pid
 = 
fÜk
()) == 0) {

68 
exeş
("./‹¡S”v”", "./‹¡S”v”", 
DEFAULT_PORT_ARG
, "--app-queue", "--udp", (*)0);

70 
pŞl
(0,0,2000);

72 ~
S”v”Launch”
() {

73 ià(
kl
(
m_chd_pid
, 9) == -1)

74 
³¼Ü
("kill");

76 
	g´iv©e
:

77 
pid_t
 
m_chd_pid
;

83 
	$maš
(
¬gc
, **
¬gv
) {

84 
boo¡
::
th»ad
 *
th»ad1
, *
th»ad2
;

85 
sockaddr_š
 
addr
;

86 
S”v”Launch”
 
¦aunch”
;

87 
Comm
 *
comm
;

89 ià(
¬gc
 != 1)

90 
U§ge
::
	`dump_ªd_ex™
(
u§ge
);

92 
	`¤ªd
(8876);

94 
Sy¡em
::
	`š™Ÿlize
(
¬gv
[0]);

95 
R—ùÜFaùÜy
::
	`š™Ÿlize
(1);

97 
	`mem£t
(&
addr
, 0, (
sockaddr_š
));

99 
ho¡’t
 *
he
 = 
	`g‘ho¡byÇme
("localhost");

100 ià(
he
 == 0) {

101 
	`h”rÜ
("gethostbyname()");

104 
	`memıy
(&
addr
.
sš_addr
.
s_addr
, 
he
->
h_addr_li¡
[0], (
ušt32_t
));

106 
addr
.
sš_çmy
 = 
AF_INET
;

107 
addr
.
sš_pÜt
 = 
	`htÚs
(
DEFAULT_PORT
);

109 
comm
 = 
Ãw
 
	`Comm
();

111 
	`pŞl
(0, 0, 2000);

113 
CommTe¡D©ag¿mTh»adFunùiÚ
 
	`th»adFunc
(
comm
, 
addr
, "./words");

115 
th»adFunc
.
	`£t_ouut_fe
("commTestDatagram.output.1");

116 
th»adFunc
.
	`£t_»ûive_pÜt
(
DEFAULT_PORT
 + 1);

117 
th»ad1
 = 
Ãw
 
boo¡
::
	`th»ad
(
th»adFunc
);

119 
th»adFunc
.
	`£t_ouut_fe
("commTestDatagram.output.2");

120 
th»adFunc
.
	`£t_»ûive_pÜt
(
DEFAULT_PORT
 + 2);

121 
th»ad2
 = 
Ãw
 
boo¡
::
	`th»ad
(
th»adFunc
);

123 
th»ad1
->
	`još
();

124 
th»ad2
->
	`još
();

126 
¡d
::
¡ršg
 
tmpFe
 = (¡d::¡ršg)"/tmp/commTe¡D©ag¿m" + ()
	`g‘pid
();

127 
¡d
::
¡ršg
 
commªdSŒ
 = (¡d::¡ršg)"h—d -" + ()
MAX_MESSAGES
 + " ./wÜd > " + 
tmpFe
 + " ; diff " +mpFile + " commTestDatagram.output.1";

129 ià(
	`sy¡em
(
commªdSŒ
.
	`c_¡r
()))

132 
commªdSŒ
 = (
¡d
::
¡ršg
)"uÆšk " + 
tmpFe
;

133 ià(
	`sy¡em
(
commªdSŒ
.
	`c_¡r
()))

136 ià(
	`sy¡em
("diff commTestDatagram.output.1 commTestDatagram.output.2"))

139 
R—ùÜFaùÜy
::
	`de¡roy
();

141 
d–‘e
 
comm
;

142 
d–‘e
 
th»ad1
;

143 
d–‘e
 
th»ad2
;

146 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/tests/commTestReverseRequest.cc

21 
	~<c¡dlib
>

24 
	~<pŞl.h
>

25 
	~<sigÇl.h
>

26 
	~<sys/ty³s.h
>

27 
	~<uni¡d.h
>

30 
	~<boo¡/th»ad/th»ad.hµ
>

32 
	~"CommÚ/E¼Ü.h
"

33 
	~"CommÚ/FeUts.h
"

34 
	~"CommÚ/Te¡H¬Ãss.h
"

35 
	~"CommÚ/S”v”Launch”.h
"

36 
	~"CommÚ/SŒšgExt.h
"

37 
	~"CommÚ/Sy¡em.h
"

38 
	~"CommÚ/U§ge.h
"

40 
	~"AsyncComm/Comm.h
"

41 
	~"AsyncComm/Ev’t.h
"

42 
	~"AsyncComm/R—ùÜFaùÜy.h
"

44 
	~"CommTe¡Th»adFunùiÚ.h
"

46 
usšg
 
Çme¥aû
 
Hy³¹abË
;

48 
	gÇme¥aû
 {

49 cÚ¡ *
	gu§ge
[] = {

59 
	$maš
(
¬gc
, **
¬gv
) {

60 
¡d
::
veùÜ
<cÚ¡ *> 
ş›ÁArgs
;

61 
¡d
::
veùÜ
<cÚ¡ *> 
£rv”Args
;

63 ià(
¬gc
 != 1)

64 
U§ge
::
	`dump_ªd_ex™
(
u§ge
);

66 
	`¤ªd
(8876);

68 
Sy¡em
::
	`š™Ÿlize
(
¬gv
[0]);

69 
R—ùÜFaùÜy
::
	`š™Ÿlize
(1);

71 
ş›ÁArgs
.
	`push_back
("sampleClient");

72 
ş›ÁArgs
.
	`push_back
("--recv-addr=localhost:12789");

73 
ş›ÁArgs
.
	`push_back
("datafile.txt");

74 
ş›ÁArgs
.
	`push_back
((const *)0);

76 
£rv”Args
.
	`push_back
("testServer");

77 
£rv”Args
.
	`push_back
("--connect-to=localhost:12789");

78 
£rv”Args
.
	`push_back
((const *)0);

81 
S”v”Launch”
 
	`ş›Á
("./§m¶eCl›Á", (* cÚ¡ *)&
ş›ÁArgs
[0], "commTestReverseRequest.out");

82 
	`pŞl
(0, 0, 2000);

83 
S”v”Launch”
 
	`£rv”
("./‹¡S”v”", (* cÚ¡ *)&
£rv”Args
[0]);

86 ià(
	`sy¡em
("diff commTestReverseRequest.out commTestReverseRequest.golden"))

90 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/tests/commTestTimeout.cc

21 
	~<c¡dlib
>

24 
	~<pŞl.h
>

25 
	~<sigÇl.h
>

26 
	~<sys/ty³s.h
>

27 
	~<uni¡d.h
>

30 
	~<boo¡/th»ad/th»ad.hµ
>

32 
	~"CommÚ/E¼Ü.h
"

33 
	~"CommÚ/FeUts.h
"

34 
	~"CommÚ/IÃtAddr.h
"

35 
	~"CommÚ/Logg”.h
"

36 
	~"CommÚ/Te¡H¬Ãss.h
"

37 
	~"CommÚ/Sy¡em.h
"

38 
	~"CommÚ/U§ge.h
"

40 
	~"AsyncComm/Comm.h
"

41 
	~"AsyncComm/CÚÃùiÚMªag”.h
"

42 
	~"AsyncComm/Ev’t.h
"

43 
	~"AsyncComm/R—ùÜFaùÜy.h
"

45 
	~"CommTe¡Th»adFunùiÚ.h
"

47 
usšg
 
Çme¥aû
 
Hy³¹abË
;

49 
	gÇme¥aû
 {

50 cÚ¡ *
	gu§ge
[] = {

57 cÚ¡ 
	gDEFAULT_PORT
 = 32998;

58 cÚ¡ *
	gDEFAULT_PORT_ARG
 = "--port=32998";

60 şas 
	cS”v”Launch”
 {

61 
	gpublic
:

62 
S”v”Launch”
() {

63 ià((
m_chd_pid
 = 
fÜk
()) == 0) {

64 
exeş
("./‹¡S”v”", "./‹¡S”v”", 
DEFAULT_PORT_ARG
, "--delay=120000", (*)0);

66 
pŞl
(0,0,2000);

68 ~
S”v”Launch”
() {

69 ià(
kl
(
m_chd_pid
, 9) == -1)

70 
³¼Ü
("kill");

72 
	g´iv©e
:

73 
pid_t
 
m_chd_pid
;

79 şas 
	cRe¥Ú£HªdËr
 : 
public
 
Di¥©chHªdËr
 {

80 
public
:

81 
Re¥Ú£HªdËr
(è: 
m_mu‹x
(), 
m_cÚd
(), 
m_cÚÃùed
(
çl£
) { ; }

83 
vœtu®
 
hªdË
(
Ev’tPŒ
 &
ev’tPŒ
) {

84 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

85 ià(
	gev’tPŒ
->
	gty³
 =ğ
Ev’t
::
CONNECTION_ESTABLISHED
) {

86 
m_cÚÃùed
 = 
Œue
;

87 
	gm_cÚd
.
nÙify_Úe
();

89 ià(
	gev’tPŒ
->
	gty³
 =ğ
Ev’t
::
ERROR
) {

90 
HT_INFOF
("%s", 
ev’tPŒ
->
toSŒšg
().
c_¡r
());

93 
HT_INFOF
("%s", 
ev’tPŒ
->
toSŒšg
().
c_¡r
());

94 
	gm_cÚÃùed
 = 
Œue
;

95 
	gm_cÚd
.
nÙify_Úe
();

99 
wa™_fÜ_cÚÃùiÚ
() {

100 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

101 !
	gm_cÚÃùed
)

102 
	gm_cÚd
.
wa™
(
lock
);

105 
	g´iv©e
:

106 
boo¡
::
mu‹x
 
m_mu‹x
;

107 
	gboo¡
::
cÚd™iÚ
 
m_cÚd
;

108 
boŞ
 
	gm_cÚÃùed
;

114 
	$maš
(
¬gc
, **
¬gv
) {

115 
sockaddr_š
 
addr
;

116 
Comm
 *
comm
;

117 
”rÜ
;

118 
Ev’tPŒ
 
ev’tPŒ
;

119 
Te¡H¬Ãss
 
	`h¬Ãss
("commTestTimeout");

120 
boŞ
 
gŞd’
 = 
çl£
;

121 
Re¥Ú£HªdËr
 *
»¥HªdËr
 = 
Ãw
 
	`Re¥Ú£HªdËr
();

122 
Di¥©chHªdËrPŒ
 
	`di¥©chHªdËrPŒ
(
»¥HªdËr
);

125 
S”v”Launch”
 
¦aunch”
;

127 ià(
¬gc
 > 1) {

128 ià(!
	`¡rcmp
(
¬gv
[1], "--golden"))

129 
gŞd’
 = 
Œue
;

131 
U§ge
::
	`dump_ªd_ex™
(
u§ge
);

134 
	`¤ªd
(8876);

136 
Sy¡em
::
	`š™Ÿlize
(
¬gv
[0]);

137 
R—ùÜFaùÜy
::
	`š™Ÿlize
(1);

139 
IÃtAddr
::
	`š™Ÿlize
(&
addr
, "loÿlho¡", 
DEFAULT_PORT
);

141 
comm
 = 
Ãw
 
	`Comm
();

143 ià((
”rÜ
 = 
comm
->
	`cÚÃù
(
addr
, 
di¥©chHªdËrPŒ
)è!ğ
E¼Ü
::
OK
)

146 
»¥HªdËr
->
	`wa™_fÜ_cÚÃùiÚ
();

148 
H—d”Bud”
 
	`hbud”
(
H—d”
::
PROTOCOL_NONE
, 
	`¿nd
());

149 
¡d
::
¡ršg
 
msg
;

151 
msg
 = "foo";

152 
CommBufPŒ
 
	`cbufPŒ
Ğ
Ãw
 
	`CommBuf
(
hbud”
, 
S”Ÿliz©iÚ
::
	`’coded_Ëngth_¡ršg
(
msg
)) );

153 
cbufPŒ
->
	`­³nd_¡ršg
(
msg
);

154 ià((
”rÜ
 = 
comm
->
	`£nd_»que¡
(
addr
, 5, 
cbufPŒ
, 
»¥HªdËr
)è!ğ
E¼Ü
::
OK
) {

155 
	`HT_ERRORF
("ProbËm s’dšg„eque¡ - %s", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

159 
msg
 = "bar";

160 
cbufPŒ
.
	`»£t
 (
Ãw
 
	`CommBuf
(
hbud”
, 
S”Ÿliz©iÚ
::
	`’coded_Ëngth_¡ršg
(
msg
)) );

161 
cbufPŒ
->
	`­³nd_¡ršg
(
msg
);

162 ià((
”rÜ
 = 
comm
->
	`£nd_»que¡
(
addr
, 5, 
cbufPŒ
, 
»¥HªdËr
)è!ğ
E¼Ü
::
OK
) {

163 
	`HT_ERRORF
("ProbËm s’dšg„eque¡ - %s", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

167 
	`pŞl
(0, 0, 8000);

169 
d–‘e
 
comm
;

173 ià(!
gŞd’
)

174 
h¬Ãss
.
	`v®id©e_ªd_ex™
("commTestTimeout.golden");

176 
h¬Ãss
.
	`»g’”©e_gŞd’_fe
("commTestTimeout.golden");

179 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/tests/commTestTimer.cc

21 
	~<c¡dlib
>

24 
	~<pŞl.h
>

25 
	~<sigÇl.h
>

26 
	~<sys/ty³s.h
>

27 
	~<uni¡d.h
>

30 
	~<boo¡/th»ad/th»ad.hµ
>

32 
	~"CommÚ/E¼Ü.h
"

33 
	~"CommÚ/FeUts.h
"

34 
	~"CommÚ/Logg”.h
"

35 
	~"CommÚ/Te¡H¬Ãss.h
"

36 
	~"CommÚ/Sy¡em.h
"

37 
	~"CommÚ/U§ge.h
"

39 
	~"AsyncComm/Comm.h
"

40 
	~"AsyncComm/CÚÃùiÚMªag”.h
"

41 
	~"AsyncComm/Ev’t.h
"

42 
	~"AsyncComm/R—ùÜFaùÜy.h
"

44 
	~"CommTe¡Th»adFunùiÚ.h
"

46 
usšg
 
Çme¥aû
 
Hy³¹abË
;

48 
	gÇme¥aû
 {

49 cÚ¡ *
	gu§ge
[] = {

59 şas 
	cTim”HªdËr
 : 
public
 
Di¥©chHªdËr
 {

60 
public
:

61 
Tim”HªdËr
(cÚ¡ *
msg
, 
o¡»am
 &
out
è: 
m_msg
(msg), 
m_out
(out) { ; }

62 
vœtu®
 
hªdË
(
Ev’tPŒ
 &
ev’tPŒ
) {

63 
	gm_out
 << 
	gev’tPŒ
->
toSŒšg
().
c_¡r
(è<< " (" << 
	gm_msg
 << ")" << 
	g’dl
;

65 
	g´iv©e
:

66 cÚ¡ *
m_msg
;

67 
	go¡»am
 &
	gm_out
;

70 
	sTim”Rec
 {

71 
ušt32_t
 
	gd–ay
;

72 cÚ¡ *
	gmsg
;

75 
Tim”Rec
 
	ghi¡Üy
[] = {

91 
	$maš
(
¬gc
, **
¬gv
) {

92 
Comm
 *
comm
;

93 
”rÜ
;

94 
Te¡H¬Ãss
 
	`h¬Ãss
("commTestTimer");

95 
boŞ
 
gŞd’
 = 
çl£
;

96 
Tim”HªdËr
 *
tim”HªdËr
;

97 
ušt32_t
 
wa™Time
 = 0;

98 
o¡»am
 &
out
 = 
h¬Ãss
.
	`g‘_log_¡»am
();

100 ià(
¬gc
 > 1) {

101 ià(!
	`¡rcmp
(
¬gv
[1], "--golden"))

102 
gŞd’
 = 
Œue
;

104 
U§ge
::
	`dump_ªd_ex™
(
u§ge
);

107 
	`¤ªd
(8876);

109 
Sy¡em
::
	`š™Ÿlize
(
¬gv
[0]);

110 
R—ùÜFaùÜy
::
	`š™Ÿlize
(1);

112 
comm
 = 
Ãw
 
	`Comm
();

114 
i
=0; 
hi¡Üy
[i].
msg
; i++) {

115 
tim”HªdËr
 = 
Ãw
 
	`Tim”HªdËr
(
hi¡Üy
[
i
].
msg
, 
out
);

116 ià((
”rÜ
 = 
comm
->
	`£t_tim”
(
hi¡Üy
[
i
].
d–ay
*1000, 
tim”HªdËr
)è!ğ
E¼Ü
::
OK
) {

117 
	`HT_ERRORF
("ProbËm s‘tšgim” - %s", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

118 
	`ex™
(1);

120 ià(
hi¡Üy
[
i
].
d–ay
 > 
wa™Time
)

121 
wa™Time
 = 
hi¡Üy
[
i
].
d–ay
;

124 
	`pŞl
(0, 0, (
wa™Time
+1)*1000);

126 ià(!
gŞd’
)

127 
h¬Ãss
.
	`v®id©e_ªd_ex™
("commTestTimer.golden");

129 
h¬Ãss
.
	`»g’”©e_gŞd’_fe
("commTestTimer.golden");

131 
d–‘e
 
comm
;

134 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/ByteOrder.h

21 #iâdeà
HYPERTABLE_BYTEORDER_H


22 
	#HYPERTABLE_BYTEORDER_H


	)

24 
	#By‹Ord”Sw­IÁ64
(
x
è((((
ušt64_t
)(x) & 0xff00000000000000ULL) >> 56) | \

25 (((
ušt64_t
)(
x
) & 0x00ff000000000000ULL) >> 40) | \

26 (((
ušt64_t
)(
x
) & 0x0000ff0000000000ULL) >> 24) | \

27 (((
ušt64_t
)(
x
) & 0x000000ff00000000ULL) >> 8) | \

28 (((
ušt64_t
)(
x
) & 0x00000000ff000000ULL) << 8) | \

29 (((
ušt64_t
)(
x
) & 0x0000000000ff0000ULL) << 24) | \

30 (((
ušt64_t
)(
x
) & 0x000000000000ff00ULL) << 40) | \

31 (((
ušt64_t
)(
x
è& 0x00000000000000ffULLè<< 56))

	)

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/ByteString.h

21 #iâdeà
HYPERTABLE_BYTESTRING_H


22 
	#HYPERTABLE_BYTESTRING_H


	)

24 
	~<ext/hash_m­
>

25 
	~<io¡»am
>

27 
	~<boo¡/sh¬ed_¬¿y.hµ
>

28 
	~<boo¡/sh¬ed_±r.hµ
>

30 
	~"DyÇmicBufãr.h
"

32 
Çme¥aû
 
	gHy³¹abË
 {

35 
ušt16_t
 
	gËn
;

36 
ušt8_t
 
	gd©a
[1];

37 } 
	t__©Œibu‹__
((
	t·cked
)è
	tBy‹SŒšg16T
;

40 
ušt32_t
 
	gËn
;

41 
ušt8_t
 
	gd©a
[1];

42 } 
	t__©Œibu‹__
((
	t·cked
)è
	tBy‹SŒšg32T
;

44 
šlše
 
size_t
 
L’gth
(cÚ¡ 
By‹SŒšg32T
 *
bs
) {

45  (
	gbs
 =ğ0è? (
št32_t
è: 
bs
->
Ën
 + (bs->len);

48 
šlše
 cÚ¡ 
By‹SŒšg32T
 *
Sk
(cÚ¡ By‹SŒšg32T *
bs
) {

49  (cÚ¡ 
	gBy‹SŒšg32T
 *)(((cÚ¡ 
	gušt8_t
 *)
	gbs
è+ 
L’gth
(
bs
));

52 
šlše
 
By‹SŒšg32T
 *
C»©eCİy
(cÚ¡ By‹SŒšg32T *
bs
) {

53 
size_t
 
	gËn
 = (
bs
 =ğ0è? (
št32_t
è: 
L’gth
(bs);

54 
By‹SŒšg32T
 *
	gÃwBs
 = (By‹SŒšg32T *)
Ãw
 
ušt8_t
 [ 
Ën
 ];

55 ià(
	gbs
 == 0)

56 
ÃwBs
->
Ën
 = 0;

58 
memıy
(
ÃwBs
, 
bs
, 
Ën
);

59  
	gÃwBs
;

62 
šlše
 
C»©eAndAµ’d
(
DyÇmicBufãr
 &
d¡_buf
, cÚ¡ *
¡r
) {

63 
By‹SŒšg32T
 *
	gbs
;

64 
	gd¡_buf
.
’su»
(
¡¾’
(
¡r
) + 6);

65 
	gbs
 = (
By‹SŒšg32T
 *)
d¡_buf
.
±r
;

66 
	gbs
->
	gËn
 = 
¡¾’
(
¡r
);

67 
¡rıy
((*)
bs
->
d©a
, 
¡r
);

68 
	gd¡_buf
.
	g±r
 +ğ
L’gth
(
bs
);

71 
šlše
 
C»©eAndAµ’d
(
DyÇmicBufãr
 &
d¡_buf
, cÚ¡ *
v®ue
, 
ušt32_t
 
v®ue_Ën
) {

72 
By‹SŒšg32T
 *
	gbs
;

73 
	gd¡_buf
.
’su»
(
v®ue_Ën
 + 4);

74 
	gbs
 = (
By‹SŒšg32T
 *)
d¡_buf
.
±r
;

75 
	gbs
->
	gËn
 = 
v®ue_Ën
;

76 ià(
	gv®ue_Ën
 > 0)

77 
memıy
(
bs
->
d©a
, 
v®ue
, 
v®ue_Ën
);

78 
	gd¡_buf
.
	g±r
 +ğ
L’gth
(
bs
);

81 
šlše
 
C»©e
(
By‹SŒšg32T
 *
bs
, cÚ¡ *
d©a
, 
ušt32_t
 
Ën
) {

82 
	gbs
->
	gËn
 = 
Ën
;

83 ià(
	gËn
)

84 
memıy
(
bs
->
d©a
, d©a, 
Ën
);

87 
šlše
 
By‹SŒšg32T
 *
C»©e
(cÚ¡ *
d©a
, 
ušt32_t
 
Ën
) {

88 
By‹SŒšg32T
 *
	gbs
 = (By‹SŒšg32T *)
Ãw
 
ušt8_t
 [ (By‹SŒšg32Tè+ 
Ën
 ];

89 
C»©e
(
bs
, 
d©a
, 
Ën
);

90 
	gbs
->
	gd©a
[
Ën
] = 0;

91  
	gbs
;

94 
šlše
 
De¡roy
(
By‹SŒšg32T
 *
bs
) {

95 
	gd–‘e
 [] (
	gušt8_t
 *)
	gbs
;

98 
şass
 
	gBy‹SŒšg32PŒ
 : 
public
 
boo¡
::
sh¬ed_¬¿y
<cÚ¡ 
ušt8_t
> {

99 
public
:

100 
By‹SŒšg32PŒ
(è: 
boo¡
::
sh¬ed_¬¿y
<cÚ¡ 
ušt8_t
>(0) { ; }

101 
By‹SŒšg32PŒ
(
By‹SŒšg32T
 *
key
è: 
boo¡
::
sh¬ed_¬¿y
<cÚ¡ 
ušt8_t
>((uint8_t *)key) { ; }

102 
By‹SŒšg32T
 *
g‘
() const {

103  (
	gBy‹SŒšg32T
 *)
	gboo¡
::
sh¬ed_¬¿y
<cÚ¡ 
ušt8_t
>::
g‘
();

105 
»£t
(
By‹SŒšg32T
 *
bs
) {

106 
	gboo¡
::
sh¬ed_¬¿y
<cÚ¡ 
ušt8_t
>::
»£t
((cÚ¡ ušt8_ˆ*)
bs
);

108 
By‹SŒšg32T
 * 
	gİ”©Ü
-> () const

110  (
	gBy‹SŒšg32T
 *)
	gboo¡
::
sh¬ed_¬¿y
<cÚ¡ 
ušt8_t
>::
g‘
();

117 
šlše
 
boŞ
 
	gİ”©Ü
<(cÚ¡ 
	gBy‹SŒšg32T
 &
	gbs1
, cÚ¡ By‹SŒšg32T &
	gbs2
) {

118 
ušt32_t
 
	gËn
 = (
bs1
.
Ën
 < 
bs2
.len) ? bs1.len : bs2.len;

119 
	gcmp
 = 
memcmp
(
bs1
.
d©a
, 
bs2
.d©a, 
Ën
);

120  (
	gcmp
==0è? 
bs1
.
Ën
 < 
bs2
.ËÀ: 
cmp
 < 0;

126 
šlše
 
boŞ
 
	gİ”©Ü
==(cÚ¡ 
By‹SŒšg32T
 &
bs1
, cÚ¡ 
	gBy‹SŒšg32T
 &
	gbs2
) {

127 ià(
	gbs1
.
	gËn
 !ğ
bs2
.
Ën
)

128  
çl£
;

129  
memcmp
(
bs1
.
d©a
, 
bs2
.d©a, bs1.
Ën
) == 0;

135 
šlše
 
boŞ
 
	gİ”©Ü
!=(cÚ¡ 
By‹SŒšg32T
 &
bs1
, cÚ¡ 
	gBy‹SŒšg32T
 &
	gbs2
) {

136  !(
	gbs1
 =ğ
bs2
);

139 
	sÉBy‹SŒšg32
 {

140 
boŞ
 
İ”©Ü
()(cÚ¡ 
By‹SŒšg32T
 * 
	gbs1±r
, cÚ¡ By‹SŒšg32T *
	gbs2±r
) const {

141  *
	gbs1±r
 < *
	gbs2±r
;

148 
šlše
 
	g¡d
::
o¡»am
 &
İ”©Ü
 <<(
¡d
::o¡»am &
os
, cÚ¡ 
	gBy‹SŒšg32T
 &
	gbs
) {

149 
DyÇmicBufãr
 
dbuf
(
bs
.
Ën
 + 3);

150 *
	gdbuf
.
	g±r
++ = '\'';

151 
	gdbuf
.
addNoCheck
(
bs
.
d©a
, bs.
Ën
);

152 *
	gdbuf
.
	g±r
++ = '\'';

153 *
	gdbuf
.
	g±r
 = 0;

154 
	gos
 << (cÚ¡ *)
	gdbuf
.
	gbuf
;

155  
	gos
;

161 
šlše
 
	g¡d
::
o¡»am
 &
İ”©Ü
 <<(
¡d
::o¡»am &
os
, cÚ¡ 
	gBy‹SŒšg16T
 &
	gbs
) {

162 
DyÇmicBufãr
 
dbuf
(
bs
.
Ën
 + 3);

163 *
	gdbuf
.
	g±r
++ = '\'';

164 
	gdbuf
.
addNoCheck
(
bs
.
d©a
, bs.
Ën
);

165 *
	gdbuf
.
	g±r
++ = '\'';

166 *
	gdbuf
.
	g±r
 = 0;

167 
	gos
 << (cÚ¡ *)
	gdbuf
.
	gbuf
;

168  
	gos
;

171 
	gboo¡
::
	tsh¬ed_¬¿y
<
	tušt8_t
> 
	tBy‹SŒšg16PŒ
;

176 
Çme¥aû
 
	g__gnu_cxx
 {

177 
	g‹m¶©e
<> 
	ghash
< 
	gHy³¹abË
::
By‹SŒšg16T
 * > {

178 
size_t
 
İ”©Ü
()ĞcÚ¡ 
Hy³¹abË
::
By‹SŒšg16T
 *
bs
 ) const {

179 ià(
bs
 == 0)

180  
size_t
(0);

181 
	g__h
 = 0;

182 
	g__i
=0; __i<
	gbs
->
	gËn
; __i++)

183 
	g__h
 = 5 * 
__h
 + 
bs
->
d©a
[
__i
];

184  
size_t
(
__h
);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/CharArena.h

20 #iâdeà
HYPERTABLE_CHARARENA_H


21 
	#HYPERTABLE_CHARARENA_H


	)

23 
	~<c¡dlib
>

24 
	~<io¡»am
>

25 
	~<c¡ršg
>

26 
	~<c¡ddef
>

27 
	~<ÿs£¹
>

28 
	~<boo¡/nÚcİyabË.hµ
>

30 
Çme¥aû
 
	gHy³¹abË
 {

36 şas 
	cCh¬A»Ç
 : 
boo¡
::
nÚcİyabË
 {

37 
´iv©e
:

39 
DEFAULT_PAGE_SZ
 = 4096

41 
	sPage
 {

42 
Page
 *
	gÃxt_·ge
;

43 *
	g®loc_’d
;

44 *
	g·ge_’d
;

45 
	gbuf
[1];

47 
Page
(
size_t
 
sz
è: 
Ãxt_·ge
(0) {

48 
®loc_’d
 = 
buf
;

49 
	g·ge_’d
 = 
buf
 + 
sz
 - (
Page
);

52 
size_t


53 
»maš
(è{  
	g·ge_’d
 - 
	g®loc_’d
; }

56 
®loc
(
size_t
 
sz
) {

57 
as£¹
(
sz
 <ğ
»maš
());

58 *
	g¡¬t
 = 
®loc_’d
;

59 
	g®loc_’d
 +ğ
sz
;

60  
	g¡¬t
;

64 
	g´iv©e
:

65 
Page
 *
m_cur_·ge
;

66 
size_t
 
	gm_·ge_sz
;

67 
size_t
 
	gm_·ge_lim™
;

68 
size_t
 
	gm_·ges
;

69 
size_t
 
	gm_tÙ®
;

70 
size_t
 
	gm_®loûd
;

72 
	g´iv©e
:

73 
Page
 *

74 
®loc_·ge
(
size_t
 
sz
, 
boŞ
 
´•’d
 = 
Œue
) {

75 
Page
 *
·ge
 = (Pag*è
¡d
::
m®loc
(
sz
);

77 
as£¹
(
·ge
);

78 
Ãw
 (
·ge
è
Page
(
sz
);

80 ià(
	g´•’d
)

81 
	g·ge
->
	gÃxt_·ge
 = 
m_cur_·ge
;

82 ià(
	gm_cur_·ge
) {

84 
	g·ge
->
	gÃxt_·ge
 = 
m_cur_·ge
->
Ãxt_·ge
;

85 
	gm_cur_·ge
->
	gÃxt_·ge
 = 
·ge
;

88 
	gm_cur_·ge
 = 
·ge
;

90 ++
	gm_·ges
;

91 
	gm_tÙ®
 +ğ
sz
;

93  
	g·ge
;

96 
	gpublic
:

97 
Ch¬A»Ç
(
size_t
 
·ge_sz
 = 
DEFAULT_PAGE_SZ
) :

98 
m_cur_·ge
(0), 
m_·ge_sz
(
·ge_sz
), 
m_·ges
(0),

99 
m_tÙ®
(0), 
m_®loûd
(0) {

100 
as£¹
(
·ge_sz
 > (
Page
));

101 
	gm_cur_·ge
 = 
®loc_·ge
(
·ge_sz
);

102 
	gm_·ge_lim™
 = 
m_cur_·ge
->
»maš
();

104 ~
Ch¬A»Ç
(è{ 
ä“
(); }

107 
®loc
(
size_t
 
sz
) {

108 
	gm_®loûd
 +ğ
sz
;

110 ià(
	gsz
 > 
	gm_·ge_lim™
) {

111 
Page
 *
	gp
 = 
®loc_·ge
(
sz
 + (Pageè+ 1, 
çl£
);

112  
	gp
->
®loc
(
sz
);

114 ià(!
	gm_cur_·ge
 || 
	gsz
 > m_cur_·ge->
»maš
()) {

115 
	gm_cur_·ge
 = 
®loc_·ge
(
m_·ge_sz
);

117  
	gm_cur_·ge
->
®loc
(
sz
);

121 
dup
(cÚ¡ *
s
) {

122 ià(!
	gs
)

123  
	gNULL
;

125 
size_t
 
	gËn
 = 
¡d
::
¡¾’
(
s
) + 1;

126 *
	gcİy
 = 
®loc
(
Ën
);

127 
memıy
(
cİy
, 
s
, 
Ën
);

128  
	gcİy
;

132 
ä“
() {

133 
Page
 *
	g·ge
;

135 
	gm_cur_·ge
) {

136 
	g·ge
 = 
m_cur_·ge
;

137 
	gm_cur_·ge
 = 
m_cur_·ge
->
Ãxt_·ge
;

138 
	g¡d
::
ä“
(
·ge
);

140 
	gm_·ges
 = 
m_tÙ®
 = 
m_®loûd
 = 0;

143 
	g¡d
::
o¡»am
&

144 
dump_¡©
(
¡d
::
o¡»am
& 
out
) const {

145 
out
 <<"·ges="<< 
m_·ges


146 <<", by‹s="<< 
m_tÙ®


147 <<",‡Îoc="<< 
m_®loûd


148 <<"("<< 
m_®loûd
 * 100. / 
m_tÙ®


150  
	gout
;

154 
šlše
 
	g¡d
::
o¡»am
&

155 
İ”©Ü
<<(
¡d
::
o¡»am
& 
out
, cÚ¡ 
	gCh¬A»Ç
 &
	gm
) {

156  
	gm
.
dump_¡©
(
out
);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/CharStrHashMap.h

20 #iâdeà
HYPERTABLE_CHARSTR_HASHMAP_H


21 
	#HYPERTABLE_CHARSTR_HASHMAP_H


	)

23 
	~"HashM­.h
"

24 
	~"Ch¬SŒHashT¿™s.h
"

26 
Çme¥aû
 
	gHy³¹abË
 {

31 
	g‹m¶©e
 <
ty³Çme
 
	gD©aT
, 
şass
 
	gT¿™sT
 = 
Ch¬SŒHashT¿™s
>

32 
şass
 
Ch¬SŒHashM­
 : 
public
 
hash_m­
<cÚ¡ *, 
	gD©aT
,

33 
ty³Çme
 
	gT¿™sT
::
hash”
,

34 
ty³Çme
 
	gT¿™sT
::
key_equ®
> {

35 
´iv©e
:

36 
hash_m­
<cÚ¡ *, 
	tD©aT
, 
	tty³Çme
 
	tT¿™sT
::
	thash”
,

37 
	tty³Çme
 
	tT¿™sT
::
	tkey_equ®
> 
	tBa£
;

38 
	gpublic
:

39 
ty³Çme
 
	tBa£
::
	t™”©Ü
 iterator;

40 
ty³Çme
 
	tBa£
::
	tkey_ty³
 key_type;

41 
ty³Çme
 
	tBa£
::
	tv®ue_ty³
 value_type;

42 
ty³Çme
 
	tT¿™sT
::
	tkey_®loÿtÜ
 key_allocator;

43 
	g¡d
::
	t·œ
<
	t™”©Ü
, 
	tboŞ
> 
	tInsR‘
;

45 
	g´iv©e
:

46 
key_®loÿtÜ
 
m_®loc
;

48 
	g´iv©e
:

49 
InsR‘


50 
š£¹_key
(cÚ¡ *
key
, 
InsR‘
 
rv
) {

51 ià(
	grv
.
	g£cÚd
) {

52 *
	gkeycİy
 = 
m_®loc
.
dup
(
key
);

53 
	gcÚ¡_ÿ¡
<
	gkey_ty³
 &>(
	grv
.
	gfœ¡
->fœ¡èğ
keycİy
;

55  
	grv
;

58 
	gpublic
:

59 
Ch¬SŒHashM­
() {}

60 
Ch¬SŒHashM­
(
size_t
 
n_buck‘s
è: 
Ba£
(n_buckets) {}

61 ~
Ch¬SŒHashM­
() {}

64 
InsR‘


65 
š£¹
(cÚ¡ *
key
, cÚ¡ 
D©aT
 &
d©a
) {

66  
š£¹_key
(
key
, 
Ba£
::
š£¹
(
v®ue_ty³
(key, 
d©a
)));

69 
InsR‘


70 
š£¹_nÜesize
(cÚ¡ *
key
, cÚ¡ 
D©aT
 &
d©a
) {

71  
š£¹_key
(
key
, 
Ba£
::
š£¹_nÜesize
(
v®ue_ty³
(key, 
d©a
)));

74 
	gD©aT
&

75 
	gİ”©Ü
[](cÚ¡ *
	gkey
) {

76  
š£¹
(
key
, 
D©aT
()).
	gfœ¡
->
	g£cÚd
;

79 
	gkey_®loÿtÜ
 &

80 
key_®loc
(è{  
	gm_®loc
; }

83 
ş—r
() {

84 
	gBa£
::
ş—r
();

85 
	gm_®loc
.
ä“
();

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/CharStrHashTraits.h

20 #iâdeà
HYPERTABLE_CHARSTR_HASH_TRAITS_H


21 
	#HYPERTABLE_CHARSTR_HASH_TRAITS_H


	)

23 
	~"Ch¬A»Ç.h
"

25 
Çme¥aû
 
	gHy³¹abË
 {

30 
	sCh¬SŒHashT¿™s
 {

31 
Ch¬A»Ç
 
	tkey_®loÿtÜ
;

33 
	shash”
 {

34 
size_t


35 
İ”©Ü
()(cÚ¡ *
	gs
) const {

36 
size_t
 
	g»t
 = 0;

38 ; *
	gs
; ++s)

39 
	g»t
 +ğ(
»t
 << 3è+ ()*
s
;

41  
	g»t
;

45 
	skey_equ®
 {

46 
boŞ


47 
İ”©Ü
()(cÚ¡ *
	ga
, cÚ¡ *
	gb
) const {

48  
	g¡d
::
¡rcmp
(
a
, 
b
) == 0;

54 
	sCh¬SŒCa£HashT¿™s
 {

55 
Ch¬A»Ç
 
	tkey_®loÿtÜ
;

57 
	shash”
 {

58 
size_t


59 
İ”©Ü
()(cÚ¡ *
	gs
) const {

60 
size_t
 
	g»t
 = 0;

62 ; *
	gs
; ++s)

63 
	g»t
 +ğ(
»t
 << 3è+ 
tŞow”
(()*
s
);

65  
	g»t
;

69 
	skey_equ®
 {

70 
boŞ


71 
İ”©Ü
()(cÚ¡ *
	ga
, cÚ¡ *
	gb
) const {

72 ; 
tŞow”
(()*
a
è=ğtŞow”(()*
b
); ++
	ga
, ++
	gb
)

73 ià(!*
	ga
)

74  
	gŒue
;

76  
	gçl£
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/Checksum.cc

20 
	~<¡dlib.h
>

21 
	~<¡dšt.h
>

22 
	~<¬·/š‘.h
>

23 
	~"Checksum.h
"

25 
Çme¥aû
 
	gHy³¹abË
 {

27 
	#HT_F32_DO1
(
buf
,
i
) \

28 
sum1
 +ğ((
ušt16_t
)
buf
[
i
] << 8è| buf[i+1]; 
sum2
 +ğ
	)
sum1

29 
	#HT_F32_DO2
(
buf
,
i
è
	`HT_F32_DO1
(buf,i); HT_F32_DO1(buf,i+2);

	)

30 
	#HT_F32_DO4
(
buf
,
i
è
	`HT_F32_DO2
(buf,i); HT_F32_DO2(buf,i+4);

	)

31 
	#HT_F32_DO8
(
buf
,
i
è
	`HT_F32_DO4
(buf,i); HT_F32_DO4(buf,i+8);

	)

32 
	#HT_F32_DO16
(
buf
,
i
è
	`HT_F32_DO8
(buf,i); HT_F32_DO8(buf,i+16);

	)

36 
ušt32_t


37 
æ‘ch”32
(cÚ¡ *
d©a8
, 
size_t
 
Ën8
) {

41 cÚ¡ 
ušt8_t
 *
	gd©a
 = (cÚ¡ ušt8_ˆ*)
d©a8
;

42 
ušt32_t
 
	gsum1
 = 0xffff, 
	gsum2
 = 0xffff;

43 
size_t
 
	gËn
 = 
Ën8
 / 2;

45 
	gËn
) {

49 
	g’
 = 
Ën
 > 360 ? 360 :†en;

50 
	gËn
 -ğ
’
;

52 ià(
	g’
 >= 16) do {

53 
HT_F32_DO16
(
d©a
, 0);

54 
	gd©a
 += 32;

55 
	g’
 -= 16;

56 } 
	g’
 >= 16);

58 ià(
	g’
 != 0) do {

59 
HT_F32_DO1
(
d©a
, 0);

60 
	gd©a
 += 2;

61 } --
	g’
);

63 
	gsum1
 = (
sum1
 & 0xffff) + (sum1 >> 16);

64 
	gsum2
 = (
sum2
 & 0xffff) + (sum2 >> 16);

68 ià(
	gËn8
 & 1) {

69 
	gsum1
 +ğ((
ušt16_t
)*
d©a
) << 8;

70 
	gsum2
 +ğ
sum1
;

71 
	gsum1
 = (
sum1
 & 0xffff) + (sum1 >> 16);

72 
	gsum2
 = (
sum2
 & 0xffff) + (sum2 >> 16);

76 
	gsum1
 = (
sum1
 & 0xffff) + (sum1 >> 16);

77 
	gsum2
 = (
sum2
 & 0xffff) + (sum2 >> 16);

78  (
	gsum2
 << 16è| 
	gsum1
;

81 
	#HT_F32A_DO1
(
buf
, 
i
è
sum1
 +ğ
	`Áohs
(buf[i]); 
sum2
 +ğsum1;

	)

82 
	#HT_F32A_DO2
(
buf
,
i
è
	`HT_F32A_DO1
(buf,i); HT_F32A_DO1(buf,i+1);

	)

83 
	#HT_F32A_DO4
(
buf
,
i
è
	`HT_F32A_DO2
(buf,i); HT_F32A_DO2(buf,i+2);

	)

84 
	#HT_F32A_DO8
(
buf
,
i
è
	`HT_F32A_DO4
(buf,i); HT_F32A_DO4(buf,i+4);

	)

85 
	#HT_F32A_DO16
(
buf
,
i
è
	`HT_F32A_DO8
(buf,i); HT_F32A_DO8(buf,i+8);

	)

87 
ušt32_t


88 
æ‘ch”32a
(cÚ¡ 
ušt16_t
 *
d©a
, 
size_t
 
Ën
) {

89 
ušt32_t
 
	gsum1
 = 0xffff, 
	gsum2
 = 0xffff;

91 
	gËn
) {

95 
	g’
 = 
Ën
 > 360 ? 360 :†en;

96 
	gËn
 -ğ
’
;

98 ià(
	g’
 >= 16) do {

99 
HT_F32A_DO16
(
d©a
, 0);

100 
	gd©a
 += 16;

101 
	g’
 -= 16;

102 } 
	g’
 >= 16);

104 ià(
	g’
 != 0) do {

105 
sum1
 +ğ
Áohs
(*
d©a
);

106 ++
	gd©a
;

107 
	gsum2
 +ğ
sum1
;

108 } --
	g’
);

110 
	gsum1
 = (
sum1
 & 0xffff) + (sum1 >> 16);

111 
	gsum2
 = (
sum2
 & 0xffff) + (sum2 >> 16);

114 
	gsum1
 = (
sum1
 & 0xffff) + (sum1 >> 16);

115 
	gsum2
 = (
sum2
 & 0xffff) + (sum2 >> 16);

116  (
	gsum2
 << 16è| 
	gsum1
;

122 
	#MOD_ADLER
 65521

	)

124 
šlše
 
ušt32_t


125 
upd©e_adËr32
(
ušt32_t
 
adËr
, cÚ¡ *
d©a8
, 
size_t
 
Ën
) {

126 cÚ¡ 
ušt8_t
 *
	gd©a
 = (cÚ¡ ušt8_ˆ*)
d©a8
;

127 
ušt32_t
 
	ga
 = 
adËr
 & 0xffff, 
	gb
 = (adler >> 16) & 0xffff;

129 
	gËn
) {

133 
size_t
 
	g’
 = 
Ën
 > 5550 ? 5550 :†en;

134 
	gËn
 -ğ
’
;

136 
	ga
 +ğ*
d©a
++;

137 
	gb
 +ğ
a
;

138 } --
	g’
);

140 
	ga
 = (
a
 & 0xffffè+ (¨>> 16è* (65536 - 
MOD_ADLER
);

141 
	gb
 = (
b
 & 0xffffè+ (b >> 16è* (65536 - 
MOD_ADLER
);

145 ià(
	ga
 >ğ
MOD_ADLER
)

146 
a
 -ğ
MOD_ADLER
;

149 
	gb
 = (
b
 & 0xffffè+ (b >> 16è* (65536 - 
MOD_ADLER
);

151 ià(
	gb
 >ğ
MOD_ADLER
)

152 
b
 -ğ
MOD_ADLER
;

154  (
	gb
 << 16è| 
	ga
;

157 
	#HT_A32_DO1
(
buf
,
i
è
a
 +ğbuf[i]; 
b
 +ğ
	)
a

158 
	#HT_A32_DO2
(
buf
,
i
è
	`HT_A32_DO1
(buf,i); HT_A32_DO1(buf,i+1);

	)

159 
	#HT_A32_DO4
(
buf
,
i
è
	`HT_A32_DO2
(buf,i); HT_A32_DO2(buf,i+2);

	)

160 
	#HT_A32_DO8
(
buf
,
i
è
	`HT_A32_DO4
(buf,i); HT_A32_DO4(buf,i+4);

	)

161 
	#HT_A32_DO16
(
buf
,
i
è
	`HT_A32_DO8
(buf,i); HT_A32_DO8(buf,i+8);

	)

163 
ušt32_t


164 
adËr32
(cÚ¡ *
d©a
, 
size_t
 
Ën
) {

165  
upd©e_adËr32
(1, 
d©a
, 
Ën
);

168 
šlše
 
ušt32_t


169 
upd©e_adËr32_mod
(
ušt32_t
 
adËr
, cÚ¡ *
d©a8
, 
size_t
 
Ën
) {

170 cÚ¡ 
ušt8_t
 *
	gd©a
 = (cÚ¡ ušt8_ˆ*)
d©a8
;

171 
ušt32_t
 
	ga
 = 
adËr
 & 0xffff, 
	gb
 = (adler >> 16) & 0xffff;

173 
	gËn
) {

174 
size_t
 
	g’
 = 
Ën
 > 5552 ? 5552 :†en;

175 
	gËn
 -ğ
’
;

177 ià(
	g’
 >= 16) do {

178 
HT_A32_DO16
(
d©a
, 0);

179 
	gd©a
 += 16;

180 
	g’
 -= 16;

181 } 
	g’
 >= 16);

183 ià(
	g’
 != 0) do {

184 
a
 +ğ*
d©a
++;

185 
	gb
 +ğ
a
;

186 } --
	g’
 > 0);

188 
	ga
 %ğ
MOD_ADLER
;

189 
	gb
 %ğ
MOD_ADLER
;

191  (
	gb
 << 16è| 
	ga
;

194 
ušt32_t


195 
adËr32_mod
(cÚ¡ *
d©a
, 
size_t
 
Ën
) {

196  
upd©e_adËr32_mod
(1, 
d©a
, 
Ën
);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/Checksum.h

20 #iâdeà
HYPERTABLE_CHECKSUM_H


21 
	#HYPERTABLE_CHECKSUM_H


	)

23 
	~<¡dlib.h
>

24 
	~<¡dšt.h
>

26 
Çme¥aû
 
	gHy³¹abË
 {

33 
ušt32_t


34 
æ‘ch”32
(cÚ¡ *
d©a
, 
size_t
 
Ën
);

42 
ušt32_t


43 
æ‘ch”32a
(cÚ¡ 
ušt16_t
 *
d©a
, 
size_t
 
Ën
);

50 
ušt32_t


51 
adËr32
(cÚ¡ *
d©a
, 
size_t
 
Ën
);

59 
ušt32_t


60 
upd©e_adËr32
(
ušt32_t
 
adËr
, cÚ¡ *
d©a
, 
size_t
 
Ën
);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/DynamicBuffer.h

20 #iâdeà
HYPERTABLE_DYNAMICBUFFER_H


21 
	#HYPERTABLE_DYNAMICBUFFER_H


	)

24 
	~<¡dšt.h
>

25 
	~<¡ršg.h
>

28 
Çme¥aû
 
Hy³¹abË
 {

30 şas 
	cDyÇmicBufãr
 {

32 
public
:

34 
DyÇmicBufãr
(
size_t
 
š™ŸlSize
è: 
buf
(0), 
±r
(0), 
size
(initialSize) {

35 ià(
š™ŸlSize
 == 0)

36 
±r
 = 
buf
 = 0;

38 
buf
 = 
±r
 = 
Ãw
 
ušt8_t
 [ 
size
 ];

41 ~
DyÇmicBufãr
(è{ 
d–‘e
 [] 
buf
; }

43 
size_t
 
»maššg
(ècÚ¡ {  
size
 - (
±r
-
buf
); }

45 
size_t
 
fl
(ècÚ¡ {  
±r
-
buf
; }

47 
’su»
(
size_t
 
Ën
) {

48 ià(
Ën
 > 
»maššg
())

49 
grow
((
size_t
)((
fl
()+
Ën
) * 3 / 2));

52 
»£rve
(
size_t
 
Ën
, 
boŞ
 
nocİy
 = 
çl£
) {

53 ià(
Ën
 > 
»maššg
())

54 
grow
(
fl
(è+ 
Ën
, 
nocİy
);

57 
ušt8_t
 *
addNoCheck
(cÚ¡ *
d©a
, 
size_t
 
Ën
) {

58 ià(
d©a
 == 0)

60 
ušt8_t
 *
½Œ
 = 
±r
;

61 
memıy
(
±r
, 
d©a
, 
Ën
);

62 
±r
 +ğ
Ën
;

63  
½Œ
;

66 
ušt8_t
 *
add
(cÚ¡ *
d©a
, 
size_t
 
Ën
) {

67 ià(
Ën
 > 
»maššg
())

68 
grow
((
size_t
)(1.5 * (
size
+
Ën
)));

69  
addNoCheck
(
d©a
, 
Ën
);

72 
£t
(cÚ¡ *
d©a
, 
size_t
 
Ën
) {

73 
±r
 = 
buf
;

74 
add
(
d©a
, 
Ën
);

77 
ş—r
() {

78 
±r
 = 
buf
;

81 
ä“
() {

82 
d–‘e
 [] 
buf
;

83 
buf
 = 
±r
 = 0;

84 
size
 = 0;

87 
ušt8_t
 *
»Ëa£
(
size_t
 *
ËÅ
=0) {

88 
ušt8_t
 *
rbuf
 = 
buf
;

89 ià(
ËÅ
)

90 *
ËÅ
 = 
fl
();

91 
±r
 = 
buf
 = 0;

92 
size
 = 0;

93  
rbuf
;

96 
grow
(
size_t
 
ÃwSize
, 
boŞ
 
nocİy
 = 
çl£
) {

97 
ušt8_t
 *
ÃwBuf
 = 
Ãw
 ušt8_ˆ[ 
ÃwSize
 ];

99 ià(!
nocİy
 && 
buf
)

100 
memıy
(
ÃwBuf
, 
buf
, 
±r
-buf);

102 
±r
 = 
ÃwBuf
 + (±r-
buf
);

103 
d–‘e
 [] 
buf
;

104 
buf
 = 
ÃwBuf
;

105 
size
 = 
ÃwSize
;

108 
ušt8_t
 *
buf
;

109 
ušt8_t
 *
±r
;

110 
size_t
 
size
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/Error.cc

21 
	~<ÿs£¹
>

23 
	~"E¼Ü.h
"

25 
usšg
 
Çme¥aû
 
	g¡d
;

26 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

28 
	gÇme¥aû
 {

30 
ušt32_t
 
	gcode
;

31 cÚ¡ *
	g‹xt
;

32 } 
	tE¼ÜInfoT
;

34 
E¼ÜInfoT
 
	g”rÜInfo
[] = {

35 { 
E¼Ü
::
OK
, "HYPERTABLE ok" },

36 { 
E¼Ü
::
PROTOCOL_ERROR
, "HYPERTABLE…rotocolƒrror" },

37 { 
E¼Ü
::
REQUEST_TRUNCATED
, "HYPERTABLE„equestruncated" },

38 { 
E¼Ü
::
RESPONSE_TRUNCATED
, "HYPERTABLE„esponseruncated" },

39 { 
E¼Ü
::
REQUEST_TIMEOUT
, "HYPERTABLE„equestimeout" },

40 { 
E¼Ü
::
LOCAL_IO_ERROR
, "HYPERTABLE†ocal i/oƒrror" },

41 { 
E¼Ü
::
BAD_ROOT_LOCATION
, "HYPERTABLE bad„oot†ocation" },

42 { 
E¼Ü
::
BAD_SCHEMA
, "HYPERTABLE bad schema" },

43 { 
E¼Ü
::
INVALID_METADATA
, "HYPERTABLE invalid metadata" },

44 { 
E¼Ü
::
BAD_KEY
, "HYPERTABLE bad key" },

45 { 
E¼Ü
::
METADATA_NOT_FOUND
, "HYPERTABLE metadata‚ot found" },

46 { 
E¼Ü
::
HQL_PARSE_ERROR
, "HYPERTABLE HQL…arseƒrror" },

47 { 
E¼Ü
::
FILE_NOT_FOUND
, "HYPERTABLE file‚ot found" },

48 { 
E¼Ü
::
BLOCK_COMPRESSOR_UNSUPPORTED_TYPE
, "HYPERTABLE block compressor unsupportedype" },

49 { 
E¼Ü
::
BLOCK_COMPRESSOR_INVALID_ARG
, "HYPERTABLE block compressor invalid‡rg" },

50 { 
E¼Ü
::
BLOCK_COMPRESSOR_TRUNCATED
, "HYPERTABLE block compressor blockruncated" },

51 { 
E¼Ü
::
BLOCK_COMPRESSOR_BAD_HEADER
, "HYPERTABLE block compressor bad block header" },

52 { 
E¼Ü
::
BLOCK_COMPRESSOR_BAD_MAGIC
, "HYPERTABLE block compressor bad magic string" },

53 { 
E¼Ü
::
BLOCK_COMPRESSOR_CHECKSUM_MISMATCH
, "HYPERTABLE block compressor block checksum mismatch" },

54 { 
E¼Ü
::
BLOCK_COMPRESSOR_INFLATE_ERROR
, "HYPERTABLE block compressor inflateƒrror" },

55 { 
E¼Ü
::
BLOCK_COMPRESSOR_INIT_ERROR
, "HYPERTABLE block compressor initializationƒrror" },

56 { 
E¼Ü
::
TABLE_DOES_NOT_EXIST
, "HYPERTABLEable does‚otƒxist" },

57 { 
E¼Ü
::
FAILED_EXPECTATION
, "HYPERTABLE failedƒxpectation" },

58 { 
E¼Ü
::
COMM_NOT_CONNECTED
, "COMM‚ot connected" },

59 { 
E¼Ü
::
COMM_BROKEN_CONNECTION
, "COMM broken connection" },

60 { 
E¼Ü
::
COMM_CONNECT_ERROR
, "COMM connectƒrror" },

61 { 
E¼Ü
::
COMM_ALREADY_CONNECTED
, "COMM‡lready connected" },

62 { 
E¼Ü
::
COMM_REQUEST_TIMEOUT
, "COMM„equestimeout" },

63 { 
E¼Ü
::
COMM_SEND_ERROR
, "COMM sendƒrror" },

64 { 
E¼Ü
::
COMM_RECEIVE_ERROR
, "COMM„eceiveƒrror" },

65 { 
E¼Ü
::
COMM_POLL_ERROR
, "COMM…ollƒrror" },

66 { 
E¼Ü
::
COMM_CONFLICTING_ADDRESS
, "COMM conflicting‡ddress" },

67 { 
E¼Ü
::
DFSBROKER_BAD_FILE_HANDLE
, "DFS BROKER bad file handle" },

68 { 
E¼Ü
::
DFSBROKER_IO_ERROR
, "DFS BROKER i/oƒrror" },

69 { 
E¼Ü
::
DFSBROKER_FILE_NOT_FOUND
, "DFS BROKER file‚ot found" },

70 { 
E¼Ü
::
DFSBROKER_BAD_FILENAME
, "DFS BROKER bad filename" },

71 { 
E¼Ü
::
DFSBROKER_PERMISSION_DENIED
, "DFS BROKER…ermission denied" },

72 { 
E¼Ü
::
DFSBROKER_INVALID_ARGUMENT
, "DFS BROKER invalid‡rgument" },

73 { 
E¼Ü
::
HYPERSPACE_IO_ERROR
, "HYPERSPACE i/oƒrror" },

74 { 
E¼Ü
::
HYPERSPACE_CREATE_FAILED
, "HYPERSPACE create failed" },

75 { 
E¼Ü
::
HYPERSPACE_FILE_NOT_FOUND
, "HYPERSPACE file‚ot found" },

76 { 
E¼Ü
::
HYPERSPACE_ATTR_NOT_FOUND
, "HYPERSPACE‡ttribute‚ot found" },

77 { 
E¼Ü
::
HYPERSPACE_DELETE_ERROR
, "HYPERSPACE deleteƒrror" },

78 { 
E¼Ü
::
HYPERSPACE_BAD_PATHNAME
, "HYPERSPACE bad…athname" },

79 { 
E¼Ü
::
HYPERSPACE_PERMISSION_DENIED
,"HYPERSPACE…ermission denied" },

80 { 
E¼Ü
::
HYPERSPACE_EXPIRED_SESSION
, "HYPERSPACEƒxpired session" },

81 { 
E¼Ü
::
HYPERSPACE_FILE_EXISTS
, "HYPERSPACE fileƒxists" },

82 { 
E¼Ü
::
HYPERSPACE_IS_DIRECTORY
, "HYPERSPACE is directory" },

83 { 
E¼Ü
::
HYPERSPACE_INVALID_HANDLE
, "HYPERSPACE invalid handle" },

84 { 
E¼Ü
::
HYPERSPACE_REQUEST_CANCELLED
,"HYPERSPACE„equest cancelled" },

85 { 
E¼Ü
::
HYPERSPACE_MODE_RESTRICTION
, "HYPERSPACE mode„estriction" },

86 { 
E¼Ü
::
HYPERSPACE_ALREADY_LOCKED
, "HYPERSPACE‡lready†ocked" },

87 { 
E¼Ü
::
HYPERSPACE_LOCK_CONFLICT
, "HYPERSPACE†ock conflict" },

88 { 
E¼Ü
::
HYPERSPACE_NOT_LOCKED
, "HYPERSPACE‚ot†ocked" },

89 { 
E¼Ü
::
HYPERSPACE_BAD_ATTRIBUTE
, "HYPERSPACE bad‡ttribute" },

90 { 
E¼Ü
::
MASTER_TABLE_EXISTS
, "MASTERableƒxists" },

91 { 
E¼Ü
::
MASTER_BAD_SCHEMA
, "MASTER bad schema" },

92 { 
E¼Ü
::
MASTER_NOT_RUNNING
, "MASTER‚ot„unning" },

93 { 
E¼Ü
::
RANGESERVER_GENERATION_MISMATCH
, "RANGE SERVER generation mismatch" },

94 { 
E¼Ü
::
RANGESERVER_RANGE_ALREADY_LOADED
, "RANGE SERVER„ange‡lready†oaded" },

95 { 
E¼Ü
::
RANGESERVER_RANGE_MISMATCH
, "RANGE SERVER„ange mismatch" },

96 { 
E¼Ü
::
RANGESERVER_NONEXISTENT_RANGE
, "RANGE SERVER‚on-existent„ange" },

97 { 
E¼Ü
::
RANGESERVER_PARTIAL_UPDATE
, "RANGE SERVER…artial update" },

98 { 
E¼Ü
::
RANGESERVER_RANGE_NOT_FOUND
, "RANGE SERVER„ange‚ot found" },

99 { 
E¼Ü
::
RANGESERVER_INVALID_SCANNER_ID
, "RANGE SERVER invalid scanner id" },

100 { 
E¼Ü
::
RANGESERVER_SCHEMA_PARSE_ERROR
, "RANGE SERVER schema…arseƒrror" },

101 { 
E¼Ü
::
RANGESERVER_SCHEMA_INVALID_CFID
, "RANGE SERVER invalid column family id" },

102 { 
E¼Ü
::
RANGESERVER_INVALID_COLUMNFAMILY
, "RANGE SERVER invalid column family" },

103 { 
E¼Ü
::
RANGESERVER_TRUNCATED_COMMIT_LOG
, "RANGE SERVERruncated commit†og" },

104 { 
E¼Ü
::
RANGESERVER_NO_METADATA_FOR_RANGE
, "RANGE SERVER‚o metadata for„ange" },

105 { 
E¼Ü
::
RANGESERVER_SHUTTING_DOWN
, "RANGE SERVER shutting down" },

106 { 
E¼Ü
::
RANGESERVER_CORRUPT_COMMIT_LOG
, "RANGE SERVER corrupt commit†og" },

107 { 
E¼Ü
::
RANGESERVER_UNAVAILABLE
, "RANGE SERVER unavailable" },

108 { 
E¼Ü
::
RANGESERVER_TIMESTAMP_ORDER_ERROR
,"RANGE SERVER suppliedimestamp is‚ot strictly increasing" },

109 { 
E¼Ü
::
HQL_BAD_LOAD_FILE_FORMAT
, "HQL bad†oad file format" },

113 
	g__gnu_cxx
::
	thash_m­
<
	tušt32_t
, cÚ¡ *> 
	tTextM­T
;

115 
	gTextM­T
 &
budTextM­
() {

116 
TextM­T
 *
	gm­
 = 
Ãw
 TextMapT();

117 
	gi
=0; 
	g”rÜInfo
[
i
].
	g‹xt
 != 0; i++)

118 (*
	gm­
)[
”rÜInfo
[
i
].
	gcode
] =ƒ¼ÜInfo[i].
‹xt
;

119  *
	gm­
;

122 
	gTextM­T
 &
	g‹xtM­
 = 
budTextM­
();

126 cÚ¡ 
	gE¼Ü
::
OK
;

127 cÚ¡ 
	gE¼Ü
::
PROTOCOL_ERROR
;

128 cÚ¡ 
	gE¼Ü
::
REQUEST_TRUNCATED
;

129 cÚ¡ 
	gE¼Ü
::
RESPONSE_TRUNCATED
;

130 cÚ¡ 
	gE¼Ü
::
REQUEST_TIMEOUT
;

131 cÚ¡ 
	gE¼Ü
::
LOCAL_IO_ERROR
;

132 cÚ¡ 
	gE¼Ü
::
BAD_ROOT_LOCATION
;

133 cÚ¡ 
	gE¼Ü
::
BAD_SCHEMA
;

134 cÚ¡ 
	gE¼Ü
::
INVALID_METADATA
;

135 cÚ¡ 
	gE¼Ü
::
BAD_KEY
;

136 cÚ¡ 
	gE¼Ü
::
METADATA_NOT_FOUND
;

137 cÚ¡ 
	gE¼Ü
::
HQL_PARSE_ERROR
;

138 cÚ¡ 
	gE¼Ü
::
FILE_NOT_FOUND
;

139 cÚ¡ 
	gE¼Ü
::
BLOCK_COMPRESSOR_UNSUPPORTED_TYPE
;

140 cÚ¡ 
	gE¼Ü
::
BLOCK_COMPRESSOR_INVALID_ARG
;

141 cÚ¡ 
	gE¼Ü
::
BLOCK_COMPRESSOR_TRUNCATED
;

142 cÚ¡ 
	gE¼Ü
::
BLOCK_COMPRESSOR_BAD_HEADER
;

143 cÚ¡ 
	gE¼Ü
::
BLOCK_COMPRESSOR_BAD_MAGIC
;

144 cÚ¡ 
	gE¼Ü
::
BLOCK_COMPRESSOR_CHECKSUM_MISMATCH
;

145 cÚ¡ 
	gE¼Ü
::
BLOCK_COMPRESSOR_INFLATE_ERROR
;

146 cÚ¡ 
	gE¼Ü
::
BLOCK_COMPRESSOR_INIT_ERROR
;

147 cÚ¡ 
	gE¼Ü
::
TABLE_DOES_NOT_EXIST
;

148 cÚ¡ 
	gE¼Ü
::
FAILED_EXPECTATION
;

150 cÚ¡ 
	gE¼Ü
::
COMM_NOT_CONNECTED
;

151 cÚ¡ 
	gE¼Ü
::
COMM_BROKEN_CONNECTION
;

152 cÚ¡ 
	gE¼Ü
::
COMM_CONNECT_ERROR
;

153 cÚ¡ 
	gE¼Ü
::
COMM_ALREADY_CONNECTED
;

154 cÚ¡ 
	gE¼Ü
::
COMM_REQUEST_TIMEOUT
;

155 cÚ¡ 
	gE¼Ü
::
COMM_SEND_ERROR
;

156 cÚ¡ 
	gE¼Ü
::
COMM_RECEIVE_ERROR
;

157 cÚ¡ 
	gE¼Ü
::
COMM_POLL_ERROR
;

159 cÚ¡ 
	gE¼Ü
::
DFSBROKER_BAD_FILE_HANDLE
;

160 cÚ¡ 
	gE¼Ü
::
DFSBROKER_IO_ERROR
;

161 cÚ¡ 
	gE¼Ü
::
DFSBROKER_FILE_NOT_FOUND
;

162 cÚ¡ 
	gE¼Ü
::
DFSBROKER_BAD_FILENAME
;

163 cÚ¡ 
	gE¼Ü
::
DFSBROKER_PERMISSION_DENIED
;

164 cÚ¡ 
	gE¼Ü
::
DFSBROKER_INVALID_ARGUMENT
;

166 cÚ¡ 
	gE¼Ü
::
HYPERSPACE_IO_ERROR
;

167 cÚ¡ 
	gE¼Ü
::
HYPERSPACE_CREATE_FAILED
;

168 cÚ¡ 
	gE¼Ü
::
HYPERSPACE_FILE_NOT_FOUND
;

169 cÚ¡ 
	gE¼Ü
::
HYPERSPACE_ATTR_NOT_FOUND
;

170 cÚ¡ 
	gE¼Ü
::
HYPERSPACE_DELETE_ERROR
;

171 cÚ¡ 
	gE¼Ü
::
HYPERSPACE_BAD_PATHNAME
;

172 cÚ¡ 
	gE¼Ü
::
HYPERSPACE_PERMISSION_DENIED
;

173 cÚ¡ 
	gE¼Ü
::
HYPERSPACE_EXPIRED_SESSION
;

174 cÚ¡ 
	gE¼Ü
::
HYPERSPACE_FILE_EXISTS
;

175 cÚ¡ 
	gE¼Ü
::
HYPERSPACE_IS_DIRECTORY
;

176 cÚ¡ 
	gE¼Ü
::
HYPERSPACE_INVALID_HANDLE
;

177 cÚ¡ 
	gE¼Ü
::
HYPERSPACE_MODE_RESTRICTION
;

178 cÚ¡ 
	gE¼Ü
::
HYPERSPACE_ALREADY_LOCKED
;

179 cÚ¡ 
	gE¼Ü
::
HYPERSPACE_LOCK_CONFLICT
;

180 cÚ¡ 
	gE¼Ü
::
HYPERSPACE_NOT_LOCKED
;

181 cÚ¡ 
	gE¼Ü
::
HYPERSPACE_BAD_ATTRIBUTE
;

183 cÚ¡ 
	gE¼Ü
::
MASTER_TABLE_EXISTS
;

184 cÚ¡ 
	gE¼Ü
::
MASTER_BAD_SCHEMA
;

185 cÚ¡ 
	gE¼Ü
::
MASTER_NOT_RUNNING
;

187 cÚ¡ 
	gE¼Ü
::
RANGESERVER_GENERATION_MISMATCH
;

188 cÚ¡ 
	gE¼Ü
::
RANGESERVER_RANGE_ALREADY_LOADED
;

189 cÚ¡ 
	gE¼Ü
::
RANGESERVER_RANGE_MISMATCH
;

190 cÚ¡ 
	gE¼Ü
::
RANGESERVER_NONEXISTENT_RANGE
;

191 cÚ¡ 
	gE¼Ü
::
RANGESERVER_PARTIAL_UPDATE
;

192 cÚ¡ 
	gE¼Ü
::
RANGESERVER_RANGE_NOT_FOUND
;

193 cÚ¡ 
	gE¼Ü
::
RANGESERVER_INVALID_SCANNER_ID
;

194 cÚ¡ 
	gE¼Ü
::
RANGESERVER_SCHEMA_PARSE_ERROR
;

195 cÚ¡ 
	gE¼Ü
::
RANGESERVER_SCHEMA_INVALID_CFID
;

196 cÚ¡ 
	gE¼Ü
::
RANGESERVER_TRUNCATED_COMMIT_LOG
;

197 cÚ¡ 
	gE¼Ü
::
RANGESERVER_NO_METADATA_FOR_RANGE
;

198 cÚ¡ 
	gE¼Ü
::
RANGESERVER_SHUTTING_DOWN
;

199 cÚ¡ 
	gE¼Ü
::
RANGESERVER_CORRUPT_COMMIT_LOG
;

200 cÚ¡ 
	gE¼Ü
::
RANGESERVER_UNAVAILABLE
;

201 cÚ¡ 
	gE¼Ü
::
RANGESERVER_TIMESTAMP_ORDER_ERROR
;

203 cÚ¡ 
	gE¼Ü
::
HQL_BAD_LOAD_FILE_FORMAT
;

206 cÚ¡ *
	gE¼Ü
::
	$g‘_‹xt
(
”rÜ
) {

207 cÚ¡ *
‹xt
 = 
‹xtM­
[
”rÜ
];

208 ià(
‹xt
 == 0)

210  
‹xt
;

211 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/Error.h

21 #iâdeà
HYPERTABLE_ERROR_H


22 
	#HYPERTABLE_ERROR_H


	)

24 
	~<¡dexû±
>

25 
	~<ext/hash_m­
>

26 
	~<¡ršg
>

28 
Çme¥aû
 
	gHy³¹abË
 {

30 şas 
	cE¼Ü
 {

32 
	gpublic
:

34 cÚ¡ 
OK
 = 0;

35 cÚ¡ 
	gPROTOCOL_ERROR
 = 1;

36 cÚ¡ 
	gREQUEST_TRUNCATED
 = 2;

37 cÚ¡ 
	gRESPONSE_TRUNCATED
 = 3;

38 cÚ¡ 
	gREQUEST_TIMEOUT
 = 4;

39 cÚ¡ 
	gLOCAL_IO_ERROR
 = 5;

40 cÚ¡ 
	gBAD_ROOT_LOCATION
 = 6;

41 cÚ¡ 
	gBAD_SCHEMA
 = 7;

42 cÚ¡ 
	gINVALID_METADATA
 = 8;

43 cÚ¡ 
	gBAD_KEY
 = 9;

44 cÚ¡ 
	gMETADATA_NOT_FOUND
 = 10;

45 cÚ¡ 
	gHQL_PARSE_ERROR
 = 11;

46 cÚ¡ 
	gFILE_NOT_FOUND
 = 12;

47 cÚ¡ 
	gBLOCK_COMPRESSOR_UNSUPPORTED_TYPE
 = 13;

48 cÚ¡ 
	gBLOCK_COMPRESSOR_INVALID_ARG
 = 14;

49 cÚ¡ 
	gBLOCK_COMPRESSOR_TRUNCATED
 = 15;

50 cÚ¡ 
	gBLOCK_COMPRESSOR_BAD_HEADER
 = 16;

51 cÚ¡ 
	gBLOCK_COMPRESSOR_BAD_MAGIC
 = 17;

52 cÚ¡ 
	gBLOCK_COMPRESSOR_CHECKSUM_MISMATCH
 = 18;

53 cÚ¡ 
	gBLOCK_COMPRESSOR_DEFLATE_ERROR
 = 19;

54 cÚ¡ 
	gBLOCK_COMPRESSOR_INFLATE_ERROR
 = 20;

55 cÚ¡ 
	gBLOCK_COMPRESSOR_INIT_ERROR
 = 21;

56 cÚ¡ 
	gTABLE_DOES_NOT_EXIST
 = 22;

57 cÚ¡ 
	gFAILED_EXPECTATION
 = 23;

59 cÚ¡ 
	gCOMM_NOT_CONNECTED
 = 0x00010001;

60 cÚ¡ 
	gCOMM_BROKEN_CONNECTION
 = 0x00010002;

61 cÚ¡ 
	gCOMM_CONNECT_ERROR
 = 0x00010003;

62 cÚ¡ 
	gCOMM_ALREADY_CONNECTED
 = 0x00010004;

63 cÚ¡ 
	gCOMM_REQUEST_TIMEOUT
 = 0x00010005;

64 cÚ¡ 
	gCOMM_SEND_ERROR
 = 0x00010006;

65 cÚ¡ 
	gCOMM_RECEIVE_ERROR
 = 0x00010007;

66 cÚ¡ 
	gCOMM_POLL_ERROR
 = 0x00010008;

67 cÚ¡ 
	gCOMM_CONFLICTING_ADDRESS
 = 0x00010009;

69 cÚ¡ 
	gDFSBROKER_BAD_FILE_HANDLE
 = 0x00020001;

70 cÚ¡ 
	gDFSBROKER_IO_ERROR
 = 0x00020002;

71 cÚ¡ 
	gDFSBROKER_FILE_NOT_FOUND
 = 0x00020003;

72 cÚ¡ 
	gDFSBROKER_BAD_FILENAME
 = 0x00020004;

73 cÚ¡ 
	gDFSBROKER_PERMISSION_DENIED
 = 0x00020005;

74 cÚ¡ 
	gDFSBROKER_INVALID_ARGUMENT
 = 0x00020006;

76 cÚ¡ 
	gHYPERSPACE_IO_ERROR
 = 0x00030001;

77 cÚ¡ 
	gHYPERSPACE_CREATE_FAILED
 = 0x00030002;

78 cÚ¡ 
	gHYPERSPACE_FILE_NOT_FOUND
 = 0x00030003;

79 cÚ¡ 
	gHYPERSPACE_ATTR_NOT_FOUND
 = 0x00030004;

80 cÚ¡ 
	gHYPERSPACE_DELETE_ERROR
 = 0x00030005;

81 cÚ¡ 
	gHYPERSPACE_BAD_PATHNAME
 = 0x00030006;

82 cÚ¡ 
	gHYPERSPACE_PERMISSION_DENIED
 = 0x00030007;

83 cÚ¡ 
	gHYPERSPACE_EXPIRED_SESSION
 = 0x00030008;

84 cÚ¡ 
	gHYPERSPACE_FILE_EXISTS
 = 0x00030009;

85 cÚ¡ 
	gHYPERSPACE_IS_DIRECTORY
 = 0x0003000A;

86 cÚ¡ 
	gHYPERSPACE_INVALID_HANDLE
 = 0x0003000B;

87 cÚ¡ 
	gHYPERSPACE_REQUEST_CANCELLED
 = 0x0003000C;

88 cÚ¡ 
	gHYPERSPACE_MODE_RESTRICTION
 = 0x0003000D;

89 cÚ¡ 
	gHYPERSPACE_ALREADY_LOCKED
 = 0x0003000E;

90 cÚ¡ 
	gHYPERSPACE_LOCK_CONFLICT
 = 0x0003000F;

91 cÚ¡ 
	gHYPERSPACE_NOT_LOCKED
 = 0x00030010;

92 cÚ¡ 
	gHYPERSPACE_BAD_ATTRIBUTE
 = 0x00030011;

94 cÚ¡ 
	gMASTER_TABLE_EXISTS
 = 0x00040001;

95 cÚ¡ 
	gMASTER_BAD_SCHEMA
 = 0x00040002;

96 cÚ¡ 
	gMASTER_NOT_RUNNING
 = 0x00040003;

98 cÚ¡ 
	gRANGESERVER_GENERATION_MISMATCH
 = 0x00050001;

99 cÚ¡ 
	gRANGESERVER_RANGE_ALREADY_LOADED
 = 0x00050002;

100 cÚ¡ 
	gRANGESERVER_RANGE_MISMATCH
 = 0x00050003;

101 cÚ¡ 
	gRANGESERVER_NONEXISTENT_RANGE
 = 0x00050004;

102 cÚ¡ 
	gRANGESERVER_PARTIAL_UPDATE
 = 0x00050005;

103 cÚ¡ 
	gRANGESERVER_RANGE_NOT_FOUND
 = 0x00050006;

104 cÚ¡ 
	gRANGESERVER_INVALID_SCANNER_ID
 = 0x00050007;

105 cÚ¡ 
	gRANGESERVER_SCHEMA_PARSE_ERROR
 = 0x00050008;

106 cÚ¡ 
	gRANGESERVER_SCHEMA_INVALID_CFID
 = 0x00050009;

107 cÚ¡ 
	gRANGESERVER_INVALID_COLUMNFAMILY
 = 0x0005000A;

108 cÚ¡ 
	gRANGESERVER_TRUNCATED_COMMIT_LOG
 = 0x0005000B;

109 cÚ¡ 
	gRANGESERVER_NO_METADATA_FOR_RANGE
 = 0x0005000C;

110 cÚ¡ 
	gRANGESERVER_SHUTTING_DOWN
 = 0x0005000D;

111 cÚ¡ 
	gRANGESERVER_CORRUPT_COMMIT_LOG
 = 0x0005000E;

112 cÚ¡ 
	gRANGESERVER_UNAVAILABLE
 = 0x0005000F;

113 cÚ¡ 
	gRANGESERVER_TIMESTAMP_ORDER_ERROR
 = 0x00050010;

115 cÚ¡ 
	gHQL_BAD_LOAD_FILE_FORMAT
 = 0x00060001;

117 cÚ¡ *
g‘_‹xt
(
”rÜ
);

118 
	g¡d
::
¡ršg
 
g‘_‹xt_¡ršg
(
”rÜ
è{  
g‘_‹xt
(error); }

125 şas 
	cExû±iÚ
 : 
public
 
¡d
::
ruÁime_”rÜ
 {

126 
public
:

127 
Exû±iÚ
(
”rÜ
è: 
¡d
::
ruÁime_”rÜ
(
E¼Ü
::
g‘_‹xt_¡ršg
Ó¼Ü)), 
m_”rÜ
(error) { ; }

128 
Exû±iÚ
(
”rÜ
, cÚ¡ 
¡d
::
¡ršg
 &
msg
è: std::
ruÁime_”rÜ
(msg), 
m_”rÜ
(error) { ; }

129 
code
(è{  
	gm_”rÜ
; }

130 
	g´iv©e
:

131 
m_”rÜ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/Exception.h

21 #iâdeà
HYPERTABLE_EXCEPTION_H


22 
	#HYPERTABLE_EXCEPTION_H


	)

24 
	~<¡dexû±
>

25 
	~<¡ršg
>

27 
Çme¥aû
 
	gHy³¹abË
 {

29 şas 
	cPrÙocŞExû±iÚ
 : 
public
 
¡d
::
ruÁime_”rÜ
 {

30 
public
:

31 
PrÙocŞExû±iÚ
(cÚ¡ 
¡d
::
¡ršg
 &
msg
è: std::
ruÁime_”rÜ
(msg) {}

34 şas 
	cRuÁimeExû±iÚ
 : 
public
 
¡d
::
ruÁime_”rÜ
 {

35 
public
:

36 
RuÁimeExû±iÚ
(cÚ¡ 
¡d
::
¡ršg
 &
msg
è: std::
ruÁime_”rÜ
(msg) {}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/FileUtils.cc

20 
	~<iomª
>

21 
	~<io¡»am
>

22 
	~<s¡»am
>

25 
	~<”ºo.h
>

26 
	~<fú.h
>

27 
	~<sys/¡©.h
>

28 
	~<sys/ty³s.h
>

29 
	~<sys/uio.h
>

30 
	~<uni¡d.h
>

33 
	~<boo¡/sh¬ed_¬¿y.hµ
>

35 
	~"FeUts.h
"

36 
	~"Logg”.h
"

38 
usšg
 
Çme¥aû
 
Hy³¹abË
;

39 
usšg
 
Çme¥aû
 
	g¡d
;

43 
ssize_t
 
	gFeUts
::
	$»ad
(
fd
, *
v±r
, 
size_t
 
n
) {

44 
size_t
 
Æeá
;

45 
ssize_t
 
Ä—d
;

46 *
±r
;

48 
±r
 = (*)
v±r
;

49 
Æeá
 = 
n
;

50 
Æeá
 > 0) {

51 iàĞ(
Ä—d
 = ::
	`»ad
(
fd
, 
±r
, 
Æeá
)) < 0) {

52 ià(
”ºo
 =ğ
EINTR
)

53 
Ä—d
 = 0;

54 ià(
”ºo
 =ğ
EAGAIN
)

58 } ià(
Ä—d
 == 0)

61 
Æeá
 -ğ
Ä—d
;

62 
±r
 +ğ
Ä—d
;

64  
n
 - 
Æeá
;

65 
	}
}

69 
ssize_t
 
	gFeUts
::
	$´—d
(
fd
, *
v±r
, 
size_t
 
n
, 
off_t
 
off£t
) {

70 
size_t
 
Æeá
;

71 
ssize_t
 
Ä—d
;

72 *
±r
;

74 
±r
 = (*)
v±r
;

75 
Æeá
 = 
n
;

76 
Æeá
 > 0) {

77 iàĞ(
Ä—d
 = ::
	`´—d
(
fd
, 
±r
, 
Æeá
, 
off£t
)) < 0) {

78 ià(
”ºo
 =ğ
EINTR
)

79 
Ä—d
 = 0;

80 ià(
”ºo
 =ğ
EAGAIN
)

84 } ià(
Ä—d
 == 0)

87 
Æeá
 -ğ
Ä—d
;

88 
±r
 +ğ
Ä—d
;

89 
off£t
 +ğ
Ä—d
;

91  
n
 - 
Æeá
;

92 
	}
}

96 
ssize_t
 
	gFeUts
::
	$wr™e
(
fd
, cÚ¡ *
v±r
, 
size_t
 
n
) {

97 
size_t
 
Æeá
;

98 
ssize_t
 
nwr™‹n
;

99 cÚ¡ *
±r
;

101 
±r
 = (cÚ¡ *)
v±r
;

102 
Æeá
 = 
n
;

103 
Æeá
 > 0) {

104 ià((
nwr™‹n
 = ::
	`wr™e
(
fd
, 
±r
, 
Æeá
)) <= 0) {

105 ià(
”ºo
 =ğ
EINTR
)

106 
nwr™‹n
 = 0;

107 ià(
”ºo
 =ğ
EAGAIN
)

113 
Æeá
 -ğ
nwr™‹n
;

114 
±r
 +ğ
nwr™‹n
;

116  
n
 - 
Æeá
;

117 
	}
}

119 
ssize_t
 
	gFeUts
::
	$wr™ev
(
fd
, cÚ¡ 
iovec
 *
veùÜ
, 
couÁ
) {

120 
ssize_t
 
nwr™‹n
;

121 (
nwr™‹n
 = ::
	`wr™ev
(
fd
, 
veùÜ
, 
couÁ
)) <= 0) {

122 ià(
”ºo
 =ğ
EINTR
)

123 
nwr™‹n
 = 0;

124 ià(
”ºo
 =ğ
EAGAIN
) {

125 
nwr™‹n
 = 0;

131  
nwr™‹n
;

132 
	}
}

135 
ssize_t
 
	gFeUts
::
	$£ndto
(
fd
, cÚ¡ *
v±r
, 
size_t
 
n
, cÚ¡ 
sockaddr
 *
to
, 
sockËn_t
 
tŞ’
) {

136 
size_t
 
Æeá
;

137 
ssize_t
 
n£Á
;

138 cÚ¡ *
±r
;

140 
±r
 = (cÚ¡ *)
v±r
;

141 
Æeá
 = 
n
;

142 
Æeá
 > 0) {

143 ià((
n£Á
 = ::
	`£ndto
(
fd
, 
±r
, 
Æeá
, 0, 
to
, 
tŞ’
)) <= 0) {

144 ià(
”ºo
 =ğ
EINTR
)

145 
n£Á
 = 0;

146 ià(
”ºo
 =ğ
EAGAIN
 ||ƒ¼nØ=ğ
ENOBUFS
)

152 
Æeá
 -ğ
n£Á
;

153 
±r
 +ğ
n£Á
;

155  
n
 - 
Æeá
;

156 
	}
}

158 
ssize_t
 
	gFeUts
::
	$»cväom
(
fd
, *
v±r
, 
size_t
 
n
, 
sockaddr
 *
äom
, 
sockËn_t
 *
äomËn
) {

159 
ssize_t
 
Ä—d
;

160 
Œue
) {

161 iàĞ(
Ä—d
 = ::
	`»cväom
(
fd
, 
v±r
, 
n
, 0, 
äom
, 
äomËn
)) < 0) {

162 ià(
”ºo
 !ğ
EINTR
)

168  
Ä—d
;

169 
	}
}

173 
	gFeUts
::
	$£t_æags
(
fd
, 
æags
) {

174 
v®
;

176 iàĞ(
v®
 = 
	`fú
(
fd
, 
F_GETFL
, 0)) < 0)

177 
û¼
 << "fút(F_GETFLèçed : " << 
	`¡»¼Ü
(
”ºo
è<< 
’dl
;

179 
v®
 |ğ
æags
;

181 ià(
	`fú
(
fd
, 
F_SETFL
, 
v®
) < 0)

182 
û¼
 << "fút(F_SETFLèçed : " << 
	`¡»¼Ü
(
”ºo
è<< 
’dl
;

183 
	}
}

189 *
	gFeUts
::
	$fe_to_bufãr
(cÚ¡ *
âame
, 
off_t
 *
ËÅ
) {

190 
¡©
 
¡©buf
;

191 
fd
;

193 *
ËÅ
 = 0;

195 ià((
fd
 = 
	`İ’
(
âame
, 
O_RDONLY
)) < 0) {

196 
	`HT_ERRORF
("İ’(\"%s\"èçu» - %s", 
âame
, 
	`¡»¼Ü
(
”ºo
));

200 ià(
	`f¡©
(
fd
, &
¡©buf
) < 0) {

201 
	`HT_ERRORF
("f¡©(\"%s\"èçu» - %s", 
âame
, 
	`¡»¼Ü
(
”ºo
));

205 *
ËÅ
 = 
¡©buf
.
¡_size
;

207 *
rbuf
 = 
Ãw
 [ *
ËÅ
 + 1 ];

209 
ssize_t
 
Ä—d
 = 
FeUts
::
	`»ad
(
fd
, 
rbuf
, *
ËÅ
);

211 ià(
Ä—d
 =ğ(
ssize_t
)-1) {

212 
	`HT_ERRORF
("»ad(\"%s\"èçu» - %s", 
âame
, 
	`¡»¼Ü
(
”ºo
));

213 
d–‘e
 [] 
rbuf
;

214 *
ËÅ
 = 0;

218 ià(
Ä—d
 < *
ËÅ
) {

219 
	`HT_WARNF
("shÜˆ»ad (%d oà%d by‹s)", 
Ä—d
, *
ËÅ
);

220 *
ËÅ
 = 
Ä—d
;

223 
rbuf
[
Ä—d
] = 0;

225  
rbuf
;

226 
	}
}

229 
boŞ
 
	gFeUts
::
	$mkdœs
(cÚ¡ *
dœÇme
) {

230 
¡©
 
¡©buf
;

231 
boo¡
::
sh¬ed_¬¿y
<> 
	`tmpDœPŒ
(
Ãw
 [ 
	`¡¾’
(
dœÇme
) + 1 ]);

232 *
tmpDœ
 = 
tmpDœPŒ
.
	`g‘
();

233 *
±r
 = 
tmpDœ
+1;

235 
	`¡rıy
(
tmpDœ
, 
dœÇme
);

237 (
±r
 = 
	`¡rchr
(ptr, '/')) != 0) {

238 *
±r
 = 0;

239 ià(
	`¡©
(
tmpDœ
, &
¡©buf
) != 0) {

240 ià(
”ºo
 =ğ
ENOENT
) {

241 ià(
	`mkdœ
(
tmpDœ
, 0755) != 0) {

242 
	`HT_ERRORF
("ProbËm c»©šg dœeùÜy '%s' - %s", 
tmpDœ
, 
	`¡»¼Ü
(
”ºo
));

243  
çl£
;

247 
	`HT_ERRORF
("ProbËm st'šg dœeùÜy '%s' - %s", 
tmpDœ
, 
	`¡»¼Ü
(
”ºo
));

248  
çl£
;

251 *
±r
++ = '/';

254 ià(
	`¡©
(
tmpDœ
, &
¡©buf
) != 0) {

255 ià(
”ºo
 =ğ
ENOENT
) {

256 ià(
	`mkdœ
(
tmpDœ
, 0755) != 0) {

257 
	`HT_ERRORF
("ProbËm c»©šg dœeùÜy '%s' - %s", 
tmpDœ
, 
	`¡»¼Ü
(
”ºo
));

258  
çl£
;

262 
	`HT_ERRORF
("ProbËm st'šg dœeùÜy '%s' - %s", 
tmpDœ
, 
	`¡»¼Ü
(
”ºo
));

263  
çl£
;

267  
Œue
;

268 
	}
}

271 
boŞ
 
	gFeUts
::
	$exi¡s
(cÚ¡ *
âame
) {

272 
¡©
 
¡©buf
;

273 ià(
	`¡©
(
âame
, &
¡©buf
) != 0)

274  
çl£
;

275  
Œue
;

276 
	}
}

278 
ušt64_t
 
	gFeUts
::
	$size
(cÚ¡ *
âame
) {

279 
¡©
 
¡©buf
;

280 ià(
	`¡©
(
âame
, &
¡©buf
) != 0)

282  
¡©buf
.
¡_size
;

284 
	}
}

287 
off_t
 
	gFeUts
::
	$Ëngth
(cÚ¡ *
âame
) {

288 
¡©
 
¡©buf
;

289 ià(
	`¡©
(
âame
, &
¡©buf
) != 0)

290  (
off_t
)-1;

291  
¡©buf
.
¡_size
;

292 
	}
}

295 
	gFeUts
::
	$g‘x©Œ
(cÚ¡ *
·th
, cÚ¡ *
Çme
, *
v®ue
, 
size_t
 
size
) {

296 
¡d
::
¡ršg
 
ÿnÚiÿlName
;

297 ià(!
	`¡ºcmp
(
Çme
, "user.", 5))

298 
ÿnÚiÿlName
 = 
Çme
;

300 
ÿnÚiÿlName
 = (
¡d
::
¡ršg
)"u£r." + 
Çme
;

301 #ià
	`defšed
(
__lšux__
)

302  ::
	`g‘x©Œ
(
·th
, 
ÿnÚiÿlName
.
	`c_¡r
(), 
v®ue
, 
size
);

303 #–ià
	`defšed
(
__APPLE__
)

304  ::
	`g‘x©Œ
(
·th
, 
ÿnÚiÿlName
.
	`c_¡r
(), 
v®ue
, 
size
, 0, 0);

306 
Im¶em’tMe
;

308 
	}
}

311 
	gFeUts
::
	$£tx©Œ
(cÚ¡ *
·th
, cÚ¡ *
Çme
, cÚ¡ *
v®ue
, 
size_t
 
size
, 
æags
) {

312 
¡d
::
¡ršg
 
ÿnÚiÿlName
;

313 ià(!
	`¡ºcmp
(
Çme
, "user.", 5))

314 
ÿnÚiÿlName
 = 
Çme
;

316 
ÿnÚiÿlName
 = (
¡d
::
¡ršg
)"u£r." + 
Çme
;

317 #ià
	`defšed
(
__lšux__
)

318  ::
	`£tx©Œ
(
·th
, 
ÿnÚiÿlName
.
	`c_¡r
(), 
v®ue
, 
size
, 
æags
);

319 #–ià
	`defšed
(
__APPLE__
)

320  ::
	`£tx©Œ
(
·th
, 
ÿnÚiÿlName
.
	`c_¡r
(), 
v®ue
, 
size
, 0, 
æags
);

322 
Im¶em’tMe
;

324 
	}
}

327 
	gFeUts
::
	$fg‘x©Œ
(
fd
, cÚ¡ *
Çme
, *
v®ue
, 
size_t
 
size
) {

328 
¡d
::
¡ršg
 
ÿnÚiÿlName
;

329 ià(!
	`¡ºcmp
(
Çme
, "user.", 5))

330 
ÿnÚiÿlName
 = 
Çme
;

332 
ÿnÚiÿlName
 = (
¡d
::
¡ršg
)"u£r." + 
Çme
;

333 #ià
	`defšed
(
__lšux__
)

334  ::
	`fg‘x©Œ
(
fd
, 
ÿnÚiÿlName
.
	`c_¡r
(), 
v®ue
, 
size
);

335 #–ià
	`defšed
(
__APPLE__
)

336  ::
	`fg‘x©Œ
(
fd
, 
ÿnÚiÿlName
.
	`c_¡r
(), 
v®ue
, 
size
, 0, 0);

338 
Im¶em’tMe
;

340 
	}
}

343 
	gFeUts
::
	$f£tx©Œ
(
fd
, cÚ¡ *
Çme
, cÚ¡ *
v®ue
, 
size_t
 
size
, 
æags
) {

344 
¡d
::
¡ršg
 
ÿnÚiÿlName
;

345 ià(!
	`¡ºcmp
(
Çme
, "user.", 5))

346 
ÿnÚiÿlName
 = 
Çme
;

348 
ÿnÚiÿlName
 = (
¡d
::
¡ršg
)"u£r." + 
Çme
;

349 #ià
	`defšed
(
__lšux__
)

350  ::
	`f£tx©Œ
(
fd
, 
ÿnÚiÿlName
.
	`c_¡r
(), 
v®ue
, 
size
, 
æags
);

351 #–ià
	`defšed
(
__APPLE__
)

352  ::
	`f£tx©Œ
(
fd
, 
ÿnÚiÿlName
.
	`c_¡r
(), 
v®ue
, 
size
, 0, 
æags
);

354 
Im¶em’tMe
;

356 
	}
}

359 
	gFeUts
::
	$»movex©Œ
(cÚ¡ *
·th
, cÚ¡ *
Çme
) {

360 
¡d
::
¡ršg
 
ÿnÚiÿlName
;

361 ià(!
	`¡ºcmp
(
Çme
, "user.", 5))

362 
ÿnÚiÿlName
 = 
Çme
;

364 
ÿnÚiÿlName
 = (
¡d
::
¡ršg
)"u£r." + 
Çme
;

365 #ià
	`defšed
(
__lšux__
)

366  ::
	`»movex©Œ
(
·th
, 
ÿnÚiÿlName
.
	`c_¡r
());

367 #–ià
	`defšed
(
__APPLE__
)

368  ::
	`»movex©Œ
(
·th
, 
ÿnÚiÿlName
.
	`c_¡r
(), 0);

370 
Im¶em’tMe
;

372 
	}
}

374 
	gFeUts
::
	$äemovex©Œ
(
fd
, cÚ¡ *
Çme
) {

375 
¡d
::
¡ršg
 
ÿnÚiÿlName
;

376 ià(!
	`¡ºcmp
(
Çme
, "user.", 5))

377 
ÿnÚiÿlName
 = 
Çme
;

379 
ÿnÚiÿlName
 = (
¡d
::
¡ršg
)"u£r." + 
Çme
;

380 #ià
	`defšed
(
__lšux__
)

381  ::
	`äemovex©Œ
(
fd
, 
ÿnÚiÿlName
.
	`c_¡r
());

382 #–ià
	`defšed
(
__APPLE__
)

383  ::
	`äemovex©Œ
(
fd
, 
ÿnÚiÿlName
.
	`c_¡r
(), 0);

385 
Im¶em’tMe
;

388 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/FileUtils.h

20 #iâdeà
HYPERTABLE_FDUTILS_H


21 
	#HYPERTABLE_FDUTILS_H


	)

24 
	~<fú.h
>

25 
	~<¡dšt.h
>

26 
	~<sys/sock‘.h
>

27 
	~<sys/ty³s.h
>

28 
	~<sys/uio.h
>

29 
	~<sys/x©Œ.h
>

30 #ià
defšed
(
__lšux__
)

31 
	~<©Œ/x©Œ.h
>

32 
	~<¡ršg.h
>

33 
	~<¡dlib.h
>

37 
Çme¥aû
 
Hy³¹abË
 {

39 şas 
	cFeUts
 {

41 
public
:

42 
ssize_t
 
»ad
(
fd
, *
v±r
, 
size_t
 
n
);

43 
ssize_t
 
´—d
(
fd
, *
v±r
, 
size_t
 
n
, 
off_t
 
off£t
);

44 
ssize_t
 
wr™e
(
fd
, cÚ¡ *
v±r
, 
size_t
 
n
);

45 
ssize_t
 
wr™ev
(
fd
, cÚ¡ 
iovec
 *
veùÜ
, 
couÁ
);

46 
ssize_t
 
£ndto
(
fd
, cÚ¡ *
v±r
, 
size_t
 
n
, cÚ¡ 
sockaddr
 *
to
, 
sockËn_t
 
tŞ’
);

47 
ssize_t
 
»cväom
(
fd
, *
v±r
, 
size_t
 
n
, 
sockaddr
 *
äom
, 
sockËn_t
 *
äomËn
);

48 
£t_æags
(
fd
, 
æags
);

49 *
fe_to_bufãr
(cÚ¡ *
âame
, 
off_t
 *
ËÅ
);

50 
boŞ
 
mkdœs
(cÚ¡ *
dœÇme
);

51 
boŞ
 
exi¡s
(cÚ¡ *
âame
);

52 
ušt64_t
 
size
(cÚ¡ *
âame
);

53 
off_t
 
Ëngth
(cÚ¡ *
âame
);

54 
g‘x©Œ
(cÚ¡ *
·th
, cÚ¡ *
Çme
, *
v®ue
, 
size_t
 
size
);

55 
fg‘x©Œ
(
fd
, cÚ¡ *
Çme
, *
v®ue
, 
size_t
 
size
);

56 
£tx©Œ
(cÚ¡ *
·th
, cÚ¡ *
Çme
, cÚ¡ *
v®ue
, 
size_t
 
size
, 
æags
);

57 
f£tx©Œ
(
fd
, cÚ¡ *
Çme
, cÚ¡ *
v®ue
, 
size_t
 
size
, 
æags
);

58 
»movex©Œ
(cÚ¡ *
·th
, cÚ¡ *
Çme
);

59 
äemovex©Œ
(
fd
, cÚ¡ *
Çme
);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/HashMap.h

20 #iâdeà
HYPERTABLE_HASHMAP_H


21 
	#HYPERTABLE_HASHMAP_H


	)

23 
	~<boo¡/cÚfig.hµ
>

24 #šşud
BOOST_HASH_MAP_HEADER


25 #šşud
BOOST_HASH_SET_HEADER


27 
Çme¥aû
 
	gHy³¹abË
 {

29 
usšg
 
	gBOOST_STD_EXTENSION_NAMESPACE
::
hash_m­
;

30 
usšg
 
	gBOOST_STD_EXTENSION_NAMESPACE
::
hash_£t
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/InetAddr.cc

21 
	~<c¡dlib
>

22 
	~<c¡ršg
>

25 
	~<¬·/š‘.h
>

26 
	~<Ãtdb.h
>

27 
	~<Ãtš‘/š.h
>

28 
	~<sys/sock‘.h
>

29 
	~<sys/ty³s.h
>

30 
	~<sys/ut¢ame.h
>

33 
	~"IÃtAddr.h
"

34 
	~"SŒšgExt.h
"

36 
usšg
 
Çme¥aû
 
Hy³¹abË
;

41 
boŞ
 
	gIÃtAddr
::
	$š™Ÿlize
(
sockaddr_š
 *
addr
, cÚ¡ *
ho¡
, 
ušt16_t
 
pÜt
) {

42 
	`mem£t
(
addr
, 0, (
sockaddr_š
));

44 
ho¡’t
 *
he
 = 
	`g‘ho¡byÇme
(
ho¡
);

45 ià(
he
 == 0) {

46 
¡d
::
¡ršg
 
”rMsg
 = (¡d::¡ršg)"g‘ho¡byÇme(\"" + 
ho¡
 + "\")";

47 
	`h”rÜ
(
”rMsg
.
	`c_¡r
());

48  
çl£
;

50 
	`memıy
(&
addr
->
sš_addr
.
s_addr
, 
he
->
h_addr_li¡
[0], (
ušt32_t
));

52 
addr
->
sš_çmy
 = 
AF_INET
;

53 
addr
->
sš_pÜt
 = 
	`htÚs
(
pÜt
);

54  
Œue
;

55 
	}
}

57 
boŞ
 
	gIÃtAddr
::
	$š™Ÿlize
(
sockaddr_š
 *
addr
, cÚ¡ *
addrSŒ
) {

58 cÚ¡ *
cŞÚ
 = 
	`¡rchr
(
addrSŒ
, ':');

59 
ušt16_t
 
pÜt
;

60 
¡d
::
¡ršg
 
ho¡
;

62 ià(
cŞÚ
) {

63 
ho¡
 = 
¡d
::
	`¡ršg
(
addrSŒ
, 
cŞÚ
-addrStr);

64 
pÜt
 = (
ušt16_t
)
	`©oi
(
cŞÚ
+1);

65  
	`š™Ÿlize
(
addr
, 
ho¡
.
	`c_¡r
(), 
pÜt
);

68  
	`š™Ÿlize
(
addr
, "loÿlho¡", (
ušt16_t
)
	`©oi
(
addrSŒ
));

69 
	}
}

74 
boŞ
 
	gIÃtAddr
::
	$š™Ÿlize
(
sockaddr_š
 *
addr
, 
ušt32_t
 
haddr
, 
ušt16_t
 
pÜt
) {

75 
	`mem£t
(
addr
, 0 , (
sockaddr_š
));

76 
addr
->
sš_çmy
 = 
AF_INET
;

77 
addr
->
sš_addr
.
s_addr
 = 
	`htÚl
(
haddr
);

78 
addr
->
sš_pÜt
 = 
	`htÚs
(
pÜt
);

79  
Œue
;

80 
	}
}

85 cÚ¡ *
	gIÃtAddr
::
¡ršg_fÜm©
(
¡d
::
¡ršg
 &
addrSŒ
, 
sockaddr_š
 &
addr
) {

86 
	gaddrSŒ
 = (
¡d
::
¡ršg
)
š‘_Áß
(
addr
.
sš_addr
è+ ":" + 
Áohs
×ddr.
sš_pÜt
);

87  
	gaddrSŒ
.
c_¡r
();

94 
	gIÃtAddr
::
g‘_ho¡Çme
(
¡d
::
¡ršg
 &
ho¡Çme
) {

95 
ut¢ame
 
u
;

96 
uÇme
(&
u
);

97 
	gho¡Çme
 = 
u
.
nod’ame
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/InetAddr.h

20 #iâdeà
HYPERTABLE_INETADDR_H


21 
	#HYPERTABLE_INETADDR_H


	)

23 
	~<¡ršg
>

26 
	~<¡dšt.h
>

27 
	~<Ãtš‘/š.h
>

30 
Çme¥aû
 
Hy³¹abË
 {

32 şas 
	cIÃtAddr
 {

34 
public
:

35 
boŞ
 
š™Ÿlize
(
sockaddr_š
 *
addr
, cÚ¡ *
ho¡
, 
ušt16_t
 
pÜt
);

36 
boŞ
 
š™Ÿlize
(
sockaddr_š
 *
addr
, cÚ¡ *
addrSŒ
);

37 
boŞ
 
š™Ÿlize
(
sockaddr_š
 *
addr
, 
ušt32_t
 
haddr
, 
ušt16_t
 
pÜt
);

38 cÚ¡ *
¡ršg_fÜm©
(
¡d
::
¡ršg
 &
addrSŒ
, 
sockaddr_š
 &
addr
);

39 
g‘_ho¡Çme
(
¡d
::
¡ršg
 &
ho¡Çme
);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/Init.cc

21 
	~"In™.h
"

23 
__©Œibu‹__
 ((
cÚ¡ruùÜ
)è
	$Ut_š™
() {

25 
	}
}

27 
__©Œibu‹__
 ((
de¡ruùÜ
)è
	$Ut_fši
() {

29 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/Init.h

21 #iâdeà
INIT_H


22 
	#INIT_H


	)

24 
__©Œibu‹__
 ((
cÚ¡ruùÜ
)è
Ut_š™
();

25 
__©Œibu‹__
 ((
de¡ruùÜ
)è
Ut_fši
();

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/InteractiveCommand.cc

21 
	~<ÿs£¹
>

22 
	~<c¡ršg
>

23 
	~<io¡»am
>

24 
	~<¡ršg
>

25 
	~<¡dlib.h
>

27 
	~"IÁ”aùiveCommªd.h
"

28 
	~"U§ge.h
"

30 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

31 
usšg
 
Çme¥aû
 
	g¡d
;

36 
	gIÁ”aùiveCommªd
::
	$·r£_commªd_lše
(cÚ¡ *
lše
) {

37 
size_t
 
commªdL’
 = 
	`¡¾’
(
this
->
	`commªd_‹xt
());

38 cÚ¡ *
ba£
, *
±r
;

39 
¡ršg
 
key
, 
v®ue
;

41 
	`as£¹
(!
	`¡ºcmp
(
lše
, 
	`commªd_‹xt
(), 
commªdL’
));

43 
m_¬gs
.
	`ş—r
();

45 
±r
 = 
lše
 + 
commªdL’
;

47 
Œue
) {

49 
key
 = "";

50 
v®ue
 = "";

53 *
±r
 && 
	`is¥aû
(*ptr))

54 
±r
++;

55 ià(*
±r
 == 0)

58 ià(*
±r
 == '\"') {

59 ià(!
	`·r£_¡ršg_l™”®
(
±r
, 
key
, &ptr))

60 
	`ex™
(1);

63 
ba£
 = 
±r
;

64 
Œue
) {

65 ià(*
±r
 == '=') {

66 
key
 = 
	`¡ršg
(
ba£
, 
±r
-base);

67 
ba£
 = ++
±r
;

68 ià(*
ba£
 == '\"') {

69 ià(!
	`·r£_¡ršg_l™”®
(
ba£
, 
v®ue
, &
±r
))

70 
	`ex™
(1);

74 
±r
=
ba£
; *±¸&& !
	`is¥aû
(*ptr);…tr++)

76 
v®ue
 = 
	`¡ršg
(
ba£
, 
±r
-base);

80 ià(*
±r
 =ğ0 || 
	`is¥aû
(*ptr)) {

81 
key
 = 
	`¡ršg
(
ba£
, 
±r
-base);

84 
±r
++;

87 
m_¬gs
.
	`push_back
Ğ
·œ
<
¡ršg
, sŒšg>(
key
, 
v®ue
) );

90 
	}
}

94 
boŞ
 
	gIÁ”aùiveCommªd
::
·r£_¡ršg_l™”®
(cÚ¡ *
¡r
, 
¡d
::
¡ršg
 &
‹xt
, cÚ¡ **
’d±r
) {

95 
	gÏ¡ch¬
 = *
¡r
;

96 cÚ¡ *
	g±r
, *
	gba£
;

98 
as£¹
(*
¡r
 == '"');

100 
	gba£
 = 
¡r
+1;

102 
	g±r
 = 
ba£
; *ptr; ++ptr) {

103 ià(*
	g±r
 =ğ'\"' && 
Ï¡ch¬
 != '\\')

105 
	gÏ¡ch¬
 = *
±r
;

108 ià(*
	g±r
 == 0) {

109 
û¼
 << "Un-‹rmš©ed sŒšg†™”®." << 
’dl
;

110  
	gçl£
;

113 
	g‹xt
 = 
¡ršg
(
ba£
, 
±r
-base);

115 *
	g’d±r
 = 
±r
+1;

116  
	gŒue
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/InteractiveCommand.h

21 #iâdeà
HYPERTABLE_INTERACTIVECOMMAND_H


22 
	#HYPERTABLE_INTERACTIVECOMMAND_H


	)

24 
	~<c¡ršg
>

26 
	~<ut™y
>

27 
	~<veùÜ
>

29 
Çme¥aû
 
	gHy³¹abË
 {

31 şas 
	cIÁ”aùiveCommªd
 {

33 
	gpublic
:

35 
vœtu®
 ~
IÁ”aùiveCommªd
() { ; }

37 
·r£_commªd_lše
(cÚ¡ *
lše
);

38 
boŞ
 
m©ches
(cÚ¡ *
lše
è{  !
¡ºcmp
Öše, 
commªd_‹xt
(), 
¡¾’
(command_text())); }

40 
vœtu®
 cÚ¡ *
commªd_‹xt
() = 0;

41 
vœtu®
 cÚ¡ **
u§ge
() = 0;

42 
vœtu®
 
run
() = 0;

44 
ş—r_¬gs
(è{ 
	gm_¬gs
.
ş—r
(); }

45 
push_¬g
(
¡d
::
¡ršg
 
key
, std::¡ršg 
v®ue
) {

46 
m_¬gs
.
push_back
Ğ
¡d
::
·œ
<¡d::
¡ršg
, std::¡ršg>(
key
, 
v®ue
) );

49 
	g´Ùeùed
:

50 
¡d
::
veùÜ
< std::
·œ
<¡d::
¡ršg
, 
	g¡d
::¡ršg> > 
m_¬gs
;

52 
boŞ
 
·r£_¡ršg_l™”®
(cÚ¡ *
¡r
, 
¡d
::
¡ršg
 &
‹xt
, cÚ¡ **
’d±r
);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/Logger.cc

21 
	~"Logg”.h
"

23 
	~<log4ıp/Aµ’d”.hh
>

24 
	~<log4ıp/BasicLayout.hh
>

25 
	~<log4ıp/FeAµ’d”.hh
>

26 
	~<log4ıp/Layout.hh
>

27 
	~<log4ıp/NDC.hh
>

28 
	~<log4ıp/O¡»amAµ’d”.hh
>

29 
	~<log4ıp/PriÜ™y.hh
>

31 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

33 
	gÇme¥aû
 {

38 şas 
	cNoTimeLayout
 : 
public
 
log4ıp
::
Layout
 {

39 
public
:

40 
NoTimeLayout
() { }

41 
vœtu®
 ~
NoTimeLayout
() { }

42 
vœtu®
 
¡d
::
¡ršg
 
fÜm©
(cÚ¡ 
log4ıp
::
LoggšgEv’t
& 
ev’t
) {

43 
¡d
::
o¡ršg¡»am
 
mes§ge
;

44 cÚ¡ 
	g¡d
::
¡ršg
& 
´iÜ™yName
 = 
log4ıp
::
PriÜ™y
::
g‘PriÜ™yName
(
ev’t
.
´iÜ™y
);

45 
	gmes§ge
 << 
	g´iÜ™yName
 << " " << 
	gev’t
.
	gÿ‹gÜyName
 << " " <<ƒv’t.
	gndc
 << ": " <<ƒv’t.mes§g<< 
	g¡d
::
’dl
;

46  
	gmes§ge
.
¡r
();

53 
	glog4ıp
::
C©egÜy
 *
Logg”
::
logg”
 = 0;

54 
boŞ
 
	gLogg”
::
ms_show_lše_numb”s
 = 
Œue
;

57 
	gLogg”
::
š™Ÿlize
(cÚ¡ *
Çme
, 
log4ıp
::
PriÜ™y
::
V®ue
 
´iÜ™y
) {

58 
log4ıp
::
Aµ’d”
* 
­³nd”
 =

59 
Ãw
 
log4ıp
::
O¡»amAµ’d”
("deçuÉ", &
¡d
::
cout
);

60 
	glog4ıp
::
Layout
* 
Ïyout
 = 
Ãw
 
log4ıp
::
BasicLayout
();

61 
	g­³nd”
->
£tLayout
(
Ïyout
);

62 
	glogg”
 = &(
log4ıp
::
C©egÜy
::
g‘In¡ªû
(
¡d
::
¡ršg
(
Çme
)));

63 
	glogg”
->
addAµ’d”
(
­³nd”
);

64 
	glogg”
->
£tAdd™iv™y
(
çl£
);

65 
	glogg”
->
£tPriÜ™y
(
´iÜ™y
);

69 
	gLogg”
::
£t_Ëv–
(
log4ıp
::
PriÜ™y
::
V®ue
 
´iÜ™y
) {

70 
logg”
->
£tPriÜ™y
(
´iÜ™y
);

73 
	gLogg”
::
	$suµ»ss_lše_numb”s
() {

74 
ms_show_lše_numb”s
 = 
çl£
;

75 
	}
}

78 
	gLogg”
::
	$£t_‹¡_mode
(cÚ¡ *
Çme
) {

79 
log4ıp
::
FeAµ’d”
 *
­³nd”
;

81 
ms_show_lše_numb”s
 = 
çl£
;

83 
logg”
->
	`»moveAÎAµ’d”s
();

84 
­³nd”
 = 
Ãw
 
log4ıp
::
	`FeAµ’d”
((
¡d
::
¡ršg
)
Çme
, 1);

85 
­³nd”
->
	`£tLayout
(
Ãw
 
	`NoTimeLayout
());

86 
logg”
->
	`£tAµ’d”
(
­³nd”
);

87 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/Logger.h

20 #iâdeà
HYPERTABLE_LOGGER_H


21 
	#HYPERTABLE_LOGGER_H


	)

23 
	~<io¡»am
>

25 
	~<log4ıp/C©egÜy.hh
>

26 
	~<log4ıp/PriÜ™y.hh
>

28 
	#DUMP_CORE
 *((*)0èğ1;

	)

30 
Çme¥aû
 
	gHy³¹abË
 {

31 şas 
	cLogg”
 {

32 
	gpublic
:

33 
log4ıp
::
C©egÜy
 *
logg”
;

34 
š™Ÿlize
(cÚ¡ *
Çme
, 
log4ıp
::
PriÜ™y
::
V®ue
 
´iÜ™y
öog4ıp::PriÜ™y::
DEBUG
);

35 
£t_Ëv–
(
log4ıp
::
PriÜ™y
::
V®ue
 
´iÜ™y
);

36 
£t_‹¡_mode
(cÚ¡ *
Çme
);

37 
suµ»ss_lše_numb”s
();

38 
boŞ
 
	gms_show_lše_numb”s
;

42 #iâdeà
DISABLE_LOG_ALL


44 #iâdeà
DISABLE_LOG_DEBUG


46 
	#HT_LOG_ENTER
 do { \

47 ià(
Logg”
::
logg”
->
	`isDebugEÇbËd
()) {\

48 ià(
Logg”
::
ms_show_lše_numb”s
) \

49 
Logg”
::
logg”
->
	`debug
("(%s:%dè%s(èENTER", 
__FILE__
, 
__LINE__
, 
__func__
); \

51 
Logg”
::
logg”
->
	`debug
("%s(èENTER", 
__func__
); \

52 
¡d
::
cout
 << std::
æush
; \

54 } 0)

	)

56 
	#HT_LOG_EXIT
 do { \

57 ià(
Logg”
::
logg”
->
	`isDebugEÇbËd
()) { \

58 ià(
Logg”
::
ms_show_lše_numb”s
) \

59 
Logg”
::
logg”
->
	`debug
("(%s:%dè%s(èEXIT", 
__FILE__
, 
__LINE__
, 
__func__
); \

61 
Logg”
::
logg”
->
	`debug
("%s(èEXIT", 
__func__
); \

62 
¡d
::
cout
 << std::
æush
; \

64 } 0)

	)

66 
	#HT_DEBUG
(
msg
èdØ{ ià(
Logg”
::
logg”
->
	`isDebugEÇbËd
()) \

67 
Logg”
::
logg”
->
	`debug
("(%s:%dè" 
msg
, 
__FILE__
, 
__LINE__
); \

68 } 0)

	)

70 
	#HT_DEBUGF
(
msg
, ...) do { \

71 ià(
Logg”
::
logg”
->
	`isDebugEÇbËd
()) { \

72 ià(
Logg”
::
ms_show_lše_numb”s
) \

73 
Logg”
::
logg”
->
	`debug
("(%s:%dè" 
msg
, 
__FILE__
, 
__LINE__
, 
__VA_ARGS__
); \

75 
Logg”
::
logg”
->
	`debug
(
msg
, 
__VA_ARGS__
); \

76 
¡d
::
cout
 << std::
æush
; \

78 } 0)

	)

80 
	#HT_LOG_ENTER


	)

81 
	#HT_LOG_EXIT


	)

82 
	#HT_DEBUG
(
msg
)

	)

83 
	#HT_DEBUGF
(
msg
, ...)

	)

86 #iâdeà
DISABLE_LOG_INFO


87 
	#HT_INFO
(
msg
èdØ{ ià(
Logg”
::
logg”
->
	`isInfoEÇbËd
()) \

88 
Logg”
::
logg”
->
	`šfo
("(%s:%dè" 
msg
, 
__FILE__
, 
__LINE__
); \

89 } 0)

	)

91 
	#HT_INFOF
(
msg
, ...) do { \

92 ià(
Logg”
::
logg”
->
	`isInfoEÇbËd
()) { \

93 ià(
Logg”
::
ms_show_lše_numb”s
) \

94 
Logg”
::
logg”
->
	`šfo
("(%s:%dè" 
msg
, 
__FILE__
, 
__LINE__
, 
__VA_ARGS__
); \

96 
Logg”
::
logg”
->
	`šfo
(
msg
, 
__VA_ARGS__
); \

98 } 0)

	)

100 
	#HT_INFO
(
msg
)

	)

101 
	#HT_INFOF
(
msg
, ...)

	)

104 #iâdeà
DISABLE_LOG_NOTICE


105 
	#HT_NOTICE
(
msg
èdØ{ ià(
Logg”
::
logg”
->
	`isNÙiûEÇbËd
()) \

106 
Logg”
::
logg”
->
	`nÙiû
("(%s:%dè" 
msg
, 
__FILE__
, 
__LINE__
); \

107 } 0)

	)

108 
	#HT_NOTICEF
(
msg
, ...) do { \

109 ià(
Logg”
::
logg”
->
	`isNÙiûEÇbËd
()) { \

110 ià(
Logg”
::
ms_show_lše_numb”s
) \

111 
Logg”
::
logg”
->
	`nÙiû
("(%s:%dè" 
msg
, 
__FILE__
, 
__LINE__
, 
__VA_ARGS__
); \

113 
Logg”
::
logg”
->
	`nÙiû
(
msg
, 
__VA_ARGS__
); \

115 } 0)

	)

117 
	#HT_NOTICE
(
msg
)

	)

118 
	#HT_NOTICEF
(
msg
, ...)

	)

121 #iâdeà
DISABLE_LOG_WARN


122 
	#HT_WARN
(
msg
èdØ{ ià(
Logg”
::
logg”
->
	`isW¬nEÇbËd
()) \

123 
Logg”
::
logg”
->
	`w¬n
("(%s:%dè" 
msg
, 
__FILE__
, 
__LINE__
); \

124 } 0)

	)

126 
	#HT_WARNF
(
msg
, ...) do { \

127 ià(
Logg”
::
logg”
->
	`isW¬nEÇbËd
()) { \

128 ià(
Logg”
::
ms_show_lše_numb”s
) \

129 
Logg”
::
logg”
->
	`w¬n
("(%s:%dè" 
msg
, 
__FILE__
, 
__LINE__
, 
__VA_ARGS__
); \

131 
Logg”
::
logg”
->
	`w¬n
(
msg
, 
__VA_ARGS__
); \

132 
¡d
::
cout
 << std::
æush
; \

134 } 0)

	)

136 
	#HT_WARN
(
msg
)

	)

137 
	#HT_WARNF
(
msg
, ...)

	)

140 #iâdeà
DISABLE_LOG_ERROR


141 
	#HT_ERROR
(
msg
èdØ{ ià(
Logg”
::
logg”
->
	`isE¼ÜEÇbËd
()) \

142 
Logg”
::
logg”
->
	`”rÜ
("(%s:%dè" 
msg
, 
__FILE__
, 
__LINE__
); \

143 } 0)

	)

144 
	#HT_ERRORF
(
msg
, ...) do { \

145 ià(
Logg”
::
logg”
->
	`isE¼ÜEÇbËd
()) { \

146 ià(
Logg”
::
ms_show_lše_numb”s
) \

147 
Logg”
::
logg”
->
	`”rÜ
("(%s:%dè" 
msg
, 
__FILE__
, 
__LINE__
, 
__VA_ARGS__
); \

149 
Logg”
::
logg”
->
	`”rÜ
(
msg
, 
__VA_ARGS__
); \

150 
¡d
::
cout
 << std::
æush
; \

152 } 0)

	)

154 
	#HT_ERROR
(
msg
)

	)

155 
	#HT_ERRORF
(
msg
, ...)

	)

158 #iâdeà
DISABLE_LOG_CRIT


159 
	#HT_CRIT
(
msg
èdØ{ ià(
Logg”
::
logg”
->
	`isCr™EÇbËd
()) \

160 
Logg”
::
logg”
->
	`ü™
("(%s:%dè" 
msg
, 
__FILE__
, 
__LINE__
); \

161 } 0)

	)

162 
	#HT_CRITF
(
msg
, ...) do { \

163 ià(
Logg”
::
logg”
->
	`isCr™EÇbËd
()) { \

164 ià(
Logg”
::
ms_show_lše_numb”s
) \

165 
Logg”
::
logg”
->
	`ü™
("(%s:%dè" 
msg
, 
__FILE__
, 
__LINE__
, 
__VA_ARGS__
); \

167 
Logg”
::
logg”
->
	`ü™
(
msg
, 
__VA_ARGS__
); \

168 
¡d
::
cout
 << std::
æush
; \

170 } 0)

	)

172 
	#HT_CRIT
(
msg
)

	)

173 
	#HT_CRITF
(
msg
, ...)

	)

176 #iâdeà
DISABLE_LOG_ALERT


177 
	#HT_ALERT
(
msg
èdØ{ ià(
Logg”
::
logg”
->
	`isAË¹EÇbËd
()) \

178 
Logg”
::
logg”
->
	`®”t
("(%s:%dè" 
msg
, 
__FILE__
, 
__LINE__
); \

179 } 0)

	)

180 
	#HT_ALERTF
(
msg
, ...) do { \

181 ià(
Logg”
::
logg”
->
	`isAË¹EÇbËd
()) { \

182 ià(
Logg”
::
ms_show_lše_numb”s
) \

183 
Logg”
::
logg”
->
	`®”t
("(%s:%dè" 
msg
, 
__FILE__
, 
__LINE__
, 
__VA_ARGS__
); \

185 
Logg”
::
logg”
->
	`®”t
(
msg
, 
__VA_ARGS__
); \

186 
¡d
::
cout
 << std::
æush
; \

188 } 0)

	)

190 
	#HT_ALERT
(
msg
)

	)

191 
	#HT_ALERTF
(
msg
, ...)

	)

194 #iâdeà
DISABLE_LOG_EMERG


195 
	#HT_EMERG
(
msg
èdØ{ ià(
Logg”
::
logg”
->
	`isEm”gEÇbËd
()) \

196 
Logg”
::
logg”
->
	`em”g
("(%s:%dè" 
msg
, 
__FILE__
, 
__LINE__
); \

197 } 0)

	)

198 
	#HT_EMERGF
(
msg
, ...) do { \

199 ià(
Logg”
::
logg”
->
	`isEm”gEÇbËd
()) { \

200 ià(
Logg”
::
ms_show_lše_numb”s
) \

201 
Logg”
::
logg”
->
	`em”g
("(%s:%dè" 
msg
, 
__FILE__
, 
__LINE__
, 
__VA_ARGS__
); \

203 
Logg”
::
logg”
->
	`em”g
(
msg
, 
__VA_ARGS__
); \

204 
¡d
::
cout
 << std::
æush
; \

206 } 0)

	)

208 
	#HT_EMERG
(
msg
)

	)

209 
	#HT_EMERGF
(
msg
, ...)

	)

212 #iâdeà
DISABLE_LOG_FATAL


213 
	#HT_FATAL
(
msg
èdØ{ ià(
Logg”
::
logg”
->
	`isF©®EÇbËd
()) { \

214 
Logg”
::
logg”
->
	`çl
("(%s:%dè" 
msg
, 
__FILE__
, 
__LINE__
); \

215 
	`abÜt
(); \

217 } 0)

	)

218 
	#HT_FATALF
(
msg
, ...) do { \

219 ià(
Logg”
::
logg”
->
	`isF©®EÇbËd
()) { \

220 ià(
Logg”
::
ms_show_lše_numb”s
) \

221 
Logg”
::
logg”
->
	`çl
("(%s:%dè" 
msg
, 
__FILE__
, 
__LINE__
, 
__VA_ARGS__
); \

223 
Logg”
::
logg”
->
	`çl
(
msg
, 
__VA_ARGS__
); \

224 
¡d
::
cout
 << std::
æush
; \

225 
	`abÜt
(); \

227 } 0)

	)

228 
	#HT_EXPECT
(
_e_
, 
_code_
) do { if (_e_); \

229 
	`HT_FATAL
("failedƒxpectation: " #_e_); \

230 } 0)

	)

232 
	#HT_FATAL
(
msg
)

	)

233 
	#HT_FATALF
(
msg
, ...)

	)

234 
	#HT_EXPECT
(
_e_
, 
_code_
èdØ{ ià(_e_); 
throw
 \

235 
	`Exû±iÚ
(
_code_
, "failedƒxpectation: " #_e_); \

236 } 0)

	)

241 
	#HT_DEBUG
(
msg
)

	)

242 
	#HT_DEBUGF
(
msg
, ...)

	)

243 
	#HT_INFO
(
msg
)

	)

244 
	#HT_INFOF
(
msg
, ...)

	)

245 
	#HT_NOTICE
(
msg
)

	)

246 
	#HT_NOTICEF
(
msg
, ...)

	)

247 
	#HT_WARN
(
msg
)

	)

248 
	#HT_WARNF
(
msg
, ...)

	)

249 
	#HT_ERROR
(
msg
)

	)

250 
	#HT_ERRORF
(
msg
, ...)

	)

251 
	#HT_CRIT
(
msg
)

	)

252 
	#HT_CRITF
(
msg
, ...)

	)

253 
	#HT_ALERT
(
msg
)

	)

254 
	#HT_ALERTF
(
msg
, ...)

	)

255 
	#HT_EMERG
(
msg
)

	)

256 
	#HT_EMERGF
(
msg
, ...)

	)

257 
	#HT_FATAL
(
msg
)

	)

258 
	#HT_FATALF
(
msg
, ...)

	)

259 
	#HT_EXPECT
(
e
)

	)

260 
	#HT_LOG_ENTER


	)

261 
	#HT_LOG_EXIT


	)

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/NumberStream.h

21 #iâdeà
HYPERTABLE_NUMBERSTREAM_H


22 
	#HYPERTABLE_NUMBERSTREAM_H


	)

24 
	~<c¡dio
>

27 
	~<”ºo.h
>

28 
	~<sys/ty³s.h
>

29 
	~<sys/¡©.h
>

30 
	~<¡ršg.h
>

31 
	~<¡dlib.h
>

34 
	~"Logg”.h
"

36 
Çme¥aû
 
Hy³¹abË
 {

38 şas 
	cNumb”SŒ—m
 {

40 
public
:

41 
Numb”SŒ—m
(cÚ¡ *
âame
) {

42 
¡©
 
¡©buf
;

44 ià(
¡©
(
âame
, &
¡©buf
) != 0) {

45 
HT_ERRORF
("ProbËm stšg f'%s' - %s", 
âame
, 
¡»¼Ü
(
”ºo
));

46 
ex™
(1);

48 ià(
¡©buf
.
¡_size
 < (
off_t
)(
št32_t
)) {

49 
HT_ERRORF
("Numb” sŒ—m f'%s' i nÙ bigƒnough, mu¡ b©†—¡ 4 by‹ lÚg", 
âame
);

50 
ex™
(1);

53 ià((
m_å
 = 
fİ’
(
âame
, "r")) == 0) {

54 
HT_ERRORF
("UÇbËØİ’‚umb” sŒ—m f'%s'", 
âame
);

55 
ex™
(1);

58 ~
Numb”SŒ—m
() {

59 
fşo£
(
m_å
);

61 
ušt32_t
 
g‘IÁ
() {

62 
ušt32_t
 
numb”
;

64 ià(
ä—d
(&
numb”
, (
št32_t
), 1, 
m_å
) == 0) {

65 
f£ek
(
m_å
, 0L, 
SEEK_SET
);

66 ià(
ä—d
(&
numb”
, (
št32_t
), 1, 
m_å
) == 0) {

67 
HT_ERROR
("Problem„eading integer from‚umber stream,ƒxiting...");

68 
ex™
(1);

72  
numb”
;

75 
´iv©e
:

76 
FILE
 *
m_å
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/Properties.cc

21 
	~<io¡»am
>

22 
	~<lim™s
>

23 
	~<f¡»am
>

24 
	~<¡ršg
>

27 
	~<ùy³.h
>

28 
	~<”ºo.h
>

29 
	~<lim™s.h
>

30 
	~<¡dlib.h
>

31 
	~<¡ršg.h
>

32 
	~<¡ršgs.h
>

33 
	~<sys/¡©.h
>

34 
	~<sys/ty³s.h
>

37 
	~"Logg”.h
"

38 
	~"Prİ”t›s.h
"

40 
usšg
 
Çme¥aû
 
¡d
;

41 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

44 
	gPrİ”t›s
::
	$lßd
(cÚ¡ *
âame
è
	`throw
(
¡d
::
šv®id_¬gum’t
) {

45 
¡©
 
¡©buf
;

46 *
Çme
, *
v®ue
, *
Ï¡
, *
±r
, *
lšeCh¬s
;

47 
¡d
::
¡ršg
 
v®ueSŒ
;

49 ià(
	`¡©
(
âame
, &
¡©buf
) != 0)

50 
throw
 
¡d
::
	`šv®id_¬gum’t
(
	`¡ršg
("Could‚Ù sˆ´İ”t› f'"è+ 
âame
 + "' - " + sŒšg(
	`¡»¼Ü
(
”ºo
)));

52 
if¡»am
 
	`ifs
(
âame
);

53 
¡ršg
 
lše
;

54 
	`g‘lše
(
ifs
, 
lše
)) {

56 
lšeCh¬s
 = (*)
lše
.
	`c_¡r
();

57 *
lšeCh¬s
 && 
	`is¥aû
(*lineChars))

58 
lšeCh¬s
++;

60 ià(*
lšeCh¬s
 == 0 || *lineChars == '#')

63 ià((
Çme
 = 
	`¡¹ok_r
(
lšeCh¬s
, "=", &
Ï¡
)) != 0) {

64 ià((
v®ue
 = 
	`¡¹ok_r
(0, "=", &
Ï¡
)) != 0) {

66 
±r
 = 
Çme
 + 
	`¡¾’
(name);

67 
±r
 > 
Çme
 && (
	`is¥aû
(*(ptr-1))))

68 
±r
--;

70 ià(
±r
 =ğ
Çme
)

72 *
±r
 = 0;

74 *
v®ue
 && 
	`is¥aû
(*value))

75 
v®ue
++;

77 ià(*
v®ue
 == 0)

80 
±r
 = 
v®ue
 + 
	`¡¾’
(value);

81 
±r
 > 
v®ue
 && (
	`is¥aû
(*(ptr-1))))

82 
±r
--;

84 ià(
±r
 =ğ
v®ue
)

86 *
±r
 = 0;

88 ià(*
v®ue
 =ğ'\'' && *(
±r
-1) == '\'') {

89 
v®ue
++;

90 *(
±r
-1) = 0;

91 ià(*
v®ue
 == 0)

94 ià(*
v®ue
 =ğ'"' && *(
±r
-1) == '"') {

95 
v®ue
++;

96 *(
±r
-1) = 0;

97 ià(*
v®ue
 == 0)

101 
v®ueSŒ
 = 
v®ue
;

103 
m_m­
[
Çme
] = 
v®ueSŒ
;

107 
	}
}

109 cÚ¡ *
	gPrİ”t›s
::
	$g‘
(cÚ¡ *
¡r
, cÚ¡ *
deçuÉV®ue
) {

110 
Prİ”tyM­T
::
™”©Ü
 
™”
 = 
m_m­
.
	`fšd
(
¡r
);

111 ià(
™”
 =ğ
m_m­
.
	`’d
())

112  
deçuÉV®ue
;

113  ((*
™”
).
£cÚd
.
	`c_¡r
());

114 
	}
}

120 
št64_t
 
	gPrİ”t›s
::
	$g‘_št64
(cÚ¡ *
¡r
, 
št64_t
 
deçuÉV®ue
) {

121 cÚ¡ *
±r
;

123 
Prİ”tyM­T
::
™”©Ü
 
™”
 = 
m_m­
.
	`fšd
(
¡r
);

124 ià(
™”
 =ğ
m_m­
.
	`’d
())

125  
deçuÉV®ue
;

127 
±r
 = (*
™”
).
£cÚd
.
	`c_¡r
(); 
	`isdig™
(*ptr);…tr++)

130 
ušt64_t
 
çùÜ
 = 1LL;

131 ià(*
±r
 != 0) {

132 ià(!
	`¡rÿ£cmp
(
±r
, "k"))

133 
çùÜ
 = 1000LL;

134 ià(!
	`¡rÿ£cmp
(
±r
, "m"))

135 
çùÜ
 = 1000000LL;

136 ià(!
	`¡rÿ£cmp
(
±r
, "g"))

137 
çùÜ
 = 1000000000LL;

139 
throw
 
¡d
::
	`šv®id_¬gum’t
(
	`¡ršg
("Inv®id v®ufÜ iÁeg”…rİ”ty '"è+ 
¡r
 + "' (v®ue=" + (*
™”
).
£cÚd
 + ")");

142 
¡ršg
 
num”icSŒ
 = 
	`¡ršg
((*
™”
).
£cÚd
.
	`c_¡r
(), 
±r
-(*iter).second.c_str());

144 
št64_t
 
Îv®
 = 
	`¡¹Şl
(
num”icSŒ
.
	`c_¡r
(), 0, 0);

145 ià(
Îv®
 =ğ0 && 
”ºo
 =ğ
EINVAL
)

146 
throw
 
¡d
::
	`šv®id_¬gum’t
(
	`¡ršg
("Could‚Ù cÚv”ˆ´İ”ty '"è+ 
¡r
 + "' (v®ue=" + (*
™”
).
£cÚd
 + ")o‡n integer");

148  
Îv®
 * 
çùÜ
;

149 
	}
}

151 
	gPrİ”t›s
::
	$g‘_št
(cÚ¡ *
¡r
, 
deçuÉV®ue
) {

152 
št64_t
 
Îv®
 = 
	`g‘_št64
(
¡r
, 
deçuÉV®ue
);

154 ià(
Îv®
 > 
num”ic_lim™s
<>::
	`max
())

155 
throw
 
¡d
::
	`šv®id_¬gum’t
(
	`¡ršg
("IÁeg” v®utoØÏrgfÜ…rİ”ty '"è+ 
¡r
 + "'");

157  ()
Îv®
;

158 
	}
}

160 
boŞ
 
	gPrİ”t›s
::
	$g‘_boŞ
(cÚ¡ *
¡r
, 
boŞ
 
deçuÉV®ue
) {

161 
Prİ”tyM­T
::
™”©Ü
 
™”
 = 
m_m­
.
	`fšd
(
¡r
);

162 ià(
™”
 =ğ
m_m­
.
	`’d
())

163  
deçuÉV®ue
;

165 ià(!
	`¡rÿ£cmp
((*
™”
).
£cÚd
.
	`c_¡r
(), "Œue"è|| !
	`¡rcmp
((*iter).second.c_str(), "1"))

166  
Œue
;

167 ià(!
	`¡rÿ£cmp
((*
™”
).
£cÚd
.
	`c_¡r
(), "çl£"è|| !
	`¡rcmp
((*iter).second.c_str(), "0"))

168  
çl£
;

170 
	`HT_ERRORF
("Inv®id v®ufÜ…rİ”ty '%s' (%s), usšg deçuÉ v®ue", 
¡r
, (*
™”
).
£cÚd
.
	`c_¡r
());

172  
deçuÉV®ue
;

173 
	}
}

177 
	g¡d
::
¡ršg
 
Prİ”t›s
::
	$£t
(cÚ¡ *
key
, cÚ¡ *
v®ue
) {

178 
¡d
::
¡ršg
 
ŞdV®ue
;

180 
Prİ”tyM­T
::
™”©Ü
 
™”
 = 
m_m­
.
	`fšd
(
key
);

181 ià(
™”
 !ğ
m_m­
.
	`’d
())

182 
ŞdV®ue
 = (*
™”
).
£cÚd
;

184 
m_m­
[
key
] = 
v®ue
;

186  
ŞdV®ue
;

187 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/Properties.h

21 #iâdeà
HYPERTABLE_PROPERTIES_H


22 
	#HYPERTABLE_PROPERTIES_H


	)

24 
	~<ext/hash_m­
>

26 
	~<boo¡/šŒusive_±r.hµ
>

28 
	~"Reã»nûCouÁ.h
"

29 
	~"SŒšgExt.h
"

31 
Çme¥aû
 
	gHy³¹abË
 {

33 şas 
	cPrİ”t›s
 : 
public
 
Reã»nûCouÁ
 {

35 
public
:

37 
Prİ”t›s
() { ; }

39 
Prİ”t›s
(
¡d
::
¡ršg
 
âame
) {

40 
lßd
(
âame
);

43 
lßd
(cÚ¡ *
âame
è
throw
(
¡d
::
šv®id_¬gum’t
);

45 
lßd
(
¡d
::
¡ršg
 &
âame
è{†ßd(âame.
c_¡r
()); }

47 cÚ¡ *
g‘
(cÚ¡ *
¡r
, cÚ¡ *
deçuÉV®ue
 = 
NULL
);

49 
g‘_št
(cÚ¡ *
¡r
, 
deçuÉV®ue
 = 0);

51 
št64_t
 
g‘_št64
(cÚ¡ *
¡r
, iÁ64_ˆ
deçuÉV®ue
 = 0);

53 
boŞ
 
g‘_boŞ
(cÚ¡ *
¡r
, boŞ 
deçuÉV®ue
 = 
çl£
);

55 
boŞ
 
has_key
(cÚ¡ *
¡r
) {

56 
	gPrİ”tyM­T
::
™”©Ü
 
™”
 = 
m_m­
.
fšd
(
¡r
);

57  (
	g™”
 =ğ
m_m­
.
’d
()è? 
çl£
 : 
Œue
;

60 
	g¡d
::
¡ršg
 
£t
(cÚ¡ *
key
, cÚ¡ *
v®ue
);

62 
	g´iv©e
:

64 
__gnu_cxx
::
	thash_m­
<
	t¡d
::
	t¡ršg
, std::¡ršg> 
	tPrİ”tyM­T
;

66 
Prİ”tyM­T
 
	gm_m­
;

68 
	gboo¡
::
	tšŒusive_±r
<
	tPrİ”t›s
> 
	tPrİ”t›sPŒ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/ReferenceCount.h

20 #iâdeà
HYPERTABLE_REFERENCECOUNT_H


21 
	#HYPERTABLE_REFERENCECOUNT_H


	)

23 
	~<boo¡/šŒusive_±r.hµ
>

25 
	~"©omic.h
"

27 
Çme¥aû
 
	gHy³¹abË
 {

29 
şass
 
	gReã»nûCouÁ
;

31 
šŒusive_±r_add_»f
(
Reã»nûCouÁ
 *
rc
);

32 
šŒusive_±r_»Ëa£
(
Reã»nûCouÁ
 *
rc
);

41 şas 
	cReã»nûCouÁ
 {

42 
	gpublic
:

43 
Reã»nûCouÁ
(è{ 
©omic_£t
(&
»fCouÁ
, 0); }

44 
	gvœtu®
 ~
Reã»nûCouÁ
() { ; }

45 
ä›nd
 
šŒusive_±r_add_»f
(
Reã»nûCouÁ
 *
rc
);

46 
ä›nd
 
šŒusive_±r_»Ëa£
(
Reã»nûCouÁ
 *
rc
);

47 
	g´iv©e
:

48 
©omic_t
 
»fCouÁ
;

56 
šlše
 
	$šŒusive_±r_add_»f
(
Reã»nûCouÁ
 *
rc
) {

57 
	`©omic_šc_»tuº
(&
rc
->
»fCouÁ
);

58 
	}
}

66 
šlše
 
	$šŒusive_±r_»Ëa£
(
Reã»nûCouÁ
 *
rc
) {

67 ià(
	`©omic_sub_ªd_‹¡
(1, &
rc
->
»fCouÁ
))

68 
d–‘e
 
rc
;

69 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/Runnable.h

21 #iâdeà
HYPERTABLE_RUNNABLE_H


22 
	#HYPERTABLE_RUNNABLE_H


	)

24 
Çme¥aû
 
	gHy³¹abË
 {

26 şas 
	cRuÂabË
 {

27 
	gpublic
:

28 
vœtu®
 
run
() = 0;

29 
	gvœtu®
 ~
RuÂabË
() { ; }

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/ServerLauncher.h

21 #iâdeà
HYPERTABLE_SERVERLAUNCHER_H


22 
	#HYPERTABLE_SERVERLAUNCHER_H


	)

24 
	~<io¡»am
>

27 
	~<sigÇl.h
>

28 
	~<sys/ty³s.h
>

29 
	~<uni¡d.h
>

30 
	~<pŞl.h
>

33 
Çme¥aû
 
Hy³¹abË
 {

35 şas 
	cS”v”Launch”
 {

36 
public
:

37 
S”v”Launch”
(cÚ¡ *
·th
, *cÚ¡ 
¬gv
[], cÚ¡ *
ouutFe
=0) {

38 
fd
[2];

39 
m_·th
 = 
·th
;

40 ià(
pe
(
fd
) < 0) {

41 
³¼Ü
("pipe");

42 
ex™
(1);

44 ià((
m_chd_pid
 = 
fÜk
()) == 0) {

45 ià(
ouutFe
) {

46 
outfd
 = 
İ’
(
ouutFe
, 
O_CREAT
|
O_TRUNC
|
O_WRONLY
, 0644);

47 ià(
outfd
 < 0) {

48 
³¼Ü
("open");

49 
ex™
(1);

51 
dup2
(
outfd
, 1);

53 
şo£
(
fd
[1]);

54 
dup2
(
fd
[0], 0);

55 
şo£
(
fd
[0]);

56 
execv
(
·th
, 
¬gv
);

58 
şo£
(
fd
[0]);

59 
m_wr™e_fd
 = 
fd
[1];

60 
pŞl
(0,0,2000);

63 ~
S”v”Launch”
() {

64 
¡d
::
û¼
 << "Klšg '" << 
m_·th
 << "'…id=" << 
m_chd_pid
 << std::
’dl
 << std::
æush
;

65 ià(
kl
(
m_chd_pid
, 9) == -1)

66 
³¼Ü
("kill");

69 
g‘_wr™e_desütÜ
(è{  
m_wr™e_fd
; }

71 
pid_t
 
g‘_pid
(è{  
m_chd_pid
; }

73 
´iv©e
:

74 cÚ¡ *
m_·th
;

75 
pid_t
 
m_chd_pid
;

76 
m_wr™e_fd
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/SockAddrMap.h

21 #iâdeà
SOCKADDRMAP_H


22 
	#SOCKADDRMAP_H


	)

24 
	~<ext/hash_m­
>

25 
usšg
 
Çme¥aû
 
	g¡d
;

28 
	~<sys/sock‘.h
>

29 
	~<Ãtš‘/š.h
>

30 
	~<¬·/š‘.h
>

33 şas 
	cSockAddrHash
 {

34 
public
:

35 
size_t
 
	$İ”©Ü
 (è(
sockaddr_š
 
addr
) const {

36  (
size_t
)(
addr
.
sš_addr
.
s_addr
 ^‡ddr.
sš_pÜt
);

38 
	}
};

39 
	sSockAddrEqu®
 {

40 
boŞ
 
İ”©Ü
()(
sockaddr_š
 
	maddr1
, sockaddr_š 
	maddr2
) const {

41  (
	maddr1
.
	msš_addr
.
	ms_addr
 =ğ
addr2
.
sš_addr
.
s_addr
è&& (
addr1
.
sš_pÜt
 ==‡ddr2.sin_port);

45 
	g‹m¶©e
<
ty³Çme
 
	g_Tp
,y³Çm
	gaddr
=
sockaddr_š
>

46 
şass
 
SockAddrM­T
 : 
public
 
__gnu_cxx
::
hash_m­
<
addr
, 
	g_Tp
, 
	gSockAddrHash
, 
	gSockAddrEqu®
> {

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/StringExt.h

20 #iâdeà
HYPERTABLE_STRINGEXT_H


21 
	#HYPERTABLE_STRINGEXT_H


	)

23 
	~<c¡dio
>

24 
	~<ext/hash_m­
>

25 
	~<¡dexû±
>

26 
	~<¡ršg
>

27 
	~<¡ršg.h
>

29 
Çme¥aû
 
	g__gnu_cxx
 {

30 
	g‹m¶©e
<> 
	ghash
< 
	g¡d
::
¡ršg
 > {

31 
size_t
 
İ”©Ü
()ĞcÚ¡ 
¡d
::
¡ršg
& 
x
 ) const {

32  
hash
< cÚ¡ * >()Ğ
x
.
c_¡r
() );

35 #ià
defšed
(
__APPLE__
è|| defšed(
__i386__
)

36 
	g‹m¶©e
<> 
	ghash
< 
	gušt64_t
 > {

37 
size_t
 
İ”©Ü
()ĞcÚ¡ 
ušt64_t
 
	gv®
 ) const {

38  
size_t
(
v®
);

45 
	sÉ_c¡r
 {

46 
boŞ
 
İ”©Ü
()(cÚ¡ * 
	ms1
, cÚ¡ * 
	ms2
) const {

47  
¡rcmp
(
s1
, 
s2
) < 0;

51 
šlše
 
	g¡d
::
¡ršg
 
İ”©Ü
+ĞcÚ¡ 
¡d
::¡ršg& 
s1
, 
	gsv®
 ) {

52 
	gcbuf
[8];

53 
¥rštf
(
cbuf
, "%d", 
sv®
);

54  
	gs1
 + 
	gcbuf
;

57 
šlše
 
	g¡d
::
¡ršg
 
İ”©Ü
+ĞcÚ¡ 
¡d
::¡ršg& 
s1
, 
	giv®
 ) {

58 
	gcbuf
[16];

59 
¥rštf
(
cbuf
, "%d", 
iv®
);

60  
	gs1
 + 
	gcbuf
;

63 
šlše
 
	g¡d
::
¡ršg
 
İ”©Ü
+ĞcÚ¡ 
¡d
::¡ršg& 
s1
, 
ušt32_t
 
	giv®
 ) {

64 
	gcbuf
[16];

65 
¥rštf
(
cbuf
, "%d", 
iv®
);

66  
	gs1
 + 
	gcbuf
;

69 
šlše
 
	g¡d
::
¡ršg
 
İ”©Ü
+ĞcÚ¡ 
¡d
::¡ršg& 
s1
, 
	gÎv®
 ) {

70 
	gcbuf
[32];

71 
¥rštf
(
cbuf
, "%Îd", 
Îv®
);

72  
	gs1
 + 
	gcbuf
;

75 
šlše
 
	g¡d
::
¡ršg
 
İ”©Ü
+ĞcÚ¡ 
¡d
::¡ršg& 
s1
, 
ušt64_t
 
	gÎv®
 ) {

76 
	gcbuf
[32];

77 
¥rštf
(
cbuf
, "%Îu", ()
Îv®
);

78  
	gs1
 + 
	gcbuf
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/Sweetener.h

20 #iâdeà
HYPERTABLE_SWEETNER_H


21 
	#HYPERTABLE_SWEETNER_H


	)

25 
	~<boo¡/fÜ—ch.hµ
>

27 
	#fÜ—ch
 
BOOST_FOREACH


	)

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/System.cc

21 
	~<c¡dlib
>

22 
	~<c¡ršg
>

23 
	~<io¡»am
>

24 
	~<¡ršg
>

27 
	~<¡dlib.h
>

28 
	~<sys/ty³s.h
>

29 
	~<sys/sysùl.h
>

30 
	~<uni¡d.h
>

33 
	~"FeUts.h
"

34 
	~"Logg”.h
"

35 
	~"Sy¡em.h
"

37 
usšg
 
Çme¥aû
 
Hy³¹abË
;

38 
usšg
 
Çme¥aû
 
	g¡d
;

41 
¡ršg
 
	gSy¡em
::
š¡®lDœ
;

42 
¡ršg
 
	gSy¡em
::
execubËName
;

43 
	gboo¡
::
mu‹x
 
Sy¡em
::
ms_mu‹x
;

45 
	gSy¡em
::
	$š™Ÿlize
(cÚ¡ *
¬gv0
) {

46 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
ms_mu‹x
);

47 cÚ¡ *
execP©h
 = 
	`g‘’v
("_");

48 
cwd
[1024];

49 
off£t
;

51 ià(
š¡®lDœ
 != "")

54 
	`¤ªd
(()
	`g‘pid
());

56 
	`g‘cwd
(
cwd
, 1024);

57 
	`¡rÿt
(
cwd
, "/");

59 *
±r
 = 
	`¡¼chr
(
¬gv0
, '/');

60 ià(
±r
 == 0) {

61 
execubËName
 = 
¬gv0
;

63 
¡d
::
¡ršg
 
âame
;

64 *
·th
 = 
	`g‘’v
("PATH");

65 *
Ï¡
;

66 
execP©h
 = 0;

67 
±r
 = 
	`¡¹ok_r
(
·th
, ":", &
Ï¡
);

68 
±r
) {

69 
âame
 = (
¡d
::
¡ršg
)
±r
 + "/" + 
execubËName
;

70 ià(
FeUts
::
	`exi¡s
(
âame
.
	`c_¡r
())) {

71 
execP©h
 = 
âame
.
	`c_¡r
();

74 
±r
 = 
	`¡¹ok_r
(0, ":", &
Ï¡
);

79 
execubËName
 = 
±r
+1;

81 
off£t
 = (
execP©h
è? 
	`¡¾’
ÓxecP©hè- sŒËn(
¬gv0
) : -1;

82 ià(
execP©h
 && 
off£t
 >= 0) {

83 ià(
execP©h
[0] != '/') {

84 
š¡®lDœ
 = 
cwd
;

85 
š¡®lDœ
 +ğ
execP©h
;

88 
š¡®lDœ
 = 
execP©h
;

91 ià(
¬gv0
[0] != '/') {

92 
š¡®lDœ
 = 
cwd
;

93 
š¡®lDœ
 +ğ
¬gv0
;

96 
š¡®lDœ
 = 
¬gv0
;

99 
¡ršg
::
size_ty³
 
pos
 = 
š¡®lDœ
.
	`rfšd
("/bin/");

100 ià(
pos
 =ğ
¡ršg
::
Åos
) {

101 
¡ršg
::
size_ty³
 
pos
 = 
š¡®lDœ
.
	`rfšd
("/");

102 ià(
pos
 =ğ
¡ršg
::
Åos
)

103 
š¡®lDœ
 = ".";

105 
š¡®lDœ
.
	`”a£
(
pos
);

110 
š¡®lDœ
.
	`”a£
(
pos
);

112 
Logg”
::
	`š™Ÿlize
(
execubËName
.
	`c_¡r
());

113 
	}
}

116 
	gSy¡em
::
	$g‘_´oûssÜ_couÁ
() {

117 #ià
	`defšed
(
__APPLE__
)

118 
mib
[2], 
nıus
;

119 
size_t
 
Ën
;

121 
mib
[0] = 
CTL_HW
;

122 
mib
[1] = 
HW_NCPU
;

123 
Ën
 = (
nıus
);

124 
	`sysùl
(
mib
, 2, &
nıus
, &
Ën
, 
NULL
, 0);

125  
nıus
;

126 #–ià
	`defšed
(
__lšux__
)

127  ()
	`syscÚf
(
_SC_NPROCESSORS_ONLN
);

129 
Im¶em’tMe
;

131 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/System.h

21 #iâdeà
HYPERTABLE_SYSTEM_H


22 
	#HYPERTABLE_SYSTEM_H


	)

24 
	~<¡ršg
>

25 
	~<¡ršg.h
>

27 
	~<boo¡/th»ad/mu‹x.hµ
>

29 
	#DUMP_CORE
 *((*)0èğ1;

	)

31 
Çme¥aû
 
	gHy³¹abË
 {

33 şas 
	cSy¡em
 {

35 
	gpublic
:

36 
š™Ÿlize
(cÚ¡ *
¬gv0
);

38 
	g¡d
::
¡ršg
 
š¡®lDœ
;

39 
	g¡d
::
¡ršg
 
execubËName
;

41 
g‘_´oûssÜ_couÁ
();

43 
	g´iv©e
:

44 
boo¡
::
mu‹x
 
ms_mu‹x
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/TestHarness.h

21 #iâdeà
HYPERTABLE_TESTHARNESS_H


22 
	#HYPERTABLE_TESTHARNESS_H


	)

24 
	~<log4ıp/FeAµ’d”.hh
>

25 
	~<log4ıp/Layout.hh
>

27 
	~<io¡»am
>

28 
	~<f¡»am
>

29 
	~<¡ršg
>

32 
	~<”ºo.h
>

35 
	~"Logg”.h
"

37 
usšg
 
Çme¥aû
 
¡d
;

39 
Çme¥aû
 
	gHy³¹abË
 {

44 şas 
	cNoTimeLayout
 : 
public
 
log4ıp
::
Layout
 {

45 
public
:

46 
NoTimeLayout
() { }

47 
vœtu®
 ~
NoTimeLayout
() { }

48 
vœtu®
 
¡ršg
 
fÜm©
(cÚ¡ 
log4ıp
::
LoggšgEv’t
& 
ev’t
) {

49 
¡d
::
o¡ršg¡»am
 
mes§ge
;

50 cÚ¡ 
	g¡d
::
¡ršg
& 
´iÜ™yName
 = 
log4ıp
::
PriÜ™y
::
g‘PriÜ™yName
(
ev’t
.
´iÜ™y
);

51 
	gmes§ge
 << 
	g´iÜ™yName
 << " " << 
	gev’t
.
	gÿ‹gÜyName
 << " " <<ƒv’t.
	gndc
 << ": " <<ƒv’t.mes§g<< 
	g¡d
::
’dl
;

52  
	gmes§ge
.
¡r
();

56 şas 
	cTe¡H¬Ãss
 {

57 
	gpublic
:

58 
Te¡H¬Ãss
(cÚ¡ *
Çme
) {

60 
m_Çme
 = 
Çme
;

62 
	gLogg”
::
š™Ÿlize
(
Çme
);

65 
¥rštf
(
m_ouut_fe
, "%s%d", 
Çme
, 
g‘pid
());

67 ià((
	gm_fd
 = 
İ’
(
m_ouut_fe
, 
O_CREAT
 | 
O_TRUNC
 | 
O_WRONLY
, 0644)) < 0) {

68 
HT_ERRORF
("İ’(%sèçed - %s", 
m_ouut_fe
, 
¡»¼Ü
(
”ºo
));

69 
ex™
(1);

72 
	gm_log_¡»am
.
İ’
(
m_ouut_fe
);

74 
	gLogg”
::
logg”
->
»moveAÎAµ’d”s
();

75 
	gm_­³nd”
 = 
Ãw
 
log4ıp
::
FeAµ’d”
((
¡ršg
)
Çme
, 
m_fd
);

76 
	gm_­³nd”
->
£tLayout
(
Ãw
 
NoTimeLayout
());

77 
	gLogg”
::
logg”
->
£tAµ’d”
(
m_­³nd”
);

79 ~
Te¡H¬Ãss
() {

80 
uÆšk
(
m_ouut_fe
);

83 
g‘_log_fe_desütÜ
(è{  
	gm_fd
; }

85 
	go¡»am
 &
g‘_log_¡»am
(è{  
	gm_log_¡»am
; }

87 
v®id©e_ªd_ex™
(cÚ¡ *
gŞd’Fe
) {

88 
	gex™V®
 = 0;

89 
	gm_log_¡»am
 << 
	gæush
;

90 
¡ršg
 
	gcommªd
 = (¡ršg)"difà" + 
m_ouut_fe
 + " " + 
gŞd’Fe
;

91 ià(
sy¡em
(
commªd
.
c_¡r
()))

92 
	gex™V®
 = 1;

93 ià(
	gex™V®
 == 0)

94 
uÆšk
(
m_ouut_fe
);

96 
	gû¼
 << "DifàE¼Ü: " << 
	gcommªd
 << 
	g’dl
;

97 
ex™
(
ex™V®
);

100 
»g’”©e_gŞd’_fe
(cÚ¡ *
gŞd’Fe
) {

101 
¡ršg
 
	gcommªd
 = (¡ršg)"ı " + 
m_ouut_fe
 + " " + 
gŞd’Fe
;

102 
sy¡em
(
commªd
.
c_¡r
());

105 
ş—r_ouut
() {

106 ià(!
	gm_­³nd”
->
»İ’
()) {

107 
HT_ERRORF
("ProbËm„e-İ’šg†oggšg ouuˆf%s", 
m_ouut_fe
);

108 
di¥Ïy_”rÜ_ªd_ex™
();

112 
di¥Ïy_”rÜ_ªd_ex™
() {

113 
	gm_log_¡»am
 << 
	gæush
;

114 
	gû¼
 << "E¼Ü, s“ '" << 
	gm_ouut_fe
 << "'" << 
	g’dl
;

120 
ex™
(1);

123 
	g´iv©e
:

124 
m_ouut_fe
[128];

125 
	glog4ıp
::
FeAµ’d”
 *
m_­³nd”
;

126 cÚ¡ *
	gm_Çme
;

127 
	gm_fd
;

128 
of¡»am
 
	gm_log_¡»am
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/Thread.h

20 #iâdeà
HYPERTABLE_THREAD_H


21 
	#HYPERTABLE_THREAD_H


	)

23 
	~<boo¡/th»ad.hµ
>

24 
	~"CommÚ/Logg”.h
"

26 
Çme¥aû
 
	gHy³¹abË
 {

28 #ifdeà
BOOST_HAS_PTHREADS


29 
	#HT_THREAD_ID_DECL
(
_v¬_
è
±h»ad_t
 
	)
_var_

30 
	#HT_ASSERT_SAME_THREAD
(
_tid_
èià(
	`±h»ad_£lf
() != (_tid_)) \

31 
	`HT_FATALF
("expected currenthread id %u, got %u", \

32 ()(
_tid_
), (è
	`±h»ad_£lf
())

	)

33 
	#HT_THREAD_ID_SET
(
_v¬_
è_v¬_ = 
	`±h»ad_£lf
()

	)

35 
	#HT_THREAD_ID_DECL
(
_v¬_
)

	)

36 
	#HT_ASSERT_SAME_THREAD
(
_tid_
)

	)

37 
	#HT_THREAD_ID_SET
(
_v¬_
)

	)

40 
	gboo¡
::
	tth»ad
 
	tTh»ad
;

41 
	gboo¡
::
	tth»ad_group
 
	tTh»adGroup
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/Usage.cc

21 
	~<io¡»am
>

24 
	~<¡dlib.h
>

27 
	~"U§ge.h
"

29 
usšg
 
Çme¥aû
 
Hy³¹abË
;

30 
usšg
 
Çme¥aû
 
	g¡d
;

33 
	gU§ge
::
	$dump
(cÚ¡ **
u§ge
) {

34 
i
=0; 
u§ge
[i] != 0; i++)

35 
cout
 << 
u§ge
[
i
] << 
’dl
;

36 
	}
}

39 
	gU§ge
::
	$dump_ªd_ex™
(cÚ¡ **
u§ge
, 
rcode
) {

40 
cout
 << 
’dl
;

41 
	`dump
(
u§ge
);

42 
cout
 << 
’dl
;

43 
	`ex™
(1);

44 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/Usage.h

21 #iâdeà
HYPERTABLE_USAGE_H


22 
	#HYPERTABLE_USAGE_H


	)

24 
Çme¥aû
 
	gHy³¹abË
 {

26 şas 
	cU§ge
 {

27 
	gpublic
:

28 
dump
(cÚ¡ **
u§ge
);

29 
dump_ªd_ex™
(cÚ¡ **
u§ge
, 
rcode
=1);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/atomic.h

21 #iâdeà
ATOMIC_H


22 
	#ATOMIC_H


	)

29 
	#LOCK
 "lock ; "

	)

36 ¡ruù { vŞ©
	mcouÁ”
; } 
	t©omic_t
;

38 
	#ATOMIC_INIT
(
i
è{ (iè}

	)

46 
	#©omic_»ad
(
v
è((v)->
couÁ”
)

	)

55 
	#©omic_£t
(
v
,
i
è(((v)->
couÁ”
èğ(i))

	)

64 
__šlše__
 
	$©omic_add
(
i
, 
©omic_t
 *
v
)

66 
__asm__
 
	`__vŞ©e__
(

67 
LOCK
 "addl %1,%0"

68 :"=m" (
v
->
couÁ”
)

69 :"œ" (
i
), "m" (
v
->
couÁ”
));

70 
	}
}

79 
__šlše__
 
	$©omic_sub
(
i
, 
©omic_t
 *
v
)

81 
__asm__
 
	`__vŞ©e__
(

82 
LOCK
 "subl %1,%0"

83 :"=m" (
v
->
couÁ”
)

84 :"œ" (
i
), "m" (
v
->
couÁ”
));

85 
	}
}

95 
__šlše__
 
	$©omic_add_»tuº
(
i
, 
©omic_t
 *
v
)

97 
__i
;

99 
__i
 = 
i
;

100 
__asm__
 
	`__vŞ©e__
(

101 
LOCK
 "xaddl %0, %1"

102 :"+r" (
i
), "+m" (
v
->
couÁ”
)

104  
i
 + 
__i
;

105 
	}
}

107 
__šlše__
 
	$©omic_sub_»tuº
(
i
, 
©omic_t
 *
v
)

109  
	`©omic_add_»tuº
(-
i
,
v
);

110 
	}
}

122 
__šlše__
 
	$©omic_sub_ªd_‹¡
(
i
, 
©omic_t
 *
v
)

124 
c
;

126 
__asm__
 
	`__vŞ©e__
(

127 
LOCK
 "subl %2,%0; sete %1"

128 :"=m" (
v
->
couÁ”
), "=qm" (
c
)

129 :"œ" (
i
), "m" (
v
->
couÁ”
) : "memory");

130  
c
;

131 
	}
}

139 
__šlše__
 
	$©omic_šc
(
©omic_t
 *
v
)

141 
__asm__
 
	`__vŞ©e__
(

142 
LOCK
 "incl %0"

143 :"=m" (
v
->
couÁ”
)

144 :"m" (
v
->
couÁ”
));

145 
	}
}

153 
__šlše__
 
	$©omic_dec
(
©omic_t
 *
v
)

155 
__asm__
 
	`__vŞ©e__
(

156 
LOCK
 "decl %0"

157 :"=m" (
v
->
couÁ”
)

158 :"m" (
v
->
couÁ”
));

159 
	}
}

169 
__šlše__
 
	$©omic_dec_ªd_‹¡
(
©omic_t
 *
v
)

171 
c
;

173 
__asm__
 
	`__vŞ©e__
(

174 
LOCK
 "decl %0; sete %1"

175 :"=m" (
v
->
couÁ”
), "=qm" (
c
)

176 :"m" (
v
->
couÁ”
) : "memory");

177  
c
 != 0;

178 
	}
}

188 
__šlše__
 
	$©omic_šc_ªd_‹¡
(
©omic_t
 *
v
)

190 
c
;

192 
__asm__
 
	`__vŞ©e__
(

193 
LOCK
 "incl %0; sete %1"

194 :"=m" (
v
->
couÁ”
), "=qm" (
c
)

195 :"m" (
v
->
couÁ”
) : "memory");

196  
c
 != 0;

197 
	}
}

208 
__šlše__
 
	$©omic_add_Ãg©ive
(
i
, 
©omic_t
 *
v
)

210 
c
;

212 
__asm__
 
	`__vŞ©e__
(

213 
LOCK
 "addl %2,%0; sets %1"

214 :"=m" (
v
->
couÁ”
), "=qm" (
c
)

215 :"œ" (
i
), "m" (
v
->
couÁ”
) : "memory");

216  
c
;

217 
	}
}

220 
	#©omic_ş—r_mask
(
mask
, 
addr
) \

221 
__asm__
 
	`__vŞ©e__
(
LOCK
 "andl %0,%1" \

222 : : "r" (~(
mask
)),"m" (*
addr
è: "memÜy")

	)

224 
	#©omic_£t_mask
(
mask
, 
addr
) \

225 
__asm__
 
	`__vŞ©e__
(
LOCK
 "orl %0,%1" \

226 : : "r" (
mask
),"m" (*(
addr
)è: "memÜy")

	)

228 
	#©omic_šc_»tuº
(
v
è(
	`©omic_add_»tuº
(1,v))

	)

229 
	#©omic_dec_»tuº
(
v
è(
	`©omic_sub_»tuº
(1,v))

	)

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/htConvert.cc

21 
	~<®gÜ™hm
>

22 
	~<cùy³
>

23 
	~<f¡»am
>

24 
	~<io¡»am
>

25 
	~<¡ršg
>

26 
	~<veùÜ
>

29 
	~<¡dšt.h
>

30 
	~<¡dio.h
>

31 
	~<¡ršg.h
>

32 
	~<uni¡d.h
>

35 
	~"FeUts.h
"

37 
usšg
 
Çme¥aû
 
Hy³¹abË
;

38 
usšg
 
Çme¥aû
 
	g¡d
;

40 
	gÇme¥aû
 {

41 
boŞ
 
CÚv”tFe
(cÚ¡ *
âame
, 
¡ršg
 &
cÚv”‹dCÚ‹Ás
);

49 
	$maš
(
¬gc
, **
¬gv
) {

50 
¡ršg
 
cÚv”‹dCÚ‹Ás
;

51 
¡ršg
 
ÜigName
;

52 
¡ršg
 
backupName
;

54 
i
=1; i<
¬gc
; i++) {

55 
cout
 << "CÚv”tšg '" << 
¬gv
[
i
] << "'" << 
’dl
 << 
æush
;

56 ià(!
	`CÚv”tFe
(
¬gv
[
i
], 
cÚv”‹dCÚ‹Ás
))

57 
û¼
 << "ProbËm cÚv”tšg '" << 
¬gv
[
i
] << "'" << 
’dl
;

59 
ÜigName
 = 
¬gv
[
i
];

60 
backupName
 = (
¡ršg
)
¬gv
[
i
] + ".old";

61 
	`uÆšk
(
backupName
.
	`c_¡r
());

62 
	`»Çme
(
ÜigName
.
	`c_¡r
(), 
backupName
.c_str());

64 
of¡»am
 
	`fout
(
¬gv
[
i
]);

65 
fout
 << 
cÚv”‹dCÚ‹Ás
;

66 
fout
.
	`şo£
();

71 
	}
}

73 
	gÇme¥aû
 {

75 
	g·œ
<cÚ¡ *, cÚ¡ *> 
	gexchªgeSŒšgs
[] = {

76 
¡d
::
make_·œ
("Add(", "add("),

77 
¡d
::
make_·œ
("AdvanceDataPtr", "advance_data_ptr"),

78 
¡d
::
make_·œ
("AppendByte", "append_byte"),

79 
¡d
::
make_·œ
("AppendByteArray", "append_byte_array"),

80 
¡d
::
make_·œ
("AppendBytes", "append_bytes"),

81 
¡d
::
make_·œ
("AppendInt", "append_int"),

82 
¡d
::
make_·œ
("AppendLong", "append_long"),

83 
¡d
::
make_·œ
("AppendShort", "append_short"),

84 
¡d
::
make_·œ
("AppendString", "append_string"),

85 
¡d
::
make_·œ
("CloseSocket(", "close_socket("),

86 
¡d
::
make_·œ
("Connect(", "connect("),

87 
¡d
::
make_·œ
("ConnectSocket(", "connect_socket("),

88 
¡d
::
make_·œ
("ContainsHandler(", "contains_handler("),

89 
¡d
::
make_·œ
("CreateDatagramReceiveSocket(", "create_datagram_receive_socket("),

90 
¡d
::
make_·œ
("DecomissionAll(", "decomission_all("),

91 
¡d
::
make_·œ
("DecomissionHandler(", "decomission_handler("),

92 
¡d
::
make_·œ
("GetComm(", "get_comm("),

93 
¡d
::
make_·œ
("GetDataPtr(", "get_data_ptr("),

94 
¡d
::
make_·œ
("GetDataPtrAddress(", "get_data_ptr_address("),

95 
¡d
::
make_·œ
("GetLocalAddress(", "get_local_address("),

96 
¡d
::
make_·œ
("GetThreadGroup", "get_thread_group"),

97 
¡d
::
make_·œ
("InsertDatagramHandler(", "insert_datagram_handler("),

98 
¡d
::
make_·œ
("Join(", "join("),

99 
¡d
::
make_·œ
("Listen(", "listen("),

100 
¡d
::
make_·œ
("LookupAcceptHandler(", "lookup_accept_handler("),

101 
¡d
::
make_·œ
("LookupDataHandler(", "lookup_data_handler("),

102 
¡d
::
make_·œ
("LookupDatagramHandler(", "lookup_datagram_handler("),

103 
¡d
::
make_·œ
("PurgeHandler(", "purge_handler("),

104 
¡d
::
make_·œ
("Remove(", "remove("),

105 
¡d
::
make_·œ
("RemoveHandler(", "remove_handler("),

106 
¡d
::
make_·œ
("ResetDataPointers", "reset_data_pointers"),

107 
¡d
::
make_·œ
("SendDatagram(", "send_datagram("),

108 
¡d
::
make_·œ
("SendRequest(", "send_request("),

109 
¡d
::
make_·œ
("SendResponse(", "send_response("),

110 
¡d
::
make_·œ
("SetQuietMode", "set_quiet_mode"),

111 
¡d
::
make_·œ
("SetTimer(", "set_timer("),

112 
¡d
::
make_·œ
("SetTimerAbsolute(", "set_timer_absolute("),

113 
¡d
::
make_·œ
("Shutdown(", "shutdown("),

114 
¡d
::
make_·œ
("WaitForConnection(", "wait_for_connection("),

115 
¡d
::
make_·œ
("WaitForEmpty(", "wait_for_empty("),

116 
¡d
::
make_·œ
("WaitForReply(", "wait_for_reply("),

117 
¡d
::
make_·œ
("m_app_name", "m_app_name"),

118 
¡d
::
make_·œ
("m_cond", "m_cond"),

119 
¡d
::
make_·œ
("m_datagram_handler_map", "m_datagram_handler_map"),

120 
¡d
::
make_·œ
("m_decomissioned_handlers", "m_decomissioned_handlers"),

121 
¡d
::
make_·œ
("m_event_ptr", "m_event_ptr"),

122 
¡d
::
make_·œ
("m_handler_map", "m_handler_map"),

123 
¡d
::
make_·œ
("m_impl", "m_impl"),

124 
¡d
::
make_·œ
("m_mutex", "m_mutex"),

125 
¡d
::
make_·œ
("m_receive_queue", "m_receive_queue"),

126 
¡d
::
make_·œ
("m_timer_reactor", "m_timer_reactor"),

127 
¡d
::
make_·œ
("newInstance(", "get_instance("),

128 
¡d
::
make_·œ
("toString(", "to_string("),

129 
¡d
::
make_·œ
("InitializeFromRequest(", "initialize_from_request("),

130 
¡d
::
make_·œ
("HeaderLength(", "header_length("),

131 
¡d
::
make_·œ
("Encode(", "encode("),

132 
¡d
::
make_·œ
("AssignUniqueId(", "assign_unique_id("),

133 
¡d
::
make_·œ
("SetFlags(", "set_flags("),

134 
¡d
::
make_·œ
("AddFlag(", "add_flag("),

135 
¡d
::
make_·œ
("SetProtocol(", "set_protocol("),

136 
¡d
::
make_·œ
("SetGroupId(", "set_group_id("),

137 
¡d
::
make_·œ
("SetTotalLen(", "set_total_len("),

138 
¡d
::
make_·œ
("m_id", "m_id"),

139 
¡d
::
make_·œ
("m_group_id", "m_group_id"),

140 
¡d
::
make_·œ
("m_total_len", "m_total_len"),

141 
¡d
::
make_·œ
("m_protocol", "m_protocol"),

142 
¡d
::
make_·œ
("m_flags", "m_flags"),

143 
¡d
::
make_·œ
((const *)0, (const *)0)

147 
off_t
 
	goff£t
;

148 cÚ¡ *
	gäomSŒšg
;

149 cÚ¡ *
	gtoSŒšg
;

150 } 
	tR•ÏûInfoT
;

152 
	sÉR•ÏûInfo
 {

153 
boŞ
 
İ”©Ü
()(cÚ¡ 
	gR•ÏûInfoT
 &
	gri1
, cÚ¡ R•ÏûInfoT &
	gri2
) const {

154  
	gri1
.
	goff£t
 < 
	gri2
.offset;

158 cÚ¡ *
	gcomm’tH—d”
 = \

179 
boŞ
 
CÚv”tFe
(cÚ¡ *
âame
, 
¡ršg
 &
cÚv”‹dCÚ‹Ás
) {

180 
off_t
 
	gÏ¡Off£t
, 
	gæ’
;

181 *
	gfcÚ‹Ás
 = 
FeUts
::
fe_to_bufãr
(
âame
, &
æ’
);

182 *
	g±r
 = 
fcÚ‹Ás
;

183 *
	gcodeS¹
, *
	gba£
;

184 
R•ÏûInfoT
 
	gršfo
;

185 
	gveùÜ
<
	gR•ÏûInfoT
> 
	griVec
;

187 
	gcÚv”‹dCÚ‹Ás
 = 
comm’tH—d”
;

189 ià(
	gfcÚ‹Ás
 == 0)

190  
çl£
;

193 *
	g±r
 && 
is¥aû
(*
±r
))

194 
	g±r
++;

196 ià(
¡ºcmp
(
±r
, "/*", 2)) {

197 
	gû¼
 << "Comm’ˆh—d”‚Ù found iÀ'" << 
	gâame
 << "'" << 
	g’dl
;

198  
	gçl£
;

201 ià((
	g±r
 = 
¡r¡r
(
±r
, "*/")) == 0) {

202 
û¼
 << "UÇbËØfšdƒnd oàcomm’ˆh—d” iÀ'" << 
âame
 << "'" << 
’dl
;

203  
	gçl£
;

206 
	gcodeS¹
 = 
±r
 + 2;

209 
	gcodeS¹
 = 
±r
;

211 
size_t
 
	gi
=0; 
	gexchªgeSŒšgs
[
i
].
	gfœ¡
 != 0; i++) {

212 
	gba£
 = 
codeS¹
;

213 (
	g±r
 = 
¡r¡r
(
ba£
, 
exchªgeSŒšgs
[
i
].
fœ¡
)) != 0) {

214 
ršfo
.
off£t
 = 
±r
 - 
fcÚ‹Ás
;

215 
	gršfo
.
	gäomSŒšg
 = 
exchªgeSŒšgs
[
i
].
fœ¡
;

216 
	gršfo
.
	gtoSŒšg
 = 
exchªgeSŒšgs
[
i
].
£cÚd
;

217 
	griVec
.
push_back
(
ršfo
);

218 
	gba£
 = 
±r
 + 
¡¾’
(
exchªgeSŒšgs
[
i
].
fœ¡
);

222 ià(!
	griVec
.
em±y
()) {

223 
ÉR•ÏûInfo
 
	gÉObj
;

224 
sÜt
(
riVec
.
begš
(),„iVec.
’d
(), 
ÉObj
);

227 
	gÏ¡Off£t
 = 
codeS¹
 - 
fcÚ‹Ás
;

228 
size_t
 
	gi
=0; i<
	griVec
.
size
(); i++) {

229 
	gû¼
 << "R•Ïû‡ˆoff£ˆ" << 
	griVec
[
i
].
	goff£t
 << 
	g’dl
 << 
	gæush
;

230 
	gcÚv”‹dCÚ‹Ás
 +ğ
¡ršg
(
fcÚ‹Ás
 + 
Ï¡Off£t
, 
riVec
[
i
].
off£t
-lastOffset);

231 
	gcÚv”‹dCÚ‹Ás
 +ğ
riVec
[
i
].
toSŒšg
;

232 
	gÏ¡Off£t
 = 
riVec
[
i
].
off£t
 + 
¡¾’
ÔiVec[i].
äomSŒšg
);

235 
	gcÚv”‹dCÚ‹Ás
 +ğ
¡ršg
(
fcÚ‹Ás
 + 
Ï¡Off£t
, 
æ’
-lastOffset);

237  
	gŒue
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/md5.cc

27 #iâdeà
_CRT_SECURE_NO_DEPRECATE


28 
	#_CRT_SECURE_NO_DEPRECATE
 1

	)

31 
	~<¡ršg.h
>

32 
	~<¡dio.h
>

34 
	~"md5.h
"

39 #iâdeà
GET_UINT32_LE


40 
	#GET_UINT32_LE
(
n
,
b
,
i
) \

42 (
n
èğĞ(è(
b
)[(
i
) ] ) \

43 | ( (è(
b
)[(
i
) + 1] << 8 ) \

44 | ( (è(
b
)[(
i
) + 2] << 16 ) \

45 | ( (è(
b
)[(
i
) + 3] << 24 ); \

46 }

	)

48 #iâdeà
PUT_UINT32_LE


49 
	#PUT_UINT32_LE
(
n
,
b
,
i
) \

51 (
b
)[(
i
è] = (èĞ(
n
) ); \

52 (
b
)[(
i
è+ 1] = (èĞ(
n
) >> 8 ); \

53 (
b
)[(
i
è+ 2] = (èĞ(
n
) >> 16 ); \

54 (
b
)[(
i
è+ 3] = (èĞ(
n
) >> 24 ); \

55 }

	)

61 
	$md5_¡¬ts
Ğ
md5_cÚ‹xt
 *
ùx
 )

63 
ùx
->
tÙ®
[0] = 0;

64 
ùx
->
tÙ®
[1] = 0;

66 
ùx
->
¡©e
[0] = 0x67452301;

67 
ùx
->
¡©e
[1] = 0xEFCDAB89;

68 
ùx
->
¡©e
[2] = 0x98BADCFE;

69 
ùx
->
¡©e
[3] = 0x10325476;

70 
	}
}

72 
	$md5_´oûss
Ğ
md5_cÚ‹xt
 *
ùx
, 
d©a
[64] )

74 
X
[16], 
A
, 
B
, 
C
, 
D
;

76 
	`GET_UINT32_LE
Ğ
X
[0], 
d©a
, 0 );

77 
	`GET_UINT32_LE
Ğ
X
[1], 
d©a
, 4 );

78 
	`GET_UINT32_LE
Ğ
X
[2], 
d©a
, 8 );

79 
	`GET_UINT32_LE
Ğ
X
[3], 
d©a
, 12 );

80 
	`GET_UINT32_LE
Ğ
X
[4], 
d©a
, 16 );

81 
	`GET_UINT32_LE
Ğ
X
[5], 
d©a
, 20 );

82 
	`GET_UINT32_LE
Ğ
X
[6], 
d©a
, 24 );

83 
	`GET_UINT32_LE
Ğ
X
[7], 
d©a
, 28 );

84 
	`GET_UINT32_LE
Ğ
X
[8], 
d©a
, 32 );

85 
	`GET_UINT32_LE
Ğ
X
[9], 
d©a
, 36 );

86 
	`GET_UINT32_LE
Ğ
X
[10], 
d©a
, 40 );

87 
	`GET_UINT32_LE
Ğ
X
[11], 
d©a
, 44 );

88 
	`GET_UINT32_LE
Ğ
X
[12], 
d©a
, 48 );

89 
	`GET_UINT32_LE
Ğ
X
[13], 
d©a
, 52 );

90 
	`GET_UINT32_LE
Ğ
X
[14], 
d©a
, 56 );

91 
	`GET_UINT32_LE
Ğ
X
[15], 
d©a
, 60 );

93 
	#S
(
x
,
n
è((x <<‚è| ((x & 0xFFFFFFFFè>> (32 -‚)))

	)

95 
	#P
(
a
,
b
,
c
,
d
,
k
,
s
,
t
) \

97 
a
 +ğ
	`F
(
b
,
c
,
d
è+ 
X
[
k
] + 
t
;‡ = 
	`S
×,
s
) + b; \

98 }

	)

100 
A
 = 
ùx
->
¡©e
[0];

101 
B
 = 
ùx
->
¡©e
[1];

102 
C
 = 
ùx
->
¡©e
[2];

103 
D
 = 
ùx
->
¡©e
[3];

105 
	#F
(
x
,
y
,
z
è(z ^ (x & (y ^ z)))

	)

107 
	`P
Ğ
A
, 
B
, 
C
, 
D
, 0, 7, 0xD76AA478 );

108 
	`P
Ğ
D
, 
A
, 
B
, 
C
, 1, 12, 0xE8C7B756 );

109 
	`P
Ğ
C
, 
D
, 
A
, 
B
, 2, 17, 0x242070DB );

110 
	`P
Ğ
B
, 
C
, 
D
, 
A
, 3, 22, 0xC1BDCEEE );

111 
	`P
Ğ
A
, 
B
, 
C
, 
D
, 4, 7, 0xF57C0FAF );

112 
	`P
Ğ
D
, 
A
, 
B
, 
C
, 5, 12, 0x4787C62A );

113 
	`P
Ğ
C
, 
D
, 
A
, 
B
, 6, 17, 0xA8304613 );

114 
	`P
Ğ
B
, 
C
, 
D
, 
A
, 7, 22, 0xFD469501 );

115 
	`P
Ğ
A
, 
B
, 
C
, 
D
, 8, 7, 0x698098D8 );

116 
	`P
Ğ
D
, 
A
, 
B
, 
C
, 9, 12, 0x8B44F7AF );

117 
	`P
Ğ
C
, 
D
, 
A
, 
B
, 10, 17, 0xFFFF5BB1 );

118 
	`P
Ğ
B
, 
C
, 
D
, 
A
, 11, 22, 0x895CD7BE );

119 
	`P
Ğ
A
, 
B
, 
C
, 
D
, 12, 7, 0x6B901122 );

120 
	`P
Ğ
D
, 
A
, 
B
, 
C
, 13, 12, 0xFD987193 );

121 
	`P
Ğ
C
, 
D
, 
A
, 
B
, 14, 17, 0xA679438E );

122 
	`P
Ğ
B
, 
C
, 
D
, 
A
, 15, 22, 0x49B40821 );

124 #undeà
F


126 
	#F
(
x
,
y
,
z
è(y ^ (z & (x ^ y)))

	)

128 
	`P
Ğ
A
, 
B
, 
C
, 
D
, 1, 5, 0xF61E2562 );

129 
	`P
Ğ
D
, 
A
, 
B
, 
C
, 6, 9, 0xC040B340 );

130 
	`P
Ğ
C
, 
D
, 
A
, 
B
, 11, 14, 0x265E5A51 );

131 
	`P
Ğ
B
, 
C
, 
D
, 
A
, 0, 20, 0xE9B6C7AA );

132 
	`P
Ğ
A
, 
B
, 
C
, 
D
, 5, 5, 0xD62F105D );

133 
	`P
Ğ
D
, 
A
, 
B
, 
C
, 10, 9, 0x02441453 );

134 
	`P
Ğ
C
, 
D
, 
A
, 
B
, 15, 14, 0xD8A1E681 );

135 
	`P
Ğ
B
, 
C
, 
D
, 
A
, 4, 20, 0xE7D3FBC8 );

136 
	`P
Ğ
A
, 
B
, 
C
, 
D
, 9, 5, 0x21E1CDE6 );

137 
	`P
Ğ
D
, 
A
, 
B
, 
C
, 14, 9, 0xC33707D6 );

138 
	`P
Ğ
C
, 
D
, 
A
, 
B
, 3, 14, 0xF4D50D87 );

139 
	`P
Ğ
B
, 
C
, 
D
, 
A
, 8, 20, 0x455A14ED );

140 
	`P
Ğ
A
, 
B
, 
C
, 
D
, 13, 5, 0xA9E3E905 );

141 
	`P
Ğ
D
, 
A
, 
B
, 
C
, 2, 9, 0xFCEFA3F8 );

142 
	`P
Ğ
C
, 
D
, 
A
, 
B
, 7, 14, 0x676F02D9 );

143 
	`P
Ğ
B
, 
C
, 
D
, 
A
, 12, 20, 0x8D2A4C8A );

145 #undeà
F


147 
	#F
(
x
,
y
,
z
è(x ^ y ^ z)

	)

149 
	`P
Ğ
A
, 
B
, 
C
, 
D
, 5, 4, 0xFFFA3942 );

150 
	`P
Ğ
D
, 
A
, 
B
, 
C
, 8, 11, 0x8771F681 );

151 
	`P
Ğ
C
, 
D
, 
A
, 
B
, 11, 16, 0x6D9D6122 );

152 
	`P
Ğ
B
, 
C
, 
D
, 
A
, 14, 23, 0xFDE5380C );

153 
	`P
Ğ
A
, 
B
, 
C
, 
D
, 1, 4, 0xA4BEEA44 );

154 
	`P
Ğ
D
, 
A
, 
B
, 
C
, 4, 11, 0x4BDECFA9 );

155 
	`P
Ğ
C
, 
D
, 
A
, 
B
, 7, 16, 0xF6BB4B60 );

156 
	`P
Ğ
B
, 
C
, 
D
, 
A
, 10, 23, 0xBEBFBC70 );

157 
	`P
Ğ
A
, 
B
, 
C
, 
D
, 13, 4, 0x289B7EC6 );

158 
	`P
Ğ
D
, 
A
, 
B
, 
C
, 0, 11, 0xEAA127FA );

159 
	`P
Ğ
C
, 
D
, 
A
, 
B
, 3, 16, 0xD4EF3085 );

160 
	`P
Ğ
B
, 
C
, 
D
, 
A
, 6, 23, 0x04881D05 );

161 
	`P
Ğ
A
, 
B
, 
C
, 
D
, 9, 4, 0xD9D4D039 );

162 
	`P
Ğ
D
, 
A
, 
B
, 
C
, 12, 11, 0xE6DB99E5 );

163 
	`P
Ğ
C
, 
D
, 
A
, 
B
, 15, 16, 0x1FA27CF8 );

164 
	`P
Ğ
B
, 
C
, 
D
, 
A
, 2, 23, 0xC4AC5665 );

166 #undeà
F


168 
	#F
(
x
,
y
,
z
è(y ^ (x | ~z))

	)

170 
	`P
Ğ
A
, 
B
, 
C
, 
D
, 0, 6, 0xF4292244 );

171 
	`P
Ğ
D
, 
A
, 
B
, 
C
, 7, 10, 0x432AFF97 );

172 
	`P
Ğ
C
, 
D
, 
A
, 
B
, 14, 15, 0xAB9423A7 );

173 
	`P
Ğ
B
, 
C
, 
D
, 
A
, 5, 21, 0xFC93A039 );

174 
	`P
Ğ
A
, 
B
, 
C
, 
D
, 12, 6, 0x655B59C3 );

175 
	`P
Ğ
D
, 
A
, 
B
, 
C
, 3, 10, 0x8F0CCC92 );

176 
	`P
Ğ
C
, 
D
, 
A
, 
B
, 10, 15, 0xFFEFF47D );

177 
	`P
Ğ
B
, 
C
, 
D
, 
A
, 1, 21, 0x85845DD1 );

178 
	`P
Ğ
A
, 
B
, 
C
, 
D
, 8, 6, 0x6FA87E4F );

179 
	`P
Ğ
D
, 
A
, 
B
, 
C
, 15, 10, 0xFE2CE6E0 );

180 
	`P
Ğ
C
, 
D
, 
A
, 
B
, 6, 15, 0xA3014314 );

181 
	`P
Ğ
B
, 
C
, 
D
, 
A
, 13, 21, 0x4E0811A1 );

182 
	`P
Ğ
A
, 
B
, 
C
, 
D
, 4, 6, 0xF7537E82 );

183 
	`P
Ğ
D
, 
A
, 
B
, 
C
, 11, 10, 0xBD3AF235 );

184 
	`P
Ğ
C
, 
D
, 
A
, 
B
, 2, 15, 0x2AD7D2BB );

185 
	`P
Ğ
B
, 
C
, 
D
, 
A
, 9, 21, 0xEB86D391 );

187 #undeà
F


189 
ùx
->
¡©e
[0] +ğ
A
;

190 
ùx
->
¡©e
[1] +ğ
B
;

191 
ùx
->
¡©e
[2] +ğ
C
;

192 
ùx
->
¡©e
[3] +ğ
D
;

193 
	}
}

198 
	$md5_upd©e
Ğ
md5_cÚ‹xt
 *
ùx
, *
šput
, 
’
 )

200 
fl
;

201 
Ëá
;

203 ifĞ
’
 <= 0 )

206 
Ëá
 = 
ùx
->
tÙ®
[0] & 0x3F;

207 
fl
 = 64 - 
Ëá
;

209 
ùx
->
tÙ®
[0] +ğ
’
;

210 
ùx
->
tÙ®
[0] &= 0xFFFFFFFF;

212 ifĞ
ùx
->
tÙ®
[0] < (è
’
 )

213 
ùx
->
tÙ®
[1]++;

215 ifĞ
Ëá
 && 
’
 >ğ
fl
 )

217 
	`memıy
Ğ(*è(
ùx
->
bufãr
 + 
Ëá
),

218 (*è
šput
, 
fl
 );

219 
	`md5_´oûss
Ğ
ùx
, ctx->
bufãr
 );

220 
šput
 +ğ
fl
;

221 
’
 -ğ
fl
;

222 
Ëá
 = 0;

225  
’
 >= 64 )

227 
	`md5_´oûss
Ğ
ùx
, 
šput
 );

228 
šput
 += 64;

229 
’
 -= 64;

232 ifĞ
’
 > 0 )

234 
	`memıy
Ğ(*è(
ùx
->
bufãr
 + 
Ëá
),

235 (*è
šput
, 
’
 );

237 
	}
}

239 cÚ¡ 
	gmd5_·ddšg
[64] =

250 
	$md5_fšish
Ğ
md5_cÚ‹xt
 *
ùx
, 
ouut
[16] )

252 
Ï¡
, 
·dn
;

253 
high
, 
low
;

254 
msgËn
[8];

256 
high
 = ( 
ùx
->
tÙ®
[0] >> 29 )

257 | ( 
ùx
->
tÙ®
[1] << 3 );

258 
low
 = ( 
ùx
->
tÙ®
[0] << 3 );

260 
	`PUT_UINT32_LE
Ğ
low
, 
msgËn
, 0 );

261 
	`PUT_UINT32_LE
Ğ
high
, 
msgËn
, 4 );

263 
Ï¡
 = 
ùx
->
tÙ®
[0] & 0x3F;

264 
·dn
 = ( 
Ï¡
 < 56 ) ? ( 56 -†ast ) : ( 120 -†ast );

266 
	`md5_upd©e
Ğ
ùx
, (*è
md5_·ddšg
, 
·dn
 );

267 
	`md5_upd©e
Ğ
ùx
, 
msgËn
, 8 );

269 
	`PUT_UINT32_LE
Ğ
ùx
->
¡©e
[0], 
ouut
, 0 );

270 
	`PUT_UINT32_LE
Ğ
ùx
->
¡©e
[1], 
ouut
, 4 );

271 
	`PUT_UINT32_LE
Ğ
ùx
->
¡©e
[2], 
ouut
, 8 );

272 
	`PUT_UINT32_LE
Ğ
ùx
->
¡©e
[3], 
ouut
, 12 );

273 
	}
}

278 
	$md5_fe
Ğ*
·th
, 
ouut
[16] )

280 
FILE
 *
f
;

281 
size_t
 
n
;

282 
md5_cÚ‹xt
 
ùx
;

283 
buf
[1024];

285 ifĞĞ
f
 = 
	`fİ’
Ğ
·th
, "rb" ) ) =ğ
NULL
 )

288 
	`md5_¡¬ts
Ğ&
ùx
 );

290  ( 
n
 = 
	`ä—d
Ğ
buf
, 1, Ğbuà), 
f
 ) ) > 0 )

291 
	`md5_upd©e
Ğ&
ùx
, 
buf
, (è
n
 );

293 
	`md5_fšish
Ğ&
ùx
, 
ouut
 );

295 
	`fşo£
Ğ
f
 );

297 
	}
}

302 
	$md5_csum
Ğ*
šput
, 
’
,

303 
ouut
[16] )

305 
md5_cÚ‹xt
 
ùx
;

307 
	`md5_¡¬ts
Ğ&
ùx
 );

308 
	`md5_upd©e
Ğ&
ùx
, 
šput
, 
’
 );

309 
	`md5_fšish
Ğ&
ùx
, 
ouut
 );

310 
	}
}

315 
	$md5_hmac
Ğ*
key
, 
keyËn
,

316 *
šput
, 
’
,

317 
ouut
[16] )

319 
i
;

320 
md5_cÚ‹xt
 
ùx
;

321 
k_ad
[64];

322 
k_İad
[64];

323 
tmpbuf
[16];

325 
	`mem£t
Ğ
k_ad
, 0x36, 64 );

326 
	`mem£t
Ğ
k_İad
, 0x5C, 64 );

328  
i
 = 0; i < 
keyËn
; i++ )

330 ifĞ
i
 >= 64 ) ;

332 
k_ad
[
i
] ^ğ
key
[i];

333 
k_İad
[
i
] ^ğ
key
[i];

336 
	`md5_¡¬ts
Ğ&
ùx
 );

337 
	`md5_upd©e
Ğ&
ùx
, 
k_ad
, 64 );

338 
	`md5_upd©e
Ğ&
ùx
, 
šput
, 
’
 );

339 
	`md5_fšish
Ğ&
ùx
, 
tmpbuf
 );

341 
	`md5_¡¬ts
Ğ&
ùx
 );

342 
	`md5_upd©e
Ğ&
ùx
, 
k_İad
, 64 );

343 
	`md5_upd©e
Ğ&
ùx
, 
tmpbuf
, 16 );

344 
	`md5_fšish
Ğ&
ùx
, 
ouut
 );

346 
	`mem£t
Ğ
k_ad
, 0, 64 );

347 
	`mem£t
Ğ
k_İad
, 0, 64 );

348 
	`mem£t
Ğ
tmpbuf
, 0, 16 );

349 
	`mem£t
Ğ&
ùx
, 0, Ğ
md5_cÚ‹xt
 ) );

350 
	}
}

352 cÚ¡ 
	g_md5_¤c
[] = "_md5_src";

354 cÚ¡ 
	ghex_dig™s
[] = "0123456789ABCDEF";

356 
	$md5_¡ršg
(cÚ¡ *
šput
, 
ouut
[33]) {

357 
md5_cÚ‹xt
 
ùx
;

358 
dige¡
[16];

360 
	`md5_¡¬ts
(&
ùx
);

361 
	`md5_upd©e
(&
ùx
, (*)
šput
, 
	`¡¾’
(input));

362 
	`md5_fšish
(&
ùx
, 
dige¡
);

364 
šdex
, 
j
=0;

365 
i
=0; i<16; i++) {

366 
šdex
 = (
dige¡
[
i
] & 0xF0) >> 4;

367 
ouut
[
j
++] = 
hex_dig™s
[
šdex
];

368 
šdex
 = 
dige¡
[
i
] & 0x0F;

369 
ouut
[
j
++] = 
hex_dig™s
[
šdex
];

371 
ouut
[
j
] = 0;

372 
	}
}

374 #ifdeà
SELF_TEST


378 cÚ¡ 
	gmd5_‹¡_¡r
[7][81] =

390 cÚ¡ 
	gmd5_‹¡_sum
[7][16] =

411 
	$md5_£lf_‹¡
( )

413 
i
;

414 
md5sum
[16];

416  
i
 = 0; i < 7; i++ )

418 
	`´štf
Ğ" MD5e¡ #%d: ", 
i
 + 1 );

420 
	`md5_csum
Ğ(*è
md5_‹¡_¡r
[
i
],

421 
	`¡¾’
Ğ
md5_‹¡_¡r
[
i
] ), 
md5sum
 );

423 ifĞ
	`memcmp
Ğ
md5sum
, 
md5_‹¡_sum
[
i
], 16 ) != 0 )

425 
	`´štf
( "failed\n" );

429 
	`´štf
( "passed\n" );

432 
	`´štf
( "\n" );

434 
	}
}

436 
	$md5_£lf_‹¡
( )

439 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/md5.h

21 #iâdeà
_MD5_H


22 
	#_MD5_H


	)

24 #ifdeà
__ılu¥lus


33 
tÙ®
[2];

34 
¡©e
[4];

35 
bufãr
[64];

37 
	tmd5_cÚ‹xt
;

44 
md5_¡¬ts
Ğ
md5_cÚ‹xt
 *
ùx
 );

53 
md5_upd©e
Ğ
md5_cÚ‹xt
 *
ùx
, *
šput
, 
’
 );

61 
md5_fšish
Ğ
md5_cÚ‹xt
 *
ùx
, 
ouut
[16] );

70 
md5_csum
Ğ*
šput
, 
’
,

71 
ouut
[16] );

80 
md5_fe
Ğ*
·th
, 
ouut
[16] );

91 
md5_hmac
Ğ*
key
, 
keyËn
,

92 *
šput
, 
’
,

93 
ouut
[16] );

100 
md5_£lf_‹¡
( );

108 
md5_¡ršg
(cÚ¡ *
šput
, 
ouut
[33]);

111 #ifdeà
__ılu¥lus


	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/Broker.h

21 #iâdeà
HYPERTABLE_DFSBROKER_BROKER_H


22 
	#HYPERTABLE_DFSBROKER_BROKER_H


	)

24 
	~"CommÚ/Reã»nûCouÁ.h
"

26 
	~"DfsBrok”/Lib/O³nFeM­.h
"

28 
	~"Re¥Ú£C®lbackO³n.h
"

29 
	~"Re¥Ú£C®lbackR—d.h
"

30 
	~"Re¥Ú£C®lbackAµ’d.h
"

31 
	~"Re¥Ú£C®lbackL’gth.h
"

32 
	~"Re¥Ú£C®lbackR—ddœ.h
"

34 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

36 
Çme¥aû
 
	gHy³¹abË
 {

38 
Çme¥aû
 
	gDfsBrok”
 {

40 şas 
	cBrok”
 : 
public
 
Reã»nûCouÁ
 {

41 
public
:

42 
vœtu®
 ~
Brok”
() { ; }

43 
vœtu®
 
İ’
(
Re¥Ú£C®lbackO³n
 *
cb
, cÚ¡ *
f›Name
, 
ušt32_t
 
bufãrSize
) = 0;

44 
vœtu®
 
ü—‹
(
Re¥Ú£C®lbackO³n
 *
cb
, cÚ¡ *
feName
, 
boŞ
 
ov”wr™e
,

45 
ušt32_t
 
bufãrSize
, 
ušt16_t
 
»¶iÿtiÚ
, 
ušt64_t
 
blockSize
) = 0;

46 
vœtu®
 
şo£
(
Re¥Ú£C®lback
 *
cb
, 
ušt32_t
 
fd
) = 0;

47 
vœtu®
 
»ad
(
Re¥Ú£C®lbackR—d
 *
cb
, 
ušt32_t
 
fd
, ušt32_ˆ
amouÁ
) = 0;

48 
vœtu®
 
­³nd
(
Re¥Ú£C®lbackAµ’d
 *
cb
, 
ušt32_t
 
fd
, ušt32_ˆ
amouÁ
, 
ušt8_t
 *
d©a
) = 0;

49 
vœtu®
 
£ek
(
Re¥Ú£C®lback
 *
cb
, 
ušt32_t
 
fd
, 
ušt64_t
 
off£t
) = 0;

50 
vœtu®
 
»move
(
Re¥Ú£C®lback
 *
cb
, cÚ¡ *
feName
) = 0;

51 
vœtu®
 
Ëngth
(
Re¥Ú£C®lbackL’gth
 *
cb
, cÚ¡ *
f›Name
) = 0;

52 
vœtu®
 
´—d
(
Re¥Ú£C®lbackR—d
 *
cb
, 
ušt32_t
 
fd
, 
ušt64_t
 
off£t
, ušt32_ˆ
amouÁ
) = 0;

53 
vœtu®
 
mkdœs
(
Re¥Ú£C®lback
 *
cb
, cÚ¡ *
dœName
) = 0;

54 
vœtu®
 
rmdœ
(
Re¥Ú£C®lback
 *
cb
, cÚ¡ *
dœName
) = 0;

55 
vœtu®
 
»addœ
(
Re¥Ú£C®lbackR—ddœ
 *
cb
, cÚ¡ *
dœName
) = 0;

56 
vœtu®
 
æush
(
Re¥Ú£C®lback
 *
cb
, 
ušt32_t
 
fd
) = 0;

57 
vœtu®
 
¡©us
(
Re¥Ú£C®lback
 *
cb
) = 0;

58 
vœtu®
 
shutdown
(
Re¥Ú£C®lback
 *
cb
) = 0;

60 
	gO³nFeM­
 &
g‘_İ’_fe_m­
(è{  
	gm_İ’_fe_m­
; }

62 
	g´Ùeùed
:

63 
O³nFeM­
 
m_İ’_fe_m­
;

65 
	gboo¡
::
	tšŒusive_±r
<
	tBrok”
> 
	tBrok”PŒ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/Client.cc

21 
	~<ÿs£¹
>

23 
	~"AsyncComm/Comm.h
"

24 
	~"AsyncComm/H—d”Bud”.h
"

25 
	~"AsyncComm/S”Ÿliz©iÚ.h
"

27 
	~"CommÚ/E¼Ü.h
"

28 
	~"CommÚ/IÃtAddr.h
"

29 
	~"CommÚ/Logg”.h
"

31 
	~"Cl›Á.h
"

33 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

34 
usšg
 
Çme¥aû
 
	gHy³¹abË
::
DfsBrok”
;

37 
	gCl›Á
::
	$Cl›Á
(
CÚÃùiÚMªag”PŒ
 &
cÚn_mªag”_±r
, 
sockaddr_š
 &
addr
, 
time_t
 
timeout
è: 
	`m_cÚn_mªag”_±r
(cÚn_mªag”_±r), 
	`m_addr
×ddr), 
	$m_timeout
(
timeout
) {

38 
m_comm
 = 
cÚn_mªag”_±r
->
	`g‘_comm
();

39 
cÚn_mªag”_±r
->
	`add
(
m_addr
, 
m_timeout
, "DFS Broker");

40 
	}
}

44 
	gCl›Á
::
	$Cl›Á
(
CÚÃùiÚMªag”PŒ
 &
cÚn_mªag”_±r
, 
Prİ”t›sPŒ
 &
´İs_±r
è: 
	$m_cÚn_mªag”_±r
(
cÚn_mªag”_±r
) {

45 cÚ¡ *
ho¡
;

46 
ušt16_t
 
pÜt
;

48 
m_comm
 = 
cÚn_mªag”_±r
->
	`g‘_comm
();

51 ià((
pÜt
 = (
ušt16_t
)
´İs_±r
->
	`g‘_št
("DfsBroker.Port", 0)) == 0) {

52 
	`HT_ERROR
(".Port…roperty‚ot specified.");

53 
	`ex™
(1);

56 ià((
ho¡
 = 
´İs_±r
->
	`g‘
("DfsBroker.Host", (const *)0)) == 0) {

57 
	`HT_ERROR
(".Host…roperty‚ot specified.");

58 
	`ex™
(1);

61 ià((
m_timeout
 = 
´İs_±r
->
	`g‘_št
("DfsBroker.Timeout", 0)) == 0)

62 
m_timeout
 = 
´İs_±r
->
	`g‘_št
("Hypertable.Request.Timeout", 60);

64 
IÃtAddr
::
	`š™Ÿlize
(&
m_addr
, 
ho¡
, 
pÜt
);

67 
cÚn_mªag”_±r
->
	`add
(
m_addr
, 10, "DFS Broker");

69 
	}
}

71 
	gCl›Á
::
	$Cl›Á
(
Comm
 *
comm
, 
sockaddr_š
 &
addr
, 
time_t
 
timeout
è: 
	`m_comm
(comm), 
	`m_cÚn_mªag”_±r
(0), 
	`m_addr
×ddr), 
	$m_timeout
(
timeout
) {

72 
	}
}

76 
	gCl›Á
::
İ’
(
¡d
::
¡ršg
 &
Çme
, 
Di¥©chHªdËr
 *
hªdËr
) {

77 
CommBufPŒ
 
cbufPŒ
Ğ
m_´ÙocŞ
.
ü—‹_İ’_»que¡
(
Çme
, 0) );

78  
£nd_mes§ge
(
cbufPŒ
, 
hªdËr
);

83 
	gCl›Á
::
İ’
(
¡d
::
¡ršg
 &
Çme
, 
št32_t
 *
fdp
) {

84 
Di¥©chHªdËrSynchrÚiz”
 
	gsyncHªdËr
;

85 
Ev’tPŒ
 
	gev’tPŒ
;

86 *
	gfdp
 = -1;

87 
CommBufPŒ
 
cbufPŒ
Ğ
m_´ÙocŞ
.
ü—‹_İ’_»que¡
(
Çme
, 0) );

88 
	g”rÜ
 = 
£nd_mes§ge
(
cbufPŒ
, &
syncHªdËr
);

89 ià(
	g”rÜ
 =ğ
E¼Ü
::
OK
) {

90 ià(!
syncHªdËr
.
wa™_fÜ_»¶y
(
ev’tPŒ
)) {

91 
HT_ERRORF
("Df 'İ’'ƒ¼Ü,‚ame=% : %s", 
Çme
.
c_¡r
(), 
m_´ÙocŞ
.
¡ršg_fÜm©_mes§ge
(
ev’tPŒ
).c_str());

93 
	g”rÜ
 = 
decode_»¥Ú£_İ’
(
ev’tPŒ
, 
fdp
);

95  
	g”rÜ
;

99 
	gCl›Á
::
İ’_bufã»d
(
¡d
::
¡ršg
 &
Çme
, 
ušt32_t
 
buf_size
, ušt32_ˆ
out¡ªdšg
, 
št32_t
 *
fdp
, 
ušt64_t
 
¡¬t_off£t
, ušt64_ˆ
’d_off£t
) {

100 
	g”rÜ
;

102 ià((
	g”rÜ
 = 
İ’
(
Çme
, 
fdp
)è!ğ
E¼Ü
::
OK
)

103  
”rÜ
;

106 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

107 
as£¹
(
m_bufã»d_»ad”_m­
.
fšd
(*
fdp
è=ğm_bufã»d_»ad”_m­.
’d
());

108 
	gm_bufã»d_»ad”_m­
[*
fdp
] = 
Ãw
 
Cl›ÁBufã»dR—d”HªdËr
(
this
, *fdp, 
buf_size
, 
out¡ªdšg
, 
¡¬t_off£t
, 
’d_off£t
);

111  
	gE¼Ü
::
OK
;

116 
	gCl›Á
::
ü—‹
(
¡d
::
¡ršg
 &
Çme
, 
boŞ
 
ov”wr™e
, 
št32_t
 
bufãrSize
,

117 
št32_t
 
»¶iÿtiÚ
, 
št64_t
 
blockSize
, 
Di¥©chHªdËr
 *
hªdËr
) {

118 
CommBufPŒ
 
cbufPŒ
Ğ
m_´ÙocŞ
.
ü—‹_ü—‹_»que¡
(
Çme
, 
ov”wr™e
, 
bufãrSize
, 
»¶iÿtiÚ
, 
blockSize
) );

119  
£nd_mes§ge
(
cbufPŒ
, 
hªdËr
);

123 
	gCl›Á
::
ü—‹
(
¡d
::
¡ršg
 &
Çme
, 
boŞ
 
ov”wr™e
, 
št32_t
 
bufãrSize
,

124 
št32_t
 
»¶iÿtiÚ
, 
št64_t
 
blockSize
, iÁ32_ˆ*
fdp
) {

125 
Di¥©chHªdËrSynchrÚiz”
 
	gsyncHªdËr
;

126 
Ev’tPŒ
 
	gev’tPŒ
;

127 *
	gfdp
 = -1;

128 
CommBufPŒ
 
cbufPŒ
Ğ
m_´ÙocŞ
.
ü—‹_ü—‹_»que¡
(
Çme
, 
ov”wr™e
, 
bufãrSize
, 
»¶iÿtiÚ
, 
blockSize
) );

129 
	g”rÜ
 = 
£nd_mes§ge
(
cbufPŒ
, &
syncHªdËr
);

130 ià(
	g”rÜ
 =ğ
E¼Ü
::
OK
) {

131 ià(!
syncHªdËr
.
wa™_fÜ_»¶y
(
ev’tPŒ
)) {

132 
HT_ERRORF
("Df 'ü—‹'ƒ¼Ü,‚ame=% : %s", 
Çme
.
c_¡r
(), 
m_´ÙocŞ
.
¡ršg_fÜm©_mes§ge
(
ev’tPŒ
).c_str());

134 
	g”rÜ
 = 
decode_»¥Ú£_ü—‹
(
ev’tPŒ
, 
fdp
);

136  
	g”rÜ
;

141 
	gCl›Á
::
	$şo£
(
št32_t
 
fd
, 
Di¥©chHªdËr
 *
hªdËr
) {

142 
Cl›ÁBufã»dR—d”HªdËr
 *
brHªdËr
 = 0;

143 
CommBufPŒ
 
	`cbufPŒ
Ğ
m_´ÙocŞ
.
	`ü—‹_şo£_»que¡
(
fd
) );

146 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

147 
Bufã»dR—d”M­T
::
™”©Ü
 
™”
 = 
m_bufã»d_»ad”_m­
.
	`fšd
(
fd
);

148 ià(
™”
 !ğ
m_bufã»d_»ad”_m­
.
	`’d
()) {

149 
brHªdËr
 = (*
™”
).
£cÚd
;

150 
m_bufã»d_»ad”_m­
.
	`”a£
(
™”
);

153 
d–‘e
 
brHªdËr
;

155  
	`£nd_mes§ge
(
cbufPŒ
, 
hªdËr
);

156 
	}
}

160 
	gCl›Á
::
	$şo£
(
št32_t
 
fd
) {

161 
Cl›ÁBufã»dR—d”HªdËr
 *
brHªdËr
 = 0;

162 
Di¥©chHªdËrSynchrÚiz”
 
syncHªdËr
;

163 
Ev’tPŒ
 
ev’tPŒ
;

164 
CommBufPŒ
 
	`cbufPŒ
Ğ
m_´ÙocŞ
.
	`ü—‹_şo£_»que¡
(
fd
) );

167 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

168 
Bufã»dR—d”M­T
::
™”©Ü
 
™”
 = 
m_bufã»d_»ad”_m­
.
	`fšd
(
fd
);

169 ià(
™”
 !ğ
m_bufã»d_»ad”_m­
.
	`’d
()) {

170 
brHªdËr
 = (*
™”
).
£cÚd
;

171 
m_bufã»d_»ad”_m­
.
	`”a£
(
™”
);

174 
d–‘e
 
brHªdËr
;

176 
”rÜ
 = 
	`£nd_mes§ge
(
cbufPŒ
, &
syncHªdËr
);

177 ià(
”rÜ
 =ğ
E¼Ü
::
OK
) {

178 ià(!
syncHªdËr
.
	`wa™_fÜ_»¶y
(
ev’tPŒ
)) {

179 
	`HT_ERRORF
("Df 'şo£'ƒ¼Ü, fd=%d : %s", 
fd
, 
m_´ÙocŞ
.
	`¡ršg_fÜm©_mes§ge
(
ev’tPŒ
).
	`c_¡r
());

181 
”rÜ
 = 
	`decode_»¥Ú£
(
ev’tPŒ
);

184  
”rÜ
;

185 
	}
}

189 
	gCl›Á
::
	$»ad
(
št32_t
 
fd
, 
ušt32_t
 
amouÁ
, 
Di¥©chHªdËr
 *
hªdËr
) {

190 
CommBufPŒ
 
	`cbufPŒ
Ğ
m_´ÙocŞ
.
	`ü—‹_»ad_»que¡
(
fd
, 
amouÁ
) );

191  
	`£nd_mes§ge
(
cbufPŒ
, 
hªdËr
);

192 
	}
}

196 
	gCl›Á
::
	$»ad
(
št32_t
 
fd
, 
ušt32_t
 
amouÁ
, 
ušt8_t
 *
d¡
, ušt32_ˆ*
Ä—dp
) {

197 
Cl›ÁBufã»dR—d”HªdËr
 *
brHªdËr
 = 0;

200 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

201 
Bufã»dR—d”M­T
::
™”©Ü
 
™”
 = 
m_bufã»d_»ad”_m­
.
	`fšd
(
fd
);

202 ià(
™”
 !ğ
m_bufã»d_»ad”_m­
.
	`’d
())

203 
brHªdËr
 = (*
™”
).
£cÚd
;

206 ià(
brHªdËr
)

207  
brHªdËr
->
	`»ad
(
d¡
, 
amouÁ
, 
Ä—dp
);

209 
Di¥©chHªdËrSynchrÚiz”
 
syncHªdËr
;

210 
Ev’tPŒ
 
ev’tPŒ
;

211 
CommBufPŒ
 
	`cbufPŒ
Ğ
m_´ÙocŞ
.
	`ü—‹_»ad_»que¡
(
fd
, 
amouÁ
) );

212 
”rÜ
 = 
	`£nd_mes§ge
(
cbufPŒ
, &
syncHªdËr
);

213 *
Ä—dp
 = 0;

214 ià(
”rÜ
 =ğ
E¼Ü
::
OK
) {

215 ià(!
syncHªdËr
.
	`wa™_fÜ_»¶y
(
ev’tPŒ
)) {

216 
	`HT_ERRORF
("Dfs 'read'ƒrror (amount=%d, fd=%d) : %s",

217 
amouÁ
, 
fd
, 
m_´ÙocŞ
.
	`¡ršg_fÜm©_mes§ge
(
ev’tPŒ
).
	`c_¡r
());

219 
”rÜ
 = 
	`decode_»¥Ú£_»ad
(
ev’tPŒ
, 
d¡
, 
Ä—dp
);

221  
”rÜ
;

222 
	}
}

226 
	gCl›Á
::
	$­³nd
(
št32_t
 
fd
, cÚ¡ *
buf
, 
ušt32_t
 
amouÁ
, 
Di¥©chHªdËr
 *
hªdËr
) {

227 
CommBufPŒ
 
	`cbufPŒ
Ğ
m_´ÙocŞ
.
	`ü—‹_­³nd_»que¡
(
fd
, 
buf
, 
amouÁ
) );

228  
	`£nd_mes§ge
(
cbufPŒ
, 
hªdËr
);

229 
	}
}

233 
	gCl›Á
::
	$­³nd
(
št32_t
 
fd
, cÚ¡ *
buf
, 
ušt32_t
 
amouÁ
) {

234 
Di¥©chHªdËrSynchrÚiz”
 
syncHªdËr
;

235 
Ev’tPŒ
 
ev’tPŒ
;

236 
CommBufPŒ
 
	`cbufPŒ
Ğ
m_´ÙocŞ
.
	`ü—‹_­³nd_»que¡
(
fd
, 
buf
, 
amouÁ
) );

237 
”rÜ
 = 
	`£nd_mes§ge
(
cbufPŒ
, &
syncHªdËr
);

238 ià(
”rÜ
 =ğ
E¼Ü
::
OK
) {

239 ià(!
syncHªdËr
.
	`wa™_fÜ_»¶y
(
ev’tPŒ
)) {

240 
	`HT_ERRORF
("Df '­³nd'ƒ¼Ü, fd=%d,‡mouÁ=%d : %s", 
fd
, 
amouÁ
, 
m_´ÙocŞ
.
	`¡ršg_fÜm©_mes§ge
(
ev’tPŒ
).
	`c_¡r
());

242 
ušt64_t
 
off£t
;

243 
ušt32_t
 
aùu®_amouÁ
;

244 
”rÜ
 = 
	`decode_»¥Ú£_­³nd
(
ev’tPŒ
, &
off£t
, &
aùu®_amouÁ
);

245 ià(
amouÁ
 !ğ
aùu®_amouÁ
) {

246 
	`HT_ERRORF
("ShÜˆDFS f­³nd fd=%d :r›dØ­³nd %d buˆÚly gÙ %d", 
fd
, 
amouÁ
, 
aùu®_amouÁ
);

247 
”rÜ
 = 
E¼Ü
::
DFSBROKER_IO_ERROR
;

250  
”rÜ
;

251 
	}
}

254 
	gCl›Á
::
	$£ek
(
št32_t
 
fd
, 
ušt64_t
 
off£t
, 
Di¥©chHªdËr
 *
hªdËr
) {

255 
CommBufPŒ
 
	`cbufPŒ
Ğ
m_´ÙocŞ
.
	`ü—‹_£ek_»que¡
(
fd
, 
off£t
) );

256  
	`£nd_mes§ge
(
cbufPŒ
, 
hªdËr
);

257 
	}
}

260 
	gCl›Á
::
	$£ek
(
št32_t
 
fd
, 
ušt64_t
 
off£t
) {

261 
Di¥©chHªdËrSynchrÚiz”
 
syncHªdËr
;

262 
Ev’tPŒ
 
ev’tPŒ
;

263 
CommBufPŒ
 
	`cbufPŒ
Ğ
m_´ÙocŞ
.
	`ü—‹_£ek_»que¡
(
fd
, 
off£t
) );

264 
”rÜ
 = 
	`£nd_mes§ge
(
cbufPŒ
, &
syncHªdËr
);

265 ià(
”rÜ
 =ğ
E¼Ü
::
OK
) {

266 ià(!
syncHªdËr
.
	`wa™_fÜ_»¶y
(
ev’tPŒ
)) {

267 
	`HT_ERRORF
("Df '£ek'ƒ¼Ü, fd=%d, off£t=%Îd : %s", 
fd
, 
off£t
, 
m_´ÙocŞ
.
	`¡ršg_fÜm©_mes§ge
(
ev’tPŒ
).
	`c_¡r
());

268 
”rÜ
 = 
	`decode_»¥Ú£
(
ev’tPŒ
);

271  
”rÜ
;

272 
	}
}

275 
	gCl›Á
::
»move
(
¡d
::
¡ršg
 &
Çme
, 
Di¥©chHªdËr
 *
hªdËr
) {

276 
CommBufPŒ
 
cbufPŒ
Ğ
m_´ÙocŞ
.
ü—‹_»move_»que¡
(
Çme
) );

277  
£nd_mes§ge
(
cbufPŒ
, 
hªdËr
);

281 
	gCl›Á
::
»move
(
¡d
::
¡ršg
 &
Çme
) {

282 
Di¥©chHªdËrSynchrÚiz”
 
syncHªdËr
;

283 
Ev’tPŒ
 
	gev’tPŒ
;

284 
CommBufPŒ
 
cbufPŒ
Ğ
m_´ÙocŞ
.
ü—‹_»move_»que¡
(
Çme
) );

285 
	g”rÜ
 = 
£nd_mes§ge
(
cbufPŒ
, &
syncHªdËr
);

286 ià(
	g”rÜ
 =ğ
E¼Ü
::
OK
) {

287 ià(!
syncHªdËr
.
wa™_fÜ_»¶y
(
ev’tPŒ
)) {

288 
HT_ERRORF
("Df '»move'ƒ¼Ü,‚ame=% : %s", 
Çme
.
c_¡r
(), 
m_´ÙocŞ
.
¡ršg_fÜm©_mes§ge
(
ev’tPŒ
).c_str());

289 
	g”rÜ
 = 
decode_»¥Ú£
(
ev’tPŒ
);

292  
	g”rÜ
;

297 
	gCl›Á
::
	$shutdown
(
ušt16_t
 
æags
, 
Di¥©chHªdËr
 *
hªdËr
) {

298 
CommBufPŒ
 
	`cbufPŒ
Ğ
m_´ÙocŞ
.
	`ü—‹_shutdown_»que¡
(
æags
) );

299  
	`£nd_mes§ge
(
cbufPŒ
, 
hªdËr
);

300 
	}
}

303 
	gCl›Á
::
	$¡©us
() {

304 
Di¥©chHªdËrSynchrÚiz”
 
syncHªdËr
;

305 
Ev’tPŒ
 
ev’tPŒ
;

306 
CommBufPŒ
 
	`cbufPŒ
Ğ
m_´ÙocŞ
.
	`ü—‹_¡©us_»que¡
() );

307 
”rÜ
 = 
	`£nd_mes§ge
(
cbufPŒ
, &
syncHªdËr
);

308 ià(
”rÜ
 =ğ
E¼Ü
::
OK
) {

309 ià(!
syncHªdËr
.
	`wa™_fÜ_»¶y
(
ev’tPŒ
)) {

310 
	`HT_ERRORF
(" '¡©us'ƒ¼Ü : %s", 
m_´ÙocŞ
.
	`¡ršg_fÜm©_mes§ge
(
ev’tPŒ
).
	`c_¡r
());

311 
”rÜ
 = 
	`decode_»¥Ú£
(
ev’tPŒ
);

314  
”rÜ
;

315 
	}
}

318 
	gCl›Á
::
Ëngth
(
¡d
::
¡ršg
 &
Çme
, 
Di¥©chHªdËr
 *
hªdËr
) {

319 
CommBufPŒ
 
cbufPŒ
Ğ
m_´ÙocŞ
.
ü—‹_Ëngth_»que¡
(
Çme
) );

320  
£nd_mes§ge
(
cbufPŒ
, 
hªdËr
);

325 
	gCl›Á
::
Ëngth
(
¡d
::
¡ršg
 &
Çme
, 
št64_t
 *
ËÅ
) {

326 
Di¥©chHªdËrSynchrÚiz”
 
	gsyncHªdËr
;

327 
Ev’tPŒ
 
	gev’tPŒ
;

328 
CommBufPŒ
 
cbufPŒ
Ğ
m_´ÙocŞ
.
ü—‹_Ëngth_»que¡
(
Çme
) );

329 
	g”rÜ
 = 
£nd_mes§ge
(
cbufPŒ
, &
syncHªdËr
);

330 ià(
	g”rÜ
 =ğ
E¼Ü
::
OK
) {

331 ià(!
syncHªdËr
.
wa™_fÜ_»¶y
(
ev’tPŒ
)) {

332 
HT_ERRORF
("Df 'Ëngth'ƒ¼Ü,‚ame=% : %s", 
Çme
.
c_¡r
(), 
m_´ÙocŞ
.
¡ršg_fÜm©_mes§ge
(
ev’tPŒ
).c_str());

334 
	g”rÜ
 = 
decode_»¥Ú£_Ëngth
(
ev’tPŒ
, 
ËÅ
);

336  
	g”rÜ
;

341 
	gCl›Á
::
	$´—d
(
št32_t
 
fd
, 
ušt64_t
 
off£t
, 
ušt32_t
 
amouÁ
, 
Di¥©chHªdËr
 *
hªdËr
) {

342 
CommBufPŒ
 
	`cbufPŒ
Ğ
m_´ÙocŞ
.
	`ü—‹_pos™iÚ_»ad_»que¡
(
fd
, 
off£t
, 
amouÁ
) );

343  
	`£nd_mes§ge
(
cbufPŒ
, 
hªdËr
);

344 
	}
}

348 
	gCl›Á
::
	$´—d
(
št32_t
 
fd
, 
ušt64_t
 
off£t
, 
ušt32_t
 
amouÁ
, 
ušt8_t
 *
d¡
, ušt32_ˆ*
Ä—dp
) {

349 
Di¥©chHªdËrSynchrÚiz”
 
syncHªdËr
;

350 
Ev’tPŒ
 
ev’tPŒ
;

351 
CommBufPŒ
 
	`cbufPŒ
Ğ
m_´ÙocŞ
.
	`ü—‹_pos™iÚ_»ad_»que¡
(
fd
, 
off£t
, 
amouÁ
) );

352 
”rÜ
 = 
	`£nd_mes§ge
(
cbufPŒ
, &
syncHªdËr
);

353 *
Ä—dp
 = 0;

354 ià(
”rÜ
 =ğ
E¼Ü
::
OK
) {

355 ià(!
syncHªdËr
.
	`wa™_fÜ_»¶y
(
ev’tPŒ
)) {

356 
	`HT_ERRORF
("Dfs 'pread'ƒrror (offset=%lld,‡mount=%d, fd=%d) : %s",

357 
off£t
, 
amouÁ
, 
fd
, 
m_´ÙocŞ
.
	`¡ršg_fÜm©_mes§ge
(
ev’tPŒ
).
	`c_¡r
());

359 
”rÜ
 = 
	`decode_»¥Ú£_´—d
(
ev’tPŒ
, 
d¡
, 
Ä—dp
);

362  
”rÜ
;

363 
	}
}

366 
	gCl›Á
::
mkdœs
(
¡d
::
¡ršg
 &
Çme
, 
Di¥©chHªdËr
 *
hªdËr
) {

367 
CommBufPŒ
 
cbufPŒ
Ğ
m_´ÙocŞ
.
ü—‹_mkdœs_»que¡
(
Çme
) );

368  
£nd_mes§ge
(
cbufPŒ
, 
hªdËr
);

372 
	gCl›Á
::
mkdœs
(
¡d
::
¡ršg
 &
Çme
) {

373 
Di¥©chHªdËrSynchrÚiz”
 
syncHªdËr
;

374 
Ev’tPŒ
 
	gev’tPŒ
;

375 
CommBufPŒ
 
cbufPŒ
Ğ
m_´ÙocŞ
.
ü—‹_mkdœs_»que¡
(
Çme
) );

376 
	g”rÜ
 = 
£nd_mes§ge
(
cbufPŒ
, &
syncHªdËr
);

377 ià(
	g”rÜ
 =ğ
E¼Ü
::
OK
) {

378 ià(!
syncHªdËr
.
wa™_fÜ_»¶y
(
ev’tPŒ
)) {

379 
HT_ERRORF
("Df 'mkdœs'ƒ¼Ü,‚ame=% : %s", 
Çme
.
c_¡r
(), 
m_´ÙocŞ
.
¡ršg_fÜm©_mes§ge
(
ev’tPŒ
).c_str());

380 
	g”rÜ
 = 
decode_»¥Ú£
(
ev’tPŒ
);

383  
	g”rÜ
;

387 
	gCl›Á
::
	$æush
(
št32_t
 
fd
, 
Di¥©chHªdËr
 *
hªdËr
) {

388 
CommBufPŒ
 
	`cbufPŒ
Ğ
m_´ÙocŞ
.
	`ü—‹_æush_»que¡
(
fd
) );

389  
	`£nd_mes§ge
(
cbufPŒ
, 
hªdËr
);

390 
	}
}

393 
	gCl›Á
::
	$æush
(
št32_t
 
fd
) {

394 
Di¥©chHªdËrSynchrÚiz”
 
syncHªdËr
;

395 
Ev’tPŒ
 
ev’tPŒ
;

396 
CommBufPŒ
 
	`cbufPŒ
Ğ
m_´ÙocŞ
.
	`ü—‹_æush_»que¡
(
fd
) );

397 
”rÜ
 = 
	`£nd_mes§ge
(
cbufPŒ
, &
syncHªdËr
);

398 ià(
”rÜ
 =ğ
E¼Ü
::
OK
) {

399 ià(!
syncHªdËr
.
	`wa™_fÜ_»¶y
(
ev’tPŒ
)) {

400 
	`HT_ERRORF
("Df 'æush'ƒ¼Ü, fd=%d : %s", 
fd
, 
m_´ÙocŞ
.
	`¡ršg_fÜm©_mes§ge
(
ev’tPŒ
).
	`c_¡r
());

401 
”rÜ
 = 
	`decode_»¥Ú£
(
ev’tPŒ
);

404  
”rÜ
;

405 
	}
}

408 
	gCl›Á
::
rmdœ
(
¡d
::
¡ršg
 &
Çme
, 
Di¥©chHªdËr
 *
hªdËr
) {

409 
CommBufPŒ
 
cbufPŒ
Ğ
m_´ÙocŞ
.
ü—‹_rmdœ_»que¡
(
Çme
) );

410  
£nd_mes§ge
(
cbufPŒ
, 
hªdËr
);

414 
	gCl›Á
::
rmdœ
(
¡d
::
¡ršg
 &
Çme
) {

415 
Di¥©chHªdËrSynchrÚiz”
 
syncHªdËr
;

416 
Ev’tPŒ
 
	gev’tPŒ
;

417 
CommBufPŒ
 
cbufPŒ
Ğ
m_´ÙocŞ
.
ü—‹_rmdœ_»que¡
(
Çme
) );

418 
	g”rÜ
 = 
£nd_mes§ge
(
cbufPŒ
, &
syncHªdËr
);

419 ià(
	g”rÜ
 =ğ
E¼Ü
::
OK
) {

420 ià(!
syncHªdËr
.
wa™_fÜ_»¶y
(
ev’tPŒ
)) {

421 
HT_ERRORF
("Df 'rmdœ'ƒ¼Ü,‚ame=% : %s", 
Çme
.
c_¡r
(), 
m_´ÙocŞ
.
¡ršg_fÜm©_mes§ge
(
ev’tPŒ
).c_str());

422 
	g”rÜ
 = 
decode_»¥Ú£
(
ev’tPŒ
);

425  
	g”rÜ
;

433 
	gCl›Á
::
»addœ
(
¡d
::
¡ršg
 &
Çme
, 
Di¥©chHªdËr
 *
hªdËr
) {

434 
CommBufPŒ
 
cbufPŒ
Ğ
m_´ÙocŞ
.
ü—‹_»addœ_»que¡
(
Çme
) );

435  
£nd_mes§ge
(
cbufPŒ
, 
hªdËr
);

443 
	gCl›Á
::
»addœ
(
¡d
::
¡ršg
 &
Çme
, std::
veùÜ
<¡d::¡ršg> &
li¡šg
) {

444 
Di¥©chHªdËrSynchrÚiz”
 
syncHªdËr
;

445 
Ev’tPŒ
 
	gev’tPŒ
;

446 
CommBufPŒ
 
cbufPŒ
Ğ
m_´ÙocŞ
.
ü—‹_»addœ_»que¡
(
Çme
) );

447 
	g”rÜ
 = 
£nd_mes§ge
(
cbufPŒ
, &
syncHªdËr
);

448 ià(
	g”rÜ
 =ğ
E¼Ü
::
OK
) {

449 ià(!
syncHªdËr
.
wa™_fÜ_»¶y
(
ev’tPŒ
)) {

450 
HT_ERRORF
("Df '»addœ'ƒ¼Ü,‚ame=% : %s", 
Çme
.
c_¡r
(), 
m_´ÙocŞ
.
¡ršg_fÜm©_mes§ge
(
ev’tPŒ
).c_str());

452 
	g”rÜ
 = 
decode_»¥Ú£_»addœ
(
ev’tPŒ
, 
li¡šg
);

454  
	g”rÜ
;

459 
	gCl›Á
::
	$£nd_mes§ge
(
CommBufPŒ
 &
cbufPŒ
, 
Di¥©chHªdËr
 *
hªdËr
) {

460 
”rÜ
;

462 ià((
”rÜ
 = 
m_comm
->
	`£nd_»que¡
(
m_addr
, 
m_timeout
, 
cbufPŒ
, 
hªdËr
)è!ğ
E¼Ü
::
OK
) {

463 
	`HT_WARNF
("Comm::send_requesto %s:%d failed - %s",

464 
	`š‘_Áß
(
m_addr
.
sš_addr
), 
	`Áohs
(m_addr.
sš_pÜt
), 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

466  
”rÜ
;

467 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/Client.h

21 #iâdeà
HYPERTABLE_DFSBROKER_CLIENT_H


22 
	#HYPERTABLE_DFSBROKER_CLIENT_H


	)

24 
	~<ext/hash_m­
>

26 
	~<boo¡/th»ad/mu‹x.hµ
>

28 
	~"CommÚ/Prİ”t›s.h
"

29 
	~"AsyncComm/Di¥©chHªdËrSynchrÚiz”.h
"

30 
	~"AsyncComm/CÚÃùiÚMªag”.h
"

32 
	~"Hy³¹abË/Lib/Fesy¡em.h
"

34 
	~"Cl›ÁBufã»dR—d”HªdËr.h
"

39 
Çme¥aû
 
	gHy³¹abË
 {

40 
şass
 
	gDi¥©chHªdËr
;

41 
şass
 
	gComm
;

42 
şass
 
	gCommBuf
;

43 
şass
 
	gMes§geBud”Sim¶e
;

45 
Çme¥aû
 
	gboo¡
 {

46 
şass
 
	gth»ad
;

49 
	~"PrÙocŞ.h
"

51 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

53 
Çme¥aû
 
	gHy³¹abË
 {

55 
Çme¥aû
 
	gDfsBrok”
 {

63 şas 
	cCl›Á
 : 
public
 
Fesy¡em
 {

64 
public
:

66 
vœtu®
 ~
Cl›Á
() { ; }

76 
Cl›Á
(
CÚÃùiÚMªag”PŒ
 &
cÚn_mªag”_±r
, 
sockaddr_š
 &
addr
, 
time_t
 
timeout
);

89 
Cl›Á
(
CÚÃùiÚMªag”PŒ
 &
cÚn_mªag”_±r
, 
Prİ”t›sPŒ
 &
´İs_±r
);

97 
Cl›Á
(
Comm
 *
comm
, 
sockaddr_š
 &
addr
, 
time_t
 
timeout
);

105 
boŞ
 
wa™_fÜ_cÚÃùiÚ
(
max_wa™_£cs
) {

106 ià(
	gm_cÚn_mªag”_±r
)

107  
	gm_cÚn_mªag”_±r
->
wa™_fÜ_cÚÃùiÚ
(
m_addr
, 
max_wa™_£cs
);

108  
	gŒue
;

111 
vœtu®
 
İ’
(
¡d
::
¡ršg
 &
Çme
, 
Di¥©chHªdËr
 *
hªdËr
);

112 
vœtu®
 
İ’
(
¡d
::
¡ršg
 &
Çme
, 
št32_t
 *
fdp
);

113 
vœtu®
 
İ’_bufã»d
(
¡d
::
¡ršg
 &
Çme
, 
ušt32_t
 
buf_size
, ušt32_ˆ
out¡ªdšg
, 
št32_t
 *
fdp
, 
ušt64_t
 
¡¬t_off£t
=0, ušt64_ˆ
’d_off£t
=0);

115 
vœtu®
 
ü—‹
(
¡d
::
¡ršg
 &
Çme
, 
boŞ
 
ov”wr™e
, 
št32_t
 
bufãrSize
,

116 
št32_t
 
»¶iÿtiÚ
, 
št64_t
 
blockSize
, 
Di¥©chHªdËr
 *
hªdËr
);

117 
vœtu®
 
ü—‹
(
¡d
::
¡ršg
 &
Çme
, 
boŞ
 
ov”wr™e
, 
št32_t
 
bufãrSize
,

118 
št32_t
 
»¶iÿtiÚ
, 
št64_t
 
blockSize
, iÁ32_ˆ*
fdp
);

120 
vœtu®
 
şo£
(
št32_t
 
fd
, 
Di¥©chHªdËr
 *
hªdËr
);

121 
vœtu®
 
şo£
(
št32_t
 
fd
);

123 
vœtu®
 
»ad
(
št32_t
 
fd
, 
ušt32_t
 
amouÁ
, 
Di¥©chHªdËr
 *
hªdËr
);

124 
vœtu®
 
»ad
(
št32_t
 
fd
, 
ušt32_t
 
amouÁ
, 
ušt8_t
 *
d¡
, ušt32_ˆ*
Ä—dp
);

126 
vœtu®
 
­³nd
(
št32_t
 
fd
, cÚ¡ *
buf
, 
ušt32_t
 
amouÁ
, 
Di¥©chHªdËr
 *
hªdËr
);

127 
vœtu®
 
­³nd
(
št32_t
 
fd
, cÚ¡ *
buf
, 
ušt32_t
 
amouÁ
);

129 
vœtu®
 
£ek
(
št32_t
 
fd
, 
ušt64_t
 
off£t
, 
Di¥©chHªdËr
 *
hªdËr
);

130 
vœtu®
 
£ek
(
št32_t
 
fd
, 
ušt64_t
 
off£t
);

132 
vœtu®
 
»move
(
¡d
::
¡ršg
 &
Çme
, 
Di¥©chHªdËr
 *
hªdËr
);

133 
vœtu®
 
»move
(
¡d
::
¡ršg
 &
Çme
);

135 
vœtu®
 
Ëngth
(
¡d
::
¡ršg
 &
Çme
, 
Di¥©chHªdËr
 *
hªdËr
);

136 
vœtu®
 
Ëngth
(
¡d
::
¡ršg
 &
Çme
, 
št64_t
 *
ËÅ
);

138 
vœtu®
 
´—d
(
št32_t
 
fd
, 
ušt64_t
 
off£t
, 
ušt32_t
 
amouÁ
, 
Di¥©chHªdËr
 *
hªdËr
);

139 
vœtu®
 
´—d
(
št32_t
 
fd
, 
ušt64_t
 
off£t
, 
ušt32_t
 
amouÁ
, 
ušt8_t
 *
d¡
, ušt32_ˆ*
Ä—dp
);

141 
vœtu®
 
mkdœs
(
¡d
::
¡ršg
 &
Çme
, 
Di¥©chHªdËr
 *
hªdËr
);

142 
vœtu®
 
mkdœs
(
¡d
::
¡ršg
 &
Çme
);

144 
vœtu®
 
æush
(
št32_t
 
fd
, 
Di¥©chHªdËr
 *
hªdËr
);

145 
vœtu®
 
æush
(
št32_t
 
fd
);

147 
vœtu®
 
rmdœ
(
¡d
::
¡ršg
 &
Çme
, 
Di¥©chHªdËr
 *
hªdËr
);

148 
vœtu®
 
rmdœ
(
¡d
::
¡ršg
 &
Çme
);

150 
vœtu®
 
»addœ
(
¡d
::
¡ršg
 &
Çme
, 
Di¥©chHªdËr
 *
hªdËr
);

151 
vœtu®
 
»addœ
(
¡d
::
¡ršg
 &
Çme
, std::
veùÜ
<¡d::¡ršg> &
li¡šg
);

158 
¡©us
();

170 
shutdown
(
ušt16_t
 
æags
, 
Di¥©chHªdËr
 *
hªdËr
);

172 
PrÙocŞ
 *
g‘_´ÙocŞ_objeù
(è{  &
	gm_´ÙocŞ
; }

178 
time_t
 
g‘_timeout
(è{  
	gm_timeout
; }

180 
	g´iv©e
:

188 
£nd_mes§ge
(
CommBufPŒ
 &
cbufPŒ
, 
Di¥©chHªdËr
 *
hªdËr
);

190 
	g__gnu_cxx
::
	thash_m­
<
	tušt32_t
, 
	tCl›ÁBufã»dR—d”HªdËr
 *> 
	tBufã»dR—d”M­T
;

192 
	gboo¡
::
mu‹x
 
m_mu‹x
;

193 
Comm
 *
	gm_comm
;

194 
CÚÃùiÚMªag”PŒ
 
	gm_cÚn_mªag”_±r
;

195 
sockaddr_š
 
	gm_addr
;

196 
time_t
 
	gm_timeout
;

197 
Mes§geBud”Sim¶e
 *
	gm_mes§ge_bud”
;

198 
PrÙocŞ
 
	gm_´ÙocŞ
;

199 
Bufã»dR—d”M­T
 
	gm_bufã»d_»ad”_m­
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/ClientBufferedReaderHandler.cc

21 
	~<ÿs£¹
>

23 
	~"CommÚ/E¼Ü.h
"

25 
	~"Cl›ÁBufã»dR—d”HªdËr.h
"

26 
	~"Cl›Á.h
"

28 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

33 
	gCl›ÁBufã»dR—d”HªdËr
::
Cl›ÁBufã»dR—d”HªdËr
(
DfsBrok”
::
Cl›Á
 *
ş›Á
, 
ušt32_t
 
fd
, ušt32_ˆ
buf_size
, ušt32_ˆ
out¡ªdšg
, 
ušt64_t
 
¡¬t_off£t
, ušt64_ˆ
’d_off£t
è: 
m_ş›Á
(ş›Á), 
m_fd
(fd), 
m_»ad_size
(buf_size), 
m_eof
(
çl£
), 
m_”rÜ
(
E¼Ü
::
OK
) {

35 
m_max_out¡ªdšg
 = 
out¡ªdšg
;

37 
	gm_’d_off£t
 = 
’d_off£t
;

38 
	gm_out¡ªdšg_off£t
 = 
¡¬t_off£t
;

39 
	gm_aùu®_off£t
 = 
¡¬t_off£t
;

44 ià(
	g¡¬t_off£t
 > 0) {

45 ià((
	gm_”rÜ
 = 
m_ş›Á
->
£ek
(
m_fd
, 
¡¬t_off£t
)è!ğ
E¼Ü
::
OK
) {

47 
HT_ERRORF
("ProbËm s“kšgØpos™iÚ '%Îd' iÀfe", 
¡¬t_off£t
);

48 
	gm_eof
 = 
Œue
;

54 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

55 
ušt32_t
 
	gtÜ—d
;

57 
	gm_out¡ªdšg
=0; m_out¡ªdšg<
	gm_max_out¡ªdšg
; m_outstanding++) {

58 ià(
	gm_’d_off£t
 && (m_’d_off£t-
	gm_out¡ªdšg_off£t
è< 
	gm_»ad_size
) {

59 ià((
	gtÜ—d
 = (
ušt32_t
)(
m_’d_off£t
 - 
m_out¡ªdšg_off£t
)) == 0)

63 
	gtÜ—d
 = 
m_»ad_size
;

64 ià((
	gm_”rÜ
 = 
m_ş›Á
->
»ad
(
m_fd
, 
tÜ—d
, 
this
)è!ğ
E¼Ü
::
OK
) {

65 
m_eof
 = 
Œue
;

68 
	gm_out¡ªdšg_off£t
 -ğ
tÜ—d
;

70 
	gm_±r
 = 
m_’d_±r
 = 0;

76 
	gCl›ÁBufã»dR—d”HªdËr
::~
	$Cl›ÁBufã»dR—d”HªdËr
() {

77 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

78 
m_eof
 = 
Œue
;

79 
m_out¡ªdšg
 > 0)

80 
m_cÚd
.
	`wa™
(
lock
);

81 
	}
}

88 
	gCl›ÁBufã»dR—d”HªdËr
::
	$hªdË
(
Ev’tPŒ
 &
ev’tPŒ
) {

89 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

91 
m_out¡ªdšg
--;

93 ià(
ev’tPŒ
->
ty³
 =ğ
Ev’t
::
MESSAGE
) {

94 ià((
m_”rÜ
 = ()
PrÙocŞ
::
	`»¥Ú£_code
(
ev’tPŒ
)è!ğ
E¼Ü
::
OK
) {

95 
	`HT_ERRORF
("DfsBroker 'read'ƒrror (amount=%d, fd=%d) : %s",

96 
m_»ad_size
, 
m_fd
, 
PrÙocŞ
::
	`¡ršg_fÜm©_mes§ge
(
ev’tPŒ
).
	`c_¡r
());

97 
m_eof
 = 
Œue
;

100 
m_queue
.
	`push
(
ev’tPŒ
);

103 
ušt64_t
 
off£t
;

104 
ušt32_t
 
amouÁ
;

105 
Fesy¡em
::
	`decode_»¥Ú£_»ad_h—d”
(
ev’tPŒ
, &
off£t
, &
amouÁ
, 0);

106 
m_aùu®_off£t
 +ğ
amouÁ
;

107 ià(
amouÁ
 < 
m_»ad_size
) {

109 
m_eof
 = 
Œue
;

113 ià(
ev’tPŒ
->
ty³
 =ğ
Ev’t
::
ERROR
) {

114 
	`HT_ERRORF
("%s", 
ev’tPŒ
->
	`toSŒšg
().
	`c_¡r
());

115 
m_”rÜ
 = 
ev’tPŒ
->
”rÜ
;

116 
m_eof
 = 
Œue
;

119 
	`HT_ERRORF
("%s", 
ev’tPŒ
->
	`toSŒšg
().
	`c_¡r
());

120 
	`as£¹
(!"Not supposedo„eceivehisype ofƒvent!");

123 
m_cÚd
.
	`nÙify_®l
();

124 
	}
}

131 
	gCl›ÁBufã»dR—d”HªdËr
::
	$»ad
(
ušt8_t
 *
buf
, 
ušt32_t
 
Ën
, ušt32_ˆ*
Ä—dp
) {

132 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

133 
ušt8_t
 *
±r
 = 
buf
;

134 
ušt32_t
 
Æeá
 = 
Ën
;

135 
ušt32_t
 
avaabË
;

137 
Œue
) {

139 
m_queue
.
	`em±y
(è&& !
m_eof
)

140 
m_cÚd
.
	`wa™
(
lock
);

142 ià(
m_”rÜ
 !ğ
E¼Ü
::
OK
 || 
m_queue
.
	`em±y
()) {

143 
	`HT_ERRORF
("»tuº 1ƒ¼Ü=%d", 
m_”rÜ
);

144  
m_”rÜ
;

147 ià(
m_±r
 == 0) {

148 
ušt64_t
 
off£t
;

149 
ušt32_t
 
amouÁ
;

150 
Ev’tPŒ
 &
ev’tPŒ
 = 
m_queue
.
	`äÚt
();

151 
Fesy¡em
::
	`decode_»¥Ú£_»ad_h—d”
(
ev’tPŒ
, &
off£t
, &
amouÁ
, &
m_±r
);

152 
m_’d_±r
 = 
m_±r
 + 
amouÁ
;

155 
avaabË
 = 
m_’d_±r
-
m_±r
;

157 ià(
avaabË
 >ğ
Æeá
) {

158 
	`memıy
(
±r
, 
m_±r
, 
Æeá
);

159 *
Ä—dp
 = 
Ën
;

160 
m_±r
 +ğ
Æeá
;

161 ià((
m_’d_±r
-
m_±r
) == 0) {

162 
m_queue
.
	`pİ
();

163 
m_±r
 = 0;

164 
	`»ad_ah—d
();

168 ià(
avaabË
 == 0) {

169 ià(
m_eof
 && 
m_queue
.
	`size
() == 1) {

170 
m_queue
.
	`pİ
();

171 
m_±r
 = 
m_’d_±r
 = 0;

172 *
Ä—dp
 = 
Ën
 - 
Æeá
;

177 
	`memıy
(
±r
, 
m_±r
, 
avaabË
);

178 
±r
 +ğ
avaabË
;

179 
Æeá
 -ğ
avaabË
;

180 
m_queue
.
	`pİ
();

181 
m_±r
 = 0;

182 
	`»ad_ah—d
();

184  
E¼Ü
::
OK
;

185 
	}
}

192 
	gCl›ÁBufã»dR—d”HªdËr
::
	$»ad_ah—d
() {

193 
ušt32_t
 
n
 = 
m_max_out¡ªdšg
 - (
m_out¡ªdšg
 + 
m_queue
.
	`size
());

194 
ušt32_t
 
tÜ—d
;

196 
	`as£¹
(
m_max_out¡ªdšg
 >ğ(
m_out¡ªdšg
 + 
m_queue
.
	`size
()));

198 ià(
m_eof
)

201 
ušt32_t
 
i
=0; i<
n
; i++) {

202 ià(
m_’d_off£t
 && (m_’d_off£t-
m_out¡ªdšg_off£t
è< 
m_»ad_size
) {

203 ià((
tÜ—d
 = (
ušt32_t
)(
m_’d_off£t
 - 
m_out¡ªdšg_off£t
)) == 0)

207 
tÜ—d
 = 
m_»ad_size
;

208 ià((
m_”rÜ
 = 
m_ş›Á
->
	`»ad
(
m_fd
, 
tÜ—d
, 
this
)è!ğ
E¼Ü
::
OK
) {

209 
m_eof
 = 
Œue
;

212 
m_out¡ªdšg
++;

213 
m_out¡ªdšg_off£t
 -ğ
tÜ—d
;

215 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/ClientBufferedReaderHandler.h

20 #iâdeà
HYPERTABLE_CLIENTBUFFEREDREADERHANDLER_H


21 
	#HYPERTABLE_CLIENTBUFFEREDREADERHANDLER_H


	)

23 
	~<queue
>

25 
	~<boo¡/th»ad/cÚd™iÚ.hµ
>

26 
	~<boo¡/th»ad/mu‹x.hµ
>

28 
	~"AsyncComm/Di¥©chHªdËr.h
"

30 
Çme¥aû
 
	gHy³¹abË
 {

32 
Çme¥aû
 
	gDfsBrok”
 {

33 
şass
 
	gCl›Á
;

36 şas 
	cCl›ÁBufã»dR—d”HªdËr
 : 
public
 
Di¥©chHªdËr
 {

38 
public
:

39 
Cl›ÁBufã»dR—d”HªdËr
(
DfsBrok”
::
Cl›Á
 *
ş›Á
, 
ušt32_t
 
fd
, ušt32_ˆ
buf_size
, ušt32_ˆ
out¡ªdšg
, 
ušt64_t
 
¡¬t_off£t
, ušt64_ˆ
’d_off£t
);

41 
	gvœtu®
 ~
Cl›ÁBufã»dR—d”HªdËr
();

43 
vœtu®
 
hªdË
(
Ev’tPŒ
 &
ev’tPŒ
);

45 
»ad
(
ušt8_t
 *
buf
, 
ušt32_t
 
Ën
, ušt32_ˆ*
Ä—dp
);

47 
	g´iv©e
:

49 
»ad_ah—d
();

51 
	gboo¡
::
mu‹x
 
m_mu‹x
;

52 
	gboo¡
::
cÚd™iÚ
 
m_cÚd
;

53 
	g¡d
::
queue
<
Ev’tPŒ
> 
m_queue
;

54 
	gDfsBrok”
::
Cl›Á
 *
m_ş›Á
;

55 
ušt32_t
 
	gm_fd
;

56 
ušt32_t
 
	gm_max_out¡ªdšg
;

57 
ušt32_t
 
	gm_»ad_size
;

58 
ušt32_t
 
	gm_out¡ªdšg
;

59 
boŞ
 
	gm_eof
;

60 
	gm_”rÜ
;

61 
ušt8_t
 *
	gm_±r
;

62 
ušt8_t
 *
	gm_’d_±r
;

63 
ušt64_t
 
	gm_’d_off£t
;

64 
ušt64_t
 
	gm_out¡ªdšg_off£t
;

65 
ušt64_t
 
	gm_aùu®_off£t
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/ConnectionHandler.cc

21 
	~"CommÚ/E¼Ü.h
"

22 
	~"CommÚ/Exû±iÚ.h
"

23 
	~"CommÚ/SŒšgExt.h
"

25 
	~"AsyncComm/AµliÿtiÚQueue.h
"

27 
	~"PrÙocŞ.h
"

28 
	~"CÚÃùiÚHªdËr.h
"

29 
	~"Reque¡HªdËrClo£.h
"

30 
	~"Reque¡HªdËrC»©e.h
"

31 
	~"Reque¡HªdËrO³n.h
"

32 
	~"Reque¡HªdËrR—d.h
"

33 
	~"Reque¡HªdËrAµ’d.h
"

34 
	~"Reque¡HªdËrS“k.h
"

35 
	~"Reque¡HªdËrRemove.h
"

36 
	~"Reque¡HªdËrL’gth.h
"

37 
	~"Reque¡HªdËrP»ad.h
"

38 
	~"Reque¡HªdËrMkdœs.h
"

39 
	~"Reque¡HªdËrFlush.h
"

40 
	~"Reque¡HªdËrStus.h
"

41 
	~"Reque¡HªdËrRmdœ.h
"

42 
	~"Reque¡HªdËrR—ddœ.h
"

44 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

45 
usšg
 
Çme¥aû
 
	gHy³¹abË
::
DfsBrok”
;

50 
	gCÚÃùiÚHªdËr
::
	$hªdË
(
Ev’tPŒ
 &
ev’tPŒ
) {

51 
commªd
 = -1;

53 ià(
ev’tPŒ
->
ty³
 =ğ
Ev’t
::
MESSAGE
) {

54 
AµliÿtiÚHªdËr
 *
»que¡HªdËr
 = 0;

58 
Œy
 {

59 ià(
ev’tPŒ
->
mes§geL’
 < (
št16_t
)) {

60 
¡d
::
¡ršg
 
mes§ge
 = "Truncated Request";

61 
throw
 
Ãw
 
	`PrÙocŞExû±iÚ
(
mes§ge
);

63 
	`memıy
(&
commªd
, 
ev’tPŒ
->
mes§ge
, (
št16_t
));

66 ià(
commªd
 < 0 || commªd >ğ
PrÙocŞ
::
COMMAND_MAX
) {

67 
¡d
::
¡ršg
 
mes§ge
 = (¡d::¡ršg)"Inv®id commªd (" + 
commªd
 + ")";

68 
throw
 
	`PrÙocŞExû±iÚ
(
mes§ge
);

71 
commªd
) {

72 
PrÙocŞ
::
COMMAND_OPEN
:

73 
»que¡HªdËr
 = 
Ãw
 
	`Reque¡HªdËrO³n
(
m_comm
, 
m_brok”_±r
.
	`g‘
(), 
ev’tPŒ
);

75 
PrÙocŞ
::
COMMAND_CREATE
:

76 
»que¡HªdËr
 = 
Ãw
 
	`Reque¡HªdËrC»©e
(
m_comm
, 
m_brok”_±r
.
	`g‘
(), 
ev’tPŒ
);

78 
PrÙocŞ
::
COMMAND_CLOSE
:

79 
»que¡HªdËr
 = 
Ãw
 
	`Reque¡HªdËrClo£
(
m_comm
, 
m_brok”_±r
.
	`g‘
(), 
ev’tPŒ
);

81 
PrÙocŞ
::
COMMAND_READ
:

82 
»que¡HªdËr
 = 
Ãw
 
	`Reque¡HªdËrR—d
(
m_comm
, 
m_brok”_±r
.
	`g‘
(), 
ev’tPŒ
);

84 
PrÙocŞ
::
COMMAND_APPEND
:

85 
»que¡HªdËr
 = 
Ãw
 
	`Reque¡HªdËrAµ’d
(
m_comm
, 
m_brok”_±r
.
	`g‘
(), 
ev’tPŒ
);

87 
PrÙocŞ
::
COMMAND_SEEK
:

88 
»que¡HªdËr
 = 
Ãw
 
	`Reque¡HªdËrS“k
(
m_comm
, 
m_brok”_±r
.
	`g‘
(), 
ev’tPŒ
);

90 
PrÙocŞ
::
COMMAND_REMOVE
:

91 
»que¡HªdËr
 = 
Ãw
 
	`Reque¡HªdËrRemove
(
m_comm
, 
m_brok”_±r
.
	`g‘
(), 
ev’tPŒ
);

93 
PrÙocŞ
::
COMMAND_LENGTH
:

94 
»que¡HªdËr
 = 
Ãw
 
	`Reque¡HªdËrL’gth
(
m_comm
, 
m_brok”_±r
.
	`g‘
(), 
ev’tPŒ
);

96 
PrÙocŞ
::
COMMAND_PREAD
:

97 
»que¡HªdËr
 = 
Ãw
 
	`Reque¡HªdËrP»ad
(
m_comm
, 
m_brok”_±r
.
	`g‘
(), 
ev’tPŒ
);

99 
PrÙocŞ
::
COMMAND_MKDIRS
:

100 
»que¡HªdËr
 = 
Ãw
 
	`Reque¡HªdËrMkdœs
(
m_comm
, 
m_brok”_±r
.
	`g‘
(), 
ev’tPŒ
);

102 
PrÙocŞ
::
COMMAND_FLUSH
:

103 
»que¡HªdËr
 = 
Ãw
 
	`Reque¡HªdËrFlush
(
m_comm
, 
m_brok”_±r
.
	`g‘
(), 
ev’tPŒ
);

105 
PrÙocŞ
::
COMMAND_RMDIR
:

106 
»que¡HªdËr
 = 
Ãw
 
	`Reque¡HªdËrRmdœ
(
m_comm
, 
m_brok”_±r
.
	`g‘
(), 
ev’tPŒ
);

108 
PrÙocŞ
::
COMMAND_READDIR
:

109 
»que¡HªdËr
 = 
Ãw
 
	`Reque¡HªdËrR—ddœ
(
m_comm
, 
m_brok”_±r
.
	`g‘
(), 
ev’tPŒ
);

111 
PrÙocŞ
::
COMMAND_STATUS
:

112 
»que¡HªdËr
 = 
Ãw
 
	`Reque¡HªdËrStus
(
m_comm
, 
m_brok”_±r
.
	`g‘
(), 
ev’tPŒ
);

114 
PrÙocŞ
::
COMMAND_SHUTDOWN
:

116 
ušt16_t
 
æags
 = 0;

117 
Re¥Ú£C®lback
 
	`cb
(
m_comm
, 
ev’tPŒ
);

118 ià(
ev’tPŒ
->
mes§geL’
 >= 4)

119 
	`memıy
(&
æags
, &
ev’tPŒ
->
mes§ge
[2], 2);

120 ià((
æags
 & 
PrÙocŞ
::
SHUTDOWN_FLAG_IMMEDIATE
) != 0)

121 
m_­p_queue_±r
->
	`shutdown
();

122 
m_brok”_±r
->
	`shutdown
(&
cb
);

123 
	`ex™
(0);

127 
¡d
::
¡ršg
 
mes§ge
 = (¡ršg)"Commªd cod" + 
commªd
 + "‚ot implemented";

128 
throw
 
	`PrÙocŞExû±iÚ
(
mes§ge
);

130 
m_­p_queue_±r
->
	`add
Ğ
»que¡HªdËr
 );

132 
	`ÿtch
 (
PrÙocŞExû±iÚ
 &
e
) {

133 
Re¥Ú£C®lback
 
	`cb
(
m_comm
, 
ev’tPŒ
);

134 
¡d
::
¡ršg
 
”rMsg
 = 
e
.
	`wh©
();

135 
	`HT_ERRORF
("PrÙocŞƒ¼Ü '%s'", 
e
.
	`wh©
());

136 
cb
.
	`”rÜ
(
E¼Ü
::
PROTOCOL_ERROR
, 
”rMsg
);

139 ià(
ev’tPŒ
->
ty³
 =ğ
Ev’t
::
DISCONNECT
) {

140 
	`HT_INFOF
("% : Closšg‡Î o³ÀhªdË äom %s:%d", 
ev’tPŒ
->
	`toSŒšg
().
	`c_¡r
(),

141 
	`š‘_Áß
(
ev’tPŒ
->
addr
.
sš_addr
), 
	`Áohs
Óv’tPŒ->addr.
sš_pÜt
));

142 
O³nFeM­
 &
ofM­
 = 
m_brok”_±r
->
	`g‘_İ’_fe_m­
();

143 
ofM­
.
	`»move_®l
(
ev’tPŒ
->
addr
);

146 
	`HT_INFOF
("%s", 
ev’tPŒ
->
	`toSŒšg
().
	`c_¡r
());

149 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/ConnectionHandler.h

21 #iâdeà
HYPERTABLE_CONNECTIONHANDLER_H


22 
	#HYPERTABLE_CONNECTIONHANDLER_H


	)

24 
	~"AsyncComm/AµliÿtiÚQueue.h
"

25 
	~"AsyncComm/Di¥©chHªdËr.h
"

27 
	~"Brok”.h
"

29 
Çme¥aû
 
	gHy³¹abË
 {

31 
Çme¥aû
 
	gDfsBrok”
 {

35 şas 
	cCÚÃùiÚHªdËr
 : 
public
 
Di¥©chHªdËr
 {

36 
public
:

37 
CÚÃùiÚHªdËr
(
Comm
 *
comm
, 
AµliÿtiÚQueuePŒ
 &
­pQueuePŒ
, 
Brok”PŒ
 &
brok”PŒ
è: 
m_comm
(comm), 
m_­p_queue_±r
×µQueuePŒ), 
m_brok”_±r
(brokerPtr) { ; }

38 
vœtu®
 
hªdË
(
Ev’tPŒ
 &
ev’tPŒ
);

40 
	g´iv©e
:

41 
Comm
 *
m_comm
;

42 
AµliÿtiÚQueuePŒ
 
	gm_­p_queue_±r
;

43 
Brok”PŒ
 
	gm_brok”_±r
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/ConnectionHandlerFactory.h

21 #iâdeà
HYPERTABLE_DFSBROKER_CONNECTIONHANDLERFACTORY_H


22 
	#HYPERTABLE_DFSBROKER_CONNECTIONHANDLERFACTORY_H


	)

24 
	~"AsyncComm/AµliÿtiÚQueue.h
"

25 
	~"AsyncComm/CÚÃùiÚHªdËrFaùÜy.h
"

26 
	~"AsyncComm/Di¥©chHªdËr.h
"

28 
	~"CÚÃùiÚHªdËr.h
"

29 
	~"Brok”.h
"

31 
Çme¥aû
 
	gHy³¹abË
 {

33 
şass
 
	gComm
;

35 
Çme¥aû
 
	gDfsBrok”
 {

44 şas 
	cCÚÃùiÚHªdËrFaùÜy
 : 
public
 
Hy³¹abË
::
CÚÃùiÚHªdËrFaùÜy
 {

45 
public
:

54 
CÚÃùiÚHªdËrFaùÜy
(
Comm
 *
comm
, 
AµliÿtiÚQueuePŒ
 &
­pQueuePŒ
, 
Brok”PŒ
 &
brok”PŒ
è: 
m_comm
(comm), 
m_­p_queue_±r
×µQueuePŒ), 
m_brok”_±r
(brokerPtr) { ; }

59 
vœtu®
 
g‘_š¡ªû
(
Di¥©chHªdËrPŒ
 &
dhp
) {

60 
	gdhp
 = 
Ãw
 
CÚÃùiÚHªdËr
(
m_comm
, 
m_­p_queue_±r
, 
m_brok”_±r
);

63 
	g´iv©e
:

64 
Comm
 *
m_comm
;

65 
AµliÿtiÚQueuePŒ
 
	gm_­p_queue_±r
;

66 
Brok”PŒ
 
	gm_brok”_±r
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/OpenFileMap.h

21 
	~<ext/hash_m­
>

23 
	~<boo¡/šŒusive_±r.hµ
>

24 
	~<boo¡/th»ad/mu‹x.hµ
>

27 
	~<¡dšt.h
>

28 
	~<Ãtš‘/š.h
>

31 
	~"CommÚ/Logg”.h
"

32 
	~"CommÚ/Reã»nûCouÁ.h
"

35 
Çme¥aû
 
Hy³¹abË
 {

40 şas 
	cO³nFeD©a
 : 
public
 
Reã»nûCouÁ
 {

41 
public
:

42 
vœtu®
 ~
O³nFeD©a
() { ; }

43 
sockaddr_š
 
addr
;

45 
boo¡
::
	tšŒusive_±r
<
	tO³nFeD©a
> 
	tO³nFeD©aPŒ
;

48 şas 
	cO³nFeM­
 {

50 
public
:

52 
ü—‹
(
fd
, 
sockaddr_š
 &
addr
, 
O³nFeD©aPŒ
 &
d©aPŒ
) {

53 
boo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

54 
d©aPŒ
->
addr
 =‡ddr;

55 
m_fe_m­
[
fd
] = 
d©aPŒ
;

58 
boŞ
 
g‘
(
fd
, 
O³nFeD©aPŒ
 &
d©aPŒ
) {

59 
boo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

60 
O³nFeM­T
::
™”©Ü
 
™”
 = 
m_fe_m­
.
fšd
(
fd
);

61 ià(
™”
 !ğ
m_fe_m­
.
’d
()) {

62 
d©aPŒ
 = (*
™”
).
£cÚd
;

63  
Œue
;

65  
çl£
;

68 
boŞ
 
»move
(
fd
, 
O³nFeD©aPŒ
 &
d©aPŒ
) {

69 
boo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

70 
O³nFeM­T
::
™”©Ü
 
™”
 = 
m_fe_m­
.
fšd
(
fd
);

71 ià(
™”
 !ğ
m_fe_m­
.
’d
()) {

72 
d©aPŒ
 = (*
™”
).
£cÚd
;

73 
m_fe_m­
.
”a£
(
™”
);

74  
Œue
;

76  
çl£
;

79 
»move
(
fd
) {

80 
boo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

81 
O³nFeM­T
::
™”©Ü
 
™”
 = 
m_fe_m­
.
fšd
(
fd
);

82 ià(
™”
 !ğ
m_fe_m­
.
’d
())

83 
m_fe_m­
.
”a£
(
™”
);

86 
»move_®l
(
sockaddr_š
 &
addr
) {

87 
boo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

88 
O³nFeM­T
::
™”©Ü
 
™”
 = 
m_fe_m­
.
begš
();

90 
™”
 !ğ
m_fe_m­
.
’d
()) {

91 ià((*
™”
).
£cÚd
->
addr
.
sš_çmy
 ==‡ddr.sin_family &&

92 (*
™”
).
£cÚd
->
addr
.
sš_pÜt
 ==‡ddr.sin_port &&

93 (*
™”
).
£cÚd
->
addr
.
sš_addr
.
s_addr
 ==‡ddr.sin_addr.s_addr) {

94 
O³nFeM­T
::
™”©Ü
 
d–I‹r
 = 
™”
;

95 
HT_ERRORF
("Removšg hªdË %d from o³Àfm­ beÿu£ oàlo¡ ownšg cl›Á cÚÃùiÚ", (*
™”
).
fœ¡
);

96 
™”
++;

97 
m_fe_m­
.
”a£
(
d–I‹r
);

100 
™”
++;

104 
»move_®l
() {

105 
boo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

106 
m_fe_m­
.
ş—r
();

109 
´iv©e
:

111 
__gnu_cxx
::
	thash_m­
<, 
	tO³nFeD©aPŒ
> 
	tO³nFeM­T
;

113 
boo¡
::
mu‹x
 
m_mu‹x
;

114 
O³nFeM­T
 
m_fe_m­
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/Protocol.cc

21 
	~<ÿs£¹
>

22 
	~<io¡»am
>

24 
	~"AsyncComm/H—d”Bud”.h
"

25 
	~"AsyncComm/S”Ÿliz©iÚ.h
"

27 
	~"PrÙocŞ.h
"

29 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

30 
usšg
 
Çme¥aû
 
	gHy³¹abË
::
DfsBrok”
;

31 
usšg
 
Çme¥aû
 
	g¡d
;

34 
Çme¥aû
 
	gHy³¹abË
 {

36 
Çme¥aû
 
	gDfsBrok”
 {

38 cÚ¡ *
	gPrÙocŞ
::
ms_commªd_¡ršgs
[
COMMAND_MAX
] = {

60 
CommBuf
 *
	gPrÙocŞ
::
ü—‹_İ’_»que¡
(
¡d
::
¡ršg
 &
âame
, 
ušt32_t
 
bufãrSize
) {

61 
H—d”Bud”
 
hbud”
(
H—d”
::
PROTOCOL_DFSBROKER
);

62 
CommBuf
 *
	gcbuf
 = 
Ãw
 CommBuf(
hbud”
, 6 + 
S”Ÿliz©iÚ
::
’coded_Ëngth_¡ršg
(
âame
));

63 
	gcbuf
->
­³nd_shÜt
(
COMMAND_OPEN
);

64 
	gcbuf
->
­³nd_št
(
bufãrSize
);

65 
	gcbuf
->
­³nd_¡ršg
(
âame
);

66  
	gcbuf
;

72 
CommBuf
 *
	gPrÙocŞ
::
ü—‹_ü—‹_»que¡
(
¡d
::
¡ršg
 &
âame
, 
boŞ
 
ov”wr™e
, 
št32_t
 
bufãrSize
,

73 
št32_t
 
»¶iÿtiÚ
, 
št64_t
 
blockSize
) {

74 
H—d”Bud”
 
hbud”
(
H—d”
::
PROTOCOL_DFSBROKER
);

75 
CommBuf
 *
	gcbuf
 = 
Ãw
 CommBuf(
hbud”
, 20 + 
S”Ÿliz©iÚ
::
’coded_Ëngth_¡ršg
(
âame
));

76 
	gcbuf
->
­³nd_shÜt
(
COMMAND_CREATE
);

77 
	gcbuf
->
­³nd_shÜt
Ğ(
ov”wr™e
) ? 1 : 0 );

78 
	gcbuf
->
­³nd_št
(
»¶iÿtiÚ
);

79 
	gcbuf
->
­³nd_št
(
bufãrSize
);

80 
	gcbuf
->
­³nd_lÚg
(
blockSize
);

81 
	gcbuf
->
­³nd_¡ršg
(
âame
);

82  
	gcbuf
;

88 
CommBuf
 *
	gPrÙocŞ
::
ü—‹_şo£_»que¡
(
št32_t
 
fd
) {

89 
H—d”Bud”
 
hbud”
(
H—d”
::
PROTOCOL_DFSBROKER
, 
fd
);

90 
CommBuf
 *
	gcbuf
 = 
Ãw
 CommBuf(
hbud”
, 6);

91 
	gcbuf
->
­³nd_shÜt
(
COMMAND_CLOSE
);

92 
	gcbuf
->
­³nd_št
(
fd
);

93  
	gcbuf
;

98 
CommBuf
 *
	gPrÙocŞ
::
ü—‹_»ad_»que¡
(
št32_t
 
fd
, 
ušt32_t
 
amouÁ
) {

99 
H—d”Bud”
 
hbud”
(
H—d”
::
PROTOCOL_DFSBROKER
, 
fd
);

100 
CommBuf
 *
	gcbuf
 = 
Ãw
 CommBuf(
hbud”
, 10);

101 
	gcbuf
->
­³nd_shÜt
(
COMMAND_READ
);

102 
	gcbuf
->
­³nd_št
(
fd
);

103 
	gcbuf
->
­³nd_št
(
amouÁ
);

104  
	gcbuf
;

108 
CommBuf
 *
	gPrÙocŞ
::
ü—‹_­³nd_»que¡
(
št32_t
 
fd
, cÚ¡ *
buf
, 
ušt32_t
 
amouÁ
) {

109 
H—d”Bud”
 
hbud”
(
H—d”
::
PROTOCOL_DFSBROKER
, 
fd
);

110 
CommBuf
 *
	gcbuf
 = 
Ãw
 CommBuf(
hbud”
, 10, 
buf
, 
amouÁ
);

111 
	gcbuf
->
­³nd_shÜt
(
COMMAND_APPEND
);

112 
	gcbuf
->
­³nd_št
(
fd
);

113 
	gcbuf
->
­³nd_št
(
amouÁ
);

114  
	gcbuf
;

118 
CommBuf
 *
	gPrÙocŞ
::
ü—‹_£ek_»que¡
(
št32_t
 
fd
, 
ušt64_t
 
off£t
) {

119 
H—d”Bud”
 
hbud”
(
H—d”
::
PROTOCOL_DFSBROKER
, 
fd
);

120 
CommBuf
 *
	gcbuf
 = 
Ãw
 CommBuf(
hbud”
, 14);

121 
	gcbuf
->
­³nd_shÜt
(
COMMAND_SEEK
);

122 
	gcbuf
->
­³nd_št
(
fd
);

123 
	gcbuf
->
­³nd_lÚg
(
off£t
);

124  
	gcbuf
;

129 
CommBuf
 *
	gPrÙocŞ
::
ü—‹_»move_»que¡
(
¡d
::
¡ršg
 &
âame
) {

130 
H—d”Bud”
 
hbud”
(
H—d”
::
PROTOCOL_DFSBROKER
);

131 
CommBuf
 *
	gcbuf
 = 
Ãw
 CommBuf(
hbud”
, 2 + 
S”Ÿliz©iÚ
::
’coded_Ëngth_¡ršg
(
âame
));

132 
	gcbuf
->
­³nd_shÜt
(
COMMAND_REMOVE
);

133 
	gcbuf
->
­³nd_¡ršg
(
âame
);

134  
	gcbuf
;

140 
CommBuf
 *
	gPrÙocŞ
::
ü—‹_Ëngth_»que¡
(
¡d
::
¡ršg
 &
âame
) {

141 
H—d”Bud”
 
hbud”
(
H—d”
::
PROTOCOL_DFSBROKER
);

142 
CommBuf
 *
	gcbuf
 = 
Ãw
 CommBuf(
hbud”
, 2 + 
S”Ÿliz©iÚ
::
’coded_Ëngth_¡ršg
(
âame
));

143 
	gcbuf
->
­³nd_shÜt
(
COMMAND_LENGTH
);

144 
	gcbuf
->
­³nd_¡ršg
(
âame
);

145  
	gcbuf
;

151 
CommBuf
 *
	gPrÙocŞ
::
ü—‹_pos™iÚ_»ad_»que¡
(
št32_t
 
fd
, 
ušt64_t
 
off£t
, 
ušt32_t
 
amouÁ
) {

152 
H—d”Bud”
 
hbud”
(
H—d”
::
PROTOCOL_DFSBROKER
, 
fd
);

153 
CommBuf
 *
	gcbuf
 = 
Ãw
 CommBuf(
hbud”
, 18);

154 
	gcbuf
->
­³nd_shÜt
(
COMMAND_PREAD
);

155 
	gcbuf
->
­³nd_št
(
fd
);

156 
	gcbuf
->
­³nd_lÚg
(
off£t
);

157 
	gcbuf
->
­³nd_št
(
amouÁ
);

158  
	gcbuf
;

163 
CommBuf
 *
	gPrÙocŞ
::
ü—‹_mkdœs_»que¡
(
¡d
::
¡ršg
 &
âame
) {

164 
H—d”Bud”
 
hbud”
(
H—d”
::
PROTOCOL_DFSBROKER
);

165 
CommBuf
 *
	gcbuf
 = 
Ãw
 CommBuf(
hbud”
, 2 + 
S”Ÿliz©iÚ
::
’coded_Ëngth_¡ršg
(
âame
));

166 
	gcbuf
->
­³nd_shÜt
(
COMMAND_MKDIRS
);

167 
	gcbuf
->
­³nd_¡ršg
(
âame
);

168  
	gcbuf
;

173 
CommBuf
 *
	gPrÙocŞ
::
ü—‹_æush_»que¡
(
št32_t
 
fd
) {

174 
H—d”Bud”
 
hbud”
(
H—d”
::
PROTOCOL_DFSBROKER
, 
fd
);

175 
CommBuf
 *
	gcbuf
 = 
Ãw
 CommBuf(
hbud”
, 6);

176 
	gcbuf
->
­³nd_shÜt
(
COMMAND_FLUSH
);

177 
	gcbuf
->
­³nd_št
(
fd
);

178  
	gcbuf
;

183 
CommBuf
 *
	gPrÙocŞ
::
ü—‹_rmdœ_»que¡
(
¡d
::
¡ršg
 &
âame
) {

184 
H—d”Bud”
 
hbud”
(
H—d”
::
PROTOCOL_DFSBROKER
);

185 
CommBuf
 *
	gcbuf
 = 
Ãw
 CommBuf(
hbud”
, 2 + 
S”Ÿliz©iÚ
::
’coded_Ëngth_¡ršg
(
âame
));

186 
	gcbuf
->
­³nd_shÜt
(
COMMAND_RMDIR
);

187 
	gcbuf
->
­³nd_¡ršg
(
âame
);

188  
	gcbuf
;

193 
CommBuf
 *
	gPrÙocŞ
::
ü—‹_»addœ_»que¡
(
¡d
::
¡ršg
 &
âame
) {

194 
H—d”Bud”
 
hbud”
(
H—d”
::
PROTOCOL_DFSBROKER
);

195 
CommBuf
 *
	gcbuf
 = 
Ãw
 CommBuf(
hbud”
, 2 + 
S”Ÿliz©iÚ
::
’coded_Ëngth_¡ršg
(
âame
));

196 
	gcbuf
->
­³nd_shÜt
(
COMMAND_READDIR
);

197 
	gcbuf
->
­³nd_¡ršg
(
âame
);

198  
	gcbuf
;

204 
CommBuf
 *
	gPrÙocŞ
::
ü—‹_shutdown_»que¡
(
ušt16_t
 
æags
) {

205 
H—d”Bud”
 
hbud”
(
H—d”
::
PROTOCOL_DFSBROKER
);

206 
CommBuf
 *
	gcbuf
 = 
Ãw
 CommBuf(
hbud”
, 4);

207 
	gcbuf
->
­³nd_shÜt
(
COMMAND_SHUTDOWN
);

208 
	gcbuf
->
­³nd_shÜt
(
æags
);

209  
	gcbuf
;

216 
CommBuf
 *
	gPrÙocŞ
::
ü—‹_¡©us_»que¡
() {

217 
H—d”Bud”
 
hbud”
(
H—d”
::
PROTOCOL_DFSBROKER
);

218 
CommBuf
 *
	gcbuf
 = 
Ãw
 CommBuf(
hbud”
, 2);

219 
	gcbuf
->
­³nd_shÜt
(
COMMAND_STATUS
);

220  
	gcbuf
;

223 cÚ¡ *
	gPrÙocŞ
::
commªd_‹xt
(
commªd
) {

224 ià(
commªd
 < 0 || commªd >ğ
COMMAND_MAX
)

226  
	gms_commªd_¡ršgs
[
commªd
];

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/Protocol.h

21 #iâdeà
HYPERTABLE_DFSBROKER_PROTOCOL_H


22 
	#HYPERTABLE_DFSBROKER_PROTOCOL_H


	)

24 
	~"AsyncComm/CommBuf.h
"

25 
	~"AsyncComm/Ev’t.h
"

26 
	~"AsyncComm/PrÙocŞ.h
"

29 
	~<¡dšt.h
>

30 
	~<¡ršg.h
>

33 
Çme¥aû
 
Hy³¹abË
 {

35 
Çme¥aû
 
DfsBrok”
 {

37 şas 
	cPrÙocŞ
 : 
public
 
Hy³¹abË
::
PrÙocŞ
 {

39 
public
:

41 
CommBuf
 *
ü—‹_İ’_»que¡
(
¡d
::
¡ršg
 &
âame
, 
ušt32_t
 
bufãrSize
=0);

43 
CommBuf
 *
ü—‹_ü—‹_»que¡
(
¡d
::
¡ršg
 &
âame
, 
boŞ
 
ov”wr™e
, 
št32_t
 
bufãrSize
,

44 
št32_t
 
»¶iÿtiÚ
, 
št64_t
 
blockSize
);

46 
CommBuf
 *
ü—‹_şo£_»que¡
(
št32_t
 
fd
);

48 
CommBuf
 *
ü—‹_»ad_»que¡
(
št32_t
 
fd
, 
ušt32_t
 
amouÁ
);

50 
CommBuf
 *
ü—‹_­³nd_»que¡
(
št32_t
 
fd
, cÚ¡ *
buf
, 
ušt32_t
 
amouÁ
);

52 
CommBuf
 *
ü—‹_£ek_»que¡
(
št32_t
 
fd
, 
ušt64_t
 
off£t
);

54 
CommBuf
 *
ü—‹_»move_»que¡
(
¡d
::
¡ršg
 &
âame
);

56 
CommBuf
 *
ü—‹_Ëngth_»que¡
(
¡d
::
¡ršg
 &
âame
);

58 
CommBuf
 *
ü—‹_pos™iÚ_»ad_»que¡
(
št32_t
 
fd
, 
ušt64_t
 
off£t
, 
ušt32_t
 
amouÁ
);

60 
CommBuf
 *
ü—‹_mkdœs_»que¡
(
¡d
::
¡ršg
 &
âame
);

62 
CommBuf
 *
ü—‹_rmdœ_»que¡
(
¡d
::
¡ršg
 &
âame
);

64 
CommBuf
 *
ü—‹_»addœ_»que¡
(
¡d
::
¡ršg
 &
âame
);

66 
CommBuf
 *
ü—‹_æush_»que¡
(
št32_t
 
fd
);

68 
CommBuf
 *
ü—‹_¡©us_»que¡
();

70 
CommBuf
 *
ü—‹_shutdown_»que¡
(
ušt16_t
 
æags
);

72 
vœtu®
 cÚ¡ *
commªd_‹xt
(
commªd
);

74 cÚ¡ 
ušt16_t
 
COMMAND_OPEN
 = 0;

75 cÚ¡ 
ušt16_t
 
COMMAND_CREATE
 = 1;

76 cÚ¡ 
ušt16_t
 
COMMAND_CLOSE
 = 2;

77 cÚ¡ 
ušt16_t
 
COMMAND_READ
 = 3;

78 cÚ¡ 
ušt16_t
 
COMMAND_APPEND
 = 4;

79 cÚ¡ 
ušt16_t
 
COMMAND_SEEK
 = 5;

80 cÚ¡ 
ušt16_t
 
COMMAND_REMOVE
 = 6;

81 cÚ¡ 
ušt16_t
 
COMMAND_SHUTDOWN
 = 7;

82 cÚ¡ 
ušt16_t
 
COMMAND_LENGTH
 = 8;

83 cÚ¡ 
ušt16_t
 
COMMAND_PREAD
 = 9;

84 cÚ¡ 
ušt16_t
 
COMMAND_MKDIRS
 = 10;

85 cÚ¡ 
ušt16_t
 
COMMAND_STATUS
 = 11;

86 cÚ¡ 
ušt16_t
 
COMMAND_FLUSH
 = 12;

87 cÚ¡ 
ušt16_t
 
COMMAND_RMDIR
 = 13;

88 cÚ¡ 
ušt16_t
 
COMMAND_READDIR
 = 14;

89 cÚ¡ 
ušt16_t
 
COMMAND_MAX
 = 15;

91 cÚ¡ 
ušt16_t
 
SHUTDOWN_FLAG_IMMEDIATE
 = 0x0001;

93 cÚ¡ * 
ms_commªd_¡ršgs
[
COMMAND_MAX
];

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/RequestHandlerAppend.cc

21 
	~"CommÚ/E¼Ü.h
"

22 
	~"CommÚ/Logg”.h
"

24 
	~"AsyncComm/S”Ÿliz©iÚ.h
"

26 
	~"Reque¡HªdËrAµ’d.h
"

27 
	~"Re¥Ú£C®lbackAµ’d.h
"

29 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

30 
usšg
 
Çme¥aû
 
	gHy³¹abË
::
DfsBrok”
;

36 
	gReque¡HªdËrAµ’d
::
	$run
() {

37 
Re¥Ú£C®lbackAµ’d
 
	`cb
(
m_comm
, 
m_ev’t_±r
);

38 
ušt32_t
 
fd
, 
amouÁ
;

39 
size_t
 
»maššg
 = 
m_ev’t_±r
->
mes§geL’
 - 2;

40 
ušt8_t
 *
msgPŒ
 = 
m_ev’t_±r
->
mes§ge
 + 2;

42 ià(
»maššg
 < 8)

43 
abÜt
;

46 
S”Ÿliz©iÚ
::
	`decode_št
(&
msgPŒ
, &
»maššg
, &
fd
);

49 
S”Ÿliz©iÚ
::
	`decode_št
(&
msgPŒ
, &
»maššg
, &
amouÁ
);

51 ià(
»maššg
 < 
amouÁ
)

52 
abÜt
;

54 
m_brok”
->
	`­³nd
(&
cb
, 
fd
, 
amouÁ
, 
msgPŒ
);

58 
abÜt
:

59 
	`HT_ERROR
("Encoding…roblem with APPEND message");

60 
cb
.
	`”rÜ
(
E¼Ü
::
PROTOCOL_ERROR
, "Encoding…roblem with APPEND message");

62 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/RequestHandlerAppend.h

21 #iâdeà
HYPERTABLE_REQUESTHANDLERAPPEND_H


22 
	#HYPERTABLE_REQUESTHANDLERAPPEND_H


	)

24 
	~"CommÚ/RuÂabË.h
"

26 
	~"AsyncComm/AµliÿtiÚHªdËr.h
"

27 
	~"AsyncComm/Comm.h
"

28 
	~"AsyncComm/Ev’t.h
"

30 
	~"Brok”.h
"

32 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

34 
Çme¥aû
 
	gHy³¹abË
 {

36 
Çme¥aû
 
	gDfsBrok”
 {

38 şas 
	cReque¡HªdËrAµ’d
 : 
public
 
AµliÿtiÚHªdËr
 {

39 
public
:

40 
Reque¡HªdËrAµ’d
(
Comm
 *
comm
, 
Brok”
 *
brok”
, 
Ev’tPŒ
 &
ev’tPŒ
è: 
AµliÿtiÚHªdËr
Óv’tPŒ), 
m_comm
(comm), 
m_brok”
(broker) {

44 
vœtu®
 
run
();

46 
	g´iv©e
:

47 
Comm
 *
m_comm
;

48 
Brok”
 *
	gm_brok”
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/RequestHandlerClose.cc

21 
	~"CommÚ/E¼Ü.h
"

22 
	~"CommÚ/Logg”.h
"

24 
	~"AsyncComm/Re¥Ú£C®lback.h
"

25 
	~"AsyncComm/S”Ÿliz©iÚ.h
"

27 
	~"Reque¡HªdËrClo£.h
"

29 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

30 
usšg
 
Çme¥aû
 
	gHy³¹abË
::
DfsBrok”
;

35 
	gReque¡HªdËrClo£
::
	$run
() {

36 
Re¥Ú£C®lback
 
	`cb
(
m_comm
, 
m_ev’t_±r
);

37 
ušt32_t
 
fd
;

38 
size_t
 
»maššg
 = 
m_ev’t_±r
->
mes§geL’
 - (
št16_t
);

39 
ušt8_t
 *
msgPŒ
 = 
m_ev’t_±r
->
mes§ge
 + (
št16_t
);

41 ià(!
S”Ÿliz©iÚ
::
	`decode_št
(&
msgPŒ
, &
»maššg
, &
fd
))

42 
abÜt
;

44 
m_brok”
->
	`şo£
(&
cb
, 
fd
);

48 
abÜt
:

49 
	`HT_ERROR
("Encoding…roblem with CLOSE message");

50 
cb
.
	`”rÜ
(
E¼Ü
::
PROTOCOL_ERROR
, "Encoding…roblem with CLOSE message");

52 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/RequestHandlerClose.h

21 #iâdeà
HYPERTABLE_REQUESTHANDLERCLOSE_H


22 
	#HYPERTABLE_REQUESTHANDLERCLOSE_H


	)

24 
	~"CommÚ/RuÂabË.h
"

26 
	~"AsyncComm/AµliÿtiÚHªdËr.h
"

27 
	~"AsyncComm/Comm.h
"

28 
	~"AsyncComm/Ev’t.h
"

30 
	~"Brok”.h
"

32 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

34 
Çme¥aû
 
	gHy³¹abË
 {

36 
Çme¥aû
 
	gDfsBrok”
 {

38 şas 
	cReque¡HªdËrClo£
 : 
public
 
AµliÿtiÚHªdËr
 {

39 
public
:

40 
Reque¡HªdËrClo£
(
Comm
 *
comm
, 
Brok”
 *
brok”
, 
Ev’tPŒ
 &
ev’tPŒ
è: 
AµliÿtiÚHªdËr
Óv’tPŒ), 
m_comm
(comm), 
m_brok”
(broker) {

44 
vœtu®
 
run
();

46 
	g´iv©e
:

47 
Comm
 *
m_comm
;

48 
Brok”
 *
	gm_brok”
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/RequestHandlerCreate.cc

21 
	~"CommÚ/E¼Ü.h
"

22 
	~"CommÚ/Logg”.h
"

24 
	~"AsyncComm/Re¥Ú£C®lback.h
"

25 
	~"AsyncComm/S”Ÿliz©iÚ.h
"

27 
	~"Reque¡HªdËrC»©e.h
"

29 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

30 
usšg
 
Çme¥aû
 
	gHy³¹abË
::
DfsBrok”
;

35 
	gReque¡HªdËrC»©e
::
	$run
() {

36 
Re¥Ú£C®lbackO³n
 
	`cb
(
m_comm
, 
m_ev’t_±r
);

37 cÚ¡ *
feName
;

38 
size_t
 
»maššg
 = 
m_ev’t_±r
->
mes§geL’
 - 2;

39 
ušt8_t
 *
msgPŒ
 = 
m_ev’t_±r
->
mes§ge
 + 2;

40 
ušt16_t
 
sv®
, 
»¶iÿtiÚ
;

41 
ušt32_t
 
iv®
, 
bufãrSize
;

42 
ušt64_t
 
blockSize
;

43 
boŞ
 
ov”wr™e
;

45 ià(
»maššg
 < 18)

46 
abÜt
;

49 
S”Ÿliz©iÚ
::
	`decode_shÜt
(&
msgPŒ
, &
»maššg
, &
sv®
);

50 
ov”wr™e
 = (
sv®
 =ğ0è? 
çl£
 : 
Œue
;

53 
S”Ÿliz©iÚ
::
	`decode_št
(&
msgPŒ
, &
»maššg
, &
iv®
);

54 
»¶iÿtiÚ
 = ()
iv®
;

57 
S”Ÿliz©iÚ
::
	`decode_št
(&
msgPŒ
, &
»maššg
, &
bufãrSize
);

60 
S”Ÿliz©iÚ
::
	`decode_lÚg
(&
msgPŒ
, &
»maššg
, &
blockSize
);

63 ià(!
S”Ÿliz©iÚ
::
	`decode_¡ršg
(&
msgPŒ
, &
»maššg
, &
feName
))

64 
abÜt
;

67 ià(
feName
[
	`¡¾’
(fileName)-1] == '/') {

68 
	`HT_ERRORF
("İ’ faed: bad f’am- %s", 
feName
);

69 
cb
.
	`”rÜ
(
E¼Ü
::
DFSBROKER_BAD_FILENAME
, 
feName
);

73 
m_brok”
->
	`ü—‹
(&
cb
, 
feName
, 
ov”wr™e
, 
bufãrSize
, 
»¶iÿtiÚ
, 
blockSize
);

77 
abÜt
:

78 
	`HT_ERROR
("Encoding…roblem with CREATE message");

79 
cb
.
	`”rÜ
(
E¼Ü
::
PROTOCOL_ERROR
, "Encoding…roblem with CREATE message");

81 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/RequestHandlerCreate.h

21 #iâdeà
HYPERTABLE_REQUESTHANDLERCREATE_H


22 
	#HYPERTABLE_REQUESTHANDLERCREATE_H


	)

24 
	~"CommÚ/RuÂabË.h
"

26 
	~"AsyncComm/AµliÿtiÚHªdËr.h
"

27 
	~"AsyncComm/Comm.h
"

28 
	~"AsyncComm/Ev’t.h
"

30 
	~"Brok”.h
"

32 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

34 
Çme¥aû
 
	gHy³¹abË
 {

36 
Çme¥aû
 
	gDfsBrok”
 {

38 şas 
	cReque¡HªdËrC»©e
 : 
public
 
AµliÿtiÚHªdËr
 {

39 
public
:

40 
Reque¡HªdËrC»©e
(
Comm
 *
comm
, 
Brok”
 *
brok”
, 
Ev’tPŒ
 &
ev’tPŒ
è: 
AµliÿtiÚHªdËr
Óv’tPŒ), 
m_comm
(comm), 
m_brok”
(broker) {

44 
vœtu®
 
run
();

46 
	g´iv©e
:

47 
Comm
 *
m_comm
;

48 
Brok”
 *
	gm_brok”
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/RequestHandlerFlush.cc

21 
	~"CommÚ/E¼Ü.h
"

22 
	~"CommÚ/Logg”.h
"

24 
	~"AsyncComm/Re¥Ú£C®lback.h
"

25 
	~"AsyncComm/S”Ÿliz©iÚ.h
"

27 
	~"Reque¡HªdËrFlush.h
"

29 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

30 
usšg
 
Çme¥aû
 
	gHy³¹abË
::
DfsBrok”
;

35 
	gReque¡HªdËrFlush
::
	$run
() {

36 
Re¥Ú£C®lback
 
	`cb
(
m_comm
, 
m_ev’t_±r
);

37 
ušt32_t
 
fd
;

38 
size_t
 
»maššg
 = 
m_ev’t_±r
->
mes§geL’
 - 2;

39 
ušt8_t
 *
msgPŒ
 = 
m_ev’t_±r
->
mes§ge
 + 2;

42 ià(!
S”Ÿliz©iÚ
::
	`decode_št
(&
msgPŒ
, &
»maššg
, &
fd
))

43 
abÜt
;

45 
m_brok”
->
	`æush
(&
cb
, 
fd
);

49 
abÜt
:

50 
	`HT_ERROR
("Encoding…roblem with FLUSH message");

51 
cb
.
	`”rÜ
(
E¼Ü
::
PROTOCOL_ERROR
, "Encoding…roblem with FLUSH message");

53 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/RequestHandlerFlush.h

21 #iâdeà
HYPERTABLE_REQUESTHANDLERFLUSH_H


22 
	#HYPERTABLE_REQUESTHANDLERFLUSH_H


	)

24 
	~"CommÚ/RuÂabË.h
"

26 
	~"AsyncComm/AµliÿtiÚHªdËr.h
"

27 
	~"AsyncComm/Comm.h
"

28 
	~"AsyncComm/Ev’t.h
"

30 
	~"Brok”.h
"

32 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

34 
Çme¥aû
 
	gHy³¹abË
 {

36 
Çme¥aû
 
	gDfsBrok”
 {

38 şas 
	cReque¡HªdËrFlush
 : 
public
 
AµliÿtiÚHªdËr
 {

39 
public
:

40 
Reque¡HªdËrFlush
(
Comm
 *
comm
, 
Brok”
 *
brok”
, 
Ev’tPŒ
 &
ev’tPŒ
è: 
AµliÿtiÚHªdËr
Óv’tPŒ), 
m_comm
(comm), 
m_brok”
(broker) {

44 
vœtu®
 
run
();

46 
	g´iv©e
:

47 
Comm
 *
m_comm
;

48 
Brok”
 *
	gm_brok”
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/RequestHandlerLength.cc

21 
	~"CommÚ/E¼Ü.h
"

22 
	~"CommÚ/Logg”.h
"

24 
	~"AsyncComm/Re¥Ú£C®lback.h
"

25 
	~"AsyncComm/S”Ÿliz©iÚ.h
"

27 
	~"Reque¡HªdËrL’gth.h
"

29 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

30 
usšg
 
Çme¥aû
 
	gHy³¹abË
::
DfsBrok”
;

35 
	gReque¡HªdËrL’gth
::
	$run
() {

36 
Re¥Ú£C®lbackL’gth
 
	`cb
(
m_comm
, 
m_ev’t_±r
);

37 cÚ¡ *
feName
;

38 
size_t
 
»maššg
 = 
m_ev’t_±r
->
mes§geL’
 - 2;

39 
ušt8_t
 *
msgPŒ
 = 
m_ev’t_±r
->
mes§ge
 + 2;

42 ià(!
S”Ÿliz©iÚ
::
	`decode_¡ršg
(&
msgPŒ
, &
»maššg
, &
feName
))

43 
abÜt
;

45 
m_brok”
->
	`Ëngth
(&
cb
, 
feName
);

49 
abÜt
:

50 
	`HT_ERROR
("Encoding…roblem with LENGTH message");

51 
cb
.
	`”rÜ
(
E¼Ü
::
PROTOCOL_ERROR
, "Encoding…roblem with LENGTH message");

53 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/RequestHandlerLength.h

21 #iâdeà
HYPERTABLE_REQUESTHANDLERLENGTH_H


22 
	#HYPERTABLE_REQUESTHANDLERLENGTH_H


	)

24 
	~"CommÚ/RuÂabË.h
"

26 
	~"AsyncComm/AµliÿtiÚHªdËr.h
"

27 
	~"AsyncComm/Comm.h
"

28 
	~"AsyncComm/Ev’t.h
"

30 
	~"Brok”.h
"

32 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

34 
Çme¥aû
 
	gHy³¹abË
 {

36 
Çme¥aû
 
	gDfsBrok”
 {

38 şas 
	cReque¡HªdËrL’gth
 : 
public
 
AµliÿtiÚHªdËr
 {

39 
public
:

40 
Reque¡HªdËrL’gth
(
Comm
 *
comm
, 
Brok”
 *
brok”
, 
Ev’tPŒ
 &
ev’tPŒ
è: 
AµliÿtiÚHªdËr
Óv’tPŒ), 
m_comm
(comm), 
m_brok”
(broker) {

44 
vœtu®
 
run
();

46 
	g´iv©e
:

47 
Comm
 *
m_comm
;

48 
Brok”
 *
	gm_brok”
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/RequestHandlerMkdirs.cc

21 
	~"CommÚ/E¼Ü.h
"

22 
	~"CommÚ/Logg”.h
"

24 
	~"AsyncComm/Re¥Ú£C®lback.h
"

25 
	~"AsyncComm/S”Ÿliz©iÚ.h
"

27 
	~"Reque¡HªdËrMkdœs.h
"

29 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

30 
usšg
 
Çme¥aû
 
	gHy³¹abË
::
DfsBrok”
;

35 
	gReque¡HªdËrMkdœs
::
	$run
() {

36 
Re¥Ú£C®lback
 
	`cb
(
m_comm
, 
m_ev’t_±r
);

37 cÚ¡ *
dœName
;

38 
size_t
 
»maššg
 = 
m_ev’t_±r
->
mes§geL’
 - 2;

39 
ušt8_t
 *
msgPŒ
 = 
m_ev’t_±r
->
mes§ge
 + 2;

42 ià(!
S”Ÿliz©iÚ
::
	`decode_¡ršg
(&
msgPŒ
, &
»maššg
, &
dœName
))

43 
abÜt
;

45 
m_brok”
->
	`mkdœs
(&
cb
, 
dœName
);

49 
abÜt
:

50 
	`HT_ERROR
("Encoding…roblem with MKDIRS message");

51 
cb
.
	`”rÜ
(
E¼Ü
::
PROTOCOL_ERROR
, "Encoding…roblem with MKDIRS message");

53 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/RequestHandlerMkdirs.h

21 #iâdeà
HYPERTABLE_REQUESTHANDLERMKDIRS_H


22 
	#HYPERTABLE_REQUESTHANDLERMKDIRS_H


	)

24 
	~"CommÚ/RuÂabË.h
"

26 
	~"AsyncComm/AµliÿtiÚHªdËr.h
"

27 
	~"AsyncComm/Comm.h
"

28 
	~"AsyncComm/Ev’t.h
"

30 
	~"Brok”.h
"

32 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

34 
Çme¥aû
 
	gHy³¹abË
 {

36 
Çme¥aû
 
	gDfsBrok”
 {

38 şas 
	cReque¡HªdËrMkdœs
 : 
public
 
AµliÿtiÚHªdËr
 {

39 
public
:

40 
Reque¡HªdËrMkdœs
(
Comm
 *
comm
, 
Brok”
 *
brok”
, 
Ev’tPŒ
 &
ev’tPŒ
è: 
AµliÿtiÚHªdËr
Óv’tPŒ), 
m_comm
(comm), 
m_brok”
(broker) {

44 
vœtu®
 
run
();

46 
	g´iv©e
:

47 
Comm
 *
m_comm
;

48 
Brok”
 *
	gm_brok”
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/RequestHandlerOpen.cc

21 
	~<c¡ršg
>

23 
	~"CommÚ/E¼Ü.h
"

24 
	~"CommÚ/Logg”.h
"

26 
	~"AsyncComm/Re¥Ú£C®lback.h
"

27 
	~"AsyncComm/S”Ÿliz©iÚ.h
"

29 
	~"Reque¡HªdËrO³n.h
"

31 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

32 
usšg
 
Çme¥aû
 
	gHy³¹abË
::
DfsBrok”
;

37 
	gReque¡HªdËrO³n
::
	$run
() {

38 
Re¥Ú£C®lbackO³n
 
	`cb
(
m_comm
, 
m_ev’t_±r
);

39 cÚ¡ *
feName
;

40 
ušt32_t
 
bufãrSize
;

41 
size_t
 
»maššg
 = 
m_ev’t_±r
->
mes§geL’
 - (
št16_t
);

42 
ušt8_t
 *
msgPŒ
 = 
m_ev’t_±r
->
mes§ge
 + (
št16_t
);

45 ià(!
S”Ÿliz©iÚ
::
	`decode_št
(&
msgPŒ
, &
»maššg
, &
bufãrSize
))

46 
abÜt
;

49 ià(!
S”Ÿliz©iÚ
::
	`decode_¡ršg
(&
msgPŒ
, &
»maššg
, &
feName
))

50 
abÜt
;

53 ià(
feName
[
	`¡¾’
(fileName)-1] == '/') {

54 
	`HT_ERRORF
("İ’ faed: bad f’am- %s", 
feName
);

55 
cb
.
	`”rÜ
(
E¼Ü
::
DFSBROKER_BAD_FILENAME
, 
feName
);

59 
m_brok”
->
	`İ’
(&
cb
, 
feName
, 
bufãrSize
);

63 
abÜt
:

64 
	`HT_ERROR
("Encoding…roblem with OPEN message");

65 
cb
.
	`”rÜ
(
E¼Ü
::
PROTOCOL_ERROR
, "Encoding…roblem with OPEN message");

67 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/RequestHandlerOpen.h

21 #iâdeà
HYPERTABLE_REQUESTHANDLEROPEN_H


22 
	#HYPERTABLE_REQUESTHANDLEROPEN_H


	)

24 
	~"CommÚ/RuÂabË.h
"

26 
	~"AsyncComm/AµliÿtiÚHªdËr.h
"

27 
	~"AsyncComm/Comm.h
"

28 
	~"AsyncComm/Ev’t.h
"

30 
	~"Brok”.h
"

32 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

34 
Çme¥aû
 
	gHy³¹abË
 {

36 
Çme¥aû
 
	gDfsBrok”
 {

38 şas 
	cReque¡HªdËrO³n
 : 
public
 
AµliÿtiÚHªdËr
 {

39 
public
:

40 
Reque¡HªdËrO³n
(
Comm
 *
comm
, 
Brok”
 *
brok”
, 
Ev’tPŒ
 &
ev’tPŒ
è: 
AµliÿtiÚHªdËr
Óv’tPŒ), 
m_comm
(comm), 
m_brok”
(broker) {

44 
vœtu®
 
run
();

46 
	g´iv©e
:

47 
Comm
 *
m_comm
;

48 
Brok”
 *
	gm_brok”
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/RequestHandlerPread.cc

21 
	~"CommÚ/E¼Ü.h
"

22 
	~"CommÚ/Logg”.h
"

24 
	~"AsyncComm/Re¥Ú£C®lback.h
"

25 
	~"AsyncComm/S”Ÿliz©iÚ.h
"

27 
	~"Reque¡HªdËrP»ad.h
"

29 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

30 
usšg
 
Çme¥aû
 
	gHy³¹abË
::
DfsBrok”
;

35 
	gReque¡HªdËrP»ad
::
	$run
() {

36 
Re¥Ú£C®lbackR—d
 
	`cb
(
m_comm
, 
m_ev’t_±r
);

37 
ušt32_t
 
fd
, 
amouÁ
;

38 
ušt64_t
 
off£t
;

39 
size_t
 
»maššg
 = 
m_ev’t_±r
->
mes§geL’
 - 2;

40 
ušt8_t
 *
msgPŒ
 = 
m_ev’t_±r
->
mes§ge
 + 2;

42 ià(
»maššg
 < 16)

43 
abÜt
;

46 
S”Ÿliz©iÚ
::
	`decode_št
(&
msgPŒ
, &
»maššg
, &
fd
);

49 
S”Ÿliz©iÚ
::
	`decode_lÚg
(&
msgPŒ
, &
»maššg
, &
off£t
);

52 
S”Ÿliz©iÚ
::
	`decode_št
(&
msgPŒ
, &
»maššg
, &
amouÁ
);

54 
m_brok”
->
	`´—d
(&
cb
, 
fd
, 
off£t
, 
amouÁ
);

58 
abÜt
:

59 
	`HT_ERROR
("Encoding…roblem with PREAD message");

60 
cb
.
	`”rÜ
(
E¼Ü
::
PROTOCOL_ERROR
, "Encoding…roblem with PREAD message");

62 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/RequestHandlerPread.h

21 #iâdeà
HYPERTABLE_REQUESTHANDLERPREAD_H


22 
	#HYPERTABLE_REQUESTHANDLERPREAD_H


	)

24 
	~"CommÚ/RuÂabË.h
"

26 
	~"AsyncComm/AµliÿtiÚHªdËr.h
"

27 
	~"AsyncComm/Comm.h
"

28 
	~"AsyncComm/Ev’t.h
"

30 
	~"Brok”.h
"

32 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

34 
Çme¥aû
 
	gHy³¹abË
 {

36 
Çme¥aû
 
	gDfsBrok”
 {

38 şas 
	cReque¡HªdËrP»ad
 : 
public
 
AµliÿtiÚHªdËr
 {

39 
public
:

40 
Reque¡HªdËrP»ad
(
Comm
 *
comm
, 
Brok”
 *
brok”
, 
Ev’tPŒ
 &
ev’tPŒ
è: 
AµliÿtiÚHªdËr
Óv’tPŒ), 
m_comm
(comm), 
m_brok”
(broker) {

44 
vœtu®
 
run
();

46 
	g´iv©e
:

47 
Comm
 *
m_comm
;

48 
Brok”
 *
	gm_brok”
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/RequestHandlerRead.cc

21 
	~"CommÚ/E¼Ü.h
"

22 
	~"CommÚ/Logg”.h
"

24 
	~"AsyncComm/Re¥Ú£C®lback.h
"

25 
	~"AsyncComm/S”Ÿliz©iÚ.h
"

27 
	~"Reque¡HªdËrR—d.h
"

29 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

30 
usšg
 
Çme¥aû
 
	gHy³¹abË
::
DfsBrok”
;

35 
	gReque¡HªdËrR—d
::
	$run
() {

36 
Re¥Ú£C®lbackR—d
 
	`cb
(
m_comm
, 
m_ev’t_±r
);

37 
ušt32_t
 
fd
, 
amouÁ
;

38 
size_t
 
»maššg
 = 
m_ev’t_±r
->
mes§geL’
 - 2;

39 
ušt8_t
 *
msgPŒ
 = 
m_ev’t_±r
->
mes§ge
 + 2;

41 ià(
»maššg
 < 8)

42 
abÜt
;

45 
S”Ÿliz©iÚ
::
	`decode_št
(&
msgPŒ
, &
»maššg
, &
fd
);

48 
S”Ÿliz©iÚ
::
	`decode_št
(&
msgPŒ
, &
»maššg
, &
amouÁ
);

50 
m_brok”
->
	`»ad
(&
cb
, 
fd
, 
amouÁ
);

54 
abÜt
:

55 
	`HT_ERROR
("Encoding…roblem with READ message");

56 
cb
.
	`”rÜ
(
E¼Ü
::
PROTOCOL_ERROR
, "Encoding…roblem with READ message");

58 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/RequestHandlerRead.h

21 #iâdeà
HYPERTABLE_REQUESTHANDLERREAD_H


22 
	#HYPERTABLE_REQUESTHANDLERREAD_H


	)

24 
	~"CommÚ/RuÂabË.h
"

26 
	~"AsyncComm/AµliÿtiÚHªdËr.h
"

27 
	~"AsyncComm/Comm.h
"

28 
	~"AsyncComm/Ev’t.h
"

30 
	~"Brok”.h
"

32 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

34 
Çme¥aû
 
	gHy³¹abË
 {

36 
Çme¥aû
 
	gDfsBrok”
 {

38 şas 
	cReque¡HªdËrR—d
 : 
public
 
AµliÿtiÚHªdËr
 {

39 
public
:

40 
Reque¡HªdËrR—d
(
Comm
 *
comm
, 
Brok”
 *
brok”
, 
Ev’tPŒ
 &
ev’tPŒ
è: 
AµliÿtiÚHªdËr
Óv’tPŒ), 
m_comm
(comm), 
m_brok”
(broker) {

44 
vœtu®
 
run
();

46 
	g´iv©e
:

47 
Comm
 *
m_comm
;

48 
Brok”
 *
	gm_brok”
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/RequestHandlerReaddir.cc

21 
	~"CommÚ/E¼Ü.h
"

22 
	~"CommÚ/Logg”.h
"

24 
	~"AsyncComm/Re¥Ú£C®lback.h
"

25 
	~"AsyncComm/S”Ÿliz©iÚ.h
"

27 
	~"Reque¡HªdËrR—ddœ.h
"

28 
	~"Re¥Ú£C®lbackR—ddœ.h
"

30 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

31 
usšg
 
Çme¥aû
 
	gHy³¹abË
::
DfsBrok”
;

36 
	gReque¡HªdËrR—ddœ
::
	$run
() {

37 
Re¥Ú£C®lbackR—ddœ
 
	`cb
(
m_comm
, 
m_ev’t_±r
);

38 cÚ¡ *
dœName
;

39 
size_t
 
»maššg
 = 
m_ev’t_±r
->
mes§geL’
 - (
št16_t
);

40 
ušt8_t
 *
msgPŒ
 = 
m_ev’t_±r
->
mes§ge
 + (
št16_t
);

43 ià(!
S”Ÿliz©iÚ
::
	`decode_¡ršg
(&
msgPŒ
, &
»maššg
, &
dœName
))

44 
abÜt
;

46 
m_brok”
->
	`»addœ
(&
cb
, 
dœName
);

50 
abÜt
:

51 
	`HT_ERROR
("Encoding…roblem with READDIR message");

52 
cb
.
	`”rÜ
(
E¼Ü
::
PROTOCOL_ERROR
, "Encoding…roblem with READDIR message");

54 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/RequestHandlerReaddir.h

21 #iâdeà
HYPERTABLE_REQUESTHANDLERREADDIR_H


22 
	#HYPERTABLE_REQUESTHANDLERREADDIR_H


	)

24 
	~"CommÚ/RuÂabË.h
"

26 
	~"AsyncComm/AµliÿtiÚHªdËr.h
"

27 
	~"AsyncComm/Comm.h
"

28 
	~"AsyncComm/Ev’t.h
"

30 
	~"Brok”.h
"

32 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

34 
Çme¥aû
 
	gHy³¹abË
 {

36 
Çme¥aû
 
	gDfsBrok”
 {

38 şas 
	cReque¡HªdËrR—ddœ
 : 
public
 
AµliÿtiÚHªdËr
 {

39 
public
:

40 
Reque¡HªdËrR—ddœ
(
Comm
 *
comm
, 
Brok”
 *
brok”
, 
Ev’tPŒ
 &
ev’tPŒ
è: 
AµliÿtiÚHªdËr
Óv’tPŒ), 
m_comm
(comm), 
m_brok”
(broker) {

44 
vœtu®
 
run
();

46 
	g´iv©e
:

47 
Comm
 *
m_comm
;

48 
Brok”
 *
	gm_brok”
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/RequestHandlerRemove.cc

21 
	~"CommÚ/E¼Ü.h
"

22 
	~"CommÚ/Logg”.h
"

24 
	~"AsyncComm/Re¥Ú£C®lback.h
"

25 
	~"AsyncComm/S”Ÿliz©iÚ.h
"

27 
	~"Reque¡HªdËrRemove.h
"

29 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

30 
usšg
 
Çme¥aû
 
	gHy³¹abË
::
DfsBrok”
;

35 
	gReque¡HªdËrRemove
::
	$run
() {

36 
Re¥Ú£C®lback
 
	`cb
(
m_comm
, 
m_ev’t_±r
);

37 cÚ¡ *
feName
;

38 
size_t
 
»maššg
 = 
m_ev’t_±r
->
mes§geL’
 - 2;

39 
ušt8_t
 *
msgPŒ
 = 
m_ev’t_±r
->
mes§ge
 + 2;

42 ià(!
S”Ÿliz©iÚ
::
	`decode_¡ršg
(&
msgPŒ
, &
»maššg
, &
feName
))

43 
abÜt
;

45 
m_brok”
->
	`»move
(&
cb
, 
feName
);

49 
abÜt
:

50 
	`HT_ERROR
("Encoding…roblem with REMOVE message");

51 
cb
.
	`”rÜ
(
E¼Ü
::
PROTOCOL_ERROR
, "Encoding…roblem with REMOVE message");

53 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/RequestHandlerRemove.h

21 #iâdeà
HYPERTABLE_REQUESTHANDLERREMOVE_H


22 
	#HYPERTABLE_REQUESTHANDLERREMOVE_H


	)

24 
	~"CommÚ/RuÂabË.h
"

26 
	~"AsyncComm/AµliÿtiÚHªdËr.h
"

27 
	~"AsyncComm/Comm.h
"

28 
	~"AsyncComm/Ev’t.h
"

30 
	~"Brok”.h
"

32 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

34 
Çme¥aû
 
	gHy³¹abË
 {

36 
Çme¥aû
 
	gDfsBrok”
 {

38 şas 
	cReque¡HªdËrRemove
 : 
public
 
AµliÿtiÚHªdËr
 {

39 
public
:

40 
Reque¡HªdËrRemove
(
Comm
 *
comm
, 
Brok”
 *
brok”
, 
Ev’tPŒ
 &
ev’tPŒ
è: 
AµliÿtiÚHªdËr
Óv’tPŒ), 
m_comm
(comm), 
m_brok”
(broker) {

44 
vœtu®
 
run
();

46 
	g´iv©e
:

47 
Comm
 *
m_comm
;

48 
Brok”
 *
	gm_brok”
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/RequestHandlerRmdir.cc

21 
	~"CommÚ/E¼Ü.h
"

22 
	~"CommÚ/Logg”.h
"

24 
	~"AsyncComm/Re¥Ú£C®lback.h
"

25 
	~"AsyncComm/S”Ÿliz©iÚ.h
"

27 
	~"Reque¡HªdËrRmdœ.h
"

29 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

30 
usšg
 
Çme¥aû
 
	gHy³¹abË
::
DfsBrok”
;

35 
	gReque¡HªdËrRmdœ
::
	$run
() {

36 
Re¥Ú£C®lback
 
	`cb
(
m_comm
, 
m_ev’t_±r
);

37 cÚ¡ *
dœName
;

38 
size_t
 
»maššg
 = 
m_ev’t_±r
->
mes§geL’
 - (
št16_t
);

39 
ušt8_t
 *
msgPŒ
 = 
m_ev’t_±r
->
mes§ge
 + (
št16_t
);

42 ià(!
S”Ÿliz©iÚ
::
	`decode_¡ršg
(&
msgPŒ
, &
»maššg
, &
dœName
))

43 
abÜt
;

45 
m_brok”
->
	`rmdœ
(&
cb
, 
dœName
);

49 
abÜt
:

50 
	`HT_ERROR
("Encoding…roblem with RMDIR message");

51 
cb
.
	`”rÜ
(
E¼Ü
::
PROTOCOL_ERROR
, "Encoding…roblem with RMDIR message");

53 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/RequestHandlerRmdir.h

21 #iâdeà
HYPERTABLE_REQUESTHANDLERRMDIR_H


22 
	#HYPERTABLE_REQUESTHANDLERRMDIR_H


	)

24 
	~"CommÚ/RuÂabË.h
"

26 
	~"AsyncComm/AµliÿtiÚHªdËr.h
"

27 
	~"AsyncComm/Comm.h
"

28 
	~"AsyncComm/Ev’t.h
"

30 
	~"Brok”.h
"

32 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

34 
Çme¥aû
 
	gHy³¹abË
 {

36 
Çme¥aû
 
	gDfsBrok”
 {

38 şas 
	cReque¡HªdËrRmdœ
 : 
public
 
AµliÿtiÚHªdËr
 {

39 
public
:

40 
Reque¡HªdËrRmdœ
(
Comm
 *
comm
, 
Brok”
 *
brok”
, 
Ev’tPŒ
 &
ev’tPŒ
è: 
AµliÿtiÚHªdËr
Óv’tPŒ), 
m_comm
(comm), 
m_brok”
(broker) {

44 
vœtu®
 
run
();

46 
	g´iv©e
:

47 
Comm
 *
m_comm
;

48 
Brok”
 *
	gm_brok”
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/RequestHandlerSeek.cc

21 
	~"CommÚ/E¼Ü.h
"

22 
	~"CommÚ/Logg”.h
"

24 
	~"AsyncComm/Re¥Ú£C®lback.h
"

25 
	~"AsyncComm/S”Ÿliz©iÚ.h
"

27 
	~"Reque¡HªdËrS“k.h
"

29 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

30 
usšg
 
Çme¥aû
 
	gHy³¹abË
::
DfsBrok”
;

35 
	gReque¡HªdËrS“k
::
	$run
() {

36 
Re¥Ú£C®lback
 
	`cb
(
m_comm
, 
m_ev’t_±r
);

37 
ušt32_t
 
fd
;

38 
ušt64_t
 
off£t
;

39 
size_t
 
»maššg
 = 
m_ev’t_±r
->
mes§geL’
 - (
št16_t
);

40 
ušt8_t
 *
msgPŒ
 = 
m_ev’t_±r
->
mes§ge
 + (
št16_t
);

42 ià(
»maššg
 < 12)

43 
abÜt
;

46 
S”Ÿliz©iÚ
::
	`decode_št
(&
msgPŒ
, &
»maššg
, &
fd
);

49 
S”Ÿliz©iÚ
::
	`decode_lÚg
(&
msgPŒ
, &
»maššg
, &
off£t
);

51 
m_brok”
->
	`£ek
(&
cb
, 
fd
, 
off£t
);

55 
abÜt
:

56 
	`HT_ERROR
("Encoding…roblem with SEEK message");

57 
cb
.
	`”rÜ
(
E¼Ü
::
PROTOCOL_ERROR
, "Encoding…roblem with SEEK message");

59 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/RequestHandlerSeek.h

21 #iâdeà
HYPERTABLE_REQUESTHANDLERSEEK_H


22 
	#HYPERTABLE_REQUESTHANDLERSEEK_H


	)

24 
	~"CommÚ/RuÂabË.h
"

26 
	~"AsyncComm/AµliÿtiÚHªdËr.h
"

27 
	~"AsyncComm/Comm.h
"

28 
	~"AsyncComm/Ev’t.h
"

30 
	~"Brok”.h
"

32 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

34 
Çme¥aû
 
	gHy³¹abË
 {

36 
Çme¥aû
 
	gDfsBrok”
 {

38 şas 
	cReque¡HªdËrS“k
 : 
public
 
AµliÿtiÚHªdËr
 {

39 
public
:

40 
Reque¡HªdËrS“k
(
Comm
 *
comm
, 
Brok”
 *
brok”
, 
Ev’tPŒ
 &
ev’tPŒ
è: 
AµliÿtiÚHªdËr
Óv’tPŒ), 
m_comm
(comm), 
m_brok”
(broker) {

44 
vœtu®
 
run
();

46 
	g´iv©e
:

47 
Comm
 *
m_comm
;

48 
Brok”
 *
	gm_brok”
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/RequestHandlerStatus.cc

21 
	~"CommÚ/E¼Ü.h
"

22 
	~"CommÚ/Logg”.h
"

24 
	~"AsyncComm/Re¥Ú£C®lback.h
"

26 
	~"Reque¡HªdËrStus.h
"

28 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

29 
usšg
 
Çme¥aû
 
	gHy³¹abË
::
DfsBrok”
;

34 
	gReque¡HªdËrStus
::
	$run
() {

35 
Re¥Ú£C®lback
 
	`cb
(
m_comm
, 
m_ev’t_±r
);

36 
m_brok”
->
	`¡©us
(&
cb
);

37 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/RequestHandlerStatus.h

21 #iâdeà
HYPERTABLE_REQUESTHANDLERSTATUS_H


22 
	#HYPERTABLE_REQUESTHANDLERSTATUS_H


	)

24 
	~"CommÚ/RuÂabË.h
"

26 
	~"AsyncComm/AµliÿtiÚHªdËr.h
"

27 
	~"AsyncComm/Comm.h
"

28 
	~"AsyncComm/Ev’t.h
"

30 
	~"Brok”.h
"

32 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

34 
Çme¥aû
 
	gHy³¹abË
 {

36 
Çme¥aû
 
	gDfsBrok”
 {

38 şas 
	cReque¡HªdËrStus
 : 
public
 
AµliÿtiÚHªdËr
 {

39 
public
:

40 
Reque¡HªdËrStus
(
Comm
 *
comm
, 
Brok”
 *
brok”
, 
Ev’tPŒ
 &
ev’tPŒ
è: 
AµliÿtiÚHªdËr
Óv’tPŒ), 
m_comm
(comm), 
m_brok”
(broker) {

44 
vœtu®
 
run
();

46 
	g´iv©e
:

47 
Comm
 *
m_comm
;

48 
Brok”
 *
	gm_brok”
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/ResponseCallbackAppend.cc

21 
	~"CommÚ/E¼Ü.h
"

23 
	~"AsyncComm/CommBuf.h
"

25 
	~"Re¥Ú£C®lbackAµ’d.h
"

27 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

28 
usšg
 
Çme¥aû
 
	gHy³¹abË
::
DfsBrok”
;

30 
	gRe¥Ú£C®lbackAµ’d
::
	$»¥Ú£
(
ušt64_t
 
off£t
, 
ušt32_t
 
amouÁ
) {

31 
hbud”_
.
	`š™Ÿlize_äom_»que¡
(
m_ev’t_±r
->
h—d”
);

32 
CommBufPŒ
 
	`cbufPŒ
Ğ
Ãw
 
	`CommBuf
(
hbud”_
, 16 ) );

33 
cbufPŒ
->
	`­³nd_št
(
E¼Ü
::
OK
);

34 
cbufPŒ
->
	`­³nd_lÚg
(
off£t
);

35 
cbufPŒ
->
	`­³nd_št
(
amouÁ
);

36  
m_comm
->
	`£nd_»¥Ú£
(
m_ev’t_±r
->
addr
, 
cbufPŒ
);

37 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/ResponseCallbackAppend.h

21 #iâdeà
HYPERTABLE_RESPONSECALLBACKAPPEND_H


22 
	#HYPERTABLE_RESPONSECALLBACKAPPEND_H


	)

24 
	~"CommÚ/E¼Ü.h
"

26 
	~"AsyncComm/CommBuf.h
"

27 
	~"AsyncComm/Re¥Ú£C®lback.h
"

29 
Çme¥aû
 
	gHy³¹abË
 {

31 
Çme¥aû
 
	gDfsBrok”
 {

33 şas 
	cRe¥Ú£C®lbackAµ’d
 : 
public
 
Re¥Ú£C®lback
 {

34 
public
:

35 
Re¥Ú£C®lbackAµ’d
(
Comm
 *
comm
, 
Ev’tPŒ
 &
ev’tPŒ
è: 
Re¥Ú£C®lback
(comm,ƒventPtr) { ; }

36 
»¥Ú£
(
ušt64_t
 
off£t
, 
ušt32_t
 
amouÁ
);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/ResponseCallbackLength.cc

21 
	~"CommÚ/E¼Ü.h
"

23 
	~"AsyncComm/CommBuf.h
"

25 
	~"Re¥Ú£C®lbackL’gth.h
"

27 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

28 
usšg
 
Çme¥aû
 
	gHy³¹abË
::
DfsBrok”
;

30 
	gRe¥Ú£C®lbackL’gth
::
	$»¥Ú£
(
ušt64_t
 
off£t
) {

31 
hbud”_
.
	`š™Ÿlize_äom_»que¡
(
m_ev’t_±r
->
h—d”
);

32 
CommBufPŒ
 
	`cbufPŒ
Ğ
Ãw
 
	`CommBuf
(
hbud”_
, 12 ) );

33 
cbufPŒ
->
	`­³nd_št
(
E¼Ü
::
OK
);

34 
cbufPŒ
->
	`­³nd_lÚg
(
off£t
);

35  
m_comm
->
	`£nd_»¥Ú£
(
m_ev’t_±r
->
addr
, 
cbufPŒ
);

36 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/ResponseCallbackLength.h

21 #iâdeà
HYPERTABLE_RESPONSECALLBACKLENGTH_H


22 
	#HYPERTABLE_RESPONSECALLBACKLENGTH_H


	)

24 
	~"CommÚ/E¼Ü.h
"

26 
	~"AsyncComm/CommBuf.h
"

27 
	~"AsyncComm/Re¥Ú£C®lback.h
"

29 
Çme¥aû
 
	gHy³¹abË
 {

31 
Çme¥aû
 
	gDfsBrok”
 {

33 şas 
	cRe¥Ú£C®lbackL’gth
 : 
public
 
Re¥Ú£C®lback
 {

34 
public
:

35 
Re¥Ú£C®lbackL’gth
(
Comm
 *
comm
, 
Ev’tPŒ
 &
ev’tPŒ
è: 
Re¥Ú£C®lback
(comm,ƒventPtr) { ; }

36 
»¥Ú£
(
ušt64_t
 
off£t
);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/ResponseCallbackOpen.cc

21 
	~"CommÚ/E¼Ü.h
"

23 
	~"AsyncComm/CommBuf.h
"

25 
	~"Re¥Ú£C®lbackO³n.h
"

27 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

28 
usšg
 
Çme¥aû
 
	gHy³¹abË
::
DfsBrok”
;

30 
	gRe¥Ú£C®lbackO³n
::
	$»¥Ú£
(
št32_t
 
fd
) {

31 
hbud”_
.
	`š™Ÿlize_äom_»que¡
(
m_ev’t_±r
->
h—d”
);

32 
CommBufPŒ
 
	`cbufPŒ
Ğ
Ãw
 
	`CommBuf
(
hbud”_
, 8 ) );

33 
cbufPŒ
->
	`­³nd_št
(
E¼Ü
::
OK
);

34 
cbufPŒ
->
	`­³nd_št
(
fd
);

35  
m_comm
->
	`£nd_»¥Ú£
(
m_ev’t_±r
->
addr
, 
cbufPŒ
);

36 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/ResponseCallbackOpen.h

21 #iâdeà
HYPERTABLE_RESPONSECALLBACKOPEN_H


22 
	#HYPERTABLE_RESPONSECALLBACKOPEN_H


	)

24 
	~"CommÚ/E¼Ü.h
"

26 
	~"AsyncComm/CommBuf.h
"

27 
	~"AsyncComm/Re¥Ú£C®lback.h
"

29 
Çme¥aû
 
	gHy³¹abË
 {

31 
Çme¥aû
 
	gDfsBrok”
 {

33 şas 
	cRe¥Ú£C®lbackO³n
 : 
public
 
Re¥Ú£C®lback
 {

34 
public
:

35 
Re¥Ú£C®lbackO³n
(
Comm
 *
comm
, 
Ev’tPŒ
 &
ev’tPŒ
è: 
Re¥Ú£C®lback
(comm,ƒventPtr) { ; }

36 
»¥Ú£
(
št32_t
 
fd
);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/ResponseCallbackRead.cc

21 
	~"CommÚ/E¼Ü.h
"

23 
	~"AsyncComm/CommBuf.h
"

25 
	~"Re¥Ú£C®lbackR—d.h
"

27 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

28 
usšg
 
Çme¥aû
 
	gHy³¹abË
::
DfsBrok”
;

30 
	gRe¥Ú£C®lbackR—d
::
	$»¥Ú£
(
ušt64_t
 
off£t
, 
ušt32_t
 
Ä—d
, 
ušt8_t
 *
d©a
) {

31 
hbud”_
.
	`š™Ÿlize_äom_»que¡
(
m_ev’t_±r
->
h—d”
);

32 
CommBufPŒ
 
	`cbufPŒ
Ğ
Ãw
 
	`CommBuf
(
hbud”_
, 16, 
d©a
, 
Ä—d
) );

33 
cbufPŒ
->
	`­³nd_št
(
E¼Ü
::
OK
);

34 
cbufPŒ
->
	`­³nd_lÚg
(
off£t
);

35 
cbufPŒ
->
	`­³nd_št
(
Ä—d
);

36  
m_comm
->
	`£nd_»¥Ú£
(
m_ev’t_±r
->
addr
, 
cbufPŒ
);

37 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/ResponseCallbackRead.h

21 #iâdeà
HYPERTABLE_RESPONSECALLBACKREAD_H


22 
	#HYPERTABLE_RESPONSECALLBACKREAD_H


	)

24 
	~"CommÚ/E¼Ü.h
"

26 
	~"AsyncComm/CommBuf.h
"

27 
	~"AsyncComm/Re¥Ú£C®lback.h
"

29 
Çme¥aû
 
	gHy³¹abË
 {

31 
Çme¥aû
 
	gDfsBrok”
 {

33 şas 
	cRe¥Ú£C®lbackR—d
 : 
public
 
Re¥Ú£C®lback
 {

34 
public
:

35 
Re¥Ú£C®lbackR—d
(
Comm
 *
comm
, 
Ev’tPŒ
 &
ev’tPŒ
è: 
Re¥Ú£C®lback
(comm,ƒventPtr) { ; }

36 
»¥Ú£
(
ušt64_t
 
off£t
, 
ušt32_t
 
Ä—d
, 
ušt8_t
 *
d©a
);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/ResponseCallbackReaddir.cc

21 
	~"CommÚ/E¼Ü.h
"

23 
	~"AsyncComm/CommBuf.h
"

24 
	~"AsyncComm/S”Ÿliz©iÚ.h
"

26 
	~"Re¥Ú£C®lbackR—ddœ.h
"

28 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

29 
usšg
 
Çme¥aû
 
	gHy³¹abË
::
DfsBrok”
;

31 
	gRe¥Ú£C®lbackR—ddœ
::
»¥Ú£
(
¡d
::
veùÜ
<¡d::
¡ršg
> &
li¡šg
) {

32 
hbud”_
.
š™Ÿlize_äom_»que¡
(
m_ev’t_±r
->
h—d”
);

33 
ušt32_t
 
	gËn
 = 8;

34 
size_t
 
	gi
=0; i<
	gli¡šg
.
size
(); i++)

35 
	gËn
 +ğ
S”Ÿliz©iÚ
::
’coded_Ëngth_¡ršg
(
li¡šg
[
i
]);

36 
CommBufPŒ
 
cbufPŒ
Ğ
Ãw
 
CommBuf
(
hbud”_
, 
Ën
) );

37 
	gcbufPŒ
->
­³nd_št
(
E¼Ü
::
OK
);

38 
	gcbufPŒ
->
­³nd_št
(
li¡šg
.
size
());

39 
size_t
 
	gi
=0; i<
	gli¡šg
.
size
(); i++)

40 
	gcbufPŒ
->
­³nd_¡ršg
(
li¡šg
[
i
]);

41  
	gm_comm
->
£nd_»¥Ú£
(
m_ev’t_±r
->
addr
, 
cbufPŒ
);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/ResponseCallbackReaddir.h

21 #iâdeà
HYPERTABLE_RESPONSECALLBACKREADDIR_H


22 
	#HYPERTABLE_RESPONSECALLBACKREADDIR_H


	)

24 
	~<veùÜ
>

26 
	~"CommÚ/E¼Ü.h
"

28 
	~"AsyncComm/CommBuf.h
"

29 
	~"AsyncComm/Re¥Ú£C®lback.h
"

31 
Çme¥aû
 
	gHy³¹abË
 {

33 
Çme¥aû
 
	gDfsBrok”
 {

35 şas 
	cRe¥Ú£C®lbackR—ddœ
 : 
public
 
Re¥Ú£C®lback
 {

36 
public
:

37 
Re¥Ú£C®lbackR—ddœ
(
Comm
 *
comm
, 
Ev’tPŒ
 &
ev’tPŒ
è: 
Re¥Ú£C®lback
(comm,ƒventPtr) { ; }

38 
»¥Ú£
(
¡d
::
veùÜ
<¡d::
¡ršg
> &
li¡šg
);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/kosmos/KosmosBroker.cc

21 
	~<û¼no
>

22 
	~<c¡ršg
>

25 
	~<fú.h
>

26 
	~<pŞl.h
>

27 
	~<sys/ty³s.h
>

28 
	~<sys/uio.h
>

29 
	~<uni¡d.h
>

30 
	~<time.h
>

33 
	~"CommÚ/FeUts.h
"

34 
	~"CommÚ/Sy¡em.h
"

36 
	~"KosmosBrok”.h
"

38 
usšg
 
Çme¥aû
 
Hy³¹abË
;

39 
usšg
 
	gKFS
::
KfsCl›Á
;

41 
	gKosmosBrok”
::
	$KosmosBrok”
(
Prİ”t›sPŒ
 &
´İsPŒ
è: 
	$mV”bo£
(
çl£
) {

43 cÚ¡ *
m‘aName
;

44 
m‘aPÜt
;

46 
mV”bo£
 = 
´İsPŒ
->
	`g‘_boŞ
("Hy³¹abË.V”bo£", 
çl£
);

48 
KfsCl›Á
 *
şÁ
 = KfsCl›Á::
	`In¡ªû
();

49 
m‘aName
 = 
´İsPŒ
->
	`g‘
("Kfs.MetaServer.Name", "");

50 
m‘aPÜt
 = 
´İsPŒ
->
	`g‘_št
("Kfs.MetaServer.Port", -1);

52 
¡d
::
û¼
 << "S”v”: " << 
m‘aName
 << " " << 
m‘aPÜt
 << std::
’dl
;

53 
şÁ
->
	`In™
(
m‘aName
, 
m‘aPÜt
);

54 
mRoÙdœ
 = "";

55 
	}
}

59 
	gKosmosBrok”
::~
	$KosmosBrok”
() {

60 
	}
}

66 
KosmosBrok”
::
	$İ’
(
Re¥Ú£C®lbackO³n
 *
cb
, cÚ¡ *
feName
, 
ušt32_t
 
bufãrSize
) {

67 
fd
;

68 
¡d
::
¡ršg
 
absFeName
;

69 
KfsCl›Á
 *
şÁ
 = KfsCl›Á::
	`In¡ªû
();

71 ià(
mV”bo£
) {

72 
	`HT_INFOF
("İ’ fe='%s' bufãrSize=%d", 
feName
, 
bufãrSize
);

75 ià(
feName
[0] == '/')

76 
absFeName
 = 
feName
;

78 
absFeName
 = 
mRoÙdœ
 + "/" + 
feName
;

80 
¡d
::
û¼
 << "O³Àfe: " << 
absFeName
 << std::
’dl
;

87 ià((
fd
 = 
şÁ
->
	`O³n
(
absFeName
.
	`c_¡r
(), 
O_RDONLY
)) < 0) {

88 
¡ršg
 
”rMsg
 = 
KFS
::
	`E¼ÜCodeToSŒ
(
fd
);

89 
	`HT_ERRORF
("İ’ faed: fe='%s' - %s", 
absFeName
.
	`c_¡r
(), 
”rMsg
.c_str());

90 
	`R•ÜtE¼Ü
(
cb
, 
fd
);

95 
sockaddr_š
 
addr
;

96 
O³nFeD©aKosmosPŒ
 
	`d©aPŒ
(
Ãw
 
	`O³nFeD©aKosmos
(
fd
, 
O_RDONLY
));

98 
cb
->
	`g‘_add»ss
(
addr
);

100 
¡d
::
û¼
 << "GÙ fd fÜ fe: " << 
absFeName
 << std::
’dl
;

102 
m_İ’_fe_m­
.
	`ü—‹
(
fd
, 
addr
, 
d©aPŒ
);

104 
¡d
::
û¼
 << "In£¹ed fd iÁØİ’ fm­ fÜ fe: "<< 
absFeName
 << std::
’dl
;

106 
cb
->
	`»¥Ú£
(
fd
);

108 
	}
}

114 
	gKosmosBrok”
::
	$ü—‹
(
Re¥Ú£C®lbackO³n
 *
cb
, cÚ¡ *
feName
, 
boŞ
 
ov”wr™e
,

115 
ušt32_t
 
bufãrSize
, 
ušt16_t
 
»¶iÿtiÚ
, 
ušt64_t
 
blockSize
) {

116 
fd
;

117 
æags
;

118 
¡d
::
¡ršg
 
absFeName
;

119 
KfsCl›Á
 *
şÁ
 = KfsCl›Á::
	`In¡ªû
();

121 ià(
mV”bo£
) {

122 
	`HT_INFOF
("create file='%s' overwrite=%d bufferSize=%d„eplication=%d blockSize=%d",

123 
feName
, ()
ov”wr™e
, 
bufãrSize
, 
»¶iÿtiÚ
, 
blockSize
);

126 ià(
feName
[0] == '/')

127 
absFeName
 = 
feName
;

129 
absFeName
 = 
mRoÙdœ
 + "/" + 
feName
;

134 ià(
ov”wr™e
)

135 
æags
 = 
O_WRONLY
 | 
O_CREAT
 | 
O_TRUNC
;

137 
æags
 = 
O_WRONLY
 | 
O_CREAT
 | 
O_APPEND
;

139 
¡d
::
û¼
 << "C»©fe: " << 
absFeName
 << " " << 
æags
 << std::
’dl
;

144 ià((
fd
 = 
şÁ
->
	`O³n
(
absFeName
.
	`c_¡r
(), 
æags
)) < 0) {

145 
¡ršg
 
”rMsg
 = 
KFS
::
	`E¼ÜCodeToSŒ
(
fd
);

146 
¡d
::
û¼
 << "C»©çed: " << 
”rMsg
 << std::
’dl
;

148 
	`HT_ERRORF
("İ’ faed: fe='%s' - %s", 
absFeName
.
	`c_¡r
(), 
”rMsg
.c_str());

149 
	`R•ÜtE¼Ü
(
cb
, 
fd
);

154 
sockaddr_š
 
addr
;

155 
O³nFeD©aKosmosPŒ
 
	`d©aPŒ
(
Ãw
 
	`O³nFeD©aKosmos
(
fd
, 
O_WRONLY
));

157 
cb
->
	`g‘_add»ss
(
addr
);

159 
m_İ’_fe_m­
.
	`ü—‹
(
fd
, 
addr
, 
d©aPŒ
);

161 
cb
->
	`»¥Ú£
(
fd
);

163 
	}
}

169 
	gKosmosBrok”
::
	$şo£
(
Re¥Ú£C®lback
 *
cb
, 
ušt32_t
 
fd
) {

170 ià(
mV”bo£
) {

171 
	`HT_INFOF
("şo£ fd=%d", 
fd
);

174 
m_İ’_fe_m­
.
	`»move
(
fd
);

176 
cb
->
	`»¥Ú£_ok
();

177 
	}
}

183 
	gKosmosBrok”
::
	$»ad
(
Re¥Ú£C®lbackR—d
 *
cb
, 
ušt32_t
 
fd
, ušt32_ˆ
amouÁ
) {

184 
O³nFeD©aKosmosPŒ
 
d©aPŒ
;

185 
ssize_t
 
Ä—d
;

186 
ušt64_t
 
off£t
;

187 
ušt8_t
 *
buf
;

188 
KfsCl›Á
 *
şÁ
 = KfsCl›Á::
	`In¡ªû
();

190 ià(
mV”bo£
) {

191 
	`HT_INFOF
("»ad fd=%d‡mouÁ=%d", 
fd
, 
amouÁ
);

194 
buf
 = 
Ãw
 
ušt8_t
 [ 
amouÁ
 ];

196 ià(!
m_İ’_fe_m­
.
	`g‘
(
fd
, 
d©aPŒ
)) {

197 
”rbuf
[32];

198 
	`¥rštf
(
”rbuf
, "%d", 
fd
);

199 
cb
->
	`”rÜ
(
E¼Ü
::
DFSBROKER_BAD_FILE_HANDLE
, 
”rbuf
);

203 
off£t
 = 
şÁ
->
	`T–l
(
d©aPŒ
->
fd
);

205 ià((
Ä—d
 = 
şÁ
->
	`R—d
(
d©aPŒ
->
fd
, (*è
buf
, (
size_t
è
amouÁ
)) < 0) {

206 
¡ršg
 
”rMsg
 = 
KFS
::
	`E¼ÜCodeToSŒ
(
Ä—d
);

207 
	`HT_ERRORF
("»ad faed: fd=%d‡mouÁ=%d - %s", 
d©aPŒ
->
fd
, 
amouÁ
, 
”rMsg
.
	`c_¡r
());

208 
	`R•ÜtE¼Ü
(
cb
, 
Ä—d
);

212 
cb
->
	`»¥Ú£
(
off£t
, 
Ä—d
, 
buf
);

214 
	}
}

220 
	gKosmosBrok”
::
	$­³nd
(
Re¥Ú£C®lbackAµ’d
 *
cb
, 
ušt32_t
 
fd
, ušt32_ˆ
amouÁ
, 
ušt8_t
 *
d©a
) {

221 
O³nFeD©aKosmosPŒ
 
d©aPŒ
;

222 
ssize_t
 
nwr™‹n
;

223 
ušt64_t
 
off£t
;

224 
KfsCl›Á
 *
şÁ
 = KfsCl›Á::
	`In¡ªû
();

226 ià(
mV”bo£
) {

227 
	`HT_INFOF
("­³nd fd=%d‡mouÁ=%d", 
fd
, 
amouÁ
);

230 ià(!
m_İ’_fe_m­
.
	`g‘
(
fd
, 
d©aPŒ
)) {

231 
”rbuf
[32];

232 
	`¥rštf
(
”rbuf
, "%d", 
fd
);

233 
cb
->
	`”rÜ
(
E¼Ü
::
DFSBROKER_BAD_FILE_HANDLE
, 
”rbuf
);

237 
off£t
 = 
şÁ
->
	`T–l
(
d©aPŒ
->
fd
);

239 ià((
nwr™‹n
 = 
şÁ
->
	`Wr™e
(
d©aPŒ
->
fd
, (cÚ¡ *è
d©a
, (
size_t
è
amouÁ
)) < 0) {

240 
¡ršg
 
”rMsg
 = 
KFS
::
	`E¼ÜCodeToSŒ
(
nwr™‹n
);

241 
	`HT_ERRORF
("wr™çed: fd=%d‡mouÁ=%d - %s", 
d©aPŒ
->
fd
, 
amouÁ
, 
”rMsg
.
	`c_¡r
());

242 
	`R•ÜtE¼Ü
(
cb
, 
nwr™‹n
);

246 
cb
->
	`»¥Ú£
(
off£t
, 
nwr™‹n
);

249 
	}
}

255 
	gKosmosBrok”
::
	$£ek
(
Re¥Ú£C®lback
 *
cb
, 
ušt32_t
 
fd
, 
ušt64_t
 
off£t
) {

256 
O³nFeD©aKosmosPŒ
 
d©aPŒ
;

257 
KfsCl›Á
 *
şÁ
 = KfsCl›Á::
	`In¡ªû
();

259 ià(!
m_İ’_fe_m­
.
	`g‘
(
fd
, 
d©aPŒ
)) {

260 
”rbuf
[32];

261 
	`¥rštf
(
”rbuf
, "%d", 
fd
);

262 
cb
->
	`”rÜ
(
E¼Ü
::
DFSBROKER_BAD_FILE_HANDLE
, 
”rbuf
);

266 ià((
off£t
 = (
ušt64_t
è
şÁ
->
	`S“k
(
d©aPŒ
->
fd
, off£t, 
SEEK_SET
)) == (uint64_t) -1) {

267 
¡ršg
 
”rMsg
 = 
KFS
::
	`E¼ÜCodeToSŒ
(
off£t
);

268 
	`HT_ERRORF
("l£ek faed: fd=%d off£t=%Îd - %s", 
d©aPŒ
->
fd
, 
off£t
, 
”rMsg
.
	`c_¡r
());

269 
	`R•ÜtE¼Ü
(
cb
, (è
off£t
);

273 
cb
->
	`»¥Ú£_ok
();

274 
	}
}

280 
	gKosmosBrok”
::
	$»move
(
Re¥Ú£C®lback
 *
cb
, cÚ¡ *
feName
) {

281 
¡d
::
¡ršg
 
absFeName
;

282 
KfsCl›Á
 *
şÁ
 = KfsCl›Á::
	`In¡ªû
();

283 
»s
;

285 ià(
mV”bo£
) {

286 
	`HT_INFOF
("»movfe='%s'", 
feName
);

289 ià(
feName
[0] == '/')

290 
absFeName
 = 
feName
;

292 
absFeName
 = 
mRoÙdœ
 + "/" + 
feName
;

294 ià((
»s
 = 
şÁ
->
	`Remove
(
absFeName
.
	`c_¡r
())) < 0) {

295 
¡ršg
 
”rMsg
 = 
KFS
::
	`E¼ÜCodeToSŒ
(
»s
);

296 
	`HT_ERRORF
("uÆšk faed: fe='%s' - %s", 
absFeName
.
	`c_¡r
(), 
”rMsg
.c_str());

297 
	`R•ÜtE¼Ü
(
cb
, 
»s
);

301 
cb
->
	`»¥Ú£_ok
();

302 
	}
}

308 
	gKosmosBrok”
::
	$Ëngth
(
Re¥Ú£C®lbackL’gth
 *
cb
, cÚ¡ *
feName
) {

309 
¡d
::
¡ršg
 
absFeName
;

310 
ušt64_t
 
Ëngth
;

311 
»s
;

312 
KfsCl›Á
 *
şÁ
 = KfsCl›Á::
	`In¡ªû
();

313 
¡©
 
¡©Info
;

315 ià(
mV”bo£
) {

316 
	`HT_INFOF
("Ëngth fe='%s'", 
feName
);

319 ià(
feName
[0] == '/')

320 
absFeName
 = 
feName
;

322 
absFeName
 = 
mRoÙdœ
 + "/" + 
feName
;

324 ià((
»s
 = 
şÁ
->
	`St
(
absFeName
.
	`c_¡r
(), 
¡©Info
)) < 0) {

325 
¡ršg
 
”rMsg
 = 
KFS
::
	`E¼ÜCodeToSŒ
(
»s
);

326 
	`HT_ERRORF
("Ëngth (¡©èçed: fe='%s' - %s", 
absFeName
.
	`c_¡r
(), 
”rMsg
.c_str());

327 
	`R•ÜtE¼Ü
(
cb
, 
»s
);

330 
Ëngth
 = 
¡©Info
.
¡_size
;

331 
cb
->
	`»¥Ú£
(
Ëngth
);

332 
	}
}

338 
	gKosmosBrok”
::
	$´—d
(
Re¥Ú£C®lbackR—d
 *
cb
, 
ušt32_t
 
fd
, 
ušt64_t
 
off£t
, ušt32_ˆ
amouÁ
) {

339 
O³nFeD©aKosmosPŒ
 
d©aPŒ
;

340 
ssize_t
 
Ä—d
;

341 
ušt8_t
 *
buf
;

342 
KfsCl›Á
 *
şÁ
 = KfsCl›Á::
	`In¡ªû
();

344 ià(
mV”bo£
) {

345 
	`HT_INFOF
("´—d fd=%d off£t=%Îd‡mouÁ=%d", 
fd
, 
off£t
, 
amouÁ
);

348 
buf
 = 
Ãw
 
ušt8_t
 [ 
amouÁ
 ];

350 ià(!
m_İ’_fe_m­
.
	`g‘
(
fd
, 
d©aPŒ
)) {

351 
”rbuf
[32];

352 
	`¥rštf
(
”rbuf
, "%d", 
fd
);

353 
cb
->
	`”rÜ
(
E¼Ü
::
DFSBROKER_BAD_FILE_HANDLE
, 
”rbuf
);

357 ià((
off£t
 = (
ušt64_t
è
şÁ
->
	`S“k
(
d©aPŒ
->
fd
, off£t, 
SEEK_SET
)) == (uint64_t) -1) {

358 
¡ršg
 
”rMsg
 = 
KFS
::
	`E¼ÜCodeToSŒ
(
off£t
);

359 
	`HT_ERRORF
("l£ek faed: fd=%d off£t=%Îd - %s", 
d©aPŒ
->
fd
, 
off£t
, 
”rMsg
.
	`c_¡r
());

360 
	`R•ÜtE¼Ü
(
cb
, (è
off£t
);

364 ià((
Ä—d
 = 
şÁ
->
	`R—d
(
d©aPŒ
->
fd
, (*è
buf
, (
size_t
è
amouÁ
)) < 0) {

365 
¡ršg
 
”rMsg
 = 
KFS
::
	`E¼ÜCodeToSŒ
(
Ä—d
);

366 
	`HT_ERRORF
("»ad faed: fd=%d‡mouÁ=%d - %s", 
d©aPŒ
->
fd
, 
amouÁ
, 
”rMsg
.
	`c_¡r
());

367 
	`R•ÜtE¼Ü
(
cb
, 
Ä—d
);

371 
cb
->
	`»¥Ú£
(
off£t
, 
Ä—d
, 
buf
);

372 
	}
}

378 
	gKosmosBrok”
::
	$mkdœs
(
Re¥Ú£C®lback
 *
cb
, cÚ¡ *
dœName
) {

379 
¡d
::
¡ršg
 
absDœName
;

380 
¡d
::
¡ršg
::
size_ty³
 
cu¼
 = 0;

381 
KfsCl›Á
 *
şÁ
 = KfsCl›Á::
	`In¡ªû
();

382 
»s
 = 0;

383 
¡©
 
¡©Buf
;

385 ià(
mV”bo£
) {

386 
	`HT_INFOF
("mkdœ dœ='%s'", 
dœName
);

389 ià(
dœName
[0] == '/')

390 
absDœName
 = 
dœName
;

392 
absDœName
 = 
mRoÙdœ
 + "/" + 
dœName
;

394 
¡d
::
¡ršg
 
·th
;

395 
cu¼
 !ğ
¡d
::
¡ršg
::
Åos
) {

396 
cu¼
 = 
absDœName
.
	`fšd
('/', curr + 1);

397 ià(
cu¼
 !ğ
¡d
::
¡ršg
::
Åos
)

398 
·th
.
	`assign
(
absDœName
, 0, 
cu¼
);

400 
·th
 = 
absDœName
;

402 
¡d
::
û¼
 << "St'šg: " << 
·th
 << std::
’dl
;

404 ià(
şÁ
->
	`St
(
·th
.
	`c_¡r
(), 
¡©Buf
) == 0) {

405 ià(!
	`S_ISDIR
(
¡©Buf
.
¡_mode
)) {

406 
»s
 = -
ENOTDIR
;

411 
¡d
::
û¼
 << "Mkdœ'šg: " << 
·th
 << std::
’dl
;

413 
»s
 = 
şÁ
->
	`Mkdœ
(
·th
.
	`c_¡r
());

414 ià(
»s
 < 0)

418 ià(
»s
 < 0) {

419 
¡ršg
 
”rMsg
 = 
KFS
::
	`E¼ÜCodeToSŒ
(
»s
);

420 
	`HT_ERRORF
("mkdœ çed: dœName='%s' - %s", 
absDœName
.
	`c_¡r
(), 
”rMsg
.c_str());

421 
	`R•ÜtE¼Ü
(
cb
, 
»s
);

425 
cb
->
	`»¥Ú£_ok
();

426 
	}
}

432 
	gKosmosBrok”
::
	$rmdœ
(
Re¥Ú£C®lback
 *
cb
, cÚ¡ *
dœName
) {

433 
¡d
::
¡ršg
 
absDœName
;

434 
KfsCl›Á
 *
şÁ
 = KfsCl›Á::
	`In¡ªû
();

435 
»s
;

437 ià(
mV”bo£
) {

438 
	`HT_INFOF
("rmdœ dœ='%s'", 
dœName
);

441 ià(
dœName
[0] == '/')

442 
absDœName
 = 
dœName
;

444 
absDœName
 = 
mRoÙdœ
 + "/" + 
dœName
;

446 ià((
»s
 = 
şÁ
->
	`Rmdœs
(
absDœName
.
	`c_¡r
())) != 0) {

447 
¡ršg
 
”rMsg
 = 
KFS
::
	`E¼ÜCodeToSŒ
(
»s
);

448 
	`HT_ERRORF
("rmdœ faed: dœName='%s' - %s", 
absDœName
.
	`c_¡r
(), 
”rMsg
.c_str());

449 
	`R•ÜtE¼Ü
(
cb
, 
»s
);

453 
cb
->
	`»¥Ú£_ok
();

454 
	}
}

460 
	gKosmosBrok”
::
	$æush
(
Re¥Ú£C®lback
 *
cb
, 
ušt32_t
 
fd
) {

461 
O³nFeD©aKosmosPŒ
 
d©aPŒ
;

462 
KfsCl›Á
 *
şÁ
 = KfsCl›Á::
	`In¡ªû
();

463 
»s
;

465 ià(
mV”bo£
) {

466 
	`HT_INFOF
("æush fd=%d", 
fd
);

469 ià(!
m_İ’_fe_m­
.
	`g‘
(
fd
, 
d©aPŒ
)) {

470 
”rbuf
[32];

471 
	`¥rštf
(
”rbuf
, "%d", 
fd
);

472 
cb
->
	`”rÜ
(
E¼Ü
::
DFSBROKER_BAD_FILE_HANDLE
, 
”rbuf
);

476 ià((
»s
 = 
şÁ
->
	`Sync
(
d©aPŒ
->
fd
)) < 0) {

477 
¡ršg
 
”rMsg
 = 
KFS
::
	`E¼ÜCodeToSŒ
(
»s
);

478 
	`HT_ERRORF
("æush faed: fd=%d - %s", 
d©aPŒ
->
fd
, 
”rMsg
.
	`c_¡r
());

479 
	`R•ÜtE¼Ü
(
cb
, 
»s
);

483 
cb
->
	`»¥Ú£_ok
();

484 
	}
}

490 
	gKosmosBrok”
::
	$¡©us
(
Re¥Ú£C®lback
 *
cb
) {

491 
cb
->
	`»¥Ú£_ok
();

492 
	}
}

498 
	gKosmosBrok”
::
	$shutdown
(
Re¥Ú£C®lback
 *
cb
) {

499 
m_İ’_fe_m­
.
	`»move_®l
();

500 
cb
->
	`»¥Ú£_ok
();

501 
	`pŞl
(0, 0, 2000);

502 
	}
}

505 
	gKosmosBrok”
::
	$»addœ
(
Re¥Ú£C®lbackR—ddœ
 *
cb
, cÚ¡ *
dœName
) {

506 
¡d
::
veùÜ
<¡d::
¡ršg
> 
li¡šg
;

507 
¡d
::
veùÜ
<¡d::
¡ršg
> 
¡r³d_li¡šg
;

508 
¡d
::
¡ršg
 
abs_·th
;

509 
KfsCl›Á
 *
şÁ
 = KfsCl›Á::
	`In¡ªû
();

510 
”rÜ
;

512 ià(
mV”bo£
) {

513 
	`HT_INFOF
("»addœ dœ_Çme='%s'", 
dœName
);

516 ià(
dœName
[0] == '/')

517 
abs_·th
 = 
dœName
;

519 
abs_·th
 = 
mRoÙdœ
 + "/" + 
dœName
;

521 ià((
”rÜ
 = 
şÁ
->
	`R—ddœ
(
abs_·th
.
	`c_¡r
(), 
li¡šg
)) < 0) {

522 
¡ršg
 
”rMsg
 = 
KFS
::
	`E¼ÜCodeToSŒ
(
”rÜ
);

523 
	`HT_ERRORF
("»addœ faed: fe='%s' - %s", 
abs_·th
.
	`c_¡r
(), 
”rMsg
.c_str());

524 
	`R•ÜtE¼Ü
(
cb
, 
”rÜ
);

528 
size_t
 
i
=0;i<
li¡šg
.
	`size
(); i++) {

529 ià(
li¡šg
[
i
] == "." ||†isting[i] == "..")

531 
¡r³d_li¡šg
.
	`push_back
(
li¡šg
[
i
]);

534 
	`HT_INFOF
("S’dšg back %d†i¡šgs", 
¡r³d_li¡šg
.
	`size
());

536 
cb
->
	`»¥Ú£
(
¡r³d_li¡šg
);

537 
	}
}

543 
	gKosmosBrok”
::
	$R•ÜtE¼Ü
(
Re¥Ú£C®lback
 *
cb
, 
”rÜ
) {

545 
¡ršg
 
”rbuf
 = 
KFS
::
	`E¼ÜCodeToSŒ
(
”rÜ
);

547 ià(
”rÜ
 =ğ
ENOTDIR
 ||ƒ¼Ü =ğ
ENAMETOOLONG
 ||ƒ¼Ü =ğ
ENOENT
)

548 
cb
->
	`”rÜ
(
E¼Ü
::
DFSBROKER_BAD_FILENAME
, 
”rbuf
.
	`c_¡r
());

549 ià(
”rÜ
 =ğ
EACCES
 ||ƒ¼Ü =ğ
EPERM
)

550 
cb
->
	`”rÜ
(
E¼Ü
::
DFSBROKER_PERMISSION_DENIED
, 
”rbuf
.
	`c_¡r
());

551 ià(
”rÜ
 =ğ
EBADF
)

552 
cb
->
	`”rÜ
(
E¼Ü
::
DFSBROKER_BAD_FILE_HANDLE
, 
”rbuf
.
	`c_¡r
());

553 ià(
”rÜ
 =ğ
EINVAL
)

554 
cb
->
	`”rÜ
(
E¼Ü
::
DFSBROKER_INVALID_ARGUMENT
, 
”rbuf
.
	`c_¡r
());

556 
cb
->
	`”rÜ
(
E¼Ü
::
DFSBROKER_IO_ERROR
, 
”rbuf
.
	`c_¡r
());

557 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/kosmos/KosmosBroker.h

21 #iâdeà
HYPERTABLE_KFSBROKER_H


22 
	#HYPERTABLE_KFSBROKER_H


	)

24 
	~<¡ršg
>

27 
	~<uni¡d.h
>

30 
	~"CommÚ/©omic.h
"

31 
	~"CommÚ/Prİ”t›s.h
"

33 
	~"DfsBrok”/Lib/Brok”.h
"

35 
	~"kfs/KfsCl›Á.h
"

37 
usšg
 
Çme¥aû
 
Hy³¹abË
;

38 
usšg
 
Çme¥aû
 
	gHy³¹abË
::
DfsBrok”
;

40 
Çme¥aû
 
	gHy³¹abË
 {

45 şas 
	cO³nFeD©aKosmos
 : 
public
 
O³nFeD©a
 {

46 
public
:

47 
O³nFeD©aKosmos
(
_fd
, 
_æags
è: 
fd
(_fd), 
æags
(_flags) { ; }

48 
	gvœtu®
 ~
O³nFeD©aKosmos
() {

49 
	gKFS
::
KfsCl›Á
 *
şÁ
 = 
KFS
::KfsCl›Á::
In¡ªû
();

50 
	gşÁ
->
Clo£
(
fd
);

52 
	gfd
;

53 
	gæags
;

59 şas 
	cO³nFeD©aKosmosPŒ
 : 
public
 
O³nFeD©aPŒ
 {

60 
public
:

61 
O³nFeD©aKosmosPŒ
(è: 
O³nFeD©aPŒ
() { ; }

62 
O³nFeD©aKosmosPŒ
(
O³nFeD©aKosmos
 *
ofdl
è: 
O³nFeD©aPŒ
(ofdl, 
Œue
) { ; }

63 
O³nFeD©aKosmos
 *
	gİ”©Ü
->() const {

64  (
	gO³nFeD©aKosmos
 *)
g‘
();

72 şas 
	cKosmosBrok”
 : 
public
 
DfsBrok”
::
Brok”
 {

73 
public
:

74 
KosmosBrok”
(
Prİ”t›sPŒ
 &
´İsPŒ
);

75 
	gvœtu®
 ~
KosmosBrok”
();

77 
vœtu®
 
İ’
(
Re¥Ú£C®lbackO³n
 *
cb
, cÚ¡ *
feName
, 
ušt32_t
 
bufãrSize
);

78 
vœtu®
 
ü—‹
(
Re¥Ú£C®lbackO³n
 *
cb
, cÚ¡ *
feName
, 
boŞ
 
ov”wr™e
,

79 
ušt32_t
 
bufãrSize
, 
ušt16_t
 
»¶iÿtiÚ
, 
ušt64_t
 
blockSize
);

80 
vœtu®
 
şo£
(
Re¥Ú£C®lback
 *
cb
, 
ušt32_t
 
fd
);

81 
vœtu®
 
»ad
(
Re¥Ú£C®lbackR—d
 *
cb
, 
ušt32_t
 
fd
, ušt32_ˆ
amouÁ
);

82 
vœtu®
 
­³nd
(
Re¥Ú£C®lbackAµ’d
 *
cb
, 
ušt32_t
 
fd
, ušt32_ˆ
amouÁ
, 
ušt8_t
 *
d©a
);

83 
vœtu®
 
£ek
(
Re¥Ú£C®lback
 *
cb
, 
ušt32_t
 
fd
, 
ušt64_t
 
off£t
);

84 
vœtu®
 
»move
(
Re¥Ú£C®lback
 *
cb
, cÚ¡ *
feName
);

85 
vœtu®
 
Ëngth
(
Re¥Ú£C®lbackL’gth
 *
cb
, cÚ¡ *
feName
);

86 
vœtu®
 
´—d
(
Re¥Ú£C®lbackR—d
 *
cb
, 
ušt32_t
 
fd
, 
ušt64_t
 
off£t
, ušt32_ˆ
amouÁ
);

87 
vœtu®
 
mkdœs
(
Re¥Ú£C®lback
 *
cb
, cÚ¡ *
dœName
);

88 
vœtu®
 
rmdœ
(
Re¥Ú£C®lback
 *
cb
, cÚ¡ *
dœName
);

89 
vœtu®
 
æush
(
Re¥Ú£C®lback
 *
cb
, 
ušt32_t
 
fd
);

90 
vœtu®
 
¡©us
(
Re¥Ú£C®lback
 *
cb
);

91 
vœtu®
 
shutdown
(
Re¥Ú£C®lback
 *
cb
);

92 
vœtu®
 
»addœ
(
Re¥Ú£C®lbackR—ddœ
 *
cb
, cÚ¡ *
dœName
);

94 
	g´iv©e
:

96 
vœtu®
 
R•ÜtE¼Ü
(
Re¥Ú£C®lback
 *
cb
, 
”rÜ
);

98 
boŞ
 
	gmV”bo£
;

99 
	g¡d
::
¡ršg
 
mRoÙdœ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/kosmos/main.cc

21 
	~<io¡»am
>

22 
	~<f¡»am
>

23 
	~<¡ršg
>

26 
	~<pŞl.h
>

27 
	~<sys/ty³s.h
>

28 
	~<uni¡d.h
>

31 
	~"CommÚ/FeUts.h
"

32 
	~"CommÚ/Sy¡em.h
"

33 
	~"CommÚ/U§ge.h
"

35 
	~"AsyncComm/AµliÿtiÚQueue.h
"

36 
	~"AsyncComm/Comm.h
"

38 
	~"DfsBrok”/Lib/CÚÃùiÚHªdËrFaùÜy.h
"

40 
	~"KosmosBrok”.h
"

42 
usšg
 
Çme¥aû
 
Hy³¹abË
;

43 
usšg
 
Çme¥aû
 
	g¡d
;

45 
	gÇme¥aû
 {

46 cÚ¡ *
	gu§ge
[] = {

59 cÚ¡ 
	gDEFAULT_PORT
 = 38030;

60 cÚ¡ 
	gDEFAULT_WORKERS
 = 20;

68 
	$maš
(
¬gc
, **
¬gv
) {

69 
¡ršg
 
cÚfigFe
 = "";

70 
¡ršg
 
pidFe
 = "";

71 
Hy³¹abË
::
Prİ”t›sPŒ
 
´İsPŒ
;

72 
boŞ
 
v”bo£
 = 
çl£
;

73 
pÜt
, 
»aùÜCouÁ
, 
wÜk”CouÁ
;

74 
Comm
 *
comm
;

75 
Brok”PŒ
 
brok”_±r
;

76 
AµliÿtiÚQueuePŒ
 
­p_queue_±r
;

77 
sockaddr_š
 
li¡’_addr
;

78 
”rÜ
;

80 
Sy¡em
::
	`š™Ÿlize
(
¬gv
[0]);

82 ià(
¬gc
 > 1) {

83 
i
=1; i<
¬gc
; i++) {

84 ià(!
	`¡ºcmp
(
¬gv
[
i
], "--config=", 9))

85 
cÚfigFe
 = &
¬gv
[
i
][9];

86 ià(!
	`¡ºcmp
(
¬gv
[
i
], "--pidfile=", 10))

87 
pidFe
 = &
¬gv
[
i
][10];

88 ià(!
	`¡rcmp
(
¬gv
[
i
], "--verbose") || !strcmp(argv[i], "-v"))

89 
v”bo£
 = 
Œue
;

91 
U§ge
::
	`dump_ªd_ex™
(
u§ge
);

95 ià(
cÚfigFe
 == "")

96 
cÚfigFe
 = 
Sy¡em
::
š¡®lDœ
 + "/conf/hypertable.cfg";

98 ià(!
FeUts
::
	`exi¡s
(
cÚfigFe
.
	`c_¡r
())) {

99 
û¼
 << "E¼Ü: UÇbËØİ’ cÚfig f'" << 
cÚfigFe
 << "'" << 
’dl
;

100 
	`ex™
(0);

103 
´İsPŒ
 = 
Ãw
 
Hy³¹abË
::
	`Prİ”t›s
(
cÚfigFe
);

104 ià(
v”bo£
)

105 
´İsPŒ
->
	`£t
("Hypertable.Verbose", "true");

107 
pÜt
 = 
´İsPŒ
->
	`g‘_št
("DfsBrok”.PÜt", 
DEFAULT_PORT
);

108 
wÜk”CouÁ
 = 
´İsPŒ
->
	`g‘_št
("DfsBrok”.WÜk”s", 
DEFAULT_WORKERS
);

109 
»aùÜCouÁ
 = 
´İsPŒ
->
	`g‘_št
("Kfs.R—ùÜs", 
Sy¡em
::
	`g‘_´oûssÜ_couÁ
());

111 
R—ùÜFaùÜy
::
	`š™Ÿlize
(
»aùÜCouÁ
);

113 
comm
 = 
Ãw
 
	`Comm
();

115 ià(
v”bo£
) {

116 
cout
 << "CPU couÁ = " << 
Sy¡em
::
	`g‘_´oûssÜ_couÁ
(è<< 
’dl
;

117 
cout
 << "DfsBrok”.PÜt=" << 
pÜt
 << 
’dl
;

118 
cout
 << "DfsBrok”.WÜk”s=" << 
wÜk”CouÁ
 << 
’dl
;

119 
cout
 << "Kfs.»aùÜs=" << 
»aùÜCouÁ
 << 
’dl
;

122 
IÃtAddr
::
	`š™Ÿlize
(&
li¡’_addr
, 
INADDR_ANY
, 
pÜt
);

124 
brok”_±r
 = 
Ãw
 
	`KosmosBrok”
(
´İsPŒ
);

125 
­p_queue_±r
 = 
Ãw
 
	`AµliÿtiÚQueue
(
wÜk”CouÁ
);

126 
CÚÃùiÚHªdËrFaùÜyPŒ
 
	`chf_±r
(
Ãw
 
DfsBrok”
::
	`CÚÃùiÚHªdËrFaùÜy
(
comm
, 
­p_queue_±r
, 
brok”_±r
));

127 ià((
”rÜ
 = 
comm
->
	`li¡’
(
li¡’_addr
, 
chf_±r
)è!ğ
E¼Ü
::
OK
) {

128 
¡d
::
¡ršg
 
addrSŒ
;

129 
	`HT_ERRORF
("ProbËm†i¡’šg fÜ cÚÃùiÚ Ú % - %s", 
IÃtAddr
::
	`¡ršg_fÜm©
(
addrSŒ
, 
li¡’_addr
), 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

133 ià(
pidFe
 != "") {

134 
f¡»am
 
	`fe¡r
 (
pidFe
.
	`c_¡r
(), f¡»am::
out
);

135 
fe¡r
 << 
	`g‘pid
(è<< 
’dl
;

136 
fe¡r
.
	`şo£
();

139 
­p_queue_±r
->
	`još
();

141 
d–‘e
 
comm
;

143 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/local/LocalBroker.cc

21 
	~<û¼no
>

22 
	~<c¡dlib
>

23 
	~<c¡ršg
>

24 
	~<¡ršg
>

25 
	~<veùÜ
>

28 
	~<dœ’t.h
>

29 
	~<fú.h
>

30 
	~<lim™s.h
>

31 
	~<pŞl.h
>

32 
	~<sys/ty³s.h
>

33 
	~<sys/uio.h
>

34 
	~<uni¡d.h
>

37 
	~"CommÚ/FeUts.h
"

38 
	~"CommÚ/Sy¡em.h
"

40 
	~"LoÿlBrok”.h
"

42 
usšg
 
Çme¥aû
 
Hy³¹abË
;

45 
	gLoÿlBrok”
::
	$LoÿlBrok”
(
Prİ”t›sPŒ
 &
´İsPŒ
è: 
	$m_v”bo£
(
çl£
) {

46 cÚ¡ *
roÙ
;

48 
m_v”bo£
 = 
´İsPŒ
->
	`g‘_boŞ
("Hy³¹abË.V”bo£", 
çl£
);

53 ià((
roÙ
 = 
´İsPŒ
->
	`g‘
("DfsBroker.Local.Root", 0)) == 0) {

54 
	`HT_ERROR
("Required…roperty 'DfsBroker.Local.Root'‚ot specified,ƒxiting...");

55 
	`ex™
(1);

58 
m_roÙdœ
 = (
roÙ
[0] =ğ'/'è?„oÙ : 
Sy¡em
::
š¡®lDœ
 + "/" +„oot;

61 ià(
roÙ
[
	`¡¾’
(root)-1] == '/')

62 
m_roÙdœ
 = m_roÙdœ.
	`sub¡r
(0, m_roÙdœ.
	`Ëngth
()-1);

65 ià(!
FeUts
::
	`mkdœs
(
m_roÙdœ
.
	`c_¡r
()))

66 
	`ex™
(1);

67 
	}
}

71 
	gLoÿlBrok”
::~
	$LoÿlBrok”
() {

72 
	}
}

78 
LoÿlBrok”
::
	$İ’
(
Re¥Ú£C®lbackO³n
 *
cb
, cÚ¡ *
feName
, 
ušt32_t
 
bufãrSize
) {

79 
fd
;

80 
¡d
::
¡ršg
 
absFeName
;

82 ià(
m_v”bo£
) {

83 
	`HT_INFOF
("İ’ fe='%s' bufãrSize=%d", 
feName
, 
bufãrSize
);

86 ià(
feName
[0] == '/')

87 
absFeName
 = 
m_roÙdœ
 + 
feName
;

89 
absFeName
 = 
m_roÙdœ
 + "/" + 
feName
;

96 ià((
fd
 = ::
	`İ’
(
absFeName
.
	`c_¡r
(), 
O_RDONLY
)) == -1) {

97 
	`HT_ERRORF
("İ’ faed: fe='%s' - %s", 
absFeName
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

98 
	`»pÜt_”rÜ
(
cb
);

103 
sockaddr_š
 
addr
;

104 
O³nFeD©aLoÿlPŒ
 
	`d©aPŒ
(
Ãw
 
	`O³nFeD©aLoÿl
(
fd
, 
O_RDONLY
));

106 
cb
->
	`g‘_add»ss
(
addr
);

108 
m_İ’_fe_m­
.
	`ü—‹
(
fd
, 
addr
, 
d©aPŒ
);

110 
cb
->
	`»¥Ú£
(
fd
);

112 
	}
}

118 
	gLoÿlBrok”
::
	$ü—‹
(
Re¥Ú£C®lbackO³n
 *
cb
, cÚ¡ *
feName
, 
boŞ
 
ov”wr™e
,

119 
ušt32_t
 
bufãrSize
, 
ušt16_t
 
»¶iÿtiÚ
, 
ušt64_t
 
blockSize
) {

120 
fd
;

121 
æags
;

122 
¡d
::
¡ršg
 
absFeName
;

124 ià(
m_v”bo£
) {

125 
	`HT_INFOF
("create file='%s' overwrite=%d bufferSize=%d„eplication=%d blockSize=%d",

126 
feName
, ()
ov”wr™e
, 
bufãrSize
, 
»¶iÿtiÚ
, 
blockSize
);

129 ià(
feName
[0] == '/')

130 
absFeName
 = 
m_roÙdœ
 + 
feName
;

132 
absFeName
 = 
m_roÙdœ
 + "/" + 
feName
;

136 ià(
ov”wr™e
)

137 
æags
 = 
O_WRONLY
 | 
O_CREAT
 | 
O_TRUNC
;

139 
æags
 = 
O_WRONLY
 | 
O_CREAT
 | 
O_APPEND
;

144 ià((
fd
 = ::
	`İ’
(
absFeName
.
	`c_¡r
(), 
æags
, 0644)) == -1) {

145 
	`HT_ERRORF
("İ’ faed: fe='%s' - %s", 
absFeName
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

146 
	`»pÜt_”rÜ
(
cb
);

151 
sockaddr_š
 
addr
;

152 
O³nFeD©aLoÿlPŒ
 
	`d©aPŒ
(
Ãw
 
	`O³nFeD©aLoÿl
(
fd
, 
O_WRONLY
));

154 
cb
->
	`g‘_add»ss
(
addr
);

156 
m_İ’_fe_m­
.
	`ü—‹
(
fd
, 
addr
, 
d©aPŒ
);

158 
cb
->
	`»¥Ú£
(
fd
);

160 
	}
}

166 
	gLoÿlBrok”
::
	$şo£
(
Re¥Ú£C®lback
 *
cb
, 
ušt32_t
 
fd
) {

167 ià(
m_v”bo£
) {

168 
	`HT_INFOF
("şo£ fd=%d", 
fd
);

170 ::
	`şo£
(
fd
);

171 
m_İ’_fe_m­
.
	`»move
(
fd
);

172 
cb
->
	`»¥Ú£_ok
();

173 
	}
}

179 
	gLoÿlBrok”
::
	$»ad
(
Re¥Ú£C®lbackR—d
 *
cb
, 
ušt32_t
 
fd
, ušt32_ˆ
amouÁ
) {

180 
O³nFeD©aLoÿlPŒ
 
d©aPŒ
;

181 
ssize_t
 
Ä—d
;

182 
ušt64_t
 
off£t
;

183 
ušt8_t
 *
buf
;

185 ià(
m_v”bo£
) {

186 
	`HT_INFOF
("»ad fd=%d‡mouÁ=%d", 
fd
, 
amouÁ
);

189 
buf
 = 
Ãw
 
ušt8_t
 [ 
amouÁ
 ];

191 ià(!
m_İ’_fe_m­
.
	`g‘
(
fd
, 
d©aPŒ
)) {

192 
”rbuf
[32];

193 
	`¥rštf
(
”rbuf
, "%d", 
fd
);

194 
cb
->
	`”rÜ
(
E¼Ü
::
DFSBROKER_BAD_FILE_HANDLE
, 
”rbuf
);

198 ià((
off£t
 = (
ušt64_t
)
	`l£ek
(
d©aPŒ
->
fd
, 0, 
SEEK_CUR
)) == (uint64_t)-1) {

199 
	`HT_ERRORF
("l£ek faed: fd=%d off£t=0 SEEK_CUR - %s", 
d©aPŒ
->
fd
, 
	`¡»¼Ü
(
”ºo
));

200 
	`»pÜt_”rÜ
(
cb
);

204 ià((
Ä—d
 = 
FeUts
::
	`»ad
(
d©aPŒ
->
fd
, 
buf
, 
amouÁ
)) == -1) {

205 
	`HT_ERRORF
("»ad faed: fd=%d‡mouÁ=%d - %s", 
d©aPŒ
->
fd
, 
amouÁ
, 
	`¡»¼Ü
(
”ºo
));

206 
	`»pÜt_”rÜ
(
cb
);

210 
cb
->
	`»¥Ú£
(
off£t
, 
Ä—d
, 
buf
);

212 
	}
}

218 
	gLoÿlBrok”
::
	$­³nd
(
Re¥Ú£C®lbackAµ’d
 *
cb
, 
ušt32_t
 
fd
, ušt32_ˆ
amouÁ
, 
ušt8_t
 *
d©a
) {

219 
O³nFeD©aLoÿlPŒ
 
d©aPŒ
;

220 
ssize_t
 
nwr™‹n
;

221 
ušt64_t
 
off£t
;

223 ià(
m_v”bo£
) {

224 
	`HT_INFOF
("­³nd fd=%d‡mouÁ=%d", 
fd
, 
amouÁ
);

227 ià(!
m_İ’_fe_m­
.
	`g‘
(
fd
, 
d©aPŒ
)) {

228 
”rbuf
[32];

229 
	`¥rštf
(
”rbuf
, "%d", 
fd
);

230 
cb
->
	`”rÜ
(
E¼Ü
::
DFSBROKER_BAD_FILE_HANDLE
, 
”rbuf
);

234 ià((
off£t
 = (
ušt64_t
)
	`l£ek
(
d©aPŒ
->
fd
, 0, 
SEEK_CUR
)) == (uint64_t)-1) {

235 
	`HT_ERRORF
("l£ek faed: fd=%d off£t=0 SEEK_CUR - %s", 
d©aPŒ
->
fd
, 
	`¡»¼Ü
(
”ºo
));

236 
	`»pÜt_”rÜ
(
cb
);

240 ià((
nwr™‹n
 = 
FeUts
::
	`wr™e
(
d©aPŒ
->
fd
, 
d©a
, 
amouÁ
)) == -1) {

241 
	`HT_ERRORF
("wr™çed: fd=%d‡mouÁ=%d - %s", 
d©aPŒ
->
fd
, 
amouÁ
, 
	`¡»¼Ü
(
”ºo
));

242 
	`»pÜt_”rÜ
(
cb
);

246 
cb
->
	`»¥Ú£
(
off£t
, 
nwr™‹n
);

249 
	}
}

255 
	gLoÿlBrok”
::
	$£ek
(
Re¥Ú£C®lback
 *
cb
, 
ušt32_t
 
fd
, 
ušt64_t
 
off£t
) {

256 
O³nFeD©aLoÿlPŒ
 
d©aPŒ
;

258 ià(!
m_İ’_fe_m­
.
	`g‘
(
fd
, 
d©aPŒ
)) {

259 
”rbuf
[32];

260 
	`¥rštf
(
”rbuf
, "%d", 
fd
);

261 
cb
->
	`”rÜ
(
E¼Ü
::
DFSBROKER_BAD_FILE_HANDLE
, 
”rbuf
);

265 ià((
off£t
 = (
ušt64_t
)
	`l£ek
(
d©aPŒ
->
fd
, off£t, 
SEEK_SET
)) == (uint64_t)-1) {

266 
	`HT_ERRORF
("l£ek faed: fd=%d off£t=%Îd - %s", 
d©aPŒ
->
fd
, 
off£t
, 
	`¡»¼Ü
(
”ºo
));

267 
	`»pÜt_”rÜ
(
cb
);

271 
cb
->
	`»¥Ú£_ok
();

272 
	}
}

278 
	gLoÿlBrok”
::
	$»move
(
Re¥Ú£C®lback
 *
cb
, cÚ¡ *
feName
) {

279 
¡d
::
¡ršg
 
absFeName
;

281 ià(
m_v”bo£
) {

282 
	`HT_INFOF
("»movfe='%s'", 
feName
);

285 ià(
feName
[0] == '/')

286 
absFeName
 = 
m_roÙdœ
 + 
feName
;

288 
absFeName
 = 
m_roÙdœ
 + "/" + 
feName
;

290 ià(
	`uÆšk
(
absFeName
.
	`c_¡r
()) == -1) {

291 
	`HT_ERRORF
("uÆšk faed: fe='%s' - %s", 
absFeName
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

292 
	`»pÜt_”rÜ
(
cb
);

296 
cb
->
	`»¥Ú£_ok
();

297 
	}
}

303 
	gLoÿlBrok”
::
	$Ëngth
(
Re¥Ú£C®lbackL’gth
 *
cb
, cÚ¡ *
feName
) {

304 
¡d
::
¡ršg
 
absFeName
;

305 
ušt64_t
 
Ëngth
;

307 ià(
m_v”bo£
) {

308 
	`HT_INFOF
("Ëngth fe='%s'", 
feName
);

311 ià(
feName
[0] == '/')

312 
absFeName
 = 
m_roÙdœ
 + 
feName
;

314 
absFeName
 = 
m_roÙdœ
 + "/" + 
feName
;

316 ià((
Ëngth
 = 
FeUts
::
	`Ëngth
(
absFeName
.
	`c_¡r
())è=ğ(
ušt64_t
)-1) {

317 
	`HT_ERRORF
("Ëngth (¡©èçed: fe='%s' - %s", 
absFeName
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

318 
	`»pÜt_”rÜ
(
cb
);

322 
cb
->
	`»¥Ú£
(
Ëngth
);

323 
	}
}

329 
	gLoÿlBrok”
::
	$´—d
(
Re¥Ú£C®lbackR—d
 *
cb
, 
ušt32_t
 
fd
, 
ušt64_t
 
off£t
, ušt32_ˆ
amouÁ
) {

330 
O³nFeD©aLoÿlPŒ
 
d©aPŒ
;

331 
ssize_t
 
Ä—d
;

332 
ušt8_t
 *
buf
;

334 ià(
m_v”bo£
) {

335 
	`HT_INFOF
("´—d fd=%d off£t=%Îd‡mouÁ=%d", 
fd
, 
off£t
, 
amouÁ
);

338 
buf
 = 
Ãw
 
ušt8_t
 [ 
amouÁ
 ];

340 ià(!
m_İ’_fe_m­
.
	`g‘
(
fd
, 
d©aPŒ
)) {

341 
”rbuf
[32];

342 
	`¥rštf
(
”rbuf
, "%d", 
fd
);

343 
cb
->
	`”rÜ
(
E¼Ü
::
DFSBROKER_BAD_FILE_HANDLE
, 
”rbuf
);

347 ià((
Ä—d
 = 
FeUts
::
	`´—d
(
d©aPŒ
->
fd
, 
buf
, 
amouÁ
, (
off_t
)
off£t
)) == -1) {

348 
	`HT_ERRORF
("´—d faed: fd=%d‡mouÁ=%d off£t=%Îd - %s", 
d©aPŒ
->
fd
, 
amouÁ
, 
off£t
, 
	`¡»¼Ü
(
”ºo
));

349 
	`»pÜt_”rÜ
(
cb
);

353 
cb
->
	`»¥Ú£
(
off£t
, 
Ä—d
, 
buf
);

354 
	}
}

360 
	gLoÿlBrok”
::
	$mkdœs
(
Re¥Ú£C®lback
 *
cb
, cÚ¡ *
dœName
) {

361 
¡d
::
¡ršg
 
absDœName
;

363 ià(
m_v”bo£
) {

364 
	`HT_INFOF
("mkdœ dœ='%s'", 
dœName
);

367 ià(
dœName
[0] == '/')

368 
absDœName
 = 
m_roÙdœ
 + 
dœName
;

370 
absDœName
 = 
m_roÙdœ
 + "/" + 
dœName
;

372 ià(!
FeUts
::
	`mkdœs
(
absDœName
.
	`c_¡r
())) {

373 
	`HT_ERRORF
("mkdœ çed: dœName='%s' - %s", 
absDœName
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

374 
	`»pÜt_”rÜ
(
cb
);

378 
cb
->
	`»¥Ú£_ok
();

379 
	}
}

385 
	gLoÿlBrok”
::
	$rmdœ
(
Re¥Ú£C®lback
 *
cb
, cÚ¡ *
dœName
) {

386 
¡d
::
¡ršg
 
absDœName
;

387 
¡d
::
¡ršg
 
commªdSŒ
;

389 ià(
m_v”bo£
) {

390 
	`HT_INFOF
("rmdœ dœ='%s'", 
dœName
);

393 ià(
dœName
[0] == '/')

394 
absDœName
 = 
m_roÙdœ
 + 
dœName
;

396 
absDœName
 = 
m_roÙdœ
 + "/" + 
dœName
;

398 
commªdSŒ
 = (
¡d
::
¡ršg
)"/bš/rm -rà" + 
absDœName
;

399 ià(
	`sy¡em
(
commªdSŒ
.
	`c_¡r
()) != 0) {

400 
	`HT_ERRORF
("% çed.", 
commªdSŒ
.
	`c_¡r
());

401 
cb
->
	`”rÜ
(
E¼Ü
::
DFSBROKER_IO_ERROR
, 
commªdSŒ
);

406 ià(
	`rmdœ
(
absDœName
.
	`c_¡r
()) != 0) {

407 
	`HT_ERRORF
("rmdœ faed: dœName='%s' - %s", 
absDœName
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

408 
	`»pÜt_”rÜ
(
cb
);

413 
cb
->
	`»¥Ú£_ok
();

414 
	}
}

419 
	gLoÿlBrok”
::
	$»addœ
(
Re¥Ú£C®lbackR—ddœ
 *
cb
, cÚ¡ *
dœName
) {

420 
¡d
::
veùÜ
<¡d::
¡ršg
> 
li¡šg
;

422 
	`R—ddœ
(cÚ¡ *
·thÇme
, 
¡d
::
veùÜ
<¡d::
¡ršg
> &
»suÉ
);

425 
¡d
::
¡ršg
 
absDœName
;

427 ià(
m_v”bo£
) {

428 
	`HT_INFOF
("R—ddœ dœ='%s'", 
dœName
);

429 
cout
 << 
¡d
::
æush
;

432 ià(
dœName
[0] == '/')

433 
absDœName
 = 
m_roÙdœ
 + 
dœName
;

435 
absDœName
 = 
m_roÙdœ
 + "/" + 
dœName
;

437 
DIR
 *
dœp
 = 
	`İ’dœ
(
absDœName
.
	`c_¡r
());

438 ià(
dœp
 == 0) {

439 
	`HT_ERRORF
("İ’dœ('%s'èçed - %s", 
absDœName
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

440 
	`»pÜt_”rÜ
(
cb
);

444 
dœ’t
 
d’t
;

445 
dœ’t
 *
dp
;

447 ià(
	`»addœ_r
(
dœp
, &
d’t
, &
dp
) != 0) {

448 
	`HT_ERRORF
("»addœ('%s'èçed - %s", 
absDœName
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

449 ()
	`şo£dœ
(
dœp
);

450 
	`»pÜt_”rÜ
(
cb
);

454 
dp
 != 0) {

456 ià(
dp
->
d_Çme
[0] != '.' && dp->d_name[0] != 0)

457 
li¡šg
.
	`push_back
((
¡d
::
¡ršg
)
dp
->
d_Çme
);

459 ià(
	`»addœ_r
(
dœp
, &
d’t
, &
dp
) != 0) {

460 
	`HT_ERRORF
("»addœ('%s'èçed - %s", 
absDœName
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

461 
	`»pÜt_”rÜ
(
cb
);

465 ()
	`şo£dœ
(
dœp
);

467 
	`HT_INFOF
("S’dšg back %d†i¡šgs", 
li¡šg
.
	`size
());

468 
cout
 << 
¡d
::
æush
;

470 
cb
->
	`»¥Ú£
(
li¡šg
);

471 
	}
}

477 
	gLoÿlBrok”
::
	$æush
(
Re¥Ú£C®lback
 *
cb
, 
ušt32_t
 
fd
) {

478 
O³nFeD©aLoÿlPŒ
 
d©aPŒ
;

480 ià(
m_v”bo£
) {

481 
	`HT_INFOF
("æush fd=%d", 
fd
);

484 ià(!
m_İ’_fe_m­
.
	`g‘
(
fd
, 
d©aPŒ
)) {

485 
”rbuf
[32];

486 
	`¥rštf
(
”rbuf
, "%d", 
fd
);

487 
cb
->
	`”rÜ
(
E¼Ü
::
DFSBROKER_BAD_FILE_HANDLE
, 
”rbuf
);

491 ià(
	`fsync
(
d©aPŒ
->
fd
) != 0) {

492 
	`HT_ERRORF
("æush faed: fd=%d - %s", 
d©aPŒ
->
fd
, 
	`¡»¼Ü
(
”ºo
));

493 
	`»pÜt_”rÜ
(
cb
);

497 
cb
->
	`»¥Ú£_ok
();

498 
	}
}

504 
	gLoÿlBrok”
::
	$¡©us
(
Re¥Ú£C®lback
 *
cb
) {

505 
cb
->
	`»¥Ú£_ok
();

506 
	}
}

512 
	gLoÿlBrok”
::
	$shutdown
(
Re¥Ú£C®lback
 *
cb
) {

513 
m_İ’_fe_m­
.
	`»move_®l
();

514 
cb
->
	`»¥Ú£_ok
();

515 
	`pŞl
(0, 0, 2000);

516 
	}
}

522 
	gLoÿlBrok”
::
	$»pÜt_”rÜ
(
Re¥Ú£C®lback
 *
cb
) {

523 
”rbuf
[128];

524 
”rbuf
[0] = 0;

525 
	`¡»¼Ü_r
(
”ºo
, 
”rbuf
, 128);

526 ià(
”ºo
 =ğ
ENOTDIR
 ||ƒ¼nØ=ğ
ENAMETOOLONG
 ||ƒ¼nØ=ğ
ENOENT
)

527 
cb
->
	`”rÜ
(
E¼Ü
::
DFSBROKER_BAD_FILENAME
, 
”rbuf
);

528 ià(
”ºo
 =ğ
EACCES
 ||ƒ¼nØ=ğ
EPERM
)

529 
cb
->
	`”rÜ
(
E¼Ü
::
DFSBROKER_PERMISSION_DENIED
, 
”rbuf
);

530 ià(
”ºo
 =ğ
EBADF
)

531 
cb
->
	`”rÜ
(
E¼Ü
::
DFSBROKER_BAD_FILE_HANDLE
, 
”rbuf
);

532 ià(
”ºo
 =ğ
EINVAL
)

533 
cb
->
	`”rÜ
(
E¼Ü
::
DFSBROKER_INVALID_ARGUMENT
, 
”rbuf
);

535 
cb
->
	`”rÜ
(
E¼Ü
::
DFSBROKER_IO_ERROR
, 
”rbuf
);

536 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/local/LocalBroker.h

21 #iâdeà
HYPERTABLE_LOCALBROKER_H


22 
	#HYPERTABLE_LOCALBROKER_H


	)

24 
	~<¡ršg
>

27 
	~<uni¡d.h
>

30 
	~"CommÚ/©omic.h
"

31 
	~"CommÚ/Prİ”t›s.h
"

33 
	~"DfsBrok”/Lib/Brok”.h
"

35 
usšg
 
Çme¥aû
 
Hy³¹abË
;

36 
usšg
 
Çme¥aû
 
	gHy³¹abË
::
DfsBrok”
;

38 
Çme¥aû
 
	gHy³¹abË
 {

43 şas 
	cO³nFeD©aLoÿl
 : 
public
 
O³nFeD©a
 {

44 
public
:

45 
O³nFeD©aLoÿl
(
_fd
, 
_æags
è: 
fd
(_fd), 
æags
(_flags) { ; }

46 
	gvœtu®
 ~
O³nFeD©aLoÿl
(è{ 
şo£
(
fd
); }

47 
	gfd
;

48 
	gæags
;

54 şas 
	cO³nFeD©aLoÿlPŒ
 : 
public
 
O³nFeD©aPŒ
 {

55 
public
:

56 
O³nFeD©aLoÿlPŒ
(è: 
O³nFeD©aPŒ
() { ; }

57 
O³nFeD©aLoÿlPŒ
(
O³nFeD©aLoÿl
 *
ofdl
è: 
O³nFeD©aPŒ
(ofdl, 
Œue
) { ; }

58 
O³nFeD©aLoÿl
 *
	gİ”©Ü
->() const {

59  (
	gO³nFeD©aLoÿl
 *)
g‘
();

67 şas 
	cLoÿlBrok”
 : 
public
 
DfsBrok”
::
Brok”
 {

68 
public
:

69 
LoÿlBrok”
(
Prİ”t›sPŒ
 &
´İsPŒ
);

70 
	gvœtu®
 ~
LoÿlBrok”
();

72 
vœtu®
 
İ’
(
Re¥Ú£C®lbackO³n
 *
cb
, cÚ¡ *
feName
, 
ušt32_t
 
bufãrSize
);

73 
vœtu®
 
ü—‹
(
Re¥Ú£C®lbackO³n
 *
cb
, cÚ¡ *
feName
, 
boŞ
 
ov”wr™e
,

74 
ušt32_t
 
bufãrSize
, 
ušt16_t
 
»¶iÿtiÚ
, 
ušt64_t
 
blockSize
);

75 
vœtu®
 
şo£
(
Re¥Ú£C®lback
 *
cb
, 
ušt32_t
 
fd
);

76 
vœtu®
 
»ad
(
Re¥Ú£C®lbackR—d
 *
cb
, 
ušt32_t
 
fd
, ušt32_ˆ
amouÁ
);

77 
vœtu®
 
­³nd
(
Re¥Ú£C®lbackAµ’d
 *
cb
, 
ušt32_t
 
fd
, ušt32_ˆ
amouÁ
, 
ušt8_t
 *
d©a
);

78 
vœtu®
 
£ek
(
Re¥Ú£C®lback
 *
cb
, 
ušt32_t
 
fd
, 
ušt64_t
 
off£t
);

79 
vœtu®
 
»move
(
Re¥Ú£C®lback
 *
cb
, cÚ¡ *
feName
);

80 
vœtu®
 
Ëngth
(
Re¥Ú£C®lbackL’gth
 *
cb
, cÚ¡ *
feName
);

81 
vœtu®
 
´—d
(
Re¥Ú£C®lbackR—d
 *
cb
, 
ušt32_t
 
fd
, 
ušt64_t
 
off£t
, ušt32_ˆ
amouÁ
);

82 
vœtu®
 
mkdœs
(
Re¥Ú£C®lback
 *
cb
, cÚ¡ *
dœName
);

83 
vœtu®
 
rmdœ
(
Re¥Ú£C®lback
 *
cb
, cÚ¡ *
dœName
);

84 
vœtu®
 
»addœ
(
Re¥Ú£C®lbackR—ddœ
 *
cb
, cÚ¡ *
dœName
);

85 
vœtu®
 
æush
(
Re¥Ú£C®lback
 *
cb
, 
ušt32_t
 
fd
);

86 
vœtu®
 
¡©us
(
Re¥Ú£C®lback
 *
cb
);

87 
vœtu®
 
shutdown
(
Re¥Ú£C®lback
 *
cb
);

89 
	g´iv©e
:

91 
vœtu®
 
»pÜt_”rÜ
(
Re¥Ú£C®lback
 *
cb
);

93 
boŞ
 
	gm_v”bo£
;

94 
	g¡d
::
¡ršg
 
m_roÙdœ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/local/main.cc

21 
	~<c¡dlib
>

22 
	~<io¡»am
>

23 
	~<f¡»am
>

24 
	~<¡ršg
>

27 
	~<pŞl.h
>

28 
	~<sys/ty³s.h
>

29 
	~<uni¡d.h
>

32 
	~"CommÚ/E¼Ü.h
"

33 
	~"CommÚ/FeUts.h
"

34 
	~"CommÚ/IÃtAddr.h
"

35 
	~"CommÚ/Sy¡em.h
"

36 
	~"CommÚ/U§ge.h
"

38 
	~"AsyncComm/AµliÿtiÚQueue.h
"

39 
	~"AsyncComm/Comm.h
"

41 
	~"DfsBrok”/Lib/CÚÃùiÚHªdËrFaùÜy.h
"

43 
	~"LoÿlBrok”.h
"

45 
usšg
 
Çme¥aû
 
Hy³¹abË
;

46 
usšg
 
Çme¥aû
 
	g¡d
;

48 
	gÇme¥aû
 {

49 cÚ¡ *
	gu§ge
[] = {

64 cÚ¡ 
	gDEFAULT_PORT
 = 38030;

65 cÚ¡ 
	gDEFAULT_WORKERS
 = 20;

73 
	$maš
(
¬gc
, **
¬gv
) {

74 
¡ršg
 
cÚfigFe
 = "";

75 
¡ršg
 
pidFe
 = "";

76 
Prİ”t›sPŒ
 
´İs_±r
;

77 
boŞ
 
v”bo£
 = 
çl£
;

78 
»aùÜCouÁ
, 
wÜk”CouÁ
;

79 
ušt16_t
 
pÜt
 = 0;

80 
Comm
 *
comm
;

81 
Brok”PŒ
 
brok”PŒ
;

82 
AµliÿtiÚQueuePŒ
 
­pQueuePŒ
;

83 
sockaddr_š
 
li¡’Addr
;

84 
”rÜ
;

86 
Sy¡em
::
	`š™Ÿlize
(
¬gv
[0]);

88 ià(
¬gc
 > 1) {

89 
i
=1; i<
¬gc
; i++) {

90 ià(!
	`¡ºcmp
(
¬gv
[
i
], "--config=", 9))

91 
cÚfigFe
 = &
¬gv
[
i
][9];

92 ià(!
	`¡ºcmp
(
¬gv
[
i
], "--listen-port=", 14))

93 
pÜt
 = (
ušt16_t
)
	`©oi
(&
¬gv
[
i
][14]);

94 ià(!
	`¡ºcmp
(
¬gv
[
i
], "--pidfile=", 10))

95 
pidFe
 = &
¬gv
[
i
][10];

96 ià(!
	`¡rcmp
(
¬gv
[
i
], "--verbose") || !strcmp(argv[i], "-v"))

97 
v”bo£
 = 
Œue
;

99 
U§ge
::
	`dump_ªd_ex™
(
u§ge
);

103 ià(
cÚfigFe
 == "")

104 
cÚfigFe
 = 
Sy¡em
::
š¡®lDœ
 + "/conf/hypertable.cfg";

106 ià(!
FeUts
::
	`exi¡s
(
cÚfigFe
.
	`c_¡r
())) {

107 
û¼
 << "E¼Ü: UÇbËØİ’ cÚfig f'" << 
cÚfigFe
 << "'" << 
’dl
;

108 
	`ex™
(0);

111 
´İs_±r
 = 
Ãw
 
	`Prİ”t›s
(
cÚfigFe
);

112 ià(
v”bo£
)

113 
´İs_±r
->
	`£t
("verbose", "true");

115 ià(
pÜt
 == 0)

116 
pÜt
 = 
´İs_±r
->
	`g‘_št
("DfsBrok”.Loÿl.PÜt", 
DEFAULT_PORT
);

117 
»aùÜCouÁ
 = 
´İs_±r
->
	`g‘_št
("DfsBrok”.Loÿl.R—ùÜs", 
Sy¡em
::
	`g‘_´oûssÜ_couÁ
());

118 
wÜk”CouÁ
 = 
´İs_±r
->
	`g‘_št
("DfsBrok”.Loÿl.WÜk”s", 
DEFAULT_WORKERS
);

120 
R—ùÜFaùÜy
::
	`š™Ÿlize
(
»aùÜCouÁ
);

122 
comm
 = 
Ãw
 
	`Comm
();

124 ià(
v”bo£
) {

125 
cout
 << "CPU couÁ = " << 
Sy¡em
::
	`g‘_´oûssÜ_couÁ
(è<< 
’dl
;

126 
cout
 << "DfsBrok”.Loÿl.PÜt=" << 
pÜt
 << 
’dl
;

127 
cout
 << "DfsBrok”.Loÿl.R—ùÜs=" << 
»aùÜCouÁ
 << 
’dl
;

128 
cout
 << "DfsBrok”.Loÿl.WÜk”s=" << 
wÜk”CouÁ
 << 
’dl
;

131 
IÃtAddr
::
	`š™Ÿlize
(&
li¡’Addr
, 
INADDR_ANY
, 
pÜt
);

133 
brok”PŒ
 = 
Ãw
 
	`LoÿlBrok”
(
´İs_±r
);

134 
­pQueuePŒ
 = 
Ãw
 
	`AµliÿtiÚQueue
(
wÜk”CouÁ
);

135 
CÚÃùiÚHªdËrFaùÜyPŒ
 
	`chfPŒ
(
Ãw
 
DfsBrok”
::
	`CÚÃùiÚHªdËrFaùÜy
(
comm
, 
­pQueuePŒ
, 
brok”PŒ
));

136 ià((
”rÜ
 = 
comm
->
	`li¡’
(
li¡’Addr
, 
chfPŒ
)è!ğ
E¼Ü
::
OK
) {

137 
¡d
::
¡ršg
 
addrSŒ
;

138 
	`HT_ERRORF
("ProbËm†i¡’šg fÜ cÚÃùiÚ Ú % - %s", 
IÃtAddr
::
	`¡ršg_fÜm©
(
addrSŒ
, 
li¡’Addr
), 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

142 ià(
pidFe
 != "") {

143 
f¡»am
 
	`fe¡r
 (
pidFe
.
	`c_¡r
(), f¡»am::
out
);

144 
fe¡r
 << 
	`g‘pid
(è<< 
’dl
;

145 
fe¡r
.
	`şo£
();

148 
­pQueuePŒ
->
	`još
();

150 
d–‘e
 
comm
;

152 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/ClientConnectionHandler.cc

21 
	~"CommÚ/E¼Ü.h
"

22 
	~"CommÚ/Exû±iÚ.h
"

23 
	~"CommÚ/IÃtAddr.h
"

25 
	~"Cl›ÁCÚÃùiÚHªdËr.h
"

26 
	~"Ma¡”.h
"

27 
	~"PrÙocŞ.h
"

28 
	~"SessiÚ.h
"

30 
usšg
 
Çme¥aû
 
	gHy³r¥aû
;

31 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

37 
	gCl›ÁCÚÃùiÚHªdËr
::
	$Cl›ÁCÚÃùiÚHªdËr
(
Comm
 *
comm
, 
SessiÚ
 *
£ssiÚ
, 
time_t
 
timeout
è: 
	`m_comm
(comm), 
	`m_£ssiÚ
(£ssiÚ), 
	`m_£ssiÚ_id
(0), 
	`m_¡©e
(
DISCONNECTED
), 
	`m_v”bo£
(
çl£
), 
	$m_timeout
(
timeout
) {

38 
	`mem£t
(&
m_ma¡”_addr
, 0, (
sockaddr_š
));

40 
	}
}

46 
	gCl›ÁCÚÃùiÚHªdËr
::~
	$Cl›ÁCÚÃùiÚHªdËr
() {

47 ià(
m_ma¡”_addr
.
sš_pÜt
 != 0)

48 
m_comm
->
	`şo£_sock‘
(
m_ma¡”_addr
);

49 
	}
}

52 
	gCl›ÁCÚÃùiÚHªdËr
::
hªdË
(
Hy³¹abË
::
Ev’tPŒ
 &
ev’tPŒ
) {

53 
boo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

54 
	g”rÜ
;

56 ià(
	gm_v”bo£
) {

57 
HT_INFOF
("%s", 
ev’tPŒ
->
toSŒšg
().
c_¡r
());

60 ià(
	gev’tPŒ
->
	gty³
 =ğ
Hy³¹abË
::
Ev’t
::
MESSAGE
) {

62 ià(
PrÙocŞ
::
»¥Ú£_code
(
ev’tPŒ
.
g‘
()è!ğ
E¼Ü
::
OK
) {

63 
HT_ERRORF
("CÚÃùiÚ hªdshak”rÜ: %s", 
PrÙocŞ
::
¡ršg_fÜm©_mes§ge
(
ev’tPŒ
.
g‘
()).
c_¡r
());

64 
	gm_comm
->
şo£_sock‘
(
ev’tPŒ
->
addr
);

65 
	gm_¡©e
 = 
DISCONNECTED
;

69 
	gm_£ssiÚ
->
¡©e_Œªs™iÚ
(
SessiÚ
::
STATE_SAFE
);

71 
	gm_¡©e
 = 
CONNECTED
;

73 ià(
	gev’tPŒ
->
	gty³
 =ğ
Hy³¹abË
::
Ev’t
::
DISCONNECT
) {

75 ià(
m_v”bo£
) {

76 
HT_WARNF
("%s", 
ev’tPŒ
->
toSŒšg
().
c_¡r
());

79 
	gm_£ssiÚ
->
¡©e_Œªs™iÚ
(
SessiÚ
::
STATE_JEOPARDY
);

81 
	gm_¡©e
 = 
DISCONNECTED
;

83 ià(
	gev’tPŒ
->
	gty³
 =ğ
Hy³¹abË
::
Ev’t
::
CONNECTION_ESTABLISHED
) {

85 
m_¡©e
 = 
HANDSHAKING
;

87 
memıy
(&
m_ma¡”_addr
, &
ev’tPŒ
->
addr
, (
sockaddr_š
));

89 
CommBufPŒ
 
commBufPŒ
Ğ
Hy³r¥aû
::
PrÙocŞ
::
ü—‹_hªdshake_»que¡
(
m_£ssiÚ_id
) );

91 ià((
	g”rÜ
 = 
m_comm
->
£nd_»que¡
(
ev’tPŒ
->
addr
, 
m_timeout
, 
commBufPŒ
, 
this
)è!ğ
E¼Ü
::
OK
) {

92 
HT_ERRORF
("ProbËm s’dšg hªdshak»que¡ - %s", 
E¼Ü
::
g‘_‹xt
(
”rÜ
));

93 
	gm_comm
->
şo£_sock‘
(
ev’tPŒ
->
addr
);

94 
	gm_¡©e
 = 
DISCONNECTED
;

98 
HT_INFOF
("%s", 
ev’tPŒ
->
toSŒšg
().
c_¡r
());

99 
	gm_comm
->
şo£_sock‘
(
ev’tPŒ
->
addr
);

100 
	gm_¡©e
 = 
DISCONNECTED
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/ClientConnectionHandler.h

21 #iâdeà
HYPERSPACE_CLIENTCONNECTIONHANDLER_H


22 
	#HYPERSPACE_CLIENTCONNECTIONHANDLER_H


	)

24 
	~<boo¡/th»ad/mu‹x.hµ
>

26 
	~"CommÚ/E¼Ü.h
"

27 
	~"CommÚ/IÃtAddr.h
"

28 
	~"AsyncComm/Comm.h
"

29 
	~"AsyncComm/Di¥©chHªdËr.h
"

31 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

33 
Çme¥aû
 
	gHy³r¥aû
 {

35 
şass
 
	gSessiÚ
;

37 şas 
	cCl›ÁCÚÃùiÚHªdËr
 : 
public
 
Di¥©chHªdËr
 {

38 
public
:

40 ’um { 
DISCONNECTED
, 
	gCONNECTING
, 
	gHANDSHAKING
, 
	gCONNECTED
 };

42 
Cl›ÁCÚÃùiÚHªdËr
(
Comm
 *
comm
, 
SessiÚ
 *
£ssiÚ
, 
time_t
 
timeout
);

43 
	gvœtu®
 ~
Cl›ÁCÚÃùiÚHªdËr
();

45 
vœtu®
 
hªdË
(
Hy³¹abË
::
Ev’tPŒ
 &
ev’tPŒ
);

47 
£t_£ssiÚ_id
(
ušt64_t
 
id
è{ 
	gm_£ssiÚ_id
 = id; }

49 
boŞ
 
discÚÃùed
() {

50 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

51  
	gm_¡©e
 =ğ
DISCONNECTED
;

54 
š™Ÿ‹_cÚÃùiÚ
(
sockaddr_š
 &
addr
) {

55 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

56 
Di¥©chHªdËrPŒ
 
dhp
(
this
);

57 
	g”rÜ
;

58 
	gm_¡©e
 = 
CONNECTING
;

59 ià((
	g”rÜ
 = 
m_comm
->
cÚÃù
(
addr
, 
dhp
)è!ğ
E¼Ü
::
OK
) {

60 
¡d
::
¡ršg
 
¡r
;

61 
HT_ERRORF
("Problemƒstablishing TCP connection with Hyperspace.Master‡t %s - %s",

62 
IÃtAddr
::
¡ršg_fÜm©
(
¡r
, 
addr
), 
E¼Ü
::
g‘_‹xt
(
”rÜ
));

63 
	gm_comm
->
şo£_sock‘
(
addr
);

64 
	gm_¡©e
 = 
DISCONNECTED
;

66  
	g”rÜ
;

69 
£t_v”bo£_mode
(
boŞ
 
v”bo£
è{ 
	gm_v”bo£
 = verbose; }

71 
şo£
() {

72 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

73 
	gm_comm
->
şo£_sock‘
(
m_ma¡”_addr
);

74 
	gm_¡©e
 = 
DISCONNECTED
;

77 
	g´iv©e
:

78 
boo¡
::
mu‹x
 
m_mu‹x
;

79 
Comm
 *
	gm_comm
;

80 
SessiÚ
 *
	gm_£ssiÚ
;

81 
ušt64_t
 
	gm_£ssiÚ_id
;

82 
	gm_¡©e
;

83 
boŞ
 
	gm_v”bo£
;

84 
sockaddr_š
 
	gm_ma¡”_addr
;

85 
time_t
 
	gm_timeout
;

87 
	gboo¡
::
	tšŒusive_±r
<
	tCl›ÁCÚÃùiÚHªdËr
> 
	tCl›ÁCÚÃùiÚHªdËrPŒ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/ClientHandleState.h

21 #iâdeà
HYPERSPACE_CLIENTHANDLESTATE_H


22 
	#HYPERSPACE_CLIENTHANDLESTATE_H


	)

24 
	~<¡ršg
>

26 
	~<boo¡/th»ad/cÚd™iÚ.hµ
>

27 
	~<boo¡/th»ad/mu‹x.hµ
>

29 
	~"CommÚ/Reã»nûCouÁ.h
"

31 
	~"HªdËC®lback.h
"

32 
	~"LockSequ’ûr.h
"

34 
Çme¥aû
 
	gHy³r¥aû
 {

36 şas 
	cCl›ÁHªdËS‹
 : 
public
 
Hy³¹abË
::
Reã»nûCouÁ
 {

37 
public
:

38 
ušt64_t
 
hªdË
;

39 
ušt32_t
 
	gİ’FÏgs
;

40 
ušt32_t
 
	gev’tMask
;

41 
	g¡d
::
¡ršg
 
nÜm®Name
;

42 
HªdËC®lbackPŒ
 
	gÿÎbackPŒ
;

43 
LockSequ’ûrT
 *
	g£qu’ûr
;

44 
	glockStus
;

45 
ušt32_t
 
	glockMode
;

46 
ušt64_t
 
	glockG’”©iÚ
;

47 
	gboo¡
::
mu‹x
 mutex;

48 
	gboo¡
::
cÚd™iÚ
 
cÚd
;

50 
	gboo¡
::
	tšŒusive_±r
<
	tCl›ÁHªdËS‹
> 
	tCl›ÁHªdËS‹PŒ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/ClientKeepaliveHandler.cc

22 
	~<pŞl.h
>

25 
	~"CommÚ/E¼Ü.h
"

26 
	~"CommÚ/IÃtAddr.h
"

27 
	~"CommÚ/Exû±iÚ.h
"

28 
	~"CommÚ/SŒšgExt.h
"

30 
	~"Cl›ÁK“·liveHªdËr.h
"

31 
	~"Ma¡”.h
"

32 
	~"PrÙocŞ.h
"

33 
	~"SessiÚ.h
"

35 
usšg
 
Çme¥aû
 
Hy³¹abË
;

36 
usšg
 
Çme¥aû
 
	gHy³r¥aû
;

38 
	gCl›ÁK“·liveHªdËr
::
	$Cl›ÁK“·liveHªdËr
(
Comm
 *
comm
, 
Prİ”t›sPŒ
 &
´İsPŒ
, 
SessiÚ
 *
£ssiÚ
è: 
	`m_comm
(comm), 
	`m_£ssiÚ
(£ssiÚ), 
	`m_£ssiÚ_id
(0), 
	$m_Ï¡_known_ev’t
(0) {

39 
”rÜ
;

40 
ušt16_t
 
ma¡”PÜt
;

41 cÚ¡ *
ma¡”Ho¡
;

43 
m_v”bo£
 = 
´İsPŒ
->
	`g‘_boŞ
("Hy³¹abË.V”bo£", 
çl£
);

44 
ma¡”Ho¡
 = 
´İsPŒ
->
	`g‘
("Hyperspace.Master.Host", "localhost");

45 
ma¡”PÜt
 = (
ušt16_t
)
´İsPŒ
->
	`g‘_št
("Hy³r¥aû.Ma¡”.PÜt", 
Ma¡”
::
DEFAULT_MASTER_PORT
);

46 
m_Ëa£_š‹rv®
 = (
ušt32_t
)
´İsPŒ
->
	`g‘_št
("Hy³r¥aû.L—£.IÁ”v®", 
Ma¡”
::
DEFAULT_LEASE_INTERVAL
);

47 
m_k“p_®ive_š‹rv®
 = (
ušt32_t
)
´İsPŒ
->
	`g‘_št
("Hy³r¥aû.K“pAlive.IÁ”v®", 
Ma¡”
::
DEFAULT_KEEPALIVE_INTERVAL
);

49 ià(!
IÃtAddr
::
	`š™Ÿlize
(&
m_ma¡”_addr
, 
ma¡”Ho¡
, 
ma¡”PÜt
))

50 
	`ex™
(1);

52 ià(
m_v”bo£
) {

53 
cout
 << "Hy³r¥aû.K“pAlive.IÁ”v®=" << 
m_k“p_®ive_š‹rv®
 << 
’dl
;

54 
cout
 << "Hy³r¥aû.L—£.IÁ”v®=" << 
m_Ëa£_š‹rv®
 << 
’dl
;

55 
cout
 << "Hy³r¥aû.Ma¡”.Ho¡=" << 
ma¡”Ho¡
 << 
’dl
;

56 
cout
 << "Hy³r¥aû.Ma¡”.PÜt=" << 
ma¡”PÜt
 << 
’dl
;

59 
boo¡
::
	`xtime_g‘
(&
m_Ï¡_k“p_®ive_£nd_time
, boo¡::
TIME_UTC
);

60 
boo¡
::
	`xtime_g‘
(&
m_jeİ¬dy_time
, boo¡::
TIME_UTC
);

61 
m_jeİ¬dy_time
.
£c
 +ğ
m_Ëa£_š‹rv®
;

63 
IÃtAddr
::
	`š™Ÿlize
(&
m_loÿl_addr
, 
INADDR_ANY
, 0);

65 
Di¥©chHªdËrPŒ
 
	`dhp
(
this
);

66 ià((
”rÜ
 = 
m_comm
->
	`ü—‹_d©ag¿m_»ûive_sock‘
(&
m_loÿl_addr
, 
dhp
)è!ğ
E¼Ü
::
OK
) {

67 
¡d
::
¡ršg
 
¡r
;

68 
	`HT_ERRORF
("UÇbËØü—‹ d©ag¿m„eûivsock‘ % - %s", 
IÃtAddr
::
	`¡ršg_fÜm©
(
¡r
, 
m_loÿl_addr
), 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

69 
	`ex™
(1);

72 
CommBufPŒ
 
	`commBufPŒ
Ğ
Hy³r¥aû
::
PrÙocŞ
::
	`ü—‹_ş›Á_k“·live_»que¡
(
m_£ssiÚ_id
, 
m_Ï¡_known_ev’t
) );

74 ià((
”rÜ
 = 
m_comm
->
	`£nd_d©ag¿m
(
m_ma¡”_addr
, 
m_loÿl_addr
, 
commBufPŒ
è!ğ
E¼Ü
::
OK
)) {

75 
	`HT_ERRORF
("UÇbËØ£nd d©ag¿m - %s", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

76 
	`ex™
(1);

79 ià((
”rÜ
 = 
m_comm
->
	`£t_tim”
(
m_k“p_®ive_š‹rv®
*1000, 
this
)è!ğ
E¼Ü
::
OK
) {

80 
	`HT_ERRORF
("ProbËm s‘tšgim” - %s", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

81 
	`ex™
(1);

85 
	}
}

90 
	gCl›ÁK“·liveHªdËr
::~
	$Cl›ÁK“·liveHªdËr
() {

91 
m_comm
->
	`şo£_sock‘
(
m_loÿl_addr
);

92 
	}
}

99 
	gCl›ÁK“·liveHªdËr
::
hªdË
(
Hy³¹abË
::
Ev’tPŒ
 &
ev’tPŒ
) {

100 
boo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

101 
	g”rÜ
;

102 
ušt16_t
 
	gcommªd
 = (uint16_t)-1;

110 ià(
	gev’tPŒ
->
	gty³
 =ğ
Hy³¹abË
::
Ev’t
::
MESSAGE
) {

111 
ušt8_t
 *
msgPŒ
 = 
ev’tPŒ
->
mes§ge
;

112 
size_t
 
	g»maššg
 = 
ev’tPŒ
->
mes§geL’
;

114 
	gŒy
 {

116 ià(!
	gS”Ÿliz©iÚ
::
decode_shÜt
(&
msgPŒ
, &
»maššg
, &
commªd
))

117 
throw
 
PrÙocŞExû±iÚ
("Truncated Request");

120 ià(
	gcommªd
 >ğ
PrÙocŞ
::
COMMAND_MAX
)

121 
throw
 
PrÙocŞExû±iÚ
((
¡d
::
¡ršg
)"Inv®id commªd (" + 
commªd
 + ")");

123 
	gcommªd
) {

124 
	gPrÙocŞ
::
COMMAND_KEEPALIVE
:

126 
ušt64_t
 
£ssiÚId
;

127 
	g¡©e
;

128 
ušt32_t
 
	gnÙifiÿtiÚCouÁ
;

129 
ušt64_t
 
	ghªdË
, 
	gev’tId
;

130 
ušt32_t
 
	gev’tMask
;

131 cÚ¡ *
	gÇme
;

133 ià(
	gm_£ssiÚ
->
g‘_¡©e
(è=ğ
SessiÚ
::
STATE_EXPIRED
)

137 
memıy
(&
m_jeİ¬dy_time
, &
m_Ï¡_k“p_®ive_£nd_time
, (
boo¡
::
xtime
));

138 
	gm_jeİ¬dy_time
.
	g£c
 +ğ
m_Ëa£_š‹rv®
;

140 ià(!
	gS”Ÿliz©iÚ
::
decode_lÚg
(&
msgPŒ
, &
»maššg
, &
£ssiÚId
))

141 
throw
 
PrÙocŞExû±iÚ
("Truncated Request");

143 ià(!
	gS”Ÿliz©iÚ
::
decode_št
(&
msgPŒ
, &
»maššg
, (
ušt32_t
 *)&
”rÜ
))

144 
throw
 
PrÙocŞExû±iÚ
("Truncated Request");

146 ià(
	g”rÜ
 !ğ
E¼Ü
::
OK
) {

147 ià(
”rÜ
 !ğ
E¼Ü
::
HYPERSPACE_EXPIRED_SESSION
) {

148 
HT_ERRORF
("Ma¡” sessiÚƒ¼Ü - %s", 
E¼Ü
::
g‘_‹xt
(
”rÜ
));

150 
expœe_£ssiÚ
();

154 ià(
	gm_£ssiÚ_id
 == 0) {

155 
m_£ssiÚ_id
 = 
£ssiÚId
;

156 ià(!
	gm_cÚn_hªdËr_±r
) {

157 
	gm_cÚn_hªdËr_±r
 = 
Ãw
 
Cl›ÁCÚÃùiÚHªdËr
(
m_comm
, 
m_£ssiÚ
, 
m_Ëa£_š‹rv®
);

158 
	gm_cÚn_hªdËr_±r
->
£t_v”bo£_mode
(
m_v”bo£
);

159 
	gm_cÚn_hªdËr_±r
->
£t_£ssiÚ_id
(
m_£ssiÚ_id
);

163 ià(!
	gS”Ÿliz©iÚ
::
decode_št
(&
msgPŒ
, &
»maššg
, &
nÙifiÿtiÚCouÁ
)) {

164 
throw
 
PrÙocŞExû±iÚ
("Truncated Request");

167 
ušt32_t
 
	gi
=0; i<
	gnÙifiÿtiÚCouÁ
; i++) {

169 ià(!
	gS”Ÿliz©iÚ
::
decode_lÚg
(&
msgPŒ
, &
»maššg
, &
hªdË
) ||

170 !
	gS”Ÿliz©iÚ
::
decode_lÚg
(&
msgPŒ
, &
»maššg
, &
ev’tId
) ||

171 !
	gS”Ÿliz©iÚ
::
decode_št
(&
msgPŒ
, &
»maššg
, &
ev’tMask
))

172 
throw
 
PrÙocŞExû±iÚ
("Truncated Request");

174 
	gHªdËM­T
::
™”©Ü
 
™”
 = 
m_hªdË_m­
.
fšd
(
hªdË
);

177 
as£¹
 (
™”
 !ğ
m_hªdË_m­
.
’d
());

178 
Cl›ÁHªdËS‹PŒ
 
	ghªdËS‹PŒ
 = (*
™”
).
£cÚd
;

180 ià(
	gev’tMask
 =ğ
EVENT_MASK_ATTR_SET
 || 
ev’tMask
 =ğ
EVENT_MASK_ATTR_DEL
 ||

181 
ev’tMask
 =ğ
EVENT_MASK_CHILD_NODE_ADDED
 ||ƒv’tMask =ğ
EVENT_MASK_CHILD_NODE_REMOVED
) {

182 ià(!
S”Ÿliz©iÚ
::
decode_¡ršg
(&
msgPŒ
, &
»maššg
, &
Çme
))

183 
throw
 
PrÙocŞExû±iÚ
("Truncated Request");

184 ià(
	gev’tId
 <ğ
m_Ï¡_known_ev’t
)

186 ià(
	ghªdËS‹PŒ
->
	gÿÎbackPŒ
) {

187 ià(
	gev’tMask
 =ğ
EVENT_MASK_ATTR_SET
)

188 
hªdËS‹PŒ
->
ÿÎbackPŒ
->
©Œ_£t
(
Çme
);

189 ià(
	gev’tMask
 =ğ
EVENT_MASK_ATTR_DEL
)

190 
hªdËS‹PŒ
->
ÿÎbackPŒ
->
©Œ_d–
(
Çme
);

191 ià(
	gev’tMask
 =ğ
EVENT_MASK_CHILD_NODE_ADDED
)

192 
hªdËS‹PŒ
->
ÿÎbackPŒ
->
chd_node_added
(
Çme
);

194 
	ghªdËS‹PŒ
->
	gÿÎbackPŒ
->
chd_node_»moved
(
Çme
);

197 ià(
	gev’tMask
 =ğ
EVENT_MASK_LOCK_ACQUIRED
) {

198 
ušt32_t
 
mode
;

199 ià(!
	gS”Ÿliz©iÚ
::
decode_št
(&
msgPŒ
, &
»maššg
, &
mode
))

200 
throw
 
PrÙocŞExû±iÚ
("Truncated Request");

201 ià(
	gev’tId
 <ğ
m_Ï¡_known_ev’t
)

203 ià(
	ghªdËS‹PŒ
->
	gÿÎbackPŒ
)

204 
	ghªdËS‹PŒ
->
	gÿÎbackPŒ
->
lock_acquœed
(
mode
);

206 ià(
	gev’tMask
 =ğ
EVENT_MASK_LOCK_RELEASED
) {

207 ià(
ev’tId
 <ğ
m_Ï¡_known_ev’t
)

209 ià(
	ghªdËS‹PŒ
->
	gÿÎbackPŒ
)

210 
	ghªdËS‹PŒ
->
	gÿÎbackPŒ
->
lock_»Ëa£d
();

212 ià(
	gev’tMask
 =ğ
EVENT_MASK_LOCK_GRANTED
) {

213 
ušt32_t
 
mode
;

214 ià(!
	gS”Ÿliz©iÚ
::
decode_št
(&
msgPŒ
, &
»maššg
, &
mode
) ||

215 !
	gS”Ÿliz©iÚ
::
decode_lÚg
(&
msgPŒ
, &
»maššg
, &
hªdËS‹PŒ
->
lockG’”©iÚ
))

216 
throw
 
PrÙocŞExû±iÚ
("Truncated Request");

217 ià(
	gev’tId
 <ğ
m_Ï¡_known_ev’t
)

219 
	ghªdËS‹PŒ
->
	glockStus
 = 
LOCK_STATUS_GRANTED
;

220 
	ghªdËS‹PŒ
->
	g£qu’ûr
->
	gg’”©iÚ
 = 
hªdËS‹PŒ
->
lockG’”©iÚ
;

221 
	ghªdËS‹PŒ
->
	g£qu’ûr
->
	gmode
 = 
mode
;

222 
	ghªdËS‹PŒ
->
	gcÚd
.
nÙify_®l
();

225 
	gm_Ï¡_known_ev’t
 = 
ev’tId
;

234 ià(
	gm_cÚn_hªdËr_±r
->
discÚÃùed
())

235 
	gm_cÚn_hªdËr_±r
->
š™Ÿ‹_cÚÃùiÚ
(
m_ma¡”_addr
);

237 
	g¡©e
 = 
m_£ssiÚ
->
¡©e_Œªs™iÚ
(
SessiÚ
::
STATE_SAFE
);

239 ià(
	gnÙifiÿtiÚCouÁ
 > 0) {

240 
CommBufPŒ
 
commBufPŒ
Ğ
Hy³r¥aû
::
PrÙocŞ
::
ü—‹_ş›Á_k“·live_»que¡
(
m_£ssiÚ_id
, 
m_Ï¡_known_ev’t
) );

241 
	gboo¡
::
xtime_g‘
(&
m_Ï¡_k“p_®ive_£nd_time
, 
boo¡
::
TIME_UTC
);

242 ià((
	g”rÜ
 = 
m_comm
->
£nd_d©ag¿m
(
m_ma¡”_addr
, 
m_loÿl_addr
, 
commBufPŒ
è!ğ
E¼Ü
::
OK
)) {

243 
HT_ERRORF
("UÇbËØ£nd d©ag¿m - %s", 
E¼Ü
::
g‘_‹xt
(
”rÜ
));

244 
ex™
(1);

248 
as£¹
(
m_£ssiÚ_id
 =ğ
£ssiÚId
);

252 
throw
 
PrÙocŞExû±iÚ
((
¡ršg
)"Commªd cod" + 
commªd
 + "‚ot implemented");

255 
ÿtch
 (
PrÙocŞExû±iÚ
 &
e
) {

256 
	g¡d
::
¡ršg
 
”rMsg
 = 
e
.
wh©
();

257 
HT_ERRORF
("PrÙocŞƒ¼Ü '%s'", 
e
.
wh©
());

260 ià(
	gev’tPŒ
->
	gty³
 =ğ
Hy³¹abË
::
Ev’t
::
TIMER
) {

261 
boo¡
::
xtime
 
now
;

262 
	g¡©e
;

266 ià((
	g¡©e
 = 
m_£ssiÚ
->
g‘_¡©e
()è=ğ
SessiÚ
::
STATE_EXPIRED
)

269 
	gboo¡
::
xtime_g‘
(&
now
, 
boo¡
::
TIME_UTC
);

271 ià(
	g¡©e
 =ğ
SessiÚ
::
STATE_SAFE
) {

272 ià(
xtime_cmp
(
m_jeİ¬dy_time
, 
now
) < 0) {

273 
m_£ssiÚ
->
¡©e_Œªs™iÚ
(
SessiÚ
::
STATE_JEOPARDY
);

276 ià(
	gm_£ssiÚ
->
expœed
()) {

277 
expœe_£ssiÚ
();

281 
CommBufPŒ
 
commBufPŒ
Ğ
Hy³r¥aû
::
PrÙocŞ
::
ü—‹_ş›Á_k“·live_»que¡
(
m_£ssiÚ_id
, 
m_Ï¡_known_ev’t
) );

283 
	gboo¡
::
xtime_g‘
(&
m_Ï¡_k“p_®ive_£nd_time
, 
boo¡
::
TIME_UTC
);

285 ià((
	g”rÜ
 = 
m_comm
->
£nd_d©ag¿m
(
m_ma¡”_addr
, 
m_loÿl_addr
, 
commBufPŒ
è!ğ
E¼Ü
::
OK
)) {

286 
HT_ERRORF
("UÇbËØ£nd d©ag¿m - %s", 
E¼Ü
::
g‘_‹xt
(
”rÜ
));

287 
ex™
(1);

290 ià((
	g”rÜ
 = 
m_comm
->
£t_tim”
(
m_k“p_®ive_š‹rv®
*1000, 
this
)è!ğ
E¼Ü
::
OK
) {

291 
HT_ERRORF
("ProbËm s‘tšgim” - %s", 
E¼Ü
::
g‘_‹xt
(
”rÜ
));

292 
ex™
(1);

296 
HT_INFOF
("%s", 
ev’tPŒ
->
toSŒšg
().
c_¡r
());

302 
	gCl›ÁK“·liveHªdËr
::
	$expœe_£ssiÚ
() {

303 
m_£ssiÚ
->
	`¡©e_Œªs™iÚ
(
SessiÚ
::
STATE_EXPIRED
);

304 ià(
m_cÚn_hªdËr_±r
)

305 
m_cÚn_hªdËr_±r
->
	`şo£
();

306 
	`pŞl
(0,0,2000);

307 
m_cÚn_hªdËr_±r
 = 0;

309 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/ClientKeepaliveHandler.h

21 #iâdeà
HYPERSPACE_CLIENTKEEPALIVEHANDLER_H


22 
	#HYPERSPACE_CLIENTKEEPALIVEHANDLER_H


	)

24 
	~<ÿs£¹
>

25 
	~<ext/hash_m­
>

27 
	~<boo¡/th»ad/mu‹x.hµ
>

29 
	~"CommÚ/Prİ”t›s.h
"

30 
	~"CommÚ/SŒšgExt.h
"

32 
	~"AsyncComm/Comm.h
"

33 
	~"AsyncComm/Di¥©chHªdËr.h
"

35 
	~"Cl›ÁCÚÃùiÚHªdËr.h
"

36 
	~"Cl›ÁHªdËS‹.h
"

37 
	~"HªdËC®lback.h
"

39 
Çme¥aû
 
	gHy³r¥aû
 {

41 
şass
 
	gSessiÚ
;

46 şas 
	cCl›ÁK“·liveHªdËr
 : 
public
 
Di¥©chHªdËr
 {

48 
public
:

49 
Cl›ÁK“·liveHªdËr
(
Comm
 *
comm
, 
Prİ”t›sPŒ
 &
´İsPŒ
, 
SessiÚ
 *
£ssiÚ
);

50 
	gvœtu®
 ~
Cl›ÁK“·liveHªdËr
();

52 
vœtu®
 
hªdË
(
Hy³¹abË
::
Ev’tPŒ
 &
ev’tPŒ
);

54 
»gi¡”_hªdË
(
Cl›ÁHªdËS‹PŒ
 &
hªdËS‹PŒ
) {

55 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

56 
	gHªdËM­T
::
™”©Ü
 
™”
 = 
m_hªdË_m­
.
fšd
(
hªdËS‹PŒ
->
hªdË
);

57 
as£¹
(
™”
 =ğ
m_hªdË_m­
.
’d
());

58 
	gm_hªdË_m­
[
hªdËS‹PŒ
->
hªdË
] = handleStatePtr;

61 
uÄegi¡”_hªdË
(
ušt64_t
 
hªdË
) {

62 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

63 
	gm_hªdË_m­
.
”a£
(
hªdË
);

66 
boŞ
 
g‘_hªdË_¡©e
(
ušt64_t
 
hªdË
, 
Cl›ÁHªdËS‹PŒ
 &
hªdËS‹PŒ
) {

67 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

68 
	gHªdËM­T
::
™”©Ü
 
™”
 = 
m_hªdË_m­
.
fšd
(
hªdË
);

69 ià(
	g™”
 =ğ
m_hªdË_m­
.
’d
())

70  
çl£
;

71 
	ghªdËS‹PŒ
 = (*
™”
).
£cÚd
;

72  
	gŒue
;

75 
expœe_£ssiÚ
();

77 
	g´iv©e
:

78 
boo¡
::
mu‹x
 
m_mu‹x
;

79 
	gboo¡
::
xtime
 
m_Ï¡_k“p_®ive_£nd_time
;

80 
	gboo¡
::
xtime
 
m_jeİ¬dy_time
;

81 
Comm
 *
	gm_comm
;

82 
ušt32_t
 
	gm_Ëa£_š‹rv®
;

83 
ušt32_t
 
	gm_k“p_®ive_š‹rv®
;

84 
sockaddr_š
 
	gm_ma¡”_addr
;

85 
sockaddr_š
 
	gm_loÿl_addr
;

86 
boŞ
 
	gm_v”bo£
;

87 
SessiÚ
 *
	gm_£ssiÚ
;

88 
ušt64_t
 
	gm_£ssiÚ_id
;

89 
Cl›ÁCÚÃùiÚHªdËrPŒ
 
	gm_cÚn_hªdËr_±r
;

90 
ušt64_t
 
	gm_Ï¡_known_ev’t
;

92 
	g__gnu_cxx
::
	thash_m­
<
	tušt64_t
, 
	tCl›ÁHªdËS‹PŒ
> 
	tHªdËM­T
;

93 
HªdËM­T
 
	gm_hªdË_m­
;

95 
	gboo¡
::
	tšŒusive_±r
<
	tCl›ÁK“·liveHªdËr
> 
	tCl›ÁK“·liveHªdËrPŒ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/DirEntry.cc

21 
	~"AsyncComm/S”Ÿliz©iÚ.h
"

23 
	~"DœEÁry.h
"

25 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

27 
Çme¥aû
 
	gHy³r¥aû
 {

29 
size_t
 
’coded_Ëngth_dœ_’Œy
(
DœEÁryT
 &
dœ_’Œy
) {

30  1 + 
	gS”Ÿliz©iÚ
::
’coded_Ëngth_¡ršg
(
dœ_’Œy
.
Çme
);

33 
’code_dœ_’Œy
(
ušt8_t
 **
buf_±r
, 
DœEÁryT
 &
dœ_’Œy
) {

34 
ušt8_t
 
	gbv®
 = (
dœ_’Œy
.
isDœeùÜy
) ? 1 : 0;

35 *(*
	gbuf_±r
)++ = 
bv®
;

36 
	gS”Ÿliz©iÚ
::
’code_¡ršg
(
buf_±r
, 
dœ_’Œy
.
Çme
);

39 
boŞ
 
decode_¿nge_dœ_’Œy
(
ušt8_t
 **
buf_±r
, 
size_t
 *
»maššg_±r
, 
DœEÁryT
 &
dœ_’Œy
) {

40 
ušt8_t
 
	gbv®
;

41 ià(!
	gS”Ÿliz©iÚ
::
decode_by‹
(
buf_±r
, 
»maššg_±r
, &
bv®
))

42  
	gçl£
;

43 
	gdœ_’Œy
.
	gisDœeùÜy
 = (
bv®
 =ğ0è? 
çl£
 : 
Œue
;

44  
	gS”Ÿliz©iÚ
::
decode_¡ršg
(
buf_±r
, 
»maššg_±r
, 
dœ_’Œy
.
Çme
);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/DirEntry.h

21 #iâdeà
HYPERSPACE_DIRENTRY_H


22 
	#HYPERSPACE_DIRENTRY_H


	)

24 
	~<¡ršg
>

26 
Çme¥aû
 
	gHy³r¥aû
 {

33 
	sDœEÁryT
 {

35 
	g¡d
::
¡ršg
 
Çme
;

37 
boŞ
 
	gisDœeùÜy
;

40 
	sÉDœEÁry
 {

41 
boŞ
 
İ”©Ü
()(cÚ¡ 
	gDœEÁryT
 &
	gde1
, cÚ¡ DœEÁryT &
	gde2
) const {

42 ià(
	gde1
.
	gÇme
 =ğ
de2
.
Çme
)

43  ()
de1
.
isDœeùÜy
 < ()
de2
.isDirectory;

44  
	gde1
.
	gÇme
 < 
	gde2
.name;

54 
size_t
 
’coded_Ëngth_dœ_’Œy
(
DœEÁryT
 &
dœ_’Œy
);

61 
’code_dœ_’Œy
(
ušt8_t
 **
buf_±r
, 
DœEÁryT
 &
dœ_’Œy
);

69 
boŞ
 
decode_¿nge_dœ_’Œy
(
ušt8_t
 **
buf_±r
, 
size_t
 *
»maššg_±r
, 
DœEÁryT
 &
dœ_’Œy
);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/Event.cc

21 
	~"Ev’t.h
"

23 
	gboo¡
::
mu‹x
 
Hy³r¥aû
::
Ev’t
::
ms_Ãxt_ev’t_id_mu‹x
;

24 
ušt64_t
 
	gHy³r¥aû
::
Ev’t
::
ms_Ãxt_ev’t_id
 = 1;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/Event.h

21 #iâdeà
HYPERSPACE_EVENT_H


22 
	#HYPERSPACE_EVENT_H


	)

24 
	~<io¡»am
>

25 
	~<¡ršg
>

27 
	~<boo¡/th»ad/cÚd™iÚ.hµ
>

28 
	~<boo¡/th»ad/mu‹x.hµ
>

30 
	~"CommÚ/Reã»nûCouÁ.h
"

31 
	~"AsyncComm/CommBuf.h
"

32 
	~"AsyncComm/S”Ÿliz©iÚ.h
"

34 
	~"HªdËC®lback.h
"

36 
Çme¥aû
 
	gHy³r¥aû
 {

38 şas 
	cEv’t
 : 
public
 
Hy³¹abË
::
Reã»nûCouÁ
 {

39 
public
:

40 
Ev’t
(
ušt32_t
 
mask
è: 
m_mask
(mask), 
m_nÙifiÿtiÚ_couÁ
(0) {

41 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
ms_Ãxt_ev’t_id_mu‹x
);

42 
	gm_id
 = 
ms_Ãxt_ev’t_id
++;

45 
	gvœtu®
 ~
Ev’t
() { ; }

47 
ušt64_t
 
g‘_id
(è{  
	gm_id
; }

49 
ušt32_t
 
g‘_mask
(è{  
	gm_mask
; }

51 
šüem’t_nÙifiÿtiÚ_couÁ
() {

52 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

53 
	gm_nÙifiÿtiÚ_couÁ
++;

55 
deüem’t_nÙifiÿtiÚ_couÁ
() {

56 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

57 
	gm_nÙifiÿtiÚ_couÁ
--;

58 ià(
	gm_nÙifiÿtiÚ_couÁ
 == 0)

59 
m_cÚd
.
nÙify_®l
();

61 
wa™_fÜ_nÙifiÿtiÚs
() {

62 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

63 ià(
	gm_nÙifiÿtiÚ_couÁ
 != 0)

64 
m_cÚd
.
wa™
(
lock
);

67 
vœtu®
 
ušt32_t
 
’coded_Ëngth
() = 0;

68 
vœtu®
 
’code
(
Hy³¹abË
::
CommBuf
 *
cbuf
) = 0;

70 
	g´Ùeùed
:

72 
boo¡
::
mu‹x
 
ms_Ãxt_ev’t_id_mu‹x
;

73 
ušt64_t
 
	gms_Ãxt_ev’t_id
;

75 
	gboo¡
::
mu‹x
 
m_mu‹x
;

76 
	gboo¡
::
cÚd™iÚ
 
m_cÚd
;

77 
ušt64_t
 
	gm_id
;

78 
ušt32_t
 
	gm_mask
;

79 
ušt32_t
 
	gm_nÙifiÿtiÚ_couÁ
;

82 
	gboo¡
::
	tšŒusive_±r
<
	tEv’t
> 
	tHy³r¥aûEv’tPŒ
;

89 şas 
	cEv’tNamed
 : 
public
 
Ev’t
 {

90 
public
:

91 
Ev’tNamed
(
ušt32_t
 
mask
, 
¡d
::
¡ršg
 
Çme
è: 
Ev’t
(mask), 
m_Çme
(name) { ; }

92 
vœtu®
 
ušt32_t
 
’coded_Ëngth
(è{  12 + 
	gHy³¹abË
::
S”Ÿliz©iÚ
::
’coded_Ëngth_¡ršg
(
m_Çme
); }

93 
vœtu®
 
’code
(
Hy³¹abË
::
CommBuf
 *
cbuf
) {

94 
cbuf
->
­³nd_lÚg
(
m_id
);

95 
	gcbuf
->
­³nd_št
(
m_mask
);

96 
	gcbuf
->
­³nd_¡ršg
(
m_Çme
);

98 
	g´iv©e
:

99 
¡d
::
¡ršg
 
m_Çme
;

107 şas 
	cEv’tLockAcquœed
 : 
public
 
Ev’t
 {

108 
public
:

109 
Ev’tLockAcquœed
(
ušt32_t
 
mode
è: 
Ev’t
(
EVENT_MASK_LOCK_ACQUIRED
), 
m_mode
(mode) { ; }

110 
vœtu®
 
ušt32_t
 
’coded_Ëngth
() {  16; }

111 
vœtu®
 
’code
(
Hy³¹abË
::
CommBuf
 *
cbuf
) {

112 
cbuf
->
­³nd_lÚg
(
m_id
);

113 
	gcbuf
->
­³nd_št
(
m_mask
);

114 
	gcbuf
->
­³nd_št
(
m_mode
);

116 
	g´iv©e
:

117 
ušt32_t
 
m_mode
;

124 şas 
	cEv’tLockR–—£d
 : 
public
 
Ev’t
 {

125 
public
:

126 
Ev’tLockR–—£d
(è: 
Ev’t
(
EVENT_MASK_LOCK_RELEASED
) { ; }

127 
vœtu®
 
ušt32_t
 
’coded_Ëngth
() {  12; }

128 
vœtu®
 
’code
(
Hy³¹abË
::
CommBuf
 *
cbuf
) {

129 
cbuf
->
­³nd_lÚg
(
m_id
);

130 
	gcbuf
->
­³nd_št
(
m_mask
);

138 şas 
	cEv’tLockG¿Áed
 : 
public
 
Ev’t
 {

139 
public
:

140 
Ev’tLockG¿Áed
(
ušt32_t
 
mode
, 
ušt64_t
 
g’”©iÚ
è: 
Ev’t
(
EVENT_MASK_LOCK_GRANTED
), 
m_mode
(mode), 
m_g’”©iÚ
(generation) { ; }

141 
vœtu®
 
ušt32_t
 
’coded_Ëngth
() {  24; }

142 
vœtu®
 
’code
(
Hy³¹abË
::
CommBuf
 *
cbuf
) {

143 
cbuf
->
­³nd_lÚg
(
m_id
);

144 
	gcbuf
->
­³nd_št
(
m_mask
);

145 
	gcbuf
->
­³nd_št
(
m_mode
);

146 
	gcbuf
->
­³nd_lÚg
(
m_g’”©iÚ
);

148 
	g´iv©e
:

149 
ušt32_t
 
m_mode
;

150 
ušt64_t
 
	gm_g’”©iÚ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/HandleCallback.cc

21 
	~"HªdËC®lback.h
"

23 
Çme¥aû
 
	gHy³r¥aû
 {

25 cÚ¡ *
Ev’tMaskToSŒšg
(
ušt32_t
 
mask
) {

26 ià(
	gmask
 =ğ
EVENT_MASK_ATTR_SET
)

28 ià(
	gmask
 =ğ
EVENT_MASK_ATTR_DEL
)

30 ià(
	gmask
 =ğ
EVENT_MASK_CHILD_NODE_ADDED
)

32 ià(
	gmask
 =ğ
EVENT_MASK_CHILD_NODE_REMOVED
)

34 ià(
	gmask
 =ğ
EVENT_MASK_LOCK_ACQUIRED
)

36 ià(
	gmask
 =ğ
EVENT_MASK_LOCK_RELEASED
)

38 ià(
	gmask
 =ğ
EVENT_MASK_LOCK_GRANTED
)

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/HandleCallback.h

21 #iâdeà
HYPERSPACE_HANDLECALLBACK_H


22 
	#HYPERSPACE_HANDLECALLBACK_H


	)

24 
	~<¡ršg
>

26 
	~"CommÚ/Reã»nûCouÁ.h
"

28 
Çme¥aû
 
	gHy³r¥aû
 {

37 
	gEVENT_MASK_ATTR_SET
 = 0x0001,

38 
	gEVENT_MASK_ATTR_DEL
 = 0x0002,

39 
	gEVENT_MASK_CHILD_NODE_ADDED
 = 0x0004,

40 
	gEVENT_MASK_CHILD_NODE_REMOVED
 = 0x0008,

41 
	gEVENT_MASK_LOCK_ACQUIRED
 = 0x0010,

42 
	gEVENT_MASK_LOCK_RELEASED
 = 0x0020,

43 
	gEVENT_MASK_LOCK_GRANTED
 = 0x0040

46 cÚ¡ *
ev’t_mask_to_¡ršg
(
ušt32_t
 
mask
);

55 şas 
	cHªdËC®lback
 : 
public
 
Hy³¹abË
::
Reã»nûCouÁ
 {

56 
public
:

61 
HªdËC®lback
(
ušt32_t
 
ev’t_mask
è: 
m_ev’t_mask
(event_mask) { ; }

68 
vœtu®
 
©Œ_£t
(
¡d
::
¡ršg
 
Çme
) { ; }

75 
vœtu®
 
©Œ_d–
(
¡d
::
¡ršg
 
Çme
) { ; }

82 
vœtu®
 
chd_node_added
(
¡d
::
¡ršg
 
Çme
) { ; }

89 
vœtu®
 
chd_node_»moved
(
¡d
::
¡ršg
 
Çme
) { ; }

96 
vœtu®
 
lock_acquœed
(
ušt32_t
 
mode
) { ; }

101 
vœtu®
 
lock_»Ëa£d
() { ; }

107 
g‘_ev’t_mask
(è{  
	gm_ev’t_mask
; }

109 
	g´Ùeùed
:

110 
ušt32_t
 
m_ev’t_mask
;

112 
	gboo¡
::
	tšŒusive_±r
<
	tHªdËC®lback
> 
	tHªdËC®lbackPŒ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/HandleData.h

21 #iâdeà
HYPERSPACE_HANDLEDATA_H


22 
	#HYPERSPACE_HANDLEDATA_H


	)

24 
	~<¡ršg
>

26 
	~"CommÚ/Reã»nûCouÁ.h
"

28 
	~"SessiÚD©a.h
"

30 
Çme¥aû
 
	gHy³r¥aû
 {

32 
şass
 
	gNodeD©a
;

34 şas 
	cHªdËD©a
 : 
public
 
Hy³¹abË
::
Reã»nûCouÁ
 {

35 
public
:

36 
¡d
::
¡ršg
 
Çme
;

37 
ušt64_t
 
	gid
;

38 
ušt32_t
 
	gİ’FÏgs
;

39 
ušt32_t
 
	gev’tMask
;

40 
NodeD©a
 *
	gnode
;

41 
SessiÚD©aPŒ
 
	g£ssiÚPŒ
;

42 
boŞ
 
	glocked
;

44 
	gboo¡
::
	tšŒusive_±r
<
	tHªdËD©a
> 
	tHªdËD©aPŒ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/LockSequencer.h

21 #iâdeà
HYPERSPACE_LOCKSEQUENCER_H


22 
	#HYPERSPACE_LOCKSEQUENCER_H


	)

24 
	~<¡ršg
>

26 
Çme¥aû
 
	gHy³r¥aû
 {

35 
	sLockSequ’ûrT
 {

37 
	g¡d
::
¡ršg
 
Çme
;

39 
ušt32_t
 
	gmode
;

41 
ušt64_t
 
	gg’”©iÚ
;

49 
	gLOCK_MODE_SHARED
 = 1,

51 
	gLOCK_MODE_EXCLUSIVE
 = 2

59 
	gLOCK_STATUS_GRANTED
 = 1,

61 
	gLOCK_STATUS_BUSY
 = 2,

63 
	gLOCK_STATUS_PENDING
 = 3,

65 
	gLOCK_STATUS_CANCELLED
 = 4

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/Master.cc

21 
	~<®gÜ™hm
>

22 
	~<c¡ršg
>

25 
	~<dœ’t.h
>

26 
	~<fú.h
>

27 
	~<pŞl.h
>

28 
	~<sys/fe.h
>

29 
	~<sys/time.h
>

30 
	~<sys/ty³s.h
>

31 
	~<sys/¡©.h
>

32 
	~<sys/x©Œ.h
>

33 
	~<uni¡d.h
>

36 
	~"CommÚ/E¼Ü.h
"

37 
	~"CommÚ/FeUts.h
"

38 
	~"CommÚ/SŒšgExt.h
"

39 
	~"CommÚ/Sy¡em.h
"

41 
	~"DfsBrok”/Lib/Cl›Á.h
"

42 
	~"Hy³¹abË/Lib/Schema.h
"

44 
	~"Ev’t.h
"

45 
	~"NÙifiÿtiÚ.h
"

46 
	~"Ma¡”.h
"

47 
	~"SessiÚ.h
"

48 
	~"SessiÚD©a.h
"

50 
usšg
 
Çme¥aû
 
Hy³¹abË
;

51 
usšg
 
Çme¥aû
 
	gHy³r¥aû
;

52 
usšg
 
Çme¥aû
 
	g¡d
;

54 cÚ¡ 
ušt32_t
 
	gMa¡”
::
DEFAULT_MASTER_PORT
;

55 cÚ¡ 
ušt32_t
 
	gMa¡”
::
DEFAULT_LEASE_INTERVAL
;

56 cÚ¡ 
ušt32_t
 
	gMa¡”
::
DEFAULT_KEEPALIVE_INTERVAL
;

65 
	gMa¡”
::
	$Ma¡”
(
CÚÃùiÚMªag”PŒ
 &
cÚnMªag”PŒ
, 
Prİ”t›sPŒ
 &
´İsPŒ
, 
S”v”K“·liveHªdËrPŒ
 &
k“·liveHªdËrPŒ
è: 
	`m_v”bo£
(
çl£
), 
	`m_Ãxt_hªdË_numb”
(1), 
	$m_Ãxt_£ssiÚ_id
(1) {

66 cÚ¡ *
dœÇme
;

67 
¡d
::
¡ršg
 
¡r
;

68 
ssize_t
 
x©ŒL’
;

69 
ušt16_t
 
pÜt
;

71 
m_v”bo£
 = 
´İsPŒ
->
	`g‘_boŞ
("Hy³¹abË.V”bo£", 
çl£
);

73 
m_Ëa£_š‹rv®
 = (
ušt32_t
)
´İsPŒ
->
	`g‘_št
("Hy³r¥aû.L—£.IÁ”v®", 
DEFAULT_LEASE_INTERVAL
);

75 
m_k“p_®ive_š‹rv®
 = (
ušt32_t
)
´İsPŒ
->
	`g‘_št
("Hy³r¥aû.K“pAlive.IÁ”v®", 
DEFAULT_KEEPALIVE_INTERVAL
);

77 ià((
dœÇme
 = 
´İsPŒ
->
	`g‘
("Hyperspace.Master.Dir", 0)) == 0) {

78 
	`HT_ERROR
("Property 'Hyperspace.Master.Dir'‚ot found.");

79 
	`ex™
(1);

82 ià(
dœÇme
[
	`¡¾’
(dirname)-1] == '/')

83 
¡r
 = 
¡d
::
	`¡ršg
(
dœÇme
, 
	`¡¾’
(dirname)-1);

85 
¡r
 = 
dœÇme
;

87 ià(
dœÇme
[0] == '/')

88 
m_ba£_dœ
 = 
¡r
;

90 
m_ba£_dœ
 = 
Sy¡em
::
š¡®lDœ
 + "/" + 
¡r
;

92 ià((
m_ba£_fd
 = ::
	`İ’
(
m_ba£_dœ
.
	`c_¡r
(), 
O_RDONLY
)) < 0) {

93 
	`HT_WARNF
("UÇbËØİ’ ba£ dœeùÜy '%s' - wÈü—‹.", 
m_ba£_dœ
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

94 ià(!
FeUts
::
	`mkdœs
(
m_ba£_dœ
.
	`c_¡r
())) {

95 
	`HT_ERRORF
("UÇbËØü—‹ ba£ dœeùÜy % - %s", 
m_ba£_dœ
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

96 
	`ex™
(1);

98 ià((
m_ba£_fd
 = ::
	`İ’
(
m_ba£_dœ
.
	`c_¡r
(), 
O_RDONLY
)) < 0) {

99 
	`HT_ERRORF
("UÇbËØİ’ ba£ dœeùÜy % - %s", 
m_ba£_dœ
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

100 
	`ex™
(1);

107 ià(
	`æock
(
m_ba£_fd
, 
LOCK_EX
 | 
LOCK_NB
) != 0) {

108 ià(
”ºo
 =ğ
EWOULDBLOCK
) {

109 
	`HT_ERRORF
("Ba£ dœeùÜy '%s' i locked by‡nÙh”…roûss.", 
m_ba£_dœ
.
	`c_¡r
());

112 
	`HT_ERRORF
("UÇbËØlock ba£ dœeùÜy '%s' - %s", 
m_ba£_dœ
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

114 
	`ex™
(1);

120 ià((
x©ŒL’
 = 
FeUts
::
	`g‘x©Œ
(
m_ba£_dœ
.
	`c_¡r
(), "g’”©iÚ", &
m_g’”©iÚ
, (
ušt32_t
))) < 0) {

121 ià(
”ºo
 =ğ
ENOATTR
) {

122 
û¼
 << "'g’”©iÚ'‡‰ribu‹‚Ù found oÀba£ dœ, c»©šg ..." << 
’dl
;

123 
m_g’”©iÚ
 = 1;

124 ià(
FeUts
::
	`£tx©Œ
(
m_ba£_dœ
.
	`c_¡r
(), "g’”©iÚ", &
m_g’”©iÚ
, (
ušt32_t
), 
XATTR_CREATE
) == -1) {

125 
	`HT_ERRORF
("ProbËm c»©šgƒx‹nded‡‰ribu‹ 'g’”©iÚ' oÀba£ dœ '%s' - %s", 
m_ba£_dœ
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

126 
	`ex™
(1);

130 
	`HT_ERRORF
("UÇbËØ»adƒx‹nded‡‰ribu‹ 'g’”©iÚ' oÀba£ dœ '%s' - %s", 
m_ba£_dœ
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

131 
	`ex™
(1);

135 
m_g’”©iÚ
++;

136 ià(
FeUts
::
	`£tx©Œ
(
m_ba£_dœ
.
	`c_¡r
(), "g’”©iÚ", &
m_g’”©iÚ
, (
ušt32_t
), 
XATTR_REPLACE
) == -1) {

137 
	`HT_ERRORF
("ProbËm c»©šgƒx‹nded‡‰ribu‹ 'g’”©iÚ' oÀba£ dœ '%s' - %s", 
m_ba£_dœ
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

138 
	`ex™
(1);

142 
NodeD©aPŒ
 
roÙNodePŒ
 = 
Ãw
 
	`NodeD©a
();

143 
roÙNodePŒ
->
Çme
 = "/";

144 
m_node_m­
["/"] = 
roÙNodePŒ
;

146 
pÜt
 = 
´İsPŒ
->
	`g‘_št
("Hy³r¥aû.Ma¡”.PÜt", 
DEFAULT_MASTER_PORT
);

147 
IÃtAddr
::
	`š™Ÿlize
(&
m_loÿl_addr
, 
INADDR_ANY
, 
pÜt
);

149 
m_k“·live_hªdËr_±r
.
	`»£t
Ğ
Ãw
 
	`S”v”K“·liveHªdËr
(
cÚnMªag”PŒ
->
	`g‘_comm
(), 
this
) );

150 
k“·liveHªdËrPŒ
 = 
m_k“·live_hªdËr_±r
;

152 ià(
m_v”bo£
) {

153 
cout
 << "Hy³r¥aû.L—£.IÁ”v®=" << 
m_Ëa£_š‹rv®
 << 
’dl
;

154 
cout
 << "Hy³r¥aû.K“pAlive.IÁ”v®=" << 
m_k“p_®ive_š‹rv®
 << 
’dl
;

155 
cout
 << "Hy³r¥aû.Ma¡”.Dœ=" << 
m_ba£_dœ
 << 
’dl
;

156 
cout
 << "G’”©iÚ=" << 
m_g’”©iÚ
 << 
’dl
;

159 
	}
}

162 
	gMa¡”
::~
	$Ma¡”
() {

163 ::
	`şo£
(
m_ba£_fd
);

165 
	}
}

168 
ušt64_t
 
	gMa¡”
::
	$ü—‹_£ssiÚ
(
sockaddr_š
 &
addr
) {

169 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_£ssiÚ_m­_mu‹x
);

170 
SessiÚD©aPŒ
 
£ssiÚPŒ
;

171 
ušt64_t
 
£ssiÚId
 = 
m_Ãxt_£ssiÚ_id
++;

172 
£ssiÚPŒ
 = 
Ãw
 
	`SessiÚD©a
(
addr
, 
m_Ëa£_š‹rv®
, 
£ssiÚId
);

173 
m_£ssiÚ_m­
[
£ssiÚId
] = 
£ssiÚPŒ
;

174 
m_£ssiÚ_h—p
.
	`push_back
(
£ssiÚPŒ
);

175  
£ssiÚId
;

176 
	}
}

179 
boŞ
 
	gMa¡”
::
	$g‘_£ssiÚ
(
ušt64_t
 
£ssiÚId
, 
SessiÚD©aPŒ
 &
£ssiÚPŒ
) {

180 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_£ssiÚ_m­_mu‹x
);

181 
SessiÚM­T
::
™”©Ü
 
™”
 = 
m_£ssiÚ_m­
.
	`fšd
(
£ssiÚId
);

182 ià(
™”
 =ğ
m_£ssiÚ_m­
.
	`’d
())

183  
çl£
;

184 
£ssiÚPŒ
 = (*
™”
).
£cÚd
;

185  
Œue
;

186 
	}
}

188 
	gMa¡”
::
	$de¡roy_£ssiÚ
(
ušt64_t
 
£ssiÚId
) {

189 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_£ssiÚ_m­_mu‹x
);

190 
SessiÚD©aPŒ
 
£ssiÚPŒ
;

191 
SessiÚM­T
::
™”©Ü
 
™”
 = 
m_£ssiÚ_m­
.
	`fšd
(
£ssiÚId
);

192 ià(
™”
 =ğ
m_£ssiÚ_m­
.
	`’d
())

194 
£ssiÚPŒ
 = (*
™”
).
£cÚd
;

195 
m_£ssiÚ_m­
.
	`”a£
(
£ssiÚId
);

196 
£ssiÚPŒ
->
	`expœe
();

198 
boo¡
::
	`xtime_g‘
(&
£ssiÚPŒ
->
expœeTime
, boo¡::
TIME_UTC
);

199 
	}
}

202 
	gMa¡”
::
	$»Ãw_£ssiÚ_Ëa£
(
ušt64_t
 
£ssiÚId
) {

203 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_£ssiÚ_m­_mu‹x
);

205 
SessiÚM­T
::
™”©Ü
 
™”
 = 
m_£ssiÚ_m­
.
	`fšd
(
£ssiÚId
);

206 ià(
™”
 =ğ
m_£ssiÚ_m­
.
	`’d
())

207  
E¼Ü
::
HYPERSPACE_EXPIRED_SESSION
;

209 ià(!(*
™”
).
£cÚd
->
	`»Ãw_Ëa£
())

210  
E¼Ü
::
HYPERSPACE_EXPIRED_SESSION
;

212  
E¼Ü
::
OK
;

213 
	}
}

215 
boŞ
 
	gMa¡”
::
	$Ãxt_expœed_£ssiÚ
(
SessiÚD©aPŒ
 &
£ssiÚPŒ
) {

216 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_£ssiÚ_m­_mu‹x
);

217 
ÉSessiÚD©a
 
compFunc
;

218 
boo¡
::
xtime
 
now
;

220 
boo¡
::
	`xtime_g‘
(&
now
, boo¡::
TIME_UTC
);

222 ià(
m_£ssiÚ_h—p
.
	`size
() > 0) {

223 
¡d
::
	`make_h—p
(
m_£ssiÚ_h—p
.
	`begš
(), m_£ssiÚ_h—p.
	`’d
(), 
compFunc
);

224 ià(
m_£ssiÚ_h—p
[0]->
	`is_expœed
(
now
)) {

225 
£ssiÚPŒ
 = 
m_£ssiÚ_h—p
[0];

226 
¡d
::
	`pİ_h—p
(
m_£ssiÚ_h—p
.
	`begš
(), m_£ssiÚ_h—p.
	`’d
(), 
compFunc
);

227 
m_£ssiÚ_h—p
.
	`»size
(m_£ssiÚ_h—p.
	`size
()-1);

228 
m_£ssiÚ_m­
.
	`”a£
(
£ssiÚPŒ
->
id
);

229  
Œue
;

232  
çl£
;

233 
	}
}

239 
	gMa¡”
::
	$»move_expœed_£ssiÚs
() {

240 
SessiÚD©aPŒ
 
£ssiÚPŒ
;

241 
”rÜ
;

242 
¡d
::
¡ršg
 
”rMsg
;

244 
	`Ãxt_expœed_£ssiÚ
(
£ssiÚPŒ
)) {

246 ià(
m_v”bo£
) {

247 
	`HT_INFOF
("Expœšg sessiÚ %Îd", 
£ssiÚPŒ
->
id
);

250 
£ssiÚPŒ
->
	`expœe
();

253 
boo¡
::
mu‹x
::
scİed_lock
 
	`¦ock
(
£ssiÚPŒ
->mutex);

254 
HªdËD©aPŒ
 
hªdËPŒ
;

255 
£t
<
ušt64_t
>::
™”©Ü
 
™”
 = 
£ssiÚPŒ
->
hªdËs
.
	`begš
(); i‹¸!ğ£ssiÚPŒ->hªdËs.
	`’d
(); iter++) {

256 ià(
m_v”bo£
) {

257 
	`HT_INFOF
("De¡royšg hªdË %Îd", *
™”
);

259 ià(!
	`de¡roy_hªdË
(*
™”
, &
”rÜ
, 
”rMsg
, 
çl£
)) {

260 
	`HT_ERRORF
("ProbËm de¡royšg hªdË - % (%s)", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
), 
”rMsg
.
	`c_¡r
());

263 
£ssiÚPŒ
->
hªdËs
.
	`ş—r
();

267 
	}
}

273 
	gMa¡”
::
	$ü—‹_hªdË
(
ušt64_t
 *
hªdËp
, 
HªdËD©aPŒ
 &
hªdËPŒ
) {

274 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_hªdË_m­_mu‹x
);

275 *
hªdËp
 = ++
m_Ãxt_hªdË_numb”
;

276 
hªdËPŒ
 = 
Ãw
 
	`HªdËD©a
();

277 
hªdËPŒ
->
id
 = *
hªdËp
;

278 
hªdËPŒ
->
locked
 = 
çl£
;

279 
m_hªdË_m­
[*
hªdËp
] = 
hªdËPŒ
;

280 
	}
}

285 
boŞ
 
	gMa¡”
::
	$g‘_hªdË_d©a
(
ušt64_t
 
hªdË
, 
HªdËD©aPŒ
 &
hªdËPŒ
) {

286 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_hªdË_m­_mu‹x
);

287 
HªdËM­T
::
™”©Ü
 
™”
 = 
m_hªdË_m­
.
	`fšd
(
hªdË
);

288 ià(
™”
 =ğ
m_hªdË_m­
.
	`’d
())

289  
çl£
;

290 
hªdËPŒ
 = (*
™”
).
£cÚd
;

291  
Œue
;

292 
	}
}

297 
boŞ
 
	gMa¡”
::
	$»move_hªdË_d©a
(
ušt64_t
 
hªdË
, 
HªdËD©aPŒ
 &
hªdËPŒ
) {

298 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_hªdË_m­_mu‹x
);

299 
HªdËM­T
::
™”©Ü
 
™”
 = 
m_hªdË_m­
.
	`fšd
(
hªdË
);

300 ià(
™”
 =ğ
m_hªdË_m­
.
	`’d
())

301  
çl£
;

302 
hªdËPŒ
 = (*
™”
).
£cÚd
;

303 
m_hªdË_m­
.
	`”a£
(
™”
);

304  
Œue
;

305 
	}
}

313 
	gMa¡”
::
	$mkdœ
(
Re¥Ú£C®lback
 *
cb
, 
ušt64_t
 
£ssiÚId
, cÚ¡ *
Çme
) {

314 
¡d
::
¡ršg
 
absName
;

315 
NodeD©aPŒ
 
·»ÁNodePŒ
;

316 
¡d
::
¡ršg
 
chdName
;

318 ià(
m_v”bo£
) {

319 
	`HT_INFOF
("mkdœ(£ssiÚId=%Îd,‚ame=%s)", 
£ssiÚId
, 
Çme
);

322 ià(!
	`fšd_·»Á_node
(
Çme
, 
·»ÁNodePŒ
, 
chdName
)) {

323 
cb
->
	`”rÜ
(
E¼Ü
::
HYPERSPACE_FILE_EXISTS
, "directory '/'ƒxists");

327 
	`as£¹
(
Çme
[0] =ğ'/' &&‚ame[
	`¡¾’
(name)-1] != '/');

330 
boo¡
::
mu‹x
::
scİed_lock
 
	`nodeLock
(
·»ÁNodePŒ
->mutex);

332 
absName
 = 
m_ba£_dœ
 + 
Çme
;

334 ià(::
	`mkdœ
(
absName
.
	`c_¡r
(), 0755) < 0) {

335 
	`»pÜt_”rÜ
(
cb
);

339 
Hy³r¥aûEv’tPŒ
 
	`ev’tPŒ
Ğ
Ãw
 
	`Ev’tNamed
(
EVENT_MASK_CHILD_NODE_ADDED
, 
chdName
) );

340 
	`d–iv”_ev’t_nÙifiÿtiÚs
(
·»ÁNodePŒ
.
	`g‘
(), 
ev’tPŒ
);

344 
cb
->
	`»¥Ú£_ok
();

345 
	}
}

352 
	gMa¡”
::
	$uÆšk
(
Re¥Ú£C®lback
 *
cb
, 
ušt64_t
 
£ssiÚId
, cÚ¡ *
Çme
) {

353 
¡d
::
¡ršg
 
absName
;

354 
¡©
 
¡©buf
;

355 
¡d
::
¡ršg
 
chdName
;

356 
NodeD©aPŒ
 
·»ÁNodePŒ
;

358 ià(
m_v”bo£
) {

359 
	`HT_INFOF
("uÆšk(£ssiÚId=%Îd,‚ame=%s)", 
£ssiÚId
, 
Çme
);

362 ià(!
	`¡rcmp
(
Çme
, "/")) {

363 
cb
->
	`”rÜ
(
E¼Ü
::
HYPERSPACE_PERMISSION_DENIED
, "Cannot„emove '/' directory");

367 ià(!
	`fšd_·»Á_node
(
Çme
, 
·»ÁNodePŒ
, 
chdName
)) {

368 
cb
->
	`”rÜ
(
E¼Ü
::
HYPERSPACE_BAD_PATHNAME
, 
Çme
);

372 
	`as£¹
(
Çme
[0] =ğ'/' &&‚ame[
	`¡¾’
(name)-1] != '/');

375 
boo¡
::
mu‹x
::
scİed_lock
 
	`nodeLock
(
·»ÁNodePŒ
->mutex);

377 
absName
 = 
m_ba£_dœ
 + 
Çme
;

379 ià(
	`¡©
(
absName
.
	`c_¡r
(), &
¡©buf
) < 0) {

380 
	`»pÜt_”rÜ
(
cb
);

384 ià(
¡©buf
.
¡_mode
 & 
S_IFDIR
) {

385 ià(
	`rmdœ
(
absName
.
	`c_¡r
()) < 0) {

386 
	`»pÜt_”rÜ
(
cb
);

391 ià(::
	`uÆšk
(
absName
.
	`c_¡r
()) < 0) {

392 
	`»pÜt_”rÜ
(
cb
);

400 
Hy³r¥aûEv’tPŒ
 
	`ev’tPŒ
Ğ
Ãw
 
	`Ev’tNamed
(
EVENT_MASK_CHILD_NODE_REMOVED
, 
chdName
) );

401 
	`d–iv”_ev’t_nÙifiÿtiÚs
(
·»ÁNodePŒ
.
	`g‘
(), 
ev’tPŒ
);

406 
cb
->
	`»¥Ú£_ok
();

407 
	}
}

414 
	gMa¡”
::
İ’
(
Re¥Ú£C®lbackO³n
 *
cb
, 
ušt64_t
 
£ssiÚId
, cÚ¡ *
Çme
, 
ušt32_t
 
æags
, ušt32_ˆ
ev’tMask
, 
¡d
::
veùÜ
<
A‰ribu‹T
> &
š™A‰rs
) {

415 
¡d
::
¡ršg
 
absName
;

416 
	g¡d
::
¡ršg
 
chdName
;

417 
SessiÚD©aPŒ
 
	g£ssiÚPŒ
;

418 
NodeD©aPŒ
 
	gnodePŒ
;

419 
NodeD©aPŒ
 
	g·»ÁNodePŒ
;

420 
HªdËD©aPŒ
 
	ghªdËPŒ
;

421 
boŞ
 
	gü—‹d
 = 
çl£
;

422 
boŞ
 
	gisDœeùÜy
 = 
çl£
;

423 
boŞ
 
	gexi¡ed
;

424 
ušt64_t
 
	ghªdË
;

425 
¡©
 
	g¡©buf
;

426 
	goæags
 = 0;

427 
ssize_t
 
	gËn
;

428 
boŞ
 
	glockNÙify
 = 
çl£
;

429 
ušt32_t
 
	glockMode
 = 0;

430 
ušt64_t
 
	glockG’”©iÚ
 = 0;

432 ià(
	gm_v”bo£
) {

433 
HT_INFOF
("İ’(£ssiÚId=%Îd, fÇme=%s, fÏgs=0x%x,ƒv’tMask=0x%x)", 
£ssiÚId
, 
Çme
, 
æags
, 
ev’tMask
);

434 
	gcout
 << 
	gæush
;

437 
as£¹
(
Çme
[0] == '/');

439 
	gabsName
 = 
m_ba£_dœ
 + 
Çme
;

441 ià(!
g‘_£ssiÚ
(
£ssiÚId
, 
£ssiÚPŒ
)) {

442 
	gcb
->
”rÜ
(
E¼Ü
::
HYPERSPACE_EXPIRED_SESSION
, "");

446 ià(!
fšd_·»Á_node
(
Çme
, 
·»ÁNodePŒ
, 
chdName
)) {

447 
	gcb
->
”rÜ
(
E¼Ü
::
HYPERSPACE_BAD_PATHNAME
, 
Çme
);

454 ià(!
¡rcmp
(
Çme
, "/"))

455 
	g·»ÁNodePŒ
 = 
Ãw
 
NodeD©a
();

457 
g‘_node
(
Çme
, 
nodePŒ
);

460 
	gboo¡
::
mu‹x
::
scİed_lock
 
·»ÁLock
(
·»ÁNodePŒ
->mutex);

461 
	gboo¡
::
mu‹x
::
scİed_lock
 
nodeLock
(
nodePŒ
->mutex);

463 ià((
	gæags
 & 
	gOPEN_FLAG_LOCK_SHARED
è=ğ
OPEN_FLAG_LOCK_SHARED
) {

464 ià(
nodePŒ
->
exşusiveLockHªdË
 != 0) {

465 
cb
->
”rÜ
(
E¼Ü
::
HYPERSPACE_LOCK_CONFLICT
, "");

468 
	glockMode
 = 
LOCK_MODE_SHARED
;

469 ià(
	gnodePŒ
->
	gsh¬edLockHªdËs
.
em±y
())

470 
	glockNÙify
 = 
Œue
;

472 ià((
	gæags
 & 
	gOPEN_FLAG_LOCK_EXCLUSIVE
è=ğ
OPEN_FLAG_LOCK_EXCLUSIVE
) {

473 ià(
nodePŒ
->
exşusiveLockHªdË
 !ğ0 || !nodePŒ->
sh¬edLockHªdËs
.
em±y
()) {

474 
cb
->
”rÜ
(
E¼Ü
::
HYPERSPACE_LOCK_CONFLICT
, "");

477 
	glockMode
 = 
LOCK_MODE_EXCLUSIVE
;

478 
	glockNÙify
 = 
Œue
;

481 ià(
¡©
(
absName
.
c_¡r
(), &
¡©buf
) != 0) {

482 ià(
”ºo
 =ğ
ENOENT
)

483 
exi¡ed
 = 
çl£
;

485 
»pÜt_”rÜ
(
cb
);

490 
	gexi¡ed
 = 
Œue
;

491 ià(
	g¡©buf
.
	g¡_mode
 & 
	gS_IFDIR
) {

496 
	gisDœeùÜy
 = 
Œue
;

497 
	goæags
 = 
O_RDONLY
;

498 #ià
defšed
(
__lšux__
)

499 
	goæags
 |ğ
O_DIRECTORY
;

504 ià(!
	gisDœeùÜy
)

505 
	goæags
 = 
O_RDWR
;

507 ià(
	gexi¡ed
 && (
	gæags
 & 
	gOPEN_FLAG_CREATE
è&& (æag & 
	gOPEN_FLAG_EXCL
)) {

508 
	gcb
->
”rÜ
(
E¼Ü
::
HYPERSPACE_FILE_EXISTS
, "mode=CREATE|EXCL");

512 ià(
	gnodePŒ
->
	gfd
 < 0) {

514 ià(
	gexi¡ed
 && (
	gæags
 & 
	gOPEN_FLAG_TEMP
)) {

515 
	gcb
->
”rÜ
(
E¼Ü
::
HYPERSPACE_FILE_EXISTS
, "Unableo open TEMP file because itƒxists‡nd is…ermanent");

519 ià(!
	gexi¡ed
) {

520 ià(
	gæags
 & 
	gOPEN_FLAG_CREATE
)

521 
	goæags
 |ğ
O_CREAT
;

522 ià(
	gæags
 & 
	gOPEN_FLAG_EXCL
)

523 
	goæags
 |ğ
O_EXCL
;

525 
	gnodePŒ
->
	gfd
 = ::
İ’
(
absName
.
c_¡r
(), 
oæags
, 0644);

526 ià(
	gnodePŒ
->
	gfd
 < 0) {

527 
HT_ERRORF
("İ’(%s, 0x%x, 0644èçed (”ºo=%dè- %s", 
absName
.
c_¡r
(), 
oæags
, 
”ºo
, 
¡»¼Ü
(errno));

528 
»pÜt_”rÜ
(
cb
);

534 
	gËn
 = 
FeUts
::
fg‘x©Œ
(
nodePŒ
->
fd
, "lock.g’”©iÚ", &nodePŒ->
lockG’”©iÚ
, (
ušt64_t
));

535 ià(
	gËn
 < 0) {

536 ià(
	g”ºo
 =ğ
ENOATTR
) {

537 
nodePŒ
->
lockG’”©iÚ
 = 1;

538 ià(
	gFeUts
::
f£tx©Œ
(
nodePŒ
->
fd
, "lock.g’”©iÚ", &nodePŒ->
lockG’”©iÚ
, (
ušt64_t
), 0) == -1) {

539 
HT_ERRORF
("Problem creatingƒxtended‡ttribute 'lock.generation' on file '%s' - %s",

540 
Çme
, 
¡»¼Ü
(
”ºo
));

541 
	gDUMP_CORE
;

545 
HT_ERRORF
("Problem„eadingƒxtended‡ttribute 'lock.generation' on file '%s' - %s",

546 
Çme
, 
¡»¼Ü
(
”ºo
));

547 
	gDUMP_CORE
;

549 
	gËn
 = (
št64_t
);

551 
as£¹
(
Ën
 =ğ(
št64_t
));

556 
size_t
 
	gi
=0; i<
	gš™A‰rs
.
size
(); i++) {

557 ià(
	gFeUts
::
f£tx©Œ
(
nodePŒ
->
fd
, 
š™A‰rs
[
i
].
Çme
, in™A‰rs[i].
v®ue
, in™A‰rs[i].
v®ueL’
, 0) == -1) {

558 
HT_ERRORF
("Problem creatingƒxtended‡ttribute '%s' on file '%s' - %s",

559 
š™A‰rs
[
i
].
Çme
,‚ame, 
¡»¼Ü
(
”ºo
));

560 
	gDUMP_CORE
;

564 ià(
	gæags
 & 
	gOPEN_FLAG_TEMP
) {

565 
	gnodePŒ
->
	g•hem”®
 = 
Œue
;

566 ::
uÆšk
(
absName
.
c_¡r
());

571 ià(
	gexi¡ed
 && (
	gæags
 & 
	gOPEN_FLAG_TEMP
è&& !
	gnodePŒ
->
	g•hem”®
) {

572 
	gcb
->
”rÜ
(
E¼Ü
::
HYPERSPACE_FILE_EXISTS
, "Unableo open TEMP file because itƒxists‡nd is…ermanent");

577 ià(!
	gexi¡ed
)

578 
	gü—‹d
 = 
Œue
;

580 
ü—‹_hªdË
(&
hªdË
, 
hªdËPŒ
);

582 
	ghªdËPŒ
->
	gnode
 = 
nodePŒ
.
g‘
();

583 
	ghªdËPŒ
->
	gİ’FÏgs
 = 
æags
;

584 
	ghªdËPŒ
->
	gev’tMask
 = 
ev’tMask
;

585 
	ghªdËPŒ
->
	g£ssiÚPŒ
 = 
£ssiÚPŒ
;

587 
	g£ssiÚPŒ
->
add_hªdË
(
hªdË
);

589 ià(
	gü—‹d
) {

590 
Hy³r¥aûEv’tPŒ
 
ev’tPŒ
Ğ
Ãw
 
Ev’tNamed
(
EVENT_MASK_CHILD_NODE_ADDED
, 
chdName
) );

591 
d–iv”_ev’t_nÙifiÿtiÚs
(
·»ÁNodePŒ
.
g‘
(), 
ev’tPŒ
);

597 ià(
	glockMode
 != 0) {

598 
hªdËPŒ
->
node
->
lockG’”©iÚ
++;

599 ià(
	gFeUts
::
f£tx©Œ
(
hªdËPŒ
->
node
->
fd
, "lock.g’”©iÚ", &hªdËPŒ->node->
lockG’”©iÚ
, (
ušt64_t
), 0) == -1) {

600 
HT_ERRORF
("Problem creatingƒxtended‡ttribute 'lock.generation' on file '%s' - %s",

601 
hªdËPŒ
->
node
->
Çme
.
c_¡r
(), 
¡»¼Ü
(
”ºo
));

602 
ex™
(1);

604 
	glockG’”©iÚ
 = 
hªdËPŒ
->
node
->
lockG’”©iÚ
;

605 
	ghªdËPŒ
->
	gnode
->
	gcu¼’tLockMode
 = 
lockMode
;

607 
lock_hªdË
(
hªdËPŒ
, 
lockMode
);

610 ià(
	glockNÙify
) {

611 
Hy³r¥aûEv’tPŒ
 
ev’tPŒ
Ğ
Ãw
 
Ev’tLockAcquœed
(
lockMode
) );

612 
d–iv”_ev’t_nÙifiÿtiÚs
(
hªdËPŒ
->
node
, 
ev’tPŒ
);

616 
	ghªdËPŒ
->
	gnode
->
add_hªdË
(
hªdË
, 
hªdËPŒ
);

620 
	gcb
->
»¥Ú£
(
hªdË
, 
ü—‹d
, 
lockG’”©iÚ
);

627 
	gMa¡”
::
	$şo£
(
Re¥Ú£C®lback
 *
cb
, 
ušt64_t
 
£ssiÚId
, ušt64_ˆ
hªdË
) {

628 
SessiÚD©aPŒ
 
£ssiÚPŒ
;

629 
”rÜ
;

630 
¡d
::
¡ršg
 
”rMsg
;

632 ià(
m_v”bo£
) {

633 
	`HT_INFOF
("şo£(£ssiÚ=%Îd, hªdË=%Îd)", 
£ssiÚId
, 
hªdË
);

636 ià(!
	`g‘_£ssiÚ
(
£ssiÚId
, 
£ssiÚPŒ
)) {

637 
cb
->
	`”rÜ
(
E¼Ü
::
HYPERSPACE_EXPIRED_SESSION
, "");

642 
boo¡
::
mu‹x
::
scİed_lock
 
	`¦ock
(
£ssiÚPŒ
->mutex);

643 
size_t
 
n
 = 
£ssiÚPŒ
->
hªdËs
.
	`”a£
(
hªdË
);

644 ià(
n
) {

645 ià(!
	`de¡roy_hªdË
(
hªdË
, &
”rÜ
, 
”rMsg
)) {

646 
cb
->
	`”rÜ
(
”rÜ
, 
”rMsg
);

652 ià((
”rÜ
 = 
cb
->
	`»¥Ú£_ok
()è!ğ
E¼Ü
::
OK
) {

653 
	`HT_ERRORF
("ProbËm s’dšg back„e¥Ú£ - %s", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

655 
	}
}

662 
	gMa¡”
::
	$©Œ_£t
(
Re¥Ú£C®lback
 *
cb
, 
ušt64_t
 
£ssiÚId
, ušt64_ˆ
hªdË
, cÚ¡ *
Çme
, cÚ¡ *
v®ue
, 
size_t
 
v®ueL’
) {

663 
SessiÚD©aPŒ
 
£ssiÚPŒ
;

664 
HªdËD©aPŒ
 
hªdËPŒ
;

665 
”rÜ
;

667 ià(
m_v”bo£
) {

668 
	`HT_INFOF
("©Œ£t(£ssiÚ=%Îd, hªdË=%Îd,‚ame=%s, v®ueL’=%d)", 
£ssiÚId
, 
hªdË
, 
Çme
, 
v®ueL’
);

671 ià(!
	`g‘_£ssiÚ
(
£ssiÚId
, 
£ssiÚPŒ
)) {

672 
cb
->
	`”rÜ
(
E¼Ü
::
HYPERSPACE_EXPIRED_SESSION
, "");

676 ià(!
	`g‘_hªdË_d©a
(
hªdË
, 
hªdËPŒ
)) {

677 
cb
->
	`”rÜ
(
E¼Ü
::
HYPERSPACE_INVALID_HANDLE
, 
¡d
::
	`¡ršg
("hªdË="è+ 
hªdË
);

682 
boo¡
::
mu‹x
::
scİed_lock
 
	`nodeLock
(
hªdËPŒ
->
node
->mutex);

684 ià(
FeUts
::
	`f£tx©Œ
(
hªdËPŒ
->
node
->
fd
, 
Çme
, 
v®ue
, 
v®ueL’
, 0) == -1) {

685 
	`HT_ERRORF
("Problem creatingƒxtended‡ttribute '%s' on file '%s' - %s",

686 
Çme
, 
hªdËPŒ
->
node
->Çme.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

687 
DUMP_CORE
;

690 
Hy³r¥aûEv’tPŒ
 
	`ev’tPŒ
Ğ
Ãw
 
	`Ev’tNamed
(
EVENT_MASK_ATTR_SET
, 
Çme
) );

691 
	`d–iv”_ev’t_nÙifiÿtiÚs
(
hªdËPŒ
->
node
, 
ev’tPŒ
);

694 ià((
”rÜ
 = 
cb
->
	`»¥Ú£_ok
()è!ğ
E¼Ü
::
OK
) {

695 
	`HT_ERRORF
("ProbËm s’dšg back„e¥Ú£ - %s", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

698 
	}
}

704 
	gMa¡”
::
	$©Œ_g‘
(
Re¥Ú£C®lbackA‰rG‘
 *
cb
, 
ušt64_t
 
£ssiÚId
, ušt64_ˆ
hªdË
, cÚ¡ *
Çme
) {

705 
SessiÚD©aPŒ
 
£ssiÚPŒ
;

706 
HªdËD©aPŒ
 
hªdËPŒ
;

707 
”rÜ
;

708 
®’
;

709 
ušt8_t
 *
buf
 = 0;

711 ià(
m_v”bo£
) {

712 
	`HT_INFOF
("©Œg‘(£ssiÚ=%Îd, hªdË=%Îd,‚ame=%s)", 
£ssiÚId
, 
hªdË
, 
Çme
);

715 ià(!
	`g‘_£ssiÚ
(
£ssiÚId
, 
£ssiÚPŒ
)) {

716 
cb
->
	`”rÜ
(
E¼Ü
::
HYPERSPACE_EXPIRED_SESSION
, "");

720 ià(!
	`g‘_hªdË_d©a
(
hªdË
, 
hªdËPŒ
)) {

721 
cb
->
	`”rÜ
(
E¼Ü
::
HYPERSPACE_INVALID_HANDLE
, 
¡d
::
	`¡ršg
("hªdË="è+ 
hªdË
);

726 
boo¡
::
mu‹x
::
scİed_lock
 
	`nodeLock
(
hªdËPŒ
->
node
->mutex);

728 ià((
®’
 = 
FeUts
::
	`fg‘x©Œ
(
hªdËPŒ
->
node
->
fd
, 
Çme
, 0, 0)) < 0) {

729 
	`HT_ERRORF
("Problem determining size ofƒxtended‡ttribute '%s' on file '%s' - %s",

730 
Çme
, 
hªdËPŒ
->
node
->Çme.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

731 
	`»pÜt_”rÜ
(
cb
);

735 
buf
 = 
Ãw
 
ušt8_t
 [ 
®’
 + 8 ];

737 ià((
®’
 = 
FeUts
::
	`fg‘x©Œ
(
hªdËPŒ
->
node
->
fd
, 
Çme
, 
buf
,‡len)) < 0) {

738 
	`HT_ERRORF
("Problem determining size ofƒxtended‡ttribute '%s' on file '%s' - %s",

739 
Çme
, 
hªdËPŒ
->
node
->Çme.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

740 
DUMP_CORE
;

744 ià((
”rÜ
 = 
cb
->
	`»¥Ú£
(
buf
, (
ušt32_t
)
®’
)è!ğ
E¼Ü
::
OK
) {

745 
	`HT_ERRORF
("ProbËm s’dšg back„e¥Ú£ - %s", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

748 
	}
}

752 
	gMa¡”
::
	$©Œ_d–
(
Re¥Ú£C®lback
 *
cb
, 
ušt64_t
 
£ssiÚId
, ušt64_ˆ
hªdË
, cÚ¡ *
Çme
) {

753 
SessiÚD©aPŒ
 
£ssiÚPŒ
;

754 
HªdËD©aPŒ
 
hªdËPŒ
;

755 
”rÜ
;

757 ià(
m_v”bo£
) {

758 
	`HT_INFOF
("©Œd–(£ssiÚ=%Îd, hªdË=%Îd,‚ame=%s)", 
£ssiÚId
, 
hªdË
, 
Çme
);

761 ià(!
	`g‘_£ssiÚ
(
£ssiÚId
, 
£ssiÚPŒ
)) {

762 
cb
->
	`”rÜ
(
E¼Ü
::
HYPERSPACE_EXPIRED_SESSION
, "");

766 ià(!
	`g‘_hªdË_d©a
(
hªdË
, 
hªdËPŒ
)) {

767 
cb
->
	`”rÜ
(
E¼Ü
::
HYPERSPACE_INVALID_HANDLE
, 
¡d
::
	`¡ršg
("hªdË="è+ 
hªdË
);

772 
boo¡
::
mu‹x
::
scİed_lock
 
	`nodeLock
(
hªdËPŒ
->
node
->mutex);

774 ià(
FeUts
::
	`äemovex©Œ
(
hªdËPŒ
->
node
->
fd
, 
Çme
) == -1) {

775 
	`HT_ERRORF
("Problem„emovingƒxtended‡ttribute '%s' on file '%s' - %s",

776 
Çme
, 
hªdËPŒ
->
node
->Çme.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

777 
	`»pÜt_”rÜ
(
cb
);

781 
Hy³r¥aûEv’tPŒ
 
	`ev’tPŒ
Ğ
Ãw
 
	`Ev’tNamed
(
EVENT_MASK_ATTR_DEL
, 
Çme
) );

782 
	`d–iv”_ev’t_nÙifiÿtiÚs
(
hªdËPŒ
->
node
, 
ev’tPŒ
);

785 ià((
”rÜ
 = 
cb
->
	`»¥Ú£_ok
()è!ğ
E¼Ü
::
OK
) {

786 
	`HT_ERRORF
("ProbËm s’dšg back„e¥Ú£ - %s", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

789 
	}
}

792 
	gMa¡”
::
	$exi¡s
(
Re¥Ú£C®lbackExi¡s
 *
cb
, 
ušt64_t
 
£ssiÚId
, cÚ¡ *
Çme
) {

793 
¡d
::
¡ršg
 
absName
;

794 
”rÜ
;

796 ià(
m_v”bo£
) {

797 
	`HT_INFOF
("exi¡s(£ssiÚId=%Îd,‚ame=%s)", 
£ssiÚId
, 
Çme
);

800 
	`as£¹
(
Çme
[0] =ğ'/' &&‚ame[
	`¡¾’
(name)-1] != '/');

802 
absName
 = 
m_ba£_dœ
 + 
Çme
;

804 ià((
”rÜ
 = 
cb
->
	`»¥Ú£
Ğ
FeUts
::
	`exi¡s
(
absName
.
	`c_¡r
()è)è!ğ
E¼Ü
::
OK
) {

805 
	`HT_ERRORF
("ProbËm s’dšg back„e¥Ú£ - %s", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

807 
	}
}

810 
	gMa¡”
::
	$»addœ
(
Re¥Ú£C®lbackR—ddœ
 *
cb
, 
ušt64_t
 
£ssiÚId
, ušt64_ˆ
hªdË
) {

811 
¡d
::
¡ršg
 
absName
;

812 
SessiÚD©aPŒ
 
£ssiÚPŒ
;

813 
HªdËD©aPŒ
 
hªdËPŒ
;

814 
DœEÁryT
 
d’Œy
;

815 
¡d
::
veùÜ
<
DœEÁryT
> 
li¡šg
;

817 ià(
m_v”bo£
) {

818 
	`HT_INFOF
("»addœ(£ssiÚ=%Îd, hªdË=%Îd)", 
£ssiÚId
, 
hªdË
);

821 ià(!
	`g‘_£ssiÚ
(
£ssiÚId
, 
£ssiÚPŒ
)) {

822 
cb
->
	`”rÜ
(
E¼Ü
::
HYPERSPACE_EXPIRED_SESSION
, "");

826 ià(!
	`g‘_hªdË_d©a
(
hªdË
, 
hªdËPŒ
)) {

827 
cb
->
	`”rÜ
(
E¼Ü
::
HYPERSPACE_INVALID_HANDLE
, 
¡d
::
	`¡ršg
("hªdË="è+ 
hªdË
);

832 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
hªdËPŒ
->
node
->mutex);

834 
absName
 = 
m_ba£_dœ
 + 
hªdËPŒ
->
node
->
Çme
;

836 
DIR
 *
dœp
 = 
	`İ’dœ
(
absName
.
	`c_¡r
());

838 ià(
dœp
 == 0) {

839 
	`»pÜt_”rÜ
(
cb
);

840 
	`HT_ERRORF
("İ’dœ('%s'èçed - %s", 
absName
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

844 
dœ’t
 
d’t
;

845 
dœ’t
 *
dp
;

847 ià(
	`»addœ_r
(
dœp
, &
d’t
, &
dp
) != 0) {

848 
	`»pÜt_”rÜ
(
cb
);

849 
	`HT_ERRORF
("»addœ('%s'èçed - %s", 
absName
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

850 ()
	`şo£dœ
(
dœp
);

854 
dp
 != 0) {

856 ià(
dp
->
d_Çme
[0] !ğ0 && 
	`¡rcmp
(dp->d_name, ".") && strcmp(dp->d_name, "..")) {

857 
d’Œy
.
isDœeùÜy
 = (
dp
->
d_ty³
 =ğ
DT_DIR
);

858 
d’Œy
.
Çme
 = 
dp
->
d_Çme
;

859 
li¡šg
.
	`push_back
(
d’Œy
);

862 ià(
	`»addœ_r
(
dœp
, &
d’t
, &
dp
) != 0) {

863 
	`»pÜt_”rÜ
(
cb
);

864 
	`HT_ERRORF
("»addœ('%s'èçed - %s", 
absName
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

865 ()
	`şo£dœ
(
dœp
);

869 ()
	`şo£dœ
(
dœp
);

873 
cb
->
	`»¥Ú£
(
li¡šg
);

874 
	}
}

878 
	gMa¡”
::
	$lock
(
Re¥Ú£C®lbackLock
 *
cb
, 
ušt64_t
 
£ssiÚId
, ušt64_ˆ
hªdË
, 
ušt32_t
 
mode
, 
boŞ
 
ŒyAcquœe
) {

879 
SessiÚD©aPŒ
 
£ssiÚPŒ
;

880 
HªdËD©aPŒ
 
hªdËPŒ
;

881 
boŞ
 
nÙify
 = 
Œue
;

883 ià(
m_v”bo£
) {

884 
	`HT_INFOF
("lock(£ssiÚ=%Îd, hªdË=%Îd, mode=0x%x,ryAcquœe=%d)", 
£ssiÚId
, 
hªdË
, 
mode
, 
ŒyAcquœe
);

887 ià(!
	`g‘_£ssiÚ
(
£ssiÚId
, 
£ssiÚPŒ
)) {

888 
cb
->
	`”rÜ
(
E¼Ü
::
HYPERSPACE_EXPIRED_SESSION
, "");

892 ià(!
	`g‘_hªdË_d©a
(
hªdË
, 
hªdËPŒ
)) {

893 
cb
->
	`”rÜ
(
E¼Ü
::
HYPERSPACE_INVALID_HANDLE
, 
¡d
::
	`¡ršg
("hªdË="è+ 
hªdË
);

897 ià(!(
hªdËPŒ
->
İ’FÏgs
 & 
OPEN_FLAG_LOCK
)) {

898 
cb
->
	`”rÜ
(
E¼Ü
::
HYPERSPACE_MODE_RESTRICTION
, "handle‚ot open for†ocking");

902 ià(!(
hªdËPŒ
->
İ’FÏgs
 & 
OPEN_FLAG_WRITE
)) {

903 
cb
->
	`”rÜ
(
E¼Ü
::
HYPERSPACE_MODE_RESTRICTION
, "handle‚ot open for writing");

908 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
hªdËPŒ
->
node
->mutex);

910 ià(
hªdËPŒ
->
node
->
cu¼’tLockMode
 =ğ
LOCK_MODE_EXCLUSIVE
) {

911 ià(
ŒyAcquœe
)

912 
cb
->
	`»¥Ú£
(
LOCK_STATUS_BUSY
);

914 
hªdËPŒ
->
node
->
³ndšgLockReque¡s
.
	`push_back
Ğ
	`LockReque¡
(
hªdË
, 
mode
) );

915 
cb
->
	`»¥Ú£
(
LOCK_STATUS_PENDING
);

919 ià(
hªdËPŒ
->
node
->
cu¼’tLockMode
 =ğ
LOCK_MODE_SHARED
) {

920 ià(
mode
 =ğ
LOCK_MODE_EXCLUSIVE
) {

921 ià(
ŒyAcquœe
)

922 
cb
->
	`»¥Ú£
(
LOCK_STATUS_BUSY
);

924 
hªdËPŒ
->
node
->
³ndšgLockReque¡s
.
	`push_back
Ğ
	`LockReque¡
(
hªdË
, 
mode
) );

925 
cb
->
	`»¥Ú£
(
LOCK_STATUS_PENDING
);

930 
	`as£¹
(
mode
 =ğ
LOCK_MODE_SHARED
);

932 ià(!
hªdËPŒ
->
node
->
³ndšgLockReque¡s
.
	`em±y
()) {

933 
hªdËPŒ
->
node
->
³ndšgLockReque¡s
.
	`push_back
Ğ
	`LockReque¡
(
hªdË
, 
mode
) );

934 
cb
->
	`»¥Ú£
(
LOCK_STATUS_PENDING
);

941 ià(
mode
 =ğ
LOCK_MODE_SHARED
 && !
hªdËPŒ
->
node
->
sh¬edLockHªdËs
.
	`em±y
())

942 
nÙify
 = 
çl£
;

944 
hªdËPŒ
->
node
->
lockG’”©iÚ
++;

945 ià(
FeUts
::
	`f£tx©Œ
(
hªdËPŒ
->
node
->
fd
, "lock.g’”©iÚ", &hªdËPŒ->node->
lockG’”©iÚ
, (
ušt64_t
), 0) == -1) {

946 
	`HT_ERRORF
("Problem creatingƒxtended‡ttribute 'lock.generation' on file '%s' - %s",

947 
hªdËPŒ
->
node
->
Çme
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

948 
	`ex™
(1);

950 
hªdËPŒ
->
node
->
cu¼’tLockMode
 = 
mode
;

952 
	`lock_hªdË
(
hªdËPŒ
, 
mode
);

955 ià(
nÙify
) {

956 
Hy³r¥aûEv’tPŒ
 
	`ev’tPŒ
Ğ
Ãw
 
	`Ev’tLockAcquœed
(
mode
) );

957 
	`d–iv”_ev’t_nÙifiÿtiÚs
(
hªdËPŒ
->
node
, 
ev’tPŒ
);

960 
cb
->
	`»¥Ú£
(
LOCK_STATUS_GRANTED
, 
hªdËPŒ
->
node
->
lockG’”©iÚ
);

962 
	}
}

967 
	gMa¡”
::
	$lock_hªdË
(
HªdËD©aPŒ
 &
hªdËPŒ
, 
ušt32_t
 
mode
) {

968 ià(
mode
 =ğ
LOCK_MODE_SHARED
)

969 
hªdËPŒ
->
node
->
sh¬edLockHªdËs
.
	`š£¹
(hªdËPŒ->
id
);

971 
	`as£¹
(
mode
 =ğ
LOCK_MODE_EXCLUSIVE
);

972 
hªdËPŒ
->
node
->
exşusiveLockHªdË
 = hªdËPŒ->
id
;

974 
hªdËPŒ
->
locked
 = 
Œue
;

975 
	}
}

980 
	gMa¡”
::
	$lock_hªdË_w™h_nÙifiÿtiÚ
(
HªdËD©aPŒ
 &
hªdËPŒ
, 
ušt32_t
 
mode
, 
boŞ
 
wa™FÜNÙify
) {

982 
	`lock_hªdË
(
hªdËPŒ
, 
mode
);

986 
Hy³r¥aûEv’tPŒ
 
	`ev’tPŒ
Ğ
Ãw
 
	`Ev’tLockG¿Áed
(
mode
, 
hªdËPŒ
->
node
->
lockG’”©iÚ
) );

987 
	`d–iv”_ev’t_nÙifiÿtiÚ
(
hªdËPŒ
, 
ev’tPŒ
, 
wa™FÜNÙify
);

990 
	}
}

997 
	gMa¡”
::
	$»Ëa£
(
Re¥Ú£C®lback
 *
cb
, 
ušt64_t
 
£ssiÚId
, ušt64_ˆ
hªdË
) {

998 
SessiÚD©aPŒ
 
£ssiÚPŒ
;

999 
HªdËD©aPŒ
 
hªdËPŒ
;

1001 ià(
m_v”bo£
) {

1002 
	`HT_INFOF
("»Ëa£(£ssiÚ=%Îd, hªdË=%Îd)", 
£ssiÚId
, 
hªdË
);

1005 ià(!
	`g‘_£ssiÚ
(
£ssiÚId
, 
£ssiÚPŒ
)) {

1006 
cb
->
	`”rÜ
(
E¼Ü
::
HYPERSPACE_EXPIRED_SESSION
, "");

1010 ià(!
	`g‘_hªdË_d©a
(
hªdË
, 
hªdËPŒ
)) {

1011 
cb
->
	`”rÜ
(
E¼Ü
::
HYPERSPACE_INVALID_HANDLE
, 
¡d
::
	`¡ršg
("hªdË="è+ 
hªdË
);

1015 
	`»Ëa£_lock
(
hªdËPŒ
);

1017 
cb
->
	`»¥Ú£_ok
();

1018 
	}
}

1021 
	gMa¡”
::
	$»Ëa£_lock
(
HªdËD©aPŒ
 &
hªdËPŒ
, 
boŞ
 
wa™FÜNÙify
) {

1022 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
hªdËPŒ
->
node
->mutex);

1023 
veùÜ
<
HªdËD©aPŒ
> 
ÃxtLockHªdËs
;

1024 
ÃxtMode
 = 0;

1026 ià(
hªdËPŒ
->
locked
) {

1027 ià(
hªdËPŒ
->
node
->
exşusiveLockHªdË
 != 0) {

1028 
	`as£¹
(
hªdËPŒ
->
id
 =ğhªdËPŒ->
node
->
exşusiveLockHªdË
);

1029 
hªdËPŒ
->
node
->
exşusiveLockHªdË
 = 0;

1032 
couÁ
 = 
hªdËPŒ
->
node
->
sh¬edLockHªdËs
.
	`”a£
(hªdËPŒ->
id
);

1033 
	`as£¹
(
couÁ
);

1034 ()
couÁ
;

1036 
hªdËPŒ
->
locked
 = 
çl£
;

1042 ià(
hªdËPŒ
->
node
->
sh¬edLockHªdËs
.
	`em±y
()) {

1043 
	`HT_INFO
("Abouto deliver†ock„eleased‚otifications");

1044 
Hy³r¥aûEv’tPŒ
 
	`ev’tPŒ
Ğ
Ãw
 
	`Ev’tLockR–—£d
() );

1045 
	`d–iv”_ev’t_nÙifiÿtiÚs
(
hªdËPŒ
->
node
, 
ev’tPŒ
, 
wa™FÜNÙify
);

1046 
	`HT_INFO
("Finished delivering†ock„eleased‚otifications");

1049 
hªdËPŒ
->
node
->
cu¼’tLockMode
 = 0;

1051 ià(!
hªdËPŒ
->
node
->
³ndšgLockReque¡s
.
	`em±y
()) {

1052 
HªdËD©aPŒ
 
ÃxtHªdËPŒ
;

1053 cÚ¡ 
LockReque¡
 &
äÚtLockReq
 = 
hªdËPŒ
->
node
->
³ndšgLockReque¡s
.
	`äÚt
();

1054 ià(
äÚtLockReq
.
mode
 =ğ
LOCK_MODE_EXCLUSIVE
) {

1055 
ÃxtMode
 = 
LOCK_MODE_EXCLUSIVE
;

1056 ià(
	`g‘_hªdË_d©a
(
äÚtLockReq
.
hªdË
, 
ÃxtHªdËPŒ
))

1057 
ÃxtLockHªdËs
.
	`push_back
(
ÃxtHªdËPŒ
);

1058 
hªdËPŒ
->
node
->
³ndšgLockReque¡s
.
	`pİ_äÚt
();

1061 
ÃxtMode
 = 
LOCK_MODE_SHARED
;

1063 cÚ¡ 
LockReque¡
 &
lock»q
 = 
hªdËPŒ
->
node
->
³ndšgLockReque¡s
.
	`äÚt
();

1064 ià(
lock»q
.
mode
 !ğ
LOCK_MODE_SHARED
)

1066 ià(
	`g‘_hªdË_d©a
(
lock»q
.
hªdË
, 
ÃxtHªdËPŒ
))

1067 
ÃxtLockHªdËs
.
	`push_back
(
ÃxtHªdËPŒ
);

1068 
hªdËPŒ
->
node
->
³ndšgLockReque¡s
.
	`pİ_äÚt
();

1069 } !
hªdËPŒ
->
node
->
³ndšgLockReque¡s
.
	`em±y
());

1072 ià(!
ÃxtLockHªdËs
.
	`em±y
()) {

1074 
hªdËPŒ
->
node
->
lockG’”©iÚ
++;

1075 ià(
FeUts
::
	`f£tx©Œ
(
hªdËPŒ
->
node
->
fd
, "lock.g’”©iÚ", &hªdËPŒ->node->
lockG’”©iÚ
, (
ušt64_t
), 0) == -1) {

1076 
	`HT_ERRORF
("Problem creatingƒxtended‡ttribute 'lock.generation' on file '%s' - %s",

1077 
hªdËPŒ
->
node
->
Çme
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

1078 
	`ex™
(1);

1081 
hªdËPŒ
->
node
->
cu¼’tLockMode
 = 
ÃxtMode
;

1083 
size_t
 
i
=0; i<
ÃxtLockHªdËs
.
	`size
(); i++) {

1084 
	`as£¹
(
hªdËPŒ
->
id
 !ğ
ÃxtLockHªdËs
[
i
]->id);

1085 
	`lock_hªdË_w™h_nÙifiÿtiÚ
(
ÃxtLockHªdËs
[
i
], 
ÃxtMode
, 
wa™FÜNÙify
);

1090 
Hy³r¥aûEv’tPŒ
 
	`ev’tPŒ
Ğ
Ãw
 
	`Ev’tLockAcquœed
(
ÃxtMode
) );

1091 
	`d–iv”_ev’t_nÙifiÿtiÚs
(
hªdËPŒ
->
node
, 
ev’tPŒ
, 
wa™FÜNÙify
);

1098 
	}
}

1104 
	gMa¡”
::
	$»pÜt_”rÜ
(
Re¥Ú£C®lback
 *
cb
) {

1105 
”rbuf
[128];

1106 
”rbuf
[0] = 0;

1107 
	`¡»¼Ü_r
(
”ºo
, 
”rbuf
, 128);

1108 ià(
”ºo
 =ğ
ENOTDIR
 ||ƒ¼nØ=ğ
ENAMETOOLONG
 ||ƒ¼nØ=ğ
ENOENT
)

1109 
cb
->
	`”rÜ
(
E¼Ü
::
HYPERSPACE_BAD_PATHNAME
, 
”rbuf
);

1110 ià(
”ºo
 =ğ
EACCES
 ||ƒ¼nØ=ğ
EPERM
)

1111 
cb
->
	`”rÜ
(
E¼Ü
::
HYPERSPACE_PERMISSION_DENIED
, 
”rbuf
);

1112 ià(
”ºo
 =ğ
EEXIST
)

1113 
cb
->
	`”rÜ
(
E¼Ü
::
HYPERSPACE_FILE_EXISTS
, 
”rbuf
);

1114 ià(
”ºo
 =ğ
ENOATTR
)

1115 
cb
->
	`”rÜ
(
E¼Ü
::
HYPERSPACE_ATTR_NOT_FOUND
, 
”rbuf
);

1116 ià(
”ºo
 =ğ
EISDIR
)

1117 
cb
->
	`”rÜ
(
E¼Ü
::
HYPERSPACE_IS_DIRECTORY
, 
”rbuf
);

1119 
	`HT_ERRORF
("UnknowÀ”rÜ,ƒ¼nØğ%d", 
”ºo
);

1120 
cb
->
	`”rÜ
(
E¼Ü
::
HYPERSPACE_IO_ERROR
, 
”rbuf
);

1122 
	}
}

1129 
	gMa¡”
::
nÜm®ize_Çme
(
¡d
::
¡ršg
 
Çme
, std::¡ršg &
nÜm®
) {

1130 
nÜm®
 = "";

1131 ià(
	gÇme
[0] != '/')

1132 
nÜm®
 += "/";

1134 ià(
	gÇme
.
fšd
('/', 
Çme
.
Ëngth
()-1è=ğ
¡ršg
::
Åos
)

1135 
nÜm®
 +ğ
Çme
;

1137 
	gnÜm®
 +ğ
Çme
.
sub¡r
(0,‚ame.
Ëngth
()-1);

1144 
	gMa¡”
::
	$d–iv”_ev’t_nÙifiÿtiÚs
(
NodeD©a
 *
node
, 
Hy³r¥aûEv’tPŒ
 &
ev’tPŒ
, 
boŞ
 
wa™FÜNÙify
) {

1145 
nÙifiÿtiÚs
 = 0;

1149 
HªdËM­T
::
™”©Ü
 
™”
 = 
node
->
hªdËM­
.
	`begš
(); i‹¸!ğnode->hªdËM­.
	`’d
(); iter++) {

1151 ià((*
™”
).
£cÚd
->
ev’tMask
 & 
ev’tPŒ
->
	`g‘_mask
()) {

1152 (*
™”
).
£cÚd
->
£ssiÚPŒ
->
	`add_nÙifiÿtiÚ
Ğ
Ãw
 
	`NÙifiÿtiÚ
((*™”).
fœ¡
, 
ev’tPŒ
) );

1153 
m_k“·live_hªdËr_±r
->
	`d–iv”_ev’t_nÙifiÿtiÚs
((*
™”
).
£cÚd
->
£ssiÚPŒ
->
id
);

1154 
nÙifiÿtiÚs
++;

1158 ià(
wa™FÜNÙify
 && 
nÙifiÿtiÚs
)

1159 
ev’tPŒ
->
	`wa™_fÜ_nÙifiÿtiÚs
();

1160 
	}
}

1166 
	gMa¡”
::
	$d–iv”_ev’t_nÙifiÿtiÚ
(
HªdËD©aPŒ
 &
hªdËPŒ
, 
Hy³r¥aûEv’tPŒ
 &
ev’tPŒ
, 
boŞ
 
wa™FÜNÙify
) {

1170 
hªdËPŒ
->
£ssiÚPŒ
->
	`add_nÙifiÿtiÚ
Ğ
Ãw
 
	`NÙifiÿtiÚ
(hªdËPŒ->
id
, 
ev’tPŒ
) );

1171 
m_k“·live_hªdËr_±r
->
	`d–iv”_ev’t_nÙifiÿtiÚs
(
hªdËPŒ
->
£ssiÚPŒ
->
id
);

1173 ià(
wa™FÜNÙify
)

1174 
ev’tPŒ
->
	`wa™_fÜ_nÙifiÿtiÚs
();

1176 
	}
}

1183 
boŞ
 
	gMa¡”
::
fšd_·»Á_node
(
¡d
::
¡ršg
 
nÜm®Name
, 
NodeD©aPŒ
 &
·»ÁNodePŒ
, std::¡ršg &
chdName
) {

1184 
NodeM­T
::
™”©Ü
 
nodeI‹r
;

1185 
	gÏ¡SÏsh
 = 
nÜm®Name
.
rfšd
("/",‚Üm®Name.
Ëngth
());

1186 
	g¡d
::
¡ršg
 
·»ÁName
;

1188 ià(
	gÏ¡SÏsh
 > 0) {

1189 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_node_m­_mu‹x
);

1190 
	g·»ÁName
 = 
nÜm®Name
.
sub¡r
(0, 
Ï¡SÏsh
);

1191 
	gchdName
 = 
nÜm®Name
.
sub¡r
(
Ï¡SÏsh
+1);

1192 
	gnodeI‹r
 = 
m_node_m­
.
fšd
(
·»ÁName
);

1193 ià(
	gnodeI‹r
 !ğ
m_node_m­
.
’d
())

1194 
·»ÁNodePŒ
 = (*
nodeI‹r
).
£cÚd
;

1196 
	g·»ÁNodePŒ
 = 
Ãw
 
NodeD©a
();

1197 
	g·»ÁNodePŒ
->
	gÇme
 = 
·»ÁName
;

1198 
	gm_node_m­
[
·»ÁName
] = 
·»ÁNodePŒ
;

1200  
	gŒue
;

1202 ià(
	gÏ¡SÏsh
 == 0) {

1203 
boo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_node_m­_mu‹x
);

1204 
	g·»ÁName
 = "/";

1205 
	gnodeI‹r
 = 
m_node_m­
.
fšd
(
·»ÁName
);

1206 
as£¹
 (
nodeI‹r
 !ğ
m_node_m­
.
’d
());

1207 
	gchdName
 = 
nÜm®Name
.
sub¡r
(1);

1208 
	g·»ÁNodePŒ
 = (*
nodeI‹r
).
£cÚd
;

1209  
	gŒue
;

1212  
	gçl£
;

1219 
boŞ
 
	gMa¡”
::
de¡roy_hªdË
(
ušt64_t
 
hªdË
, *
”rÜp
, 
¡d
::
¡ršg
 &
”rMsg
, boŞ 
wa™FÜNÙify
) {

1220 
HªdËD©aPŒ
 
	ghªdËPŒ
;

1221 
	g»fCouÁ
 = 0;

1223 ià(!
»move_hªdË_d©a
(
hªdË
, 
hªdËPŒ
)) {

1224 *
	g”rÜp
 = 
E¼Ü
::
HYPERSPACE_INVALID_HANDLE
;

1225 
	g”rMsg
 = 
¡d
::
¡ršg
("hªdË="è+ 
hªdË
;

1226  
	gçl£
;

1230 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
hªdËPŒ
->
node
->mutex);

1232 
	ghªdËPŒ
->
	gnode
->
»move_hªdË
(
hªdËPŒ
->
id
);

1234 
	g»fCouÁ
 = 
hªdËPŒ
->
node
->
»ã»nû_couÁ
();

1237 
»Ëa£_lock
(
hªdËPŒ
, 
wa™FÜNÙify
);

1239 ià(
	g»fCouÁ
 == 0) {

1241 
hªdËPŒ
->
node
->
şo£
();

1243 ià(
	ghªdËPŒ
->
	gnode
->
	g•hem”®
) {

1244 
	g¡d
::
¡ršg
 
chdName
;

1245 
NodeD©aPŒ
 
	g·»ÁNodePŒ
;

1247 ià(
fšd_·»Á_node
(
hªdËPŒ
->
node
->
Çme
, 
·»ÁNodePŒ
, 
chdName
)) {

1248 
Hy³r¥aûEv’tPŒ
 
ev’tPŒ
Ğ
Ãw
 
Ev’tNamed
(
EVENT_MASK_CHILD_NODE_REMOVED
, 
chdName
) );

1249 
d–iv”_ev’t_nÙifiÿtiÚs
(
·»ÁNodePŒ
.
g‘
(), 
ev’tPŒ
, 
wa™FÜNÙify
);

1253 
	gNodeM­T
::
™”©Ü
 
nodeI‹r
 = 
m_node_m­
.
fšd
(
hªdËPŒ
->
node
->
Çme
);

1254 ià(
	gnodeI‹r
 !ğ
m_node_m­
.
’d
())

1255 
m_node_m­
.
”a£
(
nodeI‹r
);

1259  
	gŒue
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/Master.h

21 #iâdeà
HYPERSPACE_MASTER_H


22 
	#HYPERSPACE_MASTER_H


	)

24 
	~<queue
>

25 
	~<veùÜ
>

26 
	~<ext/hash_m­
>

28 
	~<boo¡/th»ad/mu‹x.hµ
>

30 
	~"CommÚ/©omic.h
"

31 
	~"CommÚ/Prİ”t›s.h
"

32 
	~"CommÚ/Reã»nûCouÁ.h
"

33 
	~"CommÚ/SockAddrM­.h
"

34 
	~"CommÚ/SŒšgExt.h
"

36 
	~"AsyncComm/Comm.h
"

37 
	~"AsyncComm/CÚÃùiÚMªag”.h
"

38 
	~"AsyncComm/Ev’t.h
"

39 
	~"AsyncComm/Re¥Ú£C®lback.h
"

41 
	~"NodeD©a.h
"

42 
	~"HªdËD©a.h
"

43 
	~"PrÙocŞ.h
"

44 
	~"Re¥Ú£C®lbackO³n.h
"

45 
	~"Re¥Ú£C®lbackExi¡s.h
"

46 
	~"Re¥Ú£C®lbackA‰rG‘.h
"

47 
	~"Re¥Ú£C®lbackLock.h
"

48 
	~"Re¥Ú£C®lbackR—ddœ.h
"

49 
	~"S”v”K“·liveHªdËr.h
"

50 
	~"SessiÚD©a.h
"

52 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

54 
Çme¥aû
 
	gHy³r¥aû
 {

56 şas 
	cMa¡”
 : 
public
 
Reã»nûCouÁ
 {

57 
public
:

59 cÚ¡ 
ušt32_t
 
DEFAULT_MASTER_PORT
 = 38040;

60 cÚ¡ 
ušt32_t
 
	gDEFAULT_LEASE_INTERVAL
 = 20;

61 cÚ¡ 
ušt32_t
 
	gDEFAULT_KEEPALIVE_INTERVAL
 = 10;

62 cÚ¡ 
ušt32_t
 
	gDEFAULT_GRACEPERIOD
 = 60;

64 
Ma¡”
(
CÚÃùiÚMªag”PŒ
 &
cÚnMªag”PŒ
, 
Prİ”t›sPŒ
 &
´İsPŒ
, 
S”v”K“·liveHªdËrPŒ
 &
k“·liveHªdËrPŒ
);

65 ~
Ma¡”
();

67 
mkdœ
(
Re¥Ú£C®lback
 *
cb
, 
ušt64_t
 
£ssiÚId
, cÚ¡ *
Çme
);

68 
uÆšk
(
Re¥Ú£C®lback
 *
cb
, 
ušt64_t
 
£ssiÚId
, cÚ¡ *
Çme
);

69 
İ’
(
Re¥Ú£C®lbackO³n
 *
cb
, 
ušt64_t
 
£ssiÚId
, cÚ¡ *
Çme
, 
ušt32_t
 
æags
, ušt32_ˆ
ev’tMask
, 
¡d
::
veùÜ
<
A‰ribu‹T
> &
š™A‰rs
);

70 
şo£
(
Re¥Ú£C®lback
 *
cb
, 
ušt64_t
 
£ssiÚId
, ušt64_ˆ
hªdË
);

71 
©Œ_£t
(
Re¥Ú£C®lback
 *
cb
, 
ušt64_t
 
£ssiÚId
, ušt64_ˆ
hªdË
, cÚ¡ *
Çme
, cÚ¡ *
v®ue
, 
size_t
 
v®ueL’
);

72 
©Œ_g‘
(
Re¥Ú£C®lbackA‰rG‘
 *
cb
, 
ušt64_t
 
£ssiÚId
, ušt64_ˆ
hªdË
, cÚ¡ *
Çme
);

73 
©Œ_d–
(
Re¥Ú£C®lback
 *
cb
, 
ušt64_t
 
£ssiÚId
, ušt64_ˆ
hªdË
, cÚ¡ *
Çme
);

74 
exi¡s
(
Re¥Ú£C®lbackExi¡s
 *
cb
, 
ušt64_t
 
£ssiÚId
, cÚ¡ *
Çme
);

75 
»addœ
(
Re¥Ú£C®lbackR—ddœ
 *
cb
, 
ušt64_t
 
£ssiÚId
, ušt64_ˆ
hªdË
);

76 
lock
(
Re¥Ú£C®lbackLock
 *
cb
, 
ušt64_t
 
£ssiÚId
, ušt64_ˆ
hªdË
, 
ušt32_t
 
mode
, 
boŞ
 
ŒyAcquœe
);

77 
»Ëa£
(
Re¥Ú£C®lback
 *
cb
, 
ušt64_t
 
£ssiÚId
, ušt64_ˆ
hªdË
);

86 
ušt64_t
 
ü—‹_£ssiÚ
(
sockaddr_š
 &
addr
);

95 
boŞ
 
g‘_£ssiÚ
(
ušt64_t
 
£ssiÚId
, 
SessiÚD©aPŒ
 &
£ssiÚPŒ
);

97 
de¡roy_£ssiÚ
(
ušt64_t
 
£ssiÚId
);

108 
»Ãw_£ssiÚ_Ëa£
(
ušt64_t
 
£ssiÚId
);

110 
boŞ
 
Ãxt_expœed_£ssiÚ
(
SessiÚD©aPŒ
 &
£ssiÚPŒ
);

111 
»move_expœed_£ssiÚs
();

113 
ü—‹_hªdË
(
ušt64_t
 *
hªdËp
, 
HªdËD©aPŒ
 &
hªdËPŒ
);

114 
boŞ
 
g‘_hªdË_d©a
(
ušt64_t
 
£ssiÚId
, 
HªdËD©aPŒ
 &
hªdËPŒ
);

115 
boŞ
 
»move_hªdË_d©a
(
ušt64_t
 
£ssiÚId
, 
HªdËD©aPŒ
 &
hªdËPŒ
);

117 
g‘_d©ag¿m_£nd_add»ss
(
sockaddr_š
 *
addr
è{ 
memıy
×ddr, &
m_loÿl_addr
, (m_local_addr)); }

119 
	g´iv©e
:

121 
»pÜt_”rÜ
(
Re¥Ú£C®lback
 *
cb
);

122 
nÜm®ize_Çme
(
¡d
::
¡ršg
 
Çme
, std::¡ršg &
nÜm®
);

123 
d–iv”_ev’t_nÙifiÿtiÚs
(
NodeD©a
 *
node
, 
Hy³r¥aûEv’tPŒ
 &
ev’tPŒ
, 
boŞ
 
wa™FÜNÙify
=
Œue
);

124 
d–iv”_ev’t_nÙifiÿtiÚ
(
HªdËD©aPŒ
 &
hªdËPŒ
, 
Hy³r¥aûEv’tPŒ
 &
ev’tPŒ
, 
boŞ
 
wa™FÜNÙify
=
Œue
);

138 
boŞ
 
fšd_·»Á_node
(
¡d
::
¡ršg
 
nÜm®Name
, 
NodeD©aPŒ
 &
·»ÁNodePŒ
, std::¡ršg &
chdName
);

139 
boŞ
 
de¡roy_hªdË
(
ušt64_t
 
hªdË
, *
”rÜp
, 
¡d
::
¡ršg
 &
”rMsg
, boŞ 
wa™FÜNÙify
=
Œue
);

140 
»Ëa£_lock
(
HªdËD©aPŒ
 &
hªdËPŒ
, 
boŞ
 
wa™FÜNÙify
=
Œue
);

141 
lock_hªdË
(
HªdËD©aPŒ
 &
hªdËPŒ
, 
ušt32_t
 
mode
);

142 
lock_hªdË_w™h_nÙifiÿtiÚ
(
HªdËD©aPŒ
 &
hªdËPŒ
, 
ušt32_t
 
mode
, 
boŞ
 
wa™FÜNÙify
=
Œue
);

151 
g‘_node
(
¡d
::
¡ršg
 
Çme
, 
NodeD©aPŒ
 &
nodePŒ
) {

152 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_node_m­_mu‹x
);

153 
	gNodeM­T
::
™”©Ü
 
™”
 = 
m_node_m­
.
fšd
(
Çme
);

154 ià(
	g™”
 !ğ
m_node_m­
.
’d
()) {

155 
nodePŒ
 = (*
™”
).
£cÚd
;

158 
	gnodePŒ
 = 
Ãw
 
NodeD©a
();

159 
	gnodePŒ
->
	gÇme
 = 
Çme
;

160 
	gm_node_m­
[
Çme
] = 
nodePŒ
;

163 
	g__gnu_cxx
::
	thash_m­
<
	t¡d
::
	t¡ršg
, 
	tNodeD©aPŒ
> 
	tNodeM­T
;

164 
	g__gnu_cxx
::
	thash_m­
<
	tušt64_t
, 
	tHªdËD©aPŒ
> 
	tHªdËM­T
;

165 
	g__gnu_cxx
::
	thash_m­
<
	tušt64_t
, 
	tSessiÚD©aPŒ
> 
	tSessiÚM­T
;

167 
boŞ
 
	gm_v”bo£
;

168 
ušt32_t
 
	gm_Ëa£_š‹rv®
;

169 
ušt32_t
 
	gm_k“p_®ive_š‹rv®
;

170 
NodeM­T
 
	gm_node_m­
;

171 
HªdËM­T
 
	gm_hªdË_m­
;

172 
SessiÚM­T
 
	gm_£ssiÚ_m­
;

173 
	gboo¡
::
mu‹x
 
m_node_m­_mu‹x
;

174 
	gboo¡
::
mu‹x
 
m_hªdË_m­_mu‹x
;

175 
	gboo¡
::
mu‹x
 
m_£ssiÚ_m­_mu‹x
;

176 
	g¡d
::
¡ršg
 
m_ba£_dœ
;

177 
	gm_ba£_fd
;

178 
ušt32_t
 
	gm_g’”©iÚ
;

179 
ušt64_t
 
	gm_Ãxt_hªdË_numb”
;

180 
ušt64_t
 
	gm_Ãxt_£ssiÚ_id
;

181 
S”v”K“·liveHªdËrPŒ
 
	gm_k“·live_hªdËr_±r
;

182 
sockaddr_š
 
	gm_loÿl_addr
;

183 
	g¡d
::
veùÜ
<
SessiÚD©aPŒ
> 
m_£ssiÚ_h—p
;

186 
	gboo¡
::
	tšŒusive_±r
<
	tMa¡”
> 
	tMa¡”PŒ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/NodeData.h

21 #iâdeà
HYPERSPACE_NODEDATA_H


22 
	#HYPERSPACE_NODEDATA_H


	)

24 
	~<io¡»am
>

25 
	~<li¡
>

27 
	~<¡ršg
>

29 
	~<boo¡/th»ad/mu‹x.hµ
>

31 
	~"CommÚ/Reã»nûCouÁ.h
"

33 
	~"HªdËD©a.h
"

35 
Çme¥aû
 
	gHy³r¥aû
 {

37 şas 
	cLockReque¡
 {

38 
	gpublic
:

39 
LockReque¡
(
ušt64_t
 
h
, 
m
è: 
hªdË
(h), 
mode
(m) { ; }

40 
ušt64_t
 
	ghªdË
;

41 
	gmode
;

44 şas 
	cNodeD©a
 : 
public
 
Hy³¹abË
::
Reã»nûCouÁ
 {

45 
public
:

46 
NodeD©a
(è: 
fd
(-1), 
•hem”®
(
çl£
), 
cu¼’tLockMode
(0), 
lockG’”©iÚ
(0), 
exşusiveLockHªdË
(0) {

49 
add_hªdË
(
ušt64_t
 
hªdË
, 
HªdËD©aPŒ
 &
hªdËPŒ
) {

50 
	ghªdËM­
[
hªdË
] = 
hªdËPŒ
;

53 
boŞ
 
»move_hªdË
(
ušt64_t
 
hªdË
) {

54 
	gHªdËM­T
::
™”©Ü
 
™”
 = 
hªdËM­
.
fšd
(
hªdË
);

55 ià(
	g™”
 !ğ
hªdËM­
.
’d
()) {

56 
hªdËM­
.
”a£
(
™”
);

57  
	gŒue
;

59  
	gçl£
;

62 
»ã»nû_couÁ
() {

63  
	ghªdËM­
.
size
();

66 
şo£
() {

67 ià(
	gfd
 != -1) {

68 ::
şo£
(
fd
);

69 
	gfd
 = -1;

73 
	gboo¡
::
mu‹x
 mutex;

74 
	g¡d
::
¡ršg
 
Çme
;

75 
	gfd
;

76 
boŞ
 
	g•hem”®
;

77 
	g__gnu_cxx
::
	thash_m­
<
	tušt64_t
, 
	tHªdËD©aPŒ
> 
	tHªdËM­T
;

78 
HªdËM­T
 
	ghªdËM­
;

79 
ušt32_t
 
	gcu¼’tLockMode
;

80 
ušt64_t
 
	glockG’”©iÚ
;

81 
	g£t
<
	gušt64_t
> 
	gsh¬edLockHªdËs
;

82 
ušt64_t
 
	gexşusiveLockHªdË
;

83 
	gli¡
<
	gLockReque¡
> 
	g³ndšgLockReque¡s
;

85 
	gboo¡
::
	tšŒusive_±r
<
	tNodeD©a
> 
	tNodeD©aPŒ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/Notification.h

21 #iâdeà
HYPERSPACE_NOTIFICATION_H


22 
	#HYPERSPACE_NOTIFICATION_H


	)

24 
	~"Ev’t.h
"

26 
Çme¥aû
 
	gHy³r¥aû
 {

28 şas 
	cNÙifiÿtiÚ
 {

29 
	gpublic
:

30 
NÙifiÿtiÚ
(
ušt64_t
 
h
, 
Hy³r¥aûEv’tPŒ
 &
•Œ
è: 
hªdË
(h), 
ev’tPŒ
(eptr) {

31 
	gev’tPŒ
->
šüem’t_nÙifiÿtiÚ_couÁ
();

34 
ušt64_t
 
	ghªdË
;

35 
Hy³r¥aûEv’tPŒ
 
	gev’tPŒ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/Protocol.cc

21 
	~<ÿs£¹
>

22 
	~<io¡»am
>

24 
	~"CommÚ/E¼Ü.h
"

25 
	~"AsyncComm/H—d”Bud”.h
"

26 
	~"AsyncComm/S”Ÿliz©iÚ.h
"

28 
	~"PrÙocŞ.h
"

30 
usšg
 
Çme¥aû
 
	gHy³r¥aû
;

31 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

32 
usšg
 
Çme¥aû
 
	g¡d
;

35 cÚ¡ *
	gHy³r¥aû
::
PrÙocŞ
::
commªdSŒšgs
[
COMMAND_MAX
] = {

60 cÚ¡ *
	gHy³r¥aû
::
PrÙocŞ
::
	$commªd_‹xt
(
commªd
) {

61 ià(
commªd
 < 0 || commªd >ğ
COMMAND_MAX
)

63  
commªdSŒšgs
[
commªd
];

64 
	}
}

69 
CommBuf
 *
	gHy³r¥aû
::
PrÙocŞ
::
	$ü—‹_ş›Á_k“·live_»que¡
(
ušt64_t
 
£ssiÚId
, ušt64_ˆ
Ï¡KnownEv’t
) {

70 
H—d”Bud”
 
	`hbud”
(
H—d”
::
PROTOCOL_HYPERSPACE
);

71 
CommBuf
 *
cbuf
 = 
Ãw
 
	`CommBuf
(
hbud”
, 18);

72 
cbuf
->
	`­³nd_shÜt
(
COMMAND_KEEPALIVE
);

73 
cbuf
->
	`­³nd_lÚg
(
£ssiÚId
);

74 
cbuf
->
	`­³nd_lÚg
(
Ï¡KnownEv’t
);

75  
cbuf
;

76 
	}
}

82 
CommBuf
 *
	gHy³r¥aû
::
PrÙocŞ
::
	$ü—‹_£rv”_k“·live_»que¡
(
ušt64_t
 
£ssiÚId
, 
”rÜ
) {

83 
H—d”Bud”
 
	`hbud”
(
H—d”
::
PROTOCOL_HYPERSPACE
);

84 
CommBuf
 *
cbuf
 = 
Ãw
 
	`CommBuf
(
hbud”
, 14);

85 
cbuf
->
	`­³nd_shÜt
(
COMMAND_KEEPALIVE
);

86 
cbuf
->
	`­³nd_lÚg
(
£ssiÚId
);

87 
cbuf
->
	`­³nd_št
(
”rÜ
);

88 
cbuf
->
	`­³nd_št
(0);

89  
cbuf
;

90 
	}
}

96 
CommBuf
 *
	gHy³r¥aû
::
PrÙocŞ
::
	$ü—‹_£rv”_k“·live_»que¡
(
SessiÚD©aPŒ
 &
£ssiÚPŒ
) {

97 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
£ssiÚPŒ
->mutex);

98 
CommBuf
 *
cbuf
 = 0;

99 
H—d”Bud”
 
	`hbud”
(
H—d”
::
PROTOCOL_HYPERSPACE
);

100 
ušt32_t
 
Ën
 = 18;

101 
li¡
<
NÙifiÿtiÚ
 *>::
™”©Ü
 
™”
;

103 
™”
 = 
£ssiÚPŒ
->
nÙifiÿtiÚs
.
	`begš
(); i‹¸!ğ£ssiÚPŒ->nÙifiÿtiÚs.
	`’d
(); iter++) {

104 
Ën
 += 8;

105 
Ën
 +ğ(*
™”
)->
ev’tPŒ
->
	`’coded_Ëngth
();

108 
cbuf
 = 
Ãw
 
	`CommBuf
(
hbud”
, 
Ën
);

109 
cbuf
->
	`­³nd_shÜt
(
COMMAND_KEEPALIVE
);

110 
cbuf
->
	`­³nd_lÚg
(
£ssiÚPŒ
->
id
);

111 
cbuf
->
	`­³nd_št
(
E¼Ü
::
OK
);

112 
cbuf
->
	`­³nd_št
(
£ssiÚPŒ
->
nÙifiÿtiÚs
.
	`size
());

113 
™”
 = 
£ssiÚPŒ
->
nÙifiÿtiÚs
.
	`begš
(); i‹¸!ğ£ssiÚPŒ->nÙifiÿtiÚs.
	`’d
(); iter++) {

114 
cbuf
->
	`­³nd_lÚg
((*
™”
)->
hªdË
);

115 (*
™”
)->
ev’tPŒ
->
	`’code
(
cbuf
);

122  
cbuf
;

123 
	}
}

129 
CommBuf
 *
	gHy³r¥aû
::
PrÙocŞ
::
	$ü—‹_hªdshake_»que¡
(
ušt64_t
 
£ssiÚId
) {

130 
H—d”Bud”
 
	`hbud”
(
H—d”
::
PROTOCOL_HYPERSPACE
);

131 
CommBuf
 *
cbuf
 = 
Ãw
 
	`CommBuf
(
hbud”
, 10);

132 
cbuf
->
	`­³nd_shÜt
(
COMMAND_HANDSHAKE
);

133 
cbuf
->
	`­³nd_lÚg
(
£ssiÚId
);

134  
cbuf
;

135 
	}
}

141 
CommBuf
 *
	gHy³r¥aû
::
PrÙocŞ
::
ü—‹_İ’_»que¡
(
¡d
::
¡ršg
 &
Çme
, 
ušt32_t
 
æags
, 
HªdËC®lbackPŒ
 &
ÿÎbackPŒ
, std::
veùÜ
<
A‰ribu‹T
> &
š™A‰rs
) {

142 
size_t
 
Ën
 = 14 + 
S”Ÿliz©iÚ
::
’coded_Ëngth_¡ršg
(
Çme
);

143 
H—d”Bud”
 
hbud”
(
H—d”
::
PROTOCOL_HYPERSPACE
, 
feNameToGroupId
(
Çme
));

144 
size_t
 
	gi
=0; i<
	gš™A‰rs
.
size
(); i++)

145 
	gËn
 +ğ
S”Ÿliz©iÚ
::
’coded_Ëngth_¡ršg
(
Çme
è+ S”Ÿliz©iÚ::
’coded_Ëngth_by‹_¬¿y
(
š™A‰rs
[
i
].
v®ueL’
);

147 
CommBuf
 *
	gcbuf
 = 
Ãw
 CommBuf(
hbud”
, 
Ën
);

149 
	gcbuf
->
­³nd_shÜt
(
COMMAND_OPEN
);

150 
	gcbuf
->
­³nd_št
(
æags
);

151 ià(
	gÿÎbackPŒ
)

152 
	gcbuf
->
­³nd_št
(
ÿÎbackPŒ
->
g‘_ev’t_mask
());

154 
	gcbuf
->
­³nd_št
(0);

155 
	gcbuf
->
­³nd_¡ršg
(
Çme
);

158 
	gcbuf
->
­³nd_št
(
š™A‰rs
.
size
());

159 
size_t
 
	gi
=0; i<
	gš™A‰rs
.
size
(); i++) {

160 
	gcbuf
->
­³nd_¡ršg
(
š™A‰rs
[
i
].
Çme
);

161 
	gcbuf
->
­³nd_by‹_¬¿y
(
š™A‰rs
[
i
].
v®ue
, in™A‰rs[i].
v®ueL’
);

164  
	gcbuf
;

168 
CommBuf
 *
	gHy³r¥aû
::
PrÙocŞ
::
	$ü—‹_şo£_»que¡
(
ušt64_t
 
hªdË
) {

169 
H—d”Bud”
 
	`hbud”
(
H—d”
::
PROTOCOL_HYPERSPACE
, (
ušt32_t
)((
hªdË
 ^ (handle >> 32)) & 0x0FFFFFFFFLL));

170 
CommBuf
 *
cbuf
 = 
Ãw
 
	`CommBuf
(
hbud”
, 10);

171 
cbuf
->
	`­³nd_shÜt
(
COMMAND_CLOSE
);

172 
cbuf
->
	`­³nd_lÚg
(
hªdË
);

173  
cbuf
;

174 
	}
}

176 
CommBuf
 *
	gHy³r¥aû
::
PrÙocŞ
::
ü—‹_mkdœ_»que¡
(
¡d
::
¡ršg
 &
Çme
) {

177 
H—d”Bud”
 
hbud”
(
H—d”
::
PROTOCOL_HYPERSPACE
, 
feNameToGroupId
(
Çme
));

178 
CommBuf
 *
	gcbuf
 = 
Ãw
 CommBuf(
hbud”
, 2 + 
S”Ÿliz©iÚ
::
’coded_Ëngth_¡ršg
(
Çme
));

179 
	gcbuf
->
­³nd_shÜt
(
COMMAND_MKDIR
);

180 
	gcbuf
->
­³nd_¡ršg
(
Çme
);

181  
	gcbuf
;

185 
CommBuf
 *
	gHy³r¥aû
::
PrÙocŞ
::
ü—‹_d–‘e_»que¡
(
¡d
::
¡ršg
 &
Çme
) {

186 
H—d”Bud”
 
hbud”
(
H—d”
::
PROTOCOL_HYPERSPACE
, 
feNameToGroupId
(
Çme
));

187 
CommBuf
 *
	gcbuf
 = 
Ãw
 CommBuf(
hbud”
, 2 + 
S”Ÿliz©iÚ
::
’coded_Ëngth_¡ršg
(
Çme
));

188 
	gcbuf
->
­³nd_shÜt
(
COMMAND_DELETE
);

189 
	gcbuf
->
­³nd_¡ršg
(
Çme
);

190  
	gcbuf
;

194 
CommBuf
 *
	gHy³r¥aû
::
PrÙocŞ
::
ü—‹_©Œ_£t_»que¡
(
ušt64_t
 
hªdË
, 
¡d
::
¡ršg
 &
Çme
, cÚ¡ *
v®ue
, 
size_t
 
v®ueL’
) {

195 
H—d”Bud”
 
hbud”
(
H—d”
::
PROTOCOL_HYPERSPACE
, (
ušt32_t
)((
hªdË
 ^ (handle >> 32)) & 0x0FFFFFFFFLL));

196 
CommBuf
 *
	gcbuf
 = 
Ãw
 CommBuf(
hbud”
, 10 + 
S”Ÿliz©iÚ
::
’coded_Ëngth_¡ršg
(
Çme
è+ S”Ÿliz©iÚ::
’coded_Ëngth_by‹_¬¿y
(
v®ueL’
));

197 
	gcbuf
->
­³nd_shÜt
(
COMMAND_ATTRSET
);

198 
	gcbuf
->
­³nd_lÚg
(
hªdË
);

199 
	gcbuf
->
­³nd_¡ršg
(
Çme
);

200 
	gcbuf
->
­³nd_by‹_¬¿y
(
v®ue
, 
v®ueL’
);

201  
	gcbuf
;

205 
CommBuf
 *
	gHy³r¥aû
::
PrÙocŞ
::
ü—‹_©Œ_g‘_»que¡
(
ušt64_t
 
hªdË
, 
¡d
::
¡ršg
 &
Çme
) {

206 
H—d”Bud”
 
hbud”
(
H—d”
::
PROTOCOL_HYPERSPACE
, (
ušt32_t
)((
hªdË
 ^ (handle >> 32)) & 0x0FFFFFFFFLL));

207 
CommBuf
 *
	gcbuf
 = 
Ãw
 CommBuf(
hbud”
, 10 + 
S”Ÿliz©iÚ
::
’coded_Ëngth_¡ršg
(
Çme
));

208 
	gcbuf
->
­³nd_shÜt
(
COMMAND_ATTRGET
);

209 
	gcbuf
->
­³nd_lÚg
(
hªdË
);

210 
	gcbuf
->
­³nd_¡ršg
(
Çme
);

211  
	gcbuf
;

215 
CommBuf
 *
	gHy³r¥aû
::
PrÙocŞ
::
ü—‹_©Œ_d–_»que¡
(
ušt64_t
 
hªdË
, 
¡d
::
¡ršg
 &
Çme
) {

216 
H—d”Bud”
 
hbud”
(
H—d”
::
PROTOCOL_HYPERSPACE
, (
ušt32_t
)((
hªdË
 ^ (handle >> 32)) & 0x0FFFFFFFFLL));

217 
CommBuf
 *
	gcbuf
 = 
Ãw
 CommBuf(
hbud”
, 10 + 
S”Ÿliz©iÚ
::
’coded_Ëngth_¡ršg
(
Çme
));

218 
	gcbuf
->
­³nd_shÜt
(
COMMAND_ATTRDEL
);

219 
	gcbuf
->
­³nd_lÚg
(
hªdË
);

220 
	gcbuf
->
­³nd_¡ršg
(
Çme
);

221  
	gcbuf
;

225 
CommBuf
 *
	gHy³r¥aû
::
PrÙocŞ
::
	$ü—‹_»addœ_»que¡
(
ušt64_t
 
hªdË
) {

226 
H—d”Bud”
 
	`hbud”
(
H—d”
::
PROTOCOL_HYPERSPACE
, (
ušt32_t
)((
hªdË
 ^ (handle >> 32)) & 0x0FFFFFFFFLL));

227 
CommBuf
 *
cbuf
 = 
Ãw
 
	`CommBuf
(
hbud”
, 10);

228 
cbuf
->
	`­³nd_shÜt
(
COMMAND_READDIR
);

229 
cbuf
->
	`­³nd_lÚg
(
hªdË
);

230  
cbuf
;

231 
	}
}

234 
CommBuf
 *
	gHy³r¥aû
::
PrÙocŞ
::
ü—‹_exi¡s_»que¡
(
¡d
::
¡ršg
 &
Çme
) {

235 
H—d”Bud”
 
hbud”
(
H—d”
::
PROTOCOL_HYPERSPACE
, 
feNameToGroupId
(
Çme
));

236 
CommBuf
 *
	gcbuf
 = 
Ãw
 CommBuf(
hbud”
, 2 + 
S”Ÿliz©iÚ
::
’coded_Ëngth_¡ršg
(
Çme
));

237 
	gcbuf
->
­³nd_shÜt
(
COMMAND_EXISTS
);

238 
	gcbuf
->
­³nd_¡ršg
(
Çme
);

239  
	gcbuf
;

243 
CommBuf
 *
	gHy³r¥aû
::
PrÙocŞ
::
	$ü—‹_lock_»que¡
(
ušt64_t
 
hªdË
, 
ušt32_t
 
mode
, 
boŞ
 
ŒyAcquœe
) {

244 
H—d”Bud”
 
	`hbud”
(
H—d”
::
PROTOCOL_HYPERSPACE
, (
ušt32_t
)((
hªdË
 ^ (handle >> 32)) & 0x0FFFFFFFFLL));

245 
CommBuf
 *
cbuf
 = 
Ãw
 
	`CommBuf
(
hbud”
, 15);

246 
cbuf
->
	`­³nd_shÜt
(
COMMAND_LOCK
);

247 
cbuf
->
	`­³nd_lÚg
(
hªdË
);

248 
cbuf
->
	`­³nd_št
(
mode
);

249 
cbuf
->
	`­³nd_by‹
(
ŒyAcquœe
);

250  
cbuf
;

251 
	}
}

254 
CommBuf
 *
	gHy³r¥aû
::
PrÙocŞ
::
	$ü—‹_»Ëa£_»que¡
(
ušt64_t
 
hªdË
) {

255 
H—d”Bud”
 
	`hbud”
(
H—d”
::
PROTOCOL_HYPERSPACE
, (
ušt32_t
)((
hªdË
 ^ (handle >> 32)) & 0x0FFFFFFFFLL));

256 
CommBuf
 *
cbuf
 = 
Ãw
 
	`CommBuf
(
hbud”
, 10);

257 
cbuf
->
	`­³nd_shÜt
(
COMMAND_RELEASE
);

258 
cbuf
->
	`­³nd_lÚg
(
hªdË
);

259  
cbuf
;

260 
	}
}

266 
CommBuf
 *
	gHy³r¥aû
::
PrÙocŞ
::
	$ü—‹_¡©us_»que¡
() {

267 
H—d”Bud”
 
	`hbud”
(
H—d”
::
PROTOCOL_HYPERSPACE
);

268 
CommBuf
 *
cbuf
 = 
Ãw
 
	`CommBuf
(
hbud”
, 2);

269 
cbuf
->
	`­³nd_shÜt
(
COMMAND_STATUS
);

270  
cbuf
;

271 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/Protocol.h

20 #iâdeà
HYPERSPACE_PROTOCOL_H


21 
	#HYPERSPACE_PROTOCOL_H


	)

23 
	~<veùÜ
>

26 
	~<¡dšt.h
>

27 
	~<¡ršg.h
>

30 
	~"AsyncComm/CommBuf.h
"

31 
	~"AsyncComm/PrÙocŞ.h
"

33 
	~"HªdËC®lback.h
"

34 
	~"NÙifiÿtiÚ.h
"

35 
	~"SessiÚD©a.h
"

37 
usšg
 
Çme¥aû
 
Hy³¹abË
;

39 
Çme¥aû
 
	gHy³r¥aû
 {

46 cÚ¡ *
	gÇme
;

48 cÚ¡ *
	gv®ue
;

50 
št32_t
 
	gv®ueL’
;

51 } 
	tA‰ribu‹T
;

53 şas 
	cPrÙocŞ
 : 
public
 
Hy³¹abË
::
PrÙocŞ
 {

55 
public
:

57 
vœtu®
 cÚ¡ *
commªd_‹xt
(
commªd
);

59 
CommBuf
 *
ü—‹_ş›Á_k“·live_»que¡
(
ušt64_t
 
£ssiÚId
, ušt64_ˆ
Ï¡KnownEv’t
);

60 
CommBuf
 *
ü—‹_£rv”_k“·live_»que¡
(
ušt64_t
 
£ssiÚId
, 
”rÜ
);

61 
CommBuf
 *
ü—‹_£rv”_k“·live_»que¡
(
SessiÚD©aPŒ
 &
£ssiÚPŒ
);

62 
CommBuf
 *
ü—‹_hªdshake_»que¡
(
ušt64_t
 
£ssiÚId
);

64 
CommBuf
 *
ü—‹_İ’_»que¡
(
¡d
::
¡ršg
 &
Çme
, 
ušt32_t
 
æags
, 
HªdËC®lbackPŒ
 &
ÿÎbackPŒ
, std::
veùÜ
<
A‰ribu‹T
> &
š™A‰rs
);

65 
CommBuf
 *
ü—‹_şo£_»que¡
(
ušt64_t
 
hªdË
);

66 
CommBuf
 *
ü—‹_mkdœ_»que¡
(
¡d
::
¡ršg
 &
Çme
);

67 
CommBuf
 *
ü—‹_d–‘e_»que¡
(
¡d
::
¡ršg
 &
Çme
);

68 
CommBuf
 *
ü—‹_©Œ_£t_»que¡
(
ušt64_t
 
hªdË
, 
¡d
::
¡ršg
 &
Çme
, cÚ¡ *
v®ue
, 
size_t
 
v®ueL’
);

69 
CommBuf
 *
ü—‹_©Œ_g‘_»que¡
(
ušt64_t
 
hªdË
, 
¡d
::
¡ršg
 &
Çme
);

70 
CommBuf
 *
ü—‹_©Œ_d–_»que¡
(
ušt64_t
 
hªdË
, 
¡d
::
¡ršg
 &
Çme
);

71 
CommBuf
 *
ü—‹_»addœ_»que¡
(
ušt64_t
 
hªdË
);

72 
CommBuf
 *
ü—‹_exi¡s_»que¡
(
¡d
::
¡ršg
 &
Çme
);

74 
CommBuf
 *
ü—‹_lock_»que¡
(
ušt64_t
 
hªdË
, 
ušt32_t
 
mode
, 
boŞ
 
ŒyAcquœe
);

75 
CommBuf
 *
ü—‹_»Ëa£_»que¡
(
ušt64_t
 
hªdË
);

77 
CommBuf
 *
ü—‹_ev’t_nÙifiÿtiÚ
(
ušt64_t
 
hªdË
, 
¡d
::
¡ršg
 &
Çme
, cÚ¡ *
v®ue
, 
size_t
 
v®ueL’
);

79 
CommBuf
 *
ü—‹_¡©us_»que¡
();

81 cÚ¡ 
ušt16_t
 
	gCOMMAND_KEEPALIVE
 = 0;

82 cÚ¡ 
ušt16_t
 
	gCOMMAND_HANDSHAKE
 = 1;

83 cÚ¡ 
ušt16_t
 
	gCOMMAND_OPEN
 = 2;

84 cÚ¡ 
ušt16_t
 
	gCOMMAND_STAT
 = 3;

85 cÚ¡ 
ušt16_t
 
	gCOMMAND_CANCEL
 = 4;

86 cÚ¡ 
ušt16_t
 
	gCOMMAND_CLOSE
 = 5;

87 cÚ¡ 
ušt16_t
 
	gCOMMAND_POISON
 = 6;

88 cÚ¡ 
ušt16_t
 
	gCOMMAND_MKDIR
 = 7;

89 cÚ¡ 
ušt16_t
 
	gCOMMAND_ATTRSET
 = 8;

90 cÚ¡ 
ušt16_t
 
	gCOMMAND_ATTRGET
 = 9;

91 cÚ¡ 
ušt16_t
 
	gCOMMAND_ATTRDEL
 = 10;

92 cÚ¡ 
ušt16_t
 
	gCOMMAND_EXISTS
 = 11;

93 cÚ¡ 
ušt16_t
 
	gCOMMAND_DELETE
 = 12;

94 cÚ¡ 
ušt16_t
 
	gCOMMAND_READDIR
 = 13;

95 cÚ¡ 
ušt16_t
 
	gCOMMAND_LOCK
 = 14;

96 cÚ¡ 
ušt16_t
 
	gCOMMAND_RELEASE
 = 15;

97 cÚ¡ 
ušt16_t
 
	gCOMMAND_CHECKSEQUENCER
 = 16;

98 cÚ¡ 
ušt16_t
 
	gCOMMAND_STATUS
 = 17;

99 cÚ¡ 
ušt16_t
 
	gCOMMAND_MAX
 = 18;

101 cÚ¡ * 
	gcommªdSŒšgs
[
COMMAND_MAX
];

103 
	g´iv©e
:

105 
ušt32_t
 
feNameToGroupId
(cÚ¡ *
âame
) {

106 cÚ¡ *
±r
;

107 
ušt32_t
 
	ggid
 = 0;

109 ià(
	gâame
[0] != '/')

110 
gid
 +ğ(
ušt32_t
)'/';

111 
	g±r
=
âame
; *ptr; ++ptr)

112 
	ggid
 +ğ(
ušt32_t
)*
±r
;

114 ià(*(
	g±r
-1) == '/')

115 
gid
 -ğ(
ušt32_t
)'/';

116  
	ggid
;

119 
ušt32_t
 
feNameToGroupId
(
¡d
::
¡ršg
 &
Çme
) {

120  
feNameToGroupId
(
Çme
.
c_¡r
());

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/RequestHandlerAttrDel.cc

21 
	~"CommÚ/E¼Ü.h
"

22 
	~"CommÚ/Logg”.h
"

24 
	~"AsyncComm/Re¥Ú£C®lback.h
"

25 
	~"AsyncComm/S”Ÿliz©iÚ.h
"

27 
	~"Ma¡”.h
"

28 
	~"Reque¡HªdËrA‰rD–.h
"

30 
usšg
 
Çme¥aû
 
	gHy³r¥aû
;

31 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

36 
	gReque¡HªdËrA‰rD–
::
	$run
() {

37 
Re¥Ú£C®lback
 
	`cb
(
m_comm
, 
m_ev’t_±r
);

38 
size_t
 
»maššg
 = 
m_ev’t_±r
->
mes§geL’
 - 2;

39 
ušt8_t
 *
msgPŒ
 = 
m_ev’t_±r
->
mes§ge
 + 2;

40 cÚ¡ *
Çme
;

41 
ušt64_t
 
hªdË
;

44 ià(!
S”Ÿliz©iÚ
::
	`decode_lÚg
(&
msgPŒ
, &
»maššg
, &
hªdË
))

45 
abÜt
;

48 ià(!
S”Ÿliz©iÚ
::
	`decode_¡ršg
(&
msgPŒ
, &
»maššg
, &
Çme
))

49 
abÜt
;

51 
m_ma¡”
->
	`©Œ_d–
(&
cb
, 
m_£ssiÚ_id
, 
hªdË
, 
Çme
);

55 
abÜt
:

56 
	`HT_ERROR
("Encoding…roblem with ATTRDEL message");

57 
cb
.
	`”rÜ
(
E¼Ü
::
PROTOCOL_ERROR
, "Encoding…roblem with ATTRDEL message");

58 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/RequestHandlerAttrDel.h

21 #iâdeà
HYPERSPACE_REQUESTHANDLERATTRDEL_H


22 
	#HYPERSPACE_REQUESTHANDLERATTRDEL_H


	)

24 
	~"CommÚ/RuÂabË.h
"

26 
	~"AsyncComm/AµliÿtiÚHªdËr.h
"

27 
	~"AsyncComm/Comm.h
"

28 
	~"AsyncComm/Ev’t.h
"

30 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

32 
Çme¥aû
 
	gHy³r¥aû
 {

34 
şass
 
	gMa¡”
;

36 şas 
	cReque¡HªdËrA‰rD–
 : 
public
 
AµliÿtiÚHªdËr
 {

37 
public
:

38 
Reque¡HªdËrA‰rD–
(
Comm
 *
comm
, 
Ma¡”
 *
ma¡”
, 
ušt64_t
 
£ssiÚId
, 
Ev’tPŒ
 &
ev’tPŒ
è: 
AµliÿtiÚHªdËr
Óv’tPŒ), 
m_comm
(comm), 
m_ma¡”
(ma¡”), 
m_£ssiÚ_id
(sessionId) {

42 
vœtu®
 
run
();

44 
	g´iv©e
:

45 
Comm
 *
m_comm
;

46 
Ma¡”
 *
	gm_ma¡”
;

47 
ušt64_t
 
	gm_£ssiÚ_id
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/RequestHandlerAttrGet.cc

21 
	~"CommÚ/E¼Ü.h
"

22 
	~"CommÚ/Logg”.h
"

24 
	~"AsyncComm/Re¥Ú£C®lback.h
"

25 
	~"AsyncComm/S”Ÿliz©iÚ.h
"

27 
	~"Ma¡”.h
"

28 
	~"Reque¡HªdËrA‰rG‘.h
"

29 
	~"Re¥Ú£C®lbackA‰rG‘.h
"

31 
usšg
 
Çme¥aû
 
	gHy³r¥aû
;

32 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

37 
	gReque¡HªdËrA‰rG‘
::
	$run
() {

38 
Re¥Ú£C®lbackA‰rG‘
 
	`cb
(
m_comm
, 
m_ev’t_±r
);

39 
size_t
 
»maššg
 = 
m_ev’t_±r
->
mes§geL’
 - 2;

40 
ušt8_t
 *
msgPŒ
 = 
m_ev’t_±r
->
mes§ge
 + 2;

41 cÚ¡ *
Çme
;

42 
ušt64_t
 
hªdË
;

45 ià(!
S”Ÿliz©iÚ
::
	`decode_lÚg
(&
msgPŒ
, &
»maššg
, &
hªdË
))

46 
abÜt
;

49 ià(!
S”Ÿliz©iÚ
::
	`decode_¡ršg
(&
msgPŒ
, &
»maššg
, &
Çme
))

50 
abÜt
;

52 
m_ma¡”
->
	`©Œ_g‘
(&
cb
, 
m_£ssiÚ_id
, 
hªdË
, 
Çme
);

56 
abÜt
:

57 
	`HT_ERROR
("Encoding…roblem with ATTRGET message");

58 
cb
.
	`”rÜ
(
E¼Ü
::
PROTOCOL_ERROR
, "Encoding…roblem with ATTRGET message");

59 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/RequestHandlerAttrGet.h

21 #iâdeà
HYPERSPACE_REQUESTHANDLERATTRGET_H


22 
	#HYPERSPACE_REQUESTHANDLERATTRGET_H


	)

24 
	~"CommÚ/RuÂabË.h
"

26 
	~"AsyncComm/AµliÿtiÚHªdËr.h
"

27 
	~"AsyncComm/Comm.h
"

28 
	~"AsyncComm/Ev’t.h
"

30 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

32 
Çme¥aû
 
	gHy³r¥aû
 {

34 
şass
 
	gMa¡”
;

36 şas 
	cReque¡HªdËrA‰rG‘
 : 
public
 
AµliÿtiÚHªdËr
 {

37 
public
:

38 
Reque¡HªdËrA‰rG‘
(
Comm
 *
comm
, 
Ma¡”
 *
ma¡”
, 
ušt64_t
 
£ssiÚId
, 
Ev’tPŒ
 &
ev’tPŒ
è: 
AµliÿtiÚHªdËr
Óv’tPŒ), 
m_comm
(comm), 
m_ma¡”
(ma¡”), 
m_£ssiÚ_id
(sessionId) {

42 
vœtu®
 
run
();

44 
	g´iv©e
:

45 
Comm
 *
m_comm
;

46 
Ma¡”
 *
	gm_ma¡”
;

47 
ušt64_t
 
	gm_£ssiÚ_id
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/RequestHandlerAttrSet.cc

21 
	~"CommÚ/E¼Ü.h
"

22 
	~"CommÚ/Logg”.h
"

24 
	~"AsyncComm/Re¥Ú£C®lback.h
"

25 
	~"AsyncComm/S”Ÿliz©iÚ.h
"

27 
	~"Ma¡”.h
"

28 
	~"Reque¡HªdËrA‰rS‘.h
"

30 
usšg
 
Çme¥aû
 
	gHy³r¥aû
;

31 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

36 
	gReque¡HªdËrA‰rS‘
::
	$run
() {

37 
Re¥Ú£C®lback
 
	`cb
(
m_comm
, 
m_ev’t_±r
);

38 
size_t
 
»maššg
 = 
m_ev’t_±r
->
mes§geL’
 - 2;

39 
ušt8_t
 *
msgPŒ
 = 
m_ev’t_±r
->
mes§ge
 + 2;

40 cÚ¡ *
Çme
;

41 
ušt64_t
 
hªdË
;

42 
ušt8_t
 *
v®ue
;

43 
št32_t
 
v®ueL’
;

46 ià(!
S”Ÿliz©iÚ
::
	`decode_lÚg
(&
msgPŒ
, &
»maššg
, &
hªdË
))

47 
abÜt
;

50 ià(!
S”Ÿliz©iÚ
::
	`decode_¡ršg
(&
msgPŒ
, &
»maššg
, &
Çme
))

51 
abÜt
;

54 ià(!
S”Ÿliz©iÚ
::
	`decode_by‹_¬¿y
(&
msgPŒ
, &
»maššg
, &
v®ue
, &
v®ueL’
))

55 
abÜt
;

57 
m_ma¡”
->
	`©Œ_£t
(&
cb
, 
m_£ssiÚ_id
, 
hªdË
, 
Çme
, 
v®ue
, 
v®ueL’
);

61 
abÜt
:

62 
	`HT_ERROR
("Encoding…roblem with ATTRSET message");

63 
cb
.
	`”rÜ
(
E¼Ü
::
PROTOCOL_ERROR
, "Encoding…roblem with ATTRSET message");

64 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/RequestHandlerAttrSet.h

21 #iâdeà
HYPERSPACE_REQUESTHANDLERATTRSET_H


22 
	#HYPERSPACE_REQUESTHANDLERATTRSET_H


	)

24 
	~"CommÚ/RuÂabË.h
"

26 
	~"AsyncComm/AµliÿtiÚHªdËr.h
"

27 
	~"AsyncComm/Comm.h
"

28 
	~"AsyncComm/Ev’t.h
"

30 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

32 
Çme¥aû
 
	gHy³r¥aû
 {

34 
şass
 
	gMa¡”
;

36 şas 
	cReque¡HªdËrA‰rS‘
 : 
public
 
AµliÿtiÚHªdËr
 {

37 
public
:

38 
Reque¡HªdËrA‰rS‘
(
Comm
 *
comm
, 
Ma¡”
 *
ma¡”
, 
ušt64_t
 
£ssiÚId
, 
Ev’tPŒ
 &
ev’tPŒ
è: 
AµliÿtiÚHªdËr
Óv’tPŒ), 
m_comm
(comm), 
m_ma¡”
(ma¡”), 
m_£ssiÚ_id
(sessionId) {

42 
vœtu®
 
run
();

44 
	g´iv©e
:

45 
Comm
 *
m_comm
;

46 
Ma¡”
 *
	gm_ma¡”
;

47 
ušt64_t
 
	gm_£ssiÚ_id
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/RequestHandlerClose.cc

21 
	~"CommÚ/E¼Ü.h
"

22 
	~"CommÚ/Logg”.h
"

24 
	~"AsyncComm/Re¥Ú£C®lback.h
"

25 
	~"AsyncComm/S”Ÿliz©iÚ.h
"

27 
	~"Ma¡”.h
"

28 
	~"Reque¡HªdËrClo£.h
"

30 
usšg
 
Çme¥aû
 
	gHy³r¥aû
;

31 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

36 
	gReque¡HªdËrClo£
::
	$run
() {

37 
Re¥Ú£C®lback
 
	`cb
(
m_comm
, 
m_ev’t_±r
);

38 
size_t
 
»maššg
 = 
m_ev’t_±r
->
mes§geL’
 - 2;

39 
ušt8_t
 *
msgPŒ
 = 
m_ev’t_±r
->
mes§ge
 + 2;

40 
ušt64_t
 
hªdË
;

43 ià(!
S”Ÿliz©iÚ
::
	`decode_lÚg
(&
msgPŒ
, &
»maššg
, &
hªdË
))

44 
abÜt
;

46 
m_ma¡”
->
	`şo£
(&
cb
, 
m_£ssiÚ_id
, 
hªdË
);

50 
abÜt
:

51 
	`HT_ERROR
("Encoding…roblem with CLOSE message");

52 
cb
.
	`”rÜ
(
E¼Ü
::
PROTOCOL_ERROR
, "Encoding…roblem with CLOSE message");

53 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/RequestHandlerClose.h

21 #iâdeà
HYPERSPACE_REQUESTHANDLERCLOSE_H


22 
	#HYPERSPACE_REQUESTHANDLERCLOSE_H


	)

24 
	~"CommÚ/RuÂabË.h
"

26 
	~"AsyncComm/AµliÿtiÚHªdËr.h
"

27 
	~"AsyncComm/Comm.h
"

28 
	~"AsyncComm/Ev’t.h
"

30 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

32 
Çme¥aû
 
	gHy³r¥aû
 {

34 
şass
 
	gMa¡”
;

36 şas 
	cReque¡HªdËrClo£
 : 
public
 
AµliÿtiÚHªdËr
 {

37 
public
:

38 
Reque¡HªdËrClo£
(
Comm
 *
comm
, 
Ma¡”
 *
ma¡”
, 
ušt64_t
 
£ssiÚId
, 
Ev’tPŒ
 &
ev’tPŒ
è: 
AµliÿtiÚHªdËr
Óv’tPŒ), 
m_comm
(comm), 
m_ma¡”
(ma¡”), 
m_£ssiÚ_id
(sessionId) {

42 
vœtu®
 
run
();

44 
	g´iv©e
:

45 
Comm
 *
m_comm
;

46 
Ma¡”
 *
	gm_ma¡”
;

47 
ušt64_t
 
	gm_£ssiÚ_id
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/RequestHandlerDelete.cc

21 
	~"CommÚ/E¼Ü.h
"

22 
	~"CommÚ/Logg”.h
"

24 
	~"AsyncComm/Re¥Ú£C®lback.h
"

25 
	~"AsyncComm/S”Ÿliz©iÚ.h
"

27 
	~"Hy³¹abË/Lib/Ty³s.h
"

29 
	~"Ma¡”.h
"

30 
	~"Reque¡HªdËrD–‘e.h
"

32 
usšg
 
Çme¥aû
 
	gHy³r¥aû
;

33 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

38 
	gReque¡HªdËrD–‘e
::
	$run
() {

39 
Re¥Ú£C®lback
 
	`cb
(
m_comm
, 
m_ev’t_±r
);

40 cÚ¡ *
Çme
;

41 
size_t
 
»maššg
 = 
m_ev’t_±r
->
mes§geL’
 - 2;

42 
ušt8_t
 *
msgPŒ
 = 
m_ev’t_±r
->
mes§ge
 + 2;

45 ià(!
S”Ÿliz©iÚ
::
	`decode_¡ršg
(&
msgPŒ
, &
»maššg
, &
Çme
))

46 
abÜt
;

48 
m_ma¡”
->
	`uÆšk
(&
cb
, 
m_£ssiÚ_id
, 
Çme
);

52 
abÜt
:

53 
	`HT_ERROR
("Encoding…roblem with DELETE message");

54 
cb
.
	`”rÜ
(
E¼Ü
::
PROTOCOL_ERROR
, "Encoding…roblem with DELETE message");

55 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/RequestHandlerDelete.h

21 #iâdeà
HYPERSPACE_REQUESTHANDLERDELETE_H


22 
	#HYPERSPACE_REQUESTHANDLERDELETE_H


	)

24 
	~"CommÚ/RuÂabË.h
"

26 
	~"AsyncComm/AµliÿtiÚHªdËr.h
"

27 
	~"AsyncComm/Comm.h
"

28 
	~"AsyncComm/Ev’t.h
"

30 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

32 
Çme¥aû
 
	gHy³r¥aû
 {

34 
şass
 
	gMa¡”
;

36 şas 
	cReque¡HªdËrD–‘e
 : 
public
 
AµliÿtiÚHªdËr
 {

37 
public
:

38 
Reque¡HªdËrD–‘e
(
Comm
 *
comm
, 
Ma¡”
 *
ma¡”
, 
ušt64_t
 
£ssiÚId
, 
Ev’tPŒ
 &
ev’tPŒ
è: 
AµliÿtiÚHªdËr
Óv’tPŒ), 
m_comm
(comm), 
m_ma¡”
(ma¡”), 
m_£ssiÚ_id
(sessionId) {

42 
vœtu®
 
run
();

44 
	g´iv©e
:

45 
Comm
 *
m_comm
;

46 
Ma¡”
 *
	gm_ma¡”
;

47 
ušt64_t
 
	gm_£ssiÚ_id
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/RequestHandlerExists.cc

21 
	~"CommÚ/E¼Ü.h
"

22 
	~"CommÚ/Logg”.h
"

24 
	~"AsyncComm/Re¥Ú£C®lback.h
"

25 
	~"AsyncComm/S”Ÿliz©iÚ.h
"

27 
	~"Hy³¹abË/Lib/Ty³s.h
"

29 
	~"Ma¡”.h
"

30 
	~"Reque¡HªdËrExi¡s.h
"

31 
	~"Re¥Ú£C®lbackExi¡s.h
"

33 
usšg
 
Çme¥aû
 
	gHy³r¥aû
;

34 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

39 
	gReque¡HªdËrExi¡s
::
	$run
() {

40 
Re¥Ú£C®lbackExi¡s
 
	`cb
(
m_comm
, 
m_ev’t_±r
);

41 cÚ¡ *
Çme
;

42 
size_t
 
»maššg
 = 
m_ev’t_±r
->
mes§geL’
 - 2;

43 
ušt8_t
 *
msgPŒ
 = 
m_ev’t_±r
->
mes§ge
 + 2;

46 ià(!
S”Ÿliz©iÚ
::
	`decode_¡ršg
(&
msgPŒ
, &
»maššg
, &
Çme
))

47 
abÜt
;

49 
m_ma¡”
->
	`exi¡s
(&
cb
, 
m_£ssiÚ_id
, 
Çme
);

53 
abÜt
:

54 
	`HT_ERROR
("Encoding…roblem with EXISTS message");

55 
cb
.
	`”rÜ
(
E¼Ü
::
PROTOCOL_ERROR
, "Encoding…roblem with EXISTS message");

56 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/RequestHandlerExists.h

21 #iâdeà
HYPERSPACE_REQUESTHANDLEREXISTS_H


22 
	#HYPERSPACE_REQUESTHANDLEREXISTS_H


	)

24 
	~"CommÚ/RuÂabË.h
"

26 
	~"AsyncComm/AµliÿtiÚHªdËr.h
"

27 
	~"AsyncComm/Comm.h
"

28 
	~"AsyncComm/Ev’t.h
"

30 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

32 
Çme¥aû
 
	gHy³r¥aû
 {

34 
şass
 
	gMa¡”
;

36 şas 
	cReque¡HªdËrExi¡s
 : 
public
 
AµliÿtiÚHªdËr
 {

37 
public
:

38 
Reque¡HªdËrExi¡s
(
Comm
 *
comm
, 
Ma¡”
 *
ma¡”
, 
ušt64_t
 
£ssiÚId
, 
Ev’tPŒ
 &
ev’tPŒ
è: 
AµliÿtiÚHªdËr
Óv’tPŒ), 
m_comm
(comm), 
m_ma¡”
(ma¡”), 
m_£ssiÚ_id
(sessionId) {

42 
vœtu®
 
run
();

44 
	g´iv©e
:

45 
Comm
 *
m_comm
;

46 
Ma¡”
 *
	gm_ma¡”
;

47 
ušt64_t
 
	gm_£ssiÚ_id
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/RequestHandlerLock.cc

21 
	~"CommÚ/E¼Ü.h
"

22 
	~"CommÚ/Logg”.h
"

24 
	~"AsyncComm/Re¥Ú£C®lback.h
"

25 
	~"AsyncComm/S”Ÿliz©iÚ.h
"

27 
	~"Ma¡”.h
"

28 
	~"Reque¡HªdËrLock.h
"

29 
	~"Re¥Ú£C®lbackLock.h
"

31 
usšg
 
Çme¥aû
 
	gHy³r¥aû
;

32 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

37 
	gReque¡HªdËrLock
::
	$run
() {

38 
Re¥Ú£C®lbackLock
 
	`cb
(
m_comm
, 
m_ev’t_±r
);

39 
size_t
 
»maššg
 = 
m_ev’t_±r
->
mes§geL’
 - 2;

40 
ušt8_t
 *
msgPŒ
 = 
m_ev’t_±r
->
mes§ge
 + 2;

41 
ušt64_t
 
hªdË
;

42 
ušt32_t
 
mode
;

43 
ušt8_t
 
ŒyAcquœe
;

46 ià(!
S”Ÿliz©iÚ
::
	`decode_lÚg
(&
msgPŒ
, &
»maššg
, &
hªdË
))

47 
abÜt
;

50 ià(!
S”Ÿliz©iÚ
::
	`decode_št
(&
msgPŒ
, &
»maššg
, &
mode
))

51 
abÜt
;

54 ià(!
S”Ÿliz©iÚ
::
	`decode_by‹
(&
msgPŒ
, &
»maššg
, &
ŒyAcquœe
))

55 
abÜt
;

57 
m_ma¡”
->
	`lock
(&
cb
, 
m_£ssiÚ_id
, 
hªdË
, 
mode
, (
boŞ
)
ŒyAcquœe
);

61 
abÜt
:

62 
	`HT_ERROR
("Encoding…roblem with LOCK message");

63 
cb
.
	`”rÜ
(
E¼Ü
::
PROTOCOL_ERROR
, "Encoding…roblem with LOCK message");

64 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/RequestHandlerLock.h

21 #iâdeà
HYPERSPACE_REQUESTHANDLERLOCK_H


22 
	#HYPERSPACE_REQUESTHANDLERLOCK_H


	)

24 
	~"CommÚ/RuÂabË.h
"

26 
	~"AsyncComm/AµliÿtiÚHªdËr.h
"

27 
	~"AsyncComm/Comm.h
"

28 
	~"AsyncComm/Ev’t.h
"

30 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

32 
Çme¥aû
 
	gHy³r¥aû
 {

34 
şass
 
	gMa¡”
;

36 şas 
	cReque¡HªdËrLock
 : 
public
 
AµliÿtiÚHªdËr
 {

37 
public
:

38 
Reque¡HªdËrLock
(
Comm
 *
comm
, 
Ma¡”
 *
ma¡”
, 
ušt64_t
 
£ssiÚId
, 
Ev’tPŒ
 &
ev’tPŒ
è: 
AµliÿtiÚHªdËr
Óv’tPŒ), 
m_comm
(comm), 
m_ma¡”
(ma¡”), 
m_£ssiÚ_id
(sessionId) {

42 
vœtu®
 
run
();

44 
	g´iv©e
:

45 
Comm
 *
m_comm
;

46 
Ma¡”
 *
	gm_ma¡”
;

47 
ušt64_t
 
	gm_£ssiÚ_id
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/RequestHandlerMkdir.cc

21 
	~"CommÚ/E¼Ü.h
"

22 
	~"CommÚ/Logg”.h
"

24 
	~"AsyncComm/Re¥Ú£C®lback.h
"

25 
	~"AsyncComm/S”Ÿliz©iÚ.h
"

27 
	~"Hy³¹abË/Lib/Ty³s.h
"

29 
	~"Ma¡”.h
"

30 
	~"Reque¡HªdËrMkdœ.h
"

32 
usšg
 
Çme¥aû
 
	gHy³r¥aû
;

33 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

38 
	gReque¡HªdËrMkdœ
::
	$run
() {

39 
Re¥Ú£C®lback
 
	`cb
(
m_comm
, 
m_ev’t_±r
);

40 cÚ¡ *
Çme
;

41 
size_t
 
»maššg
 = 
m_ev’t_±r
->
mes§geL’
 - 2;

42 
ušt8_t
 *
msgPŒ
 = 
m_ev’t_±r
->
mes§ge
 + 2;

45 ià(!
S”Ÿliz©iÚ
::
	`decode_¡ršg
(&
msgPŒ
, &
»maššg
, &
Çme
))

46 
abÜt
;

48 
m_ma¡”
->
	`mkdœ
(&
cb
, 
m_£ssiÚ_id
, 
Çme
);

52 
abÜt
:

53 
	`HT_ERROR
("Encoding…roblem with MKDIR message");

54 
cb
.
	`”rÜ
(
E¼Ü
::
PROTOCOL_ERROR
, "Encoding…roblem with MKDIR message");

55 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/RequestHandlerMkdir.h

21 #iâdeà
HYPERSPACE_REQUESTHANDLERMKDIR_H


22 
	#HYPERSPACE_REQUESTHANDLERMKDIR_H


	)

24 
	~"CommÚ/RuÂabË.h
"

26 
	~"AsyncComm/AµliÿtiÚHªdËr.h
"

27 
	~"AsyncComm/Comm.h
"

28 
	~"AsyncComm/Ev’t.h
"

30 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

32 
Çme¥aû
 
	gHy³r¥aû
 {

34 
şass
 
	gMa¡”
;

36 şas 
	cReque¡HªdËrMkdœ
 : 
public
 
AµliÿtiÚHªdËr
 {

37 
public
:

38 
Reque¡HªdËrMkdœ
(
Comm
 *
comm
, 
Ma¡”
 *
ma¡”
, 
ušt64_t
 
£ssiÚId
, 
Ev’tPŒ
 &
ev’tPŒ
è: 
AµliÿtiÚHªdËr
Óv’tPŒ), 
m_comm
(comm), 
m_ma¡”
(ma¡”), 
m_£ssiÚ_id
(sessionId) {

42 
vœtu®
 
run
();

44 
	g´iv©e
:

45 
Comm
 *
m_comm
;

46 
Ma¡”
 *
	gm_ma¡”
;

47 
ušt64_t
 
	gm_£ssiÚ_id
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/RequestHandlerOpen.cc

21 
	~"CommÚ/E¼Ü.h
"

22 
	~"CommÚ/Logg”.h
"

24 
	~"AsyncComm/Re¥Ú£C®lback.h
"

25 
	~"AsyncComm/S”Ÿliz©iÚ.h
"

27 
	~"Hy³¹abË/Lib/Ty³s.h
"

29 
	~"Ma¡”.h
"

30 
	~"PrÙocŞ.h
"

31 
	~"Reque¡HªdËrO³n.h
"

33 
usšg
 
Çme¥aû
 
	gHy³r¥aû
;

34 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

39 
	gReque¡HªdËrO³n
::
	$run
() {

40 
Re¥Ú£C®lbackO³n
 
	`cb
(
m_comm
, 
m_ev’t_±r
);

41 cÚ¡ *
Çme
;

42 
ušt32_t
 
æags
;

43 
ušt32_t
 
ev’tMask
;

44 
size_t
 
»maššg
 = 
m_ev’t_±r
->
mes§geL’
 - 2;

45 
ušt8_t
 *
msgPŒ
 = 
m_ev’t_±r
->
mes§ge
 + 2;

46 
ušt32_t
 
©ŒCouÁ
;

47 
A‰ribu‹T
 
©Œ
;

48 
¡d
::
veùÜ
<
A‰ribu‹T
> 
š™A‰rs
;

51 ià(!
S”Ÿliz©iÚ
::
	`decode_št
(&
msgPŒ
, &
»maššg
, &
æags
))

52 
abÜt
;

55 ià(!
S”Ÿliz©iÚ
::
	`decode_št
(&
msgPŒ
, &
»maššg
, &
ev’tMask
))

56 
abÜt
;

59 ià(!
S”Ÿliz©iÚ
::
	`decode_¡ršg
(&
msgPŒ
, &
»maššg
, &
Çme
))

60 
abÜt
;

63 ià(!
S”Ÿliz©iÚ
::
	`decode_št
(&
msgPŒ
, &
»maššg
, &
©ŒCouÁ
))

64 
abÜt
;

67 
ušt32_t
 
i
=0; i<
©ŒCouÁ
; i++) {

68 ià(!
S”Ÿliz©iÚ
::
	`decode_¡ršg
(&
msgPŒ
, &
»maššg
, &
©Œ
.
Çme
))

69 
abÜt
;

70 ià(!
S”Ÿliz©iÚ
::
	`decode_by‹_¬¿y
(&
msgPŒ
, &
»maššg
, (
ušt8_t
 **)&
©Œ
.
v®ue
, &©Œ.
v®ueL’
))

71 
abÜt
;

72 
š™A‰rs
.
	`push_back
(
©Œ
);

75 
m_ma¡”
->
	`İ’
(&
cb
, 
m_£ssiÚ_id
, 
Çme
, 
æags
, 
ev’tMask
, 
š™A‰rs
);

79 
abÜt
:

80 
	`HT_ERROR
("Encoding…roblem with OPEN message");

81 
cb
.
	`”rÜ
(
E¼Ü
::
PROTOCOL_ERROR
, "Encoding…roblem with OPEN message");

82 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/RequestHandlerOpen.h

21 #iâdeà
HYPERSPACE_REQUESTHANDLEROPEN_H


22 
	#HYPERSPACE_REQUESTHANDLEROPEN_H


	)

24 
	~"CommÚ/RuÂabË.h
"

26 
	~"AsyncComm/AµliÿtiÚHªdËr.h
"

27 
	~"AsyncComm/Comm.h
"

28 
	~"AsyncComm/Ev’t.h
"

30 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

32 
Çme¥aû
 
	gHy³r¥aû
 {

34 
şass
 
	gMa¡”
;

36 şas 
	cReque¡HªdËrO³n
 : 
public
 
AµliÿtiÚHªdËr
 {

37 
public
:

38 
Reque¡HªdËrO³n
(
Comm
 *
comm
, 
Ma¡”
 *
ma¡”
, 
ušt64_t
 
£ssiÚId
, 
Ev’tPŒ
 &
ev’tPŒ
è: 
AµliÿtiÚHªdËr
Óv’tPŒ), 
m_comm
(comm), 
m_ma¡”
(ma¡”), 
m_£ssiÚ_id
(sessionId) {

42 
vœtu®
 
run
();

44 
	g´iv©e
:

45 
Comm
 *
m_comm
;

46 
Ma¡”
 *
	gm_ma¡”
;

47 
ušt64_t
 
	gm_£ssiÚ_id
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/RequestHandlerReaddir.cc

21 
	~"CommÚ/E¼Ü.h
"

22 
	~"CommÚ/Logg”.h
"

24 
	~"AsyncComm/Re¥Ú£C®lback.h
"

25 
	~"AsyncComm/S”Ÿliz©iÚ.h
"

27 
	~"Ma¡”.h
"

28 
	~"Reque¡HªdËrR—ddœ.h
"

29 
	~"Re¥Ú£C®lbackR—ddœ.h
"

31 
usšg
 
Çme¥aû
 
	gHy³r¥aû
;

32 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

37 
	gReque¡HªdËrR—ddœ
::
	$run
() {

38 
Re¥Ú£C®lbackR—ddœ
 
	`cb
(
m_comm
, 
m_ev’t_±r
);

39 
size_t
 
»maššg
 = 
m_ev’t_±r
->
mes§geL’
 - 2;

40 
ušt8_t
 *
msgPŒ
 = 
m_ev’t_±r
->
mes§ge
 + 2;

41 
ušt64_t
 
hªdË
;

44 ià(!
S”Ÿliz©iÚ
::
	`decode_lÚg
(&
msgPŒ
, &
»maššg
, &
hªdË
))

45 
abÜt
;

47 
m_ma¡”
->
	`»addœ
(&
cb
, 
m_£ssiÚ_id
, 
hªdË
);

51 
abÜt
:

52 
	`HT_ERROR
("Encoding…roblem with READDIR message");

53 
cb
.
	`”rÜ
(
E¼Ü
::
PROTOCOL_ERROR
, "Encoding…roblem with READDIR message");

54 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/RequestHandlerReaddir.h

21 #iâdeà
HYPERSPACE_REQUESTHANDLERREADDIR_H


22 
	#HYPERSPACE_REQUESTHANDLERREADDIR_H


	)

24 
	~"CommÚ/RuÂabË.h
"

26 
	~"AsyncComm/AµliÿtiÚHªdËr.h
"

27 
	~"AsyncComm/Comm.h
"

28 
	~"AsyncComm/Ev’t.h
"

30 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

32 
Çme¥aû
 
	gHy³r¥aû
 {

34 
şass
 
	gMa¡”
;

36 şas 
	cReque¡HªdËrR—ddœ
 : 
public
 
AµliÿtiÚHªdËr
 {

37 
public
:

38 
Reque¡HªdËrR—ddœ
(
Comm
 *
comm
, 
Ma¡”
 *
ma¡”
, 
ušt64_t
 
£ssiÚId
, 
Ev’tPŒ
 &
ev’tPŒ
è: 
AµliÿtiÚHªdËr
Óv’tPŒ), 
m_comm
(comm), 
m_ma¡”
(ma¡”), 
m_£ssiÚ_id
(sessionId) {

42 
vœtu®
 
run
();

44 
	g´iv©e
:

45 
Comm
 *
m_comm
;

46 
Ma¡”
 *
	gm_ma¡”
;

47 
ušt64_t
 
	gm_£ssiÚ_id
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/RequestHandlerRelease.cc

21 
	~"CommÚ/E¼Ü.h
"

22 
	~"CommÚ/Logg”.h
"

24 
	~"AsyncComm/Re¥Ú£C®lback.h
"

25 
	~"AsyncComm/S”Ÿliz©iÚ.h
"

27 
	~"Ma¡”.h
"

28 
	~"Reque¡HªdËrR–—£.h
"

30 
usšg
 
Çme¥aû
 
	gHy³r¥aû
;

31 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

36 
	gReque¡HªdËrR–—£
::
	$run
() {

37 
Re¥Ú£C®lback
 
	`cb
(
m_comm
, 
m_ev’t_±r
);

38 
size_t
 
»maššg
 = 
m_ev’t_±r
->
mes§geL’
 - 2;

39 
ušt8_t
 *
msgPŒ
 = 
m_ev’t_±r
->
mes§ge
 + 2;

40 
ušt64_t
 
hªdË
;

43 ià(!
S”Ÿliz©iÚ
::
	`decode_lÚg
(&
msgPŒ
, &
»maššg
, &
hªdË
))

44 
abÜt
;

46 
m_ma¡”
->
	`»Ëa£
(&
cb
, 
m_£ssiÚ_id
, 
hªdË
);

50 
abÜt
:

51 
	`HT_ERROR
("Encoding…roblem with RELEASE message");

52 
cb
.
	`”rÜ
(
E¼Ü
::
PROTOCOL_ERROR
, "Encoding…roblem with RELEASE message");

53 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/RequestHandlerRelease.h

21 #iâdeà
HYPERSPACE_REQUESTHANDLERRELEASE_H


22 
	#HYPERSPACE_REQUESTHANDLERRELEASE_H


	)

24 
	~"CommÚ/RuÂabË.h
"

26 
	~"AsyncComm/AµliÿtiÚHªdËr.h
"

27 
	~"AsyncComm/Comm.h
"

28 
	~"AsyncComm/Ev’t.h
"

30 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

32 
Çme¥aû
 
	gHy³r¥aû
 {

34 
şass
 
	gMa¡”
;

36 şas 
	cReque¡HªdËrR–—£
 : 
public
 
AµliÿtiÚHªdËr
 {

37 
public
:

38 
Reque¡HªdËrR–—£
(
Comm
 *
comm
, 
Ma¡”
 *
ma¡”
, 
ušt64_t
 
£ssiÚId
, 
Ev’tPŒ
 &
ev’tPŒ
è: 
AµliÿtiÚHªdËr
Óv’tPŒ), 
m_comm
(comm), 
m_ma¡”
(ma¡”), 
m_£ssiÚ_id
(sessionId) {

42 
vœtu®
 
run
();

44 
	g´iv©e
:

45 
Comm
 *
m_comm
;

46 
Ma¡”
 *
	gm_ma¡”
;

47 
ušt64_t
 
	gm_£ssiÚ_id
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/RequestHandlerStatus.cc

21 
	~"AsyncComm/Re¥Ú£C®lback.h
"

23 
	~"Reque¡HªdËrStus.h
"

25 
usšg
 
Çme¥aû
 
	gHy³r¥aû
;

26 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

31 
	gReque¡HªdËrStus
::
	$run
() {

32 
Re¥Ú£C®lback
 
	`cb
(
m_comm
, 
m_ev’t_±r
);

33 
cb
.
	`»¥Ú£_ok
();

34 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/RequestHandlerStatus.h

21 #iâdeà
HYPERSPACE_REQUESTHANDLERSTATUS_H


22 
	#HYPERSPACE_REQUESTHANDLERSTATUS_H


	)

24 
	~"CommÚ/RuÂabË.h
"

26 
	~"AsyncComm/AµliÿtiÚHªdËr.h
"

27 
	~"AsyncComm/Comm.h
"

28 
	~"AsyncComm/Ev’t.h
"

30 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

32 
Çme¥aû
 
	gHy³r¥aû
 {

34 
şass
 
	gMa¡”
;

36 şas 
	cReque¡HªdËrStus
 : 
public
 
AµliÿtiÚHªdËr
 {

37 
public
:

38 
Reque¡HªdËrStus
(
Comm
 *
comm
, 
Ma¡”
 *
ma¡”
, 
ušt64_t
 
£ssiÚId
, 
Ev’tPŒ
 &
ev’tPŒ
è: 
AµliÿtiÚHªdËr
Óv’tPŒ), 
m_comm
(comm), 
m_ma¡”
(ma¡”), 
m_£ssiÚ_id
(sessionId) {

42 
vœtu®
 
run
();

44 
	g´iv©e
:

45 
Comm
 *
m_comm
;

46 
Ma¡”
 *
	gm_ma¡”
;

47 
ušt64_t
 
	gm_£ssiÚ_id
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/ResponseCallbackAttrGet.cc

21 
	~"CommÚ/E¼Ü.h
"

23 
	~"AsyncComm/CommBuf.h
"

25 
	~"Re¥Ú£C®lbackA‰rG‘.h
"

27 
usšg
 
Çme¥aû
 
	gHy³r¥aû
;

28 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

33 
	gRe¥Ú£C®lbackA‰rG‘
::
	$»¥Ú£
(cÚ¡ 
ušt8_t
 *
d©a
, 
ušt32_t
 
Ën
) {

34 
hbud”_
.
	`š™Ÿlize_äom_»que¡
(
m_ev’t_±r
->
h—d”
);

35 
CommBufPŒ
 
	`cbufPŒ
Ğ
Ãw
 
	`CommBuf
(
hbud”_
, 8, 
d©a
, 
Ën
) );

36 
cbufPŒ
->
	`­³nd_št
(
E¼Ü
::
OK
);

37 
cbufPŒ
->
	`­³nd_št
(
Ën
);

38  
m_comm
->
	`£nd_»¥Ú£
(
m_ev’t_±r
->
addr
, 
cbufPŒ
);

39 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/ResponseCallbackAttrGet.h

21 #iâdeà
HYPERSPACE_RESPONSECALLBACKATTRGET_H


22 
	#HYPERSPACE_RESPONSECALLBACKATTRGET_H


	)

24 
	~"CommÚ/E¼Ü.h
"

26 
	~"AsyncComm/CommBuf.h
"

27 
	~"AsyncComm/Re¥Ú£C®lback.h
"

29 
Çme¥aû
 
	gHy³r¥aû
 {

31 şas 
	cRe¥Ú£C®lbackA‰rG‘
 : 
public
 
Hy³¹abË
::
Re¥Ú£C®lback
 {

32 
public
:

33 
Re¥Ú£C®lbackA‰rG‘
(
Hy³¹abË
::
Comm
 *
comm
, Hy³¹abË::
Ev’tPŒ
 &
ev’tPŒ
è: Hy³¹abË::
Re¥Ú£C®lback
(comm,ƒventPtr) { ; }

34 
»¥Ú£
(cÚ¡ 
ušt8_t
 *
d©a
, 
ušt32_t
 
Ën
);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/ResponseCallbackExists.cc

21 
	~"CommÚ/E¼Ü.h
"

23 
	~"AsyncComm/CommBuf.h
"

25 
	~"Re¥Ú£C®lbackExi¡s.h
"

27 
usšg
 
Çme¥aû
 
	gHy³r¥aû
;

28 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

30 
	gRe¥Ú£C®lbackExi¡s
::
	$»¥Ú£
(
boŞ
 
exi¡s
) {

31 
hbud”_
.
	`š™Ÿlize_äom_»que¡
(
m_ev’t_±r
->
h—d”
);

32 
CommBufPŒ
 
	`cbufPŒ
Ğ
Ãw
 
	`CommBuf
(
hbud”_
, 5 ) );

33 
cbufPŒ
->
	`­³nd_št
(
E¼Ü
::
OK
);

34 
cbufPŒ
->
	`­³nd_by‹
((
ušt8_t
)
exi¡s
);

35  
m_comm
->
	`£nd_»¥Ú£
(
m_ev’t_±r
->
addr
, 
cbufPŒ
);

36 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/ResponseCallbackExists.h

21 #iâdeà
HYPERSPACE_RESPONSECALLBACKEXISTS_H


22 
	#HYPERSPACE_RESPONSECALLBACKEXISTS_H


	)

24 
	~"CommÚ/E¼Ü.h
"

26 
	~"AsyncComm/CommBuf.h
"

27 
	~"AsyncComm/Re¥Ú£C®lback.h
"

29 
Çme¥aû
 
	gHy³r¥aû
 {

31 şas 
	cRe¥Ú£C®lbackExi¡s
 : 
public
 
Hy³¹abË
::
Re¥Ú£C®lback
 {

32 
public
:

33 
Re¥Ú£C®lbackExi¡s
(
Hy³¹abË
::
Comm
 *
comm
, Hy³¹abË::
Ev’tPŒ
 &
ev’tPŒ
è: Hy³¹abË::
Re¥Ú£C®lback
(comm,ƒventPtr) { ; }

34 
»¥Ú£
(
boŞ
 
exi¡s
);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/ResponseCallbackLock.cc

21 
	~"CommÚ/E¼Ü.h
"

23 
	~"AsyncComm/CommBuf.h
"

25 
	~"Re¥Ú£C®lbackLock.h
"

27 
usšg
 
Çme¥aû
 
	gHy³r¥aû
;

28 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

33 
	gRe¥Ú£C®lbackLock
::
	$»¥Ú£
(
ušt32_t
 
¡©us
, 
ušt64_t
 
lockG’”©iÚ
) {

34 
hbud”_
.
	`š™Ÿlize_äom_»que¡
(
m_ev’t_±r
->
h—d”
);

35 
CommBufPŒ
 
	`cbufPŒ
Ğ
Ãw
 
	`CommBuf
(
hbud”_
, 16) );

36 
cbufPŒ
->
	`­³nd_št
(
E¼Ü
::
OK
);

37 
cbufPŒ
->
	`­³nd_št
(
¡©us
);

38 
cbufPŒ
->
	`­³nd_lÚg
(
lockG’”©iÚ
);

39  
m_comm
->
	`£nd_»¥Ú£
(
m_ev’t_±r
->
addr
, 
cbufPŒ
);

40 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/ResponseCallbackLock.h

21 #iâdeà
HYPERSPACE_RESPONSECALLBACKLOCK_H


22 
	#HYPERSPACE_RESPONSECALLBACKLOCK_H


	)

24 
	~"CommÚ/E¼Ü.h
"

26 
	~"AsyncComm/CommBuf.h
"

27 
	~"AsyncComm/Re¥Ú£C®lback.h
"

29 
Çme¥aû
 
	gHy³r¥aû
 {

31 şas 
	cRe¥Ú£C®lbackLock
 : 
public
 
Hy³¹abË
::
Re¥Ú£C®lback
 {

32 
public
:

33 
Re¥Ú£C®lbackLock
(
Hy³¹abË
::
Comm
 *
comm
, Hy³¹abË::
Ev’tPŒ
 &
ev’tPŒ
è: Hy³¹abË::
Re¥Ú£C®lback
(comm,ƒventPtr) { ; }

34 
»¥Ú£
(
ušt32_t
 
¡©us
, 
ušt64_t
 
lockG’”©iÚ
=0);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/ResponseCallbackOpen.cc

21 
	~"CommÚ/E¼Ü.h
"

23 
	~"AsyncComm/CommBuf.h
"

25 
	~"Re¥Ú£C®lbackO³n.h
"

27 
usšg
 
Çme¥aû
 
	gHy³r¥aû
;

28 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

30 
	gRe¥Ú£C®lbackO³n
::
	$»¥Ú£
(
ušt64_t
 
hªdË
, 
boŞ
 
ü—‹d
, ušt64_ˆ
lockG’”©iÚ
) {

31 
hbud”_
.
	`š™Ÿlize_äom_»que¡
(
m_ev’t_±r
->
h—d”
);

32 
CommBufPŒ
 
	`cbufPŒ
Ğ
Ãw
 
	`CommBuf
(
hbud”_
, 21 ) );

33 
cbufPŒ
->
	`­³nd_št
(
E¼Ü
::
OK
);

34 
cbufPŒ
->
	`­³nd_lÚg
(
hªdË
);

35 
cbufPŒ
->
	`­³nd_by‹
((
ušt8_t
)
ü—‹d
);

36 
cbufPŒ
->
	`­³nd_lÚg
(
lockG’”©iÚ
);

37  
m_comm
->
	`£nd_»¥Ú£
(
m_ev’t_±r
->
addr
, 
cbufPŒ
);

38 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/ResponseCallbackOpen.h

21 #iâdeà
HYPERSPACE_RESPONSECALLBACKOPEN_H


22 
	#HYPERSPACE_RESPONSECALLBACKOPEN_H


	)

24 
	~"CommÚ/E¼Ü.h
"

26 
	~"AsyncComm/CommBuf.h
"

27 
	~"AsyncComm/Re¥Ú£C®lback.h
"

29 
Çme¥aû
 
	gHy³r¥aû
 {

31 şas 
	cRe¥Ú£C®lbackO³n
 : 
public
 
Hy³¹abË
::
Re¥Ú£C®lback
 {

32 
public
:

33 
Re¥Ú£C®lbackO³n
(
Hy³¹abË
::
Comm
 *
comm
, Hy³¹abË::
Ev’tPŒ
 &
ev’tPŒ
è: Hy³¹abË::
Re¥Ú£C®lback
(comm,ƒventPtr) { ; }

34 
»¥Ú£
(
ušt64_t
 
hªdË
, 
boŞ
 
ü—‹d
, ušt64_ˆ
lockG’”©iÚ
);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/ResponseCallbackReaddir.cc

21 
	~"CommÚ/E¼Ü.h
"

23 
	~"AsyncComm/CommBuf.h
"

25 
	~"Re¥Ú£C®lbackR—ddœ.h
"

27 
usšg
 
Çme¥aû
 
	gHy³r¥aû
;

28 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

33 
	gRe¥Ú£C®lbackR—ddœ
::
»¥Ú£
(
¡d
::
veùÜ
<
DœEÁryT
> &
li¡šg
) {

34 
hbud”_
.
š™Ÿlize_äom_»que¡
(
m_ev’t_±r
->
h—d”
);

35 
ušt32_t
 
	gËn
 = 8;

37 
size_t
 
	gi
=0; i<
	gli¡šg
.
size
(); i++)

38 
	gËn
 +ğ
’coded_Ëngth_dœ_’Œy
(
li¡šg
[
i
]);

40 
CommBufPŒ
 
cbufPŒ
Ğ
Ãw
 
CommBuf
(
hbud”_
, 
Ën
) );

42 
	gcbufPŒ
->
­³nd_št
(
E¼Ü
::
OK
);

43 
	gcbufPŒ
->
­³nd_št
(
li¡šg
.
size
());

45 
size_t
 
	gi
=0; i<
	gli¡šg
.
size
(); i++)

46 
’code_dœ_’Œy
(
cbufPŒ
->
g‘_d©a_±r_add»ss
(), 
li¡šg
[
i
]);

47  
	gm_comm
->
£nd_»¥Ú£
(
m_ev’t_±r
->
addr
, 
cbufPŒ
);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/ResponseCallbackReaddir.h

21 #iâdeà
HYPERSPACE_RESPONSECALLBACKREADDIR_H


22 
	#HYPERSPACE_RESPONSECALLBACKREADDIR_H


	)

24 
	~"CommÚ/E¼Ü.h
"

26 
	~"AsyncComm/CommBuf.h
"

27 
	~"AsyncComm/Re¥Ú£C®lback.h
"

29 
	~"DœEÁry.h
"

31 
Çme¥aû
 
	gHy³r¥aû
 {

33 şas 
	cRe¥Ú£C®lbackR—ddœ
 : 
public
 
Hy³¹abË
::
Re¥Ú£C®lback
 {

34 
public
:

35 
Re¥Ú£C®lbackR—ddœ
(
Hy³¹abË
::
Comm
 *
comm
, Hy³¹abË::
Ev’tPŒ
 &
ev’tPŒ
è: Hy³¹abË::
Re¥Ú£C®lback
(comm,ƒventPtr) { ; }

36 
»¥Ú£
(
¡d
::
veùÜ
<
DœEÁryT
> &
li¡šg
);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/ServerConnectionHandler.cc

21 
	~"CommÚ/E¼Ü.h
"

22 
	~"CommÚ/Exû±iÚ.h
"

23 
	~"CommÚ/SŒšgExt.h
"

25 
	~"AsyncComm/AµliÿtiÚQueue.h
"

27 
	~"PrÙocŞ.h
"

28 
	~"Reque¡HªdËrA‰rS‘.h
"

29 
	~"Reque¡HªdËrA‰rG‘.h
"

30 
	~"Reque¡HªdËrA‰rD–.h
"

31 
	~"Reque¡HªdËrMkdœ.h
"

32 
	~"Reque¡HªdËrD–‘e.h
"

33 
	~"Reque¡HªdËrO³n.h
"

34 
	~"Reque¡HªdËrClo£.h
"

35 
	~"Reque¡HªdËrExi¡s.h
"

36 
	~"Reque¡HªdËrR—ddœ.h
"

37 
	~"Reque¡HªdËrLock.h
"

38 
	~"Reque¡HªdËrR–—£.h
"

39 
	~"Reque¡HªdËrStus.h
"

40 
	~"S”v”CÚÃùiÚHªdËr.h
"

42 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

43 
usšg
 
Çme¥aû
 
	gHy³r¥aû
;

49 
	gS”v”CÚÃùiÚHªdËr
::
	$hªdË
(
Ev’tPŒ
 &
ev’tPŒ
) {

50 
ušt16_t
 
commªd
 = (uint16_t)-1;

51 
”rÜ
;

53 
	`HT_INFOF
("%s", 
ev’tPŒ
->
	`toSŒšg
().
	`c_¡r
());

55 ià(
ev’tPŒ
->
ty³
 =ğ
Hy³¹abË
::
Ev’t
::
MESSAGE
) {

56 
AµliÿtiÚHªdËr
 *
»que¡HªdËr
 = 0;

57 
ušt8_t
 *
msgPŒ
 = 
ev’tPŒ
->
mes§ge
;

58 
size_t
 
»maššg
 = 
ev’tPŒ
->
mes§geL’
;

60 
Œy
 {

62 ià(!
S”Ÿliz©iÚ
::
	`decode_shÜt
(&
msgPŒ
, &
»maššg
, &
commªd
)) {

63 
¡d
::
¡ršg
 
mes§ge
 = "Truncated Request";

64 
throw
 
Ãw
 
	`PrÙocŞExû±iÚ
(
mes§ge
);

68 ià(
commªd
 >ğ
PrÙocŞ
::
COMMAND_MAX
) {

69 
¡d
::
¡ršg
 
mes§ge
 = (¡d::¡ršg)"Inv®id commªd (" + 
commªd
 + ")";

70 
throw
 
	`PrÙocŞExû±iÚ
(
mes§ge
);

73 ià(
commªd
 !ğ
PrÙocŞ
::
COMMAND_HANDSHAKE
 &&

74 (
”rÜ
 = 
m_ma¡”_±r
->
	`»Ãw_£ssiÚ_Ëa£
(
m_£ssiÚ_id
)è!ğ
E¼Ü
::
OK
) {

75 
Re¥Ú£C®lback
 
	`cb
(
m_comm
, 
ev’tPŒ
);

76 
	`HT_INFOF
("SessiÚ hªdË %Îdƒxpœed", 
m_£ssiÚ_id
);

77 
cb
.
	`”rÜ
(
”rÜ
, "");

81 
commªd
) {

82 
PrÙocŞ
::
COMMAND_HANDSHAKE
:

84 
Re¥Ú£C®lback
 
	`cb
(
m_comm
, 
ev’tPŒ
);

85 ià(!
S”Ÿliz©iÚ
::
	`decode_lÚg
(&
msgPŒ
, &
»maššg
, &
m_£ssiÚ_id
)) {

86 
¡d
::
¡ršg
 
mes§ge
 = "Truncated Request";

87 
throw
 
Ãw
 
	`PrÙocŞExû±iÚ
(
mes§ge
);

89 ià(
m_£ssiÚ_id
 == 0) {

90 
¡d
::
¡ršg
 
mes§ge
 = "Bad Session ID: 0";

91 
throw
 
Ãw
 
	`PrÙocŞExû±iÚ
(
mes§ge
);

93 
cb
.
	`»¥Ú£_ok
();

96 
PrÙocŞ
::
COMMAND_OPEN
:

97 
»que¡HªdËr
 = 
Ãw
 
	`Reque¡HªdËrO³n
(
m_comm
, 
m_ma¡”_±r
.
	`g‘
(), 
m_£ssiÚ_id
, 
ev’tPŒ
);

99 
PrÙocŞ
::
COMMAND_CLOSE
:

100 
»que¡HªdËr
 = 
Ãw
 
	`Reque¡HªdËrClo£
(
m_comm
, 
m_ma¡”_±r
.
	`g‘
(), 
m_£ssiÚ_id
, 
ev’tPŒ
);

102 
PrÙocŞ
::
COMMAND_MKDIR
:

103 
»que¡HªdËr
 = 
Ãw
 
	`Reque¡HªdËrMkdœ
(
m_comm
, 
m_ma¡”_±r
.
	`g‘
(), 
m_£ssiÚ_id
, 
ev’tPŒ
);

105 
PrÙocŞ
::
COMMAND_DELETE
:

106 
»que¡HªdËr
 = 
Ãw
 
	`Reque¡HªdËrD–‘e
(
m_comm
, 
m_ma¡”_±r
.
	`g‘
(), 
m_£ssiÚ_id
, 
ev’tPŒ
);

108 
PrÙocŞ
::
COMMAND_ATTRSET
:

109 
»que¡HªdËr
 = 
Ãw
 
	`Reque¡HªdËrA‰rS‘
(
m_comm
, 
m_ma¡”_±r
.
	`g‘
(), 
m_£ssiÚ_id
, 
ev’tPŒ
);

111 
PrÙocŞ
::
COMMAND_ATTRGET
:

112 
»que¡HªdËr
 = 
Ãw
 
	`Reque¡HªdËrA‰rG‘
(
m_comm
, 
m_ma¡”_±r
.
	`g‘
(), 
m_£ssiÚ_id
, 
ev’tPŒ
);

114 
PrÙocŞ
::
COMMAND_ATTRDEL
:

115 
»que¡HªdËr
 = 
Ãw
 
	`Reque¡HªdËrA‰rD–
(
m_comm
, 
m_ma¡”_±r
.
	`g‘
(), 
m_£ssiÚ_id
, 
ev’tPŒ
);

117 
PrÙocŞ
::
COMMAND_EXISTS
:

118 
»que¡HªdËr
 = 
Ãw
 
	`Reque¡HªdËrExi¡s
(
m_comm
, 
m_ma¡”_±r
.
	`g‘
(), 
m_£ssiÚ_id
, 
ev’tPŒ
);

120 
PrÙocŞ
::
COMMAND_READDIR
:

121 
»que¡HªdËr
 = 
Ãw
 
	`Reque¡HªdËrR—ddœ
(
m_comm
, 
m_ma¡”_±r
.
	`g‘
(), 
m_£ssiÚ_id
, 
ev’tPŒ
);

123 
PrÙocŞ
::
COMMAND_LOCK
:

124 
»que¡HªdËr
 = 
Ãw
 
	`Reque¡HªdËrLock
(
m_comm
, 
m_ma¡”_±r
.
	`g‘
(), 
m_£ssiÚ_id
, 
ev’tPŒ
);

126 
PrÙocŞ
::
COMMAND_RELEASE
:

127 
»que¡HªdËr
 = 
Ãw
 
	`Reque¡HªdËrR–—£
(
m_comm
, 
m_ma¡”_±r
.
	`g‘
(), 
m_£ssiÚ_id
, 
ev’tPŒ
);

129 
PrÙocŞ
::
COMMAND_STATUS
:

130 
»que¡HªdËr
 = 
Ãw
 
	`Reque¡HªdËrStus
(
m_comm
, 
m_ma¡”_±r
.
	`g‘
(), 
m_£ssiÚ_id
, 
ev’tPŒ
);

133 
¡d
::
¡ršg
 
mes§ge
 = (¡ršg)"Commªd cod" + 
commªd
 + "‚ot implemented";

134 
throw
 
	`PrÙocŞExû±iÚ
(
mes§ge
);

136 
m_­p_queue_±r
->
	`add
(
»que¡HªdËr
);

138 
	`ÿtch
 (
PrÙocŞExû±iÚ
 &
e
) {

139 
Re¥Ú£C®lback
 
	`cb
(
m_comm
, 
ev’tPŒ
);

140 
¡d
::
¡ršg
 
”rMsg
 = 
e
.
	`wh©
();

141 
	`HT_ERRORF
("PrÙocŞƒ¼Ü '%s'", 
e
.
	`wh©
());

142 
cb
.
	`”rÜ
(
E¼Ü
::
PROTOCOL_ERROR
, 
”rMsg
);

145 ià(
ev’tPŒ
->
ty³
 =ğ
Hy³¹abË
::
Ev’t
::
CONNECTION_ESTABLISHED
) {

146 
	`HT_INFOF
("%s", 
ev’tPŒ
->
	`toSŒšg
().
	`c_¡r
());

148 ià(
ev’tPŒ
->
ty³
 =ğ
Hy³¹abË
::
Ev’t
::
DISCONNECT
) {

149 
m_ma¡”_±r
->
	`de¡roy_£ssiÚ
(
m_£ssiÚ_id
);

150 
cout
 << 
æush
;

153 
	`HT_INFOF
("%s", 
ev’tPŒ
->
	`toSŒšg
().
	`c_¡r
());

156 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/ServerConnectionHandler.h

21 #iâdeà
HYPERSPACE_SERVERCONNECTIONHANDLER_H


22 
	#HYPERSPACE_SERVERCONNECTIONHANDLER_H


	)

24 
	~"AsyncComm/AµliÿtiÚQueue.h
"

25 
	~"AsyncComm/Di¥©chHªdËr.h
"

27 
	~"Ma¡”.h
"

29 
Çme¥aû
 
	gHy³r¥aû
 {

34 şas 
	cS”v”CÚÃùiÚHªdËr
 : 
public
 
Di¥©chHªdËr
 {

35 
public
:

36 
S”v”CÚÃùiÚHªdËr
(
Comm
 *
comm
, 
AµliÿtiÚQueuePŒ
 &
­pQueuePŒ
, 
Ma¡”PŒ
 &
ma¡”PŒ
)

37 : 
m_comm
(
comm
), 
m_­p_queue_±r
(
­pQueuePŒ
), 
m_ma¡”_±r
(
ma¡”PŒ
), 
m_£ssiÚ_id
(0) { ; }

38 
vœtu®
 
hªdË
(
Ev’tPŒ
 &
ev’tPŒ
);

40 
	g´iv©e
:

41 
Comm
 *
m_comm
;

42 
AµliÿtiÚQueuePŒ
 
	gm_­p_queue_±r
;

43 
Ma¡”PŒ
 
	gm_ma¡”_±r
;

44 
ušt64_t
 
	gm_£ssiÚ_id
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/ServerKeepaliveHandler.cc

21 
	~"CommÚ/E¼Ü.h
"

22 
	~"CommÚ/Exû±iÚ.h
"

23 
	~"CommÚ/IÃtAddr.h
"

24 
	~"CommÚ/SŒšgExt.h
"

25 
	~"CommÚ/Sy¡em.h
"

27 
	~"S”v”K“·liveHªdËr.h
"

28 
	~"Ma¡”.h
"

29 
	~"PrÙocŞ.h
"

30 
	~"SessiÚD©a.h
"

32 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

33 
usšg
 
Çme¥aû
 
	gHy³r¥aû
;

39 
	gS”v”K“·liveHªdËr
::
	$S”v”K“·liveHªdËr
(
Comm
 *
comm
, 
Ma¡”
 *
ma¡”
è: 
	`m_comm
(comm), 
	$m_ma¡”
(
ma¡”
) {

40 
”rÜ
;

42 
m_ma¡”
->
	`g‘_d©ag¿m_£nd_add»ss
(&
m_£nd_addr
);

44 ià((
”rÜ
 = 
m_comm
->
	`£t_tim”
(1000, 
this
)è!ğ
E¼Ü
::
OK
) {

45 
	`HT_ERRORF
("ProbËm s‘tšgim” - %s", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

46 
	`ex™
(1);

50 
	}
}

57 
	gS”v”K“·liveHªdËr
::
hªdË
(
Hy³¹abË
::
Ev’tPŒ
 &
ev’tPŒ
) {

58 
ušt16_t
 
commªd
 = (uint16_t)-1;

59 
	g”rÜ
;

61 ià(
	gev’tPŒ
->
	gty³
 =ğ
Hy³¹abË
::
Ev’t
::
MESSAGE
) {

62 
ušt8_t
 *
msgPŒ
 = 
ev’tPŒ
->
mes§ge
;

63 
size_t
 
	g»maššg
 = 
ev’tPŒ
->
mes§geL’
;

65 
	gŒy
 {

67 ià(!
	gS”Ÿliz©iÚ
::
decode_shÜt
(&
msgPŒ
, &
»maššg
, &
commªd
)) {

68 
	g¡d
::
¡ršg
 
mes§ge
 = "Truncated Request";

69 
throw
 
Ãw
 
PrÙocŞExû±iÚ
(
mes§ge
);

73 ià(
	gcommªd
 >ğ
PrÙocŞ
::
COMMAND_MAX
) {

74 
¡d
::
¡ršg
 
mes§ge
 = (¡d::¡ršg)"Inv®id commªd (" + 
commªd
 + ")";

75 
throw
 
PrÙocŞExû±iÚ
(
mes§ge
);

78 
	gcommªd
) {

79 
	gPrÙocŞ
::
COMMAND_KEEPALIVE
:

81 
ušt64_t
 
£ssiÚId
;

82 
SessiÚD©aPŒ
 
	g£ssiÚPŒ
;

83 
ušt64_t
 
	gÏ¡KnownEv’t
;

85 ià(!
	gS”Ÿliz©iÚ
::
decode_lÚg
(&
msgPŒ
, &
»maššg
, &
£ssiÚId
) ||

86 !
	gS”Ÿliz©iÚ
::
decode_lÚg
(&
msgPŒ
, &
»maššg
, &
Ï¡KnownEv’t
)) {

87 
	g¡d
::
¡ršg
 
mes§ge
 = "Truncated Request";

88 
throw
 
Ãw
 
PrÙocŞExû±iÚ
(
mes§ge
);

91 ià(
	g£ssiÚId
 == 0) {

92 
£ssiÚId
 = 
m_ma¡”
->
ü—‹_£ssiÚ
(
ev’tPŒ
->
addr
);

93 
HT_INFOF
("SessiÚ hªdË %Îd c»©ed", 
£ssiÚId
);

94 
	g”rÜ
 = 
E¼Ü
::
OK
;

97 
	g”rÜ
 = 
m_ma¡”
->
»Ãw_£ssiÚ_Ëa£
(
£ssiÚId
);

99 ià(
	g”rÜ
 =ğ
E¼Ü
::
HYPERSPACE_EXPIRED_SESSION
) {

100 
HT_INFOF
("SessiÚ hªdË %Îdƒxpœed", 
£ssiÚId
);

101 
CommBufPŒ
 
cbufPŒ
Ğ
PrÙocŞ
::
ü—‹_£rv”_k“·live_»que¡
(
£ssiÚId
, 
E¼Ü
::
HYPERSPACE_EXPIRED_SESSION
) );

102 ià((
	g”rÜ
 = 
m_comm
->
£nd_d©ag¿m
(
ev’tPŒ
->
addr
, 
m_£nd_addr
, 
cbufPŒ
)è!ğ
E¼Ü
::
OK
) {

103 
HT_ERRORF
("Comm::£nd_d©ag¿m„‘uºed %s", 
E¼Ü
::
g‘_‹xt
(
”rÜ
));

108 ià(!
	gm_ma¡”
->
g‘_£ssiÚ
(
£ssiÚId
, 
£ssiÚPŒ
)) {

109 
HT_ERRORF
("UÇbËØfšd d©¨fÜ sessiÚ %Îd", 
£ssiÚId
);

113 
	g£ssiÚPŒ
->
purge_nÙifiÿtiÚs
(
Ï¡KnownEv’t
);

122 
CommBufPŒ
 
cbufPŒ
Ğ
PrÙocŞ
::
ü—‹_£rv”_k“·live_»que¡
(
£ssiÚPŒ
) );

123 ià((
	g”rÜ
 = 
m_comm
->
£nd_d©ag¿m
(
ev’tPŒ
->
addr
, 
m_£nd_addr
, 
cbufPŒ
)è!ğ
E¼Ü
::
OK
) {

124 
HT_ERRORF
("Comm::£nd_d©ag¿m„‘uºed %s", 
E¼Ü
::
g‘_‹xt
(
”rÜ
));

129 
¡d
::
¡ršg
 
mes§ge
 = (¡ršg)"Commªd cod" + 
commªd
 + "‚ot implemented";

130 
throw
 
PrÙocŞExû±iÚ
(
mes§ge
);

133 
ÿtch
 (
PrÙocŞExû±iÚ
 &
e
) {

134 
	g¡d
::
¡ršg
 
”rMsg
 = 
e
.
wh©
();

135 
HT_ERRORF
("PrÙocŞƒ¼Ü '%s'", 
e
.
wh©
());

138 ià(
	gev’tPŒ
->
	gty³
 =ğ
Hy³¹abË
::
Ev’t
::
TIMER
) {

140 
m_ma¡”
->
»move_expœed_£ssiÚs
();

142 ià((
	g”rÜ
 = 
m_comm
->
£t_tim”
(1000, 
this
)è!ğ
E¼Ü
::
OK
) {

143 
HT_ERRORF
("ProbËm s‘tšgim” - %s", 
E¼Ü
::
g‘_‹xt
(
”rÜ
));

144 
ex™
(1);

149 
HT_INFOF
("%s", 
ev’tPŒ
->
toSŒšg
().
c_¡r
());

157 
	gS”v”K“·liveHªdËr
::
	$d–iv”_ev’t_nÙifiÿtiÚs
(
ušt64_t
 
£ssiÚId
) {

158 
”rÜ
 = 0;

159 
SessiÚD©aPŒ
 
£ssiÚPŒ
;

163 ià(!
m_ma¡”
->
	`g‘_£ssiÚ
(
£ssiÚId
, 
£ssiÚPŒ
)) {

164 
	`HT_ERRORF
("UÇbËØfšd d©¨fÜ sessiÚ %Îd", 
£ssiÚId
);

175 
CommBufPŒ
 
	`cbufPŒ
Ğ
PrÙocŞ
::
	`ü—‹_£rv”_k“·live_»que¡
(
£ssiÚPŒ
) );

176 ià((
”rÜ
 = 
m_comm
->
	`£nd_d©ag¿m
(
£ssiÚPŒ
->
addr
, 
m_£nd_addr
, 
cbufPŒ
)è!ğ
E¼Ü
::
OK
) {

177 
	`HT_ERRORF
("Comm::£nd_d©ag¿m„‘uºed %s", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

180 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/ServerKeepaliveHandler.h

21 #iâdeà
HYPERSPACE_SERVERKEEPALIVEHANDLER_H


22 
	#HYPERSPACE_SERVERKEEPALIVEHANDLER_H


	)

24 
	~<boo¡/sh¬ed_±r.hµ
>

26 
	~"AsyncComm/Comm.h
"

27 
	~"AsyncComm/Di¥©chHªdËr.h
"

29 
	~"Ev’t.h
"

30 
	~"HªdËD©a.h
"

32 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

34 
Çme¥aû
 
	gHy³r¥aû
 {

36 
şass
 
	gMa¡”
;

40 şas 
	cS”v”K“·liveHªdËr
 : 
public
 
Di¥©chHªdËr
 {

41 
public
:

42 
S”v”K“·liveHªdËr
(
Comm
 *
comm
, 
Ma¡”
 *
ma¡”
);

43 
vœtu®
 
hªdË
(
Hy³¹abË
::
Ev’tPŒ
 &
ev’tPŒ
);

44 
d–iv”_ev’t_nÙifiÿtiÚs
(
ušt64_t
 
£ssiÚId
);

46 
	g´iv©e
:

47 
Comm
 *
m_comm
;

48 
Ma¡”
 *
	gm_ma¡”
;

49 
sockaddr_š
 
	gm_£nd_addr
;

51 
	gboo¡
::
	tsh¬ed_±r
<
	tS”v”K“·liveHªdËr
> 
	tS”v”K“·liveHªdËrPŒ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/Session.cc

21 
	~<ÿs£¹
>

24 
	~<sys/ty³s.h
>

25 
	~<sys/sock‘.h
>

26 
	~<Ãtš‘/š.h
>

27 
	~<¬·/š‘.h
>

30 
	~"AsyncComm/Di¥©chHªdËrSynchrÚiz”.h
"

31 
	~"AsyncComm/Comm.h
"

32 
	~"AsyncComm/CÚÃùiÚMªag”.h
"

33 
	~"AsyncComm/S”Ÿliz©iÚ.h
"

35 
	~"CommÚ/E¼Ü.h
"

36 
	~"CommÚ/IÃtAddr.h
"

37 
	~"CommÚ/Logg”.h
"

38 
	~"CommÚ/Prİ”t›s.h
"

40 
	~"Cl›ÁHªdËS‹.h
"

41 
	~"Ma¡”.h
"

42 
	~"PrÙocŞ.h
"

43 
	~"SessiÚ.h
"

45 
usšg
 
Çme¥aû
 
Hy³¹abË
;

46 
usšg
 
Çme¥aû
 
	gHy³r¥aû
;

52 
	gSessiÚ
::
	$SessiÚ
(
Comm
 *
comm
, 
Prİ”t›sPŒ
 &
´İs_±r
, 
SessiÚC®lback
 *
ÿÎback
è: 
	`m_comm
(comm), 
	`m_v”bo£
(
çl£
), 
	`m_s’t
(çl£), 
	`m_¡©e
(
STATE_JEOPARDY
), 
	$m_£ssiÚ_ÿÎback
(
ÿÎback
) {

53 
ušt16_t
 
ma¡”PÜt
;

54 cÚ¡ *
ma¡”Ho¡
;

56 
m_v”bo£
 = 
´İs_±r
->
	`g‘_boŞ
("Hy³¹abË.V”bo£", 
çl£
);

57 
m_s’t
 = 
´İs_±r
->
	`g‘_boŞ
("s’t", 
çl£
);

58 
ma¡”Ho¡
 = 
´İs_±r
->
	`g‘
("Hyperspace.Master.Host", "localhost");

59 
ma¡”PÜt
 = (
ušt16_t
)
´İs_±r
->
	`g‘_št
("Hy³r¥aû.Ma¡”.PÜt", 
Ma¡”
::
DEFAULT_MASTER_PORT
);

60 
m_g¿û_³riod
 = (
ušt32_t
)
´İs_±r
->
	`g‘_št
("Hy³r¥aû.G¿ûP”iod", 
Ma¡”
::
DEFAULT_GRACEPERIOD
);

61 
m_Ëa£_š‹rv®
 = (
ušt32_t
)
´İs_±r
->
	`g‘_št
("Hy³r¥aû.L—£.IÁ”v®", 
Ma¡”
::
DEFAULT_LEASE_INTERVAL
);

62 
m_timeout
 = 
m_Ëa£_š‹rv®
 * 2;

64 ià(!
IÃtAddr
::
	`š™Ÿlize
(&
m_ma¡”_addr
, 
ma¡”Ho¡
, 
ma¡”PÜt
))

65 
	`ex™
(1);

67 
boo¡
::
	`xtime_g‘
(&
m_expœe_time
, boo¡::
TIME_UTC
);

68 
m_expœe_time
.
£c
 +ğ
m_g¿û_³riod
;

70 ià(
m_v”bo£
) {

71 
cout
 << "Hy³r¥aû.G¿ûP”iod=" << 
m_g¿û_³riod
 << 
’dl
;

74 
m_k“·live_hªdËr_±r
 = 
Ãw
 
	`Cl›ÁK“·liveHªdËr
(
comm
, 
´İs_±r
, 
this
);

75 
	}
}

77 
	gSessiÚ
::~
	$SessiÚ
() {

78 
	}
}

81 
SessiÚ
::
	$İ’
(
Cl›ÁHªdËS‹PŒ
 &
hªdË_¡©e_±r
, 
CommBufPŒ
 &
cbuf_±r
, 
ušt64_t
 *
hªdËp
) {

82 
Di¥©chHªdËrSynchrÚiz”
 
syncHªdËr
;

83 
Hy³¹abË
::
Ev’tPŒ
 
ev’tPŒ
;

85 
hªdË_¡©e_±r
->
hªdË
 = 0;

86 
hªdË_¡©e_±r
->
£qu’ûr
 = 0;

87 
hªdË_¡©e_±r
->
lockStus
 = 0;

89 ià((
hªdË_¡©e_±r
->
İ’FÏgs
 & 
OPEN_FLAG_LOCK_SHARED
) == OPEN_FLAG_LOCK_SHARED)

90 
hªdË_¡©e_±r
->
lockMode
 = 
LOCK_MODE_SHARED
;

91 ià((
hªdË_¡©e_±r
->
İ’FÏgs
 & 
OPEN_FLAG_LOCK_EXCLUSIVE
) == OPEN_FLAG_LOCK_EXCLUSIVE)

92 
hªdË_¡©e_±r
->
lockMode
 = 
LOCK_MODE_EXCLUSIVE
;

94 
hªdË_¡©e_±r
->
lockMode
 = 0;

96 
Œy_agaš
:

97 ià(!
	`wa™_fÜ_§ã
())

98  
E¼Ü
::
HYPERSPACE_EXPIRED_SESSION
;

100 
”rÜ
 = 
	`£nd_mes§ge
(
cbuf_±r
, &
syncHªdËr
);

101 ià(
”rÜ
 =ğ
E¼Ü
::
OK
) {

102 ià(!
syncHªdËr
.
	`wa™_fÜ_»¶y
(
ev’tPŒ
)) {

103 
”rÜ
 = ()
PrÙocŞ
::
	`»¥Ú£_code
(
ev’tPŒ
.
	`g‘
());

104 ià(!
m_s’t
) {

105 
	`HT_ERRORF
("Hyperspace 'open'ƒrror,‚ame=%s flags=0x%xƒvents=0x%x : %s",

106 
hªdË_¡©e_±r
->
nÜm®Name
.
	`c_¡r
(), hªdË_¡©e_±r->
İ’FÏgs
,

107 
hªdË_¡©e_±r
->
ev’tMask
, 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

108 ià(
m_v”bo£
)

109 
	`HT_ERRORF
("%s", 
PrÙocŞ
::
	`¡ršg_fÜm©_mes§ge
(
ev’tPŒ
.
	`g‘
()).
	`c_¡r
());

113 
ušt8_t
 *
±r
 = 
ev’tPŒ
->
mes§ge
 + 4;

114 
size_t
 
»maššg
 = 
ev’tPŒ
->
mes§geL’
 - 4;

115 
ušt8_t
 
cby‹
;

116 ià(!
S”Ÿliz©iÚ
::
	`decode_lÚg
(&
±r
, &
»maššg
, 
hªdËp
))

117  
E¼Ü
::
RESPONSE_TRUNCATED
;

118 ià(!
S”Ÿliz©iÚ
::
	`decode_by‹
(&
±r
, &
»maššg
, &
cby‹
))

119  
E¼Ü
::
RESPONSE_TRUNCATED
;

120 ià(!
S”Ÿliz©iÚ
::
	`decode_lÚg
(&
±r
, &
»maššg
, &
hªdË_¡©e_±r
->
lockG’”©iÚ
))

121  
E¼Ü
::
RESPONSE_TRUNCATED
;

123 
hªdË_¡©e_±r
->
hªdË
 = *
hªdËp
;

124 
m_k“·live_hªdËr_±r
->
	`»gi¡”_hªdË
(
hªdË_¡©e_±r
);

128 
	`¡©e_Œªs™iÚ
(
SessiÚ
::
STATE_JEOPARDY
);

129 
Œy_agaš
;

132  
”rÜ
;

133 
	}
}

140 
	gSessiÚ
::
İ’
(
¡d
::
¡ršg
 
Çme
, 
ušt32_t
 
æags
, 
HªdËC®lbackPŒ
 &
ÿÎback_±r
, 
ušt64_t
 *
hªdËp
) {

141 
Cl›ÁHªdËS‹PŒ
 
hªdË_¡©e_±r
Ğ
Ãw
 
Cl›ÁHªdËS‹
() );

142 
	g¡d
::
veùÜ
<
A‰ribu‹T
> 
em±yA‰rs
;

144 
	ghªdË_¡©e_±r
->
	gİ’FÏgs
 = 
æags
;

145 
	ghªdË_¡©e_±r
->
	gev’tMask
 = (
ÿÎback_±r
è? c®lback_±r->
g‘_ev’t_mask
() : 0;

146 
	ghªdË_¡©e_±r
->
	gÿÎbackPŒ
 = 
ÿÎback_±r
;

147 
nÜm®ize_Çme
(
Çme
, 
hªdË_¡©e_±r
->
nÜm®Name
);

149 
CommBufPŒ
 
cbuf_±r
Ğ
PrÙocŞ
::
ü—‹_İ’_»que¡
(
hªdË_¡©e_±r
->
nÜm®Name
, 
æags
, 
ÿÎback_±r
, 
em±yA‰rs
) );

151  
İ’
(
hªdË_¡©e_±r
, 
cbuf_±r
, 
hªdËp
);

160 
	gSessiÚ
::
ü—‹
(
¡d
::
¡ršg
 
Çme
, 
ušt32_t
 
æags
, 
HªdËC®lbackPŒ
 &
ÿÎback_±r
, std::
veùÜ
<
A‰ribu‹T
> &
š™A‰rs
, 
ušt64_t
 *
hªdËp
) {

161 
Cl›ÁHªdËS‹PŒ
 
hªdË_¡©e_±r
Ğ
Ãw
 
Cl›ÁHªdËS‹
() );

163 
	ghªdË_¡©e_±r
->
	gİ’FÏgs
 = 
æags
 | 
OPEN_FLAG_CREATE
 | 
OPEN_FLAG_EXCL
;

164 
	ghªdË_¡©e_±r
->
	gev’tMask
 = (
ÿÎback_±r
è? c®lback_±r->
g‘_ev’t_mask
() : 0;

165 
	ghªdË_¡©e_±r
->
	gÿÎbackPŒ
 = 
ÿÎback_±r
;

166 
nÜm®ize_Çme
(
Çme
, 
hªdË_¡©e_±r
->
nÜm®Name
);

168 
CommBufPŒ
 
cbuf_±r
Ğ
PrÙocŞ
::
ü—‹_İ’_»que¡
(
hªdË_¡©e_±r
->
nÜm®Name
, hªdË_¡©e_±r->
İ’FÏgs
, 
ÿÎback_±r
, 
š™A‰rs
) );

170  
İ’
(
hªdË_¡©e_±r
, 
cbuf_±r
, 
hªdËp
);

178 
	gSessiÚ
::
	$şo£
(
ušt64_t
 
hªdË
) {

179 
Di¥©chHªdËrSynchrÚiz”
 
syncHªdËr
;

180 
Hy³¹abË
::
Ev’tPŒ
 
ev’tPŒ
;

181 
CommBufPŒ
 
	`cbuf_±r
Ğ
PrÙocŞ
::
	`ü—‹_şo£_»que¡
(
hªdË
) );

183 
Œy_agaš
:

184 ià(!
	`wa™_fÜ_§ã
())

185  
E¼Ü
::
HYPERSPACE_EXPIRED_SESSION
;

187 
”rÜ
 = 
	`£nd_mes§ge
(
cbuf_±r
, &
syncHªdËr
);

188 ià(
”rÜ
 =ğ
E¼Ü
::
OK
) {

189 ià(!
syncHªdËr
.
	`wa™_fÜ_»¶y
(
ev’tPŒ
)) {

190 
”rÜ
 = ()
PrÙocŞ
::
	`»¥Ú£_code
(
ev’tPŒ
.
	`g‘
());

191 ià(!
m_s’t
) {

192 
	`HT_ERRORF
("Hy³r¥aû 'şo£'ƒ¼Ü : %s", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

193 ià(
m_v”bo£
)

194 
	`HT_ERRORF
("%s", 
PrÙocŞ
::
	`¡ršg_fÜm©_mes§ge
(
ev’tPŒ
.
	`g‘
()).
	`c_¡r
());

199 
	`¡©e_Œªs™iÚ
(
SessiÚ
::
STATE_JEOPARDY
);

200 
Œy_agaš
;

203  
”rÜ
;

204 
	}
}

211 
	gSessiÚ
::
mkdœ
(
¡d
::
¡ršg
 
Çme
) {

212 
Di¥©chHªdËrSynchrÚiz”
 
syncHªdËr
;

213 
	gHy³¹abË
::
Ev’tPŒ
 
ev’tPŒ
;

214 
	g¡d
::
¡ršg
 
nÜm®Name
;

216 
nÜm®ize_Çme
(
Çme
, 
nÜm®Name
);

218 
CommBufPŒ
 
cbuf_±r
Ğ
PrÙocŞ
::
ü—‹_mkdœ_»que¡
(
nÜm®Name
) );

220 
	gŒy_agaš
:

221 ià(!
wa™_fÜ_§ã
())

222  
E¼Ü
::
HYPERSPACE_EXPIRED_SESSION
;

224 
	g”rÜ
 = 
£nd_mes§ge
(
cbuf_±r
, &
syncHªdËr
);

225 ià(
	g”rÜ
 =ğ
E¼Ü
::
OK
) {

226 ià(!
syncHªdËr
.
wa™_fÜ_»¶y
(
ev’tPŒ
)) {

227 
”rÜ
 = ()
PrÙocŞ
::
»¥Ú£_code
(
ev’tPŒ
.
g‘
());

228 ià(!
	gm_s’t
) {

229 
HT_ERRORF
("Hy³r¥aû 'mkdœ'ƒ¼Ü,‚ame=% : %s", 
nÜm®Name
.
c_¡r
(), 
E¼Ü
::
g‘_‹xt
(
”rÜ
));

230 ià(
	gm_v”bo£
)

231 
HT_ERRORF
("%s", 
PrÙocŞ
::
¡ršg_fÜm©_mes§ge
(
ev’tPŒ
.
g‘
()).
c_¡r
());

236 
¡©e_Œªs™iÚ
(
SessiÚ
::
STATE_JEOPARDY
);

237 
	gŒy_agaš
;

240  
	g”rÜ
;

244 
	gSessiÚ
::
uÆšk
(
¡d
::
¡ršg
 
Çme
) {

245 
Di¥©chHªdËrSynchrÚiz”
 
syncHªdËr
;

246 
	gHy³¹abË
::
Ev’tPŒ
 
ev’tPŒ
;

247 
	g¡d
::
¡ršg
 
nÜm®Name
;

249 
nÜm®ize_Çme
(
Çme
, 
nÜm®Name
);

251 
CommBufPŒ
 
cbuf_±r
Ğ
PrÙocŞ
::
ü—‹_d–‘e_»que¡
(
nÜm®Name
) );

253 
	gŒy_agaš
:

254 ià(!
wa™_fÜ_§ã
())

255  
E¼Ü
::
HYPERSPACE_EXPIRED_SESSION
;

257 
	g”rÜ
 = 
£nd_mes§ge
(
cbuf_±r
, &
syncHªdËr
);

258 ià(
	g”rÜ
 =ğ
E¼Ü
::
OK
) {

259 ià(!
syncHªdËr
.
wa™_fÜ_»¶y
(
ev’tPŒ
)) {

260 
”rÜ
 = ()
PrÙocŞ
::
»¥Ú£_code
(
ev’tPŒ
.
g‘
());

261 ià(!
	gm_s’t
) {

262 
HT_ERRORF
("Hy³r¥aû 'd–‘e'ƒ¼Ü,‚ame=% : %s", 
nÜm®Name
.
c_¡r
(), 
E¼Ü
::
g‘_‹xt
(
”rÜ
));

263 ià(
	gm_v”bo£
)

264 
HT_ERRORF
("%s", 
PrÙocŞ
::
¡ršg_fÜm©_mes§ge
(
ev’tPŒ
.
g‘
()).
c_¡r
());

269 
¡©e_Œªs™iÚ
(
SessiÚ
::
STATE_JEOPARDY
);

270 
	gŒy_agaš
;

273  
	g”rÜ
;

277 
	gSessiÚ
::
exi¡s
(
¡d
::
¡ršg
 
Çme
, 
boŞ
 *
exi¡¥
) {

278 
Di¥©chHªdËrSynchrÚiz”
 
	gsyncHªdËr
;

279 
	gHy³¹abË
::
Ev’tPŒ
 
ev’tPŒ
;

280 
	g¡d
::
¡ršg
 
nÜm®Name
;

282 
nÜm®ize_Çme
(
Çme
, 
nÜm®Name
);

284 
CommBufPŒ
 
cbuf_±r
Ğ
PrÙocŞ
::
ü—‹_exi¡s_»que¡
(
nÜm®Name
) );

286 
	gŒy_agaš
:

287 ià(!
wa™_fÜ_§ã
())

288  
E¼Ü
::
HYPERSPACE_EXPIRED_SESSION
;

290 
	g”rÜ
 = 
£nd_mes§ge
(
cbuf_±r
, &
syncHªdËr
);

291 ià(
	g”rÜ
 =ğ
E¼Ü
::
OK
) {

292 ià(!
syncHªdËr
.
wa™_fÜ_»¶y
(
ev’tPŒ
)) {

293 
”rÜ
 = ()
PrÙocŞ
::
»¥Ú£_code
(
ev’tPŒ
.
g‘
());

294 ià(!
	gm_s’t
) {

295 
HT_ERRORF
("Hy³r¥aû 'exi¡s'ƒ¼Ü,‚ame=% : %s", 
nÜm®Name
.
c_¡r
(), 
E¼Ü
::
g‘_‹xt
(
”rÜ
));

296 ià(
	gm_v”bo£
)

297 
HT_ERRORF
("%s", 
PrÙocŞ
::
¡ršg_fÜm©_mes§ge
(
ev’tPŒ
.
g‘
()).
c_¡r
());

301 
ušt8_t
 *
	g±r
 = 
ev’tPŒ
->
mes§ge
 + 4;

302 
size_t
 
	g»maššg
 = 
ev’tPŒ
->
mes§geL’
 - 4;

303 
ušt8_t
 
	gbv®
 = 0;

304 ià(!
	gS”Ÿliz©iÚ
::
decode_by‹
(&
±r
, &
»maššg
, &
bv®
))

305 
as£¹
(!"problem decoding„eturn…acket");

306 *
	gexi¡¥
 = (
bv®
 =ğ0è? 
çl£
 : 
Œue
;

310 
¡©e_Œªs™iÚ
(
SessiÚ
::
STATE_JEOPARDY
);

311 
	gŒy_agaš
;

314  
	g”rÜ
;

321 
	gSessiÚ
::
©Œ_£t
(
ušt64_t
 
hªdË
, 
¡d
::
¡ršg
 
Çme
, cÚ¡ *
v®ue
, 
size_t
 
v®ueL’
) {

322 
Di¥©chHªdËrSynchrÚiz”
 
	gsyncHªdËr
;

323 
	gHy³¹abË
::
Ev’tPŒ
 
ev’tPŒ
;

324 
CommBufPŒ
 
cbuf_±r
Ğ
PrÙocŞ
::
ü—‹_©Œ_£t_»que¡
(
hªdË
, 
Çme
, 
v®ue
, 
v®ueL’
) );

326 
	gŒy_agaš
:

327 ià(!
wa™_fÜ_§ã
())

328  
E¼Ü
::
HYPERSPACE_EXPIRED_SESSION
;

330 
	g”rÜ
 = 
£nd_mes§ge
(
cbuf_±r
, &
syncHªdËr
);

331 ià(
	g”rÜ
 =ğ
E¼Ü
::
OK
) {

332 ià(!
syncHªdËr
.
wa™_fÜ_»¶y
(
ev’tPŒ
)) {

333 
”rÜ
 = ()
PrÙocŞ
::
»¥Ú£_code
(
ev’tPŒ
.
g‘
());

334 ià(!
	gm_s’t
) {

335 
HT_ERRORF
("Hy³r¥aû '©Œ£t'ƒ¼Ü,‚ame=% : %s", 
Çme
.
c_¡r
(), 
E¼Ü
::
g‘_‹xt
(
”rÜ
));

336 ià(
	gm_v”bo£
)

337 
HT_ERRORF
("%s", 
PrÙocŞ
::
¡ršg_fÜm©_mes§ge
(
ev’tPŒ
.
g‘
()).
c_¡r
());

342 
¡©e_Œªs™iÚ
(
SessiÚ
::
STATE_JEOPARDY
);

343 
	gŒy_agaš
;

346  
	g”rÜ
;

353 
	gSessiÚ
::
©Œ_g‘
(
ušt64_t
 
hªdË
, 
¡d
::
¡ršg
 
Çme
, 
DyÇmicBufãr
 &
v®ue
) {

354 
Di¥©chHªdËrSynchrÚiz”
 
	gsyncHªdËr
;

355 
	gHy³¹abË
::
Ev’tPŒ
 
ev’tPŒ
;

356 
CommBufPŒ
 
cbuf_±r
Ğ
PrÙocŞ
::
ü—‹_©Œ_g‘_»que¡
(
hªdË
, 
Çme
) );

358 
	gŒy_agaš
:

359 ià(!
wa™_fÜ_§ã
())

360  
E¼Ü
::
HYPERSPACE_EXPIRED_SESSION
;

362 
	g”rÜ
 = 
£nd_mes§ge
(
cbuf_±r
, &
syncHªdËr
);

363 ià(
	g”rÜ
 =ğ
E¼Ü
::
OK
) {

364 ià(!
syncHªdËr
.
wa™_fÜ_»¶y
(
ev’tPŒ
)) {

365 
”rÜ
 = ()
PrÙocŞ
::
»¥Ú£_code
(
ev’tPŒ
.
g‘
());

366 ià(!
	gm_s’t
) {

367 
HT_ERRORF
("Hy³r¥aû '©Œg‘'ƒ¼Ü,‚ame=% : %s", 
Çme
.
c_¡r
(), 
E¼Ü
::
g‘_‹xt
(
”rÜ
));

368 ià(
	gm_v”bo£
)

369 
HT_ERRORF
("%s", 
PrÙocŞ
::
¡ršg_fÜm©_mes§ge
(
ev’tPŒ
.
g‘
()).
c_¡r
());

373 
ušt8_t
 *
	g©ŒV®ue
 = 0;

374 
št32_t
 
	g©ŒV®ueL’
 = 0;

375 
ušt8_t
 *
	g±r
 = 
ev’tPŒ
->
mes§ge
 + 4;

376 
size_t
 
	g»maššg
 = 
ev’tPŒ
->
mes§geL’
 - 4;

377 ià(!
	gS”Ÿliz©iÚ
::
decode_by‹_¬¿y
(&
±r
, &
»maššg
, &
©ŒV®ue
, &
©ŒV®ueL’
)) {

378 
as£¹
(!"problem decoding„eturn…acket");

380 
	gv®ue
.
ş—r
();

381 
	gv®ue
.
’su»
(
©ŒV®ueL’
+1);

382 
	gv®ue
.
addNoCheck
(
©ŒV®ue
, 
©ŒV®ueL’
);

384 *
	gv®ue
.
	g±r
 = 0;

388 
¡©e_Œªs™iÚ
(
SessiÚ
::
STATE_JEOPARDY
);

389 
	gŒy_agaš
;

392  
	g”rÜ
;

399 
	gSessiÚ
::
©Œ_d–
(
ušt64_t
 
hªdË
, 
¡d
::
¡ršg
 
Çme
) {

400 
Di¥©chHªdËrSynchrÚiz”
 
syncHªdËr
;

401 
	gHy³¹abË
::
Ev’tPŒ
 
ev’tPŒ
;

402 
CommBufPŒ
 
cbuf_±r
Ğ
PrÙocŞ
::
ü—‹_©Œ_d–_»que¡
(
hªdË
, 
Çme
) );

404 
	gŒy_agaš
:

405 ià(!
wa™_fÜ_§ã
())

406  
E¼Ü
::
HYPERSPACE_EXPIRED_SESSION
;

408 
	g”rÜ
 = 
£nd_mes§ge
(
cbuf_±r
, &
syncHªdËr
);

409 ià(
	g”rÜ
 =ğ
E¼Ü
::
OK
) {

410 ià(!
syncHªdËr
.
wa™_fÜ_»¶y
(
ev’tPŒ
)) {

411 
”rÜ
 = ()
PrÙocŞ
::
»¥Ú£_code
(
ev’tPŒ
.
g‘
());

412 ià(!
	gm_s’t
) {

413 
HT_ERRORF
("Hy³r¥aû '©Œd–'ƒ¼Ü,‚ame=% : %s", 
Çme
.
c_¡r
(), 
E¼Ü
::
g‘_‹xt
(
”rÜ
));

414 ià(
	gm_v”bo£
)

415 
HT_ERRORF
("%s", 
PrÙocŞ
::
¡ršg_fÜm©_mes§ge
(
ev’tPŒ
.
g‘
()).
c_¡r
());

420 
¡©e_Œªs™iÚ
(
SessiÚ
::
STATE_JEOPARDY
);

421 
	gŒy_agaš
;

424  
	g”rÜ
;

428 
	gSessiÚ
::
»addœ
(
ušt64_t
 
hªdË
, 
¡d
::
veùÜ
<
DœEÁryT
> &
li¡šg
) {

429 
Di¥©chHªdËrSynchrÚiz”
 
syncHªdËr
;

430 
	gHy³¹abË
::
Ev’tPŒ
 
ev’tPŒ
;

431 
CommBufPŒ
 
cbuf_±r
Ğ
PrÙocŞ
::
ü—‹_»addœ_»que¡
(
hªdË
) );

433 
	gŒy_agaš
:

434 ià(!
wa™_fÜ_§ã
())

435  
E¼Ü
::
HYPERSPACE_EXPIRED_SESSION
;

437 
	g”rÜ
 = 
£nd_mes§ge
(
cbuf_±r
, &
syncHªdËr
);

438 ià(
	g”rÜ
 =ğ
E¼Ü
::
OK
) {

439 ià(!
syncHªdËr
.
wa™_fÜ_»¶y
(
ev’tPŒ
)) {

440 
”rÜ
 = ()
PrÙocŞ
::
»¥Ú£_code
(
ev’tPŒ
.
g‘
());

441 ià(!
	gm_s’t
) {

442 
HT_ERRORF
("Hy³r¥aû '»addœ'ƒ¼Ü : %s", 
E¼Ü
::
g‘_‹xt
(
”rÜ
));

443 ià(
	gm_v”bo£
)

444 
HT_ERRORF
("%s", 
PrÙocŞ
::
¡ršg_fÜm©_mes§ge
(
ev’tPŒ
.
g‘
()).
c_¡r
());

448 
ušt8_t
 *
	g±r
 = 
ev’tPŒ
->
mes§ge
 + 4;

449 
size_t
 
	g»maššg
 = 
ev’tPŒ
->
mes§geL’
 - 4;

450 
ušt32_t
 
	g’ŒyCouÁ
;

451 
DœEÁryT
 
	gd’Œy
;

452 ià(!
	gS”Ÿliz©iÚ
::
decode_št
(&
±r
, &
»maššg
, &
’ŒyCouÁ
)) {

453 ià(!
	gm_s’t
)

454 
HT_ERROR
("Problem decoding READDIR„eturn…acket");

455  
	gE¼Ü
::
PROTOCOL_ERROR
;

457 
	gli¡šg
.
ş—r
();

458 
ušt32_t
 
	gi
=0; i<
	g’ŒyCouÁ
; i++) {

459 ià(!
	gHy³r¥aû
::
decode_¿nge_dœ_’Œy
(&
±r
, &
»maššg
, 
d’Œy
)) {

460 ià(!
	gm_s’t
)

461 
HT_ERRORF
("ProbËm decodšgƒÁry %d oàREADDIR„‘uº…ack‘", 
i
);

462  
	gE¼Ü
::
PROTOCOL_ERROR
;

464 
	gli¡šg
.
push_back
(
d’Œy
);

469 
¡©e_Œªs™iÚ
(
SessiÚ
::
STATE_JEOPARDY
);

470 
	gŒy_agaš
;

473  
	g”rÜ
;

478 
	gSessiÚ
::
	$lock
(
ušt64_t
 
hªdË
, 
ušt32_t
 
mode
, 
LockSequ’ûrT
 *
£qu’û½
) {

479 
Di¥©chHªdËrSynchrÚiz”
 
syncHªdËr
;

480 
Hy³¹abË
::
Ev’tPŒ
 
ev’tPŒ
;

481 
CommBufPŒ
 
	`cbuf_±r
Ğ
PrÙocŞ
::
	`ü—‹_lock_»que¡
(
hªdË
, 
mode
, 
çl£
) );

482 
Cl›ÁHªdËS‹PŒ
 
hªdË_¡©e_±r
;

483 
ušt32_t
 
¡©us
 = 0;

485 ià(!
m_k“·live_hªdËr_±r
->
	`g‘_hªdË_¡©e
(
hªdË
, 
hªdË_¡©e_±r
))

486  
E¼Ü
::
HYPERSPACE_INVALID_HANDLE
;

488 ià(
hªdË_¡©e_±r
->
lockStus
 != 0)

489  
E¼Ü
::
HYPERSPACE_ALREADY_LOCKED
;

491 
Œy_agaš
:

492 ià(!
	`wa™_fÜ_§ã
())

493  
E¼Ü
::
HYPERSPACE_EXPIRED_SESSION
;

496 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
hªdË_¡©e_±r
->mutex);

497 
£qu’û½
->
mode
 = mode;

498 
£qu’û½
->
Çme
 = 
hªdË_¡©e_±r
->
nÜm®Name
;

499 
hªdË_¡©e_±r
->
£qu’ûr
 = 
£qu’û½
;

502 
”rÜ
 = 
	`£nd_mes§ge
(
cbuf_±r
, &
syncHªdËr
);

503 ià(
”rÜ
 =ğ
E¼Ü
::
OK
) {

504 ià(!
syncHªdËr
.
	`wa™_fÜ_»¶y
(
ev’tPŒ
)) {

505 
”rÜ
 = ()
PrÙocŞ
::
	`»¥Ú£_code
(
ev’tPŒ
.
	`g‘
());

506 ià(!
m_s’t
) {

507 
	`HT_ERRORF
("Hy³r¥aû 'lock'ƒ¼Ü,‚ame='%s' : %s", 
hªdË_¡©e_±r
->
nÜm®Name
.
	`c_¡r
(), 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

508 ià(
m_v”bo£
)

509 
	`HT_ERRORF
("%s", 
PrÙocŞ
::
	`¡ršg_fÜm©_mes§ge
(
ev’tPŒ
.
	`g‘
()).
	`c_¡r
());

513 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
hªdË_¡©e_±r
->mutex);

514 
ušt8_t
 *
±r
 = 
ev’tPŒ
->
mes§ge
 + 4;

515 
size_t
 
»maššg
 = 
ev’tPŒ
->
mes§geL’
 - 4;

516 
hªdË_¡©e_±r
->
lockMode
 = 
mode
;

517 ià(!
S”Ÿliz©iÚ
::
	`decode_št
(&
±r
, &
»maššg
, &
¡©us
))

518 
	`as£¹
(!"problem decoding„eturn…acket");

519 ià(
¡©us
 =ğ
LOCK_STATUS_GRANTED
) {

520 ià(!
S”Ÿliz©iÚ
::
	`decode_lÚg
(&
±r
, &
»maššg
, &
£qu’û½
->
g’”©iÚ
))

521 
	`as£¹
(!"problem decoding„eturn…acket");

522 
hªdË_¡©e_±r
->
lockG’”©iÚ
 = 
£qu’û½
->
g’”©iÚ
;

523 
hªdË_¡©e_±r
->
lockStus
 = 
LOCK_STATUS_GRANTED
;

526 
	`as£¹
(
¡©us
 =ğ
LOCK_STATUS_PENDING
);

527 
hªdË_¡©e_±r
->
lockStus
 = 
LOCK_STATUS_PENDING
;

528 
hªdË_¡©e_±r
->
lockStus
 =ğ
LOCK_STATUS_PENDING
)

529 
hªdË_¡©e_±r
->
cÚd
.
	`wa™
(
lock
);

530 ià(
hªdË_¡©e_±r
->
lockStus
 =ğ
LOCK_STATUS_CANCELLED
)

531  
E¼Ü
::
HYPERSPACE_REQUEST_CANCELLED
;

532 
	`as£¹
(
hªdË_¡©e_±r
->
lockStus
 =ğ
LOCK_STATUS_GRANTED
);

537 
	`¡©e_Œªs™iÚ
(
SessiÚ
::
STATE_JEOPARDY
);

538 
Œy_agaš
;

541  
”rÜ
;

542 
	}
}

546 
	gSessiÚ
::
	$Œy_lock
(
ušt64_t
 
hªdË
, 
ušt32_t
 
mode
, ušt32_ˆ*
¡©u¥
, 
LockSequ’ûrT
 *
£qu’û½
) {

547 
Di¥©chHªdËrSynchrÚiz”
 
syncHªdËr
;

548 
Hy³¹abË
::
Ev’tPŒ
 
ev’tPŒ
;

549 
CommBufPŒ
 
	`cbuf_±r
Ğ
PrÙocŞ
::
	`ü—‹_lock_»que¡
(
hªdË
, 
mode
, 
Œue
) );

550 
Cl›ÁHªdËS‹PŒ
 
hªdË_¡©e_±r
;

552 ià(!
m_k“·live_hªdËr_±r
->
	`g‘_hªdË_¡©e
(
hªdË
, 
hªdË_¡©e_±r
))

553  
E¼Ü
::
HYPERSPACE_INVALID_HANDLE
;

555 ià(
hªdË_¡©e_±r
->
lockStus
 != 0)

556  
E¼Ü
::
HYPERSPACE_ALREADY_LOCKED
;

558 
Œy_agaš
:

559 ià(!
	`wa™_fÜ_§ã
())

560  
E¼Ü
::
HYPERSPACE_EXPIRED_SESSION
;

562 
”rÜ
 = 
	`£nd_mes§ge
(
cbuf_±r
, &
syncHªdËr
);

563 ià(
”rÜ
 =ğ
E¼Ü
::
OK
) {

564 ià(!
syncHªdËr
.
	`wa™_fÜ_»¶y
(
ev’tPŒ
)) {

565 
”rÜ
 = ()
PrÙocŞ
::
	`»¥Ú£_code
(
ev’tPŒ
.
	`g‘
());

566 ià(!
m_s’t
) {

567 
	`HT_ERRORF
("Hy³r¥aû 'Œylock'ƒ¼Ü,‚ame='%s' : %s", 
hªdË_¡©e_±r
->
nÜm®Name
.
	`c_¡r
(), 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

568 ià(
m_v”bo£
)

569 
	`HT_ERRORF
("%s", 
PrÙocŞ
::
	`¡ršg_fÜm©_mes§ge
(
ev’tPŒ
.
	`g‘
()).
	`c_¡r
());

573 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
hªdË_¡©e_±r
->mutex);

574 
ušt8_t
 *
±r
 = 
ev’tPŒ
->
mes§ge
 + 4;

575 
size_t
 
»maššg
 = 
ev’tPŒ
->
mes§geL’
 - 4;

576 ià(!
S”Ÿliz©iÚ
::
	`decode_št
(&
±r
, &
»maššg
, 
¡©u¥
))

577 
	`as£¹
(!"problem decoding„eturn…acket");

578 ià(*
¡©u¥
 =ğ
LOCK_STATUS_GRANTED
) {

579 ià(!
S”Ÿliz©iÚ
::
	`decode_lÚg
(&
±r
, &
»maššg
, &
£qu’û½
->
g’”©iÚ
))

580 
	`as£¹
(!"problem decoding„eturn…acket");

581 
£qu’û½
->
mode
 = mode;

582 
£qu’û½
->
Çme
 = 
hªdË_¡©e_±r
->
nÜm®Name
;

583 
hªdË_¡©e_±r
->
lockMode
 = 
mode
;

584 
hªdË_¡©e_±r
->
lockStus
 = 
LOCK_STATUS_GRANTED
;

585 
hªdË_¡©e_±r
->
lockG’”©iÚ
 = 
£qu’û½
->
g’”©iÚ
;

586 
hªdË_¡©e_±r
->
£qu’ûr
 = 0;

591 
	`¡©e_Œªs™iÚ
(
SessiÚ
::
STATE_JEOPARDY
);

592 
Œy_agaš
;

595  
”rÜ
;

596 
	}
}

599 
	gSessiÚ
::
	$»Ëa£
(
ušt64_t
 
hªdË
) {

600 
Di¥©chHªdËrSynchrÚiz”
 
syncHªdËr
;

601 
Hy³¹abË
::
Ev’tPŒ
 
ev’tPŒ
;

602 
CommBufPŒ
 
	`cbuf_±r
Ğ
PrÙocŞ
::
	`ü—‹_»Ëa£_»que¡
(
hªdË
) );

603 
Cl›ÁHªdËS‹PŒ
 
hªdË_¡©e_±r
;

605 ià(!
m_k“·live_hªdËr_±r
->
	`g‘_hªdË_¡©e
(
hªdË
, 
hªdË_¡©e_±r
))

606  
E¼Ü
::
HYPERSPACE_INVALID_HANDLE
;

608 
Œy_agaš
:

609 ià(!
	`wa™_fÜ_§ã
())

610  
E¼Ü
::
HYPERSPACE_EXPIRED_SESSION
;

612 
”rÜ
 = 
	`£nd_mes§ge
(
cbuf_±r
, &
syncHªdËr
);

613 ià(
”rÜ
 =ğ
E¼Ü
::
OK
) {

614 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
hªdË_¡©e_±r
->mutex);

615 ià(!
syncHªdËr
.
	`wa™_fÜ_»¶y
(
ev’tPŒ
)) {

616 
”rÜ
 = ()
PrÙocŞ
::
	`»¥Ú£_code
(
ev’tPŒ
.
	`g‘
());

617 ià(!
m_s’t
) {

618 
	`HT_ERRORF
("Hy³r¥aû '»Ëa£'ƒ¼Ü : %s", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

619 ià(
m_v”bo£
)

620 
	`HT_ERRORF
("%s", 
PrÙocŞ
::
	`¡ršg_fÜm©_mes§ge
(
ev’tPŒ
.
	`g‘
()).
	`c_¡r
());

623 
hªdË_¡©e_±r
->
lockStus
 = 0;

624 
hªdË_¡©e_±r
->
cÚd
.
	`nÙify_®l
();

627 
	`¡©e_Œªs™iÚ
(
SessiÚ
::
STATE_JEOPARDY
);

628 
Œy_agaš
;

631  
”rÜ
;

632 
	}
}

636 
	gSessiÚ
::
	$g‘_£qu’ûr
(
ušt64_t
 
hªdË
, 
LockSequ’ûrT
 *
£qu’û½
) {

637 
Cl›ÁHªdËS‹PŒ
 
hªdË_¡©e_±r
;

639 ià(!
m_k“·live_hªdËr_±r
->
	`g‘_hªdË_¡©e
(
hªdË
, 
hªdË_¡©e_±r
))

640  
E¼Ü
::
HYPERSPACE_INVALID_HANDLE
;

642 ià(
hªdË_¡©e_±r
->
lockG’”©iÚ
 == 0)

643  
E¼Ü
::
HYPERSPACE_NOT_LOCKED
;

645 
£qu’û½
->
Çme
 = 
hªdË_¡©e_±r
->
nÜm®Name
;

646 
£qu’û½
->
mode
 = 
hªdË_¡©e_±r
->
lockMode
;

647 
£qu’û½
->
g’”©iÚ
 = 
hªdË_¡©e_±r
->
lockG’”©iÚ
;

649  
E¼Ü
::
OK
;

650 
	}
}

655 
	gSessiÚ
::
	$check_£qu’ûr
(
LockSequ’ûrT
 &
£qu’ûr
) {

656 
	`HT_WARN
("CheckSequencer‚ot implemented.");

657  
E¼Ü
::
OK
;

658 
	}
}

664 
	gSessiÚ
::
	$¡©us
() {

665 
Di¥©chHªdËrSynchrÚiz”
 
syncHªdËr
;

666 
Ev’tPŒ
 
ev’tPŒ
;

667 
CommBufPŒ
 
	`cbuf_±r
Ğ
PrÙocŞ
::
	`ü—‹_¡©us_»que¡
() );

668 
”rÜ
 = 
	`£nd_mes§ge
(
cbuf_±r
, &
syncHªdËr
);

669 ià(
”rÜ
 =ğ
E¼Ü
::
OK
) {

670 ià(!
syncHªdËr
.
	`wa™_fÜ_»¶y
(
ev’tPŒ
)) {

671 
”rÜ
 = ()
PrÙocŞ
::
	`»¥Ú£_code
(
ev’tPŒ
);

672 ià(!
m_s’t
) {

673 
	`HT_ERRORF
("Hy³r¥aû '¡©us'ƒ¼Ü : %s", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

674 ià(
m_v”bo£
)

675 
	`HT_ERRORF
("%s", 
PrÙocŞ
::
	`¡ršg_fÜm©_mes§ge
(
ev’tPŒ
.
	`g‘
()).
	`c_¡r
());

679  
”rÜ
;

680 
	}
}

688 
	gSessiÚ
::
	$¡©e_Œªs™iÚ
(
¡©e
) {

689 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

690 
ŞdS‹
 = 
m_¡©e
;

691 
m_¡©e
 = 
¡©e
;

692 ià(
m_¡©e
 =ğ
STATE_SAFE
) {

693 
m_cÚd
.
	`nÙify_®l
();

694 ià(
m_£ssiÚ_ÿÎback
 && 
ŞdS‹
 =ğ
STATE_JEOPARDY
)

695 
m_£ssiÚ_ÿÎback
->
	`§ã
();

697 ià(
m_¡©e
 =ğ
STATE_JEOPARDY
) {

698 ià(
m_£ssiÚ_ÿÎback
 && 
ŞdS‹
 =ğ
STATE_SAFE
) {

699 
m_£ssiÚ_ÿÎback
->
	`jeİ¬dy
();

700 
boo¡
::
	`xtime_g‘
(&
m_expœe_time
, boo¡::
TIME_UTC
);

701 
m_expœe_time
.
£c
 +ğ
m_g¿û_³riod
;

704 ià(
m_¡©e
 =ğ
STATE_EXPIRED
) {

705 ià(
m_£ssiÚ_ÿÎback
 && 
ŞdS‹
 !ğ
STATE_EXPIRED
)

706 
m_£ssiÚ_ÿÎback
->
	`expœed
();

707 
m_cÚd
.
	`nÙify_®l
();

709  
ŞdS‹
;

710 
	}
}

716 
	gSessiÚ
::
	$g‘_¡©e
() {

717 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

718  
m_¡©e
;

719 
	}
}

724 
boŞ
 
	gSessiÚ
::
	$expœed
() {

725 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

726 
boo¡
::
xtime
 
now
;

727 
boo¡
::
	`xtime_g‘
(&
now
, boo¡::
TIME_UTC
);

728 ià(
	`xtime_cmp
(
m_expœe_time
, 
now
) < 0)

729  
Œue
;

730  
çl£
;

731 
	}
}

736 
boŞ
 
	gSessiÚ
::
	$wa™_fÜ_cÚÃùiÚ
(
max_wa™_£cs
) {

737 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

738 
boo¡
::
xtime
 
drİTime
, 
now
;

740 
boo¡
::
	`xtime_g‘
(&
drİTime
, boo¡::
TIME_UTC
);

741 
drİTime
.
£c
 +ğ
max_wa™_£cs
;

743 
m_¡©e
 !ğ
STATE_SAFE
) {

744 
m_cÚd
.
	`timed_wa™
(
lock
, 
drİTime
);

745 
boo¡
::
	`xtime_g‘
(&
now
, boo¡::
TIME_UTC
);

746 ià(
	`xtime_cmp
(
now
, 
drİTime
) >= 0)

747  
çl£
;

749  
Œue
;

750 
	}
}

754 
boŞ
 
	gSessiÚ
::
	$wa™_fÜ_§ã
() {

755 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

756 
m_¡©e
 !ğ
STATE_SAFE
) {

757 ià(
m_¡©e
 =ğ
STATE_EXPIRED
)

758  
çl£
;

759 
m_cÚd
.
	`wa™
(
lock
);

761  
Œue
;

762 
	}
}

764 
	gSessiÚ
::
	$£nd_mes§ge
(
CommBufPŒ
 &
cbuf_±r
, 
Di¥©chHªdËr
 *
hªdËr
) {

765 
”rÜ
;

767 ià((
”rÜ
 = 
m_comm
->
	`£nd_»que¡
(
m_ma¡”_addr
, 
m_timeout
, 
cbuf_±r
, 
hªdËr
)è!ğ
E¼Ü
::
OK
) {

768 
¡d
::
¡ršg
 
¡r
;

769 ià(!
m_s’t
)

770 
	`HT_WARNF
("Comm::send_requesto Hypertable.Master‡t %s failed - %s",

771 
IÃtAddr
::
	`¡ršg_fÜm©
(
¡r
, 
m_ma¡”_addr
), 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

773  
”rÜ
;

774 
	}
}

780 
	gSessiÚ
::
nÜm®ize_Çme
(
¡d
::
¡ršg
 
Çme
, std::¡ršg &
nÜm®
) {

782 ià(
Çme
 == "/") {

783 
nÜm®
 = 
Çme
;

787 
	gnÜm®
 = "";

788 ià(
	gÇme
[0] != '/')

789 
nÜm®
 += "/";

791 ià(
	gÇme
.
fšd
('/', 
Çme
.
Ëngth
()-1è=ğ
¡ršg
::
Åos
)

792 
nÜm®
 +ğ
Çme
;

794 
	gnÜm®
 +ğ
Çme
.
sub¡r
(0,‚ame.
Ëngth
()-1);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/Session.h

21 #iâdeà
HYPERSPACE_SESSION_H


22 
	#HYPERSPACE_SESSION_H


	)

24 
	~<veùÜ
>

26 
	~<boo¡/th»ad/cÚd™iÚ.hµ
>

27 
	~<boo¡/th»ad/mu‹x.hµ
>

29 
	~"AsyncComm/Comm.h
"

30 
	~"AsyncComm/CommBuf.h
"

31 
	~"AsyncComm/CÚÃùiÚMªag”.h
"

32 
	~"AsyncComm/Di¥©chHªdËr.h
"

34 
	~"CommÚ/DyÇmicBufãr.h
"

35 
	~"CommÚ/Reã»nûCouÁ.h
"

37 
	~"Cl›ÁK“·liveHªdËr.h
"

38 
	~"HªdËC®lback.h
"

39 
	~"LockSequ’ûr.h
"

40 
	~"PrÙocŞ.h
"

42 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

43 
usšg
 
Çme¥aû
 
	gHy³r¥aû
;

45 
Çme¥aû
 
	gHy³r¥aû
 {

54 
	gOPEN_FLAG_READ
 = 0x00001,

56 
	gOPEN_FLAG_WRITE
 = 0x00002,

58 
	gOPEN_FLAG_LOCK
 = 0x00004,

60 
	gOPEN_FLAG_CREATE
 = 0x00008,

62 
	gOPEN_FLAG_EXCL
 = 0x00010,

64 
	gOPEN_FLAG_TEMP
 = 0x00020,

66 
	gOPEN_FLAG_LOCK_SHARED
 = 0x00044,

68 
	gOPEN_FLAG_LOCK_EXCLUSIVE
 = 0x00084

77 şas 
	cSessiÚC®lback
 {

78 
	gpublic
:

79 
vœtu®
 ~
SessiÚC®lback
() { ; }

80 
vœtu®
 
§ã
() = 0;

81 
vœtu®
 
expœed
() = 0;

82 
vœtu®
 
jeİ¬dy
() = 0;

120 şas 
	cSessiÚ
 : 
public
 
Reã»nûCouÁ
 {

122 
public
:

129 
STATE_EXPIRED
,

131 
	gSTATE_JEOPARDY
,

133 
	gSTATE_SAFE


149 
SessiÚ
(
Comm
 *
comm
, 
Prİ”t›sPŒ
 &
´İs_±r
, 
SessiÚC®lback
 *
ÿÎback
=0);

151 
	gvœtu®
 ~
SessiÚ
();

165 
İ’
(
¡d
::
¡ršg
 
Çme
, 
ušt32_t
 
æags
, 
HªdËC®lbackPŒ
 &
ÿÎbackPŒ
, 
ušt64_t
 *
hªdËp
);

183 
ü—‹
(
¡d
::
¡ršg
 
Çme
, 
ušt32_t
 
æags
, 
HªdËC®lbackPŒ
 &
ÿÎbackPŒ
, std::
veùÜ
<
A‰ribu‹T
> &
š™A‰rs
, 
ušt64_t
 *
hªdËp
);

194 
şo£
(
ušt64_t
 
hªdË
);

205 
mkdœ
(
¡d
::
¡ršg
 
Çme
);

215 
©Œ_£t
(
ušt64_t
 
hªdË
, 
¡d
::
¡ršg
 
Çme
, cÚ¡ *
v®ue
, 
size_t
 
v®ue_Ën
);

224 
©Œ_g‘
(
ušt64_t
 
hªdË
, 
¡d
::
¡ršg
 
Çme
, 
DyÇmicBufãr
 &
v®ue
);

232 
©Œ_d–
(
ušt64_t
 
hªdË
, 
¡d
::
¡ršg
 
Çme
);

240 
exi¡s
(
¡d
::
¡ršg
 
Çme
, 
boŞ
 *
exi¡¥
);

248 
uÆšk
(
¡d
::
¡ršg
 
Çme
);

258 
»addœ
(
ušt64_t
 
hªdË
, 
¡d
::
veùÜ
<
DœEÁryT
> &
li¡šg
);

276 
lock
(
ušt64_t
 
hªdË
, 
ušt32_t
 
mode
, 
LockSequ’ûrT
 *
£qu’û½
);

296 
Œy_lock
(
ušt64_t
 
hªdË
, 
ušt32_t
 
mode
, ušt32_ˆ*
¡©u¥
, 
LockSequ’ûrT
 *
£qu’û½
);

303 
»Ëa£
(
ušt64_t
 
hªdË
);

311 
g‘_£qu’ûr
(
ušt64_t
 
hªdË
, 
LockSequ’ûrT
 *
£qu’û½
);

320 
check_£qu’ûr
(
LockSequ’ûrT
 &
£qu’ûr
);

326 
¡©us
();

333 
boŞ
 
wa™_fÜ_cÚÃùiÚ
(
max_wa™_£cs
);

339 
£t_s’t_æag
(
boŞ
 
s’t
è{ 
	gm_s’t
 = silent; }

345 
£t_v”bo£_æag
(
boŞ
 
v”bo£
è{ 
	gm_v”bo£
 = verbose; }

352 
¡©e_Œªs™iÚ
(
¡©e
);

358 
g‘_¡©e
();

365 
boŞ
 
expœed
();

367 
	g´iv©e
:

369 
boŞ
 
wa™_fÜ_§ã
();

370 
£nd_mes§ge
(
CommBufPŒ
 &
cbufPŒ
, 
Di¥©chHªdËr
 *
hªdËr
);

371 
nÜm®ize_Çme
(
¡d
::
¡ršg
 
Çme
, std::¡ršg &
nÜm®
);

372 
İ’
(
Cl›ÁHªdËS‹PŒ
 &
hªdËS‹PŒ
, 
CommBufPŒ
 &
cbufPŒ
, 
ušt64_t
 *
hªdËp
);

374 
	gboo¡
::
mu‹x
 
m_mu‹x
;

375 
	gboo¡
::
cÚd™iÚ
 
m_cÚd
;

376 
Comm
 *
	gm_comm
;

377 
boŞ
 
	gm_v”bo£
;

378 
boŞ
 
	gm_s’t
;

379 
	gm_¡©e
;

380 
ušt32_t
 
	gm_g¿û_³riod
;

381 
ušt32_t
 
	gm_Ëa£_š‹rv®
;

382 
ušt32_t
 
	gm_timeout
;

383 
	gboo¡
::
xtime
 
m_expœe_time
;

384 
sockaddr_š
 
	gm_ma¡”_addr
;

385 
Cl›ÁK“·liveHªdËrPŒ
 
	gm_k“·live_hªdËr_±r
;

386 
SessiÚC®lback
 *
	gm_£ssiÚ_ÿÎback
;

388 
	gboo¡
::
	tšŒusive_±r
<
	tSessiÚ
> 
	tSessiÚPŒ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/SessionData.h

21 #iâdeà
HYPERSPACE_SESSIONDATA_H


22 
	#HYPERSPACE_SESSIONDATA_H


	)

24 
	~<li¡
>

25 
	~<£t
>

27 
	~<boo¡/th»ad/mu‹x.hµ
>

28 
	~<boo¡/th»ad/xtime.hµ
>

30 
	~"CommÚ/Reã»nûCouÁ.h
"

32 
	~"NÙifiÿtiÚ.h
"

34 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

36 
Çme¥aû
 
	gHy³r¥aû
 {

38 şas 
	cSessiÚD©a
 : 
public
 
Reã»nûCouÁ
 {

39 
public
:

40 
SessiÚD©a
(
sockaddr_š
 &
_addr
, 
ušt32_t
 
Ëa£IÁ”v®
, 
ušt64_t
 
_id
è: 
addr
(_addr), 
m_Ëa£_š‹rv®
Ö—£IÁ”v®), 
id
(_id), 
expœed
(
çl£
) {

41 
	gboo¡
::
xtime_g‘
(&
expœeTime
, 
boo¡
::
TIME_UTC
);

42 
	gexpœeTime
.
	g£c
 +ğ
Ëa£IÁ”v®
;

46 
add_nÙifiÿtiÚ
(
NÙifiÿtiÚ
 *
nÙifiÿtiÚ
) {

47 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(mutex);

48 ià(
	gexpœed
) {

49 
	gnÙifiÿtiÚ
->
	gev’tPŒ
->
deüem’t_nÙifiÿtiÚ_couÁ
();

50 
d–‘e
 
	gnÙifiÿtiÚ
;

53 
	gnÙifiÿtiÚs
.
push_back
(
nÙifiÿtiÚ
);

56 
purge_nÙifiÿtiÚs
(
ušt64_t
 
ev’tId
) {

57 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(mutex);

58 
	gli¡
<
	gNÙifiÿtiÚ
 *>::
™”©Ü
 
™”
 = 
nÙifiÿtiÚs
.
begš
();

59 
	g™”
 !ğ
nÙifiÿtiÚs
.
’d
()) {

60 ià((*
™”
)->
ev’tPŒ
->
g‘_id
(è<ğ
ev’tId
) {

61 (*
™”
)->
ev’tPŒ
->
deüem’t_nÙifiÿtiÚ_couÁ
();

62 
d–‘e
 *
	g™”
;

63 
	g™”
 = 
nÙifiÿtiÚs
.
”a£
(
™”
);

66 
	g™”
++;

70 
boŞ
 
»Ãw_Ëa£
() {

71 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(mutex);

72 
	gboo¡
::
xtime
 
now
;

73 
	gboo¡
::
xtime_g‘
(&
now
, 
boo¡
::
TIME_UTC
);

74 ià(
xtime_cmp
(
expœeTime
, 
now
) < 0) {

75 
	gexpœed
 = 
Œue
;

76 
	gli¡
<
	gNÙifiÿtiÚ
 *>::
™”©Ü
 
™”
 = 
nÙifiÿtiÚs
.
begš
();

77 
	g™”
 !ğ
nÙifiÿtiÚs
.
’d
()) {

78 (*
™”
)->
ev’tPŒ
->
deüem’t_nÙifiÿtiÚ_couÁ
();

79 
d–‘e
 *
	g™”
;

80 
	g™”
 = 
nÙifiÿtiÚs
.
”a£
(
™”
);

82  
	gçl£
;

84 
memıy
(&
expœeTime
, &
now
, (
boo¡
::
xtime
));

85 
	gexpœeTime
.
	g£c
 +ğ
m_Ëa£_š‹rv®
;

86  
	gŒue
;

89 
boŞ
 
is_expœed
(
boo¡
::
xtime
 &
now
) {

90 
boo¡
::
mu‹x
::
scİed_lock
 
lock
(mutex);

91  (
xtime_cmp
(
expœeTime
, 
now
è< 0è? 
	gŒue
 : 
çl£
;

94 
expœe
() {

95 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(mutex);

96 ià(
	gexpœed
)

98 
	gexpœed
 = 
Œue
;

99 
	gli¡
<
	gNÙifiÿtiÚ
 *>::
™”©Ü
 
™”
 = 
nÙifiÿtiÚs
.
begš
();

100 
	g™”
 !ğ
nÙifiÿtiÚs
.
’d
()) {

101 (*
™”
)->
ev’tPŒ
->
deüem’t_nÙifiÿtiÚ_couÁ
();

102 
d–‘e
 *
	g™”
;

103 
	g™”
 = 
nÙifiÿtiÚs
.
”a£
(
™”
);

107 
add_hªdË
(
ušt64_t
 
hªdË
) {

108 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(mutex);

109 
	ghªdËs
.
š£¹
(
hªdË
);

112 
	gboo¡
::
mu‹x
 mutex;

113 
sockaddr_š
 
	gaddr
;

114 
ušt32_t
 
	gm_Ëa£_š‹rv®
;

115 
ušt64_t
 
	gid
;

116 
boŞ
 
	gexpœed
;

117 
	gboo¡
::
xtime
 
expœeTime
;

118 
	g£t
<
	gušt64_t
> 
	ghªdËs
;

119 
	gli¡
<
	gNÙifiÿtiÚ
 *> 
	gnÙifiÿtiÚs
;

122 
	gboo¡
::
	tšŒusive_±r
<
	tSessiÚD©a
> 
	tSessiÚD©aPŒ
;

124 
	sÉSessiÚD©a
 {

125 
boŞ
 
İ”©Ü
()(cÚ¡ 
	gSessiÚD©aPŒ
 &
	gsd1
, cÚ¡ SessiÚD©aPŒ &
	gsd2
) const {

126  
xtime_cmp
(
sd1
->
expœeTime
, 
sd2
->expireTime) >= 0;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/main.cc

21 
	~<io¡»am
>

22 
	~<f¡»am
>

23 
	~<¡ršg
>

26 
	~<pŞl.h
>

27 
	~<sys/ty³s.h
>

28 
	~<uni¡d.h
>

31 
	~"CommÚ/E¼Ü.h
"

32 
	~"CommÚ/IÃtAddr.h
"

33 
	~"CommÚ/Sy¡em.h
"

34 
	~"CommÚ/U§ge.h
"

36 
	~"AsyncComm/AµliÿtiÚQueue.h
"

37 
	~"AsyncComm/Comm.h
"

38 
	~"AsyncComm/CÚÃùiÚHªdËrFaùÜy.h
"

40 
	~"S”v”CÚÃùiÚHªdËr.h
"

41 
	~"S”v”K“·liveHªdËr.h
"

42 
	~"Ma¡”.h
"

44 
usšg
 
Çme¥aû
 
Hy³r¥aû
;

45 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

46 
usšg
 
Çme¥aû
 
	g¡d
;

49 
	gÇme¥aû
 {

50 cÚ¡ *
	gu§ge
[] = {

64 cÚ¡ 
	gDEFAULT_WORKERS
 = 20;

72 şas 
	cHªdËrFaùÜy
 : 
public
 
CÚÃùiÚHªdËrFaùÜy
 {

74 
public
:

75 
	$HªdËrFaùÜy
(
Comm
 *
comm
, 
AµliÿtiÚQueuePŒ
 &
­pQueuePŒ
, 
Ma¡”PŒ
 &
ma¡”PŒ
è: 
	`m_comm
(comm), 
	`m_­p_queue_±r
×µQueuePŒ), 
	$m_ma¡”_±r
(
ma¡”PŒ
) {

78 
vœtu®
 
	$g‘_š¡ªû
(
Di¥©chHªdËrPŒ
 &
dhp
) {

79 
dhp
 = 
Ãw
 
	`S”v”CÚÃùiÚHªdËr
(
m_comm
, 
m_­p_queue_±r
, 
m_ma¡”_±r
);

80 
	}
}

82 
	g´iv©e
:

83 
Comm
 *
m_comm
;

84 
AµliÿtiÚQueuePŒ
 
	gm_­p_queue_±r
;

85 
Ma¡”PŒ
 
	gm_ma¡”_±r
;

93 
	$maš
(
¬gc
, **
¬gv
) {

94 
¡ršg
 
cÚfigFe
 = "";

95 
¡ršg
 
pidFe
 = "";

96 
Prİ”t›sPŒ
 
´İs_±r
;

97 
boŞ
 
v”bo£
 = 
çl£
;

98 
Ma¡”PŒ
 
ma¡”PŒ
;

99 
pÜt
, 
»aùÜCouÁ
, 
wÜk”CouÁ
;

100 
Comm
 *
comm
;

101 
AµliÿtiÚQueuePŒ
 
­pQueuePŒ
;

102 
S”v”K“·liveHªdËrPŒ
 
k“·liveHªdËrPŒ
;

103 
CÚÃùiÚMªag”PŒ
 
cÚnMªag”PŒ
;

104 
”rÜ
;

105 
sockaddr_š
 
loÿlAddr
;

107 
Sy¡em
::
	`š™Ÿlize
(
¬gv
[0]);

109 ià(
¬gc
 > 1) {

110 
i
=1; i<
¬gc
; i++) {

111 ià(!
	`¡ºcmp
(
¬gv
[
i
], "--config=", 9))

112 
cÚfigFe
 = &
¬gv
[
i
][9];

113 ià(!
	`¡ºcmp
(
¬gv
[
i
], "--install-dir=", 14)) {

114 
Sy¡em
::
š¡®lDœ
 = &
¬gv
[
i
][14];

115 ià(
Sy¡em
::
š¡®lDœ
.
	`fšd
('/', Sy¡em::š¡®lDœ.
	`Ëngth
()-1è!ğ
¡ršg
::
Åos
)

116 
Sy¡em
::
š¡®lDœ
 = Sy¡em::š¡®lDœ.
	`sub¡r
(0, Sy¡em::š¡®lDœ.
	`Ëngth
()-1);

118 ià(!
	`¡ºcmp
(
¬gv
[
i
], "--pidfile=", 10))

119 
pidFe
 = &
¬gv
[
i
][10];

120 ià(!
	`¡rcmp
(
¬gv
[
i
], "--verbose") || !strcmp(argv[i], "-v"))

121 
v”bo£
 = 
Œue
;

122 ià(!
	`¡rcmp
(
¬gv
[
i
], "-?") || !strcmp(argv[i], "--help")) {

123 
U§ge
::
	`dump_ªd_ex™
(
u§ge
);

126 
û¼
 << "Hy³r¥aû.ma¡”: UÄecognized‡rgum’ˆ'" << 
¬gv
[
i
] << "'" << 
’dl
;

128 
	`ex™
(1);

133 ià(
cÚfigFe
 == "")

134 
cÚfigFe
 = 
Sy¡em
::
š¡®lDœ
 + "/conf/hypertable.cfg";

136 
´İs_±r
 = 
Ãw
 
	`Prİ”t›s
(
cÚfigFe
);

137 ià(
v”bo£
)

138 
´İs_±r
->
	`£t
("Hypertable.Verbose", "true");

140 
pÜt
 = 
´İs_±r
->
	`g‘_št
("Hy³r¥aû.Ma¡”.PÜt", 
Ma¡”
::
DEFAULT_MASTER_PORT
);

141 
»aùÜCouÁ
 = 
´İs_±r
->
	`g‘_št
("Hy³r¥aû.Ma¡”.R—ùÜs", 
Sy¡em
::
	`g‘_´oûssÜ_couÁ
());

142 
wÜk”CouÁ
 = 
´İs_±r
->
	`g‘_št
("Hy³r¥aû.Ma¡”.WÜk”s", 
DEFAULT_WORKERS
);

144 
R—ùÜFaùÜy
::
	`š™Ÿlize
(
»aùÜCouÁ
);

146 
comm
 = 
Ãw
 
	`Comm
();

148 
cÚnMªag”PŒ
 = 
Ãw
 
	`CÚÃùiÚMªag”
(
comm
);

150 ià(
v”bo£
) {

151 
cout
 << "CPU couÁ = " << 
Sy¡em
::
	`g‘_´oûssÜ_couÁ
(è<< 
’dl
;

152 
cout
 << "Hy³r¥aû.Ma¡”.PÜt=" << 
pÜt
 << 
’dl
;

153 
cout
 << "Hy³r¥aû.Ma¡”.WÜk”s=" << 
wÜk”CouÁ
 << 
’dl
;

154 
cout
 << "Hy³r¥aû.Ma¡”.R—ùÜs=" << 
»aùÜCouÁ
 << 
’dl
;

157 
IÃtAddr
::
	`š™Ÿlize
(&
loÿlAddr
, 
INADDR_ANY
, 
pÜt
);

159 
ma¡”PŒ
 = 
Ãw
 
	`Ma¡”
(
cÚnMªag”PŒ
, 
´İs_±r
, 
k“·liveHªdËrPŒ
);

160 
­pQueuePŒ
 = 
Ãw
 
	`AµliÿtiÚQueue
(
wÜk”CouÁ
);

162 
CÚÃùiÚHªdËrFaùÜyPŒ
 
	`chfPŒ
Ğ
Ãw
 
	`HªdËrFaùÜy
(
comm
, 
­pQueuePŒ
, 
ma¡”PŒ
) );

163 ià((
”rÜ
 = 
comm
->
	`li¡’
(
loÿlAddr
, 
chfPŒ
)è!ğ
E¼Ü
::
OK
) {

164 
¡d
::
¡ršg
 
¡r
;

165 
	`HT_ERRORF
("Unableo†isten for connections on %s - %s",

166 
IÃtAddr
::
	`¡ršg_fÜm©
(
¡r
, 
loÿlAddr
), 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

167 
	`ex™
(1);

170 
Di¥©chHªdËrPŒ
 
	`dhp
(
k“·liveHªdËrPŒ
.
	`g‘
());

172 ià((
”rÜ
 = 
comm
->
	`ü—‹_d©ag¿m_»ûive_sock‘
(&
loÿlAddr
, 
dhp
)è!ğ
E¼Ü
::
OK
) {

173 
¡d
::
¡ršg
 
¡r
;

174 
	`HT_ERRORF
("Unableo create datagram„eceive socket %s - %s",

175 
IÃtAddr
::
	`¡ršg_fÜm©
(
¡r
, 
loÿlAddr
), 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

176 
	`ex™
(1);

179 ià(
pidFe
 != "") {

180 
f¡»am
 
	`fe¡r
 (
pidFe
.
	`c_¡r
(), f¡»am::
out
);

181 
fe¡r
 << 
	`g‘pid
(è<< 
’dl
;

182 
fe¡r
.
	`şo£
();

185 
­pQueuePŒ
->
	`još
();

187 
­pQueuePŒ
->
	`shutdown
();

189 
d–‘e
 
comm
;

191 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/ApacheLogParser.cc

21 
	~"A·cheLogP¬£r.h
"

24 
	~<lim™s.h
>

25 
	~<¡dlib.h
>

26 
	~<time.h
>

27 
	~<¡ršg.h
>

30 
usšg
 
Çme¥aû
 
Hy³¹abË
;

34 
	gA·cheLogP¬£r
::
lßd
(
¡d
::
¡ršg
 
f’ame
) {

35 
m_fš
.
İ’
(
f’ame
.
c_¡r
());

42 
boŞ
 
	gA·cheLogP¬£r
::
	$Ãxt
(
A·cheLogEÁryT
 &
’Œy
) {

43 
ušt64_t
 
time¡amp
;

44 *
ba£
;

46 
Œue
) {

48 
	`mem£t
(&
’Œy
, 0, (entry));

50 ià(!
	`g‘lše
(
m_fš
, 
m_lše
))

51  
çl£
;

53 
ba£
 = (*)
m_lše
.
	`c_¡r
();

56 ià((
ba£
 = 
	`exŒaù_f›ld
(ba£, &
’Œy
.
_add»ss
)) == 0)

60 ià((
ba£
 = 
	`exŒaù_f›ld
(base, 0)) == 0)

64 ià((
ba£
 = 
	`exŒaù_f›ld
(ba£, &
’Œy
.
u£rid
)) == 0)

68 ià((
ba£
 = 
	`exŒaù_time¡amp
(ba£, &
time¡amp
)) == 0)

72 ià(
time¡amp
 =ğ
m_Ï¡_time¡amp
)

73 
m_time¡amp_off£t
++;

75 
m_time¡amp_off£t
=0;

76 
m_Ï¡_time¡amp
 = 
time¡amp
;

78 
’Œy
.
time¡amp
 =ime¡am°+ 
m_time¡amp_off£t
;

80 ià(
’Œy
.
time¡amp
 == 0)

84 ià((
ba£
 = 
	`exŒaù_f›ld
(ba£, &
’Œy
.
»que¡
)) == 0)

88 ià((
ba£
 = 
	`exŒaù_f›ld
(ba£, &
’Œy
.
»¥Ú£_code
)) == 0)

92 ià((
ba£
 = 
	`exŒaù_f›ld
(ba£, &
’Œy
.
objeù_size
)) == 0)

96 ià((
ba£
 = 
	`exŒaù_f›ld
(ba£, &
’Œy
.
»ã»r
)) == 0)

97  
Œue
;

100 ià((
ba£
 = 
	`exŒaù_f›ld
(ba£, &
’Œy
.
u£r_ag’t
)) == 0)

101  
Œue
;

103  
Œue
;

106 
	}
}

113 *
	gA·cheLogP¬£r
::
	$exŒaù_f›ld
(*
ba£
, **
f›ld_±r
) {

114 *
±r
;

115 
	`is¥aû
(*
ba£
))

116 
ba£
++;

117 ià(*
ba£
 == '"') {

118 
ba£
++;

119 ià((
±r
 = 
	`¡rchr
(
ba£
, '"')) != 0)

120 *
±r
++ = 0;

122 ià((
±r
 = 
	`¡rchr
(
ba£
, ' ')) != 0)

123 *
±r
++ = 0;

124 ià(
f›ld_±r
) {

125 ià(*
ba£
 == 0 || (*base == '-' && *(base+1) == 0))

126 *
f›ld_±r
 = 0;

128 *
f›ld_±r
 = 
ba£
;

130  
±r
;

131 
	}
}

138 *
	gA·cheLogP¬£r
::
	$exŒaù_time¡amp
(*
ba£
, 
ušt64_t
 *
time¡amµ
) {

139 
tm
m;

140 *
’d_±r
;

141 *
±r
;

143 
	`mem£t
(&
tm
, 0, (tm));

145 *
time¡amµ
 = 0;

147 
	`is¥aû
(*
ba£
))

148 
ba£
++;

149 ià(*
ba£
 != '[')

151 
ba£
++;

152 ià((
±r
 = 
	`¡rchr
(
ba£
, ']')) != 0)

153 *
±r
++ = 0;

155 ià((
tm
.
tm_mday
 = 
	`¡¹Ş
(
ba£
, &
’d_±r
, 10)) == 0)

157 ià(*
’d_±r
 != '/')

159 
ba£
 = 
’d_±r
+1;

161 
’d_±r
 = (*)
ba£
;

162 
	`i§Íha
(*
’d_±r
))

163 
’d_±r
++;

164 ià(*
’d_±r
 !ğ'/' || (’d_±r-
ba£
) != 3)

166 *
’d_±r
++ = 0;

167 ià(!
	`¡rÿ£cmp
(
ba£
, "Jan"))

168 
tm
.
tm_mÚ
 = 0;

169 ià(!
	`¡rÿ£cmp
(
ba£
, "Feb"))

170 
tm
.
tm_mÚ
 = 1;

171 ià(!
	`¡rÿ£cmp
(
ba£
, "Mar"))

172 
tm
.
tm_mÚ
 = 2;

173 ià(!
	`¡rÿ£cmp
(
ba£
, "Apr"))

174 
tm
.
tm_mÚ
 = 3;

175 ià(!
	`¡rÿ£cmp
(
ba£
, "May"))

176 
tm
.
tm_mÚ
 = 4;

177 ià(!
	`¡rÿ£cmp
(
ba£
, "Jun"))

178 
tm
.
tm_mÚ
 = 5;

179 ià(!
	`¡rÿ£cmp
(
ba£
, "Jul"))

180 
tm
.
tm_mÚ
 = 6;

181 ià(!
	`¡rÿ£cmp
(
ba£
, "Aug"))

182 
tm
.
tm_mÚ
 = 7;

183 ià(!
	`¡rÿ£cmp
(
ba£
, "Sep"))

184 
tm
.
tm_mÚ
 = 8;

185 ià(!
	`¡rÿ£cmp
(
ba£
, "Oct"))

186 
tm
.
tm_mÚ
 = 9;

187 ià(!
	`¡rÿ£cmp
(
ba£
, "Nov"))

188 
tm
.
tm_mÚ
 = 10;

189 ià(!
	`¡rÿ£cmp
(
ba£
, "Dec"))

190 
tm
.
tm_mÚ
 = 11;

194 
ba£
 = 
’d_±r
;

195 ià((
tm
.
tm_y—r
 = 
	`¡¹Ş
(
ba£
, &
’d_±r
, 10)) == 0)

197 ià(*
’d_±r
 != ':')

199 
tm
.
tm_y—r
 -= 1900;

201 
ba£
 = 
’d_±r
+1;

202 
tm
.
tm_hour
 = 
	`¡¹Ş
(
ba£
, &
’d_±r
, 10);

203 ià(*
’d_±r
 != ':')

206 
ba£
 = 
’d_±r
+1;

207 
tm
.
tm_mš
 = 
	`¡¹Ş
(
ba£
, &
’d_±r
, 10);

208 ià(*
’d_±r
 != ':')

211 
ba£
 = 
’d_±r
+1;

212 
tm
.
tm_£c
 = 
	`¡¹Ş
(
ba£
, &
’d_±r
, 10);

213 
ba£
 = 
’d_±r
;

215 
	`is¥aû
(*
ba£
))

216 
ba£
++;

218 
ušt64_t
 
off£t
 = 0;

219 
boŞ
 
pos™ive
 = 
Œue
;

220 ià(*
ba£
) {

221 ià(*
ba£
 == '+')

222 
pos™ive
 = 
Œue
;

223 ià(*
ba£
 == '-')

224 
pos™ive
 = 
çl£
;

227 
ba£
++;

229 ià(!
	`isdig™
(*
ba£
))

231 
off£t
 +ğ360000 * (*
ba£
-'0');

232 ià(*++
ba£
 == 0)

235 ià(!
	`isdig™
(*
ba£
))

237 
off£t
 +ğ36000 * (*
ba£
-'0');

238 ià(*++
ba£
 == 0)

241 ià(!
	`isdig™
(*
ba£
))

243 
off£t
 +ğ600 * (*
ba£
-'0');

244 ià(*++
ba£
 == 0)

247 ià(!
	`isdig™
(*
ba£
))

249 
off£t
 +ğ60 * (*
ba£
-'0');

252 ià((*
time¡amµ
 = 
	`timegm
(&
tm
)è=ğ(
ušt64_t
)-1)

255 ià(!
pos™ive
)

256 *
time¡amµ
 -ğ
off£t
;

258 *
time¡amµ
 +ğ
off£t
;

260 *
time¡amµ
 *= 1000000000LL;

262  
±r
;

263 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/ApacheLogParser.h

21 #iâdeà
HYPERTABLE_APACHELOGPARSER_H


22 
	#HYPERTABLE_APACHELOGPARSER_H


	)

24 
	~<¡ršg
>

26 
	~<f¡»am
>

27 
	~<io¡»am
>

30 
Çme¥aû
 
	gHy³¹abË
 {

33 *
	g_add»ss
;

34 *
	gu£rid
;

35 
ušt64_t
 
	gtime¡amp
;

36 *
	g»que¡
;

37 *
	g»¥Ú£_code
;

38 *
	gobjeù_size
;

39 *
	g»ã»r
;

40 *
	gu£r_ag’t
;

41 } 
	tA·cheLogEÁryT
;

43 şas 
	cA·cheLogP¬£r
 {

45 
	gpublic
:

46 
A·cheLogP¬£r
(è: 
m_Ï¡_time¡amp
(0), 
m_time¡amp_off£t
(0) { ; }

47 
lßd
(
¡d
::
¡ršg
 
f’ame
);

48 
boŞ
 
Ãxt
(
A·cheLogEÁryT
 &
’Œy
);

50 
	g´iv©e
:

52 *
exŒaù_f›ld
(*
ba£
, **
f›ld_±r
);

53 *
exŒaù_time¡amp
(*
ba£
, 
ušt64_t
 *
time¡amµ
);

55 
	g¡d
::
if¡»am
 
m_fš
;

56 
	g¡d
::
¡ršg
 
m_lše
;

57 
ušt64_t
 
	gm_Ï¡_time¡amp
;

58 
ušt32_t
 
	gm_time¡amp_off£t
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/BlockCompressionCodec.h

21 #iâdeà
HYPERTABLE_BLOCKCOMPRESSIONCODEC_H


22 
	#HYPERTABLE_BLOCKCOMPRESSIONCODEC_H


	)

24 
	~<¡ršg
>

25 
	~<veùÜ
>

26 
	~"CommÚ/Th»ad.h
"

27 
	~"CommÚ/E¼Ü.h
"

29 
	~"BlockCom´essiÚH—d”.h
"

31 
Çme¥aû
 
	gHy³¹abË
 {

33 
şass
 
	gDyÇmicBufãr
;

38 şas 
	cBlockCom´essiÚCodec
 {

39 
	gpublic
:

40 
	eTy³
 { 
UNKNOWN
=-1, 
	gNONE
=0, 
	gBMZ
=1, 
	gZLIB
=2, 
	gLZO
=3, 
	gQUICKLZ
=4 };

41 
	g¡d
::
	tveùÜ
<
	t¡d
::
	t¡ršg
> 
	tArgs
;

43 
BlockCom´essiÚCodec
(è{ 
HT_THREAD_ID_SET
(
m_ü—tÜ_th»ad
); }

44 
	gvœtu®
 ~
BlockCom´essiÚCodec
() { ; }

46 
vœtu®
 
deæ©e
(cÚ¡ 
DyÇmicBufãr
 &
šput
, DyÇmicBufã¸&
ouut
,

47 
BlockCom´essiÚH—d”
 &
h—d”
, 
size_t
 
»£rve
=0) = 0;

49 
vœtu®
 
šæ©e
(cÚ¡ 
DyÇmicBufãr
 &
šput
, DyÇmicBufã¸&
ouut
,

50 
BlockCom´essiÚH—d”
 &
h—d”
) = 0;

52 
vœtu®
 
£t_¬gs
(cÚ¡ 
Args
 &
¬gs
è{  
	gE¼Ü
::
OK
; }

54 
vœtu®
 
g‘_ty³
() = 0;

56 
HT_THREAD_ID_DECL
(
m_ü—tÜ_th»ad
);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/BlockCompressionCodecBmz.cc

20 
	~"CommÚ/Checksum.h
"

21 
	~"CommÚ/Th»ad.h
"

22 
	~"CommÚ/Logg”.h
"

23 
	~"BlockCom´essiÚCodecBmz.h
"

24 
	~"bmz/bmz.h
"

26 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

27 
usšg
 
Çme¥aû
 
	g¡d
;

28 
usšg
 
Çme¥aû
 
	gboo¡
;

30 
	gBlockCom´essiÚCodecBmz
::
	$BlockCom´essiÚCodecBmz
(cÚ¡ 
Args
 &
¬gs
) :

31 
	$m_wÜkmem
(0) {

32 
	`HT_EXPECT
(
	`bmz_š™
(è=ğ
BMZ_E_OK
, 
E¼Ü
::
BLOCK_COMPRESSOR_INIT_ERROR
);

34 
m_off£t
 = 0;

35 
m_å_Ën
 = 19;

36 
	`£t_¬gs
(
¬gs
);

37 
	}
}

39 
	gBlockCom´essiÚCodecBmz
::~
	$BlockCom´essiÚCodecBmz
() {

40 
	`HT_ASSERT_SAME_THREAD
(
m_ü—tÜ_th»ad
);

41 
	}
}

43 
	#_NEXT_ARG
(
_code_
) do { \

44 ++
™
; \

45 
	`HT_EXPECT
(
™
 !ğ
¬g_’d
, 
E¼Ü
::
BLOCK_COMPRESSOR_INVALID_ARG
); \

46 
_code_
; \

47 } 0)

	)

50 
	gBlockCom´essiÚCodecBmz
::
	$£t_¬gs
(cÚ¡ 
Args
 &
¬gs
) {

51 
Args
::
cÚ¡_™”©Ü
 
™
 = 
¬gs
.
	`begš
(), 
¬g_’d
 =‡rgs.
	`’d
();

53 ; 
™
 !ğ
¬g_’d
; ++it) {

54 ià(*
™
 == "--fp-len")

55 
	`_NEXT_ARG
(
m_å_Ën
 = 
	`©oi
((*
™
).
	`c_¡r
()));

56 ià(*
™
 == "--offset")

57 
	`_NEXT_ARG
(
m_off£t
 = 
	`©oi
((*
™
).
	`c_¡r
()));

58 
	`HT_ERRORF
("unknowÀbmz com´essÜ‡rgum’t: %s", (*
™
).
	`c_¡r
());

60  
E¼Ü
::
OK
;

61 
	}
}

64 
	gBlockCom´essiÚCodecBmz
::
	$deæ©e
(cÚ¡ 
DyÇmicBufãr
 &
šput
,

65 
DyÇmicBufãr
 &
ouut
,

66 
BlockCom´essiÚH—d”
 &
h—d”
,

67 
size_t
 
»£rve
) {

68 
size_t
 
šËn
 = 
šput
.
	`fl
();

69 
size_t
 
h—d”Ën
 = 
h—d”
.
	`’coded_Ëngth
();

70 
size_t
 
ou’
 = 
	`bmz_·ck_buæ’
(
šËn
);

72 
ouut
.
	`»£rve
(
ou’
 + 
h—d”Ën
 + 
»£rve
);

73 
m_wÜkmem
.
	`»£rve
(
	`bmz_·ck_wÜkËn
(
šËn
, 
m_å_Ën
), 
Œue
);

75 
	`HT_EXPECT
(
	`bmz_·ck
(
šput
.
buf
, 
šËn
, 
ouut
.buà+ 
h—d”Ën
, &
ou’
,

76 
m_off£t
, 
m_å_Ën
, 0, 
m_wÜkmem
.
buf
è=ğ
BMZ_E_OK
,

77 
E¼Ü
::
BLOCK_COMPRESSOR_DEFLATE_ERROR
);

80 ià(
ou’
 >ğ
šËn
) {

81 
h—d”
.
	`£t_ty³
(
NONE
);

82 
	`memıy
(
ouut
.
buf
 + 
h—d”Ën
, 
šput
.buf, 
šËn
);

83 
h—d”
.
	`£t_Ëngth
(
šËn
);

84 
h—d”
.
	`£t_zËngth
(
šËn
);

87 
h—d”
.
	`£t_ty³
(
BMZ
);

88 
h—d”
.
	`£t_Ëngth
(
šËn
);

89 
h—d”
.
	`£t_zËngth
(
ou’
);

91 
h—d”
.
	`£t_checksum
(
	`æ‘ch”32
(
ouut
.
buf
 + 
h—d”Ën
, h—d”.
	`g‘_zËngth
()));

93 
ouut
.
±r
 = ouut.
buf
;

94 
h—d”
.
	`’code
(&
ouut
.
±r
);

95 
ouut
.
±r
 +ğ
h—d”
.
	`g‘_zËngth
();

97  
E¼Ü
::
OK
;

98 
	}
}

101 
	gBlockCom´essiÚCodecBmz
::
	$šæ©e
(cÚ¡ 
DyÇmicBufãr
 &
šput
,

102 
DyÇmicBufãr
 &
ouut
,

103 
BlockCom´essiÚH—d”
 &
h—d”
) {

104 
ušt8_t
 *

 = 
šput
.
buf
;

105 
size_t
 
»maš
 = 
šput
.
	`fl
();

107 
	`HT_EXPECT
(
h—d”
.
	`decode
(&

, &
»maš
è=ğ
E¼Ü
::
OK
,

108 
E¼Ü
::
BLOCK_COMPRESSOR_BAD_HEADER
);

109 
	`HT_EXPECT
(
h—d”
.
	`g‘_zËngth
(è=ğ
»maš
,

110 
E¼Ü
::
BLOCK_COMPRESSOR_BAD_HEADER
);

111 
	`HT_EXPECT
(
h—d”
.
	`g‘_checksum
(è=ğ
	`æ‘ch”32
(

, 
»maš
),

112 
E¼Ü
::
BLOCK_COMPRESSOR_CHECKSUM_MISMATCH
);

114 
size_t
 
ou’
 = 
h—d”
.
	`g‘_Ëngth
();

116 ià(
h—d”
.
	`g‘_ty³
(è=ğ
NONE
)

117 
	`memıy
(
ouut
.
buf
, 

, 
ou’
);

119 
ouut
.
	`»£rve
(
ou’
);

120 
m_wÜkmem
.
	`»£rve
(
	`bmz_uÅack_wÜkËn
(
ou’
), 
Œue
);

122 
	`HT_EXPECT
(
	`bmz_uÅack
(

, 
h—d”
.
	`g‘_zËngth
(), 
ouut
.
buf
, &
ou’
,

123 
m_wÜkmem
.
buf
è=ğ
BMZ_E_OK
,

124 
E¼Ü
::
BLOCK_COMPRESSOR_INFLATE_ERROR
);

125 
	`HT_EXPECT
(
ou’
 =ğ
h—d”
.
	`g‘_Ëngth
(),

126 
E¼Ü
::
BLOCK_COMPRESSOR_INFLATE_ERROR
);

128 
ouut
.
±r
 = ouut.
buf
 + 
ou’
;

130  
E¼Ü
::
OK
;

131 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/BlockCompressionCodecBmz.h

20 #iâdeà
HYPERTABLE_BLOCKCOMPRESSIONCODECBMZ_H


21 
	#HYPERTABLE_BLOCKCOMPRESSIONCODECBMZ_H


	)

23 
	~"CommÚ/DyÇmicBufãr.h
"

24 
	~"BlockCom´essiÚCodec.h
"

26 
Çme¥aû
 
	gHy³¹abË
 {

28 şas 
	cBlockCom´essiÚCodecBmz
 : 
public
 
BlockCom´essiÚCodec
 {

29 
public
:

30 
BlockCom´essiÚCodecBmz
(cÚ¡ 
Args
 &
¬gs
);

31 
	gvœtu®
 ~
BlockCom´essiÚCodecBmz
();

33 
vœtu®
 
£t_¬gs
(cÚ¡ 
Args
 &
¬gs
);

34 
vœtu®
 
deæ©e
(cÚ¡ 
DyÇmicBufãr
 &
šput
, DyÇmicBufã¸&
ouut
,

35 
BlockCom´essiÚH—d”
 &
h—d”
, 
size_t
 
»£rve
=0);

36 
vœtu®
 
šæ©e
(cÚ¡ 
DyÇmicBufãr
 &
šput
, DyÇmicBufã¸&
ouut
,

37 
BlockCom´essiÚH—d”
 &
h—d”
);

38 
vœtu®
 
g‘_ty³
(è{  
	gBMZ
; }

40 
	g´iv©e
:

41 
DyÇmicBufãr
 
m_wÜkmem
;

42 
size_t
 
	gm_off£t
;

43 
size_t
 
	gm_å_Ën
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/BlockCompressionCodecLzo.cc

21 
	~"CommÚ/DyÇmicBufãr.h
"

22 
	~"CommÚ/E¼Ü.h
"

23 
	~"CommÚ/Logg”.h
"

24 
	~"CommÚ/Checksum.h
"

26 
	~"lzo/mšzo.h
"

27 
	~"BlockCom´essiÚCodecLzo.h
"

29 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

35 
	gBlockCom´essiÚCodecLzo
::
	$BlockCom´essiÚCodecLzo
(cÚ¡ 
Args
 &
¬gs
) {

36 ià(
	`lzo_š™
(è!ğ
LZO_E_OK
)

37 
throw
 
	`Exû±iÚ
(
E¼Ü
::
BLOCK_COMPRESSOR_INIT_ERROR
, "Problem initializing†zo†ibrary");

38 
m_wÜkmem
 = 
Ãw
 
ušt8_t
 [ 
LZO1X_1_MEM_COMPRESS
 ];

39 
	}
}

45 
	gBlockCom´essiÚCodecLzo
::~
	$BlockCom´essiÚCodecLzo
() {

46 
	`HT_ASSERT_SAME_THREAD
(
m_ü—tÜ_th»ad
);

47 
d–‘e
 [] 
m_wÜkmem
;

48 
	}
}

55 
	gBlockCom´essiÚCodecLzo
::
	$deæ©e
(cÚ¡ 
DyÇmicBufãr
 &
šput
, DyÇmicBufã¸&
ouut
, 
BlockCom´essiÚH—d”
 &
h—d”
, 
size_t
 
»£rve
) {

56 
ušt32_t
 
ava_out
 = (
šput
.
	`fl
() + input.fill() / 16 + 64 + 3);

57 
»t
;

58 
lzo_ušt
 
out_Ën
 = 
ava_out
;

60 
ouut
.
	`ş—r
();

61 
ouut
.
	`»£rve
Ğ
h—d”
.
	`’coded_Ëngth
(è+ 
ava_out
 + 
»£rve
 );

63 
»t
 = 
	`lzo1x_1_com´ess
(
šput
.
buf
, iÅut.
	`fl
(), 
ouut
.buf+
h—d”
.
	`’coded_Ëngth
(), &
out_Ën
, 
m_wÜkmem
);

64 
	`as£¹
(
»t
 =ğ
LZO_E_OK
);

67 ià(
out_Ën
 >ğ
šput
.
	`fl
()) {

68 
h—d”
.
	`£t_ty³
(
NONE
);

69 
	`memıy
(
ouut
.
buf
+
h—d”
.
	`’coded_Ëngth
(), 
šput
.buf, iÅut.
	`fl
());

70 
h—d”
.
	`£t_Ëngth
(
šput
.
	`fl
());

71 
h—d”
.
	`£t_zËngth
(
šput
.
	`fl
());

74 
h—d”
.
	`£t_ty³
(
LZO
);

75 
h—d”
.
	`£t_Ëngth
(
šput
.
	`fl
());

76 
h—d”
.
	`£t_zËngth
(
out_Ën
);

78 
h—d”
.
	`£t_checksum
(
	`æ‘ch”32
(
ouut
.
buf
 + h—d”.
	`’coded_Ëngth
(), h—d”.
	`g‘_zËngth
()) );

80 
ouut
.
±r
 = ouut.
buf
;

81 
h—d”
.
	`’code
(&
ouut
.
±r
);

82 
ouut
.
±r
 +ğ
h—d”
.
	`g‘_zËngth
();

84  
E¼Ü
::
OK
;

85 
	}
}

91 
	gBlockCom´essiÚCodecLzo
::
	$šæ©e
(cÚ¡ 
DyÇmicBufãr
 &
šput
, DyÇmicBufã¸&
ouut
, 
BlockCom´essiÚH—d”
 &
h—d”
) {

92 
»t
;

93 
”rÜ
;

94 
ušt8_t
 *
msg_±r
 = 
šput
.
buf
;

95 
size_t
 
»maššg
 = 
šput
.
	`fl
();

96 
lzo_ušt
 
Ãw_Ën
;

98 ià((
”rÜ
 = 
h—d”
.
	`decode_fixed
(&
msg_±r
, &
»maššg
)è!ğ
E¼Ü
::
OK
)

99  
”rÜ
;

101 ià((
”rÜ
 = 
h—d”
.
	`decode_v¬ŸbË
(&
msg_±r
, &
»maššg
)è!ğ
E¼Ü
::
OK
)

102  
”rÜ
;

104 ià(
h—d”
.
	`g‘_zËngth
(è!ğ
»maššg
) {

105 
	`HT_ERRORF
("Block decom´essiÚƒ¼Ü, h—d” zËngth = %d,‡ùu® = %d", 
h—d”
.
	`g‘_zËngth
(), 
»maššg
);

106  
E¼Ü
::
BLOCK_COMPRESSOR_BAD_HEADER
;

109 
ušt32_t
 
checksum
 = 
	`æ‘ch”32
(
msg_±r
, 
»maššg
);

110 ià(
checksum
 !ğ
h—d”
.
	`g‘_checksum
()) {

111 
	`HT_ERRORF
("Com´es£d block checksum mism©ch h—d”=%d, compu‹d=%d", 
h—d”
.
	`g‘_checksum
(), 
checksum
);

112  
E¼Ü
::
BLOCK_COMPRESSOR_CHECKSUM_MISMATCH
;

115 
ouut
.
	`»£rve
(
h—d”
.
	`g‘_Ëngth
());

118 ià(
h—d”
.
	`g‘_ty³
(è=ğ
NONE
)

119 
	`memıy
(
ouut
.
buf
, 
msg_±r
, 
h—d”
.
	`g‘_Ëngth
());

121 
Ãw_Ën
 = 
h—d”
.
	`g‘_Ëngth
();

122 
»t
 = 
	`lzo1x_decom´ess
(
msg_±r
, 
h—d”
.
	`g‘_zËngth
(), 
ouut
.
buf
, &
Ãw_Ën
, 0);

123 ià(
»t
 !ğ
LZO_E_OK
 || 
Ãw_Ën
 !ğ
h—d”
.
	`g‘_Ëngth
()) {

124 
	`HT_ERRORF
("LzØdecom´essiÚƒ¼Ü,„v® = %d", 
»t
);

125  
E¼Ü
::
BLOCK_COMPRESSOR_INFLATE_ERROR
;

128 
ouut
.
±r
 = ouut.
buf
 + 
h—d”
.
	`g‘_Ëngth
();

130  
E¼Ü
::
OK
;

131 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/BlockCompressionCodecLzo.h

21 #iâdeà
HYPERTABLE_BLOCKCOMPRESSIONCODECLZO_H


22 
	#HYPERTABLE_BLOCKCOMPRESSIONCODECLZO_H


	)

24 
	~"BlockCom´essiÚCodec.h
"

26 
Çme¥aû
 
	gHy³¹abË
 {

28 şas 
	cBlockCom´essiÚCodecLzo
 : 
public
 
BlockCom´essiÚCodec
 {

30 
public
:

31 
BlockCom´essiÚCodecLzo
(cÚ¡ 
Args
 &
¬gs
);

32 
	gvœtu®
 ~
BlockCom´essiÚCodecLzo
();

34 
vœtu®
 
deæ©e
(cÚ¡ 
DyÇmicBufãr
 &
šput
, DyÇmicBufã¸&
ouut
,

35 
BlockCom´essiÚH—d”
 &
h—d”
, 
size_t
 
»£rve
=0);

36 
vœtu®
 
šæ©e
(cÚ¡ 
DyÇmicBufãr
 &
šput
, DyÇmicBufã¸&
ouut
,

37 
BlockCom´essiÚH—d”
 &
h—d”
);

38 
vœtu®
 
g‘_ty³
(è{  
	gLZO
; }

40 
	g´iv©e
:

41 
ušt8_t
 *
m_wÜkmem
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/BlockCompressionCodecNone.cc

21 
	~"CommÚ/Checksum.h
"

22 
	~"CommÚ/DyÇmicBufãr.h
"

23 
	~"CommÚ/E¼Ü.h
"

24 
	~"CommÚ/Logg”.h
"

26 
	~"BlockCom´essiÚCodecNÚe.h
"

28 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

34 
	gBlockCom´essiÚCodecNÚe
::
	$BlockCom´essiÚCodecNÚe
(cÚ¡ 
Args
 &) {

35 
	}
}

42 
BlockCom´essiÚCodecNÚe
::
	$deæ©e
(cÚ¡ 
DyÇmicBufãr
 &
šput
, DyÇmicBufã¸&
ouut
, 
BlockCom´essiÚH—d”
 &
h—d”
, 
size_t
 
»£rve
) {

43 
ouut
.
	`ş—r
();

44 
ouut
.
	`»£rve
Ğ
h—d”
.
	`’coded_Ëngth
(è+ 
šput
.
	`fl
(è+ 
»£rve
 );

46 
h—d”
.
	`£t_ty³
(
NONE
);

47 
	`memıy
(
ouut
.
buf
+
h—d”
.
	`’coded_Ëngth
(), 
šput
.buf, iÅut.
	`fl
());

48 
h—d”
.
	`£t_Ëngth
(
šput
.
	`fl
());

49 
h—d”
.
	`£t_zËngth
(
šput
.
	`fl
());

50 
h—d”
.
	`£t_checksum
(
	`æ‘ch”32
(
ouut
.
buf
 + h—d”.
	`’coded_Ëngth
(), h—d”.
	`g‘_zËngth
()));

52 
ouut
.
±r
 = ouut.
buf
;

53 
h—d”
.
	`’code
(&
ouut
.
±r
);

54 
ouut
.
±r
 +ğ
h—d”
.
	`g‘_zËngth
();

56  
E¼Ü
::
OK
;

57 
	}
}

64 
	gBlockCom´essiÚCodecNÚe
::
	$šæ©e
(cÚ¡ 
DyÇmicBufãr
 &
šput
, DyÇmicBufã¸&
ouut
, 
BlockCom´essiÚH—d”
 &
h—d”
) {

66 
”rÜ
;

67 
ušt8_t
 *
msg_±r
 = 
šput
.
buf
;

68 
size_t
 
»maššg
 = 
šput
.
	`fl
();

70 ià((
”rÜ
 = 
h—d”
.
	`decode_fixed
(&
msg_±r
, &
»maššg
)è!ğ
E¼Ü
::
OK
)

71  
”rÜ
;

73 ià((
”rÜ
 = 
h—d”
.
	`decode_v¬ŸbË
(&
msg_±r
, &
»maššg
)è!ğ
E¼Ü
::
OK
)

74  
”rÜ
;

76 ià(
h—d”
.
	`g‘_zËngth
(è!ğ
»maššg
) {

77 
	`HT_ERRORF
("Block decom´essiÚƒ¼Ü, h—d” zËngth = %d,‡ùu® = %d", 
h—d”
.
	`g‘_zËngth
(), 
»maššg
);

78  
E¼Ü
::
BLOCK_COMPRESSOR_BAD_HEADER
;

81 
ušt32_t
 
checksum
 = 
	`æ‘ch”32
(
msg_±r
, 
»maššg
);

82 ià(
checksum
 !ğ
h—d”
.
	`g‘_checksum
()) {

83 
	`HT_ERRORF
("Com´es£d block checksum mism©ch h—d”=%d, compu‹d=%d", 
h—d”
.
	`g‘_checksum
(), 
checksum
);

84  
E¼Ü
::
BLOCK_COMPRESSOR_CHECKSUM_MISMATCH
;

87 
ouut
.
	`»£rve
(
h—d”
.
	`g‘_Ëngth
());

89 
	`memıy
(
ouut
.
buf
, 
msg_±r
, 
h—d”
.
	`g‘_Ëngth
());

90 
ouut
.
±r
 = ouut.
buf
 + 
h—d”
.
	`g‘_Ëngth
();

92  
E¼Ü
::
OK
;

93 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/BlockCompressionCodecNone.h

21 #iâdeà
HYPERTABLE_BLOCKCOMPRESSIONCODECNONE_H


22 
	#HYPERTABLE_BLOCKCOMPRESSIONCODECNONE_H


	)

24 
	~"BlockCom´essiÚCodec.h
"

26 
Çme¥aû
 
	gHy³¹abË
 {

28 şas 
	cBlockCom´essiÚCodecNÚe
 : 
public
 
BlockCom´essiÚCodec
 {

30 
public
:

31 
BlockCom´essiÚCodecNÚe
(cÚ¡ 
Args
 &
¬gs
);

32 
vœtu®
 
deæ©e
(cÚ¡ 
DyÇmicBufãr
 &
šput
, DyÇmicBufã¸&
ouut
,

33 
BlockCom´essiÚH—d”
 &
h—d”
, 
size_t
 
»£rve
=0);

34 
vœtu®
 
šæ©e
(cÚ¡ 
DyÇmicBufãr
 &
šput
, DyÇmicBufã¸&
ouut
,

35 
BlockCom´essiÚH—d”
 &
h—d”
);

36 
vœtu®
 
g‘_ty³
(è{  
	gNONE
; }

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/BlockCompressionCodecQuicklz.cc

21 
	~"CommÚ/Checksum.h
"

22 
	~"CommÚ/Th»ad.h
"

23 
	~"CommÚ/DyÇmicBufãr.h
"

24 
	~"CommÚ/E¼Ü.h
"

25 
	~"CommÚ/Logg”.h
"

27 
	~"BlockCom´essiÚCodecQuicklz.h
"

29 
	~"quicklz.c
"

31 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

36 
	gBlockCom´essiÚCodecQuicklz
::
	$BlockCom´essiÚCodecQuicklz
(cÚ¡ 
Args
 &
¬gs
) {

37 
size_t
 
amouÁ
 = ((
SCRATCH_DECOMPRESS
è< (
SCRATCH_COMPRESS
)) ? (SCRATCH_COMPRESS) : (SCRATCH_DECOMPRESS);

38 
m_wÜkmem
 = 
Ãw
 
ušt8_t
 [ 
amouÁ
 ];

39 
	}
}

45 
	gBlockCom´essiÚCodecQuicklz
::~
	$BlockCom´essiÚCodecQuicklz
() {

46 
	`HT_ASSERT_SAME_THREAD
(
m_ü—tÜ_th»ad
);

47 
d–‘e
 [] 
m_wÜkmem
;

48 
	}
}

55 
	gBlockCom´essiÚCodecQuicklz
::
	$deæ©e
(cÚ¡ 
DyÇmicBufãr
 &
šput
, DyÇmicBufã¸&
ouut
, 
BlockCom´essiÚH—d”
 &
h—d”
, 
size_t
 
»£rve
) {

56 
ušt32_t
 
ava_out
 = 
šput
.
	`fl
() + 400;

57 
size_t
 
Ën
;

59 
ouut
.
	`ş—r
();

60 
ouut
.
	`»£rve
Ğ
h—d”
.
	`’coded_Ëngth
(è+ 
ava_out
 + 
»£rve
 );

63 
Ën
 = 
	`qlz_com´ess
((*)
šput
.
buf
, (*)
ouut
.buf+
h—d”
.
	`’coded_Ëngth
(), iÅut.
	`fl
(), (*)
m_wÜkmem
);

66 ià(
Ën
 >ğ
šput
.
	`fl
()) {

67 
h—d”
.
	`£t_ty³
(
NONE
);

68 
	`memıy
(
ouut
.
buf
+
h—d”
.
	`’coded_Ëngth
(), 
šput
.buf, iÅut.
	`fl
());

69 
h—d”
.
	`£t_Ëngth
(
šput
.
	`fl
());

70 
h—d”
.
	`£t_zËngth
(
šput
.
	`fl
());

73 
h—d”
.
	`£t_ty³
(
QUICKLZ
);

74 
h—d”
.
	`£t_Ëngth
(
šput
.
	`fl
());

75 
h—d”
.
	`£t_zËngth
(
Ën
);

77 
h—d”
.
	`£t_checksum
(
	`æ‘ch”32
(
ouut
.
buf
 + h—d”.
	`’coded_Ëngth
(), h—d”.
	`g‘_zËngth
()));

79 
ouut
.
±r
 = ouut.
buf
;

80 
h—d”
.
	`’code
(&
ouut
.
±r
);

81 
ouut
.
±r
 +ğ
h—d”
.
	`g‘_zËngth
();

83  
E¼Ü
::
OK
;

84 
	}
}

90 
	gBlockCom´essiÚCodecQuicklz
::
	$šæ©e
(cÚ¡ 
DyÇmicBufãr
 &
šput
, DyÇmicBufã¸&
ouut
, 
BlockCom´essiÚH—d”
 &
h—d”
) {

91 
”rÜ
;

92 
ušt8_t
 *
msg_±r
 = 
šput
.
buf
;

93 
size_t
 
»maššg
 = 
šput
.
	`fl
();

95 ià((
”rÜ
 = 
h—d”
.
	`decode_fixed
(&
msg_±r
, &
»maššg
)è!ğ
E¼Ü
::
OK
)

96  
”rÜ
;

98 ià((
”rÜ
 = 
h—d”
.
	`decode_v¬ŸbË
(&
msg_±r
, &
»maššg
)è!ğ
E¼Ü
::
OK
)

99  
”rÜ
;

101 ià(
h—d”
.
	`g‘_zËngth
(è!ğ
»maššg
) {

102 
	`HT_ERRORF
("Block decom´essiÚƒ¼Ü, h—d” zËngth = %d,‡ùu® = %d", 
h—d”
.
	`g‘_zËngth
(), 
»maššg
);

103  
E¼Ü
::
BLOCK_COMPRESSOR_BAD_HEADER
;

106 
ušt32_t
 
checksum
 = 
	`æ‘ch”32
(
msg_±r
, 
»maššg
);

107 ià(
checksum
 !ğ
h—d”
.
	`g‘_checksum
()) {

108 
	`HT_ERRORF
("Com´es£d block checksum mism©ch h—d”=%d, compu‹d=%d", 
h—d”
.
	`g‘_checksum
(), 
checksum
);

109  
E¼Ü
::
BLOCK_COMPRESSOR_CHECKSUM_MISMATCH
;

112 
ouut
.
	`»£rve
(
h—d”
.
	`g‘_Ëngth
());

115 ià(
h—d”
.
	`g‘_ty³
(è=ğ
NONE
)

116 
	`memıy
(
ouut
.
buf
, 
msg_±r
, 
h—d”
.
	`g‘_Ëngth
());

118 
size_t
 
Ën
;

120 
Ën
 = 
	`qlz_decom´ess
((*)
msg_±r
, (*)
ouut
.
buf
, (*)
m_wÜkmem
);

121 
	`as£¹
(
Ën
 =ğ
h—d”
.
	`g‘_Ëngth
());

123 
ouut
.
±r
 = ouut.
buf
 + 
h—d”
.
	`g‘_Ëngth
();

125  
E¼Ü
::
OK
;

126 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/BlockCompressionCodecQuicklz.h

21 #iâdeà
HYPERTABLE_BLOCKCOMPRESSIONCODECQUICKLZ_H


22 
	#HYPERTABLE_BLOCKCOMPRESSIONCODECQUICKLZ_H


	)

24 
	~"BlockCom´essiÚCodec.h
"

26 
Çme¥aû
 
	gHy³¹abË
 {

28 şas 
	cBlockCom´essiÚCodecQuicklz
 : 
public
 
BlockCom´essiÚCodec
 {

30 
public
:

31 
BlockCom´essiÚCodecQuicklz
(cÚ¡ 
Args
 &
¬gs
);

32 
	gvœtu®
 ~
BlockCom´essiÚCodecQuicklz
();

34 
vœtu®
 
deæ©e
(cÚ¡ 
DyÇmicBufãr
 &
šput
, DyÇmicBufã¸&
ouut
,

35 
BlockCom´essiÚH—d”
 &
h—d”
, 
size_t
 
»£rve
=0);

36 
vœtu®
 
šæ©e
(cÚ¡ 
DyÇmicBufãr
 &
šput
, DyÇmicBufã¸&
ouut
,

37 
BlockCom´essiÚH—d”
 &
h—d”
);

38 
vœtu®
 
g‘_ty³
(è{  
	gQUICKLZ
; }

40 
	g´iv©e
:

41 
ušt8_t
 *
m_wÜkmem
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/BlockCompressionCodecZlib.cc

21 
	~"CommÚ/DyÇmicBufãr.h
"

22 
	~"CommÚ/Logg”.h
"

23 
	~"CommÚ/Checksum.h
"

25 
	~"BlockCom´essiÚCodecZlib.h
"

27 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

33 
	gBlockCom´essiÚCodecZlib
::
	$BlockCom´essiÚCodecZlib
(cÚ¡ 
Args
 &
¬gs
è: 
	`m_šæ©e_š™Ÿlized
(
çl£
), 
	`m_deæ©e_š™Ÿlized
(çl£), 
	$m_Ëv–
(
Z_BEST_SPEED
) {

34 ià(!
¬gs
.
	`em±y
())

35 
	`£t_¬gs
(
¬gs
);

36 
	}
}

43 
	gBlockCom´essiÚCodecZlib
::~
	$BlockCom´essiÚCodecZlib
() {

44 
	`HT_ASSERT_SAME_THREAD
(
m_ü—tÜ_th»ad
);

45 ià(
m_deæ©e_š™Ÿlized
)

46 
	`deæ©eEnd
(&
m_¡»am_deæ©e
);

47 ià(
m_šæ©e_š™Ÿlized
)

48 
	`šæ©eEnd
(&
m_¡»am_šæ©e
);

49 
	}
}

53 
	gBlockCom´essiÚCodecZlib
::
	$£t_¬gs
(cÚ¡ 
Args
 &
¬gs
) {

54 
Args
::
cÚ¡_™”©Ü
 
™
 = 
¬gs
.
	`begš
(), 
¬g_’d
 =‡rgs.
	`’d
();

56 ; 
™
 !ğ
¬g_’d
; ++it) {

57 ià(*
™
 == "--best" || *it == "-9") {

58 
m_Ëv–
 = 
Z_BEST_COMPRESSION
;

59 ià(
m_deæ©e_š™Ÿlized
) {

60 
	`deæ©eEnd
(&
m_¡»am_deæ©e
);

61 
m_deæ©e_š™Ÿlized
 = 
çl£
;

64 ià(*
™
 == "--normal") {

65 
m_Ëv–
 = 
Z_DEFAULT_COMPRESSION
;

66 ià(
m_deæ©e_š™Ÿlized
) {

67 
	`deæ©eEnd
(&
m_¡»am_deæ©e
);

68 
m_deæ©e_š™Ÿlized
 = 
çl£
;

72 
	`HT_ERRORF
("UÄecognized‡rgum’ˆtØZlib codec: '%s'", (*
™
).
	`c_¡r
());

73  
E¼Ü
::
BLOCK_COMPRESSOR_INVALID_ARG
;

76  
E¼Ü
::
OK
;

77 
	}
}

84 
	gBlockCom´essiÚCodecZlib
::
	$deæ©e
(cÚ¡ 
DyÇmicBufãr
 &
šput
, DyÇmicBufã¸&
ouut
, 
BlockCom´essiÚH—d”
 &
h—d”
, 
size_t
 
»£rve
) {

85 
ušt32_t
 
ava_out
 = 
šput
.
	`fl
() + 6 + (((input.fill() / 16000) + 1 ) * 5);

87 ià(!
m_deæ©e_š™Ÿlized
) {

88 
	`mem£t
(&
m_¡»am_deæ©e
, 0, (m_stream_deflate));

89 
m_¡»am_deæ©e
.
z®loc
 = 
Z_NULL
;

90 
m_¡»am_deæ©e
.
zä“
 = 
Z_NULL
;

91 
m_¡»am_deæ©e
.
İaque
 = 
Z_NULL
;

92 
»t
 = 
	`deæ©eIn™
(&
m_¡»am_deæ©e
, 
m_Ëv–
);

93 
	`as£¹
(
»t
 =ğ
Z_OK
);

94 ()
»t
;

95 
m_deæ©e_š™Ÿlized
 = 
Œue
;

98 
ouut
.
	`ş—r
();

99 
ouut
.
	`»£rve
Ğ
h—d”
.
	`’coded_Ëngth
(è+ 
ava_out
 + 
»£rve
 );

101 
m_¡»am_deæ©e
.
ava_š
 = 
šput
.
	`fl
();

102 
m_¡»am_deæ©e
.
Ãxt_š
 = 
šput
.
buf
;

104 
m_¡»am_deæ©e
.
ava_out
 =‡vail_out;

105 
m_¡»am_deæ©e
.
Ãxt_out
 = 
ouut
.
buf
 + 
h—d”
.
	`’coded_Ëngth
();

107 
»t
 = ::
	`deæ©e
(&
m_¡»am_deæ©e
, 
Z_FINISH
);

108 
	`as£¹
(
»t
 =ğ
Z_STREAM_END
);

109 ()
»t
;

111 
ušt32_t
 
zËn
 = 
ava_out
 - 
m_¡»am_deæ©e
.avail_out;

114 ià(
zËn
 >ğ
šput
.
	`fl
()) {

115 
h—d”
.
	`£t_ty³
(
NONE
);

116 
	`memıy
(
ouut
.
buf
+
h—d”
.
	`’coded_Ëngth
(), 
šput
.buf, iÅut.
	`fl
());

117 
h—d”
.
	`£t_Ëngth
(
šput
.
	`fl
());

118 
h—d”
.
	`£t_zËngth
(
šput
.
	`fl
());

121 
h—d”
.
	`£t_ty³
(
ZLIB
);

122 
h—d”
.
	`£t_Ëngth
(
šput
.
	`fl
());

123 
h—d”
.
	`£t_zËngth
(
zËn
);

126 
h—d”
.
	`£t_checksum
Ğ
	`æ‘ch”32
(
ouut
.
buf
 + h—d”.
	`’coded_Ëngth
(), h—d”.
	`g‘_zËngth
()) );

128 
	`deæ©eRe£t
(&
m_¡»am_deæ©e
);

130 
ouut
.
±r
 = ouut.
buf
;

131 
h—d”
.
	`’code
(&
ouut
.
±r
);

132 
ouut
.
±r
 +ğ
h—d”
.
	`g‘_zËngth
();

134  
E¼Ü
::
OK
;

135 
	}
}

141 
	gBlockCom´essiÚCodecZlib
::
	$šæ©e
(cÚ¡ 
DyÇmicBufãr
 &
šput
, DyÇmicBufã¸&
ouut
, 
BlockCom´essiÚH—d”
 &
h—d”
) {

142 
»t
;

143 
”rÜ
;

144 
ušt8_t
 *
msg_±r
 = 
šput
.
buf
;

145 
size_t
 
»maššg
 = 
šput
.
	`fl
();

147 ià(!
m_šæ©e_š™Ÿlized
) {

148 
	`mem£t
(&
m_¡»am_šæ©e
, 0, (m_stream_inflate));

149 
m_¡»am_šæ©e
.
z®loc
 = 
Z_NULL
;

150 
m_¡»am_šæ©e
.
zä“
 = 
Z_NULL
;

151 
m_¡»am_šæ©e
.
İaque
 = 
Z_NULL
;

152 
m_¡»am_šæ©e
.
ava_š
 = 0;

153 
m_¡»am_šæ©e
.
Ãxt_š
 = 
Z_NULL
;

154 
»t
 = 
	`šæ©eIn™
(&
m_¡»am_šæ©e
);

155 
	`as£¹
(
»t
 =ğ
Z_OK
);

156 ()
»t
;

157 
m_šæ©e_š™Ÿlized
 = 
Œue
;

160 ià((
”rÜ
 = 
h—d”
.
	`decode_fixed
(&
msg_±r
, &
»maššg
)è!ğ
E¼Ü
::
OK
)

161  
”rÜ
;

163 ià((
”rÜ
 = 
h—d”
.
	`decode_v¬ŸbË
(&
msg_±r
, &
»maššg
)è!ğ
E¼Ü
::
OK
)

164  
”rÜ
;

166 ià(
h—d”
.
	`g‘_zËngth
(è!ğ
»maššg
) {

167 
	`HT_ERRORF
("Block decom´essiÚƒ¼Ü, h—d” zËngth = %d,‡ùu® = %d", 
h—d”
.
	`g‘_zËngth
(), 
»maššg
);

168  
E¼Ü
::
BLOCK_COMPRESSOR_BAD_HEADER
;

171 
ušt32_t
 
checksum
 = 
	`æ‘ch”32
(
msg_±r
, 
»maššg
);

172 ià(
checksum
 !ğ
h—d”
.
	`g‘_checksum
()) {

173 
	`HT_ERRORF
("Com´es£d block checksum mism©ch h—d”=%d, compu‹d=%d", 
h—d”
.
	`g‘_checksum
(), 
checksum
);

174  
E¼Ü
::
BLOCK_COMPRESSOR_CHECKSUM_MISMATCH
;

177 
ouut
.
	`»£rve
(
h—d”
.
	`g‘_Ëngth
());

180 ià(
h—d”
.
	`g‘_ty³
(è=ğ
NONE
)

181 
	`memıy
(
ouut
.
buf
, 
msg_±r
, 
h—d”
.
	`g‘_Ëngth
());

184 
m_¡»am_šæ©e
.
ava_š
 = 
»maššg
;

185 
m_¡»am_šæ©e
.
Ãxt_š
 = 
msg_±r
;

187 
m_¡»am_šæ©e
.
ava_out
 = 
h—d”
.
	`g‘_Ëngth
();

188 
m_¡»am_šæ©e
.
Ãxt_out
 = 
ouut
.
buf
;

190 
»t
 = ::
	`šæ©e
(&
m_¡»am_šæ©e
, 
Z_NO_FLUSH
);

191 ià(
»t
 !ğ
Z_STREAM_END
) {

192 
	`HT_ERRORF
("Com´es£d block inæ©”rÜ (»tuº v®uğ%d)", 
»t
);

193 
abÜt
;

196 ià(
m_¡»am_šæ©e
.
ava_out
 != 0) {

197 
	`HT_ERRORF
("Com´es£d block inæ©”rÜ,ƒx³ùed %d buˆÚly inæ©edØ%d by‹s", 
h—d”
.
	`g‘_Ëngth
(), h—d”.g‘_Ëngth()-
m_¡»am_šæ©e
.
ava_out
);

198 
abÜt
;

200 ::
	`šæ©eRe£t
(&
m_¡»am_šæ©e
);

203 
ouut
.
±r
 = ouut.
buf
 + 
h—d”
.
	`g‘_Ëngth
();

205  
E¼Ü
::
OK
;

207 
abÜt
:

208 ::
	`šæ©eRe£t
(&
m_¡»am_šæ©e
);

209 
ouut
.
	`ä“
();

210  
E¼Ü
::
BLOCK_COMPRESSOR_INFLATE_ERROR
;

211 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/BlockCompressionCodecZlib.h

21 #iâdeà
HYPERTABLE_BLOCKCOMPRESSIONCODECZLIB_H


22 
	#HYPERTABLE_BLOCKCOMPRESSIONCODECZLIB_H


	)

25 
	~<zlib.h
>

28 
	~"BlockCom´essiÚCodec.h
"

30 
Çme¥aû
 
Hy³¹abË
 {

32 şas 
	cBlockCom´essiÚCodecZlib
 : 
public
 
BlockCom´essiÚCodec
 {

34 
public
:

35 
BlockCom´essiÚCodecZlib
(cÚ¡ 
Args
 &
¬gs
);

36 
vœtu®
 ~
BlockCom´essiÚCodecZlib
();

38 
vœtu®
 
£t_¬gs
(cÚ¡ 
Args
 &
¬gs
);

39 
vœtu®
 
deæ©e
(cÚ¡ 
DyÇmicBufãr
 &
šput
, DyÇmicBufã¸&
ouut
,

40 
BlockCom´essiÚH—d”
 &
h—d”
, 
size_t
 
»£rve
=0);

41 
vœtu®
 
šæ©e
(cÚ¡ 
DyÇmicBufãr
 &
šput
, DyÇmicBufã¸&
ouut
,

42 
BlockCom´essiÚH—d”
 &
h—d”
);

43 
vœtu®
 
g‘_ty³
(è{  
ZLIB
; }

45 
´iv©e
:

46 
z_¡»am
 
m_¡»am_šæ©e
;

47 
boŞ
 
m_šæ©e_š™Ÿlized
;

48 
z_¡»am
 
m_¡»am_deæ©e
;

49 
boŞ
 
m_deæ©e_š™Ÿlized
;

50 
m_Ëv–
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/BlockCompressionHeader.h

21 #iâdeà
HYPERTABLE_BLOCKCOMPRESSIONHEADER_H


22 
	#HYPERTABLE_BLOCKCOMPRESSIONHEADER_H


	)

24 
	~<¡ršg.h
>

26 
Çme¥aû
 
	gHy³¹abË
 {

31 şas 
	cBlockCom´essiÚH—d”
 {

32 
	gpublic
:

33 
vœtu®
 ~
BlockCom´essiÚH—d”
() { ; }

35 
£t_magic
(cÚ¡ 
magic
[10]è{ 
memıy
(
m_magic
, magic, 10); }

36 
g‘_magic
(
magic
[10]è{ 
memıy
(magic, 
m_magic
, 10); }

37 
boŞ
 
check_magic
(cÚ¡ 
magic
[10]è{  !
memcmp
(magic, 
m_magic
, 10); }

39 
£t_Ëngth
(
ušt32_t
 
Ëngth
è{ 
	gm_Ëngth
 =†ength; }

40 
ušt32_t
 
g‘_Ëngth
(è{  
	gm_Ëngth
; }

42 
£t_zËngth
(
ušt32_t
 
zËngth
è{ 
	gm_zËngth
 = zlength; }

43 
ušt32_t
 
g‘_zËngth
(è{  
	gm_zËngth
; }

45 
£t_checksum
(
ušt32_t
 
checksum
è{ 
	gm_checksum
 = checksum; }

46 
ušt32_t
 
g‘_checksum
(è{  
	gm_checksum
; }

48 
£t_ty³
(
ušt16_t
 
ty³
è{ 
	gm_ty³
 =ype; }

49 
ušt16_t
 
g‘_ty³
(è{  
	gm_ty³
; }

51 
ušt16_t
 
g‘_h—d”_Ëngth
(è{  
	gm_h—d”_Ëngth
; }

53 
vœtu®
 
size_t
 
fixed_Ëngth
() = 0;

54 
vœtu®
 
size_t
 
’coded_Ëngth
() = 0;

55 
vœtu®
 
’code
(
ušt8_t
 **
buf_±r
) = 0;

56 
vœtu®
 
decode_fixed
(
ušt8_t
 **
buf_±r
, 
size_t
 *
»maššg_±r
) = 0;

57 
vœtu®
 
decode_v¬ŸbË
(
ušt8_t
 **
buf_±r
, 
size_t
 *
»maššg_±r
) = 0;

58 
vœtu®
 

59 
decode
(
ušt8_t
 **
bp
, 
size_t
 *
»mašp
) {

60 
	g»t
;

62 ià((
	g»t
 = 
decode_fixed
(
bp
, 
»mašp
)è!ğ
E¼Ü
::
OK
)

63  
»t
;

65 ià((
	g»t
 = 
decode_v¬ŸbË
(
bp
, 
»mašp
)è!ğ
E¼Ü
::
OK
)

66  
»t
;

68  
	gE¼Ü
::
OK
;

71 
	g´Ùeùed
:

72 
m_magic
[10];

73 
ušt32_t
 
	gm_Ëngth
;

74 
ušt32_t
 
	gm_zËngth
;

75 
ušt32_t
 
	gm_checksum
;

76 
ušt16_t
 
	gm_ty³
;

77 
ušt16_t
 
	gm_h—d”_Ëngth
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/BlockCompressionHeaderCommitLog.cc

21 
	~"CommÚ/E¼Ü.h
"

23 
	~"AsyncComm/S”Ÿliz©iÚ.h
"

25 
	~"BlockCom´essiÚH—d”Comm™Log.h
"

27 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

29 
	gBlockCom´essiÚH—d”Comm™Log
::
	$BlockCom´essiÚH—d”Comm™Log
() {

30 
m_Ëngth
 = 0;

31 
m_zËngth
 = 0;

32 
m_ty³
 = 0;

33 
m_checksum
 = 0;

34 
	`mem£t
(
m_magic
, 0, 10);

35 
m_time¡amp
 = 0;

36 
m_bËÇme
 = 0;

37 
m_h—d”_Ëngth
 = 0;

38 
	}
}

41 
	gBlockCom´essiÚH—d”Comm™Log
::
	$BlockCom´essiÚH—d”Comm™Log
(cÚ¡ 
magic
[10], 
ušt64_t
 
time¡amp
, cÚ¡ *
bËÇme
) {

42 
	`£t_magic
(
magic
);

43 
m_time¡amp
 = 
time¡amp
;

44 
m_bËÇme
 = 
bËÇme
;

45 
m_Ëngth
 = 0;

46 
m_zËngth
 = 0;

47 
m_ty³
 = 0;

48 
m_checksum
 = 0;

49 
	}
}

55 
	gBlockCom´essiÚH—d”Comm™Log
::
	$’code
(
ušt8_t
 **
buf_±r
) {

56 
m_h—d”_Ëngth
 = 
	`’coded_Ëngth
();

57 
	`memıy
(*
buf_±r
, 
m_magic
, 10);

58 (*
buf_±r
) += 10;

59 
S”Ÿliz©iÚ
::
	`’code_shÜt
(
buf_±r
, 
m_h—d”_Ëngth
);

60 
S”Ÿliz©iÚ
::
	`’code_št
(
buf_±r
, 
m_Ëngth
);

61 
S”Ÿliz©iÚ
::
	`’code_št
(
buf_±r
, 
m_zËngth
);

62 
S”Ÿliz©iÚ
::
	`’code_shÜt
(
buf_±r
, 
m_ty³
);

63 
S”Ÿliz©iÚ
::
	`’code_št
(
buf_±r
, 
m_checksum
);

64 
S”Ÿliz©iÚ
::
	`’code_lÚg
(
buf_±r
, 
m_time¡amp
);

65 ià(
m_bËÇme
) {

66 
	`¡rıy
((*)*
buf_±r
, 
m_bËÇme
);

67 (*
buf_±r
è+ğ
	`¡¾’
(
m_bËÇme
);

69 *(*
buf_±r
)++ = 0;

70 
	}
}

76 
	gBlockCom´essiÚH—d”Comm™Log
::
	$decode_fixed
(
ušt8_t
 **
buf_±r
, 
size_t
 *
»maššg_±r
) {

78 ià(*
»maššg_±r
 < 10)

79  
E¼Ü
::
BLOCK_COMPRESSOR_TRUNCATED
;

81 
	`memıy
(
m_magic
, *
buf_±r
, 10);

82 (*
buf_±r
) += 10;

83 *
»maššg_±r
 -= 10;

85 ià(!
S”Ÿliz©iÚ
::
	`decode_shÜt
(
buf_±r
, 
»maššg_±r
, &
m_h—d”_Ëngth
))

86  
E¼Ü
::
BLOCK_COMPRESSOR_TRUNCATED
;

88 ià(!
S”Ÿliz©iÚ
::
	`decode_št
(
buf_±r
, 
»maššg_±r
, &
m_Ëngth
))

89  
E¼Ü
::
BLOCK_COMPRESSOR_TRUNCATED
;

91 ià(!
S”Ÿliz©iÚ
::
	`decode_št
(
buf_±r
, 
»maššg_±r
, &
m_zËngth
))

92  
E¼Ü
::
BLOCK_COMPRESSOR_TRUNCATED
;

94 ià(!
S”Ÿliz©iÚ
::
	`decode_shÜt
(
buf_±r
, 
»maššg_±r
, &
m_ty³
))

95  
E¼Ü
::
BLOCK_COMPRESSOR_TRUNCATED
;

97 ià(!
S”Ÿliz©iÚ
::
	`decode_št
(
buf_±r
, 
»maššg_±r
, &
m_checksum
))

98  
E¼Ü
::
BLOCK_COMPRESSOR_TRUNCATED
;

100 ià(!
S”Ÿliz©iÚ
::
	`decode_lÚg
(
buf_±r
, 
»maššg_±r
, &
m_time¡amp
))

101  
E¼Ü
::
BLOCK_COMPRESSOR_TRUNCATED
;

103  
E¼Ü
::
OK
;

104 
	}
}

110 
	gBlockCom´essiÚH—d”Comm™Log
::
	$decode_v¬ŸbË
(
ušt8_t
 **
buf_±r
, 
size_t
 *
»maššg_±r
) {

111 
size_t
 
»maššg_h—d”
;

113 ià(
m_h—d”_Ëngth
 <ğ
	`fixed_Ëngth
())

114  
E¼Ü
::
BLOCK_COMPRESSOR_TRUNCATED
;

116 
»maššg_h—d”
 = 
m_h—d”_Ëngth
 - 
	`fixed_Ëngth
();

118 ià(*
»maššg_±r
 < 
»maššg_h—d”
)

119  
E¼Ü
::
BLOCK_COMPRESSOR_TRUNCATED
;

121 
m_bËÇme
 = (cÚ¡ *)*
buf_±r
;

123 ià(
m_bËÇme
[
»maššg_h—d”
-1] != 0)

124  
E¼Ü
::
BLOCK_COMPRESSOR_BAD_HEADER
;

126 (*
buf_±r
è+ğ
»maššg_h—d”
;

127 (*
»maššg_±r
è-ğ
»maššg_h—d”
;

129  
E¼Ü
::
OK
;

130 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/BlockCompressionHeaderCommitLog.h

21 #iâdeà
HYPERTABLE_BLOCKCOMPRESSIONHEADERCOMMITLOG_H


22 
	#HYPERTABLE_BLOCKCOMPRESSIONHEADERCOMMITLOG_H


	)

24 
	~"Hy³¹abË/Lib/BlockCom´essiÚH—d”.h
"

26 
Çme¥aû
 
	gHy³¹abË
 {

31 şas 
	cBlockCom´essiÚH—d”Comm™Log
 : 
public
 
BlockCom´essiÚH—d”
 {

32 
public
:

33 
BlockCom´essiÚH—d”Comm™Log
();

34 
BlockCom´essiÚH—d”Comm™Log
(cÚ¡ 
magic
[10], 
ušt64_t
 
time¡amp
, cÚ¡ *
bËÇme
);

36 
£t_time¡amp
(
ušt64_t
 
time¡amp
è{ 
	gm_time¡amp
 =imestamp; }

37 
ušt64_t
 
g‘_time¡amp
(è{  
	gm_time¡amp
; }

39 
£t_bËÇme
(cÚ¡ *
bËÇme
è{ 
	gm_bËÇme
 =ablename; }

40 cÚ¡ *
g‘_bËÇme
(è{  
	gm_bËÇme
; }

42 
vœtu®
 
size_t
 
fixed_Ëngth
() {  34; }

43 
vœtu®
 
size_t
 
’coded_Ëngth
(è{  
fixed_Ëngth
(è+ (
	gm_bËÇme
 ? 
¡¾’
(
m_bËÇme
) : 0) + 1; }

44 
vœtu®
 
’code
(
ušt8_t
 **
buf_±r
);

45 
vœtu®
 
decode_fixed
(
ušt8_t
 **
buf_±r
, 
size_t
 *
»maššg_±r
);

46 
vœtu®
 
decode_v¬ŸbË
(
ušt8_t
 **
buf_±r
, 
size_t
 *
»maššg_±r
);

48 
	g´iv©e
:

49 
ušt64_t
 
m_time¡amp
;

50 cÚ¡ *
	gm_bËÇme
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/Cell.h

21 #iâdeà
HYPERTABLE_CELL_H


22 
	#HYPERTABLE_CELL_H


	)

24 
Çme¥aû
 
	gHy³¹abË
 {

28 cÚ¡ *
	grow_key
;

29 cÚ¡ *
	gcŞumn_çmy
;

30 cÚ¡ *
	gcŞumn_qu®if›r
;

31 
ušt64_t
 
	gtime¡amp
;

32 cÚ¡ 
ušt8_t
 *
	gv®ue
;

33 
ušt64_t
 
	gv®ue_Ën
;

34 
ušt8_t
 
	gæag
;

35 } 
	tC–lT
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/Client.cc

21 
	~<ÿs£¹
>

24 
	~<pŞl.h
>

27 
	~"AsyncComm/Comm.h
"

28 
	~"AsyncComm/R—ùÜFaùÜy.h
"

30 
	~"CommÚ/E¼Ü.h
"

31 
	~"CommÚ/IÃtAddr.h
"

32 
	~"CommÚ/Logg”.h
"

33 
	~"CommÚ/Sy¡em.h
"

35 
	~"Hy³r¥aû/DœEÁry.h
"

37 
	~"Cl›Á.h
"

38 
	~"HqlCommªdIÁ”´‘”.h
"

40 
usšg
 
Çme¥aû
 
Hy³r¥aû
;

45 
	gCl›Á
::
Cl›Á
(cÚ¡ *
¬gv0
, 
¡d
::
¡ršg
 
cÚfig_fe
) {

46 
Sy¡em
::
š™Ÿlize
(
¬gv0
);

47 
	gR—ùÜFaùÜy
::
š™Ÿlize
((
ušt16_t
)
Sy¡em
::
g‘_´oûssÜ_couÁ
());

48 
š™Ÿlize
(
cÚfig_fe
);

51 
	gCl›Á
::
	$Cl›Á
(cÚ¡ *
¬gv0
) {

52 
Sy¡em
::
	`š™Ÿlize
(
¬gv0
);

53 
R—ùÜFaùÜy
::
	`š™Ÿlize
((
ušt16_t
)
Sy¡em
::
	`g‘_´oûssÜ_couÁ
());

54 
	`š™Ÿlize
Ğ
Sy¡em
::
š¡®lDœ
 + "/conf/hypertable.cfg" );

55 
	}
}

57 
	gCl›Á
::
š™Ÿlize
(
¡d
::
¡ršg
 
cÚfig_fe
) {

58 
time_t
 
ma¡”_timeout
;

60 
	gm_´İs_±r
 = 
Ãw
 
Prİ”t›s
(
cÚfig_fe
);

62 
	gm_comm
 = 
Ãw
 
Comm
();

63 
	gm_cÚn_mªag”_±r
 = 
Ãw
 
CÚÃùiÚMªag”
(
m_comm
);

65 
	gm_hy³r¥aû_±r
 = 
Ãw
 
Hy³r¥aû
::
SessiÚ
(
m_comm
, 
m_´İs_±r
);

66 !
	gm_hy³r¥aû_±r
->
wa™_fÜ_cÚÃùiÚ
(2)) {

67 
	gcout
 << "Wa™šg fÜ cÚÃùiÚØHy³r¥aû..." << 
	gæush
;

68 
pŞl
(0, 0, 5000);

69 
	gcout
 << 
	g’dl
 << 
	gæush
;

72 
	gm_­p_queue_±r
 = 
Ãw
 
AµliÿtiÚQueue
(1);

74 
	gma¡”_timeout
 = 
m_´İs_±r
->
g‘_št
("Hypertable.Master.Client.Timeout", 180);

76 
	gm_ma¡”_ş›Á_±r
 = 
Ãw
 
Ma¡”Cl›Á
(
m_cÚn_mªag”_±r
, 
m_hy³r¥aû_±r
, 
ma¡”_timeout
, 
m_­p_queue_±r
);

77 ià(
	gm_ma¡”_ş›Á_±r
->
š™Ÿ‹_cÚÃùiÚ
(0è!ğ
E¼Ü
::
OK
) {

78 
HT_ERROR
("Unableoƒstablish connection with Master,ƒxiting...");

79 
ex™
(1);

88 
	gCl›Á
::
ü—‹_bË
(
¡d
::
¡ršg
 
Çme
, std::¡ršg 
schema
) {

89  
m_ma¡”_ş›Á_±r
->
ü—‹_bË
(
Çme
.
c_¡r
(), 
schema
.c_str());

96 
	gCl›Á
::
İ’_bË
(
¡d
::
¡ršg
 
Çme
, 
TabËPŒ
 &
bËPŒ
) {

97 
TabË
 *
	gbË
;

98 
	gŒy
 {

99 
	gbË
 = 
Ãw
 
TabË
(
m_´İs_±r
, 
m_cÚn_mªag”_±r
, 
m_hy³r¥aû_±r
, 
Çme
);

101 
ÿtch
 (
Exû±iÚ
 &
e
) {

102  
	ge
.
code
();

104 
	gbËPŒ
 = 
bË
;

105  
	gE¼Ü
::
OK
;

112 
	gCl›Á
::
g‘_bË_id
(
¡d
::
¡ršg
 
Çme
, 
ušt32_t
 *
bË_idp
) {

113 
	g”rÜ
;

114 
	g¡d
::
¡ršg
 
bË_fe
 = (
¡d
::¡ršg)"/hy³¹abË/bËs/" + 
Çme
;

115 
DyÇmicBufãr
 
v®ue_buf
(0);

116 
HªdËC®lbackPŒ
 
	gnuÎHªdËC®lback
;

117 
ušt64_t
 
	ghªdË
;

122 ià((
	g”rÜ
 = 
m_hy³r¥aû_±r
->
İ’
(
bË_fe
.
c_¡r
(), 
OPEN_FLAG_READ
, 
nuÎHªdËC®lback
, &
hªdË
)è!ğ
E¼Ü
::
OK
)

123  
”rÜ
;

128 ià((
	g”rÜ
 = 
m_hy³r¥aû_±r
->
©Œ_g‘
(
hªdË
, "bË_id", 
v®ue_buf
)è!ğ
E¼Ü
::
OK
) {

129 
HT_ERRORF
("ProbËm g‘tšg‡‰ribu‹ 'bË_id' from f'%s'", 
bË_fe
.
c_¡r
());

130  
	g”rÜ
;

136 ià((
	g”rÜ
 = 
m_hy³r¥aû_±r
->
şo£
(
hªdË
)è!ğ
E¼Ü
::
OK
)

137  
”rÜ
;

139 
as£¹
(
v®ue_buf
.
fl
(è=ğ(
št32_t
));

141 
memıy
(
bË_idp
, 
v®ue_buf
.
buf
, (
št32_t
));

143  
	gE¼Ü
::
OK
;

150 
	gCl›Á
::
g‘_schema
(
¡d
::
¡ršg
 
bËName
, std::¡ršg &
schema
) {

151  
m_ma¡”_ş›Á_±r
->
g‘_schema
(
bËName
.
c_¡r
(), 
schema
);

158 
	gCl›Á
::
g‘_bËs
(
¡d
::
veùÜ
<¡d::
¡ršg
> &
bËs
) {

159 
”rÜ
;

160 
ušt64_t
 
	ghªdË
;

161 
HªdËC®lbackPŒ
 
	gnuÎHªdËC®lback
;

162 
	g¡d
::
veùÜ
<
Hy³r¥aû
::
DœEÁryT
> 
li¡šg
;

164 ià((
	g”rÜ
 = 
m_hy³r¥aû_±r
->
İ’
("/hy³¹abË/bËs", 
OPEN_FLAG_READ
, 
nuÎHªdËC®lback
, &
hªdË
)è!ğ
E¼Ü
::
OK
)

165  
”rÜ
;

167 ià((
	g”rÜ
 = 
m_hy³r¥aû_±r
->
»addœ
(
hªdË
, 
li¡šg
)è!ğ
E¼Ü
::
OK
)

168  
”rÜ
;

170 
size_t
 
	gi
=0; i<
	gli¡šg
.
size
(); i++) {

171 ià(!
	gli¡šg
[
i
].
	gisDœeùÜy
)

172 
	gbËs
.
push_back
(
li¡šg
[
i
].
Çme
);

175 
	gm_hy³r¥aû_±r
->
şo£
(
hªdË
);

177  
	gE¼Ü
::
OK
;

181 
	gCl›Á
::
drİ_bË
(
¡d
::
¡ršg
 
Çme
, 
boŞ
 
if_exi¡s
) {

182  
	gm_ma¡”_ş›Á_±r
->
drİ_bË
(
Çme
.
c_¡r
(), 
if_exi¡s
);

186 
HqlCommªdIÁ”´‘”
 *
	gCl›Á
::
	$ü—‹_hql_š‹½»‹r
() {

187  
Ãw
 
	`HqlCommªdIÁ”´‘”
(
this
);

188 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/Client.h

21 #iâdeà
HYPERTABLE_CLIENT_H


22 
	#HYPERTABLE_CLIENT_H


	)

24 
	~<¡ršg
>

26 
	~"CommÚ/Prİ”t›s.h
"

27 
	~"CommÚ/Reã»nûCouÁ.h
"

29 
	~"AsyncComm/AµliÿtiÚQueue.h
"

30 
	~"AsyncComm/CÚÃùiÚMªag”.h
"

31 
	~"Hy³r¥aû/SessiÚ.h
"

33 
	~"Ma¡”Cl›Á.h
"

34 
	~"TabË.h
"

37 
Çme¥aû
 
	gHy³¹abË
 {

39 
şass
 
	gComm
;

40 
şass
 
	gHqlCommªdIÁ”´‘”
;

42 şas 
	cCl›Á
 : 
public
 
Reã»nûCouÁ
 {

44 
public
:

46 
Cl›Á
(cÚ¡ *
¬gv0
, 
¡d
::
¡ršg
 
cÚfigFe
);

47 
Cl›Á
(cÚ¡ *
¬gv0
);

48 
š™Ÿlize
(
¡d
::
¡ršg
 
cÚfig_fe
);

49 
ü—‹_bË
(
¡d
::
¡ršg
 
Çme
, std::¡ršg 
schema
);

50 
İ’_bË
(
¡d
::
¡ršg
 
Çme
, 
TabËPŒ
 &
bËPŒ
);

51 
g‘_bË_id
(
¡d
::
¡ršg
 
Çme
, 
ušt32_t
 *
bË_idp
);

52 
g‘_schema
(
¡d
::
¡ršg
 
bËName
, std::¡ršg &
schema
);

53 
g‘_bËs
(
¡d
::
veùÜ
<¡d::
¡ršg
> &
bËs
);

54 
drİ_bË
(
¡d
::
¡ršg
 
Çme
, 
boŞ
 
if_exi¡s
);

56 
HqlCommªdIÁ”´‘”
 *
ü—‹_hql_š‹½»‹r
();

58 
	g´iv©e
:

59 
Prİ”t›sPŒ
 
m_´İs_±r
;

60 
Comm
 *
	gm_comm
;

61 
CÚÃùiÚMªag”PŒ
 
	gm_cÚn_mªag”_±r
;

62 
AµliÿtiÚQueuePŒ
 
	gm_­p_queue_±r
;

63 
	gHy³r¥aû
::
SessiÚPŒ
 
m_hy³r¥aû_±r
;

64 
Ma¡”Cl›ÁPŒ
 
	gm_ma¡”_ş›Á_±r
;

66 
	gboo¡
::
	tšŒusive_±r
<
	tCl›Á
> 
	tCl›ÁPŒ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/CommitLog.cc

21 
	~"CommÚ/DyÇmicBufãr.h
"

22 
	~"CommÚ/E¼Ü.h
"

23 
	~"CommÚ/Logg”.h
"

24 
	~"CommÚ/SŒšgExt.h
"

26 
	~"AsyncComm/Di¥©chHªdËrSynchrÚiz”.h
"

27 
	~"AsyncComm/PrÙocŞ.h
"

29 
	~"Hy³¹abË/Lib/Com´essÜFaùÜy.h
"

30 
	~"Hy³¹abË/Lib/BlockCom´essiÚH—d”Comm™Log.h
"

32 
	~"Comm™Log.h
"

34 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

36 cÚ¡ 
	gComm™Log
::
MAGIC_UPDATES
[10] = { 'L','O','G','U','P','D','A','T','E','S' };

37 cÚ¡ 
	gComm™Log
::
MAGIC_LINK
[10] = { 'L','O','G','L','I','N','K','-','-','-' };

38 cÚ¡ 
	gComm™Log
::
MAGIC_TRAILER
[10] = { 'L','O','G','T','R','A','I','L','E','R' };

44 
	gComm™Log
::
Comm™Log
(
Fesy¡em
 *
fs
, 
¡d
::
¡ršg
 &
log_dœ
, 
Prİ”t›sPŒ
 &
´İs_±r
è: 
m_fs
(fs), 
m_log_dœ
Öog_dœ), 
m_cur_log_Ëngth
(0), 
m_cur_log_num
(0), 
	$m_Ï¡_time¡amp
(0) {

45 
”rÜ
;

46 
¡d
::
¡ršg
 
com´essÜ
;

48 ià(
´İs_±r
) {

49 
m_max_fe_size
 = 
´İs_±r
->
	`g‘_št64
("Hypertable.RangeServer.CommitLog.RollLimit", 100000000LL);

50 
com´essÜ
 = 
´İs_±r
->
	`g‘
("Hypertable.RangeServer.CommitLog.Compressor", "lzo");

53 
m_max_fe_size
 = 268435456LL;

54 
com´essÜ
 = "lzo";

57 
	`HT_INFOF
("RŞlLim™ = %Îd", 
m_max_fe_size
);

59 
m_com´essÜ
 = 
Com´essÜFaùÜy
::
	`ü—‹_block_codec
(
com´essÜ
);

63 ià(
m_log_dœ
.
	`fšd
('/', m_log_dœ.
	`Ëngth
()-1è=ğ
¡ršg
::
Åos
)

64 
m_log_dœ
 += "/";

66 
m_log_fe
 = 
m_log_dœ
 + 
m_cur_log_num
;

69 
m_fs
->
	`mkdœs
(
m_log_dœ
);

71 ià((
”rÜ
 = 
m_fs
->
	`ü—‹
(
m_log_fe
, 
Œue
, 8192, 3, 67108864, &
m_fd
)è!ğ
E¼Ü
::
OK
) {

72 
	`HT_ERRORF
("ProbËm c»©šg comm™†og f'%s' - %s", 
m_log_fe
.
	`c_¡r
(), 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

73 
	`ex™
(1);

76 
	}
}

79 
	gComm™Log
::~
	$Comm™Log
() {

80 
d–‘e
 
m_com´essÜ
;

81 
	}
}

88 
ušt64_t
 
	gComm™Log
::
	$g‘_time¡amp
() {

89 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

90 
boo¡
::
xtime
 
now
;

91 
boo¡
::
	`xtime_g‘
(&
now
, boo¡::
TIME_UTC
);

92  ((
ušt64_t
)
now
.
£c
 * 1000000000LLè+ (ušt64_têow.
n£c
;

93 
	}
}

101 
	gComm™Log
::
	$wr™e
(cÚ¡ *
bË_Çme
, 
ušt8_t
 *
d©a
, 
ušt32_t
 
Ën
, 
ušt64_t
 
time¡amp
) {

102 
”rÜ
;

103 
BlockCom´essiÚH—d”Comm™Log
 
	`h—d”
(
MAGIC_UPDATES
, 
time¡amp
, 
bË_Çme
);

104 
DyÇmicBufãr
 
	`šput
(0);

106 
šput
.
buf
 = 
d©a
;

107 
šput
.
±r
 = 
d©a
 + 
Ën
;

112 ià((
”rÜ
 = 
	`com´ess_ªd_wr™e
(
šput
, &
h—d”
, 
time¡amp
)è!ğ
E¼Ü
::
OK
) {

113 
šput
.
	`»Ëa£
();

114  
”rÜ
;

117 
šput
.
	`»Ëa£
();

122 ià(
m_cur_log_Ëngth
 > 
m_max_fe_size
)

123 
”rÜ
 = 
	`rŞl
();

125 
”rÜ
 = 
E¼Ü
::
OK
;

127  
”rÜ
;

128 
	}
}

136 
	gComm™Log
::
	$lšk_log
(cÚ¡ *
bË_Çme
, cÚ¡ *
log_dœ
, 
ušt64_t
 
time¡amp
) {

137 
”rÜ
;

138 
BlockCom´essiÚH—d”Comm™Log
 
	`h—d”
(
MAGIC_LINK
, 
time¡amp
, 
bË_Çme
);

139 
DyÇmicBufãr
 
	`šput
(0);

144 ià((
”rÜ
 = 
	`rŞl
()è!ğ
E¼Ü
::
OK
)

145  
”rÜ
;

147 
šput
.
	`add
(
log_dœ
, 
	`¡¾’
(log_dir)+1);

152 ià((
”rÜ
 = 
	`com´ess_ªd_wr™e
(
šput
, &
h—d”
, 
time¡amp
)è!ğ
E¼Ü
::
OK
) {

153 
šput
.
	`»Ëa£
();

154  
”rÜ
;

157 
šput
.
	`»Ëa£
();

159  
E¼Ü
::
OK
;

160 
	}
}

167 
	gComm™Log
::
	$şo£
(
ušt64_t
 
time¡amp
) {

168 
”rÜ
;

169 
BlockCom´essiÚH—d”Comm™Log
 
	`h—d”
(
MAGIC_TRAILER
, 
time¡amp
, 0);

170 
DyÇmicBufãr
 
	`Œa”
(0);

172 
h—d”
.
	`£t_ty³
Ğ
m_com´essÜ
->
	`g‘_ty³
() );

174 
Œa”
.
	`’su»
(
h—d”
.
	`’coded_Ëngth
());

175 
h—d”
.
	`’code
(&
Œa”
.
±r
);

178 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

180 ià((
”rÜ
 = 
m_fs
->
	`­³nd
(
m_fd
, 
Œa”
.
buf
, 
h—d”
.
	`fixed_Ëngth
())è!ğ
E¼Ü
::
OK
) {

181 
	`HT_ERRORF
("Problem‡ppending %d byterailero commit†og file '%s' - %s",

182 
h—d”
.
	`fixed_Ëngth
(), 
m_log_fe
.
	`c_¡r
(), 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

183  
”rÜ
;

186 
Œa”
.
	`»Ëa£
();

188 ià((
”rÜ
 = 
m_fs
->
	`æush
(
m_fd
)è!ğ
E¼Ü
::
OK
) {

189 
	`HT_ERRORF
("ProbËm flushšg comm™†og f'%s' - %s", 
m_log_fe
.
	`c_¡r
(), 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

190  
”rÜ
;

193 ià((
”rÜ
 = 
m_fs
->
	`şo£
(
m_fd
)è!ğ
E¼Ü
::
OK
) {

194 
	`HT_ERRORF
("ProbËm closšg comm™†og f'%s' - %s", 
m_log_fe
.
	`c_¡r
(), 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

195  
”rÜ
;

198 
m_fd
 = 0;

201  
E¼Ü
::
OK
;

202 
	}
}

209 
	gComm™Log
::
	$purge
(
ušt64_t
 
time¡amp
) {

210 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

211 
Comm™LogFeInfoT
 
feInfo
;

212 
”rÜ
 = 
E¼Ü
::
OK
;

214 !
m_fe_šfo_queue
.
	`em±y
()) {

215 
feInfo
 = 
m_fe_šfo_queue
.
	`äÚt
();

216 ià(
feInfo
.
time¡amp
 > 0 && fileInfo.timestamp <imestamp) {

217 ià((
”rÜ
 = 
m_fs
->
	`»move
(
feInfo
.
âame
)è!ğ
E¼Ü
::
OK
 &&ƒ¼Ü !ğE¼Ü::
DFSBROKER_FILE_NOT_FOUND
) {

218 
	`HT_ERRORF
("ProbËm„emovšg†og f¿gm’ˆ'%s' - %s", 
feInfo
.
âame
.
	`c_¡r
(), 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

219  
”rÜ
;

221 
m_fe_šfo_queue
.
	`pİ_äÚt
();

222 
	`HT_INFOF
("Removed†og f¿gm’ˆfe='%s'ime¡amp=%Îd", 
feInfo
.
âame
.
	`c_¡r
(), feInfo.
time¡amp
);

229  
E¼Ü
::
OK
;

230 
	}
}

236 
	gComm™Log
::
	$rŞl
() {

237 
”rÜ
;

238 
Comm™LogFeInfoT
 
feInfo
;

239 
DyÇmicBufãr
 
	`Œa”
(0);

242 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

243 
BlockCom´essiÚH—d”Comm™Log
 
	`h—d”
(
MAGIC_TRAILER
, 
m_Ï¡_time¡amp
, 0);

245 
h—d”
.
	`£t_ty³
Ğ
m_com´essÜ
->
	`g‘_ty³
() );

247 
Œa”
.
	`’su»
(
h—d”
.
	`’coded_Ëngth
());

248 
h—d”
.
	`’code
(&
Œa”
.
±r
);

250 ià((
”rÜ
 = 
m_fs
->
	`­³nd
(
m_fd
, 
Œa”
.
buf
, 
h—d”
.
	`fixed_Ëngth
())è!ğ
E¼Ü
::
OK
) {

251 
	`HT_ERRORF
("ProbËm‡µ’dšg %d by‹ tØcomm™†og f'%s' - %s", 
Œa”
.
	`fl
(), 
m_log_fe
.
	`c_¡r
(), 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

252  
”rÜ
;

255 
Œa”
.
	`»Ëa£
();

257 ià((
”rÜ
 = 
m_fs
->
	`æush
(
m_fd
)è!ğ
E¼Ü
::
OK
) {

258 
	`HT_ERRORF
("ProbËm flushšg comm™†og f'%s' - %s", 
m_log_fe
.
	`c_¡r
(), 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

259  
”rÜ
;

262 ià((
”rÜ
 = 
m_fs
->
	`şo£
(
m_fd
)è!ğ
E¼Ü
::
OK
) {

263 
	`HT_ERRORF
("ProbËm closšg comm™†og f'%s' - %s", 
m_log_fe
.
	`c_¡r
(), 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

264  
”rÜ
;

267 
feInfo
.
time¡amp
 = 
m_Ï¡_time¡amp
;

268 
feInfo
.
size
 = 
m_cur_log_Ëngth
 + 
h—d”
.
	`fixed_Ëngth
();

269 
feInfo
.
âame
 = 
m_log_fe
;

270 
m_fe_šfo_queue
.
	`push_back
(
feInfo
);

272 
m_Ï¡_time¡amp
 = 0;

273 
m_cur_log_Ëngth
 = 0;

275 
m_cur_log_num
++;

276 
m_log_fe
 = 
m_log_dœ
 + 
m_cur_log_num
;

278 ià((
”rÜ
 = 
m_fs
->
	`ü—‹
(
m_log_fe
, 
Œue
, 8192, 3, 67108864, &
m_fd
)è!ğ
E¼Ü
::
OK
) {

279 
	`HT_ERRORF
("ProbËm c»©šg comm™†og f'%s' - %s", 
m_log_fe
.
	`c_¡r
(), 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

280  
”rÜ
;

284  
E¼Ü
::
OK
;

286 
	}
}

293 
	gComm™Log
::
	$com´ess_ªd_wr™e
(
DyÇmicBufãr
 &
šput
, 
BlockCom´essiÚH—d”
 *
h—d”
, 
ušt64_t
 
time¡amp
) {

294 
”rÜ
;

295 
Di¥©chHªdËrSynchrÚiz”
 
sync_hªdËr
;

296 
Ev’tPŒ
 
ev’t_±r
;

297 
DyÇmicBufãr
 
	`zblock
(0);

301 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

302 
size_t
 
zËn
;

304 ià((
”rÜ
 = 
m_com´essÜ
->
	`deæ©e
(
šput
, 
zblock
, *
h—d”
)è!ğ
E¼Ü
::
OK
)

305  
”rÜ
;

307 ià((
”rÜ
 = 
m_fs
->
	`­³nd
(
m_fd
, 
zblock
.
buf
, zblock.
	`fl
(), &
sync_hªdËr
)è!ğ
E¼Ü
::
OK
)

308  
”rÜ
;

310 
zblock
.
	`»Ëa£
(&
zËn
);

312 ià((
”rÜ
 = 
m_fs
->
	`æush
(
m_fd
, &
sync_hªdËr
)è!ğ
E¼Ü
::
OK
)

313  
”rÜ
;

315 
m_Ï¡_time¡amp
 = 
time¡amp
;

316 
m_cur_log_Ëngth
 +ğ
zËn
;

320 ià(!
sync_hªdËr
.
	`wa™_fÜ_»¶y
(
ev’t_±r
)) {

321 
	`HT_ERRORF
("Problem‡ppendingo commit†og file '%s' - %s",

322 
m_log_fe
.
	`c_¡r
(), 
PrÙocŞ
::
	`¡ršg_fÜm©_mes§ge
(
ev’t_±r
).c_str());

323 
”rÜ
 = ()
PrÙocŞ
::
	`»¥Ú£_code
(
ev’t_±r
);

327 ià(!
sync_hªdËr
.
	`wa™_fÜ_»¶y
(
ev’t_±r
)) {

328 
	`HT_ERRORF
("Problem flushing commit†og file '%s' - %s",

329 
m_log_fe
.
	`c_¡r
(), 
PrÙocŞ
::
	`¡ršg_fÜm©_mes§ge
(
ev’t_±r
).c_str());

330 
”rÜ
 = ()
PrÙocŞ
::
	`»¥Ú£_code
(
ev’t_±r
);

333  
”rÜ
;

334 
	}
}

340 
	gComm™Log
::
lßd_äagm’t_´iÜ™y_m­
(
¡d
::
m­
<
ušt64_t
, 
F¿gm’tPriÜ™yD©aT
> &
äag_m­
) {

341 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

342 
ušt64_t
 
	gcumuÏtive_tÙ®
 = 
m_cur_log_Ëngth
;

343 
ušt32_t
 
	gdi¡ªû
 = 0;

344 
F¿gm’tPriÜ™yD©aT
 
	gäag_d©a
;

346 
	gäag_d©a
.
	gdi¡ªû
 = 
di¡ªû
++;

347 
	gäag_d©a
.
	gcumuÏtive_size
 = 
cumuÏtive_tÙ®
;

348 
	gäag_m­
[
m_Ï¡_time¡amp
] = 
äag_d©a
;

350 
	gdeque
<
	gComm™LogFeInfoT
>::
»v”£_™”©Ü
 
™”
 = 
m_fe_šfo_queue
.
rbegš
(); 
	g™”
 !ğm_fe_šfo_queue.
»nd
(); iter++) {

351 
	gcumuÏtive_tÙ®
 +ğ(*
™”
).
size
;

352 
	gäag_d©a
.
	gdi¡ªû
 = 
di¡ªû
++;

353 
	gäag_d©a
.
	gcumuÏtive_size
 = 
cumuÏtive_tÙ®
;

354 
	gäag_m­
[(*
™”
).
time¡amp
] = 
äag_d©a
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/CommitLog.h

21 #iâdeà
HYPERTABLE_COMMITLOG_H


22 
	#HYPERTABLE_COMMITLOG_H


	)

24 
	~<deque
>

25 
	~<m­
>

26 
	~<¡ršg
>

28 
	~<boo¡/th»ad/xtime.hµ
>

31 
	~<sys/time.h
>

34 
	~<boo¡/th»ad/mu‹x.hµ
>

36 
	~"CommÚ/Prİ”t›s.h
"

37 
	~"CommÚ/Reã»nûCouÁ.h
"

39 
	~"Hy³¹abË/Lib/BlockCom´essiÚCodec.h
"

40 
	~"Hy³¹abË/Lib/Fesy¡em.h
"

42 
Çme¥aû
 
Hy³¹abË
 {

45 
¡d
::
¡ršg
 
âame
;

46 
ušt64_t
 
size
;

47 
ušt64_t
 
time¡amp
;

48 } 
	tComm™LogFeInfoT
;

51 
ušt32_t
 
di¡ªû
;

52 
ušt64_t
 
cumuÏtive_size
;

53 } 
	tF¿gm’tPriÜ™yD©aT
;

90 şas 
	cComm™Log
 : 
public
 
Reã»nûCouÁ
 {

91 
public
:

93 
Comm™Log
(
Fesy¡em
 *
fs
, 
¡d
::
¡ršg
 &
log_dœ
, 
Prİ”t›sPŒ
 &
´İs_±r
);

94 
vœtu®
 ~
Comm™Log
();

101 
ušt64_t
 
g‘_time¡amp
();

111 
wr™e
(cÚ¡ *
bË_Çme
, 
ušt8_t
 *
d©a
, 
ušt32_t
 
Ën
, 
ušt64_t
 
time¡amp
);

120 
lšk_log
(cÚ¡ *
bË_Çme
, cÚ¡ *
log_dœ
, 
ušt64_t
 
time¡amp
);

122 
şo£
(
ušt64_t
 
time¡amp
);

123 
purge
(
ušt64_t
 
time¡amp
);

124 
¡d
::
¡ršg
 &
g‘_log_dœ
(è{  
m_log_dœ
; }

126 
lßd_äagm’t_´iÜ™y_m­
(
¡d
::
m­
<
ušt64_t
, 
F¿gm’tPriÜ™yD©aT
> &
äag_m­
);

128 
št64_t
 
g‘_max_äagm’t_size
(è{  
m_max_fe_size
; }

130 cÚ¡ 
MAGIC_UPDATES
[10];

131 cÚ¡ 
MAGIC_LINK
[10];

132 cÚ¡ 
MAGIC_TRAILER
[10];

134 
´iv©e
:

136 
rŞl
();

137 
com´ess_ªd_wr™e
(
DyÇmicBufãr
 &
šput
, 
BlockCom´essiÚH—d”
 *
h—d”
, 
ušt64_t
 
time¡amp
);

139 
boo¡
::
mu‹x
 
m_mu‹x
;

140 
Fesy¡em
 *
m_fs
;

141 
BlockCom´essiÚCodec
 *
m_com´essÜ
;

142 
¡d
::
¡ršg
 
m_log_dœ
;

143 
¡d
::
¡ršg
 
m_log_fe
;

144 
št64_t
 
m_max_fe_size
;

145 
št64_t
 
m_cur_log_Ëngth
;

146 
ušt32_t
 
m_cur_log_num
;

147 
št32_t
 
m_fd
;

148 
ušt64_t
 
m_Ï¡_time¡amp
;

149 
¡d
::
deque
<
Comm™LogFeInfoT
> 
m_fe_šfo_queue
;

152 
boo¡
::
	tšŒusive_±r
<
	tComm™Log
> 
	tComm™LogPŒ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/CommitLogReader.cc

21 
	~<¡ršg
>

22 
	~<veùÜ
>

25 
	~<dœ’t.h
>

26 
	~<”ºo.h
>

27 
	~<lim™s.h
>

28 
	~<¡dlib.h
>

29 
	~<sys/¡©.h
>

30 
	~<sys/ty³s.h
>

31 
	~<sys/uio.h
>

32 
	~<uni¡d.h
>

35 
	~"CommÚ/E¼Ü.h
"

36 
	~"CommÚ/Logg”.h
"

38 
	~"Hy³¹abË/Lib/Com´essÜFaùÜy.h
"

39 
	~"Comm™Log.h
"

40 
	~"Comm™LogR—d”.h
"

42 
usšg
 
Çme¥aû
 
Hy³¹abË
;

43 
usšg
 
Çme¥aû
 
	g¡d
;

45 
	gÇme¥aû
 {

46 cÚ¡ 
ušt32_t
 
	gREADAHEAD_BUFFER_SIZE
 = 131072;

52 
	gComm™LogR—d”
::
Comm™LogR—d”
(
Fesy¡em
 *
fs
, 
¡d
::
¡ršg
 &
logDœ
è: 
m_fs
(fs), 
m_log_dœ
ÖogDœ), 
m_fd
(-1), 
m_block_bufãr
(256), 
m_zblock_bufãr
(256), 
m_”rÜ
(0), 
	$m_com´essÜ
(0) {

53 
LogFeInfoT
 
feInfo
;

54 
”rÜ
;

55 
št32_t
 
fd
;

56 
veùÜ
<
¡ršg
> 
li¡šg
;

57 
št64_t
 
æ’
;

58 
ušt32_t
 
Ä—d
;

59 
DyÇmicBufãr
 
	`šput
(0);

61 
	`HT_INFOF
("O³nšg comm™†og %s", 
logDœ
.
	`c_¡r
());

63 ià(
m_log_dœ
.
	`fšd
('/', m_log_dœ.
	`Ëngth
()-1è=ğ
¡ršg
::
Åos
)

64 
m_log_dœ
 += "/";

66 ià((
”rÜ
 = 
m_fs
->
	`»addœ
(
m_log_dœ
, 
li¡šg
)è!ğ
E¼Ü
::
OK
) {

67 
	`HT_ERRORF
("ProbËm„—dšg dœeùÜy '%s' - %s", 
m_log_dœ
.
	`c_¡r
(), 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

68 
	`ex™
(1);

71 
m_log_fe_šfo
.
	`ş—r
();

72 
feInfo
.
Œa”
.
	`£t_magic
(
Comm™Log
::
MAGIC_TRAILER
);

74 
size_t
 
i
=0; i<
li¡šg
.
	`size
(); i++) {

75 *
’d±r
;

76 
num
 = 
	`¡¹Ş
(
li¡šg
[
i
].
	`c_¡r
(), &
’d±r
, 10);

77 ià(*
’d±r
 != 0) {

78 
	`HT_WARNF
("Inv®id f'%s' found iÀcomm™†og dœeùÜy '%s'", 
li¡šg
[
i
].
	`c_¡r
(), 
m_log_dœ
.c_str());

81 
feInfo
.
num
 = (
ušt32_t
)num;

82 
feInfo
.
âame
 = 
m_log_dœ
 + 
li¡šg
[
i
];

83 
m_log_fe_šfo
.
	`push_back
(
feInfo
);

87 
	`sÜt
(
m_log_fe_šfo
.
	`begš
(), m_log_fe_šfo.
	`’d
());

89 
m_fixed_h—d”_Ëngth
 = 
feInfo
.
Œa”
.
	`fixed_Ëngth
();

90 
šput
.
	`’su»
Ğ
m_fixed_h—d”_Ëngth
 );

91 
m_zblock_bufãr
.
	`’su»
(
m_fixed_h—d”_Ëngth
);

93 
size_t
 
i
=0; i<
m_log_fe_šfo
.
	`size
(); i++) {

95 
m_log_fe_šfo
[
i
].
Œa”
.
	`£t_time¡amp
(0);

97 ià((
”rÜ
 = 
m_fs
->
	`Ëngth
(
m_log_fe_šfo
[
i
].
âame
, &
æ’
)è!ğ
E¼Ü
::
OK
) {

98 
	`HT_ERRORF
("ProbËmryšgØd‘”mšËngth oàcomm™†og f'%s' - %s", 
m_log_fe_šfo
[
i
].
âame
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

99 
	`ex™
(1);

102 ià(
æ’
 < (
št64_t
)
m_fixed_h—d”_Ëngth
)

105 ià((
”rÜ
 = 
m_fs
->
	`İ’
(
m_log_fe_šfo
[
i
].
âame
, &
fd
)è!ğ
E¼Ü
::
OK
) {

106 
	`HT_ERRORF
("ProbËm o³nšg comm™†og f'%s' - %s", 
m_log_fe_šfo
[
i
].
âame
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

107 
	`ex™
(1);

110 ià((
”rÜ
 = 
m_fs
->
	`´—d
(
fd
, 
æ’
-
m_fixed_h—d”_Ëngth
, m_fixed_h—d”_Ëngth, 
šput
.
buf
, &
Ä—d
)è!ğ
E¼Ü
::
OK
 ||

111 
Ä—d
 !ğ
m_fixed_h—d”_Ëngth
) {

112 
	`HT_ERRORF
("ProbËm„—dšg¿šg h—d” iÀcomm™†og f'%s' - %s", 
m_log_fe_šfo
[
i
].
âame
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

113 
	`ex™
(1);

116 ià((
”rÜ
 = 
m_fs
->
	`şo£
(
fd
)è!ğ
E¼Ü
::
OK
) {

117 
	`HT_ERRORF
("ProbËm closšg comm™†og f'%s' - %s", 
m_log_fe_šfo
[
i
].
âame
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

118 
	`ex™
(1);

121 
šput
.
±r
 = iÅut.
buf
;

123 
size_t
 
»maššg
 = 
Ä—d
;

124 
m_log_fe_šfo
[
i
].
Œa”
.
	`decode_fixed
(&
šput
.
±r
, &
»maššg
);

126 ià(
m_log_fe_šfo
[
i
].
Œa”
.
	`check_magic
(
Comm™Log
::
MAGIC_TRAILER
)) {

127 ià(
m_com´essÜ
 == 0) {

128 
m_com´essÜ
 = 
Com´essÜFaùÜy
::
	`ü—‹_block_codec
(

129 (
BlockCom´essiÚCodec
::
Ty³
)

130 
m_log_fe_šfo
[
i
].
Œa”
.
	`g‘_ty³
());

131 
m_gÙ_com´essÜ
 = 
Œue
;

135 
m_log_fe_šfo
[
i
].
Œa”
.
	`£t_time¡amp
(0);

136 
m_com´essÜ
 = 
Com´essÜFaùÜy
::
	`ü—‹_block_codec
(

137 
BlockCom´essiÚCodec
::
NONE
);

138 
m_gÙ_com´essÜ
 = 
çl£
;

143 
	}
}

146 
	gComm™LogR—d”
::~
	$Comm™LogR—d”
() {

147 
d–‘e
 
m_com´essÜ
;

148 
	}
}

151 
	gComm™LogR—d”
::
	$š™Ÿlize_»ad
(
ušt64_t
 
time¡amp
) {

152 
m_cutoff_time
 = 
time¡amp
;

153 
m_cur_log_off£t
 = 0;

154 
m_fd
 = -1;

155 
	}
}

159 
boŞ
 
	gComm™LogR—d”
::
	$Ãxt_block
(cÚ¡ 
ušt8_t
 **
blockp
, 
size_t
 *
ËÅ
, 
BlockCom´essiÚH—d”Comm™Log
 *
h—d”
) {

160 
size_t
 
»maššg
;

161 
size_t
 
tÜ—d
;

162 
ušt32_t
 
Ä—d
;

163 
ušt64_t
 
time¡amp
;

165 
Œy_agaš
:

167 ià(
m_fd
 == -1) {

169 
m_cur_log_off£t
 < 
m_log_fe_šfo
.
	`size
()) {

170 
time¡amp
 = 
m_log_fe_šfo
[
m_cur_log_off£t
].
Œa”
.
	`g‘_time¡amp
();

171 ià(
time¡amp
 =ğ0 ||ime¡am°>ğ
m_cutoff_time
)

173 
m_cur_log_off£t
++;

176 ià(
m_cur_log_off£t
 >ğ
m_log_fe_šfo
.
	`size
())

177  
çl£
;

179 ià((
m_”rÜ
 = 
m_fs
->
	`İ’_bufã»d
(
m_log_fe_šfo
[
m_cur_log_off£t
].
âame
, 
READAHEAD_BUFFER_SIZE
, 2, &
m_fd
)è!ğ
E¼Ü
::
OK
) {

180 
	`HT_ERRORF
("ProbËmryšgØİ’ comm™†og f'%s' - %s", 
m_log_fe_šfo
[
m_cur_log_off£t
].
âame
.
	`c_¡r
(), 
E¼Ü
::
	`g‘_‹xt
(
m_”rÜ
));

181  
çl£
;

185 
m_zblock_bufãr
.
±r
 = m_zblock_bufãr.
buf
;

187 ià((
m_”rÜ
 = 
m_fs
->
	`»ad
(
m_fd
, 
m_fixed_h—d”_Ëngth
, 
m_zblock_bufãr
.
±r
, &
Ä—d
)è!ğ
E¼Ü
::
OK
) {

188 
	`HT_ERRORF
("ProbËm„—dšg h—d” from comm™†og f'%s' - %s", 
m_log_fe_šfo
[
m_cur_log_off£t
].
âame
.
	`c_¡r
(), 
E¼Ü
::
	`g‘_‹xt
(
m_”rÜ
));

189  
çl£
;

192 ià(
Ä—d
 !ğ
m_fixed_h—d”_Ëngth
) {

193 
	`HT_ERRORF
("ShÜˆ»ad oàcomm™†og block '%s'", 
m_log_fe_šfo
[
m_cur_log_off£t
].
âame
.
	`c_¡r
());

194 ià((
m_”rÜ
 = 
m_fs
->
	`şo£
(
m_fd
)è!ğ
E¼Ü
::
OK
) {

195 
	`HT_ERRORF
("ProbËm closšg comm™†og f'%s' - %s", 
m_log_fe_šfo
[
m_cur_log_off£t
].
âame
.
	`c_¡r
(), 
E¼Ü
::
	`g‘_‹xt
(
m_”rÜ
));

196  
çl£
;

198 
m_fd
 = -1;

199 
m_cur_log_off£t
++;

200 
m_”rÜ
 = 
E¼Ü
::
RANGESERVER_TRUNCATED_COMMIT_LOG
;

201  
çl£
;

204 
»maššg
 = 
Ä—d
;

207 
h—d”
->
	`decode_fixed
(&
m_zblock_bufãr
.
±r
, &
»maššg
);

209 ià(
h—d”
->
	`check_magic
(
Comm™Log
::
MAGIC_TRAILER
)) {

211 ià((
m_”rÜ
 = 
m_fs
->
	`şo£
(
m_fd
)è!ğ
E¼Ü
::
OK
) {

212 
	`HT_ERRORF
("ProbËm closšg comm™†og f'%s' - %s", 
m_log_fe_šfo
[
m_cur_log_off£t
].
âame
.
	`c_¡r
(), 
E¼Ü
::
	`g‘_‹xt
(
m_”rÜ
));

213  
çl£
;

215 
m_fd
 = -1;

216 
m_cur_log_off£t
++;

217 
Œy_agaš
;

222 
tÜ—d
 = (
h—d”
->
	`g‘_zËngth
(è+ h—d”->
	`g‘_h—d”_Ëngth
()è- 
m_fixed_h—d”_Ëngth
;

226 
m_zblock_bufãr
.
	`’su»
(
tÜ—d
);

228 ià((
m_”rÜ
 = 
m_fs
->
	`»ad
(
m_fd
, 
tÜ—d
, 
m_zblock_bufãr
.
±r
, &
Ä—d
)è!ğ
E¼Ü
::
OK
) {

229 
	`HT_ERRORF
("ProbËm„—dšg comm™ block from comm™†og f'%s' - %s", 
m_log_fe_šfo
[
m_cur_log_off£t
].
âame
.
	`c_¡r
(), 
E¼Ü
::
	`g‘_‹xt
(
m_”rÜ
));

230  
çl£
;

233 ià(
Ä—d
 !ğ
tÜ—d
) {

234 
	`HT_ERRORF
("ShÜˆ»ad oàcomm™†og block '%s'", 
m_log_fe_šfo
[
m_cur_log_off£t
].
âame
.
	`c_¡r
());

235 ià((
m_”rÜ
 = 
m_fs
->
	`şo£
(
m_fd
)è!ğ
E¼Ü
::
OK
) {

236 
	`HT_ERRORF
("ProbËm closšg comm™†og f'%s' - %s", 
m_log_fe_šfo
[
m_cur_log_off£t
].
âame
.
	`c_¡r
(), 
E¼Ü
::
	`g‘_‹xt
(
m_”rÜ
));

237  
çl£
;

239 
m_fd
 = -1;

240 
m_”rÜ
 = 
E¼Ü
::
RANGESERVER_TRUNCATED_COMMIT_LOG
;

241  
çl£
;

244 
m_zblock_bufãr
.
±r
 +ğ
Ä—d
;

246 ià(!
m_gÙ_com´essÜ
 && 
h—d”
->
	`g‘_ty³
(è!ğ
BlockCom´essiÚCodec
::
NONE
) {

247 
d–‘e
 
m_com´essÜ
;

248 
m_com´essÜ
 = 
Com´essÜFaùÜy
::
	`ü—‹_block_codec
(

249 (
BlockCom´essiÚCodec
::
Ty³
)
h—d”
->
	`g‘_ty³
());

250 
m_gÙ_com´essÜ
 = 
Œue
;

256 ià((
m_”rÜ
 = 
m_com´essÜ
->
	`šæ©e
(
m_zblock_bufãr
, 
m_block_bufãr
, *
h—d”
)è!ğ
E¼Ü
::
OK
)

257  
çl£
;

259 *
blockp
 = 
m_block_bufãr
.
buf
;

260 *
ËÅ
 = 
m_block_bufãr
.
	`fl
();

262  
Œue
;

263 
	}
}

270 
	gComm™LogR—d”
::
	$dump_log_m‘ad©a
() {

271 
size_t
 
i
=0; i<
m_log_fe_šfo
.
	`size
(); i++)

272 
cout
 << "LOG FRAGMENT‚ame='" << 
m_log_fe_šfo
[
i
].
âame
 << "'ime¡amp=" << m_log_fe_šfo[i].
Œa”
.
	`g‘_time¡amp
(è<< 
’dl
;

273 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/CommitLogReader.h

20 #iâdeà
HYPERTABLE_COMMITLOGREADER_H


21 
	#HYPERTABLE_COMMITLOGREADER_H


	)

23 
	~<¡ršg
>

24 
	~<veùÜ
>

26 
	~<boo¡/th»ad/mu‹x.hµ
>

28 
	~"CommÚ/Reã»nûCouÁ.h
"

30 
	~"BlockCom´essiÚH—d”Comm™Log.h
"

31 
	~"Comm™Log.h
"

32 
	~"Comm™LogR—d”.h
"

33 
	~"Fesy¡em.h
"

34 
	~"Key.h
"

36 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

38 
Çme¥aû
 
	gHy³¹abË
 {

41 
ušt32_t
 
	gnum
;

42 
	g¡d
::
¡ršg
 
âame
;

43 
BlockCom´essiÚH—d”Comm™Log
 
	gŒa”
;

44 } 
	tLogFeInfoT
;

46 
šlše
 
boŞ
 
	gİ”©Ü
<(cÚ¡ 
	gLogFeInfoT
 &
	glfi1
, cÚ¡ LogFeInfoT &
	glfi2
) {

47  
	glfi1
.
	gnum
 < 
	glfi2
.num;

50 şas 
	cComm™LogR—d”
 : 
public
 
Reã»nûCouÁ
 {

51 
public
:

52 
Comm™LogR—d”
(
Fesy¡em
 *
fs
, 
¡d
::
¡ršg
 &
logDœ
);

53 
	gvœtu®
 ~
Comm™LogR—d”
();

54 
vœtu®
 
š™Ÿlize_»ad
(
ušt64_t
 
time¡amp
);

55 
vœtu®
 
boŞ
 
Ãxt_block
(cÚ¡ 
ušt8_t
 **
blockp
, 
size_t
 *
ËÅ
, 
BlockCom´essiÚH—d”Comm™Log
 *
h—d”
);

56 
vœtu®
 
Ï¡_”rÜ
(è{  
	gm_”rÜ
; }

57 
dump_log_m‘ad©a
();

59 
	g´iv©e
:

60 
Fesy¡em
 *
m_fs
;

61 
	g¡d
::
¡ršg
 
m_log_dœ
;

62 
	g¡d
::
veùÜ
<
LogFeInfoT
> 
m_log_fe_šfo
;

63 
ušt64_t
 
	gm_cutoff_time
;

64 
size_t
 
	gm_cur_log_off£t
;

65 
št32_t
 
	gm_fd
;

66 
DyÇmicBufãr
 
	gm_block_bufãr
;

67 
DyÇmicBufãr
 
	gm_zblock_bufãr
;

68 
	gm_”rÜ
;

69 
size_t
 
	gm_fixed_h—d”_Ëngth
;

70 
boŞ
 
	gm_gÙ_com´essÜ
;

71 
BlockCom´essiÚCodec
 *
	gm_com´essÜ
;

74 
	gboo¡
::
	tšŒusive_±r
<
	tComm™LogR—d”
> 
	tComm™LogR—d”PŒ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/CompressorFactory.cc

20 
	~<boo¡/®gÜ™hm/¡ršg.hµ
>

21 
	~"Com´essÜFaùÜy.h
"

22 
	~"BlockCom´essiÚCodecBmz.h
"

23 
	~"BlockCom´essiÚCodecNÚe.h
"

24 
	~"BlockCom´essiÚCodecZlib.h
"

25 
	~"BlockCom´essiÚCodecLzo.h
"

26 
	~"BlockCom´essiÚCodecQuicklz.h
"

28 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

29 
usšg
 
Çme¥aû
 
	g¡d
;

30 
usšg
 
Çme¥aû
 
	gboo¡
;

32 
	gBlockCom´essiÚCodec
::
Ty³


33 
Com´essÜFaùÜy
::
·r£_block_codec_¥ec
(cÚ¡ 
¡ršg
 &
¥ec
,

34 
BlockCom´essiÚCodec
::
Args
 &
¬gs
) {

35 
¡ršg
 
Çme
;

37 
¥l™
(
¬gs
, 
¥ec
, 
is_ªy_of
(" \t"), 
tok’_com´ess_Ú
);

39 ià(!
	g¬gs
.
em±y
()) {

40 
	gÇme
 = 
¬gs
.
äÚt
();

41 
	g¬gs
.
”a£
(
¬gs
.
begš
());

44 ià(
	gÇme
 =ğ"nÚe" || 
Çme
.
em±y
())

45  
BlockCom´essiÚCodec
::
NONE
;

47 ià(
	gÇme
 == "bmz")

48  
BlockCom´essiÚCodec
::
BMZ
;

50 ià(
	gÇme
 == "zlib")

51  
BlockCom´essiÚCodec
::
ZLIB
;

53 ià(
	gÇme
 == "lzo")

54  
BlockCom´essiÚCodec
::
LZO
;

56 ià(
	gÇme
 == "quicklz")

57  
BlockCom´essiÚCodec
::
QUICKLZ
;

59 
HT_ERRORF
("unknowÀcodeøty³: %s", 
Çme
.
c_¡r
());

60  
	gBlockCom´essiÚCodec
::
UNKNOWN
;

63 
BlockCom´essiÚCodec
 *

64 
	gCom´essÜFaùÜy
::
ü—‹_block_codec
(
BlockCom´essiÚCodec
::
Ty³
 
ty³
,

65 cÚ¡ 
BlockCom´essiÚCodec
::
Args
 &
¬gs
) {

66 
ty³
) {

67 
BlockCom´essiÚCodec
::
BMZ
:

68  
Ãw
 
BlockCom´essiÚCodecBmz
(
¬gs
);

69 
	gBlockCom´essiÚCodec
::
NONE
:

70  
Ãw
 
BlockCom´essiÚCodecNÚe
(
¬gs
);

71 
	gBlockCom´essiÚCodec
::
ZLIB
:

72  
Ãw
 
BlockCom´essiÚCodecZlib
(
¬gs
);

73 
	gBlockCom´essiÚCodec
::
LZO
:

74  
Ãw
 
BlockCom´essiÚCodecLzo
(
¬gs
);

75 
	gBlockCom´essiÚCodec
::
QUICKLZ
:

76  
Ãw
 
BlockCom´essiÚCodecQuicklz
(
¬gs
);

78  
NULL
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/CompressorFactory.h

20 #iâdeà
HYPERTABLE_COMPRESSOR_FACTORY_H


21 
	#HYPERTABLE_COMPRESSOR_FACTORY_H


	)

23 
	~"BlockCom´essiÚCodec.h
"

25 
Çme¥aû
 
	gHy³¹abË
 {

27 şas 
	cCom´essÜFaùÜy
 {

28 
	gpublic
:

33 
BlockCom´essiÚCodec
::
Ty³


34 
·r£_block_codec_¥ec
(cÚ¡ 
¡d
::
¡ršg
& 
¥ec
,

35 
BlockCom´essiÚCodec
::
Args
 &
¬gs
);

37 
BlockCom´essiÚCodec
 *

38 
ü—‹_block_codec
(
BlockCom´essiÚCodec
::
Ty³
,

39 cÚ¡ 
BlockCom´essiÚCodec
::
Args
 &
¬gs
 =

40 
BlockCom´essiÚCodec
::
Args
());

42 
BlockCom´essiÚCodec
 *

43 
ü—‹_block_codec
(cÚ¡ 
¡d
::
¡ršg
& 
¥ec
) {

44 
BlockCom´essiÚCodec
::
Args
 
¬gs
;

45  
ü—‹_block_codec
(
·r£_block_codec_¥ec
(
¥ec
, 
¬gs
));

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/DataSource.h

21 #iâdeà
HYPERTABLE_DATASOURCE_H


22 
	#HYPERTABLE_DATASOURCE_H


	)

25 
	~<¡dšt.h
>

28 
	~"KeyS³c.h
"

30 
usšg
 
Çme¥aû
 
Hy³¹abË
;

32 
Çme¥aû
 
	gHy³¹abË
 {

34 şas 
	cD©aSourû
 {

35 
	gpublic
:

36 
vœtu®
 ~
D©aSourû
() { ; }

37 
vœtu®
 
boŞ
 
Ãxt
(
ušt32_t
 *
ty³_æagp
, 
ušt64_t
 *
time¡amµ
, 
KeyS³c
 *
keyp
, 
ušt8_t
 **
v®u•
, ušt32_ˆ*
v®ue_ËÅ
, ušt32_ˆ*
cÚsumedp
);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/Defaults.cc

21 
	~"DeçuÉs.h
"

23 cÚ¡ 
	gHy³¹abË
::
HYPERTABLE_MASTER_CLIENT_TIMEOUT
 = 300;

24 cÚ¡ 
	gHy³¹abË
::
HYPERTABLE_RANGESERVER_CLIENT_TIMEOUT
 = 300;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/Defaults.h

21 #iâdeà
HYPERTABLE_DEFAULTS_H


22 
	#HYPERTABLE_DEFAULTS_H


	)

24 
Çme¥aû
 
	gHy³¹abË
 {

26 cÚ¡ 
HYPERTABLE_MASTER_CLIENT_TIMEOUT
;

27 cÚ¡ 
HYPERTABLE_RANGESERVER_CLIENT_TIMEOUT
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/EventHandlerMasterChange.cc

22 
	~<pŞl.h
>

25 
	~"CommÚ/E¼Ü.h
"

27 
	~"Ma¡”Cl›Á.h
"

28 
	~"Ev’tHªdËrMa¡”Chªge.h
"

30 
usšg
 
Çme¥aû
 
Hy³¹abË
;

35 
	gEv’tHªdËrMa¡”Chªge
::
	$run
() {

36 
”rÜ
;

38 
	`pŞl
(0, 0, 
	`¿nd
() % 3000);

40 ià((
”rÜ
 = 
m_ma¡”_ş›Á_±r
->
	`»lßd_ma¡”
()è!ğ
E¼Ü
::
OK
) {

41 
	`HT_ERRORF
("ProbËm„–ßdšg ma¡” cÚÃùiÚ - %s", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

44 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/EventHandlerMasterChange.h

21 #iâdeà
HYPERTABLE_EVENTHANDLERMASTERCHANGE_H


22 
	#HYPERTABLE_EVENTHANDLERMASTERCHANGE_H


	)

24 
	~"CommÚ/RuÂabË.h
"

26 
	~"AsyncComm/AµliÿtiÚHªdËr.h
"

27 
	~"AsyncComm/Ev’t.h
"

29 
	~"Ma¡”Cl›Á.h
"

31 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

33 
Çme¥aû
 
	gHy³¹abË
 {

35 şas 
	cEv’tHªdËrMa¡”Chªge
 : 
public
 
AµliÿtiÚHªdËr
 {

36 
public
:

37 
Ev’tHªdËrMa¡”Chªge
(
Ma¡”Cl›ÁPŒ
 &
ma¡”Cl›ÁPŒ
, 
Ev’tPŒ
 &
ev’tPŒ
è: 
AµliÿtiÚHªdËr
Óv’tPŒ), 
m_ma¡”_ş›Á_±r
(masterClientPtr) {

41 
vœtu®
 
run
();

43 
	g´iv©e
:

44 
Ma¡”Cl›ÁPŒ
 
m_ma¡”_ş›Á_±r
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/Filesystem.cc

21 
	~"AsyncComm/S”Ÿliz©iÚ.h
"

23 
	~"CommÚ/E¼Ü.h
"

25 
	~"Fesy¡em.h
"

27 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

29 
	gFesy¡em
::
	$decode_»¥Ú£_İ’
(
Ev’tPŒ
 &
ev’t_±r
, 
št32_t
 *
fdp
) {

30 
ušt8_t
 *
msg
 = 
ev’t_±r
->
mes§ge
;

31 
size_t
 
»maššg
 = 
ev’t_±r
->
mes§geL’
;

32 
”rÜ
;

34 ià(!
S”Ÿliz©iÚ
::
	`decode_št
(&
msg
, &
»maššg
, (
ušt32_t
 *)&
”rÜ
))

35  
E¼Ü
::
RESPONSE_TRUNCATED
;

37 ià(
”rÜ
 !ğ
E¼Ü
::
OK
)

38  
”rÜ
;

40 ià(!
S”Ÿliz©iÚ
::
	`decode_št
(&
msg
, &
»maššg
, (
ušt32_t
 *)
fdp
))

41  
E¼Ü
::
RESPONSE_TRUNCATED
;

43  
E¼Ü
::
OK
;

44 
	}
}

48 
	gFesy¡em
::
	$decode_»¥Ú£_ü—‹
(
Ev’tPŒ
 &
ev’t_±r
, 
št32_t
 *
fdp
) {

49  
	`decode_»¥Ú£_İ’
(
ev’t_±r
, 
fdp
);

50 
	}
}

55 
	gFesy¡em
::
	$decode_»¥Ú£_»ad
(
Ev’tPŒ
 &
ev’t_±r
, 
ušt8_t
 *
d¡
, 
ušt32_t
 *
Ä—dp
) {

56 
ušt8_t
 *
msg
 = 
ev’t_±r
->
mes§ge
;

57 
size_t
 
»maššg
 = 
ev’t_±r
->
mes§geL’
;

58 
ušt64_t
 
off£t
;

59 
”rÜ
;

61 ià(!
S”Ÿliz©iÚ
::
	`decode_št
(&
msg
, &
»maššg
, (
ušt32_t
 *)&
”rÜ
))

62  
E¼Ü
::
RESPONSE_TRUNCATED
;

64 ià(
”rÜ
 !ğ
E¼Ü
::
OK
)

65  
”rÜ
;

67 ià(!
S”Ÿliz©iÚ
::
	`decode_lÚg
(&
msg
, &
»maššg
, &
off£t
))

68  
E¼Ü
::
RESPONSE_TRUNCATED
;

70 ià(!
S”Ÿliz©iÚ
::
	`decode_št
(&
msg
, &
»maššg
, 
Ä—dp
))

71  
E¼Ü
::
RESPONSE_TRUNCATED
;

73 ià(
»maššg
 < *
Ä—dp
)

74  
E¼Ü
::
RESPONSE_TRUNCATED
;

77 
	`memıy
(
d¡
, 
msg
, *
Ä—dp
);

79  
E¼Ü
::
OK
;

80 
	}
}

85 
	gFesy¡em
::
	$decode_»¥Ú£_»ad_h—d”
(
Ev’tPŒ
 &
ev’t_±r
, 
ušt64_t
 *
off£
, 
ušt32_t
 *
amouÁp
, 
ušt8_t
 **
d¡p
) {

86 
ušt8_t
 *
msg
 = 
ev’t_±r
->
mes§ge
;

87 
size_t
 
»maššg
 = 
ev’t_±r
->
mes§geL’
;

88 
”rÜ
;

90 ià(!
S”Ÿliz©iÚ
::
	`decode_št
(&
msg
, &
»maššg
, (
ušt32_t
 *)&
”rÜ
))

91  
E¼Ü
::
RESPONSE_TRUNCATED
;

93 ià(
”rÜ
 !ğ
E¼Ü
::
OK
)

94  
”rÜ
;

96 ià(!
S”Ÿliz©iÚ
::
	`decode_lÚg
(&
msg
, &
»maššg
, 
off£
))

97  
E¼Ü
::
RESPONSE_TRUNCATED
;

99 ià(!
S”Ÿliz©iÚ
::
	`decode_št
(&
msg
, &
»maššg
, 
amouÁp
))

100  
E¼Ü
::
RESPONSE_TRUNCATED
;

102 ià(
d¡p
)

103 *
d¡p
 = 
msg
;

105  
E¼Ü
::
OK
;

106 
	}
}

112 
	gFesy¡em
::
	$decode_»¥Ú£_´—d
(
Ev’tPŒ
 &
ev’t_±r
, 
ušt8_t
 *
d¡
, 
ušt32_t
 *
Ä—dp
) {

113  
	`decode_»¥Ú£_»ad
(
ev’t_±r
, 
d¡
, 
Ä—dp
);

114 
	}
}

118 
	gFesy¡em
::
	$decode_»¥Ú£_­³nd
(
Ev’tPŒ
 &
ev’t_±r
, 
ušt64_t
 *
off£
, 
ušt32_t
 *
amouÁp
) {

119 
ušt8_t
 *
msg
 = 
ev’t_±r
->
mes§ge
;

120 
size_t
 
»maššg
 = 
ev’t_±r
->
mes§geL’
;

121 
”rÜ
;

123 ià(!
S”Ÿliz©iÚ
::
	`decode_št
(&
msg
, &
»maššg
, (
ušt32_t
 *)&
”rÜ
))

124  
E¼Ü
::
RESPONSE_TRUNCATED
;

126 ià(
”rÜ
 !ğ
E¼Ü
::
OK
)

127  
”rÜ
;

129 ià(!
S”Ÿliz©iÚ
::
	`decode_lÚg
(&
msg
, &
»maššg
, 
off£
))

130  
E¼Ü
::
RESPONSE_TRUNCATED
;

132 ià(!
S”Ÿliz©iÚ
::
	`decode_št
(&
msg
, &
»maššg
, 
amouÁp
))

133  
E¼Ü
::
RESPONSE_TRUNCATED
;

135  
E¼Ü
::
OK
;

136 
	}
}

143 
	gFesy¡em
::
	$decode_»¥Ú£_Ëngth
(
Ev’tPŒ
 &
ev’t_±r
, 
št64_t
 *
ËÅ
) {

144 
ušt8_t
 *
msg
 = 
ev’t_±r
->
mes§ge
;

145 
size_t
 
»maššg
 = 
ev’t_±r
->
mes§geL’
;

146 
”rÜ
;

148 ià(!
S”Ÿliz©iÚ
::
	`decode_št
(&
msg
, &
»maššg
, (
ušt32_t
 *)&
”rÜ
))

149  
E¼Ü
::
RESPONSE_TRUNCATED
;

151 ià(
”rÜ
 !ğ
E¼Ü
::
OK
)

152  
”rÜ
;

154 ià(!
S”Ÿliz©iÚ
::
	`decode_lÚg
(&
msg
, &
»maššg
, (
ušt64_t
 *)
ËÅ
))

155  
E¼Ü
::
RESPONSE_TRUNCATED
;

157  
E¼Ü
::
OK
;

158 
	}
}

163 
	gFesy¡em
::
decode_»¥Ú£_»addœ
(
Ev’tPŒ
 &
ev’t_±r
, 
¡d
::
veùÜ
<¡d::
¡ršg
> &
li¡šg
) {

164 
ušt8_t
 *
msg
 = 
ev’t_±r
->
mes§ge
;

165 
size_t
 
	g»maššg
 = 
ev’t_±r
->
mes§geL’
;

166 
	g”rÜ
;

167 
ušt32_t
 
	gËn
;

168 cÚ¡ *
	g¡r
;

170 ià(!
	gS”Ÿliz©iÚ
::
decode_št
(&
msg
, &
»maššg
, (
ušt32_t
 *)&
”rÜ
))

171  
	gE¼Ü
::
RESPONSE_TRUNCATED
;

173 ià(
	g”rÜ
 !ğ
E¼Ü
::
OK
)

174  
”rÜ
;

176 
	gli¡šg
.
ş—r
();

177 ià(!
	gS”Ÿliz©iÚ
::
decode_št
(&
msg
, &
»maššg
, &
Ën
))

178  
	gE¼Ü
::
RESPONSE_TRUNCATED
;

180 
ušt32_t
 
	gi
=0; i<
	gËn
; i++) {

181 ià(!
	gS”Ÿliz©iÚ
::
decode_¡ršg
(&
msg
, &
»maššg
, &
¡r
))

182  
	gE¼Ü
::
RESPONSE_TRUNCATED
;

183 
	gli¡šg
.
push_back
((
¡d
::
¡ršg
)
¡r
);

186  
	gE¼Ü
::
OK
;

192 
	gFesy¡em
::
	$decode_»¥Ú£
(
Ev’tPŒ
 &
ev’t_±r
) {

193 
ušt8_t
 *
msg
 = 
ev’t_±r
->
mes§ge
;

194 
size_t
 
»maššg
 = 
ev’t_±r
->
mes§geL’
;

195 
”rÜ
;

197 ià(!
S”Ÿliz©iÚ
::
	`decode_št
(&
msg
, &
»maššg
, (
ušt32_t
 *)&
”rÜ
))

198  
E¼Ü
::
RESPONSE_TRUNCATED
;

200  
E¼Ü
::
OK
;

201 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/Filesystem.h

21 #iâdeà
HYPERTABLE_FILESYSTEM_H


22 
	#HYPERTABLE_FILESYSTEM_H


	)

24 
	~"AsyncComm/Di¥©chHªdËr.h
"

26 
Çme¥aû
 
	gHy³¹abË
 {

35 şas 
	cFesy¡em
 {

36 
	gpublic
:

38 
vœtu®
 ~
Fesy¡em
() { ; }

49 
vœtu®
 
İ’
(
¡d
::
¡ršg
 &
Çme
, 
Di¥©chHªdËr
 *
hªdËr
) = 0;

57 
vœtu®
 
İ’
(
¡d
::
¡ršg
 &
Çme
, 
št32_t
 *
fdp
) = 0;

70 
vœtu®
 
İ’_bufã»d
(
¡d
::
¡ršg
 &
Çme
, 
ušt32_t
 
buf_size
, ušt32_ˆ
out¡ªdšg
, 
št32_t
 *
fdp
, 
ušt64_t
 
¡¬t_off£t
=0, ušt64_ˆ
’d_off£t
=0) = 0;

78 
decode_»¥Ú£_İ’
(
Ev’tPŒ
 &
ev’t_±r
, 
št32_t
 *
fdp
);

93 
vœtu®
 
ü—‹
(
¡d
::
¡ršg
 &
Çme
, 
boŞ
 
ov”wr™e
, 
št32_t
 
bufãrSize
,

94 
št32_t
 
»¶iÿtiÚ
, 
št64_t
 
blockSize
, 
Di¥©chHªdËr
 *
hªdËr
) = 0;

106 
vœtu®
 
ü—‹
(
¡d
::
¡ršg
 &
Çme
, 
boŞ
 
ov”wr™e
, 
št32_t
 
bufãrSize
,

107 
št32_t
 
»¶iÿtiÚ
, 
št64_t
 
blockSize
, iÁ32_ˆ*
fdp
) = 0;

115 
decode_»¥Ú£_ü—‹
(
Ev’tPŒ
 &
ev’t_±r
, 
št32_t
 *
fdp
);

126 
vœtu®
 
şo£
(
št32_t
 
fd
, 
Di¥©chHªdËr
 *
hªdËr
) = 0;

136 
vœtu®
 
şo£
(
št32_t
 
fd
) = 0;

150 
vœtu®
 
»ad
(
št32_t
 
fd
, 
ušt32_t
 
amouÁ
, 
Di¥©chHªdËr
 *
hªdËr
) = 0;

164 
vœtu®
 
»ad
(
št32_t
 
fd
, 
ušt32_t
 
amouÁ
, 
ušt8_t
 *
d¡
, ušt32_ˆ*
Ä—dp
) = 0;

173 
decode_»¥Ú£_»ad
(
Ev’tPŒ
 &
ev’t_±r
, 
ušt8_t
 *
d¡
, 
ušt32_t
 *
Ä—dp
);

183 
decode_»¥Ú£_»ad_h—d”
(
Ev’tPŒ
 &
ev’t_±r
, 
ušt64_t
 *
off£
, 
ušt32_t
 *
amouÁp
, 
ušt8_t
 **
d¡p
);

196 
vœtu®
 
­³nd
(
št32_t
 
fd
, cÚ¡ *
buf
, 
ušt32_t
 
amouÁ
, 
Di¥©chHªdËr
 *
hªdËr
) = 0;

209 
vœtu®
 
­³nd
(
št32_t
 
fd
, cÚ¡ *
buf
, 
ušt32_t
 
amouÁ
) = 0;

218 
decode_»¥Ú£_­³nd
(
Ev’tPŒ
 &
ev’t_±r
, 
ušt64_t
 *
off£
, 
ušt32_t
 *
amouÁp
);

230 
vœtu®
 
£ek
(
št32_t
 
fd
, 
ušt64_t
 
off£t
, 
Di¥©chHªdËr
 *
hªdËr
) = 0;

241 
vœtu®
 
£ek
(
št32_t
 
fd
, 
ušt64_t
 
off£t
) = 0;

251 
vœtu®
 
»move
(
¡d
::
¡ršg
 &
Çme
, 
Di¥©chHªdËr
 *
hªdËr
) = 0;

259 
vœtu®
 
»move
(
¡d
::
¡ršg
 &
Çme
) = 0;

269 
vœtu®
 
Ëngth
(
¡d
::
¡ršg
 &
Çme
, 
Di¥©chHªdËr
 *
hªdËr
) = 0;

278 
vœtu®
 
Ëngth
(
¡d
::
¡ršg
 &
Çme
, 
št64_t
 *
ËÅ
) = 0;

286 
decode_»¥Ú£_Ëngth
(
Ev’tPŒ
 &
ev’t_±r
, 
št64_t
 *
ËÅ
);

299 
vœtu®
 
´—d
(
št32_t
 
fd
, 
ušt64_t
 
off£t
, 
ušt32_t
 
amouÁ
, 
Di¥©chHªdËr
 *
hªdËr
) = 0;

314 
vœtu®
 
´—d
(
št32_t
 
fd
, 
ušt64_t
 
off£t
, 
ušt32_t
 
amouÁ
, 
ušt8_t
 *
d¡
, ušt32_ˆ*
Ä—dp
) = 0;

323 
decode_»¥Ú£_´—d
(
Ev’tPŒ
 &
ev’t_±r
, 
ušt8_t
 *
d¡
, 
ušt32_t
 *
Ä—dp
);

333 
vœtu®
 
mkdœs
(
¡d
::
¡ršg
 &
Çme
, 
Di¥©chHªdËr
 *
hªdËr
) = 0;

341 
vœtu®
 
mkdœs
(
¡d
::
¡ršg
 &
Çme
) = 0;

351 
vœtu®
 
rmdœ
(
¡d
::
¡ršg
 &
Çme
, 
Di¥©chHªdËr
 *
hªdËr
) = 0;

359 
vœtu®
 
rmdœ
(
¡d
::
¡ršg
 &
Çme
) = 0;

369 
vœtu®
 
»addœ
(
¡d
::
¡ršg
 &
Çme
, 
Di¥©chHªdËr
 *
hªdËr
) = 0;

378 
vœtu®
 
»addœ
(
¡d
::
¡ršg
 &
Çme
, std::
veùÜ
<¡d::¡ršg> &
li¡šg
) = 0;

386 
decode_»¥Ú£_»addœ
(
Ev’tPŒ
 &
ev’t_±r
, 
¡d
::
veùÜ
<¡d::
¡ršg
> &
li¡šg
);

397 
vœtu®
 
æush
(
št32_t
 
fd
, 
Di¥©chHªdËr
 *
hªdËr
) = 0;

407 
vœtu®
 
æush
(
št32_t
 
fd
) = 0;

414 
decode_»¥Ú£
(
Ev’tPŒ
 &
ev’t_±r
);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/HqlCommandInterpreter.cc

21 
	~<ÿs£¹
>

22 
	~<c¡dio
>

23 
	~<c¡ršg
>

25 
	~<boo¡/´og»ss.hµ
>

26 
	~<boo¡/tim”.hµ
>

27 
	~<boo¡/th»ad/xtime.hµ
>

30 
	~<time.h
>

33 
	~"CommÚ/E¼Ü.h
"

34 
	~"CommÚ/FeUts.h
"

36 
	~"Cl›Á.h
"

37 
	~"HqlCommªdIÁ”´‘”.h
"

38 
	~"HqlH–pText.h
"

39 
	~"HqlP¬£r.h
"

40 
	~"Key.h
"

41 
	~"LßdD©aSourû.h
"

43 
usšg
 
Çme¥aû
 
Hy³¹abË
;

44 
usšg
 
Çme¥aû
 
	gHy³¹abË
::
HqlP¬£r
;

46 
	gHqlCommªdIÁ”´‘”
::
	$HqlCommªdIÁ”´‘”
(
Cl›Á
 *
ş›Á
è: 
	`m_ş›Á
(ş›Á), 
	$m_time¡amp_ouut_fÜm©
(
TIMESTAMP_FORMAT_DEFAULT
) {

48 
	}
}

50 
	gHqlCommªdIÁ”´‘”
::
execu‹_lše
(
¡d
::
¡ršg
 &
lše
) {

51 
”rÜ
;

52 
	g¡d
::
¡ršg
 
schema_¡r
;

53 
	g¡d
::
¡ršg
 
out_¡r
;

54 
hql_š‹½»‹r_¡©e
 
	g¡©e
;

55 
hql_š‹½»‹r
 
š‹½
(
¡©e
);

56 
	g·r£_šfo
<> 
	gšfo
;

57 
Schema
 *
	gschema
;

59 
	gšfo
 = 
·r£
(
lše
.
c_¡r
(), 
š‹½
, 
¥aû_p
);

61 ià(
	gšfo
.
	gfuÎ
) {

63 ià(
	g¡©e
.
	gcommªd
 =ğ
COMMAND_SHOW_CREATE_TABLE
) {

64 ià((
”rÜ
 = 
m_ş›Á
->
g‘_schema
(
¡©e
.
bË_Çme
, 
schema_¡r
)è!ğ
E¼Ü
::
OK
)

65 
throw
 
Exû±iÚ
(
”rÜ
, 
¡d
::
¡ršg
("ProbËm f‘chšg schem¨fÜabË '"è+ 
¡©e
.
bË_Çme
 + "' from master");

66 
	gschema
 = 
Schema
::
Ãw_š¡ªû
(
schema_¡r
.
c_¡r
(), 
¡¾’
(schema_¡r.c_¡r()), 
Œue
);

67 ià(!
	gschema
->
is_v®id
())

68 
throw
 
Exû±iÚ
(
E¼Ü
::
BAD_SCHEMA
, 
schema
->
g‘_”rÜ_¡ršg
());

69 
	gschema
->
»nd”_hql_ü—‹_bË
(
¡©e
.
bË_Çme
, 
out_¡r
);

70 
	gcout
 << 
	gout_¡r
 << 
	gæush
;

72 ià(
	g¡©e
.
	gcommªd
 =ğ
COMMAND_HELP
) {

73 cÚ¡ **
‹xt
 = 
HqlH–pText
::
G‘
(
¡©e
.
¡r
);

74 ià(
	g‹xt
) {

75 
size_t
 
	gi
=0; 
	g‹xt
[
i
]; i++)

76 
	gcout
 << 
	g‹xt
[
i
] << 
	g’dl
;

79 
	gcout
 << 
	g’dl
 << "nØh–°fÜ '" << 
	g¡©e
.
	g¡r
 << "'" <<ƒndl <<ƒndl;

81 ià(
	g¡©e
.
	gcommªd
 =ğ
COMMAND_CREATE_TABLE
) {

82 
schema
 = 
Ãw
 
Schema
();

83 
	gschema
->
£t_com´essÜ
(
¡©e
.
bË_com´essÜ
);

84 
	gSchema
::
AcûssGroupM­T
::
cÚ¡_™”©Ü
 
ag_™”
 = 
¡©e
.
ag_m­
.
begš
(); 
	gag_™”
 !ğ¡©e.ag_m­.
’d
();‡g_iter++)

85 
	gschema
->
add_acûss_group
((*
ag_™”
).
£cÚd
);

86 ià(
	g¡©e
.
	gag_m­
.
fšd
("deçuÉ"è=ğ
¡©e
.
ag_m­
.
’d
()) {

87 
Schema
::
AcûssGroup
 *
ag
 = 
Ãw
 Schema::AccessGroup();

88 
	gag
->
	gÇme
 = "default";

89 
	gschema
->
add_acûss_group
(
ag
);

91 
	gSchema
::
CŞumnFamyM­T
::
cÚ¡_™”©Ü
 
cf_™”
 = 
¡©e
.
cf_m­
.
begš
(); 
	gcf_™”
 !ğ¡©e.cf_m­.
’d
(); cf_iter++) {

92 ià((*
	gcf_™”
).
	g£cÚd
->
	gag
 == "")

93 (*
cf_™”
).
£cÚd
->
ag
 = "default";

94 
	gschema
->
add_cŞumn_çmy
((*
cf_™”
).
£cÚd
);

96 cÚ¡ *
	g”rÜ_¡r
 = 
schema
->
g‘_”rÜ_¡ršg
();

97 ià(
	g”rÜ_¡r
)

98 
throw
 
Exû±iÚ
(
E¼Ü
::
HQL_PARSE_ERROR
, 
”rÜ_¡r
);

99 
	gschema
->
»nd”
(
schema_¡r
);

101 ià((
	g”rÜ
 = 
m_ş›Á
->
ü—‹_bË
(
¡©e
.
bË_Çme
, 
schema_¡r
.
c_¡r
())è!ğ
E¼Ü
::
OK
)

102 
throw
 
Exû±iÚ
(
”rÜ
, 
¡d
::
¡ršg
("ProbËm c»©šgabË '"è+ 
¡©e
.
bË_Çme
 + "'");

104 ià(
	g¡©e
.
	gcommªd
 =ğ
COMMAND_DESCRIBE_TABLE
) {

105 ià((
”rÜ
 = 
m_ş›Á
->
g‘_schema
(
¡©e
.
bË_Çme
, 
schema_¡r
)è!ğ
E¼Ü
::
OK
)

106 
throw
 
Exû±iÚ
(
”rÜ
, 
¡d
::
¡ršg
("ProbËm f‘chšg schem¨fÜabË '"è+ 
¡©e
.
bË_Çme
 + "' from master");

107 
	gcout
 << 
	gschema_¡r
 << 
	g’dl
;

109 ià(
	g¡©e
.
	gcommªd
 =ğ
COMMAND_SELECT
) {

110 
TabËPŒ
 
bË_±r
;

111 
TabËSÿÂ”PŒ
 
	gsÿÂ”_±r
;

112 
SÿnS³cifiÿtiÚT
 
	gsÿn_¥ec
;

113 
C–lT
 
	gûÎ
;

114 
ušt32_t
 
	gn£c
;

115 
time_t
 
	gunix_time
;

116 
tm
 
	gtms
;

118 
	gsÿn_¥ec
.
	growLim™
 = 
¡©e
.
sÿn
.
lim™
;

119 
	gsÿn_¥ec
.
	gmax_v”siÚs
 = 
¡©e
.
sÿn
.
max_v”siÚs
;

120 
size_t
 
	gi
=0; i<
	g¡©e
.
	gsÿn
.
	gcŞumns
.
size
(); i++)

121 
	gsÿn_¥ec
.
	gcŞumns
.
push_back
(
¡©e
.
sÿn
.
cŞumns
[
i
].
c_¡r
());

122 ià(
	g¡©e
.
	gsÿn
.
	grow
 != "") {

123 
sÿn_¥ec
.
¡¬tRow
 = 
¡©e
.
sÿn
.
row
.
c_¡r
();

124 
	gsÿn_¥ec
.
	g¡¬tRowInşusive
 = 
Œue
;

125 
	gsÿn_¥ec
.
	g’dRow
 = 
¡©e
.
sÿn
.
row
.
c_¡r
();

126 
	gsÿn_¥ec
.
	g’dRowInşusive
 = 
Œue
;

127 
	gsÿn_¥ec
.
	growLim™
 = 1;

130 
	gsÿn_¥ec
.
	g¡¬tRow
 = (
¡©e
.
sÿn
.
¡¬t_row
 =ğ""è? 0 : s‹.sÿn.¡¬t_row.
c_¡r
();

131 
	gsÿn_¥ec
.
	g¡¬tRowInşusive
 = 
¡©e
.
sÿn
.
¡¬t_row_šşusive
;

132 
	gsÿn_¥ec
.
	g’dRow
 = (
¡©e
.
sÿn
.
’d_row
 =ğ""è? 
Key
::
END_ROW_MARKER
 : s‹.sÿn.’d_row.
c_¡r
();

133 
	gsÿn_¥ec
.
	g’dRowInşusive
 = 
¡©e
.
sÿn
.
’d_row_šşusive
;

135 
	gsÿn_¥ec
.
	gš‹rv®
.
	gfœ¡
 = 
¡©e
.
sÿn
.
¡¬t_time
;

136 
	gsÿn_¥ec
.
	gš‹rv®
.
	g£cÚd
 = 
¡©e
.
sÿn
.
’d_time
;

137 
	gsÿn_¥ec
.
	g»tuº_d–‘es
 = 
¡©e
.
sÿn
.
»tuº_d–‘es
;

139 ià((
	g”rÜ
 = 
m_ş›Á
->
İ’_bË
(
¡©e
.
bË_Çme
, 
bË_±r
)è!ğ
E¼Ü
::
OK
)

140 
throw
 
Exû±iÚ
(
”rÜ
, 
¡d
::
¡ršg
("ProbËm o³nšgabË '"è+ 
¡©e
.
bË_Çme
 + "'");

142 ià((
	g”rÜ
 = 
bË_±r
->
ü—‹_sÿÂ”
(
sÿn_¥ec
, 
sÿÂ”_±r
)è!ğ
E¼Ü
::
OK
)

143 
throw
 
Exû±iÚ
(
”rÜ
, 
¡d
::
¡ršg
("ProbËm c»©šg sÿÂ” oÀbË '"è+ 
¡©e
.
bË_Çme
 + "'");

145 
	gsÿÂ”_±r
->
Ãxt
(
ûÎ
)) {

146 ià(
	g¡©e
.
	gsÿn
.
	gdi¥Ïy_time¡amps
) {

147 ià(
	gm_time¡amp_ouut_fÜm©
 =ğ
TIMESTAMP_FORMAT_USECS
) {

148 
´štf
("%Îu\t", ()
ûÎ
.
time¡amp
);

151 
	gn£c
 = 
ûÎ
.
time¡amp
 % 1000000000LL;

152 
	gunix_time
 = 
ûÎ
.
time¡amp
 / 1000000000LL;

153 
gmtime_r
(&
unix_time
, &
tms
);

154 
´štf
("%d-%02d-%02d %02d:%02d:%02d.%09d\t", 
tms
.
tm_y—r
+1900,ms.
tm_mÚ
+1,ms.
tm_mday
,ms.
tm_hour
,ms.
tm_mš
,ms.
tm_£c
, 
n£c
);

157 ià(!
	g¡©e
.
	gsÿn
.
	gkeys_Úly
) {

158 ià(
	gûÎ
.
	gcŞumn_çmy
) {

159 
´štf
("%s\t%s", 
ûÎ
.
row_key
, c–l.
cŞumn_çmy
);

160 ià(*
	gûÎ
.
	gcŞumn_qu®if›r
)

161 
´štf
(":%s", 
ûÎ
.
cŞumn_qu®if›r
);

164 
´štf
("%s", 
ûÎ
.
row_key
);

165 ià(
	gûÎ
.
	gæag
 !ğ
FLAG_INSERT
)

166 
´štf
("\t%s\tDELETE\n", 
¡d
::
¡ršg
((cÚ¡ *)
ûÎ
.
v®ue
, c–l.
v®ue_Ën
).
c_¡r
());

168 
´štf
("\t%s\n", 
¡d
::
¡ršg
((cÚ¡ *)
ûÎ
.
v®ue
, c–l.
v®ue_Ën
).
c_¡r
());

171 
´štf
("%s\n", 
ûÎ
.
row_key
);

174 ià(
	g¡©e
.
	gcommªd
 =ğ
COMMAND_LOAD_DATA
) {

175 
TabËPŒ
 
bË_±r
;

176 
TabËMutÜPŒ
 
	gmutÜ_±r
;

177 
LßdD©aSourû
 *
	glds
;

178 
ušt64_t
 
	gtime¡amp
;

179 
KeyS³c
 
	gkey
;

180 
ušt8_t
 *
	gv®ue
;

181 
ušt32_t
 
	gv®ue_Ën
;

182 
ušt32_t
 
	gcÚsumed
;

183 
ušt64_t
 
	gfe_size
;

184 
ušt64_t
 
	gtÙ®_v®ues_size
 = 0;

185 
ušt64_t
 
	gtÙ®_rowkey_size
 = 0;

186 
¡ršg
 
	g¡¬t_msg
;

187 
ušt64_t
 
	gš£¹_couÁ
 = 0;

188 
	gboo¡
::
xtime
 
¡¬t_time
, 
	gfšish_time
;

189 
	g–­£d_time
;

190 
boŞ
 
	gšto_bË
 = 
Œue
;

191 
boŞ
 
	gdi¥Ïy_time¡amps
 = 
çl£
;

192 
FILE
 *
	goutå
 = 0;

194 
	gboo¡
::
xtime_g‘
(&
¡¬t_time
, 
boo¡
::
TIME_UTC
);

196 ià(
	g¡©e
.
	gbË_Çme
 == "") {

197 ià(
¡©e
.
ouut_fe
 == "")

198 
throw
 
Exû±iÚ
(
E¼Ü
::
HQL_PARSE_ERROR
, "LOAD DATA INFILE ... INTO FILE - bad filename");

199 
	goutå
 = 
fİ’
(
¡©e
.
ouut_fe
.
c_¡r
(), "w");

200 
	gšto_bË
 = 
çl£
;

203 ià((
	g”rÜ
 = 
m_ş›Á
->
İ’_bË
(
¡©e
.
bË_Çme
, 
bË_±r
)è!ğ
E¼Ü
::
OK
)

204 
throw
 
Exû±iÚ
(
”rÜ
, 
¡d
::
¡ršg
("ProbËm o³nšgabË '"è+ 
¡©e
.
bË_Çme
 + "'");

206 ià((
	g”rÜ
 = 
bË_±r
->
ü—‹_mutÜ
(
mutÜ_±r
)è!ğ
E¼Ü
::
OK
)

207 
throw
 
Exû±iÚ
(
”rÜ
, 
¡d
::
¡ršg
("ProbËm c»©šg mutÜ oÀbË '"è+ 
¡©e
.
bË_Çme
 + "'");

210 
	gboo¡
::
Œim_if
(
¡©e
.
¡r
, 
boo¡
::
is_ªy_of
("'\""));

212 ià(!
	gFeUts
::
exi¡s
(
¡©e
.
¡r
.
c_¡r
()))

213 
throw
 
Exû±iÚ
(
E¼Ü
::
FILE_NOT_FOUND
, 
¡©e
.
¡r
);

215 
	gfe_size
 = 
FeUts
::
size
(
¡©e
.
¡r
.
c_¡r
());

217 
´štf
("\nLoading ");

218 ià(
	gfe_size
 > 1000000000000LL)

219 
´štf
("%3Îd,", 
fe_size
/1000000000000LL);

220 ià(
	gfe_size
 > 1000000000LL)

221 
´štf
("%3Îd,", (
fe_size
%1000000000000LL) / 1000000000LL);

222 ià(
	gfe_size
 > 1000000LL)

223 
´štf
("%3Îd,", (
fe_size
%1000000000LL) / 1000000LL);

224 ià(
	gfe_size
 > 1000LL)

225 
´štf
("%3Îd,", (
fe_size
%1000000LL) / 1000LL);

226 
´štf
("%3Îd", 
fe_size
 % 1000LL);

227 
´štf
(" bytes of input data...\n");

228 
fæush
(
¡dout
);

230 
	gboo¡
::
´og»ss_di¥Ïy
 
show_´og»ss
Ğ
fe_size
 );

232 
	glds
 = 
Ãw
 
LßdD©aSourû
(
¡©e
.
¡r
, s‹.
row_key_cŞumn
, s‹.
time¡amp_cŞumn
);

234 ià(!
	gšto_bË
) {

235 
	gdi¥Ïy_time¡amps
 = 
lds
->
has_time¡amps
();

236 ià(
	gdi¥Ïy_time¡amps
)

237 
årštf
(
outå
, "timestamp\trowkey\tcolumnkey\tvalue\n");

239 
årštf
(
outå
, "rowkey\tcolumnkey\tvalue\n");

242 
	glds
->
Ãxt
(0, &
time¡amp
, &
key
, &
v®ue
, &
v®ue_Ën
, &
cÚsumed
)) {

243 ià(
	gv®ue_Ën
 > 0) {

244 
	gš£¹_couÁ
++;

245 
	gtÙ®_v®ues_size
 +ğ
v®ue_Ën
;

246 
	gtÙ®_rowkey_size
 +ğ
key
.
row_Ën
;

247 ià(
	gšto_bË
) {

248 
	gŒy
 {

249 
	gmutÜ_±r
->
£t
(
time¡amp
, 
key
, 
v®ue
, 
v®ue_Ën
);

251 
ÿtch
 (
Hy³¹abË
::
Exû±iÚ
 &
e
) {

252 
û¼
 << "”rÜ: " << 
E¼Ü
::
g‘_‹xt
(
e
.
code
()è<< " - " <<ƒ.
wh©
(è<< 
’dl
;

256 ià(
	gdi¥Ïy_time¡amps
)

257 
årštf
(
outå
, "%Îu\t%s\t%s\t%s\n", ()
time¡amp
, (cÚ¡ *)
key
.
row
, key.
cŞumn_çmy
, (cÚ¡ *)
v®ue
);

259 
årštf
(
outå
, "%s\t%s\t%s\n", (cÚ¡ *)
key
.
row
, key.
cŞumn_çmy
, (cÚ¡ *)
v®ue
);

262 
	gshow_´og»ss
 +ğ
cÚsumed
;

265 
d–‘e
 
	glds
;

267 ià(
	gšto_bË
)

268 
	gmutÜ_±r
->
æush
();

270 
fşo£
(
outå
);

272 
	gboo¡
::
xtime_g‘
(&
fšish_time
, 
boo¡
::
TIME_UTC
);

274 ià(
	g¡¬t_time
.
	g£c
 =ğ
fšish_time
.
£c
)

275 
–­£d_time
 = ()(
fšish_time
.
n£c
 - 
¡¬t_time
.nsec) / 1000000000.0;

277 
	g–­£d_time
 = 
fšish_time
.
£c
 - 
¡¬t_time
.sec;

278 
	g–­£d_time
 +ğ((1000000000.0 - ()
¡¬t_time
.
n£c
è+ ()
fšish_time
.nsec) / 1000000000.0;

281 ià(
	gshow_´og»ss
.
couÁ
(è< 
	gfe_size
)

282 
	gshow_´og»ss
 +ğ
fe_size
 - 
show_´og»ss
.
couÁ
();

284 
´štf
("Load complete.\n");

285 
´štf
("\n");

286 
´štf
(" EÏp£dime: %.2às\n", 
–­£d_time
);

287 
´štf
("Avg v®usize: %.2àby‹s\n", ()
tÙ®_v®ues_size
 / 
š£¹_couÁ
);

288 
´štf
(" Avg key size: %.2àby‹s\n", ()
tÙ®_rowkey_size
 / 
š£¹_couÁ
);

289 
´štf
(" Throughput: %.2àby‹s/s\n", ()
fe_size
 / 
–­£d_time
);

290 
´štf
(" TÙ® in£¹s: %Îu\n", ()
š£¹_couÁ
);

291 
´štf
(" Throughput: %.2àš£¹s/s\n", ()
š£¹_couÁ
 / 
–­£d_time
);

292 ià(
	gmutÜ_±r
)

293 
´štf
(" Re£nds: %Îu\n", ()
mutÜ_±r
->
g‘_»£nd_couÁ
());

294 
´štf
("\n");

302 ià(
	g¡©e
.
	gcommªd
 =ğ
COMMAND_INSERT
) {

303 
TabËPŒ
 
bË_±r
;

304 
TabËMutÜPŒ
 
	gmutÜ_±r
;

305 
KeyS³c
 
	gkey
;

306 *
	gcŞumn_qu®if›r
;

307 
	g¡d
::
¡ršg
 
tmp_¡r
;

309 ià((
	g”rÜ
 = 
m_ş›Á
->
İ’_bË
(
¡©e
.
bË_Çme
, 
bË_±r
)è!ğ
E¼Ü
::
OK
)

310 
throw
 
Exû±iÚ
(
”rÜ
, 
¡d
::
¡ršg
("ProbËm o³nšgabË '"è+ 
¡©e
.
bË_Çme
 + "'");

312 ià((
	g”rÜ
 = 
bË_±r
->
ü—‹_mutÜ
(
mutÜ_±r
)è!ğ
E¼Ü
::
OK
)

313 
throw
 
Exû±iÚ
(
”rÜ
, 
¡d
::
¡ršg
("ProbËm c»©šg mutÜ oÀbË '"è+ 
¡©e
.
bË_Çme
 + "'");

315 
size_t
 
	gi
=0; i<
	g¡©e
.
	gš£¹s
.
size
(); i++) {

316 
	gkey
.
	grow
 = 
¡©e
.
š£¹s
[
i
].
row_key
.
c_¡r
();

317 
	gkey
.
	grow_Ën
 = 
¡©e
.
š£¹s
[
i
].
row_key
.
Ëngth
();

318 
	gkey
.
	gcŞumn_çmy
 = 
¡©e
.
š£¹s
[
i
].
cŞumn_key
.
c_¡r
();

319 ià((
	gcŞumn_qu®if›r
 = 
¡rchr
(
¡©e
.
š£¹s
[
i
].
cŞumn_key
.
c_¡r
(), ':')) != 0) {

320 *
cŞumn_qu®if›r
++ = 0;

321 
	gkey
.
	gcŞumn_qu®if›r
 = 
cŞumn_qu®if›r
;

322 
	gkey
.
	gcŞumn_qu®if›r_Ën
 = 
¡¾’
(
cŞumn_qu®if›r
);

325 
	gkey
.
	gcŞumn_qu®if›r
 = 0;

326 
	gkey
.
	gcŞumn_qu®if›r_Ën
 = 0;

328 
	gŒy
 {

329 
	gmutÜ_±r
->
£t
(
¡©e
.
š£¹s
[
i
].
time¡amp
, 
key
, (
ušt8_t
 *)¡©e.š£¹s[i].
v®ue
.
c_¡r
(), (
ušt32_t
)¡©e.š£¹s[i].v®ue.
Ëngth
());

331 
ÿtch
 (
Hy³¹abË
::
Exû±iÚ
 &
e
) {

332 
û¼
 << "”rÜ: " << 
E¼Ü
::
g‘_‹xt
(
e
.
code
()è<< " - " <<ƒ.
wh©
(è<< 
’dl
;

335 
	gmutÜ_±r
->
æush
();

337 ià(
	g¡©e
.
	gcommªd
 =ğ
COMMAND_DELETE
) {

338 
TabËPŒ
 
bË_±r
;

339 
TabËMutÜPŒ
 
	gmutÜ_±r
;

340 
KeyS³c
 
	gkey
;

341 *
	gcŞumn_qu®if›r
;

342 
	g¡d
::
¡ršg
 
tmp_¡r
;

344 ià((
	g”rÜ
 = 
m_ş›Á
->
İ’_bË
(
¡©e
.
bË_Çme
, 
bË_±r
)è!ğ
E¼Ü
::
OK
)

345 
throw
 
Exû±iÚ
(
”rÜ
, 
¡d
::
¡ršg
("ProbËm o³nšgabË '"è+ 
¡©e
.
bË_Çme
 + "'");

347 ià((
	g”rÜ
 = 
bË_±r
->
ü—‹_mutÜ
(
mutÜ_±r
)è!ğ
E¼Ü
::
OK
)

348 
throw
 
Exû±iÚ
(
”rÜ
, 
¡d
::
¡ršg
("ProbËm c»©šg mutÜ oÀbË '"è+ 
¡©e
.
bË_Çme
 + "'");

350 
mem£t
(&
key
, 0, (key));

351 
	gkey
.
	grow
 = 
¡©e
.
d–‘e_row
.
c_¡r
();

352 
	gkey
.
	grow_Ën
 = 
¡©e
.
d–‘e_row
.
Ëngth
();

354 ià(
	g¡©e
.
	gd–‘e_time
 != 0)

355 
¡©e
.
d–‘e_time
++;

357 ià(
	g¡©e
.
	gd–‘e_®l_cŞumns
) {

358 
	gŒy
 {

359 
	gmutÜ_±r
->
£t_d–‘e
(
¡©e
.
d–‘e_time
, 
key
);

361 
ÿtch
 (
Hy³¹abË
::
Exû±iÚ
 &
e
) {

362 
û¼
 << "”rÜ: " << 
E¼Ü
::
g‘_‹xt
(
e
.
code
()è<< " - " <<ƒ.
wh©
(è<< 
’dl
;

367 
size_t
 
	gi
=0; i<
	g¡©e
.
	gd–‘e_cŞumns
.
size
(); i++) {

368 
	gkey
.
	gcŞumn_çmy
 = 
¡©e
.
d–‘e_cŞumns
[
i
].
c_¡r
();

369 ià((
	gcŞumn_qu®if›r
 = 
¡rchr
(
¡©e
.
d–‘e_cŞumns
[
i
].
c_¡r
(), ':')) != 0) {

370 *
cŞumn_qu®if›r
++ = 0;

371 
	gkey
.
	gcŞumn_qu®if›r
 = 
cŞumn_qu®if›r
;

372 
	gkey
.
	gcŞumn_qu®if›r_Ën
 = 
¡¾’
(
cŞumn_qu®if›r
);

375 
	gkey
.
	gcŞumn_qu®if›r
 = 0;

376 
	gkey
.
	gcŞumn_qu®if›r_Ën
 = 0;

378 
	gŒy
 {

379 
	gmutÜ_±r
->
£t_d–‘e
(
¡©e
.
d–‘e_time
, 
key
);

381 
ÿtch
 (
Hy³¹abË
::
Exû±iÚ
 &
e
) {

382 
û¼
 << "”rÜ: " << 
E¼Ü
::
g‘_‹xt
(
e
.
code
()è<< " - " <<ƒ.
wh©
(è<< 
’dl
;

386 
	gmutÜ_±r
->
æush
();

388 ià(
	g¡©e
.
	gcommªd
 =ğ
COMMAND_SHOW_TABLES
) {

389 
¡d
::
veùÜ
<¡d::
¡ršg
> 
bËs
;

390 ià((
	g”rÜ
 = 
m_ş›Á
->
g‘_bËs
(
bËs
)è!ğ
E¼Ü
::
OK
)

391 
throw
 
Exû±iÚ
(
”rÜ
, 
¡d
::
¡ršg
("Problem obtainingable†ist"));

392 ià(
	gbËs
.
em±y
())

393 
	gcout
 << "Em±y s‘" << 
	g’dl
;

395 
size_t
 
	gi
=0; i<
	gbËs
.
size
(); i++)

396 
	gcout
 << 
	gbËs
[
i
] << 
	g’dl
;

399 ià(
	g¡©e
.
	gcommªd
 =ğ
COMMAND_DROP_TABLE
) {

400 ià((
”rÜ
 = 
m_ş›Á
->
drİ_bË
(
¡©e
.
bË_Çme
, s‹.
if_exi¡s
)è!ğ
E¼Ü
::
OK
)

401 
throw
 
Exû±iÚ
(
”rÜ
, 
¡d
::
¡ršg
("ProbËm drİpšˆbË '"è+ 
¡©e
.
bË_Çme
 + "'");

405 
throw
 
Exû±iÚ
(
E¼Ü
::
HQL_PARSE_ERROR
, 
¡d
::
¡ršg
("·r£ƒ¼Ü‡t: "è+ 
šfo
.
¡İ
);

410 
	gHqlCommªdIÁ”´‘”
::
£t_time¡amp_ouut_fÜm©
(
¡d
::
¡ršg
 
fÜm©
) {

411 ià(
fÜm©
 == "default")

412 
m_time¡amp_ouut_fÜm©
 = 
TIMESTAMP_FORMAT_DEFAULT
;

413 ià(
	gfÜm©
 == "usecs")

414 
m_time¡amp_ouut_fÜm©
 = 
TIMESTAMP_FORMAT_USECS
;

416 
as£¹
(!"invalidimestamp format");

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/HqlCommandInterpreter.h

21 #iâdeà
HYPERTABLE_HQLCOMMANDINTERPRETER_H


22 
	#HYPERTABLE_HQLCOMMANDINTERPRETER_H


	)

24 
	~"CommÚ/Reã»nûCouÁ.h
"

26 
Çme¥aû
 
	gHy³¹abË
 {

28 
şass
 
	gCl›Á
;

30 şas 
	cHqlCommªdIÁ”´‘”
 : 
public
 
Reã»nûCouÁ
 {

31 
public
:

32 
HqlCommªdIÁ”´‘”
(
Cl›Á
 *
ş›Á
);

34 
execu‹_lše
(
¡d
::
¡ršg
 &
lše
);

36 
£t_time¡amp_ouut_fÜm©
(
¡d
::
¡ršg
 
fÜm©
);

38 
	g´iv©e
:

39 
Cl›Á
 *
m_ş›Á
;

40 
	gm_time¡amp_ouut_fÜm©
;

42 ’um { 
	gTIMESTAMP_FORMAT_DEFAULT
, 
	gTIMESTAMP_FORMAT_USECS
 };

45 
	gboo¡
::
	tšŒusive_±r
<
	tHqlCommªdIÁ”´‘”
> 
	tHqlCommªdIÁ”´‘”PŒ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/HqlHelpText.cc

21 
	~"CommÚ/SŒšgExt.h
"

23 
	~"HqlH–pText.h
"

25 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

27 
	gÇme¥aû
 {

29 cÚ¡ *
	gh–p_‹xt_cÚ‹Ás
[] = {

49 cÚ¡ *
	gh–p_‹xt_ü—‹_bË
[] = {

76 cÚ¡ *
	gh–p_‹xt_£Ëù
[] = {

112 cÚ¡ *
	gh–p_‹xt_desüibe_bË
[] = {

147 cÚ¡ *
	gh–p_‹xt_show_ü—‹_bË
[] = {

169 cÚ¡ *
	gh–p_‹xt_lßd_d©a_šfe
[] = {

202 cÚ¡ *
	gh–p_‹xt_š£¹
[] = {

219 cÚ¡ *
	gh–p_‹xt_d–‘e
[] = {

284 cÚ¡ *
	gh–p_‹xt_show_bËs
[] = {

298 cÚ¡ *
	gh–p_‹xt_drİ_bË
[] = {

310 
	g__gnu_cxx
::
	thash_m­
<
	t¡d
::
	t¡ršg
, cÚ¡ **> 
	tH–pTextM­T
;

312 
	gH–pTextM­T
 &
budH–pTextM­
() {

313 
H–pTextM­T
 *
	gm­
 = 
Ãw
 HelpTextMapT();

314 (*
	gm­
)[""] = 
h–p_‹xt_cÚ‹Ás
;

315 (*
	gm­
)["cÚ‹Ás"] = 
h–p_‹xt_cÚ‹Ás
;

316 (*
	gm­
)["ü—‹abË"] = 
h–p_‹xt_ü—‹_bË
;

317 (*
	gm­
)["d–‘e"] = 
h–p_‹xt_d–‘e
;

318 (*
	gm­
)["š£¹"] = 
h–p_‹xt_š£¹
;

319 (*
	gm­
)["£Ëù"] = 
h–p_‹xt_£Ëù
;

320 (*
	gm­
)["desüibbË"] = 
h–p_‹xt_desüibe_bË
;

321 (*
	gm­
)["desüibe"] = 
h–p_‹xt_desüibe_bË
;

322 (*
	gm­
)["show c»©bË"] = 
h–p_‹xt_show_ü—‹_bË
;

323 (*
	gm­
)["show c»©e"] = 
h–p_‹xt_show_ü—‹_bË
;

324 (*
	gm­
)["lßd d©¨šfe"] = 
h–p_‹xt_lßd_d©a_šfe
;

325 (*
	gm­
)["lßd d©a"] = 
h–p_‹xt_lßd_d©a_šfe
;

326 (*
	gm­
)["lßd"] = 
h–p_‹xt_lßd_d©a_šfe
;

327 (*
	gm­
)["showabËs"] = 
h–p_‹xt_show_bËs
;

328 (*
	gm­
)["drİ"] = 
h–p_‹xt_drİ_bË
;

329 (*
	gm­
)["drİabË"] = 
h–p_‹xt_drİ_bË
;

330  *
	gm­
;

333 
	gH–pTextM­T
 &
	g‹xtM­
 = 
budH–pTextM­
();

337 cÚ¡ **
	gHqlH–pText
::
	$G‘
(cÚ¡ *
subjeù
) {

338 
H–pTextM­T
::
cÚ¡_™”©Ü
 
™”
 = 
‹xtM­
.
	`fšd
(
subjeù
);

339 ià(
™”
 =ğ
‹xtM­
.
	`’d
())

341  (*
™”
).
£cÚd
;

342 
	}
}

345 cÚ¡ **
	gHqlH–pText
::
G‘
(
¡d
::
¡ršg
 &
subjeù
) {

346 
H–pTextM­T
::
cÚ¡_™”©Ü
 
™”
 = 
‹xtM­
.
fšd
(
subjeù
);

347 ià(
	g™”
 =ğ
‹xtM­
.
’d
())

349  (*
	g™”
).
	g£cÚd
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/HqlHelpText.h

21 #iâdeà
HYPERTABLE_HQLHELPTEXT_H


22 
	#HYPERTABLE_HQLHELPTEXT_H


	)

24 
Çme¥aû
 
	gHy³¹abË
 {

26 şas 
	cHqlH–pText
 {

27 
	gpublic
:

28 cÚ¡ **
G‘
(cÚ¡ *
subjeù
);

29 cÚ¡ **
G‘
(
¡d
::
¡ršg
 &
subjeù
);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/HqlParser.h

21 #iâdeà
HYPERTABLE_HQLPARSER_H


22 
	#HYPERTABLE_HQLPARSER_H


	)

26 #ifdeà
BOOST_SPIRIT_DEBUG


27 
	#di¥Ïy_¡ršg
(
¡r
è
û¼
 << sŒ << 
’dl


	)

28 
	#di¥Ïy_¡ršg_w™h_v®
(
¡r
, 
v®
è
û¼
 << sŒ << " v®=" << v® << 
’dl


	)

30 
	#di¥Ïy_¡ršg
(
¡r
)

	)

31 
	#di¥Ïy_¡ršg_w™h_v®
(
¡r
, 
v®
)

	)

34 
	~<boo¡/®gÜ™hm/¡ršg.hµ
>

35 
	~<boo¡/¥œ™/cÜe.hµ
>

36 
	~<boo¡/¥œ™/symbŞs/symbŞs.hµ
>

38 
	~<c¡dlib
>

39 
	~<f¡»am
>

40 
	~<io¡»am
>

41 
	~<veùÜ
>

44 
	~<lim™s.h
>

45 
	~<time.h
>

48 
	~"Schema.h
"

50 
usšg
 
Çme¥aû
 
¡d
;

51 
usšg
 
Çme¥aû
 
	gboo¡
::
¥œ™
;

54 
Çme¥aû
 
	gHy³¹abË
 {

56 
Çme¥aû
 
	gHqlP¬£r
 {

58 cÚ¡ 
	gCOMMAND_HELP
 = 1;

59 cÚ¡ 
	gCOMMAND_CREATE_TABLE
 = 2;

60 cÚ¡ 
	gCOMMAND_DESCRIBE_TABLE
 = 3;

61 cÚ¡ 
	gCOMMAND_SHOW_CREATE_TABLE
 = 4;

62 cÚ¡ 
	gCOMMAND_SELECT
 = 5;

63 cÚ¡ 
	gCOMMAND_LOAD_DATA
 = 6;

64 cÚ¡ 
	gCOMMAND_INSERT
 = 7;

65 cÚ¡ 
	gCOMMAND_DELETE
 = 8;

66 cÚ¡ 
	gCOMMAND_SHOW_TABLES
 = 9;

67 cÚ¡ 
	gCOMMAND_DROP_TABLE
 = 10;

69 şas 
	cš£¹_»cÜd
 {

70 
	gpublic
:

71 
š£¹_»cÜd
(è: 
time¡amp
(0) { }

72 
ş—r
() {

73 
time¡amp
 = 0;

74 
	grow_key
 = "";

75 
	gcŞumn_key
 = "";

76 
	gv®ue
 = "";

78 
ušt64_t
 
	gtime¡amp
;

79 
	g¡d
::
¡ršg
 
row_key
;

80 
	g¡d
::
¡ršg
 
cŞumn_key
;

81 
	g¡d
::
¡ršg
 
v®ue
;

84 şas 
	chql_š‹½»‹r_sÿn_¡©e
 {

85 
	gpublic
:

86 
hql_š‹½»‹r_sÿn_¡©e
(è: 
¡¬t_row_šşusive
(
Œue
), 
’d_row_šşusive
Ñrue), 
lim™
(0), 
max_v”siÚs
(0), 
¡¬t_time
(0), 
’d_time
(0), 
di¥Ïy_time¡amps
(
çl£
), 
»tuº_d–‘es
(çl£), 
keys_Úly
(false) { }

87 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> 
cŞumns
;

88 
	g¡d
::
¡ršg
 
row
;

89 
	g¡d
::
¡ršg
 
¡¬t_row
;

90 
boŞ
 
	g¡¬t_row_šşusive
;

91 
	g¡d
::
¡ršg
 
’d_row
;

92 
boŞ
 
	g’d_row_šşusive
;

93 
ušt32_t
 
	glim™
;

94 
ušt32_t
 
	gmax_v”siÚs
;

95 
ušt64_t
 
	g¡¬t_time
;

96 
ušt64_t
 
	g’d_time
;

97 
	g¡d
::
¡ršg
 
outfe
;

98 
boŞ
 
	gdi¥Ïy_time¡amps
;

99 
boŞ
 
	g»tuº_d–‘es
;

100 
boŞ
 
	gkeys_Úly
;

103 şas 
	chql_š‹½»‹r_¡©e
 {

104 
	gpublic
:

105 
hql_š‹½»‹r_¡©e
(è: 
commªd
(0), 
cf
(0), 
ag
(0), 
Çno£cÚds
(0), 
d–‘e_®l_cŞumns
(
çl£
), 
d–‘e_time
(0), 
if_exi¡s
(false) {

106 
mem£t
(&
tmv®
, 0, (tmval));

108 
	gcommªd
;

109 
	g¡d
::
¡ršg
 
bË_Çme
;

110 
	g¡d
::
¡ršg
 
¡r
;

111 
	g¡d
::
¡ršg
 
ouut_fe
;

112 
	g¡d
::
¡ršg
 
bË_com´essÜ
;

113 
	g¡d
::
¡ršg
 
row_key_cŞumn
;

114 
	g¡d
::
¡ršg
 
time¡amp_cŞumn
;

115 
	gSchema
::
CŞumnFamy
 *
cf
;

116 
	gSchema
::
AcûssGroup
 *
ag
;

117 
	gSchema
::
CŞumnFamyM­T
 
cf_m­
;

118 
	gSchema
::
AcûssGroupM­T
 
ag_m­
;

119 
tm
 
	gtmv®
;

120 
ušt32_t
 
	gÇno£cÚds
;

121 
hql_š‹½»‹r_sÿn_¡©e
 
	gsÿn
;

122 
š£¹_»cÜd
 
	gcu¼’t_š£¹_v®ue
;

123 
	g¡d
::
veùÜ
<
š£¹_»cÜd
> 
š£¹s
;

124 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> 
d–‘e_cŞumns
;

125 
boŞ
 
	gd–‘e_®l_cŞumns
;

126 
	g¡d
::
¡ršg
 
d–‘e_row
;

127 
ušt64_t
 
	gd–‘e_time
;

128 
boŞ
 
	gif_exi¡s
;

131 
	s£t_commªd
 {

132 
£t_commªd
(
hql_š‹½»‹r_¡©e
 &
¡©e_
, 
cmd
è: 
¡©e
(¡©e_), 
commªd
(cmd) { }

133 
İ”©Ü
()(const *, const *) const {

134 
di¥Ïy_¡ršg
("set_command");

135 
	g¡©e
.
	gcommªd
 = 
commªd
;

137 
	ghql_š‹½»‹r_¡©e
 &
	g¡©e
;

138 
	gcommªd
;

141 
	s£t_bË_Çme
 {

142 
£t_bË_Çme
(
hql_š‹½»‹r_¡©e
 &
¡©e_
è: 
¡©e
(state_) { }

143 
İ”©Ü
()(cÚ¡ *
¡r
, cÚ¡ *
	g’d
) const {

144 
di¥Ïy_¡ršg
("set_table_name");

145 
	g¡©e
.
	gbË_Çme
 = 
¡d
::
¡ršg
(
¡r
, 
’d
-str);

146 
	gboo¡
::
Œim_if
(
¡©e
.
bË_Çme
, 
boo¡
::
is_ªy_of
("'\""));

148 
	ghql_š‹½»‹r_¡©e
 &
	g¡©e
;

151 
	s£t_if_exi¡s
 {

152 
£t_if_exi¡s
(
hql_š‹½»‹r_¡©e
 &
¡©e_
è: 
¡©e
(state_) { }

153 
İ”©Ü
()(cÚ¡ *
¡r
, cÚ¡ *
	g’d
) const {

154 
di¥Ïy_¡ršg
("set_if_exists");

155 
	g¡©e
.
	gif_exi¡s
 = 
Œue
;

157 
	ghql_š‹½»‹r_¡©e
 &
	g¡©e
;

160 
	sü—‹_cŞumn_çmy
 {

161 
ü—‹_cŞumn_çmy
(
hql_š‹½»‹r_¡©e
 &
¡©e_
è: 
¡©e
(state_) { }

162 
İ”©Ü
()(cÚ¡ *
¡r
, cÚ¡ *
	g’d
) const {

163 
di¥Ïy_¡ršg
("set_column_family");

164 
	g¡©e
.
	gcf
 = 
Ãw
 
Schema
::
CŞumnFamy
();

165 
	g¡©e
.
	gcf
->
	gÇme
 = 
¡d
::
¡ršg
(
¡r
, 
’d
-str);

166 
	gboo¡
::
Œim_if
(
¡©e
.
cf
->
Çme
, 
boo¡
::
is_ªy_of
("'\""));

167 
	gSchema
::
CŞumnFamyM­T
::
cÚ¡_™”©Ü
 
™”
 = 
¡©e
.
cf_m­
.
fšd
(¡©e.
cf
->
Çme
);

168 ià(
	g™”
 !ğ
¡©e
.
cf_m­
.
’d
())

169 
throw
 
Exû±iÚ
(
E¼Ü
::
HQL_PARSE_ERROR
, 
¡d
::
¡ršg
("CŞumÀçmy '"è+ 
¡©e
.
cf
->
Çme
 + " multiply defined.");

170 
	g¡©e
.
	gcf_m­
[
¡©e
.
cf
->
Çme
] = state.cf;

172 
	ghql_š‹½»‹r_¡©e
 &
	g¡©e
;

175 
	s£t_cŞumn_çmy_max_v”siÚs
 {

176 
£t_cŞumn_çmy_max_v”siÚs
(
hql_š‹½»‹r_¡©e
 &
¡©e_
è: 
¡©e
(state_) { }

177 
İ”©Ü
()(cÚ¡ *
¡r
, cÚ¡ *
	g’d
) const {

178 
di¥Ïy_¡ršg
("set_column_family_max_versions");

179 
	g¡©e
.
	gcf
->
	gmax_v”siÚs
 = (
ušt32_t
)
¡¹Ş
(
¡r
, 0, 10);

181 
	ghql_š‹½»‹r_¡©e
 &
	g¡©e
;

184 
	s£t_‰l
 {

185 
£t_‰l
(
hql_š‹½»‹r_¡©e
 &
¡©e_
è: 
¡©e
(state_) { }

186 
İ”©Ü
()(cÚ¡ *
¡r
, cÚ¡ *
	g’d
) const {

187 
di¥Ïy_¡ršg
("set_ttl");

188 *
	g’d_±r
;

189 
	g‰l
 = 
¡¹od
(
¡r
, &
’d_±r
);

190 
	g¡d
::
¡ršg
 
un™_¡r
 = 
¡d
::¡ršg(
’d_±r
, 
’d
-end_ptr);

191 
	g¡d
::
ŒªsfÜm
(
un™_¡r
.
begš
(), un™_¡r.
’d
(), un™_¡r.begš(), ::
tŞow”
 );

192 ià(
	gun™_¡r
.
fšd_fœ¡_of
("month") == 0)

193 
¡©e
.
cf
->
‰l
 = (
time_t
)(ttl * 2592000.0);

194 ià(
	gun™_¡r
.
fšd_fœ¡_of
("week") == 0)

195 
¡©e
.
cf
->
‰l
 = (
time_t
)(ttl * 604800.0);

196 ià(
	gun™_¡r
.
fšd_fœ¡_of
("day") == 0)

197 
¡©e
.
cf
->
‰l
 = (
time_t
)(ttl * 86400.0);

198 ià(
	gun™_¡r
.
fšd_fœ¡_of
("hour") == 0)

199 
¡©e
.
cf
->
‰l
 = (
time_t
)(ttl * 3600.0);

200 ià(
	gun™_¡r
.
fšd_fœ¡_of
("minute") == 0)

201 
¡©e
.
cf
->
‰l
 = (
time_t
)(ttl * 60.0);

203 
	g¡©e
.
	gcf
->
	g‰l
 = (
time_t
)
‰l
;

205 
	ghql_š‹½»‹r_¡©e
 &
	g¡©e
;

208 
	sü—‹_acûss_group
 {

209 
ü—‹_acûss_group
(
hql_š‹½»‹r_¡©e
 &
¡©e_
è: 
¡©e
(state_) { }

210 
İ”©Ü
()(cÚ¡ *
¡r
, cÚ¡ *
	g’d
) const {

211 
di¥Ïy_¡ršg
("create_access_group");

212 
	g¡d
::
¡ršg
 
Çme
 = 
¡d
::¡ršg(
¡r
, 
’d
-str);

213 
	gboo¡
::
Œim_if
(
Çme
, 
boo¡
::
is_ªy_of
("'\""));

214 
	gSchema
::
AcûssGroupM­T
::
cÚ¡_™”©Ü
 
™”
 = 
¡©e
.
ag_m­
.
fšd
(
Çme
);

215 ià(
	g™”
 !ğ
¡©e
.
ag_m­
.
’d
())

216 
¡©e
.
ag
 = (*
™”
).
£cÚd
;

218 
	g¡©e
.
	gag
 = 
Ãw
 
Schema
::
AcûssGroup
();

219 
	g¡©e
.
	gag
->
	gÇme
 = 
Çme
;

220 
	g¡©e
.
	gag_m­
[
¡©e
.
ag
->
Çme
] = state.ag;

223 
	ghql_š‹½»‹r_¡©e
 &
	g¡©e
;

226 
	s£t_acûss_group_š_memÜy
 {

227 
£t_acûss_group_š_memÜy
(
hql_š‹½»‹r_¡©e
 &
¡©e_
è: 
¡©e
(state_) { }

228 
İ”©Ü
()(const *, const *) const {

229 
di¥Ïy_¡ršg
("set_access_group_in_memory");

230 
	g¡©e
.
	gag
->
	gš_memÜy
=
Œue
;

232 
	ghql_š‹½»‹r_¡©e
 &
	g¡©e
;

235 
	s£t_acûss_group_com´essÜ
 {

236 
£t_acûss_group_com´essÜ
(
hql_š‹½»‹r_¡©e
 &
¡©e_
è: 
¡©e
(state_) { }

237 
İ”©Ü
()(cÚ¡ *
¡r
, cÚ¡ *
	g’d
) const {

238 
di¥Ïy_¡ršg
("set_access_group_compressor");

239 
	g¡©e
.
	gag
->
	gcom´essÜ
 = 
¡d
::
¡ršg
(
¡r
, 
’d
-str);

240 
	gboo¡
::
Œim_if
(
¡©e
.
ag
->
com´essÜ
, 
boo¡
::
is_ªy_of
("'\""));

242 
	ghql_š‹½»‹r_¡©e
 &
	g¡©e
;

245 
	s£t_acûss_group_blocksize
 {

246 
£t_acûss_group_blocksize
(
hql_š‹½»‹r_¡©e
 &
¡©e_
è: 
¡©e
(state_) { }

247 
İ”©Ü
()(cÚ¡ &
blocksize
) const {

248 
di¥Ïy_¡ršg
("set_access_group_blocksize");

249 
	g¡©e
.
	gag
->
	gblocksize
 = 
blocksize
;

251 
	ghql_š‹½»‹r_¡©e
 &
	g¡©e
;

254 
	sadd_cŞumn_çmy
 {

255 
add_cŞumn_çmy
(
hql_š‹½»‹r_¡©e
 &
¡©e_
è: 
¡©e
(state_) { }

256 
İ”©Ü
()(cÚ¡ *
¡r
, cÚ¡ *
	g’d
) const {

257 
di¥Ïy_¡ršg
("add_column_family");

258 
	g¡d
::
¡ršg
 
Çme
 = 
¡d
::¡ršg(
¡r
, 
’d
-str);

259 
	gboo¡
::
Œim_if
(
Çme
, 
boo¡
::
is_ªy_of
("'\""));

260 
	gSchema
::
CŞumnFamyM­T
::
cÚ¡_™”©Ü
 
™”
 = 
¡©e
.
cf_m­
.
fšd
(
Çme
);

261 ià(
	g™”
 =ğ
¡©e
.
cf_m­
.
’d
())

262 
throw
 
Exû±iÚ
(
E¼Ü
::
HQL_PARSE_ERROR
, 
¡d
::
¡ršg
("Acûs Grou°'"è+ 
¡©e
.
ag
->
Çme
 + "' includes unknown column family '" +‚ame + "'");

263 ià((*
	g™”
).
	g£cÚd
->
	gag
 !ğ"" && (*
™”
).
£cÚd
->
ag
 !ğ
¡©e
.ag->
Çme
)

264 
throw
 
Exû±iÚ
(
E¼Ü
::
HQL_PARSE_ERROR
, 
¡d
::
¡ršg
("CŞumÀçmy '"è+ 
Çme
 + "' can belongo only one‡ccess group");

265 (*
	g™”
).
	g£cÚd
->
	gag
 = 
¡©e
.
ag
->
Çme
;

267 
	ghql_š‹½»‹r_¡©e
 &
	g¡©e
;

270 
	s£t_bË_com´essÜ
 {

271 
£t_bË_com´essÜ
(
hql_š‹½»‹r_¡©e
 &
¡©e_
è: 
¡©e
(state_) { }

272 
İ”©Ü
()(cÚ¡ *
¡r
, cÚ¡ *
	g’d
) const {

273 
di¥Ïy_¡ršg
("set_table_compressor");

274 ià(
	g¡©e
.
	gbË_com´essÜ
 != "")

275 
throw
 
Exû±iÚ
(
E¼Ü
::
HQL_PARSE_ERROR
, 
¡d
::
¡ršg
("table compressor multiply defined"));

276 
	g¡©e
.
	gbË_com´essÜ
 = 
¡d
::
¡ršg
(
¡r
, 
’d
-str);

277 
	gboo¡
::
Œim_if
(
¡©e
.
bË_com´essÜ
, 
boo¡
::
is_ªy_of
("'\""));

279 
	ghql_š‹½»‹r_¡©e
 &
	g¡©e
;

283 
	s£t_h–p
 {

284 
£t_h–p
(
hql_š‹½»‹r_¡©e
 &
¡©e_
è: 
¡©e
(state_) { }

285 
İ”©Ü
()(cÚ¡ *
¡r
, cÚ¡ *
	g’d
) const {

286 
di¥Ïy_¡ršg
("set_help");

287 
	g¡©e
.
	gcommªd
 = 
COMMAND_HELP
;

288 
	g¡©e
.
	g¡r
 = 
¡d
::
¡ršg
(
¡r
, 
’d
-str);

289 
size_t
 
	goff£t
 = 
¡©e
.
¡r
.
fšd_fœ¡_of
(' ');

290 ià(
	goff£t
 !ğ
¡d
::
¡ršg
::
Åos
) {

291 
¡©e
.
¡r
 = s‹.¡r.
sub¡r
(
off£t
+1);

292 
	gboo¡
::
Œim
(
¡©e
.
¡r
);

293 
	g¡d
::
ŒªsfÜm
Ğ
¡©e
.
¡r
.
begš
(), s‹.¡r.
’d
(), s‹.¡r.begš(), ::
tŞow”
 );

296 
	g¡©e
.
	g¡r
 = "";

298 
	ghql_š‹½»‹r_¡©e
 &
	g¡©e
;

301 
	s£t_¡r
 {

302 
£t_¡r
(
hql_š‹½»‹r_¡©e
 &
¡©e_
è: 
¡©e
(state_) { }

303 
İ”©Ü
()(cÚ¡ *
¡r
, cÚ¡ *
	g’d
) const {

304 
di¥Ïy_¡ršg
("set_str");

305 
	g¡©e
.
	g¡r
 = 
¡d
::
¡ršg
(
¡r
, 
’d
-str);

306 
Œim_if
(
¡©e
.
¡r
, 
boo¡
::
is_ªy_of
("'\""));

308 
	ghql_š‹½»‹r_¡©e
 &
	g¡©e
;

311 
	s£t_ouut_fe
 {

312 
£t_ouut_fe
(
hql_š‹½»‹r_¡©e
 &
¡©e_
è: 
¡©e
(state_) { }

313 
İ”©Ü
()(cÚ¡ *
¡r
, cÚ¡ *
	g’d
) const {

314 
di¥Ïy_¡ršg
("set_output_file");

315 
	g¡©e
.
	gouut_fe
 = 
¡d
::
¡ršg
(
¡r
, 
’d
-str);

316 
Œim_if
(
¡©e
.
ouut_fe
, 
boo¡
::
is_ªy_of
("'\""));

318 
	ghql_š‹½»‹r_¡©e
 &
	g¡©e
;

321 
	s£t_row_key_cŞumn
 {

322 
£t_row_key_cŞumn
(
hql_š‹½»‹r_¡©e
 &
¡©e_
è: 
¡©e
(state_) { }

323 
İ”©Ü
()(cÚ¡ *
¡r
, cÚ¡ *
	g’d
) const {

324 
di¥Ïy_¡ršg
("set_row_key_column");

325 
	g¡©e
.
	grow_key_cŞumn
 = 
¡d
::
¡ršg
(
¡r
, 
’d
-str);

326 
Œim_if
(
¡©e
.
row_key_cŞumn
, 
boo¡
::
is_ªy_of
("'\""));

328 
	ghql_š‹½»‹r_¡©e
 &
	g¡©e
;

331 
	s£t_time¡amp_cŞumn
 {

332 
£t_time¡amp_cŞumn
(
hql_š‹½»‹r_¡©e
 &
¡©e_
è: 
¡©e
(state_) { }

333 
İ”©Ü
()(cÚ¡ *
¡r
, cÚ¡ *
	g’d
) const {

334 
di¥Ïy_¡ršg
("set_timestamp_column");

335 
	g¡©e
.
	gtime¡amp_cŞumn
 = 
¡d
::
¡ršg
(
¡r
, 
’d
-str);

336 
Œim_if
(
¡©e
.
time¡amp_cŞumn
, 
boo¡
::
is_ªy_of
("'\""));

338 
	ghql_š‹½»‹r_¡©e
 &
	g¡©e
;

341 
	ssÿn_add_cŞumn_çmy
 {

342 
sÿn_add_cŞumn_çmy
(
hql_š‹½»‹r_¡©e
 &
¡©e_
è: 
¡©e
(state_) { }

343 
İ”©Ü
()(cÚ¡ *
¡r
, cÚ¡ *
	g’d
) const {

344 
	g¡d
::
¡ršg
 
cŞumn_Çme
 = 
¡d
::¡ršg(
¡r
, 
’d
-str);

345 
di¥Ïy_¡ršg
("scan_add_column_family");

346 
Œim_if
(
cŞumn_Çme
, 
boo¡
::
is_ªy_of
("'\""));

347 
	g¡©e
.
	gsÿn
.
	gcŞumns
.
push_back
(
cŞumn_Çme
);

349 
	ghql_š‹½»‹r_¡©e
 &
	g¡©e
;

352 
	ssÿn_£t_di¥Ïy_time¡amps
 {

353 
sÿn_£t_di¥Ïy_time¡amps
(
hql_š‹½»‹r_¡©e
 &
¡©e_
è: 
¡©e
(state_) { }

354 
İ”©Ü
()(cÚ¡ *
¡r
, cÚ¡ *
	g’d
) const {

355 
di¥Ïy_¡ršg
("scan_set_display_timestamps");

356 
	g¡©e
.
	gsÿn
.
	gdi¥Ïy_time¡amps
=
Œue
;

358 
	ghql_š‹½»‹r_¡©e
 &
	g¡©e
;

361 
	ssÿn_£t_row
 {

362 
sÿn_£t_row
(
hql_š‹½»‹r_¡©e
 &
¡©e_
è: 
¡©e
(state_) { }

363 
İ”©Ü
()(cÚ¡ *
¡r
, cÚ¡ *
	g’d
) const {

364 
di¥Ïy_¡ršg
("scan_set_row");

365 ià(
	g¡©e
.
	gsÿn
.
	grow
 != "")

366 
throw
 
Exû±iÚ
(
E¼Ü
::
HQL_PARSE_ERROR
, 
¡d
::
¡ršg
("SELECT ROW…redicate multiply defined."));

367 ià(
	g¡©e
.
	gsÿn
.
	g¡¬t_row
 !ğ"" || 
¡©e
.
sÿn
.
’d_row
 != "")

368 
throw
 
Exû±iÚ
(
E¼Ü
::
HQL_PARSE_ERROR
, 
¡d
::
¡ršg
("SELECT conflicting„ow specifications."));

369 
	g¡©e
.
	gsÿn
.
	grow
 = 
¡d
::
¡ršg
(
¡r
, 
’d
-str);

370 
Œim_if
(
¡©e
.
sÿn
.
row
, 
boo¡
::
is_ªy_of
("'\""));

372 
	ghql_š‹½»‹r_¡©e
 &
	g¡©e
;

375 
	ssÿn_£t_row_´efix
 {

376 
sÿn_£t_row_´efix
(
hql_š‹½»‹r_¡©e
 &
¡©e_
è: 
¡©e
(state_) { }

377 
İ”©Ü
()(cÚ¡ *
¡r
, cÚ¡ *
	g’d
) const {

378 
di¥Ïy_¡ršg
("scan_set_row_prefix");

379 ià(
	g¡©e
.
	gsÿn
.
	grow
 != "")

380 
throw
 
Exû±iÚ
(
E¼Ü
::
HQL_PARSE_ERROR
, 
¡d
::
¡ršg
("SELECT ROW…redicate multiply defined."));

381 ià(
	g¡©e
.
	gsÿn
.
	g¡¬t_row
 !ğ"" || 
¡©e
.
sÿn
.
’d_row
 != "")

382 
throw
 
Exû±iÚ
(
E¼Ü
::
HQL_PARSE_ERROR
, 
¡d
::
¡ršg
("SELECT conflicting„ow specifications."));

383 
	g¡©e
.
	gsÿn
.
	g¡¬t_row
 = 
¡d
::
¡ršg
(
¡r
, 
’d
-str);

384 
Œim_if
(
¡©e
.
sÿn
.
¡¬t_row
, 
boo¡
::
is_ªy_of
("'\""));

385 
	g¡©e
.
	gsÿn
.
	g¡¬t_row_šşusive
 = 
Œue
;

386 
	g¡r
 = 
¡©e
.
sÿn
.
¡¬t_row
.
c_¡r
();

387 
	g’d
 = 
¡r
 + 
¡©e
.
sÿn
.
¡¬t_row
.
Ëngth
();

388 cÚ¡ *
	g±r
;

389 
	g±r
=
’d
-1;…Œ>
	g¡r
; --ptr) {

390 ià(*
	g±r
 < ()0xff) {

391 
	g¡©e
.
	gsÿn
.
	g’d_row
 = 
¡d
::
¡ršg
(
¡r
, 
±r
-str);

392 
	g¡©e
.
	gsÿn
.
	g’d_row
.
­³nd
(1, (*
±r
)+1);

393 
	g±r
++;

394 ià(
	g±r
 < 
	g’d
)

395 
	g¡©e
.
	gsÿn
.
	g’d_row
 +ğ
¡d
::
¡ršg
(
±r
, 
’d
-ptr);

399 ià(
	g±r
 =ğ
¡r
) {

400 
¡©e
.
sÿn
.
’d_row
 = s‹.sÿn.
¡¬t_row
;

401 
	g¡©e
.
	gsÿn
.
	g’d_row
.
­³nd
(1, ()0xff);

403 
	g¡©e
.
	gsÿn
.
	g’d_row_šşusive
 = 
çl£
;

405 
	ghql_š‹½»‹r_¡©e
 &
	g¡©e
;

408 
	ssÿn_£t_¡¬t_row
 {

409 
sÿn_£t_¡¬t_row
(
hql_š‹½»‹r_¡©e
 &
¡©e_
, 
boŞ
 
šşusive_
è: 
¡©e
(¡©e_), 
šşusive
(inclusive_) { }

410 
İ”©Ü
()(cÚ¡ *
	g¡r
, cÚ¡ *
	g’d
) const {

411 
di¥Ïy_¡ršg
("scan_set_start_row");

412 ià(
	g¡©e
.
	gsÿn
.
	grow
 != "")

413 
throw
 
Exû±iÚ
(
E¼Ü
::
HQL_PARSE_ERROR
, 
¡d
::
¡ršg
("SELECT conflicting„ow specifications."));

414 ià(
	g¡©e
.
	gsÿn
.
	g¡¬t_row
 != "")

415 
throw
 
Exû±iÚ
(
E¼Ü
::
HQL_PARSE_ERROR
, 
¡d
::
¡ršg
("SELECT„ow„ange†ower bound specified morehan once."));

416 
	g¡©e
.
	gsÿn
.
	g¡¬t_row
 = 
¡d
::
¡ršg
(
¡r
, 
’d
-str);

417 
Œim_if
(
¡©e
.
sÿn
.
¡¬t_row
, 
boo¡
::
is_ªy_of
("'\""));

418 
	g¡©e
.
	gsÿn
.
	g¡¬t_row_šşusive
 = 
šşusive
;

420 
	ghql_š‹½»‹r_¡©e
 &
	g¡©e
;

421 
boŞ
 
	gšşusive
;

424 
	ssÿn_£t_’d_row
 {

425 
sÿn_£t_’d_row
(
hql_š‹½»‹r_¡©e
 &
¡©e_
, 
boŞ
 
šşusive_
è: 
¡©e
(¡©e_), 
šşusive
(inclusive_) { }

426 
İ”©Ü
()(cÚ¡ *
	g¡r
, cÚ¡ *
	g’d
) const {

427 
di¥Ïy_¡ršg
("scan_set_end_row");

428 ià(
	g¡©e
.
	gsÿn
.
	grow
 != "")

429 
throw
 
Exû±iÚ
(
E¼Ü
::
HQL_PARSE_ERROR
, 
¡d
::
¡ršg
("SELECT conflicting„ow specifications."));

430 ià(
	g¡©e
.
	gsÿn
.
	g’d_row
 != "")

431 
throw
 
Exû±iÚ
(
E¼Ü
::
HQL_PARSE_ERROR
, 
¡d
::
¡ršg
("SELECT„ow„ange upper bound specified morehan once."));

432 
	g¡©e
.
	gsÿn
.
	g’d_row
 = 
¡d
::
¡ršg
(
¡r
, 
’d
-str);

433 
Œim_if
(
¡©e
.
sÿn
.
’d_row
, 
boo¡
::
is_ªy_of
("'\""));

434 
	g¡©e
.
	gsÿn
.
	g’d_row_šşusive
 = 
šşusive
;

436 
	ghql_š‹½»‹r_¡©e
 &
	g¡©e
;

437 
boŞ
 
	gšşusive
;

440 
	ssÿn_£t_max_v”siÚs
 {

441 
sÿn_£t_max_v”siÚs
(
hql_š‹½»‹r_¡©e
 &
¡©e_
è: 
¡©e
(state_) { }

442 
İ”©Ü
()(cÚ¡ &
iv®
) const {

443 
di¥Ïy_¡ršg
("scan_set_max_versions");

444 ià(
	g¡©e
.
	gsÿn
.
	gmax_v”siÚs
 != 0)

445 
throw
 
Exû±iÚ
(
E¼Ü
::
HQL_PARSE_ERROR
, 
¡d
::
¡ršg
("SELECT MAX_VERSIONS…redicate multiply defined."));

446 
	g¡©e
.
	gsÿn
.
	gmax_v”siÚs
 = 
iv®
;

448 
	ghql_š‹½»‹r_¡©e
 &
	g¡©e
;

451 
	ssÿn_£t_lim™
 {

452 
sÿn_£t_lim™
(
hql_š‹½»‹r_¡©e
 &
¡©e_
è: 
¡©e
(state_) { }

453 
İ”©Ü
()(cÚ¡ &
iv®
) const {

454 
di¥Ïy_¡ršg
("scan_set_limit");

455 ià(
	g¡©e
.
	gsÿn
.
	glim™
 != 0)

456 
throw
 
Exû±iÚ
(
E¼Ü
::
HQL_PARSE_ERROR
, 
¡d
::
¡ršg
("SELECT LIMIT…redicate multiply defined."));

457 
	g¡©e
.
	gsÿn
.
	glim™
 = 
iv®
;

459 
	ghql_š‹½»‹r_¡©e
 &
	g¡©e
;

462 
	ssÿn_£t_outfe
 {

463 
sÿn_£t_outfe
(
hql_š‹½»‹r_¡©e
 &
¡©e_
è: 
¡©e
(state_) { }

464 
İ”©Ü
()(cÚ¡ *
¡r
, cÚ¡ *
	g’d
) const {

465 
di¥Ïy_¡ršg
("scan_set_outfile");

466 ià(
	g¡©e
.
	gsÿn
.
	goutfe
 != "")

467 
throw
 
Exû±iÚ
(
E¼Ü
::
HQL_PARSE_ERROR
, 
¡d
::
¡ršg
("SELECT INTO FILE multiply defined."));

468 
	g¡©e
.
	gsÿn
.
	goutfe
 = 
¡d
::
¡ršg
(
¡r
, 
’d
-str);

470 
	ghql_š‹½»‹r_¡©e
 &
	g¡©e
;

473 
	ssÿn_£t_y—r
 {

474 
sÿn_£t_y—r
(
hql_š‹½»‹r_¡©e
 &
¡©e_
è: 
¡©e
(state_) { }

475 
İ”©Ü
()(cÚ¡ &
iv®
) const {

476 
di¥Ïy_¡ršg_w™h_v®
("sÿn_£t_y—r", 
iv®
);

477 
	g¡©e
.
	gtmv®
.
	gtm_y—r
 = 
iv®
 - 1900;

479 
	ghql_š‹½»‹r_¡©e
 &
	g¡©e
;

482 
	ssÿn_£t_mÚth
 {

483 
sÿn_£t_mÚth
(
hql_š‹½»‹r_¡©e
 &
¡©e_
è: 
¡©e
(state_) { }

484 
İ”©Ü
()(cÚ¡ &
iv®
) const {

485 
di¥Ïy_¡ršg_w™h_v®
("sÿn_£t_mÚth", 
iv®
);

486 
	g¡©e
.
	gtmv®
.
	gtm_mÚ
 = 
iv®
-1;

488 
	ghql_š‹½»‹r_¡©e
 &
	g¡©e
;

491 
	ssÿn_£t_day
 {

492 
sÿn_£t_day
(
hql_š‹½»‹r_¡©e
 &
¡©e_
è: 
¡©e
(state_) { }

493 
İ”©Ü
()(cÚ¡ &
iv®
) const {

494 
di¥Ïy_¡ršg_w™h_v®
("sÿn_£t_day", 
iv®
);

495 
	g¡©e
.
	gtmv®
.
	gtm_mday
 = 
iv®
;

497 
	ghql_š‹½»‹r_¡©e
 &
	g¡©e
;

500 
	ssÿn_£t_£cÚds
 {

501 
sÿn_£t_£cÚds
(
hql_š‹½»‹r_¡©e
 &
¡©e_
è: 
¡©e
(state_) { }

502 
İ”©Ü
()(cÚ¡ &
iv®
) const {

503 
di¥Ïy_¡ršg_w™h_v®
("sÿn_£t_£cÚds", 
iv®
);

504 
	g¡©e
.
	gtmv®
.
	gtm_£c
 = 
iv®
;

506 
	ghql_š‹½»‹r_¡©e
 &
	g¡©e
;

509 
	ssÿn_£t_mšu‹s
 {

510 
sÿn_£t_mšu‹s
(
hql_š‹½»‹r_¡©e
 &
¡©e_
è: 
¡©e
(state_) { }

511 
İ”©Ü
()(cÚ¡ &
iv®
) const {

512 
di¥Ïy_¡ršg_w™h_v®
("sÿn_£t_mšu‹s", 
iv®
);

513 
	g¡©e
.
	gtmv®
.
	gtm_mš
 = 
iv®
;

515 
	ghql_š‹½»‹r_¡©e
 &
	g¡©e
;

518 
	ssÿn_£t_hours
 {

519 
sÿn_£t_hours
(
hql_š‹½»‹r_¡©e
 &
¡©e_
è: 
¡©e
(state_) { }

520 
İ”©Ü
()(cÚ¡ &
iv®
) const {

521 
di¥Ïy_¡ršg_w™h_v®
("sÿn_£t_hours", 
iv®
);

522 
	g¡©e
.
	gtmv®
.
	gtm_hour
 = 
iv®
;

524 
	ghql_š‹½»‹r_¡©e
 &
	g¡©e
;

527 
	ssÿn_£t_Çno£cÚds
 {

528 
sÿn_£t_Çno£cÚds
(
hql_š‹½»‹r_¡©e
 &
¡©e_
è: 
¡©e
(state_) { }

529 
İ”©Ü
()(cÚ¡ &
iv®
) const {

530 
di¥Ïy_¡ršg_w™h_v®
("sÿn_£t_Çno£cÚds", 
iv®
);

531 
	g¡©e
.
	gÇno£cÚds
 = 
iv®
;

533 
	ghql_š‹½»‹r_¡©e
 &
	g¡©e
;

537 
	ssÿn_£t_¡¬t_time
 {

538 
sÿn_£t_¡¬t_time
(
hql_š‹½»‹r_¡©e
 &
¡©e_
, 
boŞ
 
šşusive_
è: 
¡©e
(¡©e_), 
šşusive
(inclusive_) { }

539 
İ”©Ü
()(cÚ¡ *
	g¡r
, cÚ¡ *
	g’d
) const {

540 
di¥Ïy_¡ršg
("scan_set_start_time");

541 ià(
	g¡©e
.
	gsÿn
.
	g¡¬t_time
 != 0)

542 
throw
 
Exû±iÚ
(
E¼Ü
::
HQL_PARSE_ERROR
, 
¡d
::
¡ršg
("SELECT multiple startime…redicates."));

543 
time_t
 
	gt
 = 
timegm
(&
¡©e
.
tmv®
);

544 ià(
	gt
 =ğ(
time_t
)-1)

545 
throw
 
Exû±iÚ
(
E¼Ü
::
HQL_PARSE_ERROR
, 
¡d
::
¡ršg
("SELECT invalid startime."));

546 
	g¡©e
.
	gsÿn
.
	g¡¬t_time
 = (
ušt64_t
)
t
 * 1000000000LL + 
¡©e
.
Çno£cÚds
;

547 ià(!
	gšşusive
)

548 
	g¡©e
.
	gsÿn
.
	g¡¬t_time
++;

549 
mem£t
(&
¡©e
.
tmv®
, 0, (state.tmval));

550 
	g¡©e
.
	gÇno£cÚds
 = 0;

552 
	ghql_š‹½»‹r_¡©e
 &
	g¡©e
;

553 
boŞ
 
	gšşusive
;

556 
	ssÿn_£t_’d_time
 {

557 
sÿn_£t_’d_time
(
hql_š‹½»‹r_¡©e
 &
¡©e_
, 
boŞ
 
šşusive_
è: 
¡©e
(¡©e_), 
šşusive
(inclusive_) { }

558 
İ”©Ü
()(cÚ¡ *
	g¡r
, cÚ¡ *
	g’d
) const {

559 
di¥Ïy_¡ršg
("scan_set_end_time");

560 ià(
	g¡©e
.
	gsÿn
.
	g’d_time
 != 0)

561 
throw
 
Exû±iÚ
(
E¼Ü
::
HQL_PARSE_ERROR
, 
¡d
::
¡ršg
("SELECT multipleƒndime…redicates."));

562 
time_t
 
	gt
 = 
timegm
(&
¡©e
.
tmv®
);

563 ià(
	gt
 =ğ(
time_t
)-1)

564 
throw
 
Exû±iÚ
(
E¼Ü
::
HQL_PARSE_ERROR
, 
¡d
::
¡ršg
("SELECT invalidƒndime."));

565 
	g¡©e
.
	gsÿn
.
	g’d_time
 = (
ušt64_t
)
t
 * 1000000000LL + 
¡©e
.
Çno£cÚds
;

566 
mem£t
(&
¡©e
.
tmv®
, 0, (state.tmval));

567 
	g¡©e
.
	gÇno£cÚds
 = 0;

568 ià(
	gšşusive
 && 
	g¡©e
.
	gsÿn
.
	g’d_time
 != 0)

569 
¡©e
.
sÿn
.
’d_time
--;

571 
	ghql_š‹½»‹r_¡©e
 &
	g¡©e
;

572 
boŞ
 
	gšşusive
;

575 
	ssÿn_£t_»tuº_d–‘es
 {

576 
sÿn_£t_»tuº_d–‘es
(
hql_š‹½»‹r_¡©e
 &
¡©e_
è: 
¡©e
(state_) { }

577 
İ”©Ü
()(cÚ¡ *
¡r
, cÚ¡ *
	g’d
) const {

578 
di¥Ïy_¡ršg
("scan_set_return_deletes");

579 
	g¡©e
.
	gsÿn
.
	g»tuº_d–‘es
=
Œue
;

581 
	ghql_š‹½»‹r_¡©e
 &
	g¡©e
;

584 
	ssÿn_£t_keys_Úly
 {

585 
sÿn_£t_keys_Úly
(
hql_š‹½»‹r_¡©e
 &
¡©e_
è: 
¡©e
(state_) { }

586 
İ”©Ü
()(cÚ¡ *
¡r
, cÚ¡ *
	g’d
) const {

587 
di¥Ïy_¡ršg
("scan_set_keys_only");

588 
	g¡©e
.
	gsÿn
.
	gkeys_Úly
=
Œue
;

590 
	ghql_š‹½»‹r_¡©e
 &
	g¡©e
;

593 
	s£t_š£¹_time¡amp
 {

594 
£t_š£¹_time¡amp
(
hql_š‹½»‹r_¡©e
 &
¡©e_
è: 
¡©e
(state_) { }

595 
İ”©Ü
()(cÚ¡ *
¡r
, cÚ¡ *
	g’d
) const {

596 
di¥Ïy_¡ršg
("set_insert_timestamp");

597 
time_t
 
	gt
 = 
timegm
(&
¡©e
.
tmv®
);

598 ià(
	gt
 =ğ(
time_t
)-1)

599 
throw
 
Exû±iÚ
(
E¼Ü
::
HQL_PARSE_ERROR
, 
¡d
::
¡ršg
("INSERT invalidimestamp."));

600 
	g¡©e
.
	gcu¼’t_š£¹_v®ue
.
	gtime¡amp
 = (
ušt64_t
)
t
 * 1000000000LL + 
¡©e
.
Çno£cÚds
;

601 
mem£t
(&
¡©e
.
tmv®
, 0, (state.tmval));

602 
	g¡©e
.
	gÇno£cÚds
 = 0;

604 
	ghql_š‹½»‹r_¡©e
 &
	g¡©e
;

607 
	s£t_š£¹_rowkey
 {

608 
£t_š£¹_rowkey
(
hql_š‹½»‹r_¡©e
 &
¡©e_
è: 
¡©e
(state_) { }

609 
İ”©Ü
()(cÚ¡ *
¡r
, cÚ¡ *
	g’d
) const {

610 
di¥Ïy_¡ršg
("set_insert_rowkey");

611 
	g¡©e
.
	gcu¼’t_š£¹_v®ue
.
	grow_key
 = 
¡d
::
¡ršg
(
¡r
, 
’d
-str);

612 
	gboo¡
::
Œim_if
(
¡©e
.
cu¼’t_š£¹_v®ue
.
row_key
, 
boo¡
::
is_ªy_of
("'\""));

614 
	ghql_š‹½»‹r_¡©e
 &
	g¡©e
;

617 
	s£t_š£¹_cŞumnkey
 {

618 
£t_š£¹_cŞumnkey
(
hql_š‹½»‹r_¡©e
 &
¡©e_
è: 
¡©e
(state_) { }

619 
İ”©Ü
()(cÚ¡ *
¡r
, cÚ¡ *
	g’d
) const {

620 
di¥Ïy_¡ršg
("set_insert_columnkey");

621 
	g¡©e
.
	gcu¼’t_š£¹_v®ue
.
	gcŞumn_key
 = 
¡d
::
¡ršg
(
¡r
, 
’d
-str);

622 
	gboo¡
::
Œim_if
(
¡©e
.
cu¼’t_š£¹_v®ue
.
cŞumn_key
, 
boo¡
::
is_ªy_of
("'\""));

624 
	ghql_š‹½»‹r_¡©e
 &
	g¡©e
;

627 
	s£t_š£¹_v®ue
 {

628 
£t_š£¹_v®ue
(
hql_š‹½»‹r_¡©e
 &
¡©e_
è: 
¡©e
(state_) { }

629 
İ”©Ü
()(cÚ¡ *
¡r
, cÚ¡ *
	g’d
) const {

630 
di¥Ïy_¡ršg
("set_insert_value");

631 
	g¡©e
.
	gcu¼’t_š£¹_v®ue
.
	gv®ue
 = 
¡d
::
¡ršg
(
¡r
, 
’d
-str);

632 
	gboo¡
::
Œim_if
(
¡©e
.
cu¼’t_š£¹_v®ue
.
v®ue
, 
boo¡
::
is_ªy_of
("'\""));

634 
	ghql_š‹½»‹r_¡©e
 &
	g¡©e
;

637 
	sadd_š£¹_v®ue
 {

638 
add_š£¹_v®ue
(
hql_š‹½»‹r_¡©e
 &
¡©e_
è: 
¡©e
(state_) { }

639 
İ”©Ü
()(cÚ¡ *
¡r
, cÚ¡ *
	g’d
) const {

640 
di¥Ïy_¡ršg
("add_insert_value");

641 
	g¡©e
.
	gš£¹s
.
push_back
(
¡©e
.
cu¼’t_š£¹_v®ue
);

642 
	g¡©e
.
	gcu¼’t_š£¹_v®ue
.
ş—r
();

644 
	ghql_š‹½»‹r_¡©e
 &
	g¡©e
;

647 
	sd–‘e_cŞumn
 {

648 
d–‘e_cŞumn
(
hql_š‹½»‹r_¡©e
 &
¡©e_
è: 
¡©e
(state_) { }

649 
İ”©Ü
()(cÚ¡ *
¡r
, cÚ¡ *
	g’d
) const {

650 
	g¡d
::
¡ršg
 
cŞumn
 = 
¡d
::¡ršg(
¡r
, 
’d
-str);

651 
di¥Ïy_¡ršg
("delete_column");

652 
	gboo¡
::
Œim_if
(
cŞumn
, 
boo¡
::
is_ªy_of
("'\""));

653 
	g¡©e
.
	gd–‘e_cŞumns
.
push_back
(
cŞumn
);

655 
İ”©Ü
()(cÚ¡ 
	gc
) const {

656 
di¥Ïy_¡ršg
("delete_column *");

657 
	g¡©e
.
	gd–‘e_®l_cŞumns
 = 
Œue
;

659 
	ghql_š‹½»‹r_¡©e
 &
	g¡©e
;

662 
	sd–‘e_£t_row
 {

663 
d–‘e_£t_row
(
hql_š‹½»‹r_¡©e
 &
¡©e_
è: 
¡©e
(state_) { }

664 
İ”©Ü
()(cÚ¡ *
¡r
, cÚ¡ *
	g’d
) const {

665 
di¥Ïy_¡ršg
("delete_set_row");

666 
	g¡©e
.
	gd–‘e_row
 = 
¡d
::
¡ršg
(
¡r
, 
’d
-str);

667 
Œim_if
(
¡©e
.
d–‘e_row
, 
boo¡
::
is_ªy_of
("'\""));

669 
	ghql_š‹½»‹r_¡©e
 &
	g¡©e
;

672 
	s£t_d–‘e_time¡amp
 {

673 
£t_d–‘e_time¡amp
(
hql_š‹½»‹r_¡©e
 &
¡©e_
è: 
¡©e
(state_) { }

674 
İ”©Ü
()(cÚ¡ *
¡r
, cÚ¡ *
	g’d
) const {

675 
di¥Ïy_¡ršg
("set_delete_timestamp");

676 
time_t
 
	gt
 = 
timegm
(&
¡©e
.
tmv®
);

677 ià(
	gt
 =ğ(
time_t
)-1)

678 
throw
 
Exû±iÚ
(
E¼Ü
::
HQL_PARSE_ERROR
, 
¡d
::
¡ršg
("DELETE invalidimestamp."));

679 
	g¡©e
.
	gd–‘e_time
 = (
ušt64_t
)
t
 * 1000000000LL + 
¡©e
.
Çno£cÚds
;

680 
mem£t
(&
¡©e
.
tmv®
, 0, (state.tmval));

681 
	g¡©e
.
	gÇno£cÚds
 = 0;

683 
	ghql_š‹½»‹r_¡©e
 &
	g¡©e
;

688 
	ghql_š‹½»‹r
 : 
public
 
g¿mm¬
<
hql_š‹½»‹r
> {

689 
hql_š‹½»‹r
(
hql_š‹½»‹r_¡©e
 &
¡©e_
è: 
¡©e
(state_) {}

691 
‹m¶©e
 <
ty³Çme
 
SÿÂ”T
>

692 
	sdefš™iÚ
 {

694 
defš™iÚ
(
hql_š‹½»‹r
 cÚ¡ &
£lf
) {

695 #ifdeà
BOOST_SPIRIT_DEBUG


696 
debug
();

699 
	gkeywÜds
 =

707 
	gchl™
<> 
SINGLEQUOTE
('\'');

708 
	gchl™
<> 
DOUBLEQUOTE
('"');

709 
	gchl™
<> 
QUESTIONMARK
('?');

710 
	gchl™
<> 
PLUS
('+');

711 
	gchl™
<> 
MINUS
('-');

712 
	gchl™
<> 
STAR
('*');

713 
	gchl™
<> 
SLASH
('/');

714 
	gchl™
<> 
COMMA
(',');

715 
	gchl™
<> 
SEMI
(';');

716 
	gchl™
<> 
COLON
(':');

717 
	gchl™
<> 
EQUAL
('=');

718 
	g¡¾™
<> 
DOUBLEEQUAL
("==");

719 
	gchl™
<> 
LT
('<');

720 
	g¡¾™
<> 
LE
("<=");

721 
	g¡¾™
<> 
GE
(">=");

722 
	gchl™
<> 
GT
('>');

723 
	gchl™
<> 
LPAREN
('(');

724 
	gchl™
<> 
RPAREN
(')');

725 
	gchl™
<> 
LBRACK
('[');

726 
	gchl™
<> 
RBRACK
(']');

727 
	gchl™
<> 
POINTER
('^');

728 
	gchl™
<> 
DOT
('.');

729 
	g¡¾™
<> 
DOTDOT
("..");

730 
	g¡¾™
<> 
AND
("&&");

735 
	gšhib™_ÿ£
<
	t¡¾™
<> > 
	ttok’_t
;

737 
tok’_t
 
	gCREATE
 = 
as_low”_d
["create"];

738 
tok’_t
 
	gDROP
 = 
as_low”_d
["drop"];

739 
tok’_t
 
	gHELP
 = 
as_low”_d
["help"];

740 
tok’_t
 
	gTABLE
 = 
as_low”_d
["table"];

741 
tok’_t
 
	gTABLES
 = 
as_low”_d
["tables"];

742 
tok’_t
 
	gTTL
 = 
as_low”_d
["ttl"];

743 
tok’_t
 
	gMONTHS
 = 
as_low”_d
["months"];

744 
tok’_t
 
	gMONTH
 = 
as_low”_d
["month"];

745 
tok’_t
 
	gWEEKS
 = 
as_low”_d
["weeks"];

746 
tok’_t
 
	gWEEK
 = 
as_low”_d
["week"];

747 
tok’_t
 
	gDAYS
 = 
as_low”_d
["days"];

748 
tok’_t
 
	gDAY
 = 
as_low”_d
["day"];

749 
tok’_t
 
	gHOURS
 = 
as_low”_d
["hours"];

750 
tok’_t
 
	gHOUR
 = 
as_low”_d
["hour"];

751 
tok’_t
 
	gMINUTES
 = 
as_low”_d
["minutes"];

752 
tok’_t
 
	gMINUTE
 = 
as_low”_d
["minute"];

753 
tok’_t
 
	gSECONDS
 = 
as_low”_d
["seconds"];

754 
tok’_t
 
	gSECOND
 = 
as_low”_d
["second"];

755 
tok’_t
 
	gIN_MEMORY
 = 
as_low”_d
["in_memory"];

756 
tok’_t
 
	gBLOCKSIZE
 = 
as_low”_d
["blocksize"];

757 
tok’_t
 
	gACCESS
 = 
as_low”_d
["access"];

758 
tok’_t
 
	gGROUP
 = 
as_low”_d
["group"];

759 
tok’_t
 
	gDESCRIBE
 = 
as_low”_d
["describe"];

760 
tok’_t
 
	gSHOW
 = 
as_low”_d
["show"];

761 
tok’_t
 
	gESC_HELP
 = 
as_low”_d
["\\h"];

762 
tok’_t
 
	gSELECT
 = 
as_low”_d
["select"];

763 
tok’_t
 
	gSTART_TIME
 = 
as_low”_d
["start_time"];

764 
tok’_t
 
	gEND_TIME
 = 
as_low”_d
["end_time"];

765 
tok’_t
 
	gFROM
 = 
as_low”_d
["from"];

766 
tok’_t
 
	gWHERE
 = 
as_low”_d
["where"];

767 
tok’_t
 
	gROW
 = 
as_low”_d
["row"];

768 
tok’_t
 
	gROW_KEY_COLUMN
 = 
as_low”_d
["row_key_column"];

769 
tok’_t
 
	gTIMESTAMP_COLUMN
 = 
as_low”_d
["timestamp_column"];

770 
tok’_t
 
	gSTART_ROW
 = 
as_low”_d
["start_row"];

771 
tok’_t
 
	gEND_ROW
 = 
as_low”_d
["end_row"];

772 
tok’_t
 
	gINCLUSIVE
 = 
as_low”_d
["inclusive"];

773 
tok’_t
 
	gEXCLUSIVE
 = 
as_low”_d
["exclusive"];

774 
tok’_t
 
	gMAX_VERSIONS
 = 
as_low”_d
["max_versions"];

775 
tok’_t
 
	gLIMIT
 = 
as_low”_d
["limit"];

776 
tok’_t
 
	gINTO
 = 
as_low”_d
["into"];

777 
tok’_t
 
	gFILE
 = 
as_low”_d
["file"];

778 
tok’_t
 
	gLOAD
 = 
as_low”_d
["load"];

779 
tok’_t
 
	gDATA
 = 
as_low”_d
["data"];

780 
tok’_t
 
	gINFILE
 = 
as_low”_d
["infile"];

781 
tok’_t
 
	gTIMESTAMP
 = 
as_low”_d
["timestamp"];

782 
tok’_t
 
	gINSERT
 = 
as_low”_d
["insert"];

783 
tok’_t
 
	gDELETE
 = 
as_low”_d
["delete"];

784 
tok’_t
 
	gVALUES
 = 
as_low”_d
["values"];

785 
tok’_t
 
	gCOMPRESSOR
 = 
as_low”_d
["compressor"];

786 
tok’_t
 
	gSTARTS
 = 
as_low”_d
["starts"];

787 
tok’_t
 
	gWITH
 = 
as_low”_d
["with"];

788 
tok’_t
 
	gIF
 = 
as_low”_d
["if"];

789 
tok’_t
 
	gEXISTS
 = 
as_low”_d
["exists"];

790 
tok’_t
 
	gDISPLAY_TIMESTAMPS
 = 
as_low”_d
["display_timestamps"];

791 
tok’_t
 
	gRETURN_DELETES
 = 
as_low”_d
["return_deletes"];

792 
tok’_t
 
	gKEYS_ONLY
 = 
as_low”_d
["keys_only"];

797 
	gid’tif›r


798 ğ
Ëxeme_d
[

799 (
®pha_p
 >> *(
®num_p
 | '_'))

800 - (
keywÜds
)

803 
	g¡ršg_l™”®


804 ğ
sšgË_¡ršg_l™”®


805 | 
doubË_¡ršg_l™”®


808 
	gsšgË_¡ršg_l™”®


809 ğ
Ëxeme_d
[ 
chl™
<>('\'') >>

810 +Ğ
ªych¬_p
-
chl™
<>('\'') ) >>

811 
chl™
<>('\'') ];

813 
	gdoubË_¡ršg_l™”®


814 ğ
Ëxeme_d
[ 
chl™
<>('"') >>

815 +Ğ
ªych¬_p
-
chl™
<>('"') ) >>

816 
chl™
<>('"') ];

818 
	gu£r_id’tif›r


819 ğ
id’tif›r


820 | 
¡ršg_l™”®


823 
	g¡©em’t


824 ğ
£Ëù_¡©em’t
[
£t_commªd
(
£lf
.
¡©e
, 
COMMAND_SELECT
)]

825 | 
	gü—‹_bË_¡©em’t
[
£t_commªd
(
£lf
.
¡©e
, 
COMMAND_CREATE_TABLE
)]

826 | 
	gdesüibe_bË_¡©em’t
[
£t_commªd
(
£lf
.
¡©e
, 
COMMAND_DESCRIBE_TABLE
)]

827 | 
	glßd_d©a_¡©em’t
[
£t_commªd
(
£lf
.
¡©e
, 
COMMAND_LOAD_DATA
)]

828 | 
	gshow_¡©em’t
[
£t_commªd
(
£lf
.
¡©e
, 
COMMAND_SHOW_CREATE_TABLE
)]

829 | 
	gh–p_¡©em’t
[
£t_h–p
(
£lf
.
¡©e
)]

830 | 
	gš£¹_¡©em’t
[
£t_commªd
(
£lf
.
¡©e
, 
COMMAND_INSERT
)]

831 | 
	gd–‘e_¡©em’t
[
£t_commªd
(
£lf
.
¡©e
, 
COMMAND_DELETE
)]

832 | 
	gshow_bËs_¡©em’t
[
£t_commªd
(
£lf
.
¡©e
, 
COMMAND_SHOW_TABLES
)]

833 | 
	gdrİ_bË_¡©em’t
[
£t_commªd
(
£lf
.
¡©e
, 
COMMAND_DROP_TABLE
)]

836 
	gdrİ_bË_¡©em’t


837 ğ
DROP
 >> 
TABLE
 >> !Ğ
IF
 >> 
EXISTS
[
£t_if_exi¡s
(
£lf
.
¡©e
)] ) >> 
u£r_id’tif›r
[
£t_bË_Çme
(self.state)]

840 
	gshow_bËs_¡©em’t


841 ğ
SHOW
 >> 
TABLES


844 
	gd–‘e_¡©em’t


845 ğ
DELETE
 >> 
d–‘e_cŞumn_şau£


846 >> 
FROM
 >> 
u£r_id’tif›r
[
£t_bË_Çme
(
£lf
.
¡©e
)]

847 >> 
WHERE
 >> 
ROW
 >> 
EQUAL
 >> 
¡ršg_l™”®
[
d–‘e_£t_row
(
£lf
.
¡©e
)]

848 >> !Ğ
TIMESTAMP
 >> 
d©e_ex´essiÚ
[
£t_d–‘e_time¡amp
(
£lf
.
¡©e
)] )

851 
	gd–‘e_cŞumn_şau£


852 ğĞ
STAR
[
d–‘e_cŞumn
(
£lf
.
¡©e
)] | (
cŞumn_Çme
[d–‘e_cŞumn(£lf.¡©e)] >> *Ğ
COMMA
 >> column_name[delete_column(self.state)] )) )

855 
	gš£¹_¡©em’t


856 ğ
INSERT
 >> 
INTO
 >> 
id’tif›r
[
£t_bË_Çme
(
£lf
.
¡©e
)] >> 
VALUES
 >> 
š£¹_v®ue_li¡


859 
	gš£¹_v®ue_li¡


860 ğ
š£¹_v®ue
[
add_š£¹_v®ue
(
£lf
.
¡©e
)] >> *Ğ
COMMA
 >> insert_value[add_insert_value(self.state)] )

863 
	gš£¹_v®ue


864 ğ
LPAREN
 >> *Ğ
d©e_ex´essiÚ
[
£t_š£¹_time¡amp
(
£lf
.
¡©e
)] >> 
COMMA
)

865 >> 
¡ršg_l™”®
[
£t_š£¹_rowkey
(
£lf
.
¡©e
)] >> 
COMMA


866 >> 
¡ršg_l™”®
[
£t_š£¹_cŞumnkey
(
£lf
.
¡©e
)] >> 
COMMA


867 >> 
¡ršg_l™”®
[
£t_š£¹_v®ue
 (
£lf
.
¡©e
)] >> 
RPAREN


870 
	gshow_¡©em’t


871 ğĞ
SHOW
 >> 
CREATE
 >> 
TABLE
 >> 
id’tif›r
[
£t_bË_Çme
(
£lf
.
¡©e
)] )

874 
	gh–p_¡©em’t


875 ğĞ
HELP
 | 
ESC_HELP
 | 
QUESTIONMARK
 ) >> *
ªych¬_p


878 
	gdesüibe_bË_¡©em’t


879 ğ
DESCRIBE
 >> 
TABLE
 >> 
u£r_id’tif›r
[
£t_bË_Çme
(
£lf
.
¡©e
)]

882 
	gü—‹_bË_¡©em’t


883 ğ
CREATE
 >> 
TABLE


884 >> *Ğ
bË_İtiÚ
 )

885 >> 
u£r_id’tif›r
[
£t_bË_Çme
(
£lf
.
¡©e
)]

886 >> !Ğ
ü—‹_defš™iÚs
 )

889 
	gbË_İtiÚ


890 ğ
COMPRESSOR
 >> 
EQUAL
 >> 
¡ršg_l™”®
[
£t_bË_com´essÜ
(
£lf
.
¡©e
)]

893 
	gü—‹_defš™iÚs


894 ğ
LPAREN
 >> 
ü—‹_defš™iÚ


895 >> *Ğ
COMMA
 >> 
ü—‹_defš™iÚ
 )

896 >> 
RPAREN


899 
	gü—‹_defš™iÚ


900 ğ
cŞumn_defš™iÚ


901 | 
acûss_group_defš™iÚ


904 
	gcŞumn_Çme


905 ğĞ
id’tif›r
 | 
¡ršg_l™”®
 )

908 
	gcŞumn_defš™iÚ


909 ğ
cŞumn_Çme
[
ü—‹_cŞumn_çmy
(
£lf
.
¡©e
)] >> *Ğ
cŞumn_İtiÚ
 )

912 
	gcŞumn_İtiÚ


913 ğ
max_v”siÚs_İtiÚ


914 | 
‰l_İtiÚ


917 
	gmax_v”siÚs_İtiÚ


918 ğ
MAX_VERSIONS
 >> 
EQUAL
 >> 
Ëxeme_d
[ (+
dig™_p
)[
£t_cŞumn_çmy_max_v”siÚs
(
£lf
.
¡©e
)] ]

921 
	g‰l_İtiÚ


922 ğ
TTL
 >> 
EQUAL
 >> 
du¿tiÚ
[
£t_‰l
(
£lf
.
¡©e
)]

925 
	gdu¿tiÚ


926 ğ
u»®_p
 >>

927 Ğ
MONTHS
 | 
MONTH
 | 
WEEKS
 | 
WEEK
 | 
DAYS
 | 
DAY
 | 
HOURS
 | 
HOUR
 | 
MINUTES
 | 
MINUTE
 | 
SECONDS
 | 
SECOND
 )

930 
	gacûss_group_defš™iÚ


931 ğ
ACCESS
 >> 
GROUP
 >> 
u£r_id’tif›r
[
ü—‹_acûss_group
(
£lf
.
¡©e
)]

932 >> *Ğ
acûss_group_İtiÚ
 )

933 >> !Ğ
LPAREN
 >> 
cŞumn_Çme
[
add_cŞumn_çmy
(
£lf
.
¡©e
)]

934 >> *Ğ
COMMA
 >> 
cŞumn_Çme
[
add_cŞumn_çmy
(
£lf
.
¡©e
)] ) >> 
RPAREN
 )

937 
	gacûss_group_İtiÚ


938 ğ
š_memÜy_İtiÚ
[
£t_acûss_group_š_memÜy
(
£lf
.
¡©e
)]

939 | 
blocksize_İtiÚ


940 | 
COMPRESSOR
 >> 
EQUAL
 >> 
¡ršg_l™”®
[
£t_acûss_group_com´essÜ
(
£lf
.
¡©e
)]

943 
	gš_memÜy_İtiÚ


944 ğ
IN_MEMORY


947 
	gblocksize_İtiÚ


948 ğ
BLOCKSIZE
 >> 
EQUAL
 >> 
ušt_p
[
£t_acûss_group_blocksize
(
£lf
.
¡©e
)]

951 
	g£Ëù_¡©em’t


952 ğ
SELECT


953 >> ( '*' | ( 
u£r_id’tif›r
[
sÿn_add_cŞumn_çmy
(
£lf
.
¡©e
)] >> *Ğ
COMMA
 >> user_identifier[scan_add_column_family(self.state)] ) ) )

954 >> 
FROM
 >> 
u£r_id’tif›r
[
£t_bË_Çme
(
£lf
.
¡©e
)]

955 >> !
wh”e_şau£


956 >> *Ğ
İtiÚ_¥ec
 )

959 
	gwh”e_şau£


960 ğ
WHERE
 >> 
wh”e_´ediÿ‹
 >> *Ğ
AND
 >> where_predicate )

963 
	gwh”e_´ediÿ‹


964 ğ
ROW
 >> 
EQUAL
 >> 
¡ršg_l™”®
[
sÿn_£t_row
(
£lf
.
¡©e
)]

965 | 
ROW
 >> 
DOUBLEEQUAL
 >> 
¡ršg_l™”®
[
sÿn_£t_row
(
£lf
.
¡©e
)]

966 | 
ROW
 >> 
GT
 >> 
¡ršg_l™”®
[
sÿn_£t_¡¬t_row
(
£lf
.
¡©e
, 
çl£
)]

967 | 
	gROW
 >> 
	gGE
 >> 
	g¡ršg_l™”®
[
sÿn_£t_¡¬t_row
(
£lf
.
¡©e
, 
Œue
)]

968 | 
	gROW
 >> 
	gLT
 >> 
	g¡ršg_l™”®
[
sÿn_£t_’d_row
(
£lf
.
¡©e
, 
çl£
)]

969 | 
	gROW
 >> 
	gLE
 >> 
	g¡ršg_l™”®
[
sÿn_£t_’d_row
(
£lf
.
¡©e
, 
Œue
)]

970 | 
	gROW
 >> 
	gSTARTS
 >> 
	gWITH
 >> 
	g¡ršg_l™”®
[
sÿn_£t_row_´efix
(
£lf
.
¡©e
)]

971 | 
	gTIMESTAMP
 >> 
	gGT
 >> 
	gd©e_ex´essiÚ
[
sÿn_£t_¡¬t_time
(
£lf
.
¡©e
, 
çl£
)]

972 | 
	gTIMESTAMP
 >> 
	gGE
 >> 
	gd©e_ex´essiÚ
[
sÿn_£t_¡¬t_time
(
£lf
.
¡©e
, 
Œue
)]

973 | 
	gTIMESTAMP
 >> 
	gLT
 >> 
	gd©e_ex´essiÚ
[
sÿn_£t_’d_time
(
£lf
.
¡©e
, 
çl£
)]

974 | 
	gTIMESTAMP
 >> 
	gLE
 >> 
	gd©e_ex´essiÚ
[
sÿn_£t_’d_time
(
£lf
.
¡©e
, 
Œue
)]

977 
	gİtiÚ_¥ec


978 ğ
START_TIME
 >> 
EQUAL
 >> 
d©e_ex´essiÚ
[
sÿn_£t_¡¬t_time
(
£lf
.
¡©e
, 
Œue
)]

979 | 
	gEND_TIME
 >> 
	gEQUAL
 >> 
	gd©e_ex´essiÚ
[
sÿn_£t_’d_time
(
£lf
.
¡©e
, 
çl£
)]

980 | 
	gMAX_VERSIONS
 >> 
	gEQUAL
 >> 
	gušt_p
[
sÿn_£t_max_v”siÚs
(
£lf
.
¡©e
)]

981 | 
	gLIMIT
 >> 
	gEQUAL
 >> 
	gušt_p
[
sÿn_£t_lim™
(
£lf
.
¡©e
)]

982 | 
	gINTO
 >> 
	gFILE
 >> 
	g¡ršg_l™”®
[
sÿn_£t_outfe
(
£lf
.
¡©e
)]

983 | 
	gDISPLAY_TIMESTAMPS
[
sÿn_£t_di¥Ïy_time¡amps
(
£lf
.
¡©e
)]

984 | 
	gRETURN_DELETES
[
sÿn_£t_»tuº_d–‘es
(
£lf
.
¡©e
)]

985 | 
	gKEYS_ONLY
[
sÿn_£t_keys_Úly
(
£lf
.
¡©e
)]

988 
	gd©e_ex´essiÚ


989 ğ
SINGLEQUOTE
 >> ( 
d©‘ime
 | 
d©e
 | 
time
 | 
y—r
 ) >> SINGLEQUOTE

990 | 
DOUBLEQUOTE
 >> ( 
d©‘ime
 | 
d©e
 | 
time
 | 
y—r
 ) >> DOUBLEQUOTE

993 
	gd©‘ime


994 ğ
d©e
 >> 
time


997 
	gušt_·r£r
<, 10, 2, 2> 
	gušt2_p
;

998 
	gušt_·r£r
<, 10, 4, 4> 
	gušt4_p
;

1000 
	gd©e


1001 ğ
Ëxeme_d
[

1002 
lim™_d
(0u, 9999u)[
ušt4_p
[
sÿn_£t_y—r
(
£lf
.
¡©e
)]] >> '-'

1003 >> 
lim™_d
(1u, 12u)[
ušt2_p
[
sÿn_£t_mÚth
(
£lf
.
¡©e
)]] >> '-'

1004 >> 
lim™_d
(1u, 31u)[
ušt2_p
[
sÿn_£t_day
(
£lf
.
¡©e
)]]

1008 
	gtime


1009 ğ
Ëxeme_d
[

1010 
lim™_d
(0u, 23u)[
ušt2_p
[
sÿn_£t_hours
(
£lf
.
¡©e
)]] >> ':'

1011 >> 
lim™_d
(0u, 59u)[
ušt2_p
[
sÿn_£t_mšu‹s
(
£lf
.
¡©e
)]] >> ':'

1012 >> 
lim™_d
(0u, 59u)[
ušt2_p
[
sÿn_£t_£cÚds
(
£lf
.
¡©e
)]] >>

1013 !Ğ
	gDOT
 >> 
	gušt_p
[
sÿn_£t_Çno£cÚds
(
£lf
.
¡©e
)] )

1016 
	gy—r


1017 ğ
Ëxeme_d
[ 
lim™_d
(0u, 9999u)[
ušt4_p
[
sÿn_£t_y—r
(
£lf
.
¡©e
)]] ]

1020 
	glßd_d©a_¡©em’t


1021 ğ
LOAD
 >> 
DATA
 >> 
INFILE


1022 >> !Ğ
lßd_d©a_İtiÚ
 >> *(†oad_data_option ) )

1023 >> 
¡ršg_l™”®
[
£t_¡r
(
£lf
.
¡©e
)]

1024 >> 
INTO
 >>

1025 Ğ
TABLE
 >> 
u£r_id’tif›r
[
£t_bË_Çme
(
£lf
.
¡©e
)]

1026 | 
FILE
 >> 
u£r_id’tif›r
[
£t_ouut_fe
(
£lf
.
¡©e
)] )

1029 
	glßd_d©a_İtiÚ


1030 ğ
ROW_KEY_COLUMN
 >> 
EQUAL
 >> ( 
¡ršg_l™”®
 | 
id’tif›r
 )[
£t_row_key_cŞumn
(
£lf
.
¡©e
)]

1031 | 
TIMESTAMP_COLUMN
 >> 
EQUAL
 >> ( 
¡ršg_l™”®
 | 
id’tif›r
 )[
£t_time¡amp_cŞumn
(
£lf
.
¡©e
)]

1040 #ifdeà
BOOST_SPIRIT_DEBUG


1041 
debug
() {

1042 
BOOST_SPIRIT_DEBUG_RULE
(
cŞumn_defš™iÚ
);

1043 
BOOST_SPIRIT_DEBUG_RULE
(
cŞumn_Çme
);

1044 
BOOST_SPIRIT_DEBUG_RULE
(
cŞumn_İtiÚ
);

1045 
BOOST_SPIRIT_DEBUG_RULE
(
ü—‹_defš™iÚ
);

1046 
BOOST_SPIRIT_DEBUG_RULE
(
ü—‹_defš™iÚs
);

1047 
BOOST_SPIRIT_DEBUG_RULE
(
ü—‹_bË_¡©em’t
);

1048 
BOOST_SPIRIT_DEBUG_RULE
(
du¿tiÚ
);

1049 
BOOST_SPIRIT_DEBUG_RULE
(
id’tif›r
);

1050 
BOOST_SPIRIT_DEBUG_RULE
(
u£r_id’tif›r
);

1051 
BOOST_SPIRIT_DEBUG_RULE
(
max_v”siÚs_İtiÚ
);

1052 
BOOST_SPIRIT_DEBUG_RULE
(
¡©em’t
);

1053 
BOOST_SPIRIT_DEBUG_RULE
(
¡ršg_l™”®
);

1054 
BOOST_SPIRIT_DEBUG_RULE
(
sšgË_¡ršg_l™”®
);

1055 
BOOST_SPIRIT_DEBUG_RULE
(
doubË_¡ršg_l™”®
);

1056 
BOOST_SPIRIT_DEBUG_RULE
(
‰l_İtiÚ
);

1057 
BOOST_SPIRIT_DEBUG_RULE
(
acûss_group_defš™iÚ
);

1058 
BOOST_SPIRIT_DEBUG_RULE
(
acûss_group_İtiÚ
);

1059 
BOOST_SPIRIT_DEBUG_RULE
(
š_memÜy_İtiÚ
);

1060 
BOOST_SPIRIT_DEBUG_RULE
(
blocksize_İtiÚ
);

1061 
BOOST_SPIRIT_DEBUG_RULE
(
h–p_¡©em’t
);

1062 
BOOST_SPIRIT_DEBUG_RULE
(
desüibe_bË_¡©em’t
);

1063 
BOOST_SPIRIT_DEBUG_RULE
(
show_¡©em’t
);

1064 
BOOST_SPIRIT_DEBUG_RULE
(
£Ëù_¡©em’t
);

1065 
BOOST_SPIRIT_DEBUG_RULE
(
wh”e_şau£
);

1066 
BOOST_SPIRIT_DEBUG_RULE
(
wh”e_´ediÿ‹
);

1067 
BOOST_SPIRIT_DEBUG_RULE
(
İtiÚ_¥ec
);

1068 
BOOST_SPIRIT_DEBUG_RULE
(
d©e_ex´essiÚ
);

1069 
BOOST_SPIRIT_DEBUG_RULE
(
d©‘ime
);

1070 
BOOST_SPIRIT_DEBUG_RULE
(
d©e
);

1071 
BOOST_SPIRIT_DEBUG_RULE
(
time
);

1072 
BOOST_SPIRIT_DEBUG_RULE
(
y—r
);

1073 
BOOST_SPIRIT_DEBUG_RULE
(
lßd_d©a_¡©em’t
);

1074 
BOOST_SPIRIT_DEBUG_RULE
(
lßd_d©a_İtiÚ
);

1075 
BOOST_SPIRIT_DEBUG_RULE
(
š£¹_¡©em’t
);

1076 
BOOST_SPIRIT_DEBUG_RULE
(
š£¹_v®ue_li¡
);

1077 
BOOST_SPIRIT_DEBUG_RULE
(
š£¹_v®ue
);

1078 
BOOST_SPIRIT_DEBUG_RULE
(
d–‘e_¡©em’t
);

1079 
BOOST_SPIRIT_DEBUG_RULE
(
d–‘e_cŞumn_şau£
);

1080 
BOOST_SPIRIT_DEBUG_RULE
(
bË_İtiÚ
);

1081 
BOOST_SPIRIT_DEBUG_RULE
(
show_bËs_¡©em’t
);

1082 
BOOST_SPIRIT_DEBUG_RULE
(
drİ_bË_¡©em’t
);

1086 
	gruË
<
	gSÿÂ”T
> const&

1087 
¡¬t
(ècÚ¡ {  
	g¡©em’t
; }

1088 
	gsymbŞs
<> 
	gkeywÜds
;

1089 
	gruË
<
	gSÿÂ”T
>

1090 
	gcŞumn_defš™iÚ
, 
	gcŞumn_Çme
, 
	gcŞumn_İtiÚ
, 
	gü—‹_defš™iÚ
, 
	gü—‹_defš™iÚs
,

1091 
	gü—‹_bË_¡©em’t
, 
	gdu¿tiÚ
, 
	gid’tif›r
, 
	gu£r_id’tif›r
, 
	gmax_v”siÚs_İtiÚ
,

1092 
	g¡©em’t
, 
	gsšgË_¡ršg_l™”®
, 
	gdoubË_¡ršg_l™”®
, 
	g¡ršg_l™”®
,

1093 
	g‰l_İtiÚ
, 
	gacûss_group_defš™iÚ
,

1094 
	gacûss_group_İtiÚ
, 
	gš_memÜy_İtiÚ
, 
	gblocksize_İtiÚ
, 
	gh–p_¡©em’t
,

1095 
	gdesüibe_bË_¡©em’t
, 
	gshow_¡©em’t
, 
	g£Ëù_¡©em’t
, 
	gwh”e_şau£
,

1096 
	gwh”e_´ediÿ‹
, 
	gİtiÚ_¥ec
, 
	gd©e_ex´essiÚ
, 
	gd©‘ime
, 
	gd©e
, 
	gtime
,

1097 
	gy—r
, 
	glßd_d©a_¡©em’t
, 
	glßd_d©a_İtiÚ
, 
	gš£¹_¡©em’t
, 
	gš£¹_v®ue_li¡
,

1098 
	gš£¹_v®ue
, 
	gd–‘e_¡©em’t
, 
	gd–‘e_cŞumn_şau£
, 
	gbË_İtiÚ
,

1099 
	gshow_bËs_¡©em’t
, 
	gdrİ_bË_¡©em’t
;

1102 
	ghql_š‹½»‹r_¡©e
 &
	g¡©e
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/Key.cc

21 
	~<ÿs£¹
>

22 
	~<io¡»am
>

24 
	~"CommÚ/By‹Ord”.h
"

26 
	~"Key.h
"

28 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

29 
usšg
 
Çme¥aû
 
	g¡d
;

31 
	gÇme¥aû
 {

32 cÚ¡ 
	g’d_row_ch¬s
[3] = { ()0xff, ()0xff, 0 };

33 cÚ¡ 
	g’d_roÙ_row_ch¬s
[5] = { '0', ':', ()0xff, ()0xff, 0 };

37 
Çme¥aû
 
	gHy³¹abË
 {

39 cÚ¡ *
	gKey
::
END_ROW_MARKER
 = (cÚ¡ *)
’d_row_ch¬s
;

40 cÚ¡ *
	gKey
::
END_ROOT_ROW
 = (cÚ¡ *)
’d_roÙ_row_ch¬s
;

42 
C»©eKey
(
By‹SŒšg32T
 *
key
, 
ušt8_t
 
æag
, cÚ¡ *
row
, ušt8_ˆ
cŞumn_çmy_code
, cÚ¡ *
cŞumn_qu®if›r
, 
ušt64_t
 
time¡amp
) {

43 
size_t
 
	gËn
 = 
¡¾’
(
row
è+ 4 + (
št64_t
);

44 ià(
	gcŞumn_qu®if›r
 != 0)

45 
Ën
 +ğ
¡¾’
(
cŞumn_qu®if›r
);

46 
ušt8_t
 *
	g±r
 = 
key
->
d©a
;

47 
	gkey
->
	gËn
 = 
Ën
;

48 
¡rıy
((*)
±r
, 
row
);

49 
	g±r
 +ğ
¡¾’
(
row
) + 1;

50 *
	g±r
++ = 
cŞumn_çmy_code
;

51 ià(
	gcŞumn_qu®if›r
 != 0) {

52 
¡rıy
((*)
±r
, 
cŞumn_qu®if›r
);

53 
	g±r
 +ğ
¡¾’
(
cŞumn_qu®if›r
) + 1;

56 *
	g±r
++ = 0;

57 *
	g±r
++ = 
æag
;

58 ià(
	gtime¡amp
 == 0) {

59 
mem£t
(
±r
, 0xFF, (
št64_t
));

60 
	g±r
 +ğ(
št64_t
);

63 
	gtime¡amp
 = ~
time¡amp
;

64 
ušt8_t
 *
	gtsPŒ
 = (ušt8_ˆ*)&
time¡amp
;

65 
	gtsPŒ
 +ğ(
št64_t
);

66 
size_t
 
	gi
=0; i<(
	gšt64_t
); i++) {

67 
	gtsPŒ
--;

68 *
	g±r
++ = *
tsPŒ
;

71 
as£¹
((
±r
-
key
->
d©a
è=ğ(
št32_t
)key->
Ën
);

74 
By‹SŒšg32T
 *
C»©eKey
(
ušt8_t
 
æag
, cÚ¡ *
row
, ušt8_ˆ
cŞumn_çmy_code
, cÚ¡ *
cŞumn_qu®if›r
, 
ušt64_t
 
time¡amp
) {

75 
size_t
 
	gËn
 = 
¡¾’
(
row
è+ 4 + (
št64_t
);

76 ià(
	gcŞumn_qu®if›r
 != 0)

77 
Ën
 +ğ
¡¾’
(
cŞumn_qu®if›r
);

78 
By‹SŒšg32T
 *
	gkey
 = (By‹SŒšg32T *)
Ãw
 
ušt8_t
 [ 
Ën
 + (
št32_t
) ];

79 
C»©eKey
(
key
, 
æag
, 
row
, 
cŞumn_çmy_code
, 
cŞumn_qu®if›r
, 
time¡amp
);

80  
	gkey
;

83 
C»©eKeyAndAµ’d
(
DyÇmicBufãr
 &
d¡_buf
, 
ušt8_t
 
æag
, cÚ¡ *
row
, ušt8_ˆ
cŞumn_çmy_code
, cÚ¡ *
cŞumn_qu®if›r
, 
ušt64_t
 
time¡amp
) {

84 
size_t
 
	gËn
 = 
¡¾’
(
row
è+ 4 + (
št64_t
);

85 ià(
	gcŞumn_qu®if›r
 != 0)

86 
Ën
 +ğ
¡¾’
(
cŞumn_qu®if›r
);

87 
	gd¡_buf
.
’su»
(
Ën
 + 4);

88 
C»©eKey
((
By‹SŒšg32T
 *)
d¡_buf
.
±r
, 
æag
, 
row
, 
cŞumn_çmy_code
, 
cŞumn_qu®if›r
, 
time¡amp
);

89 
	gd¡_buf
.
	g±r
 +ğ
L’gth
((
By‹SŒšg32T
 *)
d¡_buf
.
±r
);

92 
	gKey
::
Key
(cÚ¡ 
By‹SŒšg32T
 *
key
) {

93 
lßd
(
key
);

99 
boŞ
 
	gKey
::
lßd
(cÚ¡ 
By‹SŒšg32T
 *
key
) {

100 cÚ¡ 
ušt8_t
 *
±r
 = 
key
->
d©a
;

101 cÚ¡ 
ušt8_t
 *
	g’d±r
 = 
key
->
d©a
 + key->
Ën
;

103 
	grow
 = (cÚ¡ *)
±r
;

105 
	g±r
 < 
	g’d±r
 && *ptr != 0)

106 
±r
++;

107 
	g±r
++;

108 ià(
	g±r
 >ğ
’d±r
) {

109 
û¼
 << "row decodov”run" << 
’dl
;

110  
	gçl£
;

113 
	gcŞumn_çmy_code
 = *
±r
++;

114 
	gcŞumn_qu®if›r
 = (cÚ¡ *)
±r
;

116 
	g±r
 < 
	g’d±r
 && *ptr != 0)

117 
±r
++;

118 
	g±r
++;

119 ià(
	g±r
 >ğ
’d±r
) {

120 
û¼
 << "qu®if›¸decodov”run" << 
’dl
;

121  
	gçl£
;

124 ià((
	g’d±r
 - 
	g±r
) != 9) {

125 
û¼
 << "time¡am°decodov”ruÀ" << (
’d±r
-
±r
è<< 
’dl
;

126  
	gçl£
;

129 
	gæag
 = *
±r
++;

130 
	gtime¡amp_±r
 = (
ušt8_t
 *)
±r
;

131 
memıy
(&
time¡amp
, 
±r
, (
ušt64_t
));

132 
	g’d_±r
 = 
±r
 + (
ušt64_t
);

134 
	gtime¡amp
 = 
By‹Ord”Sw­IÁ64
(
time¡amp
);

135 
	gtime¡amp
 = ~
time¡amp
;

137  
	gŒue
;

140 
	gKey
::
upd©eTime¡amp
(
ušt64_t
 
ts
) {

141 
time¡amp
 = 
ts
;

142 
	gts
 = 
By‹Ord”Sw­IÁ64
(
ts
);

143 
	gts
 = ~
ts
;

144 
memıy
(
time¡amp_±r
, &
ts
, (
št64_t
));

149 
	g¡d
::
o¡»am
 &
İ”©Ü
<<(
¡d
::o¡»am &
os
, cÚ¡ 
	gKey
 &
	gkeyComps
) {

150 
	gos
 << "row='" << 
	gkeyComps
.
	grow
 << "' ";

151 ià(
	gkeyComps
.
	gæag
 =ğ
FLAG_DELETE_ROW
)

152 
os
 << "ts=" << 
keyComps
.
time¡amp
 << " DELETE";

154 
	gos
 << "çmy=" << ()
	gkeyComps
.
	gcŞumn_çmy_code
;

155 ià(
	gkeyComps
.
	gcŞumn_qu®if›r
)

156 
	gos
 << " qu®if›r='" << 
	gkeyComps
.
	gcŞumn_qu®if›r
 << "'";

157 
	gos
 << "s=" << 
	gkeyComps
.
	gtime¡amp
;

158 ià(
	gkeyComps
.
	gæag
 =ğ
FLAG_DELETE_CELL
)

159 
os
 << " DELETE";

160 ià(
	gkeyComps
.
	gæag
 =ğ
FLAG_DELETE_COLUMN_FAMILY
)

161 
os
 << " DELETE_COLUMN_FAMILY";

163  
	gos
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/Key.h

21 #iâdeà
HYPERTABLE_KEY_H


22 
	#HYPERTABLE_KEY_H


	)

24 
	~<io¡»am
>

26 
	~<boo¡/sh¬ed_¬¿y.hµ
>

28 
	~"CommÚ/By‹SŒšg.h
"

29 
	~"CommÚ/DyÇmicBufãr.h
"

31 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

33 
Çme¥aû
 
	gHy³¹abË
 {

35 cÚ¡ 
ušt32_t
 
	gFLAG_DELETE_ROW
 = 0x00;

36 cÚ¡ 
ušt32_t
 
	gFLAG_DELETE_COLUMN_FAMILY
 = 0x01;

37 cÚ¡ 
ušt32_t
 
	gFLAG_DELETE_CELL
 = 0x02;

38 cÚ¡ 
ušt32_t
 
	gFLAG_INSERT
 = 0xFF;

42 şas 
	cKey
 {

43 
	gpublic
:

45 cÚ¡ *
END_ROW_MARKER
;

46 cÚ¡ *
	gEND_ROOT_ROW
;

51 
Key
(è: 
time¡amp_±r
(0) { ; }

59 
Key
(cÚ¡ 
By‹SŒšg32T
 *
key
);

67 
boŞ
 
lßd
(cÚ¡ 
By‹SŒšg32T
 *
key
);

75 
upd©eTime¡amp
(
ušt64_t
 
time¡amp
);

77 cÚ¡ *
	grow
;

78 cÚ¡ *
	gcŞumn_qu®if›r
;

79 
ušt64_t
 
	gtime¡amp
;

80 
ušt8_t
 
	gcŞumn_çmy_code
;

81 
ušt8_t
 
	gæag
;

82 
ušt8_t
 *
	gtime¡amp_±r
;

83 cÚ¡ 
ušt8_t
 *
	g’d_±r
;

94 
	g¡d
::
o¡»am
 &
İ”©Ü
<<(
¡d
::o¡»am &
os
, cÚ¡ 
	gKey
 &
	gkey
);

97 
C»©eKey
(
By‹SŒšg32T
 *
key
, 
ušt8_t
 
æag
, cÚ¡ *
row
, ušt8_ˆ
cŞumn_çmy_code
, cÚ¡ *
cŞumn_qu®if›r
, 
ušt64_t
 
time¡amp
);

113 
By‹SŒšg32T
 *
C»©eKey
(
ušt8_t
 
æag
, cÚ¡ *
row
, ušt8_ˆ
cŞumn_çmy_code
, cÚ¡ *
cŞumn_qu®if›r
, 
ušt64_t
 
time¡amp
);

115 
C»©eKeyAndAµ’d
(
DyÇmicBufãr
 &
d¡_buf
, 
ušt8_t
 
æag
, cÚ¡ *
row
, ušt8_ˆ
cŞumn_çmy_code
, cÚ¡ *
cŞumn_qu®if›r
, 
ušt64_t
 
time¡amp
);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/KeySpec.h

21 #iâdeà
HYPERTABLE_KEYSPEC_H


22 
	#HYPERTABLE_KEYSPEC_H


	)

25 
	~<sys/ty³s.h
>

28 
Çme¥aû
 
Hy³¹abË
 {

30 şas 
	cKeyS³c
 {

31 
public
:

32 cÚ¡ *
row
;

33 
size_t
 
row_Ën
;

34 cÚ¡ *
cŞumn_çmy
;

35 cÚ¡ *
cŞumn_qu®if›r
;

36 
size_t
 
cŞumn_qu®if›r_Ën
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/LoadDataSource.cc

21 
	~<û¼no
>

22 
	~<cùy³
>

23 
	~<c¡ršg
>

25 
	~<boo¡/®gÜ™hm/¡ršg.hµ
>

26 
	~<boo¡/sh¬ed_¬¿y.hµ
>

29 
	~<¡ršgs.h
>

30 
	~<time.h
>

33 
	~"CommÚ/By‹Ord”.h
"

34 
	~"CommÚ/DyÇmicBufãr.h
"

35 
	~"CommÚ/E¼Ü.h
"

37 
	~"Key.h
"

39 
	~"LßdD©aSourû.h
"

41 
usšg
 
Çme¥aû
 
Hy³¹abË
;

42 
usšg
 
Çme¥aû
 
	g¡d
;

47 
	gLßdD©aSourû
::
LßdD©aSourû
(
¡d
::
¡ršg
 
âame
, std::¡ršg 
row_key_cŞumn
, std::¡ršg 
time¡amp_cŞumn
è: 
m_âame
(âame), 
m_cur_lše
(0), 
m_lše_bufãr
(0), 
m_hy³rfÜm©
(
çl£
), 
m_Ëadšg_time¡amps
(çl£), 
m_row_šdex
(0), 
m_time¡amp_šdex
(-1), 
	$m_time¡amp
(0) {

48 
¡ršg
 
lše
, 
cŞumn_Çme
;

49 *
ba£
, *
±r
;

50 
šdex
 = 0;

52 
	`VK_SET_FILE_KIND
(2, 
âame
.
	`c_¡r
());

53 
m_fš
.
	`İ’
(
âame
.
	`c_¡r
());

55 ià(!
	`g‘lše
(
m_fš
, 
lše
))

58 
ba£
 = (*)
lše
.
	`c_¡r
();

61 ià(*
ba£
 == '#') {

62 
ba£
++;

63 
	`is¥aû
(*
ba£
))

64 
ba£
++;

66 (
±r
 = 
	`¡rchr
(
ba£
, '\t')) != 0) {

67 *
±r
++ = 0;

68 
m_cŞumn_Çmes
.
	`push_back
(
ba£
);

69 
cŞumn_Çme
 = 
¡d
::
	`¡ršg
(
ba£
);

70 ià(
row_key_cŞumn
 !ğ"" &&„ow_key_cŞumÀ=ğ
cŞumn_Çme
)

71 
m_row_šdex
 = 
šdex
;

72 ià(
time¡amp_cŞumn
 !ğ"" &&ime¡amp_cŞumÀ=ğ
cŞumn_Çme
)

73 
m_time¡amp_šdex
 = 
šdex
;

74 
ba£
 = 
±r
;

75 
šdex
++;

77 
m_cŞumn_Çmes
.
	`push_back
(
ba£
);

79 ià(
m_cŞumn_Çmes
.
	`size
() == 3 || m_column_names.size() == 4) {

80 
size_t
 
i
=
m_cŞumn_Çmes
.
	`size
()-3;

81 ià(
m_cŞumn_Çmes
[
i
] == "rowkey" &&

82 
m_cŞumn_Çmes
[
i
+1] == "columnkey" &&

83 
m_cŞumn_Çmes
[
i
+2] == "value") {

84 ià(
i
 =ğ0 || 
m_cŞumn_Çmes
[0] == "timestamp") {

85 
m_hy³rfÜm©
 = 
Œue
;

86 
m_Ëadšg_time¡amps
 = (
i
==1);

91 
m_Ãxt_v®ue
 = 
m_cŞumn_Çmes
.
	`size
();

92 
m_lim™
 = 0;

94 ià(!
m_hy³rfÜm©
 && 
m_cŞumn_Çmes
.
	`size
() < 2)

95 
throw
 
	`Exû±iÚ
(
E¼Ü
::
HQL_BAD_LOAD_FILE_FORMAT
, "No columns specified in†oad file");

97 
m_cur_lše
 = 1;

100 
	}
}

106 
boŞ
 
	gLßdD©aSourû
::
	$Ãxt
(
ušt32_t
 *
ty³_æagp
, 
ušt64_t
 *
time¡amµ
, 
KeyS³c
 *
keyp
, 
ušt8_t
 **
v®u•
, ušt32_ˆ*
v®ue_ËÅ
, ušt32_ˆ*
cÚsumedp
) {

107 
¡ršg
 
lše
;

108 *
ba£
, *
±r
, *
cŞÚ
, *
’d±r
;

110 ià(
ty³_æagp
)

111 *
ty³_æagp
 = 
FLAG_INSERT
;

113 ià(
cÚsumedp
)

114 *
cÚsumedp
 = 0;

116 ià(
m_hy³rfÜm©
) {

118 
	`g‘lše
(
m_fš
, 
lše
)) {

119 
m_cur_lše
++;

121 ià(
cÚsumedp
)

122 *
cÚsumedp
 +ğ
lše
.
	`Ëngth
() + 1;

124 
m_lše_bufãr
.
	`ş—r
();

126 
m_lše_bufãr
.
	`add
(
lše
.
	`c_¡r
(), 
	`¡¾’
(line.c_str())+1);

128 
ba£
 = (*)
m_lše_bufãr
.
buf
;

133 ià(
m_Ëadšg_time¡amps
) {

134 ià((
±r
 = 
	`¡rchr
(
ba£
, '\t')) == 0) {

135 
û¼
 << "”rÜ:oØãw f›ld Ú†š" << 
m_cur_lše
 << 
’dl
;

138 *
±r
++ = 0;

139 *
time¡amµ
 = 
	`¡¹Şl
(
ba£
, &
’d±r
, 10);

140 ià(*
’d±r
 != 0) {

141 
û¼
 << "”rÜ: inv®idime¡am°(" << 
ba£
 << "èÚ†š" << 
m_cur_lše
 << 
’dl
;

144 
ba£
 = 
±r
;

147 *
time¡amµ
 = 0;

152 ià((
±r
 = 
	`¡rchr
(
ba£
, '\t')) == 0) {

153 
û¼
 << "”rÜ:oØãw f›ld Ú†š" << 
m_cur_lše
 << 
’dl
;

156 
keyp
->
row
 = 
ba£
;

157 
keyp
->
row_Ën
 = 
±r
 - 
ba£
;

158 *
±r
++ = 0;

159 
ba£
 = 
±r
;

164 ià((
±r
 = 
	`¡rchr
(
ba£
, '\t')) == 0) {

165 
û¼
 << "”rÜ:oØãw f›ld Ú†š" << 
m_cur_lše
 << 
’dl
;

168 *
±r
 = 0;

170 ià((
cŞÚ
 = 
	`¡rchr
(
ba£
, ':')) != 0) {

171 *
cŞÚ
++ = 0;

172 
keyp
->
cŞumn_çmy
 = 
ba£
;

173 ià(
cŞÚ
 < 
±r
) {

174 
keyp
->
cŞumn_qu®if›r
 = 
cŞÚ
;

175 
keyp
->
cŞumn_qu®if›r_Ën
 = 
±r
 - 
cŞÚ
;

178 
keyp
->
cŞumn_qu®if›r
 = 0;

179 
keyp
->
cŞumn_qu®if›r_Ën
 = 0;

183 
keyp
->
cŞumn_qu®if›r
 = 0;

184 
keyp
->
cŞumn_qu®if›r_Ën
 = 0;

186 
keyp
->
cŞumn_çmy
 = 
ba£
;

187 
±r
++;

192 *
v®u•
 = (
ušt8_t
 *)
±r
;

193 *
v®ue_ËÅ
 = 
	`¡¾’
(
±r
);

195  
Œue
;

200 
m_Ãxt_v®ue
 =ğ(
size_t
)
m_time¡amp_šdex
 || m_Ãxt_v®u=ğ(size_t)
m_row_šdex
)

201 
m_Ãxt_v®ue
++;

203 ià(
m_Ãxt_v®ue
 > 0 && m_Ãxt_v®u< (
size_t
)
m_lim™
) {

204 
keyp
->
row
 = 
m_v®ues
[
m_row_šdex
];

205 
keyp
->
row_Ën
 = 
m_cur_row_Ëngth
;

206 
keyp
->
cŞumn_çmy
 = 
m_cŞumn_Çmes
[
m_Ãxt_v®ue
].
	`c_¡r
();

207 *
time¡amµ
 = 
m_time¡amp
;

209 ià(
keyp
->
cŞumn_qu®if›r
 || keyp->
cŞumn_qu®if›r_Ën
) {

210 
keyp
->
cŞumn_qu®if›r
 = 0;

211 
keyp
->
cŞumn_qu®if›r_Ën
 = 0;

213 ià(
m_v®ues
[
m_Ãxt_v®ue
] == 0) {

214 *
v®u•
 = 0;

215 *
v®ue_ËÅ
 = 0;

218 *
v®u•
 = (
ušt8_t
 *)
m_v®ues
[
m_Ãxt_v®ue
];

219 *
v®ue_ËÅ
 = 
	`¡¾’
(
m_v®ues
[
m_Ãxt_v®ue
]);

221 
m_Ãxt_v®ue
++;

222  
Œue
;

225 
	`g‘lše
(
m_fš
, 
lše
)) {

226 
m_cur_lše
++;

228 ià(
cÚsumedp
)

229 *
cÚsumedp
 +ğ
lše
.
	`Ëngth
() + 1;

231 
m_lše_bufãr
.
	`ş—r
();

232 
m_lše_bufãr
.
	`add
(
lše
.
	`c_¡r
(), 
	`¡¾’
(line.c_str())+1);

233 
m_v®ues
.
	`ş—r
();

235 
ba£
 = (*)
m_lše_bufãr
.
buf
;

237 (
±r
 = 
	`¡rchr
(
ba£
, '\t')) != 0) {

238 *
±r
++ = 0;

239 ià(
	`¡¾’
(
ba£
è=ğ0 || !
	`¡rcmp
(base, "NULL") || !strcmp(base, "\\N"))

240 
m_v®ues
.
	`push_back
(0);

242 
m_v®ues
.
	`push_back
(
ba£
);

243 
ba£
 = 
±r
;

245 ià(
	`¡¾’
(
ba£
è=ğ0 || !
	`¡rcmp
(base, "NULL") || !strcmp(base, "\\N"))

246 
m_v®ues
.
	`push_back
(0);

248 
m_v®ues
.
	`push_back
(
ba£
);

249 
m_lim™
 = 
¡d
::
	`mš
(
m_v®ues
.
	`size
(), 
m_cŞumn_Çmes
.size());

251 ià(
m_time¡amp_šdex
 >= 0) {

252 
tm
m;

253 
time_t
 
t
;

255 ià(
m_v®ues
.
	`size
(è<ğ(
size_t
)
m_time¡amp_šdex
) {

256 
û¼
 << "w¬n:ime¡am°f›ld‚Ù found oÀlš" << 
m_cur_lše
 << ", skpšg..." << 
’dl
;

260 ià(!
	`·r£_d©e_fÜm©
(
m_v®ues
[
m_time¡amp_šdex
], &
tm
)) {

261 
û¼
 << "w¬n: inv®idime¡am°fÜm© oÀlš" << 
m_cur_lše
 << ", skpšg..." << 
’dl
;

265 ià((
t
 = 
	`timegm
(&
tm
)è=ğ(
time_t
)-1) {

266 
û¼
 << "w¬n: inv®idime¡am°fÜm© oÀlš" << 
m_cur_lše
 << ", skpšg..." << 
’dl
;

270 
m_time¡amp
 = (
ušt64_t
)
t
 * 1000000000LL;

273 ià(
m_v®ues
[
m_row_šdex
] == 0) {

274 
û¼
 << "”rÜ: NULL„ow key oÀlš" << 
m_cur_lše
 << 
’dl
;

278 
m_Ãxt_v®ue
 = 0;

279 
m_Ãxt_v®ue
 =ğ(
size_t
)
m_time¡amp_šdex
 || m_Ãxt_v®u=ğ(size_t)
m_row_šdex
)

280 
m_Ãxt_v®ue
++;

282 
m_cur_row_Ëngth
 = 
	`¡¾’
(
m_v®ues
[
m_row_šdex
]);

284 
keyp
->
row
 = 
m_v®ues
[
m_row_šdex
];

285 
keyp
->
row_Ën
 = 
m_cur_row_Ëngth
;

286 
keyp
->
cŞumn_çmy
 = 
m_cŞumn_Çmes
[
m_Ãxt_v®ue
].
	`c_¡r
();

287 *
time¡amµ
 = 
m_time¡amp
;

288 ià(
keyp
->
cŞumn_qu®if›r
 || keyp->
cŞumn_qu®if›r_Ën
) {

289 
keyp
->
cŞumn_qu®if›r
 = 0;

290 
keyp
->
cŞumn_qu®if›r_Ën
 = 0;

292 ià(
m_v®ues
[
m_Ãxt_v®ue
] == 0) {

293 *
v®u•
 = 0;

294 *
v®ue_ËÅ
 = 0;

297 *
v®u•
 = (
ušt8_t
 *)
m_v®ues
[
m_Ãxt_v®ue
];

298 *
v®ue_ËÅ
 = 
	`¡¾’
(
m_v®ues
[
m_Ãxt_v®ue
]);

300 
m_Ãxt_v®ue
++;

302  
Œue
;

307  
çl£
;

308 
	}
}

312 
boŞ
 
	gLßdD©aSourû
::
	$·r£_d©e_fÜm©
(cÚ¡ *
¡r
, 
tm
 *tm) {

313 
iv®
;

314 cÚ¡ *
±r
 = 
¡r
;

315 *
’d_±r
;

320 ià((
iv®
 = 
	`¡¹Ş
(
±r
, &
’d_±r
, 10)) == 0 || (end_ptr -…tr) != 4 || *end_ptr != '-')

321  
çl£
;

322 
tm
->
tm_y—r
 = 
iv®
 - 1900;

324 
±r
 = 
’d_±r
 + 1;

329 ià((
iv®
 = 
	`¡¹Ş
(
±r
, &
’d_±r
, 10)) == 0 || (end_ptr -…tr) != 2 || *end_ptr != '-')

330  
çl£
;

331 
tm
->
tm_mÚ
 = 
iv®
 - 1;

333 
±r
 = 
’d_±r
 + 1;

338 ià((
iv®
 = 
	`¡¹Ş
(
±r
, &
’d_±r
, 10)) == 0 || (end_ptr -…tr) != 2 || *end_ptr != ' ')

339  
çl£
;

340 
tm
->
tm_mday
 = 
iv®
;

342 
±r
 = 
’d_±r
 + 1;

347 
iv®
 = 
	`¡¹Ş
(
±r
, &
’d_±r
, 10);

348 ià((
’d_±r
 - 
±r
) != 2 || *end_ptr != ':')

349  
çl£
;

350 
tm
->
tm_hour
 = 
iv®
;

352 
±r
 = 
’d_±r
 + 1;

357 
iv®
 = 
	`¡¹Ş
(
±r
, &
’d_±r
, 10);

358 ià((
’d_±r
 - 
±r
) != 2 || *end_ptr != ':')

359  
çl£
;

360 
tm
->
tm_mš
 = 
iv®
;

362 
±r
 = 
’d_±r
 + 1;

367 
iv®
 = 
	`¡¹Ş
(
±r
, &
’d_±r
, 10);

368 ià((
’d_±r
 - 
±r
) != 2)

369  
çl£
;

370 
tm
->
tm_£c
 = 
iv®
;

372 
tm
->
tm_gmtoff
 = 0;

373 
tm
->
tm_zÚe
 = "GMT";

375  
Œue
;

376 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/LoadDataSource.h

21 #iâdeà
HYPERTABLE_LOADDATASOURCE_H


22 
	#HYPERTABLE_LOADDATASOURCE_H


	)

24 
	~<f¡»am
>

25 
	~<io¡»am
>

26 
	~<¡ršg
>

27 
	~<veùÜ
>

29 
	~"CommÚ/By‹SŒšg.h
"

30 
	~"CommÚ/DyÇmicBufãr.h
"

32 
	~"D©aSourû.h
"

33 
	~<vk.h
>

35 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

37 
Çme¥aû
 
	gHy³¹abË
 {

39 şas 
	cLßdD©aSourû
 {

41 
	gpublic
:

42 
LßdD©aSourû
(
¡d
::
¡ršg
 
âame
, std::¡ršg 
row_key_cŞumn
, std::¡ršg 
time¡amp_cŞumn
);

43 
	gvœtu®
 ~
LßdD©aSourû
(è{ 
VK_SET_FILE_KIND
(0, 
m_âame
.
c_¡r
()); ; }

44 
boŞ
 
has_time¡amps
(è{  
	gm_Ëadšg_time¡amps
 || (
	gm_time¡amp_šdex
 != -1); }

45 
vœtu®
 
boŞ
 
Ãxt
(
ušt32_t
 *
ty³_æagp
, 
ušt64_t
 *
time¡amµ
, 
KeyS³c
 *
keyp
, 
ušt8_t
 **
v®u•
, ušt32_ˆ*
v®ue_ËÅ
, ušt32_ˆ*
cÚsumedp
);

47 
	g´iv©e
:

49 
boŞ
 
·r£_d©e_fÜm©
(cÚ¡ *
¡r
, 
tm
 *tm);

51 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> 
m_cŞumn_Çmes
;

52 
	g¡d
::
veùÜ
<cÚ¡ *> 
m_v®ues
;

53 
size_t
 
	gm_Ãxt_v®ue
;

54 
	g¡d
::
if¡»am
 
m_fš
;

55 
	g¡d
::
¡ršg
 
m_âame
;

56 
	gm_cur_lše
;

57 
DyÇmicBufãr
 
	gm_lše_bufãr
;

58 
boŞ
 
	gm_hy³rfÜm©
;

59 
boŞ
 
	gm_Ëadšg_time¡amps
;

60 
size_t
 
	gm_cur_row_Ëngth
;

61 
	gm_row_šdex
;

62 
	gm_time¡amp_šdex
;

63 
ušt64_t
 
	gm_time¡amp
;

64 
	gm_lim™
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/LocationCache.cc

20 
	~<ÿs£¹
>

21 
	~<c¡ršg
>

22 
	~<f¡»am
>

23 
	~<io¡»am
>

26 
	~<¡dlib.h
>

27 
	~<lim™s.h
>

30 
	~"CommÚ/IÃtAddr.h
"

32 
	~"LoÿtiÚCache.h
"

34 
usšg
 
Çme¥aû
 
Hy³¹abË
;

35 
usšg
 
Çme¥aû
 
	g¡d
;

40 
	gLoÿtiÚCache
::
	$š£¹
(
ušt32_t
 
bËId
, 
RªgeLoÿtiÚInfo
 &
¿nge_loc_šfo
, 
boŞ
 
³gged
) {

41 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

42 
V®ueT
 *
ÃwV®ue
 = 
Ãw
 ValueT;

43 
LoÿtiÚM­T
::
™”©Ü
 
™”
;

44 
LoÿtiÚCacheKeyT
 
key
;

48 
ÃwV®ue
->
¡¬t_row
 = 
¿nge_loc_šfo
.start_row;

49 
ÃwV®ue
->
’d_row
 = 
¿nge_loc_šfo
.end_row;

50 
ÃwV®ue
->
loÿtiÚ
 = 
	`g‘_cÚ¡ªt_loÿtiÚ_¡r
(
¿nge_loc_šfo
.loÿtiÚ.
	`c_¡r
());

51 
ÃwV®ue
->
³gged
 =…egged;

53 
key
.
bËId
 =ableId;

54 
key
.
’d_row
 = (
¿nge_loc_šfo
.’d_row =ğ""è? 0 : 
ÃwV®ue
->’d_row.
	`c_¡r
();

57 ià((
™”
 = 
m_loÿtiÚ_m­
.
	`fšd
(
key
)è!ğm_loÿtiÚ_m­.
	`’d
())

58 
	`»move
((*
™”
).
£cÚd
);

61 
m_loÿtiÚ_m­
.
	`size
(è>ğ
m_max_’Œ›s
) {

62 ià(
m_
->
³gged
)

63 
	`move_to_h—d
(
m_
);

65 
	`»move
(
m_
);

69 ià(
m_h—d
 == 0) {

70 
	`as£¹
(
m_
 == 0);

71 
ÃwV®ue
->
Ãxt
 =‚ewV®ue->
´ev
 = 0;

72 
m_h—d
 = 
m_
 = 
ÃwV®ue
;

75 
m_h—d
->
Ãxt
 = 
ÃwV®ue
;

76 
ÃwV®ue
->
´ev
 = 
m_h—d
;

77 
ÃwV®ue
->
Ãxt
 = 0;

78 
m_h—d
 = 
ÃwV®ue
;

83 
¡d
::
·œ
<
LoÿtiÚM­T
::
™”©Ü
, 
boŞ
> 
Şd_’Œy
;

84 
LoÿtiÚM­T
::
v®ue_ty³
 
	`m­_v®ue
(
key
, 
ÃwV®ue
);

85 
Şd_’Œy
 = 
m_loÿtiÚ_m­
.
	`š£¹
(
m­_v®ue
);

86 
	`as£¹
(
Şd_’Œy
.
£cÚd
);

87 
ÃwV®ue
->
m­I‹r
 = 
Şd_’Œy
.
fœ¡
;

90 
	}
}

95 
	gLoÿtiÚCache
::~
	$LoÿtiÚCache
() {

96 
¡d
::
£t
<cÚ¡ *, 
É_c¡r
>::
™”©Ü
 
™”
 = 
m_loÿtiÚ_¡ršgs
.
	`begš
(); i‹¸!ğm_loÿtiÚ_¡ršgs.
	`’d
(); iter++)

97 
d–‘e
 [] *
™”
;

98 
LoÿtiÚM­T
::
™”©Ü
 
lmI‹r
 = 
m_loÿtiÚ_m­
.
	`begš
();†mI‹¸!ğm_loÿtiÚ_m­.
	`’d
();†mIter++)

99 
	`d–‘e
 (*
lmI‹r
).
£cÚd
;

100 
	}
}

106 
boŞ
 
	gLoÿtiÚCache
::
	$lookup
(
ušt32_t
 
bËId
, cÚ¡ *
rowKey
, 
RªgeLoÿtiÚInfo
 *
¿nge_loc_šfo_p
, 
boŞ
 
šşusive
) {

107 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

108 
LoÿtiÚM­T
::
™”©Ü
 
™”
;

109 
LoÿtiÚCacheKeyT
 
key
;

113 
key
.
bËId
 =ableId;

114 
key
.
’d_row
 = 
rowKey
;

116 ià((
™”
 = 
m_loÿtiÚ_m­
.
	`low”_bound
(
key
)è=ğm_loÿtiÚ_m­.
	`’d
())

117  
çl£
;

119 ià((*
™”
).
fœ¡
.
bËId
 !=ableId)

120  
çl£
;

122 ià(
šşusive
) {

123 ià(
	`¡rcmp
(
rowKey
, (*
™”
).
£cÚd
->
¡¬t_row
.
	`c_¡r
()) < 0)

124  
çl£
;

127 ià(
	`¡rcmp
(
rowKey
, (*
™”
).
£cÚd
->
¡¬t_row
.
	`c_¡r
()) <= 0)

128  
çl£
;

131 
	`move_to_h—d
((*
™”
).
£cÚd
);

133 
¿nge_loc_šfo_p
->
¡¬t_row
 = (*
™”
).
£cÚd
->start_row;

134 
¿nge_loc_šfo_p
->
’d_row
 = (*
™”
).
£cÚd
->end_row;

135 
¿nge_loc_šfo_p
->
loÿtiÚ
 = (*
™”
).
£cÚd
->location;

137  
Œue
;

138 
	}
}

141 
	gLoÿtiÚCache
::
di¥Ïy
(
¡d
::
of¡»am
 &
outfe
) {

142 
V®ueT
 *
v®ue
 = 
m_h—d
; 
	gv®ue
; v®uğv®ue->
´ev
)

143 
outfe
 << "DUMP:ƒnd=" << 
v®ue
->
’d_row
 << " s¹=" << v®ue->
¡¬t_row
 << 
’dl
;

151 
	gLoÿtiÚCache
::
	$move_to_h—d
(
V®ueT
 *
ÿcheV®ue
) {

153 ià(
m_h—d
 =ğ
ÿcheV®ue
)

157 
ÿcheV®ue
->
Ãxt
->
´ev
 = cacheValue->prev;

158 ià(
ÿcheV®ue
->
´ev
 == 0)

159 
m_
 = 
ÿcheV®ue
->
Ãxt
;

161 
ÿcheV®ue
->
´ev
->
Ãxt
 = cacheValue->next;

163 
ÿcheV®ue
->
Ãxt
 = 0;

164 
ÿcheV®ue
->
´ev
 = 
m_h—d
;

165 
m_h—d
->
Ãxt
 = 
ÿcheV®ue
;

166 
m_h—d
 = 
ÿcheV®ue
;

167 
	}
}

173 
	gLoÿtiÚCache
::
	$»move
(
V®ueT
 *
ÿcheV®ue
) {

174 
	`as£¹
(
ÿcheV®ue
);

175 ià(
m_
 =ğ
ÿcheV®ue
) {

176 
m_
 = 
ÿcheV®ue
->
Ãxt
;

177 ià(
m_
)

178 
m_
->
´ev
 = 0;

180 
	`as£¹
 (
m_h—d
 =ğ
ÿcheV®ue
);

181 
m_h—d
 = 0;

184 ià(
m_h—d
 =ğ
ÿcheV®ue
) {

185 
m_h—d
 = m_h—d->
´ev
;

186 
m_h—d
->
Ãxt
 = 0;

189 
ÿcheV®ue
->
Ãxt
->
´ev
 = cacheValue->prev;

190 
ÿcheV®ue
->
´ev
->
Ãxt
 = cacheValue->next;

192 
m_loÿtiÚ_m­
.
	`”a£
(
ÿcheV®ue
->
m­I‹r
);

193 
d–‘e
 
ÿcheV®ue
;

194 
	}
}

198 cÚ¡ *
	gLoÿtiÚCache
::
	$g‘_cÚ¡ªt_loÿtiÚ_¡r
(cÚ¡ *
loÿtiÚ
) {

199 
¡d
::
£t
<cÚ¡ *, 
É_c¡r
>::
™”©Ü
 
™”
 = 
m_loÿtiÚ_¡ršgs
.
	`fšd
(
loÿtiÚ
);

201 ià(
™”
 !ğ
m_loÿtiÚ_¡ršgs
.
	`’d
())

202  *
™”
;

204 *
cÚ¡ªtId
 = 
Ãw
 [ 
	`¡¾’
(
loÿtiÚ
) + 1 ];

205 
	`¡rıy
(
cÚ¡ªtId
, 
loÿtiÚ
);

206 
m_loÿtiÚ_¡ršgs
.
	`š£¹
(
cÚ¡ªtId
);

207  
cÚ¡ªtId
;

208 
	}
}

214 
boŞ
 
	gLoÿtiÚCache
::
	$loÿtiÚ_to_addr
(cÚ¡ *
loÿtiÚ
, 
sockaddr_š
 &
addr
) {

215 cÚ¡ *
±r
 = 
loÿtiÚ
 + 
	`¡¾’
(location);

216 
¡d
::
¡ršg
 
ho¡
;

217 
ušt16_t
 
pÜt
;

218 
us_£’
 = 0;

220 --
±r
;…Œ >ğ
loÿtiÚ
; --ptr) {

221 ià(*
±r
 == '_') {

222 ià(
us_£’
 > 0)

224 
us_£’
++;

228 
pÜt
 = (
ušt16_t
)
	`¡¹Ş
(
±r
+1, 0, 10);

230 
ho¡
 = 
¡d
::
	`¡ršg
(
loÿtiÚ
, 
±r
-location);

232  
IÃtAddr
::
	`š™Ÿlize
(&
addr
, 
ho¡
.
	`c_¡r
(), 
pÜt
);

233 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/LocationCache.h

21 #iâdeà
HYPERTABLE_LOCATIONCACHE_H


22 
	#HYPERTABLE_LOCATIONCACHE_H


	)

24 
	~<c¡ršg
>

25 
	~<f¡»am
>

26 
	~<m­
>

27 
	~<£t
>

29 
	~<boo¡/th»ad/mu‹x.hµ
>

32 
	~<Ãtš‘/š.h
>

35 
	~"CommÚ/Reã»nûCouÁ.h
"

36 
	~"CommÚ/SŒšgExt.h
"

38 
	~"RªgeLoÿtiÚInfo.h
"

40 
Çme¥aû
 
Hy³¹abË
 {

46 
ušt32_t
 
bËId
;

47 cÚ¡ *
’d_row
;

48 } 
	tLoÿtiÚCacheKeyT
;

53 
šlše
 
boŞ
 
İ”©Ü
<(cÚ¡ 
LoÿtiÚCacheKeyT
 &
k1
, cÚ¡ LoÿtiÚCacheKeyT &
k2
) {

54 ià(
k1
.
bËId
 !ğ
k2
.tableId)

55  
k1
.
bËId
 < 
k2
.tableId;

56 ià(
k2
.
’d_row
 == 0)

57  (
k1
.
’d_row
 =ğ0è? 
çl£
 : 
Œue
;

58 ià(
k1
.
’d_row
 == 0)

59  
çl£
;

60  
¡rcmp
(
k1
.
’d_row
, 
k2
.end_row) < 0;

66 
šlše
 
boŞ
 
İ”©Ü
==(cÚ¡ 
LoÿtiÚCacheKeyT
 &
k1
, cÚ¡ LoÿtiÚCacheKeyT &
k2
) {

67 ià(
k1
.
bËId
 !ğ
k2
.tableId)

68  
çl£
;

69 ià(
k1
.
’d_row
 == 0)

70  (
k2
.
’d_row
 =ğ0è? 
Œue
 : 
çl£
;

71 ià(
k2
.
’d_row
 == 0)

72  
çl£
;

73  !
¡rcmp
(
k1
.
’d_row
, 
k2
.end_row);

79 
šlše
 
boŞ
 
İ”©Ü
!=(cÚ¡ 
LoÿtiÚCacheKeyT
 &
k1
, cÚ¡ LoÿtiÚCacheKeyT &
k2
) {

80  !(
k1
 =ğ
k2
);

87 şas 
	cLoÿtiÚCache
 {

89 
public
:

93 
	sÿche_v®ue
 {

94 
ÿche_v®ue
 *
´ev
;

95 
ÿche_v®ue
 *
Ãxt
;

96 
¡d
::
m­
<
LoÿtiÚCacheKeyT
, 
ÿche_v®ue
 *>::
™”©Ü
 
m­I‹r
;

97 
¡d
::
¡ršg
 
¡¬t_row
;

98 
¡d
::
¡ršg
 
’d_row
;

99 cÚ¡ *
loÿtiÚ
;

100 
boŞ
 
³gged
;

101 } 
	tV®ueT
;

103 
LoÿtiÚCache
(
ušt32_t
 
maxEÁr›s
è: 
m_mu‹x
(), 
m_loÿtiÚ_m­
(), 
m_h—d
(0), 
m_
(0), 
m_max_’Œ›s
(maxEntries) { ; }

104 ~
LoÿtiÚCache
();

106 
š£¹
(
ušt32_t
 
bËId
, 
RªgeLoÿtiÚInfo
 &
¿nge_loc_šfo
, 
boŞ
 
³gged
=
çl£
);

107 
boŞ
 
lookup
(
ušt32_t
 
bËId
, cÚ¡ *
rowKey
, 
RªgeLoÿtiÚInfo
 *
¿nge_loc_šfo_p
, boŞ 
šşusive
=
çl£
);

109 
di¥Ïy
(
¡d
::
of¡»am
 &
outfe
);

111 
boŞ
 
loÿtiÚ_to_addr
(cÚ¡ *
loÿtiÚ
, 
sockaddr_š
 &
addr
);

113 
´iv©e
:

115 
move_to_h—d
(
V®ueT
 *
ÿcheV®ue
);

116 
»move
(
V®ueT
 *
ÿcheV®ue
);

118 cÚ¡ *
g‘_cÚ¡ªt_loÿtiÚ_¡r
(cÚ¡ *
loÿtiÚ
);

120 
¡d
::
	tm­
<
	tLoÿtiÚCacheKeyT
, 
	tV®ueT
 *> 
	tLoÿtiÚM­T
;

122 
boo¡
::
mu‹x
 
m_mu‹x
;

123 
LoÿtiÚM­T
 
m_loÿtiÚ_m­
;

124 
¡d
::
£t
<cÚ¡ *, 
É_c¡r
> 
m_loÿtiÚ_¡ršgs
;

125 
V®ueT
 *
m_h—d
;

126 
V®ueT
 *
m_
;

127 
ušt32_t
 
m_max_’Œ›s
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/MasterClient.cc

21 
	~"CommÚ/E¼Ü.h
"

22 
	~"CommÚ/IÃtAddr.h
"

24 
	~"AsyncComm/AµliÿtiÚQueue.h
"

25 
	~"AsyncComm/Di¥©chHªdËrSynchrÚiz”.h
"

26 
	~"AsyncComm/S”Ÿliz©iÚ.h
"

28 
	~"Hy³r¥aû/SessiÚ.h
"

30 
	~"Ma¡”FeHªdËr.h
"

31 
	~"Ma¡”Cl›Á.h
"

32 
	~"Ma¡”PrÙocŞ.h
"

38 
	gMa¡”Cl›Á
::
Ma¡”Cl›Á
(
CÚÃùiÚMªag”PŒ
 &
cÚnMªag”PŒ
, 
Hy³r¥aû
::
SessiÚPŒ
 &
hy³r¥aûPŒ
, 
time_t
 
timeout
, 
AµliÿtiÚQueuePŒ
 &
­pQueuePŒ
è: 
m_v”bo£
(
Œue
), 
m_cÚn_mªag”_±r
(cÚnMªag”PŒ), 
m_hy³r¥aû_±r
(hy³r¥aûPŒ), 
m_­p_queue_±r
×µQueuePŒ), 
m_timeout
Ñimeout), 
	$m_š™Ÿ‹d
(
çl£
) {

39 
”rÜ
;

41 
m_comm
 = 
m_cÚn_mªag”_±r
->
	`g‘_comm
();

42 
	`mem£t
(&
m_ma¡”_addr
, 0, (m_master_addr));

47 
m_ma¡”_fe_ÿÎback_±r
 = 
Ãw
 
	`Ma¡”FeHªdËr
(
this
, 
m_­p_queue_±r
);

48 ià((
”rÜ
 = 
m_hy³r¥aû_±r
->
	`İ’
("/hy³¹abË/ma¡”", 
OPEN_FLAG_READ
, 
m_ma¡”_fe_ÿÎback_±r
, &
m_ma¡”_fe_hªdË
)è!ğ
E¼Ü
::
OK
) {

49 ià(
”rÜ
 !ğ
E¼Ü
::
HYPERSPACE_FILE_NOT_FOUND
 &&ƒ¼Ü !ğE¼Ü::
HYPERSPACE_BAD_PATHNAME
) {

50 
	`HT_ERRORF
("UÇbËØİ’ Hy³r¥aû f'/hy³¹abË/ma¡”' - %s", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

51 
	`ex™
(1);

53 
m_ma¡”_fe_hªdË
 = 0;

55 
	}
}

59 
	gMa¡”Cl›Á
::~
	$Ma¡”Cl›Á
() {

60 
m_hy³r¥aû_±r
->
	`şo£
(
m_ma¡”_fe_hªdË
);

61 
	}
}

68 
	gMa¡”Cl›Á
::
	$š™Ÿ‹_cÚÃùiÚ
(
Di¥©chHªdËrPŒ
 
di¥©chHªdËrPŒ
) {

69 
m_di¥©ch”_hªdËr_±r
 = 
di¥©chHªdËrPŒ
;

70 ià(
m_ma¡”_fe_hªdË
 == 0)

71  
E¼Ü
::
MASTER_NOT_RUNNING
;

72  
	`»lßd_ma¡”
();

73 
	}
}

77 
	gMa¡”Cl›Á
::
	$ü—‹_bË
(cÚ¡ *
bËName
, cÚ¡ *
schemaSŒšg
, 
Di¥©chHªdËr
 *
hªdËr
) {

78 
CommBufPŒ
 
	`cbufPŒ
Ğ
Ma¡”PrÙocŞ
::
	`ü—‹_ü—‹_bË_»que¡
(
bËName
, 
schemaSŒšg
) );

79  
	`£nd_mes§ge
(
cbufPŒ
, 
hªdËr
);

80 
	}
}

84 
	gMa¡”Cl›Á
::
	$ü—‹_bË
(cÚ¡ *
bËName
, cÚ¡ *
schemaSŒšg
) {

85 
Di¥©chHªdËrSynchrÚiz”
 
syncHªdËr
;

86 
Ev’tPŒ
 
ev’tPŒ
;

87 
CommBufPŒ
 
	`cbufPŒ
Ğ
Ma¡”PrÙocŞ
::
	`ü—‹_ü—‹_bË_»que¡
(
bËName
, 
schemaSŒšg
) );

88 
”rÜ
 = 
	`£nd_mes§ge
(
cbufPŒ
, &
syncHªdËr
);

89 ià(
”rÜ
 =ğ
E¼Ü
::
OK
) {

90 ià(!
syncHªdËr
.
	`wa™_fÜ_»¶y
(
ev’tPŒ
)) {

91 ià(
m_v”bo£
)

92 
	`HT_ERRORF
("Ma¡” 'ü—‹abË'ƒ¼Ü,abËName=% : %s", 
bËName
, 
Ma¡”PrÙocŞ
::
	`¡ršg_fÜm©_mes§ge
(
ev’tPŒ
).
	`c_¡r
());

93 
”rÜ
 = ()
Ma¡”PrÙocŞ
::
	`»¥Ú£_code
(
ev’tPŒ
);

96  
”rÜ
;

97 
	}
}

100 
	gMa¡”Cl›Á
::
	$g‘_schema
(cÚ¡ *
bËName
, 
Di¥©chHªdËr
 *
hªdËr
) {

101 
CommBufPŒ
 
	`cbufPŒ
Ğ
Ma¡”PrÙocŞ
::
	`ü—‹_g‘_schema_»que¡
(
bËName
) );

102  
	`£nd_mes§ge
(
cbufPŒ
, 
hªdËr
);

103 
	}
}

106 
	gMa¡”Cl›Á
::
g‘_schema
(cÚ¡ *
bËName
, 
¡d
::
¡ršg
 &
schema
) {

107 
Di¥©chHªdËrSynchrÚiz”
 
syncHªdËr
;

108 
Ev’tPŒ
 
	gev’tPŒ
;

109 
CommBufPŒ
 
cbufPŒ
Ğ
Ma¡”PrÙocŞ
::
ü—‹_g‘_schema_»que¡
(
bËName
) );

110 
	g”rÜ
 = 
£nd_mes§ge
(
cbufPŒ
, &
syncHªdËr
);

111 ià(
	g”rÜ
 =ğ
E¼Ü
::
OK
) {

112 ià(!
syncHªdËr
.
wa™_fÜ_»¶y
(
ev’tPŒ
)) {

113 ià(
m_v”bo£
)

114 
HT_ERRORF
("Ma¡” 'g‘ schema'ƒ¼Ü,abËName=% : %s", 
bËName
, 
Ma¡”PrÙocŞ
::
¡ršg_fÜm©_mes§ge
(
ev’tPŒ
).
c_¡r
());

115 
	g”rÜ
 = ()
Ma¡”PrÙocŞ
::
»¥Ú£_code
(
ev’tPŒ
);

118 
ušt8_t
 *
	g±r
 = 
ev’tPŒ
->
mes§ge
 + (
št32_t
);

119 
size_t
 
	g»maššg
 = 
ev’tPŒ
->
mes§geL’
 - (
št32_t
);

120 cÚ¡ *
	gschemaSŒ
;

121 ià(!
	gS”Ÿliz©iÚ
::
decode_¡ršg
(&
±r
, &
»maššg
, &
schemaSŒ
)) {

122 ià(
	gm_v”bo£
)

123 
HT_ERRORF
("ProbËm decodšg„e¥Ú£Ø'g‘ schema' commªd fÜabË '%s'", 
bËName
);

124  
	gE¼Ü
::
PROTOCOL_ERROR
;

126 
	gschema
 = 
schemaSŒ
;

129  
	g”rÜ
;

133 
	gMa¡”Cl›Á
::
	$¡©us
() {

134 
Di¥©chHªdËrSynchrÚiz”
 
syncHªdËr
;

135 
Ev’tPŒ
 
ev’tPŒ
;

136 
CommBufPŒ
 
	`cbufPŒ
Ğ
Ma¡”PrÙocŞ
::
	`ü—‹_¡©us_»que¡
() );

137 
”rÜ
 = 
	`£nd_mes§ge
(
cbufPŒ
, &
syncHªdËr
);

138 ià(
”rÜ
 =ğ
E¼Ü
::
OK
) {

139 ià(!
syncHªdËr
.
	`wa™_fÜ_»¶y
(
ev’tPŒ
)) {

140 ià(
m_v”bo£
)

141 
	`HT_ERRORF
("Ma¡” '¡©us'ƒ¼Ü : %s", 
Ma¡”PrÙocŞ
::
	`¡ršg_fÜm©_mes§ge
(
ev’tPŒ
).
	`c_¡r
());

142 
”rÜ
 = ()
Ma¡”PrÙocŞ
::
	`»¥Ú£_code
(
ev’tPŒ
);

145  
”rÜ
;

146 
	}
}

149 
	gMa¡”Cl›Á
::
»gi¡”_£rv”
(
¡d
::
¡ršg
 &
loÿtiÚ
, 
Di¥©chHªdËr
 *
hªdËr
) {

150 
CommBufPŒ
 
cbufPŒ
Ğ
Ma¡”PrÙocŞ
::
ü—‹_»gi¡”_£rv”_»que¡
(
loÿtiÚ
) );

151  
£nd_mes§ge
(
cbufPŒ
, 
hªdËr
);

155 
	gMa¡”Cl›Á
::
»gi¡”_£rv”
(
¡d
::
¡ršg
 &
loÿtiÚ
) {

156 
Di¥©chHªdËrSynchrÚiz”
 
syncHªdËr
;

157 
Ev’tPŒ
 
	gev’tPŒ
;

158 
CommBufPŒ
 
cbufPŒ
Ğ
Ma¡”PrÙocŞ
::
ü—‹_»gi¡”_£rv”_»que¡
(
loÿtiÚ
) );

159 
	g”rÜ
 = 
£nd_mes§ge
(
cbufPŒ
, &
syncHªdËr
);

160 ià(
	g”rÜ
 =ğ
E¼Ü
::
OK
) {

161 ià(!
syncHªdËr
.
wa™_fÜ_»¶y
(
ev’tPŒ
)) {

162 ià(
m_v”bo£
)

163 
HT_ERRORF
("Ma¡” '»gi¡” s”v”'ƒ¼Ü : %s", 
Ma¡”PrÙocŞ
::
¡ršg_fÜm©_mes§ge
(
ev’tPŒ
).
c_¡r
());

164 
	g”rÜ
 = ()
Ma¡”PrÙocŞ
::
»¥Ú£_code
(
ev’tPŒ
);

167  
	g”rÜ
;

171 
	gMa¡”Cl›Á
::
	$»pÜt_¥l™
(
TabËId’tif›rT
 &
bË
, 
RªgeT
 &
¿nge
, 
ušt64_t
 
soá_lim™
, 
Di¥©chHªdËr
 *
hªdËr
) {

172 
CommBufPŒ
 
	`cbufPŒ
Ğ
Ma¡”PrÙocŞ
::
	`ü—‹_»pÜt_¥l™_»que¡
(
bË
, 
¿nge
, 
soá_lim™
) );

173  
	`£nd_mes§ge
(
cbufPŒ
, 
hªdËr
);

174 
	}
}

177 
	gMa¡”Cl›Á
::
	$»pÜt_¥l™
(
TabËId’tif›rT
 &
bË
, 
RªgeT
 &
¿nge
, 
ušt64_t
 
soá_lim™
) {

178 
Di¥©chHªdËrSynchrÚiz”
 
syncHªdËr
;

179 
Ev’tPŒ
 
ev’tPŒ
;

180 
CommBufPŒ
 
	`cbufPŒ
Ğ
Ma¡”PrÙocŞ
::
	`ü—‹_»pÜt_¥l™_»que¡
(
bË
, 
¿nge
, 
soá_lim™
) );

181 
”rÜ
 = 
	`£nd_mes§ge
(
cbufPŒ
, &
syncHªdËr
);

182 ià(
”rÜ
 =ğ
E¼Ü
::
OK
) {

183 ià(!
syncHªdËr
.
	`wa™_fÜ_»¶y
(
ev’tPŒ
)) {

184 ià(
m_v”bo£
)

185 
	`HT_ERRORF
("Ma¡” '»pÜˆ¥l™'ƒ¼Ü : %s", 
Ma¡”PrÙocŞ
::
	`¡ršg_fÜm©_mes§ge
(
ev’tPŒ
).
	`c_¡r
());

186 
”rÜ
 = ()
Ma¡”PrÙocŞ
::
	`»¥Ú£_code
(
ev’tPŒ
);

189  
”rÜ
;

190 
	}
}

194 
	gMa¡”Cl›Á
::
	$drİ_bË
(cÚ¡ *
bË_Çme
, 
boŞ
 
if_exi¡s
, 
Di¥©chHªdËr
 *
hªdËr
) {

195 
CommBufPŒ
 
	`cbufPŒ
Ğ
Ma¡”PrÙocŞ
::
	`ü—‹_drİ_bË_»que¡
(
bË_Çme
, 
if_exi¡s
) );

196  
	`£nd_mes§ge
(
cbufPŒ
, 
hªdËr
);

197 
	}
}

201 
	gMa¡”Cl›Á
::
	$drİ_bË
(cÚ¡ *
bË_Çme
, 
boŞ
 
if_exi¡s
) {

202 
Di¥©chHªdËrSynchrÚiz”
 
syncHªdËr
;

203 
Ev’tPŒ
 
ev’tPŒ
;

204 
CommBufPŒ
 
	`cbufPŒ
Ğ
Ma¡”PrÙocŞ
::
	`ü—‹_drİ_bË_»que¡
(
bË_Çme
, 
if_exi¡s
) );

205 
”rÜ
 = 
	`£nd_mes§ge
(
cbufPŒ
, &
syncHªdËr
);

206 ià(
”rÜ
 =ğ
E¼Ü
::
OK
) {

207 ià(!
syncHªdËr
.
	`wa™_fÜ_»¶y
(
ev’tPŒ
)) {

208 ià(
m_v”bo£
)

209 
	`HT_ERRORF
("Ma¡” 'drİabË'ƒ¼Ü : %s", 
Ma¡”PrÙocŞ
::
	`¡ršg_fÜm©_mes§ge
(
ev’tPŒ
).
	`c_¡r
());

210 
”rÜ
 = ()
Ma¡”PrÙocŞ
::
	`»¥Ú£_code
(
ev’tPŒ
);

213  
”rÜ
;

214 
	}
}

218 
	gMa¡”Cl›Á
::
	$£nd_mes§ge
(
CommBufPŒ
 &
cbufPŒ
, 
Di¥©chHªdËr
 *
hªdËr
) {

219 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

220 
”rÜ
;

222 ià((
”rÜ
 = 
m_comm
->
	`£nd_»que¡
(
m_ma¡”_addr
, 
m_timeout
, 
cbufPŒ
, 
hªdËr
)è!ğ
E¼Ü
::
OK
) {

223 
¡d
::
¡ršg
 
addrSŒ
;

224 ià(
m_v”bo£
)

225 
	`HT_WARNF
("Comm::£nd_»que¡Ø% çed - %s", 
IÃtAddr
::
	`¡ršg_fÜm©
(
addrSŒ
, 
m_ma¡”_addr
), 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

228  
”rÜ
;

229 
	}
}

235 
	gMa¡”Cl›Á
::
	$»lßd_ma¡”
() {

236 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

237 
”rÜ
;

238 
DyÇmicBufãr
 
	`v®ue
(0);

239 
¡d
::
¡ršg
 
addrSŒ
;

241 ià((
”rÜ
 = 
m_hy³r¥aû_±r
->
	`©Œ_g‘
(
m_ma¡”_fe_hªdË
, "add»ss", 
v®ue
)è!ğ
E¼Ü
::
OK
) {

242 ià(
m_v”bo£
)

243 
	`HT_ERRORF
("ProbËm„—dšg 'add»ss'‡‰ribu‹ oàHy³r¥aû f/hy³¹abË/ma¡” - %s", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

244  
E¼Ü
::
MASTER_NOT_RUNNING
;

247 
addrSŒ
 = (cÚ¡ *)
v®ue
.
buf
;

249 ià(
addrSŒ
 !ğ
m_ma¡”_addr_¡ršg
) {

251 ià(
m_ma¡”_addr
.
sš_pÜt
 != 0) {

252 ià((
”rÜ
 = 
m_cÚn_mªag”_±r
->
	`»move
(
m_ma¡”_addr
)è!ğ
E¼Ü
::
OK
) {

253 ià(
m_v”bo£
)

254 
	`HT_WARNF
("ProbËm„emovšg cÚÃùiÚØMa¡” - %s", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

256 ià(
m_v”bo£
)

257 
	`HT_INFOF
("CÚÃùšgØÃw Ma¡” (Şd=%s,‚ew=%s)", 
m_ma¡”_addr_¡ršg
.
	`c_¡r
(), 
addrSŒ
.c_str());

260 
m_ma¡”_addr_¡ršg
 = 
addrSŒ
;

262 
IÃtAddr
::
	`š™Ÿlize
(&
m_ma¡”_addr
, 
m_ma¡”_addr_¡ršg
.
	`c_¡r
());

264 
m_cÚn_mªag”_±r
->
	`add
(
m_ma¡”_addr
, 15, "Ma¡”", 
m_di¥©ch”_hªdËr_±r
);

267  
E¼Ü
::
OK
;

268 
	}
}

271 
boŞ
 
	gMa¡”Cl›Á
::
	$wa™_fÜ_cÚÃùiÚ
(
maxWa™Secs
) {

272  
m_cÚn_mªag”_±r
->
	`wa™_fÜ_cÚÃùiÚ
(
m_ma¡”_addr
, 
maxWa™Secs
);

273 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/MasterClient.h

21 #iâdeà
HYPERTABLE_MASTERCLIENT_H


22 
	#HYPERTABLE_MASTERCLIENT_H


	)

24 
	~<boo¡/th»ad/mu‹x.hµ
>

26 
	~"AsyncComm/AµliÿtiÚQueue.h
"

27 
	~"AsyncComm/CommBuf.h
"

28 
	~"AsyncComm/CÚÃùiÚMªag”.h
"

29 
	~"AsyncComm/Di¥©chHªdËr.h
"

31 
	~"CommÚ/Reã»nûCouÁ.h
"

33 
	~"Hy³r¥aû/HªdËC®lback.h
"

34 
	~"Hy³r¥aû/SessiÚ.h
"

36 
	~"Hy³¹abË/Lib/Ty³s.h
"

38 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

40 
Çme¥aû
 
	gHy³¹abË
 {

42 
şass
 
	gComm
;

44 şas 
	cMa¡”Cl›Á
 : 
public
 
Reã»nûCouÁ
 {

45 
public
:

47 
Ma¡”Cl›Á
(
CÚÃùiÚMªag”PŒ
 &
cÚnMªag”PŒ
, 
Hy³r¥aû
::
SessiÚPŒ
 &
hy³r¥aûPŒ
, 
time_t
 
timeout
, 
AµliÿtiÚQueuePŒ
 &
­pQueuePŒ
);

48 ~
Ma¡”Cl›Á
();

54 
£t_timeout
(
time_t
 
timeout
è{ 
	gm_timeout
 =imeout; }

56 
š™Ÿ‹_cÚÃùiÚ
(
Di¥©chHªdËrPŒ
 
di¥©chHªdËrPŒ
);

58 
boŞ
 
wa™_fÜ_cÚÃùiÚ
(
maxWa™Secs
);

60 
ü—‹_bË
(cÚ¡ *
bËName
, cÚ¡ *
schemaSŒšg
, 
Di¥©chHªdËr
 *
hªdËr
);

61 
ü—‹_bË
(cÚ¡ *
bËName
, cÚ¡ *
schemaSŒšg
);

63 
g‘_schema
(cÚ¡ *
bËName
, 
Di¥©chHªdËr
 *
hªdËr
);

64 
g‘_schema
(cÚ¡ *
bËName
, 
¡d
::
¡ršg
 &
schema
);

66 
¡©us
();

68 
»gi¡”_£rv”
(
¡d
::
¡ršg
 &
loÿtiÚ
, 
Di¥©chHªdËr
 *
hªdËr
);

69 
»gi¡”_£rv”
(
¡d
::
¡ršg
 &
loÿtiÚ
);

71 
»pÜt_¥l™
(
TabËId’tif›rT
 &
bË
, 
RªgeT
 &
¿nge
, 
ušt64_t
 
soá_lim™
, 
Di¥©chHªdËr
 *
hªdËr
);

72 
»pÜt_¥l™
(
TabËId’tif›rT
 &
bË
, 
RªgeT
 &
¿nge
, 
ušt64_t
 
soá_lim™
);

74 
drİ_bË
(cÚ¡ *
bË_Çme
, 
boŞ
 
if_exi¡s
, 
Di¥©chHªdËr
 *
hªdËr
);

75 
drİ_bË
(cÚ¡ *
bË_Çme
, 
boŞ
 
if_exi¡s
);

77 
»lßd_ma¡”
();

79 
£t_v”bo£_æag
(
boŞ
 
v”bo£
è{ 
	gm_v”bo£
 = verbose; }

81 
	g´iv©e
:

83 
£nd_mes§ge
(
CommBufPŒ
 &
cbufPŒ
, 
Di¥©chHªdËr
 *
hªdËr
);

85 
	gboo¡
::
mu‹x
 
m_mu‹x
;

86 
boŞ
 
	gm_v”bo£
;

87 
Comm
 *
	gm_comm
;

88 
CÚÃùiÚMªag”PŒ
 
	gm_cÚn_mªag”_±r
;

89 
	gHy³r¥aû
::
SessiÚPŒ
 
m_hy³r¥aû_±r
;

90 
AµliÿtiÚQueuePŒ
 
	gm_­p_queue_±r
;

91 
time_t
 
	gm_timeout
;

92 
boŞ
 
	gm_š™Ÿ‹d
;

93 
ušt64_t
 
	gm_ma¡”_fe_hªdË
;

94 
HªdËC®lbackPŒ
 
	gm_ma¡”_fe_ÿÎback_±r
;

95 
sockaddr_š
 
	gm_ma¡”_addr
;

96 
	g¡d
::
¡ršg
 
m_ma¡”_addr_¡ršg
;

97 
Di¥©chHªdËrPŒ
 
	gm_di¥©ch”_hªdËr_±r
;

100 
	gboo¡
::
	tšŒusive_±r
<
	tMa¡”Cl›Á
> 
	tMa¡”Cl›ÁPŒ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/MasterFileHandler.cc

21 
	~"AsyncComm/AµliÿtiÚQueue.h
"

23 
	~"Ev’tHªdËrMa¡”Chªge.h
"

24 
	~"Ma¡”FeHªdËr.h
"

26 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

31 
	gMa¡”FeHªdËr
::
©Œ_£t
(
¡d
::
¡ršg
 
Çme
) {

32 ià(
Çme
 == "address") {

33 
Ev’tPŒ
 
nuÎEv’t
;

34 
	gm_­p_queue_±r
->
add
Ğ
Ãw
 
Ev’tHªdËrMa¡”Chªge
(
m_ma¡”_ş›Á_±r
, 
nuÎEv’t
) );

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/MasterFileHandler.h

21 #iâdeà
HYPERTABLE_MASTERFILEHANDLER_H


22 
	#HYPERTABLE_MASTERFILEHANDLER_H


	)

24 
	~"AsyncComm/AµliÿtiÚQueue.h
"

26 
	~"Hy³r¥aû/HªdËC®lback.h
"

28 
	~"Ma¡”Cl›Á.h
"

30 
usšg
 
Çme¥aû
 
	gHy³r¥aû
;

32 
Çme¥aû
 
	gHy³¹abË
 {

37 şas 
	cMa¡”FeHªdËr
 : 
public
 
HªdËC®lback
 {

38 
public
:

39 
Ma¡”FeHªdËr
(
Ma¡”Cl›ÁPŒ
 
ma¡”Cl›ÁPŒ
, 
AµliÿtiÚQueuePŒ
 &
­pQueuePŒ
è: 
HªdËC®lback
(
EVENT_MASK_ATTR_SET
), 
m_ma¡”_ş›Á_±r
(ma¡”Cl›ÁPŒ), 
m_­p_queue_±r
(appQueuePtr) { ; }

40 
vœtu®
 
©Œ_£t
(
¡d
::
¡ršg
 
Çme
);

41 
Ma¡”Cl›ÁPŒ
 
	gm_ma¡”_ş›Á_±r
;

42 
AµliÿtiÚQueuePŒ
 
	gm_­p_queue_±r
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/MasterProtocol.cc

21 
	~"AsyncComm/H—d”Bud”.h
"

22 
	~"AsyncComm/S”Ÿliz©iÚ.h
"

24 
	~"Ma¡”PrÙocŞ.h
"

26 
Çme¥aû
 
	gHy³¹abË
 {

31 
CommBuf
 *
	gMa¡”PrÙocŞ
::
ü—‹_ü—‹_bË_»que¡
(cÚ¡ *
bËName
, cÚ¡ *
schemaSŒšg
) {

32 
H—d”Bud”
 
hbud”
(
H—d”
::
PROTOCOL_HYPERTABLE_MASTER
);

33 
CommBuf
 *
	gcbuf
 = 
Ãw
 CommBuf(
hbud”
, 2 + 
S”Ÿliz©iÚ
::
’coded_Ëngth_¡ršg
(
bËName
è+ S”Ÿliz©iÚ::’coded_Ëngth_¡ršg(
schemaSŒšg
));

34 
	gcbuf
->
­³nd_shÜt
(
COMMAND_CREATE_TABLE
);

35 
	gcbuf
->
­³nd_¡ršg
(
bËName
);

36 
	gcbuf
->
­³nd_¡ršg
(
schemaSŒšg
);

37  
	gcbuf
;

40 
CommBuf
 *
	gMa¡”PrÙocŞ
::
ü—‹_g‘_schema_»que¡
(cÚ¡ *
bËName
) {

41 
H—d”Bud”
 
hbud”
(
H—d”
::
PROTOCOL_HYPERTABLE_MASTER
);

42 
CommBuf
 *
	gcbuf
 = 
Ãw
 CommBuf(
hbud”
, 2 + 
S”Ÿliz©iÚ
::
’coded_Ëngth_¡ršg
(
bËName
));

43 
	gcbuf
->
­³nd_shÜt
(
COMMAND_GET_SCHEMA
);

44 
	gcbuf
->
­³nd_¡ršg
(
bËName
);

45  
	gcbuf
;

48 
CommBuf
 *
	gMa¡”PrÙocŞ
::
ü—‹_¡©us_»que¡
() {

49 
H—d”Bud”
 
hbud”
(
H—d”
::
PROTOCOL_HYPERTABLE_MASTER
);

50 
CommBuf
 *
	gcbuf
 = 
Ãw
 CommBuf(
hbud”
, 2);

51 
	gcbuf
->
­³nd_shÜt
(
COMMAND_STATUS
);

52  
	gcbuf
;

55 
CommBuf
 *
	gMa¡”PrÙocŞ
::
ü—‹_»gi¡”_£rv”_»que¡
(
¡d
::
¡ršg
 &
loÿtiÚ
) {

56 
H—d”Bud”
 
hbud”
(
H—d”
::
PROTOCOL_HYPERTABLE_MASTER
);

57 
CommBuf
 *
	gcbuf
 = 
Ãw
 CommBuf(
hbud”
, 2 + 
S”Ÿliz©iÚ
::
’coded_Ëngth_¡ršg
(
loÿtiÚ
));

58 
	gcbuf
->
­³nd_shÜt
(
COMMAND_REGISTER_SERVER
);

59 
	gcbuf
->
­³nd_¡ršg
(
loÿtiÚ
);

60  
	gcbuf
;

63 
CommBuf
 *
	gMa¡”PrÙocŞ
::
ü—‹_»pÜt_¥l™_»que¡
(
TabËId’tif›rT
 &
bË
, 
RªgeT
 &
¿nge
, 
ušt64_t
 
soá_lim™
) {

64 
H—d”Bud”
 
hbud”
(
H—d”
::
PROTOCOL_HYPERTABLE_MASTER
);

65 
CommBuf
 *
	gcbuf
 = 
Ãw
 CommBuf(
hbud”
, 2 + 
EncodedL’gthTabËId’tif›r
(
bË
è+ 
EncodedL’gthRªge
(
¿nge
) + 8);

66 
	gcbuf
->
­³nd_shÜt
(
COMMAND_REPORT_SPLIT
);

67 
EncodeTabËId’tif›r
(
cbuf
->
g‘_d©a_±r_add»ss
(), 
bË
);

68 
EncodeRªge
(
cbuf
->
g‘_d©a_±r_add»ss
(), 
¿nge
);

69 
	gcbuf
->
­³nd_lÚg
(
soá_lim™
);

70  
	gcbuf
;

73 
CommBuf
 *
	gMa¡”PrÙocŞ
::
ü—‹_drİ_bË_»que¡
(cÚ¡ *
bË_Çme
, 
boŞ
 
if_exi¡s
) {

74 
H—d”Bud”
 
hbud”
(
H—d”
::
PROTOCOL_HYPERTABLE_MASTER
);

75 
CommBuf
 *
	gcbuf
 = 
Ãw
 CommBuf(
hbud”
, 3 + 
S”Ÿliz©iÚ
::
’coded_Ëngth_¡ršg
(
bË_Çme
));

76 
	gcbuf
->
­³nd_shÜt
(
COMMAND_DROP_TABLE
);

77 
	gcbuf
->
­³nd_boŞ
(
if_exi¡s
);

78 
	gcbuf
->
­³nd_¡ršg
(
bË_Çme
);

79  
	gcbuf
;

82 cÚ¡ *
	gMa¡”PrÙocŞ
::
m_commªd_¡ršgs
[] = {

91 cÚ¡ *
	gMa¡”PrÙocŞ
::
commªd_‹xt
(
commªd
) {

92 ià(
commªd
 < 0 || commªd >ğ
COMMAND_MAX
)

94  
	gm_commªd_¡ršgs
[
commªd
];

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/MasterProtocol.h

21 #iâdeà
MASTER_PROTOCOL_H


22 
	#MASTER_PROTOCOL_H


	)

24 
	~"AsyncComm/CommBuf.h
"

25 
	~"AsyncComm/Ev’t.h
"

26 
	~"AsyncComm/PrÙocŞ.h
"

28 
	~"Hy³¹abË/Lib/Ty³s.h
"

30 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

32 
Çme¥aû
 
	gHy³¹abË
 {

34 şas 
	cMa¡”PrÙocŞ
 : 
public
 
PrÙocŞ
 {

36 
public
:

38 cÚ¡ 
COMMAND_CREATE_TABLE
 = 0;

39 cÚ¡ 
	gCOMMAND_GET_SCHEMA
 = 1;

40 cÚ¡ 
	gCOMMAND_STATUS
 = 2;

41 cÚ¡ 
	gCOMMAND_REGISTER_SERVER
 = 3;

42 cÚ¡ 
	gCOMMAND_REPORT_SPLIT
 = 4;

43 cÚ¡ 
	gCOMMAND_DROP_TABLE
 = 5;

44 cÚ¡ 
	gCOMMAND_MAX
 = 6;

46 cÚ¡ *
	gm_commªd_¡ršgs
[];

48 
CommBuf
 *
ü—‹_ü—‹_bË_»que¡
(cÚ¡ *
bËName
, cÚ¡ *
schemaSŒšg
);

50 
CommBuf
 *
ü—‹_g‘_schema_»que¡
(cÚ¡ *
bËName
);

52 
CommBuf
 *
ü—‹_¡©us_»que¡
();

54 
CommBuf
 *
ü—‹_»gi¡”_£rv”_»que¡
(
¡d
::
¡ršg
 &
loÿtiÚ
);

56 
CommBuf
 *
ü—‹_»pÜt_¥l™_»que¡
(
TabËId’tif›rT
 &
bË
, 
RªgeT
 &
¿nge
, 
ušt64_t
 
soá_lim™
);

58 
CommBuf
 *
ü—‹_drİ_bË_»que¡
(cÚ¡ *
bË_Çme
, 
boŞ
 
if_exi¡s
);

60 
vœtu®
 cÚ¡ *
commªd_‹xt
(
commªd
);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/RangeLocationInfo.h

21 #iâdeà
HYPERTABLE_RANGELOCATIONINFO_H


22 
	#HYPERTABLE_RANGELOCATIONINFO_H


	)

24 
	~<¡ršg
>

26 
	~"Ty³s.h
"

29 şas 
	cRªgeLoÿtiÚInfo
 {

30 
	mpublic
:

31 
¡d
::
¡ršg
 
¡¬t_row
;

32 
	m¡d
::
¡ršg
 
’d_row
;

33 
	m¡d
::
¡ršg
 
loÿtiÚ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/RangeLocator.cc

20 
	~<ÿs£¹
>

21 
	~<c¡dlib
>

22 
	~<c¡ršg
>

25 
	~<lim™s.h
>

26 
	~<pŞl.h
>

29 
	~"CommÚ/E¼Ü.h
"

31 
	~"Hy³r¥aû/SessiÚ.h
"

33 
	~"DeçuÉs.h
"

34 
	~"Key.h
"

35 
	~"RoÙFeHªdËr.h
"

36 
	~"RªgeLoÿtÜ.h
"

37 
	~"SÿnBlock.h
"

39 
Çme¥aû
 {

40 cÚ¡ 
ušt32_t
 
METADATA_READAHEAD_COUNT
 = 10;

41 cÚ¡ 
ušt32_t
 
MAX_ERROR_QUEUE_LENGTH
 = 4;

48 
RªgeLoÿtÜ
::RªgeLoÿtÜ(
Prİ”t›sPŒ
 &
´İs_±r
, 
CÚÃùiÚMªag”PŒ
 &
cÚnMªag”PŒ
, 
Hy³r¥aû
::
SessiÚPŒ
 &
hy³r¥aûPŒ
è: 
m_cÚn_mªag”_±r
(cÚnMªag”PŒ), 
m_hy³r¥aû_±r
(hy³r¥aûPŒ), 
m_ÿche
(1000), 
m_roÙ_¡®e
(
Œue
), 
m_¿nge_£rv”
(cÚnMªag”PŒ->
g‘_comm
(), 
HYPERTABLE_RANGESERVER_CLIENT_TIMEOUT
) {

49 
time_t
 
ş›Á_timeout
;

51 ià((
ş›Á_timeout
 = 
´İs_±r
->
g‘_št
("Hypertable.Request.Timeout", 0)) != 0)

52 
m_¿nge_£rv”
.
£t_timeout
(
ş›Á_timeout
);

54 
š™Ÿlize
();

61 
RªgeLoÿtÜ
::RªgeLoÿtÜ(
Prİ”t›sPŒ
 &
´İs_±r
, 
Comm
 *
comm
, 
Hy³r¥aû
::
SessiÚPŒ
 &
hy³r¥aûPŒ
è: 
m_cÚn_mªag”_±r
(0), 
m_hy³r¥aû_±r
(hy³r¥aûPŒ), 
m_ÿche
(1000), 
m_roÙ_¡®e
(
Œue
), 
	$m_¿nge_£rv”
(
comm
, 
HYPERTABLE_RANGESERVER_CLIENT_TIMEOUT
) {

62 
time_t
 
ş›Á_timeout
;

64 ià((
ş›Á_timeout
 = 
´İs_±r
->
	`g‘_št
("Hypertable.Request.Timeout", 0)) != 0)

65 
m_¿nge_£rv”
.
	`£t_timeout
(
ş›Á_timeout
);

67 
	`š™Ÿlize
();

68 
	}
}

71 
RªgeLoÿtÜ
::
	$š™Ÿlize
() {

72 
”rÜ
;

73 
DyÇmicBufãr
 
	`v®ueBuf
(0);

74 
HªdËC®lbackPŒ
 
nuÎHªdËC®lback
;

75 
ušt64_t
 
hªdË
;

76 
Schema
 *
schema
 = 0;

78 
m_roÙ_hªdËr_±r
 = 
Ãw
 
	`RoÙFeHªdËr
(
this
);

80 ià((
”rÜ
 = 
m_hy³r¥aû_±r
->
	`İ’
("/hy³¹abË/roÙ", 
OPEN_FLAG_READ
, 
m_roÙ_hªdËr_±r
, &
m_roÙ_fe_hªdË
)è!ğ
E¼Ü
::
OK
) {

81 
	`HT_ERRORF
("UÇbËØİ’ Hy³r¥aû f'/hy³¹abË/roÙ' (%s)", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

82 
throw
 
	`Exû±iÚ
(
”rÜ
);

85 ià((
”rÜ
 = 
m_hy³r¥aû_±r
->
	`İ’
("/hy³¹abË/bËs/METADATA", 
OPEN_FLAG_READ
, 
nuÎHªdËC®lback
, &
hªdË
)è!ğ
E¼Ü
::
OK
) {

86 
	`HT_ERRORF
("UÇbËØİ’ Hy³r¥aû f'/hy³¹abË/bËs/METADATA' (%s)", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

87 
throw
 
	`Exû±iÚ
(
”rÜ
);

90 ià((
”rÜ
 = 
m_hy³r¥aû_±r
->
	`©Œ_g‘
(
hªdË
, "schema", 
v®ueBuf
)è!ğ
E¼Ü
::
OK
) {

91 
	`HT_ERROR
("Problem getting 'schema'‡ttribute from METADATA hyperspace file");

92 
throw
 
	`Exû±iÚ
(
”rÜ
);

95 
m_hy³r¥aû_±r
->
	`şo£
(
hªdË
);

97 
schema
 = 
Schema
::
	`Ãw_š¡ªû
((cÚ¡ *)
v®ueBuf
.
buf
, v®ueBuf.
	`fl
(), 
Œue
);

98 ià(!
schema
->
	`is_v®id
()) {

99 
d–‘e
 
schema
;

100 
	`HT_ERRORF
("Schem¨P¬£ E¼Ü fÜabË METADATA : %s", 
schema
->
	`g‘_”rÜ_¡ršg
());

101 
throw
 
	`Exû±iÚ
(
E¼Ü
::
RANGESERVER_SCHEMA_PARSE_ERROR
);

104 
m_m‘ad©a_schema_±r
 = 
schema
;

106 
m_m‘ad©a_bË
.
Çme
 = "METADATA";

107 
m_m‘ad©a_bË
.
id
 = 0;

108 
m_m‘ad©a_bË
.
g’”©iÚ
 = 
schema
->
	`g‘_g’”©iÚ
();

110 
Schema
::
CŞumnFamy
 *
cf
;

112 ià((
cf
 = 
schema
->
	`g‘_cŞumn_çmy
("StartRow")) == 0) {

113 
	`HT_ERROR
("Unableo find column family 'StartRow' in METADATA schema");

114 
throw
 
	`Exû±iÚ
(
E¼Ü
::
BAD_SCHEMA
);

116 
m_¡¬Œow_cid
 = 
cf
->
id
;

118 ià((
cf
 = 
schema
->
	`g‘_cŞumn_çmy
("Location")) == 0) {

119 
	`HT_ERROR
("Unableo find column family 'Location' in METADATA schema");

120 
throw
 
	`Exû±iÚ
(
E¼Ü
::
BAD_SCHEMA
);

122 
m_loÿtiÚ_cid
 = 
cf
->
id
;

123 
	}
}

126 
RªgeLoÿtÜ
::~
	$RªgeLoÿtÜ
() {

127 
m_hy³r¥aû_±r
->
	`şo£
(
m_roÙ_fe_hªdË
);

128 
	}
}

132 
RªgeLoÿtÜ
::
	$fšd
(
TabËId’tif›rT
 *
bË
, cÚ¡ *
row_key
, 
RªgeLoÿtiÚInfo
 *
¿nge_loc_šfo_p
, 
timeout
) {

133 
”rÜ
;

134 
wa™_time
 = 1.0;

135 
tÙ®_wa™_time
 = 0.0;

137 
”rÜ
 = 
	`fšd
(
bË
, 
row_key
, 
¿nge_loc_šfo_p
, 
Œue
);

139 ià(
”rÜ
 =ğ
E¼Ü
::
TABLE_DOES_NOT_EXIST
) {

140 
m_Ï¡_”rÜs
.
	`ş—r
();

141 
throw
 
	`Exû±iÚ
(
”rÜ
, (
¡d
::
¡ršg
)"TabË '" + 
bË
->
Çme
 + "' is being dropped.");

145 
”rÜ
 !ğ
E¼Ü
::
OK
 && 
tÙ®_wa™_time
 < ()
timeout
) {

147 
	`pŞl
(0, 0, ()(
wa™_time
*1000.0));

148 
tÙ®_wa™_time
 +ğ
wa™_time
;

149 
wa™_time
 *= 1.5;

151 ià((
”rÜ
 = 
	`fšd
(
bË
, 
row_key
, 
¿nge_loc_šfo_p
, 
Œue
)è=ğ
E¼Ü
::
TABLE_DOES_NOT_EXIST
)

156 ià(
”rÜ
) {

157 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

158 ià(
”rÜ
 =ğ
E¼Ü
::
TABLE_DOES_NOT_EXIST
) {

159 
m_Ï¡_”rÜs
.
	`ş—r
();

160 
throw
 
	`Exû±iÚ
(
”rÜ
, (
¡d
::
¡ršg
)"TabË '" + 
bË
->
Çme
 + "' is being dropped.");

162 
¡d
::
deque
<¡d::
¡ršg
>::
™”©Ü
 
™”
 = 
m_Ï¡_”rÜs
.
	`begš
(); i‹¸!ğm_Ï¡_”rÜs.
	`’d
(); iter++) {

163 
	`HT_ERRORF
("%s", (*
™”
).
	`c_¡r
());

166 
m_Ï¡_”rÜs
.
	`ş—r
();

168  
”rÜ
;

169 
	}
}

171 
Çme¥aû
 {

172 şas 
	cM‘aKeyBud”
 {

173 
public
:

174 
M‘aKeyBud”
(è: 
¡¬t
(0), 
’d
(0) { ; }

175 
bud_keys
(cÚ¡ *
fÜm©
, 
ušt32_t
 
bË_id
, cÚ¡ *
row_key
) {

176 *
±r
;

177 ià(
row_key
) {

178 
¡¬t
 = 
Ãw
 [ 16 + 
¡¾’
(
row_key
) + 1 ];

179 
¥rštf
(
¡¬t
, 
fÜm©
, 
bË_id
);

180 
¡rÿt
(
¡¬t
, 
row_key
);

183 
¡¬t
 = 
Ãw
 [ 16 ];

184 
¥rštf
(
¡¬t
, 
fÜm©
, 
bË_id
);

186 
’d
 = 
Ãw
 [ 16 ];

187 
¥rštf
(
’d
, 
fÜm©
, 
bË_id
);

188 
±r
 = 
’d
 + 
¡¾’
(end);

189 *
±r
++ = ()0xff;

190 *
±r
++ = ()0xff;

191 *
±r
 = 0;

194 ~
M‘aKeyBud”
() {

195 
d–‘e
 [] 
¡¬t
;

196 
d–‘e
 [] 
’d
;

198 *
¡¬t
;

199 *
’d
;

204 
RªgeLoÿtÜ
::
	$fšd
(
TabËId’tif›rT
 *
bË
, cÚ¡ *
row_key
, 
RªgeLoÿtiÚInfo
 *
¿nge_loc_šfo_p
, 
boŞ
 
h¬d
) {

205 
RªgeT
 
¿nge
;

206 
SÿnS³cifiÿtiÚT
 
m‘a_sÿn_¥ec
;

207 
SÿnBlock
 
sÿn_block
;

208 
”rÜ
;

209 
Key
 
keyComps
;

210 
RªgeLoÿtiÚInfo
 
¿nge_loc_šfo
;

211 
¡d
::
¡ršg
 
¡¬t_row
;

212 
¡d
::
¡ršg
 
’d_row
;

213 
sockaddr_š
 
addr
;

214 
boŞ
 
šşusive
 = (
row_key
 =ğ0 || *row_key =ğ0è? 
Œue
 : 
çl£
;

216 ià(
m_roÙ_¡®e
) {

217 ià((
”rÜ
 = 
	`»ad_roÙ_loÿtiÚ
()è!ğ
E¼Ü
::
OK
)

218  
”rÜ
;

221 ià(!
h¬d
 && 
m_ÿche
.
	`lookup
(
bË
->
id
, 
row_key
, 
¿nge_loc_šfo_p
))

222  
E¼Ü
::
OK
;

227 ià(
bË
->
id
 =ğ0 && (
row_key
 =ğ0 || 
	`¡rcmp
Ôow_key, 
Key
::
END_ROOT_ROW
) < 0)) {

228 
¿nge_loc_šfo_p
->
¡¬t_row
 = "";

229 
¿nge_loc_šfo_p
->
’d_row
 = 
Key
::
END_ROOT_ROW
;

230 
¿nge_loc_šfo_p
->
loÿtiÚ
 = 
m_roÙ_¿nge_šfo
.location;

231  
E¼Ü
::
OK
;

236 
¿nge
.
¡¬tRow
 = 0;

237 
¿nge
.
’dRow
 = 
Key
::
END_ROOT_ROW
;

238 
	`memıy
(&
addr
, &
m_roÙ_addr
, (
sockaddr_š
));

240 
M‘aKeyBud”
 
m‘a_keys
;

241 *
m‘a_key_±r
;

243 ià(
bË
->
id
 == 0)

244 
m‘a_keys
.
	`bud_keys
("%d:", 0, 
row_key
);

246 
m‘a_keys
.
	`bud_keys
("0:%d:", 
bË
->
id
, 
row_key
);

252 
m‘a_key_±r
 = 
m‘a_keys
.
¡¬t
+2;

253 ià(
h¬d
 || !
m_ÿche
.
	`lookup
(0, 
m‘a_key_±r
, 
¿nge_loc_šfo_p
, 
šşusive
)) {

254 
m‘a_sÿn_¥ec
.
rowLim™
 = 
METADATA_READAHEAD_COUNT
;

255 
m‘a_sÿn_¥ec
.
max_v”siÚs
 = 1;

256 
m‘a_sÿn_¥ec
.
cŞumns
.
	`ş—r
();

257 
m‘a_sÿn_¥ec
.
cŞumns
.
	`push_back
("StartRow");

258 
m‘a_sÿn_¥ec
.
cŞumns
.
	`push_back
("Location");

259 
m‘a_sÿn_¥ec
.
¡¬tRow
 = 
m‘a_keys
.
¡¬t
;

260 
m‘a_sÿn_¥ec
.
¡¬tRowInşusive
 = 
Œue
;

261 
m‘a_sÿn_¥ec
.
’dRow
 = 0;

262 
m‘a_sÿn_¥ec
.
’dRowInşusive
 = 
çl£
;

263 
m‘a_sÿn_¥ec
.
»tuº_d–‘es
 = 
çl£
;

266 ià((
”rÜ
 = 
m_¿nge_£rv”
.
	`ü—‹_sÿÂ”
(
addr
, 
m_m‘ad©a_bË
, 
¿nge
, 
m‘a_sÿn_¥ec
, 
sÿn_block
)è!ğ
E¼Ü
::
OK
)

267  
”rÜ
;

269 ià((
”rÜ
 = 
	`´oûss_m‘ad©a_sÿnblock
(
sÿn_block
)è!ğ
E¼Ü
::
OK
) {

270 
m_¿nge_£rv”
.
	`de¡roy_sÿÂ”
(
addr
, 
sÿn_block
.
	`g‘_sÿÂ”_id
(), 0);

271  
”rÜ
;

274 ià(!
sÿn_block
.
	`eos
()) {

275 
m_¿nge_£rv”
.
	`de¡roy_sÿÂ”
(
addr
, 
sÿn_block
.
	`g‘_sÿÂ”_id
(), 0);

278 ià(!
m_ÿche
.
	`lookup
(0, 
m‘a_key_±r
, 
¿nge_loc_šfo_p
, 
šşusive
)) {

279 
	`HT_ERRORF
("UÇbËØfšd m‘ad©¨fÜ„ow '%s'", 
m‘a_keys
.
¡¬t
);

280  
E¼Ü
::
METADATA_NOT_FOUND
;

284 ià(
bË
->
id
 == 0)

285  
E¼Ü
::
OK
;

291 
¿nge
.
¡¬tRow
 = 
¿nge_loc_šfo_p
->
¡¬t_row
.
	`c_¡r
();

292 
¿nge
.
’dRow
 = 
¿nge_loc_šfo_p
->
’d_row
.
	`c_¡r
();

294 ià(!
LoÿtiÚCache
::
	`loÿtiÚ_to_addr
(
¿nge_loc_šfo_p
->
loÿtiÚ
.
	`c_¡r
(), 
addr
)) {

295 
	`HT_ERRORF
("Inv®id†oÿtiÚ found iÀMETADATAƒÁry fÜ„ow '%s' - %s", 
¡¬t_row
.
	`c_¡r
(), 
¿nge_loc_šfo_p
->
loÿtiÚ
.c_str());

296  
E¼Ü
::
INVALID_METADATA
;

299 
m‘a_sÿn_¥ec
.
rowLim™
 = 
METADATA_READAHEAD_COUNT
;

300 
m‘a_sÿn_¥ec
.
max_v”siÚs
 = 1;

301 
m‘a_sÿn_¥ec
.
cŞumns
.
	`ş—r
();

302 
m‘a_sÿn_¥ec
.
cŞumns
.
	`push_back
("StartRow");

303 
m‘a_sÿn_¥ec
.
cŞumns
.
	`push_back
("Location");

304 
m‘a_sÿn_¥ec
.
¡¬tRow
 = 
m‘a_keys
.
¡¬t
+2;

305 
m‘a_sÿn_¥ec
.
¡¬tRowInşusive
 = 
Œue
;

306 
m‘a_sÿn_¥ec
.
’dRow
 = 
m‘a_keys
.
’d
+2;

307 
m‘a_sÿn_¥ec
.
’dRowInşusive
 = 
Œue
;

310 ià(
m_cÚn_mªag”_±r
)

311 
m_cÚn_mªag”_±r
->
	`wa™_fÜ_cÚÃùiÚ
(
addr
, 12);

313 ià((
”rÜ
 = 
m_¿nge_£rv”
.
	`ü—‹_sÿÂ”
(
addr
, 
m_m‘ad©a_bË
, 
¿nge
, 
m‘a_sÿn_¥ec
, 
sÿn_block
)è!ğ
E¼Ü
::
OK
)

314  
”rÜ
;

316 ià((
”rÜ
 = 
	`´oûss_m‘ad©a_sÿnblock
(
sÿn_block
)è!ğ
E¼Ü
::
OK
) {

317 
m_¿nge_£rv”
.
	`de¡roy_sÿÂ”
(
addr
, 
sÿn_block
.
	`g‘_sÿÂ”_id
(), 0);

318  
”rÜ
;

321 ià(!
sÿn_block
.
	`eos
()) {

322 
m_¿nge_£rv”
.
	`de¡roy_sÿÂ”
(
addr
, 
sÿn_block
.
	`g‘_sÿÂ”_id
(), 0);

325 ià(
row_key
 == 0)

326 
row_key
 = "";

328 ià(!
m_ÿche
.
	`lookup
(
bË
->
id
, 
row_key
, 
¿nge_loc_šfo_p
, 
šşusive
)) {

329 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

330 
m_Ï¡_”rÜs
.
	`push_back
Ğ(
¡d
::
¡ršg
)"RªgeLoÿtÜ faedØfšd m‘ad©¨fÜabË '" + 
bË
->
Çme
 + "'„ow '" + 
row_key
 + "'" );

331 
m_Ï¡_”rÜs
.
	`size
(è> 
MAX_ERROR_QUEUE_LENGTH
)

332 
m_Ï¡_”rÜs
.
	`pİ_äÚt
();

333  
E¼Ü
::
METADATA_NOT_FOUND
;

336  
E¼Ü
::
OK
;

337 
	}
}

343 
RªgeLoÿtÜ
::
	$´oûss_m‘ad©a_sÿnblock
(
SÿnBlock
 &
sÿn_block
) {

344 
RªgeLoÿtiÚInfo
 
¿nge_loc_šfo
;

345 cÚ¡ 
By‹SŒšg32T
 *
key
;

346 cÚ¡ 
By‹SŒšg32T
 *
v®ue
;

347 
Key
 
keyComps
;

348 cÚ¡ *
¡r³d_key
;

349 
ušt32_t
 
bË_id
 = 0;

350 
sockaddr_š
 
addr
;

352 
¿nge_loc_šfo
.
¡¬t_row
 = "";

353 
¿nge_loc_šfo
.
’d_row
 = "";

354 
¿nge_loc_šfo
.
loÿtiÚ
 = "";

356 
boŞ
 
gÙ_¡¬t_row
 = 
çl£
;

357 
boŞ
 
gÙ_’d_row
 = 
çl£
;

358 
boŞ
 
gÙ_loÿtiÚ
 = 
çl£
;

360 
sÿn_block
.
	`Ãxt
(
key
, 
v®ue
)) {

362 ià(!
keyComps
.
	`lßd
(
key
)) {

363 
	`HT_ERRORF
("METADATA†ooku°fÜ '%s'„‘uºed bad key", (cÚ¡ *)
key
->
d©a
);

364  
E¼Ü
::
INVALID_METADATA
;

367 ià((
¡r³d_key
 = 
	`¡rchr
(
keyComps
.
row
, ':')) == 0) {

368 
	`HT_ERRORF
("Bad„ow key found iÀMETADATA - '%s'", 
keyComps
.
row
);

369  
E¼Ü
::
INVALID_METADATA
;

371 
¡r³d_key
++;

373 ià(
gÙ_’d_row
) {

374 ià(
	`¡rcmp
(
¡r³d_key
, 
¿nge_loc_šfo
.
’d_row
.
	`c_¡r
())) {

375 ià(
gÙ_¡¬t_row
 && 
gÙ_loÿtiÚ
) {

380 ià(!
LoÿtiÚCache
::
	`loÿtiÚ_to_addr
(
¿nge_loc_šfo
.
loÿtiÚ
.
	`c_¡r
(), 
addr
)) {

381 
	`HT_ERRORF
("Inv®id†oÿtiÚ found iÀMETADATAƒÁry fÜ„ow '%s' - %s", 
¿nge_loc_šfo
.
’d_row
.
	`c_¡r
(),„ªge_loc_šfo.
loÿtiÚ
.c_str());

382  
E¼Ü
::
INVALID_METADATA
;

384 ià(
m_cÚn_mªag”_±r
)

385 
m_cÚn_mªag”_±r
->
	`add
(
addr
, 300, "RangeServer");

387 
m_ÿche
.
	`š£¹
(
bË_id
, 
¿nge_loc_šfo
);

391 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

392 
m_Ï¡_”rÜs
.
	`push_back
Ğ(
¡d
::
¡ršg
)"Incom¶‘METADATA„ecÜd found iÀroÙ„ªgund”„ow key '" + 
¿nge_loc_šfo
.
’d_row
 + "'" );

393 
m_Ï¡_”rÜs
.
	`size
(è> 
MAX_ERROR_QUEUE_LENGTH
)

394 
m_Ï¡_”rÜs
.
	`pİ_äÚt
();

396 
¿nge_loc_šfo
.
¡¬t_row
 = "";

397 
¿nge_loc_šfo
.
’d_row
 = "";

398 
¿nge_loc_šfo
.
loÿtiÚ
 = "";

399 
gÙ_¡¬t_row
 = 
çl£
;

400 
gÙ_’d_row
 = 
çl£
;

401 
gÙ_loÿtiÚ
 = 
çl£
;

405 
bË_id
 = (
ušt32_t
)
	`¡¹Ş
(
keyComps
.
row
, 0, 10);

406 
¿nge_loc_šfo
.
’d_row
 = 
¡r³d_key
;

407 
gÙ_’d_row
 = 
Œue
;

410 ià(
keyComps
.
cŞumn_çmy_code
 =ğ
m_¡¬Œow_cid
) {

412 
¿nge_loc_šfo
.
¡¬t_row
 = 
¡d
::
	`¡ršg
((cÚ¡ *)
v®ue
->
d©a
, v®ue->
Ën
);

413 
gÙ_¡¬t_row
 = 
Œue
;

415 ià(
keyComps
.
cŞumn_çmy_code
 =ğ
m_loÿtiÚ_cid
) {

416 
¿nge_loc_šfo
.
loÿtiÚ
 = 
¡d
::
	`¡ršg
((cÚ¡ *)
v®ue
->
d©a
, v®ue->
Ën
);

417 ià(
¿nge_loc_šfo
.
loÿtiÚ
 == "!")

418  
E¼Ü
::
TABLE_DOES_NOT_EXIST
;

419 
gÙ_loÿtiÚ
 = 
Œue
;

422 
	`HT_ERRORF
("METADATA†ooku°Ú„ow '%s'„‘uºed incÜ»ù cŞumÀ(id=%d)", (cÚ¡ *)
key
->
d©a
, 
keyComps
.
cŞumn_çmy_code
);

426 ià(
gÙ_¡¬t_row
 && 
gÙ_’d_row
 && 
gÙ_loÿtiÚ
) {

431 ià(!
LoÿtiÚCache
::
	`loÿtiÚ_to_addr
(
¿nge_loc_šfo
.
loÿtiÚ
.
	`c_¡r
(), 
addr
)) {

432 
	`HT_ERRORF
("Inv®id†oÿtiÚ found iÀMETADATAƒÁry fÜ„ow '%s' - %s", 
¿nge_loc_šfo
.
’d_row
.
	`c_¡r
(),„ªge_loc_šfo.
loÿtiÚ
.c_str());

433  
E¼Ü
::
INVALID_METADATA
;

435 ià(
m_cÚn_mªag”_±r
)

436 
m_cÚn_mªag”_±r
->
	`add
(
addr
, 300, "RangeServer");

438 
m_ÿche
.
	`š£¹
(
bË_id
, 
¿nge_loc_šfo
);

442 ià(
gÙ_’d_row
) {

443 
	`HT_ERRORF
("Incom¶‘METADATA„ecÜd found iÀroÙabËˆund”„ow key '%s'", 
¿nge_loc_šfo
.
’d_row
.
	`c_¡r
());

446  
E¼Ü
::
OK
;

447 
	}
}

455 
RªgeLoÿtÜ
::
	$»ad_roÙ_loÿtiÚ
() {

456 
”rÜ
;

457 
DyÇmicBufãr
 
	`v®ue
(0);

458 
¡d
::
¡ršg
 
addrSŒ
;

460 ià((
”rÜ
 = 
m_hy³r¥aû_±r
->
	`©Œ_g‘
(
m_roÙ_fe_hªdË
, "loÿtiÚ", 
v®ue
)è!ğ
E¼Ü
::
OK
) {

461 
	`HT_ERRORF
("ProbËm„—dšg 'loÿtiÚ'‡‰ribu‹ oàHy³r¥aû f/hy³¹abË/roÙ - %s", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

462  
”rÜ
;

465 
m_roÙ_¿nge_šfo
.
¡¬t_row
 = "";

466 
m_roÙ_¿nge_šfo
.
’d_row
 = 
Key
::
END_ROOT_ROW
;

467 
m_roÙ_¿nge_šfo
.
loÿtiÚ
 = (cÚ¡ *)
v®ue
.
buf
;

469 
m_ÿche
.
	`š£¹
(0, 
m_roÙ_¿nge_šfo
, 
Œue
);

471 ià(!
LoÿtiÚCache
::
	`loÿtiÚ_to_addr
((cÚ¡ *)
v®ue
.
buf
, 
m_roÙ_addr
)) {

472 
	`HT_ERROR
("Bad format of 'location'‡ttribute of /hypertable/root Hyperspace file");

473  
E¼Ü
::
BAD_ROOT_LOCATION
;

476 ià(
m_cÚn_mªag”_±r
) {

478 
m_cÚn_mªag”_±r
->
	`add
(
m_roÙ_addr
, 8, "Root RangeServer");

480 ià(!
m_cÚn_mªag”_±r
->
	`wa™_fÜ_cÚÃùiÚ
(
m_roÙ_addr
, 20)) {

481 
¡d
::
¡ršg
 
addr_¡r
;

482 
	`HT_ERRORF
("Timeout (20s) waiting for„oot RangeServer connection - %s",

483 
IÃtAddr
::
	`¡ršg_fÜm©
(
addr_¡r
, 
m_roÙ_addr
));

487 
m_roÙ_¡®e
 = 
çl£
;

489  
E¼Ü
::
OK
;

490 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/RangeLocator.h

21 #iâdeà
HYPERTABLE_RANGELOCATOR_H


22 
	#HYPERTABLE_RANGELOCATOR_H


	)

24 
	~<deque
>

26 
	~"CommÚ/Reã»nûCouÁ.h
"

28 
	~"AsyncComm/CÚÃùiÚMªag”.h
"

30 
	~"Hy³r¥aû/SessiÚ.h
"

32 
	~"LoÿtiÚCache.h
"

33 
	~"RªgeS”v”Cl›Á.h
"

34 
	~"RªgeLoÿtiÚInfo.h
"

35 
	~"Schema.h
"

36 
	~"Ty³s.h
"

38 
Çme¥aû
 
	gHy³r¥aû
 {

39 
şass
 
	gSessiÚ
;

42 
Çme¥aû
 
	gHy³¹abË
 {

44 
şass
 
	gRªgeS”v”Cl›Á
;

49 şas 
	cRªgeLoÿtÜ
 : 
public
 
Reã»nûCouÁ
 {

51 
public
:

60 
RªgeLoÿtÜ
(
Prİ”t›sPŒ
 &
´İs_±r
, 
CÚÃùiÚMªag”PŒ
 &
cÚnMªag”PŒ
, 
Hy³r¥aû
::
SessiÚPŒ
 &
hy³r¥aûPŒ
);

70 
RªgeLoÿtÜ
(
Prİ”t›sPŒ
 &
´İs_±r
, 
Comm
 *
comm
, 
Hy³r¥aû
::
SessiÚPŒ
 &
hy³r¥aûPŒ
);

73 ~
RªgeLoÿtÜ
();

83 
fšd
(
TabËId’tif›rT
 *
bË
, cÚ¡ *
row_key
, 
RªgeLoÿtiÚInfo
 *
¿nge_loc_šfo_p
, 
timeout
);

93 
fšd
(
TabËId’tif›rT
 *
bË
, cÚ¡ *
row_key
, 
RªgeLoÿtiÚInfo
 *
¿nge_loc_šfo_p
, 
boŞ
 
h¬d
);

98 
£t_roÙ_¡®e
(è{ 
	gm_roÙ_¡®e
=
Œue
; }

100 
	g´iv©e
:

102 
š™Ÿlize
();

103 
´oûss_m‘ad©a_sÿnblock
(
SÿnBlock
 &
sÿn_block
);

104 
»ad_roÙ_loÿtiÚ
();

106 
	gboo¡
::
mu‹x
 
m_mu‹x
;

107 
CÚÃùiÚMªag”PŒ
 
	gm_cÚn_mªag”_±r
;

108 
	gHy³r¥aû
::
SessiÚPŒ
 
m_hy³r¥aû_±r
;

109 
LoÿtiÚCache
 
	gm_ÿche
;

110 
ušt64_t
 
	gm_roÙ_fe_hªdË
;

111 
HªdËC®lbackPŒ
 
	gm_roÙ_hªdËr_±r
;

112 
boŞ
 
	gm_roÙ_¡®e
;

113 
sockaddr_š
 
	gm_roÙ_addr
;

114 
RªgeLoÿtiÚInfo
 
	gm_roÙ_¿nge_šfo
;

115 
RªgeS”v”Cl›Á
 
	gm_¿nge_£rv”
;

116 
SchemaPŒ
 
	gm_m‘ad©a_schema_±r
;

117 
ušt8_t
 
	gm_¡¬Œow_cid
;

118 
ušt8_t
 
	gm_loÿtiÚ_cid
;

119 
TabËId’tif›rT
 
	gm_m‘ad©a_bË
;

120 
	g¡d
::
deque
<
¡d
::
¡ršg
> 
m_Ï¡_”rÜs
;

123 
	gboo¡
::
	tšŒusive_±r
<
	tRªgeLoÿtÜ
> 
	tRªgeLoÿtÜPŒ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/RangeServerClient.cc

21 
	~"CommÚ/E¼Ü.h
"

22 
	~"AsyncComm/Di¥©chHªdËrSynchrÚiz”.h
"

24 
	~"RªgeS”v”Cl›Á.h
"

25 
	~"SÿnBlock.h
"

27 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

30 
	gRªgeS”v”Cl›Á
::
	$RªgeS”v”Cl›Á
(
Comm
 *
comm
, 
time_t
 
timeout
è: 
	`m_comm
(comm), 
	$m_timeout
(
timeout
) {

31 
	}
}

34 
	gRªgeS”v”Cl›Á
::~
	$RªgeS”v”Cl›Á
() {

36 
	}
}

38 
	gRªgeS”v”Cl›Á
::
	$lßd_¿nge
(
sockaddr_š
 &
addr
, 
TabËId’tif›rT
 &
bË
, 
RªgeT
 &
¿nge
, 
ušt64_t
 
soá_lim™
, 
ušt16_t
 
æags
, 
Di¥©chHªdËr
 *
hªdËr
) {

39 
CommBufPŒ
 
	`cbufPŒ
Ğ
RªgeS”v”PrÙocŞ
::
	`ü—‹_»que¡_lßd_¿nge
(
bË
, 
¿nge
, 
soá_lim™
, 
æags
) );

40  
	`£nd_mes§ge
(
addr
, 
cbufPŒ
, 
hªdËr
);

41 
	}
}

43 
	gRªgeS”v”Cl›Á
::
	$lßd_¿nge
(
sockaddr_š
 &
addr
, 
TabËId’tif›rT
 &
bË
, 
RªgeT
 &
¿nge
, 
ušt64_t
 
soá_lim™
, 
ušt16_t
 
æags
) {

44 
Di¥©chHªdËrSynchrÚiz”
 
syncHªdËr
;

45 
Ev’tPŒ
 
ev’tPŒ
;

46 
CommBufPŒ
 
	`cbufPŒ
Ğ
RªgeS”v”PrÙocŞ
::
	`ü—‹_»que¡_lßd_¿nge
(
bË
, 
¿nge
, 
soá_lim™
, 
æags
) );

47 
”rÜ
 = 
	`£nd_mes§ge
(
addr
, 
cbufPŒ
, &
syncHªdËr
);

48 ià(
”rÜ
 =ğ
E¼Ü
::
OK
) {

49 ià(!
syncHªdËr
.
	`wa™_fÜ_»¶y
(
ev’tPŒ
)) {

50 
	`HT_ERRORF
("RªgeS”v” 'lßd„ªge'ƒ¼Ü : %s", 
PrÙocŞ
::
	`¡ršg_fÜm©_mes§ge
(
ev’tPŒ
).
	`c_¡r
());

51 
”rÜ
 = ()
PrÙocŞ
::
	`»¥Ú£_code
(
ev’tPŒ
);

54  
”rÜ
;

55 
	}
}

58 
	gRªgeS”v”Cl›Á
::
	$upd©e
(
sockaddr_š
 &
addr
, 
TabËId’tif›rT
 &
bË
, 
ušt8_t
 *
d©a
, 
size_t
 
Ën
, 
Di¥©chHªdËr
 *
hªdËr
) {

59 
CommBufPŒ
 
	`cbufPŒ
Ğ
RªgeS”v”PrÙocŞ
::
	`ü—‹_»que¡_upd©e
(
bË
, 
d©a
, 
Ën
) );

60  
	`£nd_mes§ge
(
addr
, 
cbufPŒ
, 
hªdËr
);

61 
	}
}

64 
	gRªgeS”v”Cl›Á
::
	$upd©e
(
sockaddr_š
 &
addr
, 
TabËId’tif›rT
 &
bË
, 
ušt8_t
 *
d©a
, 
size_t
 
Ën
) {

65 
Di¥©chHªdËrSynchrÚiz”
 
syncHªdËr
;

66 
Ev’tPŒ
 
ev’tPŒ
;

67 
CommBufPŒ
 
	`cbufPŒ
Ğ
RªgeS”v”PrÙocŞ
::
	`ü—‹_»que¡_upd©e
(
bË
, 
d©a
, 
Ën
) );

68 
”rÜ
 = 
	`£nd_mes§ge
(
addr
, 
cbufPŒ
, &
syncHªdËr
);

69 ià(
”rÜ
 =ğ
E¼Ü
::
OK
) {

70 ià(!
syncHªdËr
.
	`wa™_fÜ_»¶y
(
ev’tPŒ
)) {

71 
	`HT_ERRORF
("RªgeS”v” 'upd©e'ƒ¼Ü : %s", 
PrÙocŞ
::
	`¡ršg_fÜm©_mes§ge
(
ev’tPŒ
).
	`c_¡r
());

72 
”rÜ
 = ()
PrÙocŞ
::
	`»¥Ú£_code
(
ev’tPŒ
);

75  
”rÜ
;

76 
	}
}

80 
	gRªgeS”v”Cl›Á
::
	$ü—‹_sÿÂ”
(
sockaddr_š
 &
addr
, 
TabËId’tif›rT
 &
bË
, 
RªgeT
 &
¿nge
, 
SÿnS³cifiÿtiÚT
 &
sÿn_¥ec
, 
Di¥©chHªdËr
 *
hªdËr
) {

81 
CommBufPŒ
 
	`cbufPŒ
Ğ
RªgeS”v”PrÙocŞ
::
	`ü—‹_»que¡_ü—‹_sÿÂ”
(
bË
, 
¿nge
, 
sÿn_¥ec
) );

82  
	`£nd_mes§ge
(
addr
, 
cbufPŒ
, 
hªdËr
);

83 
	}
}

86 
	gRªgeS”v”Cl›Á
::
	$ü—‹_sÿÂ”
(
sockaddr_š
 &
addr
, 
TabËId’tif›rT
 &
bË
, 
RªgeT
 &
¿nge
, 
SÿnS³cifiÿtiÚT
 &
sÿn_¥ec
, 
SÿnBlock
 &
sÿn_block
) {

87 
Di¥©chHªdËrSynchrÚiz”
 
syncHªdËr
;

88 
Ev’tPŒ
 
ev’tPŒ
;

89 
CommBufPŒ
 
	`cbufPŒ
Ğ
RªgeS”v”PrÙocŞ
::
	`ü—‹_»que¡_ü—‹_sÿÂ”
(
bË
, 
¿nge
, 
sÿn_¥ec
) );

90 
”rÜ
 = 
	`£nd_mes§ge
(
addr
, 
cbufPŒ
, &
syncHªdËr
);

91 ià(
”rÜ
 =ğ
E¼Ü
::
OK
) {

92 ià(!
syncHªdËr
.
	`wa™_fÜ_»¶y
(
ev’tPŒ
)) {

93 
	`HT_ERRORF
("RªgeS”v” 'ü—‹ sÿÂ”'ƒ¼Ü : %s", 
PrÙocŞ
::
	`¡ršg_fÜm©_mes§ge
(
ev’tPŒ
).
	`c_¡r
());

94 
”rÜ
 = ()
PrÙocŞ
::
	`»¥Ú£_code
(
ev’tPŒ
);

97 
”rÜ
 = 
sÿn_block
.
	`lßd
(
ev’tPŒ
);

99  
”rÜ
;

100 
	}
}

103 
	gRªgeS”v”Cl›Á
::
	$de¡roy_sÿÂ”
(
sockaddr_š
 &
addr
, 
sÿÂ”_id
, 
Di¥©chHªdËr
 *
hªdËr
) {

104 
CommBufPŒ
 
	`cbufPŒ
Ğ
RªgeS”v”PrÙocŞ
::
	`ü—‹_»que¡_de¡roy_sÿÂ”
(
sÿÂ”_id
) );

105  
	`£nd_mes§ge
(
addr
, 
cbufPŒ
, 
hªdËr
);

106 
	}
}

109 
	gRªgeS”v”Cl›Á
::
	$de¡roy_sÿÂ”
(
sockaddr_š
 &
addr
, 
sÿÂ”_id
) {

110 
Di¥©chHªdËrSynchrÚiz”
 
syncHªdËr
;

111 
Ev’tPŒ
 
ev’tPŒ
;

112 
CommBufPŒ
 
	`cbufPŒ
Ğ
RªgeS”v”PrÙocŞ
::
	`ü—‹_»que¡_de¡roy_sÿÂ”
(
sÿÂ”_id
) );

113 
”rÜ
 = 
	`£nd_mes§ge
(
addr
, 
cbufPŒ
, &
syncHªdËr
);

114 ià(
”rÜ
 =ğ
E¼Ü
::
OK
) {

115 ià(!
syncHªdËr
.
	`wa™_fÜ_»¶y
(
ev’tPŒ
)) {

116 
	`HT_ERRORF
("RªgeS”v” 'ãtch sÿnblock'ƒ¼Ü : %s", 
PrÙocŞ
::
	`¡ršg_fÜm©_mes§ge
(
ev’tPŒ
).
	`c_¡r
());

117 
”rÜ
 = ()
PrÙocŞ
::
	`»¥Ú£_code
(
ev’tPŒ
);

120  
”rÜ
;

121 
	}
}

124 
	gRªgeS”v”Cl›Á
::
	$ãtch_sÿnblock
(
sockaddr_š
 &
addr
, 
sÿÂ”_id
, 
Di¥©chHªdËr
 *
hªdËr
) {

125 
CommBufPŒ
 
	`cbufPŒ
Ğ
RªgeS”v”PrÙocŞ
::
	`ü—‹_»que¡_ãtch_sÿnblock
(
sÿÂ”_id
) );

126  
	`£nd_mes§ge
(
addr
, 
cbufPŒ
, 
hªdËr
);

127 
	}
}

130 
	gRªgeS”v”Cl›Á
::
	$ãtch_sÿnblock
(
sockaddr_š
 &
addr
, 
sÿÂ”_id
, 
SÿnBlock
 &
sÿn_block
) {

131 
Di¥©chHªdËrSynchrÚiz”
 
syncHªdËr
;

132 
Ev’tPŒ
 
ev’tPŒ
;

133 
CommBufPŒ
 
	`cbufPŒ
Ğ
RªgeS”v”PrÙocŞ
::
	`ü—‹_»que¡_ãtch_sÿnblock
(
sÿÂ”_id
) );

134 
”rÜ
 = 
	`£nd_mes§ge
(
addr
, 
cbufPŒ
, &
syncHªdËr
);

135 ià(
”rÜ
 =ğ
E¼Ü
::
OK
) {

136 ià(!
syncHªdËr
.
	`wa™_fÜ_»¶y
(
ev’tPŒ
)) {

137 
	`HT_ERRORF
("RªgeS”v” 'ãtch sÿnblock'ƒ¼Ü : %s", 
PrÙocŞ
::
	`¡ršg_fÜm©_mes§ge
(
ev’tPŒ
).
	`c_¡r
());

138 
”rÜ
 = ()
PrÙocŞ
::
	`»¥Ú£_code
(
ev’tPŒ
);

141 
”rÜ
 = 
sÿn_block
.
	`lßd
(
ev’tPŒ
);

143  
”rÜ
;

144 
	}
}

147 
	gRªgeS”v”Cl›Á
::
drİ_bË
(
sockaddr_š
 &
addr
, 
¡d
::
¡ršg
 
bË_Çme
, 
Di¥©chHªdËr
 *
hªdËr
) {

148 
CommBufPŒ
 
cbufPŒ
Ğ
RªgeS”v”PrÙocŞ
::
ü—‹_»que¡_drİ_bË
(
bË_Çme
) );

149  
£nd_mes§ge
(
addr
, 
cbufPŒ
, 
hªdËr
);

153 
	gRªgeS”v”Cl›Á
::
drİ_bË
(
sockaddr_š
 &
addr
, 
¡d
::
¡ršg
 
bË_Çme
) {

154 
Di¥©chHªdËrSynchrÚiz”
 
syncHªdËr
;

155 
Ev’tPŒ
 
	gev’tPŒ
;

156 
CommBufPŒ
 
cbufPŒ
Ğ
RªgeS”v”PrÙocŞ
::
ü—‹_»que¡_drİ_bË
(
bË_Çme
) );

157 
	g”rÜ
 = 
£nd_mes§ge
(
addr
, 
cbufPŒ
, &
syncHªdËr
);

158 ià(
	g”rÜ
 =ğ
E¼Ü
::
OK
) {

159 ià(!
syncHªdËr
.
wa™_fÜ_»¶y
(
ev’tPŒ
)) {

160 
HT_ERRORF
("RªgeS”v” 'drİabË'ƒ¼Ü : %s", 
PrÙocŞ
::
¡ršg_fÜm©_mes§ge
(
ev’tPŒ
).
c_¡r
());

161 
	g”rÜ
 = ()
PrÙocŞ
::
»¥Ú£_code
(
ev’tPŒ
);

164  
	g”rÜ
;

168 
	gRªgeS”v”Cl›Á
::
	$¡©us
(
sockaddr_š
 &
addr
) {

169 
Di¥©chHªdËrSynchrÚiz”
 
syncHªdËr
;

170 
Ev’tPŒ
 
ev’tPŒ
;

171 
CommBufPŒ
 
	`cbufPŒ
Ğ
RªgeS”v”PrÙocŞ
::
	`ü—‹_»que¡_¡©us
() );

172 
”rÜ
 = 
	`£nd_mes§ge
(
addr
, 
cbufPŒ
, &
syncHªdËr
);

173 ià(
”rÜ
 =ğ
E¼Ü
::
OK
) {

174 ià(!
syncHªdËr
.
	`wa™_fÜ_»¶y
(
ev’tPŒ
)) {

175 
	`HT_ERRORF
("RªgeS”v” '¡©us'ƒ¼Ü : %s", 
PrÙocŞ
::
	`¡ršg_fÜm©_mes§ge
(
ev’tPŒ
).
	`c_¡r
());

176 
”rÜ
 = ()
PrÙocŞ
::
	`»¥Ú£_code
(
ev’tPŒ
);

179  
”rÜ
;

180 
	}
}

182 
	gRªgeS”v”Cl›Á
::
	$shutdown
(
sockaddr_š
 &
addr
) {

183 
Di¥©chHªdËrSynchrÚiz”
 
syncHªdËr
;

184 
Ev’tPŒ
 
ev’tPŒ
;

185 
CommBufPŒ
 
	`cbufPŒ
Ğ
RªgeS”v”PrÙocŞ
::
	`ü—‹_»que¡_shutdown
() );

186 
”rÜ
 = 
	`£nd_mes§ge
(
addr
, 
cbufPŒ
, &
syncHªdËr
);

187 ià(
”rÜ
 =ğ
E¼Ü
::
OK
) {

188 ià(!
syncHªdËr
.
	`wa™_fÜ_»¶y
(
ev’tPŒ
)) {

189 
	`HT_ERRORF
("RªgeS”v” 'shutdown'ƒ¼Ü : %s", 
PrÙocŞ
::
	`¡ršg_fÜm©_mes§ge
(
ev’tPŒ
).
	`c_¡r
());

190 
”rÜ
 = ()
PrÙocŞ
::
	`»¥Ú£_code
(
ev’tPŒ
);

193  
”rÜ
;

194 
	}
}

196 
	gRªgeS”v”Cl›Á
::
	$dump_¡©s
(
sockaddr_š
 &
addr
) {

197 
Di¥©chHªdËrSynchrÚiz”
 
syncHªdËr
;

198 
Ev’tPŒ
 
ev’tPŒ
;

199 
CommBufPŒ
 
	`cbufPŒ
Ğ
RªgeS”v”PrÙocŞ
::
	`ü—‹_»que¡_dump_¡©s
() );

200 
”rÜ
 = 
	`£nd_mes§ge
(
addr
, 
cbufPŒ
, &
syncHªdËr
);

201 ià(
”rÜ
 =ğ
E¼Ü
::
OK
) {

202 ià(!
syncHªdËr
.
	`wa™_fÜ_»¶y
(
ev’tPŒ
)) {

203 
	`HT_ERRORF
("RªgeS”v” '¡©us'ƒ¼Ü : %s", 
PrÙocŞ
::
	`¡ršg_fÜm©_mes§ge
(
ev’tPŒ
).
	`c_¡r
());

204 
”rÜ
 = ()
PrÙocŞ
::
	`»¥Ú£_code
(
ev’tPŒ
);

207  
”rÜ
;

208 
	}
}

214 
	gRªgeS”v”Cl›Á
::
	$£nd_mes§ge
(
sockaddr_š
 &
addr
, 
CommBufPŒ
 &
cbufPŒ
, 
Di¥©chHªdËr
 *
hªdËr
) {

215 
”rÜ
;

217 ià((
”rÜ
 = 
m_comm
->
	`£nd_»que¡
(
addr
, 
m_timeout
, 
cbufPŒ
, 
hªdËr
)è!ğ
E¼Ü
::
OK
) {

218 
	`HT_WARNF
("Comm::send_requesto %s:%d failed - %s",

219 
	`š‘_Áß
(
addr
.
sš_addr
), 
	`Áohs
×ddr.
sš_pÜt
), 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

221  
”rÜ
;

222 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/RangeServerClient.h

21 #iâdeà
HYPERTABLE_RANGESERVERCLIENT_H


22 
	#HYPERTABLE_RANGESERVERCLIENT_H


	)

24 
	~<boo¡/šŒusive_±r.hµ
>

26 
	~"CommÚ/Prİ”t›s.h
"

27 
	~"CommÚ/Reã»nûCouÁ.h
"

29 
	~"AsyncComm/Comm.h
"

30 
	~"AsyncComm/CommBuf.h
"

31 
	~"AsyncComm/Di¥©chHªdËr.h
"

33 
	~"RªgeS”v”PrÙocŞ.h
"

34 
	~"Ty³s.h
"

36 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

38 
Çme¥aû
 
	gHy³¹abË
 {

40 
şass
 
	gSÿnBlock
;

43 şas 
	cRªgeS”v”Cl›Á
 : 
public
 
Reã»nûCouÁ
 {

44 
public
:

46 
RªgeS”v”Cl›Á
(
Comm
 *
comm
, 
time_t
 
timeout
);

47 ~
RªgeS”v”Cl›Á
();

53 
£t_timeout
(
time_t
 
timeout
è{ 
	gm_timeout
 =imeout; }

65 
lßd_¿nge
(
sockaddr_š
 &
addr
, 
TabËId’tif›rT
 &
bË
, 
RªgeT
 &
¿nge
, 
ušt64_t
 
soá_lim™
, 
ušt16_t
 
æags
, 
Di¥©chHªdËr
 *
hªdËr
);

76 
lßd_¿nge
(
sockaddr_š
 &
addr
, 
TabËId’tif›rT
 &
bË
, 
RªgeT
 &
¿nge
, 
ušt64_t
 
soá_lim™
, 
ušt16_t
 
æags
);

89 
upd©e
(
sockaddr_š
 &
addr
, 
TabËId’tif›rT
 &
bË
, 
ušt8_t
 *
d©a
, 
size_t
 
Ën
, 
Di¥©chHªdËr
 *
hªdËr
);

101 
upd©e
(
sockaddr_š
 &
addr
, 
TabËId’tif›rT
 &
bË
, 
ušt8_t
 *
d©a
, 
size_t
 
Ën
);

112 
ü—‹_sÿÂ”
(
sockaddr_š
 &
addr
, 
TabËId’tif›rT
 &
bË
, 
RªgeT
 &
¿nge
, 
SÿnS³cifiÿtiÚT
 &
sÿn_¥ec
, 
Di¥©chHªdËr
 *
hªdËr
);

123 
ü—‹_sÿÂ”
(
sockaddr_š
 &
addr
, 
TabËId’tif›rT
 &
bË
, 
RªgeT
 &
¿nge
, 
SÿnS³cifiÿtiÚT
 &
sÿn_¥ec
, 
SÿnBlock
 &
sÿn_block
);

132 
de¡roy_sÿÂ”
(
sockaddr_š
 &
addr
, 
sÿÂ”_id
, 
Di¥©chHªdËr
 *
hªdËr
);

140 
de¡roy_sÿÂ”
(
sockaddr_š
 &
addr
, 
sÿÂ”_id
);

149 
ãtch_sÿnblock
(
sockaddr_š
 &
addr
, 
sÿÂ”_id
, 
Di¥©chHªdËr
 *
hªdËr
);

158 
ãtch_sÿnblock
(
sockaddr_š
 &
addr
, 
sÿÂ”_id
, 
SÿnBlock
 &
sÿn_block
);

167 
drİ_bË
(
sockaddr_š
 &
addr
, 
¡d
::
¡ršg
 
bË_Çme
, 
Di¥©chHªdËr
 *
hªdËr
);

175 
drİ_bË
(
sockaddr_š
 &
addr
, 
¡d
::
¡ršg
 
bË_Çme
);

182 
¡©us
(
sockaddr_š
 &
addr
);

190 
shutdown
(
sockaddr_š
 &
addr
);

192 
dump_¡©s
(
sockaddr_š
 &
addr
);

194 
	g´iv©e
:

196 
£nd_mes§ge
(
sockaddr_š
 &
addr
, 
CommBufPŒ
 &
cbufPŒ
, 
Di¥©chHªdËr
 *
hªdËr
);

198 
Comm
 *
	gm_comm
;

199 
time_t
 
	gm_timeout
;

202 
	gboo¡
::
	tšŒusive_±r
<
	tRªgeS”v”Cl›Á
> 
	tRªgeS”v”Cl›ÁPŒ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/RangeServerProtocol.cc

21 
	~"AsyncComm/CommBuf.h
"

22 
	~"AsyncComm/H—d”Bud”.h
"

24 
	~"RªgeS”v”PrÙocŞ.h
"

26 
Çme¥aû
 
	gHy³¹abË
 {

28 cÚ¡ *
	gRªgeS”v”PrÙocŞ
::
m_commªd_¡ršgs
[] = {

41 cÚ¡ *
	gRªgeS”v”PrÙocŞ
::
commªd_‹xt
(
commªd
) {

42 ià(
commªd
 < 0 || commªd >ğ
COMMAND_MAX
)

44  
	gm_commªd_¡ršgs
[
commªd
];

47 
CommBuf
 *
	gRªgeS”v”PrÙocŞ
::
ü—‹_»que¡_lßd_¿nge
(
TabËId’tif›rT
 &
bË
, 
RªgeT
 &
¿nge
, 
ušt64_t
 
soá_lim™
, 
ušt16_t
 
æags
) {

48 
H—d”Bud”
 
hbud”
(
H—d”
::
PROTOCOL_HYPERTABLE_RANGESERVER
);

49 
CommBuf
 *
	gcbuf
 = 
Ãw
 CommBuf(
hbud”
, 2 + 
EncodedL’gthTabËId’tif›r
(
bË
è+ 
EncodedL’gthRªge
(
¿nge
) + 10);

50 
	gcbuf
->
­³nd_shÜt
(
COMMAND_LOAD_RANGE
);

51 
EncodeTabËId’tif›r
(
cbuf
->
g‘_d©a_±r_add»ss
(), 
bË
);

52 
EncodeRªge
(
cbuf
->
g‘_d©a_±r_add»ss
(), 
¿nge
);

53 
	gcbuf
->
­³nd_lÚg
(
soá_lim™
);

54 
	gcbuf
->
­³nd_shÜt
(
æags
);

55  
	gcbuf
;

58 
CommBuf
 *
	gRªgeS”v”PrÙocŞ
::
ü—‹_»que¡_upd©e
(
TabËId’tif›rT
 &
bË
, 
ušt8_t
 *
d©a
, 
size_t
 
Ën
) {

59 
H—d”Bud”
 
hbud”
(
H—d”
::
PROTOCOL_HYPERTABLE_RANGESERVER
);

60 
CommBuf
 *
	gcbuf
 = 
Ãw
 CommBuf(
hbud”
, 2 + 
EncodedL’gthTabËId’tif›r
(
bË
), 
d©a
, 
Ën
);

61 
	gcbuf
->
­³nd_shÜt
(
COMMAND_UPDATE
);

62 
EncodeTabËId’tif›r
(
cbuf
->
g‘_d©a_±r_add»ss
(), 
bË
);

63  
	gcbuf
;

66 
CommBuf
 *
	gRªgeS”v”PrÙocŞ
::
ü—‹_»que¡_ü—‹_sÿÂ”
(
TabËId’tif›rT
 &
bË
, 
RªgeT
 &
¿nge
, 
SÿnS³cifiÿtiÚT
 &
sÿn_¥ec
) {

67 
H—d”Bud”
 
hbud”
(
H—d”
::
PROTOCOL_HYPERTABLE_RANGESERVER
);

68 
CommBuf
 *
	gcbuf
 = 
Ãw
 CommBuf(
hbud”
, 2 + 
EncodedL’gthTabËId’tif›r
(
bË
è+ 
EncodedL’gthRªge
(
¿nge
è+ 
EncodedL’gthSÿnS³cifiÿtiÚ
(
sÿn_¥ec
));

69 
	gcbuf
->
­³nd_shÜt
(
COMMAND_CREATE_SCANNER
);

70 
EncodeTabËId’tif›r
(
cbuf
->
g‘_d©a_±r_add»ss
(), 
bË
);

71 
EncodeRªge
(
cbuf
->
g‘_d©a_±r_add»ss
(), 
¿nge
);

72 
EncodeSÿnS³cifiÿtiÚ
(
cbuf
->
g‘_d©a_±r_add»ss
(), 
sÿn_¥ec
);

73  
	gcbuf
;

76 
CommBuf
 *
	gRªgeS”v”PrÙocŞ
::
ü—‹_»que¡_de¡roy_sÿÂ”
(
sÿÂ”_id
) {

77 
H—d”Bud”
 
hbud”
(
H—d”
::
PROTOCOL_HYPERTABLE_RANGESERVER
, 
sÿÂ”_id
);

78 
CommBuf
 *
	gcbuf
 = 
Ãw
 CommBuf(
hbud”
, 6);

79 
	gcbuf
->
­³nd_shÜt
(
COMMAND_DESTROY_SCANNER
);

80 
	gcbuf
->
­³nd_št
(
sÿÂ”_id
);

81  
	gcbuf
;

84 
CommBuf
 *
	gRªgeS”v”PrÙocŞ
::
ü—‹_»que¡_ãtch_sÿnblock
(
sÿÂ”_id
) {

85 
H—d”Bud”
 
hbud”
(
H—d”
::
PROTOCOL_HYPERTABLE_RANGESERVER
, 
sÿÂ”_id
);

86 
CommBuf
 *
	gcbuf
 = 
Ãw
 CommBuf(
hbud”
, 6);

87 
	gcbuf
->
­³nd_shÜt
(
COMMAND_FETCH_SCANBLOCK
);

88 
	gcbuf
->
­³nd_št
(
sÿÂ”_id
);

89  
	gcbuf
;

92 
CommBuf
 *
	gRªgeS”v”PrÙocŞ
::
ü—‹_»que¡_drİ_bË
(
¡d
::
¡ršg
 &
bË_Çme
) {

93 
H—d”Bud”
 
hbud”
(
H—d”
::
PROTOCOL_HYPERTABLE_RANGESERVER
);

94 
CommBuf
 *
	gcbuf
 = 
Ãw
 CommBuf(
hbud”
, 2 + 
S”Ÿliz©iÚ
::
’coded_Ëngth_¡ršg
(
bË_Çme
));

95 
	gcbuf
->
­³nd_shÜt
(
COMMAND_DROP_TABLE
);

96 
	gcbuf
->
­³nd_¡ršg
(
bË_Çme
);

97  
	gcbuf
;

100 
CommBuf
 *
	gRªgeS”v”PrÙocŞ
::
ü—‹_»que¡_¡©us
() {

101 
H—d”Bud”
 
hbud”
(
H—d”
::
PROTOCOL_HYPERTABLE_RANGESERVER
);

102 
CommBuf
 *
	gcbuf
 = 
Ãw
 CommBuf(
hbud”
, 2);

103 
	gcbuf
->
­³nd_shÜt
(
COMMAND_STATUS
);

104  
	gcbuf
;

107 
CommBuf
 *
	gRªgeS”v”PrÙocŞ
::
ü—‹_»que¡_shutdown
() {

108 
H—d”Bud”
 
hbud”
(
H—d”
::
PROTOCOL_HYPERTABLE_RANGESERVER
);

109 
CommBuf
 *
	gcbuf
 = 
Ãw
 CommBuf(
hbud”
, 2);

110 
	gcbuf
->
­³nd_shÜt
(
COMMAND_SHUTDOWN
);

111  
	gcbuf
;

114 
CommBuf
 *
	gRªgeS”v”PrÙocŞ
::
ü—‹_»que¡_dump_¡©s
() {

115 
H—d”Bud”
 
hbud”
(
H—d”
::
PROTOCOL_HYPERTABLE_RANGESERVER
);

116 
CommBuf
 *
	gcbuf
 = 
Ãw
 CommBuf(
hbud”
, 2);

117 
	gcbuf
->
­³nd_shÜt
(
COMMAND_DUMP_STATS
);

118  
	gcbuf
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/RangeServerProtocol.h

20 #iâdeà
HYPERTABLE_RANGESERVERPROTOCOL_H


21 
	#HYPERTABLE_RANGESERVERPROTOCOL_H


	)

23 
	~"AsyncComm/PrÙocŞ.h
"

25 
	~"Ty³s.h
"

27 
Çme¥aû
 
	gHy³¹abË
 {

30 şas 
	cRªgeS”v”PrÙocŞ
 : 
public
 
PrÙocŞ
 {

32 
public
:

33 cÚ¡ 
COMMAND_LOAD_RANGE
 = 0;

34 cÚ¡ 
	gCOMMAND_UPDATE
 = 1;

35 cÚ¡ 
	gCOMMAND_CREATE_SCANNER
 = 2;

36 cÚ¡ 
	gCOMMAND_FETCH_SCANBLOCK
 = 3;

37 cÚ¡ 
	gCOMMAND_COMPACT
 = 4;

38 cÚ¡ 
	gCOMMAND_STATUS
 = 5;

39 cÚ¡ 
	gCOMMAND_SHUTDOWN
 = 6;

40 cÚ¡ 
	gCOMMAND_DUMP_STATS
 = 7;

41 cÚ¡ 
	gCOMMAND_DESTROY_SCANNER
 = 8;

42 cÚ¡ 
	gCOMMAND_DROP_TABLE
 = 9;

43 cÚ¡ 
	gCOMMAND_MAX
 = 10;

45 cÚ¡ 
ušt16_t
 
	gLOAD_RANGE_FLAG_PHANTOM
 = 0x0001;

47 cÚ¡ *
	gm_commªd_¡ršgs
[];

57 
CommBuf
 *
ü—‹_»que¡_lßd_¿nge
(
TabËId’tif›rT
 &
bË
, 
RªgeT
 &
¿nge
, 
ušt64_t
 
soá_lim™
, 
ušt16_t
 
æags
);

69 
CommBuf
 *
ü—‹_»que¡_upd©e
(
TabËId’tif›rT
 &
bË
, 
ušt8_t
 *
d©a
, 
size_t
 
Ën
);

78 
CommBuf
 *
ü—‹_»que¡_ü—‹_sÿÂ”
(
TabËId’tif›rT
 &
bË
, 
RªgeT
 &
¿nge
, 
SÿnS³cifiÿtiÚT
 &
sÿn_¥ec
);

85 
CommBuf
 *
ü—‹_»que¡_de¡roy_sÿÂ”
(
sÿÂ”_id
);

92 
CommBuf
 *
ü—‹_»que¡_ãtch_sÿnblock
(
sÿÂ”_id
);

98 
CommBuf
 *
ü—‹_»que¡_¡©us
();

104 
CommBuf
 *
ü—‹_»que¡_shutdown
();

110 
CommBuf
 *
ü—‹_»que¡_dump_¡©s
();

117 
CommBuf
 *
ü—‹_»que¡_drİ_bË
(
¡d
::
¡ršg
 &
bË_Çme
);

119 
vœtu®
 cÚ¡ *
commªd_‹xt
(
commªd
);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/RootFileHandler.cc

21 
	~"RªgeLoÿtÜ.h
"

22 
	~"RoÙFeHªdËr.h
"

24 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

29 
	gRoÙFeHªdËr
::
©Œ_£t
(
¡d
::
¡ršg
 
Çme
) {

30 ià(
Çme
 == "server")

31 
m_¿nge_loÿtÜ
->
£t_roÙ_¡®e
();

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/RootFileHandler.h

21 #iâdeà
HYPERTABLE_ROOTFILEHANDLER_H


22 
	#HYPERTABLE_ROOTFILEHANDLER_H


	)

24 
	~"Hy³r¥aû/HªdËC®lback.h
"

26 
usšg
 
Çme¥aû
 
	gHy³r¥aû
;

28 
Çme¥aû
 
	gHy³¹abË
 {

30 
şass
 
	gRªgeLoÿtÜ
;

35 şas 
	cRoÙFeHªdËr
 : 
public
 
HªdËC®lback
 {

36 
public
:

37 
RoÙFeHªdËr
(
RªgeLoÿtÜ
 *
¿ngeLoÿtÜ
è: 
HªdËC®lback
(
EVENT_MASK_ATTR_SET
), 
m_¿nge_loÿtÜ
(rangeLocator) { ; }

38 
vœtu®
 
©Œ_£t
(
¡d
::
¡ršg
 
Çme
);

39 
RªgeLoÿtÜ
 *
	gm_¿nge_loÿtÜ
;

40 
RoÙFeHªdËr
 *
	gm_roÙ_hªdËr
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/ScanBlock.cc

21 
	~"CommÚ/E¼Ü.h
"

23 
	~"AsyncComm/PrÙocŞ.h
"

24 
	~"AsyncComm/S”Ÿliz©iÚ.h
"

26 
	~"SÿnBlock.h
"

28 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

34 
	gSÿnBlock
::
	$SÿnBlock
(è: 
	`m_æags
(0), 
	`m_sÿÂ”_id
(-1) {

35 
m_™”
 = 
m_vec
.
	`’d
();

36 
	}
}

42 
	gSÿnBlock
::
	$lßd
(
Ev’tPŒ
 &
ev’tPŒ
) {

43 
ušt8_t
 *
msgPŒ
 = 
ev’tPŒ
->
mes§ge
 + 4;

44 
ušt8_t
 *
’dPŒ
;

45 
size_t
 
»maššg
 = 
ev’tPŒ
->
mes§geL’
 - 4;

46 
ušt32_t
 
Ën
;

47 
By‹SŒšg32T
 *
key
, *
v®ue
;

49 
m_ev’t_±r
 = 
ev’tPŒ
;

51 
m_vec
.
	`ş—r
();

52 
m_™”
 = 
m_vec
.
	`’d
();

54 ià((
m_”rÜ
 = ()
PrÙocŞ
::
	`»¥Ú£_code
(
ev’tPŒ
)è!ğ
E¼Ü
::
OK
)

55  
m_”rÜ
;

57 ià(!(
S”Ÿliz©iÚ
::
	`decode_shÜt
(&
msgPŒ
, &
»maššg
, &
m_æags
))) {

58 
m_”rÜ
 = 
E¼Ü
::
RESPONSE_TRUNCATED
;

59  
m_”rÜ
;

62 ià(!(
S”Ÿliz©iÚ
::
	`decode_št
(&
msgPŒ
, &
»maššg
, (
ušt32_t
 *)&
m_sÿÂ”_id
))) {

63 
m_”rÜ
 = 
E¼Ü
::
RESPONSE_TRUNCATED
;

64  
m_”rÜ
;

67 ià(!(
S”Ÿliz©iÚ
::
	`decode_št
(&
msgPŒ
, &
»maššg
, &
Ën
))) {

68 
m_”rÜ
 = 
E¼Ü
::
RESPONSE_TRUNCATED
;

69  
m_”rÜ
;

72 
’dPŒ
 = 
msgPŒ
 + 
Ën
;

74 
msgPŒ
 < 
’dPŒ
) {

75 
key
 = (
By‹SŒšg32T
 *)
msgPŒ
;

76 
msgPŒ
 +ğ4 + 
key
->
Ën
;

77 
v®ue
 = (
By‹SŒšg32T
 *)
msgPŒ
;

78 
msgPŒ
 +ğ4 + 
v®ue
->
Ën
;

79 
m_vec
.
	`push_back
(
¡d
::
	`make_·œ
(
key
, 
v®ue
));

82 
m_™”
 = 
m_vec
.
	`begš
();

84  
m_”rÜ
;

85 
	}
}

88 
boŞ
 
	gSÿnBlock
::
	$Ãxt
(cÚ¡ 
By‹SŒšg32T
 *&
key
, cÚ¡ By‹SŒšg32T *&
v®ue
) {

90 
	`as£¹
(
m_”rÜ
 =ğ
E¼Ü
::
OK
);

92 ià(
m_™”
 =ğ
m_vec
.
	`’d
())

93  
çl£
;

95 
key
 = (*
m_™”
).
fœ¡
;

96 
v®ue
 = (*
m_™”
).
£cÚd
;

98 
m_™”
++;

100  
Œue
;

101 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/ScanBlock.h

21 #iâdeà
HYPERTABLE_SCANBLOCK_H


22 
	#HYPERTABLE_SCANBLOCK_H


	)

24 
	~<veùÜ
>

26 
	~"AsyncComm/Ev’t.h
"

27 
	~"CommÚ/By‹SŒšg.h
"

29 
Çme¥aû
 
	gHy³¹abË
 {

36 şas 
	cSÿnBlock
 {

37 
	gpublic
:

39 
¡d
::
	tveùÜ
< 
	t¡d
::
	t·œ
<cÚ¡ 
	tBy‹SŒšg32T
 *, cÚ¡ By‹SŒšg32T *> > 
	tVeùÜT
;

41 
SÿnBlock
();

49 
lßd
(
Ev’tPŒ
 &
ev’tPŒ
);

55 
size_t
 
size
(è{  
	gm_vec
.size(); }

58 
»£t
(è{ 
	gm_™”
 = 
m_vec
.
begš
(); }

67 
boŞ
 
Ãxt
(cÚ¡ 
By‹SŒšg32T
 *&
key
, cÚ¡ By‹SŒšg32T *&
v®ue
);

73 
boŞ
 
eos
(è{  ((
	gm_æags
 & 0x0001) == 0x0001); }

79 
boŞ
 
mÜe
() {

80 ià(
	gm_™”
 =ğ
m_vec
.
’d
())

81  
çl£
;

82  
	gŒue
;

89 
g‘_sÿÂ”_id
(è{  
	gm_sÿÂ”_id
; }

91 
	g´iv©e
:

92 
m_”rÜ
;

93 
ušt16_t
 
	gm_æags
;

94 
	gm_sÿÂ”_id
;

95 
VeùÜT
 
	gm_vec
;

96 
	gVeùÜT
::
™”©Ü
 
m_™”
;

97 
Ev’tPŒ
 
	gm_ev’t_±r
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/Schema.cc

21 
	~<cùy³
>

22 
	~<io¡»am
>

23 
	~<¡ršg
>

25 
	~<boo¡/®gÜ™hm/¡ršg.hµ
>

27 
	~<ex·t.h
>

30 
	~<ùy³.h
>

31 
	~<”ºo.h
>

32 
	~<¡dlib.h
>

33 
	~<¡ršg.h
>

34 
	~<¡ršgs.h
>

35 
	~<sys/ty³s.h
>

36 
	~<sys/¡©.h
>

39 
	~"CommÚ/FeUts.h
"

40 
	~"CommÚ/Logg”.h
"

41 
	~"CommÚ/SŒšgExt.h
"

42 
	~"CommÚ/Sy¡em.h
"

44 
	~"Schema.h
"

46 
usšg
 
Çme¥aû
 
Hy³¹abË
;

47 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

48 
usšg
 
Çme¥aû
 
	g¡d
;

50 
Schema
 *
	gSchema
::
ms_schema
 = 0;

51 
	g¡d
::
¡ršg
 
Schema
::
ms_cŞËùed_‹xt
 = "";

52 
	gboo¡
::
mu‹x
 
Schema
::
ms_mu‹x
;

57 
	gSchema
::
	$Schema
(
boŞ
 
»adIds
è: 
	`m_”rÜ_¡ršg
(), 
	`m_Ãxt_cŞumn_id
(0), 
	`m_acûss_group_m­
(), 
	`m_cŞumn_çmy_m­
(), 
	`m_g’”©iÚ
(1), 
	`m_acûss_groups
(), 
	`m_İ’_acûss_group
(0), 
	`m_İ’_cŞumn_çmy
(0), 
	`m_»ad_ids
Ô—dIds), 
	`m_ouut_ids
(
çl£
), 
	$m_max_cŞumn_çmy_id
(0) {

58 ià(
Logg”
::
logg”
 == 0) {

59 
û¼
 << "Logg”::š™Ÿlizmu¡ bÿÎed befÜusšg Schem¨şass" << 
’dl
;

60 
	`ex™
(1);

62 
	}
}

65 
	gSchema
::~
	$Schema
() {

66 
li¡
<
AcûssGroup
 *>::
cÚ¡_™”©Ü
 
ag™”
 = 
m_acûss_groups
.
	`begš
();‡g™” !ğm_acûss_groups.
	`’d
();‡giter++)

67 
d–‘e
 *
ag™”
;

68 
CŞumnFamyM­T
::
cÚ¡_™”©Ü
 
™”
 = 
m_cŞumn_çmy_m­
.
	`begš
(); i‹¸!ğm_cŞumn_çmy_m­.
	`’d
(); iter++)

69 
	`d–‘e
 (*
™”
).
£cÚd
;

70 
	}
}

73 
Schema
 *
	gSchema
::
	$Ãw_š¡ªû
(cÚ¡ *
buf
, 
Ën
, 
boŞ
 
»adIds
) {

74 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
ms_mu‹x
);

75 
XML_P¬£r
 
·r£r
 = 
	`XML_P¬£rC»©e
("US-ASCII");

77 
	`XML_S‘EËm’tHªdËr
(
·r£r
, &
¡¬t_–em’t_hªdËr
, &
’d_–em’t_hªdËr
);

78 
	`XML_S‘Ch¬aù”D©aHªdËr
(
·r£r
, &
ch¬aù”_d©a_hªdËr
);

80 
ms_schema
 = 
Ãw
 
	`Schema
(
»adIds
);

82 ià(
	`XML_P¬£
(
·r£r
, 
buf
, 
Ën
, 1) == 0) {

83 
¡d
::
¡ršg
 
”rSŒ
 = (¡d::¡ršg)"Schem¨P¬£ E¼Ü: " + (cÚ¡ *)
	`XML_E¼ÜSŒšg
(
	`XML_G‘E¼ÜCode
(
·r£r
)è+ "†š" + ()
	`XML_G‘Cu¼’tLšeNumb”
Õ¬£rè+ ", off£ˆ" + ()
	`XML_G‘Cu¼’tBy‹Index
(parser);

84 
ms_schema
->
	`£t_”rÜ_¡ršg
(
”rSŒ
);

87 
	`XML_P¬£rF»e
(
·r£r
);

89 
Schema
 *
schema
 = 
ms_schema
;

90 
ms_schema
 = 0;

91  
schema
;

92 
	}
}

97 
	gSchema
::
	$¡¬t_–em’t_hªdËr
(*
u£rD©a
,

98 cÚ¡ 
XML_Ch¬
 *
Çme
,

99 cÚ¡ 
XML_Ch¬
 **
©ts
) {

100 
i
;

102 ià(!
	`¡rÿ£cmp
(
Çme
, "Schema")) {

103 
i
=0; 
©ts
[i] != 0; i+=2) {

104 ià(
©ts
[
i
+1] == 0)

106 ià(
ms_schema
->
m_»ad_ids
 && !
	`¡rÿ£cmp
(
©ts
[
i
], "generation"))

107 
ms_schema
->
	`£t_g’”©iÚ
(
©ts
[
i
+1]);

108 ià(!
	`¡rÿ£cmp
(
©ts
[
i
], "compressor"))

109 
ms_schema
->
	`£t_com´essÜ
((
¡d
::
¡ršg
)
©ts
[
i
+1]);

111 
ms_schema
->
	`£t_”rÜ_¡ršg
((
¡ršg
)"UÄecognized 'Schema'‡‰ribu‹ : " + 
©ts
[
i
]);

114 ià(!
	`¡rÿ£cmp
(
Çme
, "AccessGroup")) {

115 
ms_schema
->
	`İ’_acûss_group
();

116 
i
=0; 
©ts
[i] != 0; i+=2) {

117 ià(
©ts
[
i
+1] == 0)

119 
ms_schema
->
	`£t_acûss_group_·¿m‘”
(
©ts
[
i
],‡tts[i+1]);

122 ià(!
	`¡rÿ£cmp
(
Çme
, "ColumnFamily")) {

123 
ms_schema
->
	`İ’_cŞumn_çmy
();

124 
i
=0; 
©ts
[i] != 0; i+=2) {

125 ià(
©ts
[
i
+1] == 0)

127 
ms_schema
->
	`£t_cŞumn_çmy_·¿m‘”
(
©ts
[
i
],‡tts[i+1]);

130 ià(!
	`¡rÿ£cmp
(
Çme
, "MaxVersions") || !strcasecmp(name, "ttl") || !strcasecmp(name, "Name"))

131 
ms_cŞËùed_‹xt
 = "";

133 
ms_schema
->
	`£t_”rÜ_¡ršg
((
¡ršg
)"UÄecognizedƒËm’ˆ- '" + 
Çme
 + "'");

136 
	}
}

139 
	gSchema
::
	$’d_–em’t_hªdËr
(*
u£rD©a
, cÚ¡ 
XML_Ch¬
 *
Çme
) {

140 ià(!
	`¡rÿ£cmp
(
Çme
, "AccessGroup"))

141 
ms_schema
->
	`şo£_acûss_group
();

142 ià(!
	`¡rÿ£cmp
(
Çme
, "ColumnFamily"))

143 
ms_schema
->
	`şo£_cŞumn_çmy
();

144 ià(!
	`¡rÿ£cmp
(
Çme
, "MaxVersions") || !strcasecmp(name, "ttl") || !strcasecmp(name, "Name")) {

145 
boo¡
::
	`Œim
(
ms_cŞËùed_‹xt
);

146 
ms_schema
->
	`£t_cŞumn_çmy_·¿m‘”
(
Çme
, 
ms_cŞËùed_‹xt
.
	`c_¡r
());

148 
	}
}

152 
	gSchema
::
	$ch¬aù”_d©a_hªdËr
(*
u£rD©a
, cÚ¡ 
XML_Ch¬
 *
s
, 
Ën
) {

153 
ms_cŞËùed_‹xt
.
	`assign
(
s
, 
Ën
);

154 
	}
}

158 
	gSchema
::
	$İ’_acûss_group
() {

159 ià(
m_İ’_acûss_group
 != 0)

160 
	`£t_”rÜ_¡ršg
((
¡ršg
)"Nested AccessGroupƒlements‚ot‡llowed");

162 
m_İ’_acûss_group
 = 
Ãw
 
	`AcûssGroup
();

164 
	}
}

168 
	gSchema
::
	$şo£_acûss_group
() {

169 ià(
m_İ’_acûss_group
 == 0)

170 
	`£t_”rÜ_¡ršg
((
¡ršg
)"Unableo close†ocality group,‚ot open");

172 ià(
m_İ’_acûss_group
->
Çme
 == "")

173 
	`£t_”rÜ_¡ršg
((
¡ršg
)"Name‡ttribute„equired for‡ll AccessGroupƒlements");

175 ià(
m_acûss_group_m­
.
	`fšd
(
m_İ’_acûss_group
->
Çme
è!ğm_acûss_group_m­.
	`’d
())

176 
	`£t_”rÜ_¡ršg
((
¡ršg
)"MuÉly defšed†oÿl™y grou° '" + 
m_İ’_acûss_group
->
Çme
 + "'");

178 
m_acûss_group_m­
[
m_İ’_acûss_group
->
Çme
] = m_open_access_group;

179 
m_acûss_groups
.
	`push_back
(
m_İ’_acûss_group
);

182 
m_İ’_acûss_group
 = 0;

184 
	}
}

188 
	gSchema
::
	$İ’_cŞumn_çmy
() {

189 ià(
m_İ’_acûss_group
 == 0)

190 
	`£t_”rÜ_¡ršg
((
¡ršg
)"ColumnFamily defined outside of AccessGroup");

192 ià(
m_İ’_cŞumn_çmy
 != 0)

193 
	`£t_”rÜ_¡ršg
((
¡ršg
)"Nested ColumnFamilyƒlements‚ot‡llowed");

195 
m_İ’_cŞumn_çmy
 = 
Ãw
 
	`CŞumnFamy
();

196 
m_İ’_cŞumn_çmy
->
id
 = 0;

197 
m_İ’_cŞumn_çmy
->
max_v”siÚs
 = 0;

198 
m_İ’_cŞumn_çmy
->
‰l
 = 0;

199 
m_İ’_cŞumn_çmy
->
ag
 = 
m_İ’_acûss_group
->
Çme
;

202 
	}
}

206 
	gSchema
::
	$şo£_cŞumn_çmy
() {

207 ià(
m_İ’_acûss_group
 == 0)

208 
	`£t_”rÜ_¡ršg
((
¡ršg
)"ColumnFamily defined outside of AccessGroup");

209 ià(
m_İ’_cŞumn_çmy
 == 0)

210 
	`£t_”rÜ_¡ršg
((
¡ršg
)"Unableo close column family,‚ot open");

212 ià(
m_İ’_cŞumn_çmy
->
Çme
 == "")

213 
	`£t_”rÜ_¡ršg
((
¡ršg
)"ColumnFamily must have Name childƒlement");

214 ià(
m_»ad_ids
 && 
m_İ’_cŞumn_çmy
->
id
 == 0) {

215 
	`£t_”rÜ_¡ršg
((
¡ršg
)"NØid s³cifid fÜ CŞumnFamy '" + 
m_İ’_cŞumn_çmy
->
Çme
 + "'");

218 ià(
m_cŞumn_çmy_m­
.
	`fšd
(
m_İ’_cŞumn_çmy
->
Çme
è!ğm_cŞumn_çmy_m­.
	`’d
())

219 
	`£t_”rÜ_¡ršg
((
¡ršg
)"MuÉly defšed cŞumÀçm› '" + 
m_İ’_cŞumn_çmy
->
Çme
 + "'");

221 
m_cŞumn_çmy_m­
[
m_İ’_cŞumn_çmy
->
Çme
] = m_open_column_family;

222 ià(
m_»ad_ids
)

223 
m_cŞumn_çmy_id_m­
[
m_İ’_cŞumn_çmy
->
id
] = m_open_column_family;

224 
m_İ’_acûss_group
->
cŞumns
.
	`push_back
(
m_İ’_cŞumn_çmy
);

226 
m_İ’_cŞumn_çmy
 = 0;

229 
	}
}

233 
	gSchema
::
	$£t_acûss_group_·¿m‘”
(cÚ¡ *
·¿m
, cÚ¡ *
v®ue
) {

234 ià(
m_İ’_acûss_group
 == 0)

235 
	`£t_”rÜ_¡ršg
((
¡ršg
)"UÇbËØ£ˆAcûssGrou°©Œibu‹ '" + 
·¿m
 + "',†ocality group‚ot open");

237 ià(!
	`¡rÿ£cmp
(
·¿m
, "name"))

238 
m_İ’_acûss_group
->
Çme
 = 
v®ue
;

239 ià(!
	`¡rÿ£cmp
(
·¿m
, "inMemory")) {

240 ià(!
	`¡rÿ£cmp
(
v®ue
, "Œue"è|| !
	`¡rcmp
(value, "1"))

241 
m_İ’_acûss_group
->
š_memÜy
 = 
Œue
;

242 ià(!
	`¡rÿ£cmp
(
v®ue
, "çl£"è|| !
	`¡rcmp
(value, "0"))

243 
m_İ’_acûss_group
->
š_memÜy
 = 
çl£
;

245 
	`£t_”rÜ_¡ršg
((
¡ršg
)"Inv®id v®u(" + 
v®ue
 + "èfÜ AcûssGrou°©Œibu‹ '" + 
·¿m
 + "'");

247 ià(!
	`¡rÿ£cmp
(
·¿m
, "blockSize")) {

248 
blocksize
 = 
	`¡¹Şl
(
v®ue
, 0, 10);

249 ià(
blocksize
 == 0 || blocksize >= 4294967296LL)

250 
	`£t_”rÜ_¡ršg
((
¡ršg
)"Inv®id v®u(" + 
v®ue
 + "èfÜ AcûssGrou°©Œibu‹ '" + 
·¿m
 + "'");

252 
m_İ’_acûss_group
->
blocksize
 = (
ušt32_t
)blocksize;

254 ià(!
	`¡rÿ£cmp
(
·¿m
, "compressor")) {

255 
m_İ’_acûss_group
->
com´essÜ
 = 
v®ue
;

256 
boo¡
::
	`Œim
(
m_İ’_acûss_group
->
com´essÜ
);

259 
	`£t_”rÜ_¡ršg
((
¡ršg
)"Inv®id AcûssGrou°©Œibu‹ '" + 
·¿m
 + "'");

261 
	}
}

265 
	gSchema
::
	$£t_cŞumn_çmy_·¿m‘”
(cÚ¡ *
·¿m
, cÚ¡ *
v®ue
) {

266 ià(
m_İ’_cŞumn_çmy
 == 0)

267 
	`£t_”rÜ_¡ršg
((
¡ršg
)"UÇbËØ£ˆCŞumnFamy…¬am‘” '" + 
·¿m
 + "', column family‚ot open");

269 ià(!
	`¡rÿ£cmp
(
·¿m
, "Name"))

270 
m_İ’_cŞumn_çmy
->
Çme
 = 
v®ue
;

271 ià(!
	`¡rÿ£cmp
(
·¿m
, "ttl")) {

272 
£cs
 = 
	`¡¹Şl
(
v®ue
, 0, 10);

273 
m_İ’_cŞumn_çmy
->
‰l
 = (
time_t
)
£cs
;

275 ià(!
	`¡rÿ£cmp
(
·¿m
, "MaxVersions")) {

276 
m_İ’_cŞumn_çmy
->
max_v”siÚs
 = 
	`©oi
(
v®ue
);

277 ià(
m_İ’_cŞumn_çmy
->
max_v”siÚs
 == 0)

278 
	`£t_”rÜ_¡ršg
((
¡ršg
)"Inv®id v®u(" + 
v®ue
 + ") for MaxVersions");

280 ià(
m_»ad_ids
 && !
	`¡rÿ£cmp
(
·¿m
, "id")) {

281 
m_İ’_cŞumn_çmy
->
id
 = 
	`©oi
(
v®ue
);

282 ià(
m_İ’_cŞumn_çmy
->
id
 == 0)

283 
	`£t_”rÜ_¡ršg
((
¡ršg
)"Inv®id v®u(" + 
v®ue
 + ") for ColumnFamily id‡ttribute");

284 ià(
m_İ’_cŞumn_çmy
->
id
 > 
m_max_cŞumn_çmy_id
)

285 
m_max_cŞumn_çmy_id
 = 
m_İ’_cŞumn_çmy
->
id
;

288 
	`£t_”rÜ_¡ršg
((
¡ršg
)"Inv®id CŞumnFamy…¬am‘” '" + 
·¿m
 + "'");

290 
	}
}

293 
	gSchema
::
	$assign_ids
() {

294 
m_max_cŞumn_çmy_id
 = 0;

295 
li¡
<
AcûssGroup
 *>::
™”©Ü
 
agI‹r
 = 
m_acûss_groups
.
	`begš
();‡gI‹¸!ğm_acûss_groups.
	`’d
();‡gIter++) {

296 
li¡
<
CŞumnFamy
 *>::
™”©Ü
 
cfI‹r
 = (*
agI‹r
)->
cŞumns
.
	`begš
(); cfI‹¸!ğ(*agI‹r)->cŞumns.
	`’d
(); cfIter++) {

297 (*
cfI‹r
)->
id
 = ++
m_max_cŞumn_çmy_id
;

300 
m_g’”©iÚ
 = 1;

301 
m_ouut_ids
=
Œue
;

302 
	}
}

305 
	gSchema
::
»nd”
(
¡d
::
¡ršg
 &
ouut
) {

306 
buf
[64];

308 ià(!
is_v®id
()) {

309 
	gouut
 = 
m_”rÜ_¡ršg
;

313 
	gouut
 += "<Schema";

314 ià(
	gm_ouut_ids
)

315 
	gouut
 +ğ(
¡d
::
¡ršg
)" g’”©iÚ=\"" + (
ušt32_t
)
m_g’”©iÚ
 + "\"";

316 ià(
	gm_com´essÜ
 != "")

317 
ouut
 +ğ(
¡d
::
¡ršg
)" com´essÜ=\"" + 
m_com´essÜ
 + "\"";

318 
	gouut
 += ">\n";

320 
	gli¡
<
	gAcûssGroup
 *>::
™”©Ü
 
™”
 = 
m_acûss_groups
.
begš
(); 
	g™”
 !ğm_acûss_groups.
’d
(); iter++) {

321 
	gouut
 +ğ(
¡ršg
)" <AcûssGrou°Çme=\"" + (*
™”
)->
Çme
 + "\"";

322 ià((*
	g™”
)->
	gš_memÜy
)

323 
	gouut
 += " inMemory=\"true\"";

324 ià((*
	g™”
)->
	gblocksize
 > 0)

325 
	gouut
 +ğ(
¡d
::
¡ršg
)" blockSize=\"" + (*
™”
)->
blocksize
 + "\"";

326 ià((*
	g™”
)->
	gcom´essÜ
 != "")

327 
ouut
 +ğ(
¡d
::
¡ršg
)" com´essÜ=\"" + (*
™”
)->
com´essÜ
 + "\"";

328 
	gouut
 += ">\n";

329 
	gli¡
<
	gCŞumnFamy
 *>::
™”©Ü
 
cf™”
 = (*
™”
)->
cŞumns
.
begš
(); 
	gcf™”
 !ğ(*™”)->cŞumns.
’d
(); cfiter++) {

330 
	gouut
 +ğ(
¡ršg
)" <ColumnFamily";

331 ià(
	gm_ouut_ids
) {

332 
	gouut
 += " id=\"";

333 
¥rštf
(
buf
, "%d", (*
cf™”
)->
id
);

334 
	gouut
 +ğ(
¡ršg
)
buf
 + "\"";

336 
	gouut
 += ">\n";

337 
	gouut
 +ğ(
¡ršg
)" <Name>" + (*
cf™”
)->
Çme
 + "</Name>\n";

338 ià((*
	gcf™”
)->
	gmax_v”siÚs
 != 0)

339 
ouut
 +ğ(
¡ršg
)" <MaxV”siÚs>" + (*
cf™”
)->
max_v”siÚs
 + "</MaxVersions>\n";

340 ià((*
	gcf™”
)->
	g‰l
 != 0)

341 
ouut
 +ğ(
¡ršg
)" <‰l>" + (
ušt32_t
)(*
cf™”
)->
‰l
 + "</ttl>\n";

342 
	gouut
 +ğ(
¡ršg
)" </ColumnFamily>\n";

344 
	gouut
 +ğ(
¡ršg
)" </AccessGroup>\n";

347 
	gouut
 += "</Schema>\n";

351 
	gSchema
::
»nd”_hql_ü—‹_bË
(
¡d
::
¡ršg
 
bË_Çme
, std::¡ršg &
ouut
) {

352 
boŞ
 
Ãeds_quÙes
 = 
çl£
;

353 cÚ¡ *
	g±r
;

355 
	gouut
 += "\n";

356 
	gouut
 += "CREATE TABLE ";

357 ià(
	gm_com´essÜ
 != "")

358 
ouut
 +ğ(
¡d
::
¡ršg
)"COMPRESSOR=\"" + 
m_com´essÜ
 + "\" ";

359 
	gouut
 +ğ
bË_Çme
 + " (\n";

361 
	gCŞumnFamyM­T
::
cÚ¡_™”©Ü
 
cf_™”
 = 
m_cŞumn_çmy_m­
.
begš
(); 
	gcf_™”
 !ğm_cŞumn_çmy_m­.
’d
(); cf_iter++) {

364 
	gÃeds_quÙes
 = 
çl£
;

365 
	g±r
 = (*
cf_™”
).
fœ¡
.
c_¡r
();

366 ià(!
i§Íha
(*
±r
))

367 
	gÃeds_quÙes
 = 
Œue
;

369 ; *
	g±r
;…tr++) {

370 ià(!
i§Êum
(*
±r
)) {

371 
	gÃeds_quÙes
 = 
Œue
;

377 ià(
	gÃeds_quÙes
)

378 
	gouut
 +ğ(
¡d
::
¡ršg
)" '" + (*
cf_™”
).
fœ¡
 + "'";

380 
	gouut
 +ğ(
¡d
::
¡ršg
)" " + (*
cf_™”
).
fœ¡
;

381 ià((*
	gcf_™”
).
	g£cÚd
->
	gmax_v”siÚs
 != 0)

382 
ouut
 +ğ(
¡d
::
¡ršg
)" MAX_VERSIONS=" + (*
cf_™”
).
£cÚd
->
max_v”siÚs
;

383 ià((*
	gcf_™”
).
	g£cÚd
->
	g‰l
 != 0)

384 
ouut
 +ğ(
¡d
::
¡ršg
)" TTL=" + (
ušt32_t
)(*
cf_™”
).
£cÚd
->
‰l
;

385 
	gouut
 +ğ(
¡d
::
¡ršg
)",\n";

388 
size_t
 
	gi
=1;

389 
	gli¡
<
	gAcûssGroup
 *>::
™”©Ü
 
ag_™”
 = 
m_acûss_groups
.
begš
(); 
	gag_™”
 !ğm_acûss_groups.
’d
();‡g_™”++, 
	gi
++) {

390 
	gouut
 +ğ(
¡d
::
¡ršg
)" ACCESS GROUP ";

392 
	gÃeds_quÙes
 = 
çl£
;

393 
	g±r
 = (*
ag_™”
)->
Çme
.
c_¡r
();

394 ià(!
i§Íha
(*
±r
))

395 
	gÃeds_quÙes
 = 
Œue
;

397 ++
	g±r
; *ptr;…tr++) {

398 ià(!
i§Êum
(*
±r
)) {

399 
	gÃeds_quÙes
 = 
Œue
;

404 ià(
	gÃeds_quÙes
)

405 
	gouut
 +ğ(
¡d
::
¡ršg
)"'" + (*
ag_™”
)->
Çme
 + "'";

407 
	gouut
 +ğ(*
ag_™”
)->
Çme
;

409 ià((*
	gag_™”
)->
	gš_memÜy
)

410 
	gouut
 +ğ(
¡d
::
¡ršg
)" IN_MEMORY";

411 ià((*
	gag_™”
)->
	gblocksize
 != 0)

412 
ouut
 +ğ(
¡d
::
¡ršg
)" BLOCKSIZE=" + (*
ag_™”
)->
blocksize
;

413 ià((*
	gag_™”
)->
	gcom´essÜ
 != "")

414 
ouut
 +ğ(
¡d
::
¡ršg
)" COMPRESSOR=\"" + (*
ag_™”
)->
com´essÜ
 + "\"";

415 ià(!(*
	gag_™”
)->
	gcŞumns
.
em±y
()) {

416 
boŞ
 
	gdi¥Ïy_comma
 = 
çl£
;

417 
	gouut
 +ğ(
¡d
::
¡ršg
)" (";

418 
	gli¡
<
	gCŞumnFamy
 *>::
™”©Ü
 
cæ_™”
 = (*
ag_™”
)->
cŞumns
.
begš
(); 
	gcæ_™”
 !ğ(*ag_™”)->cŞumns.
’d
(); cfl_iter++) {

421 
	gÃeds_quÙes
 = 
çl£
;

422 
	g±r
 = (*
cæ_™”
)->
Çme
.
c_¡r
();

423 ià(!
i§Íha
(*
±r
))

424 
	gÃeds_quÙes
 = 
Œue
;

426 ++
	g±r
; *ptr;…tr++) {

427 ià(!
i§Êum
(*
±r
)) {

428 
	gÃeds_quÙes
 = 
Œue
;

434 ià(
	gdi¥Ïy_comma
)

435 
	gouut
 +ğ(
¡d
::
¡ršg
)",";

437 
	gdi¥Ïy_comma
 = 
Œue
;

439 ià(
	gÃeds_quÙes
)

440 
	gouut
 +ğ(
¡d
::
¡ršg
)" '" + (*
cæ_™”
)->
Çme
 + "'";

442 
	gouut
 +ğ(
¡d
::
¡ršg
)" " + (*
cæ_™”
)->
Çme
;

444 
	gouut
 +ğ(
¡d
::
¡ršg
)" )";

446 ià(
	gi
 =ğ
m_acûss_groups
.
size
())

447 
ouut
 +ğ(
¡d
::
¡ršg
)"\n";

449 
	gouut
 +ğ(
¡d
::
¡ršg
)",\n";

452 
	gouut
 += ")\n";

453 
	gouut
 += "\n";

462 
boŞ
 
	gSchema
::
	$is_v®id
() {

463 ià(
	`g‘_”rÜ_¡ršg
() != 0)

464  
çl£
;

465  
Œue
;

466 
	}
}

471 
	gSchema
::
	$£t_g’”©iÚ
(cÚ¡ *
g’”©iÚ
) {

472 
g’Num
 = 
	`©oi
(
g’”©iÚ
);

473 ià(
g’Num
 <= 0)

474 
	`£t_”rÜ_¡ršg
((
¡ršg
)"Inv®id TabË 'g’”©iÚ' v®u(" + 
g’”©iÚ
 + ")");

475 
m_g’”©iÚ
 = 
g’Num
;

476 
	}
}

479 
	gSchema
::
	$add_acûss_group
(
AcûssGroup
 *
ag
) {

480 
AcûssGroupM­T
::
cÚ¡_™”©Ü
 
™”
 = 
m_acûss_group_m­
.
	`fšd
(
ag
->
Çme
);

482 ià(
™”
 !ğ
m_acûss_group_m­
.
	`’d
()) {

483 
m_”rÜ_¡ršg
 = 
¡d
::
	`¡ršg
("Acûs grou°'"è+ 
ag
->
Çme
 + "' multiply defined";

484 
d–‘e
 
ag
;

488 
m_acûss_group_m­
[
ag
->
Çme
] =‡g;

489 
m_acûss_groups
.
	`push_back
(
ag
);

490 
	}
}

492 
	gSchema
::
	$add_cŞumn_çmy
(
CŞumnFamy
 *
cf
) {

493 
CŞumnFamyM­T
::
cÚ¡_™”©Ü
 
cf_™”
 = 
m_cŞumn_çmy_m­
.
	`fšd
(
cf
->
Çme
);

495 ià(
cf_™”
 !ğ
m_cŞumn_çmy_m­
.
	`’d
()) {

496 
m_”rÜ_¡ršg
 = 
¡d
::
	`¡ršg
("CŞumÀçmy '"è+ 
cf
->
Çme
 + "' multiply defined";

497 
d–‘e
 
cf
;

501 
AcûssGroupM­T
::
cÚ¡_™”©Ü
 
ag_™”
 = 
m_acûss_group_m­
.
	`fšd
(
cf
->
ag
);

503 ià(
ag_™”
 =ğ
m_acûss_group_m­
.
	`’d
()) {

504 
m_”rÜ_¡ršg
 = 
¡d
::
	`¡ršg
("Inv®id‡cûs grou°'"è+ 
cf
->
ag
 + "' fÜ cŞumÀçmy '" + cf->
Çme
 + "'";

505 
d–‘e
 
cf
;

509 
m_cŞumn_çmy_m­
[
cf
->
Çme
] = cf;

510 (*
ag_™”
).
£cÚd
->
cŞumns
.
	`push_back
(
cf
);

512 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/Schema.h

21 #iâdeà
HYPERTABLE_SCHEMA_H


22 
	#HYPERTABLE_SCHEMA_H


	)

24 
	~<li¡
>

26 
	~<¡ršg
>

28 
	~<boo¡/šŒusive_±r.hµ
>

29 
	~<boo¡/th»ad/mu‹x.hµ
>

31 
	~<ex·t.h
>

33 
	~"CommÚ/Prİ”t›s.h
"

34 
	~"CommÚ/Reã»nûCouÁ.h
"

36 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

37 
usšg
 
Çme¥aû
 
	g¡d
;

39 
Çme¥aû
 
	gHy³¹abË
 {

41 şas 
	cSchema
 : 
public
 
Reã»nûCouÁ
 {

42 
public
:

44 şas 
	cCŞumnFamy
 {

45 
public
:

46 
CŞumnFamy
(è: 
Çme
(), 
ag
(), 
id
(0), 
max_v”siÚs
(0), 
‰l
(0) { ; }

47 
¡ršg
 
	gÇme
;

48 
¡ršg
 
	gag
;

49 
ušt32_t
 
	gid
;

50 
ušt32_t
 
	gmax_v”siÚs
;

51 
time_t
 
	g‰l
;

54 şas 
	cAcûssGroup
 {

55 
	gpublic
:

56 
AcûssGroup
(è: 
Çme
(), 
š_memÜy
(
çl£
), 
blocksize
(0), 
cŞumns
() { ; }

57 
¡ršg
 
	gÇme
;

58 
boŞ
 
	gš_memÜy
;

59 
ušt32_t
 
	gblocksize
;

60 
	g¡d
::
¡ršg
 
com´essÜ
;

61 
	gli¡
<
	gCŞumnFamy
 *> 
	gcŞumns
;

64 
Schema
(
boŞ
 
»adIds
=
çl£
);

65 ~
Schema
();

67 
Schema
 *
Ãw_š¡ªû
(cÚ¡ *
buf
, 
Ën
, 
boŞ
 
»adIds
=
çl£
);

68 
ä›nd
 
Schema
 *
Ãw_š¡ªû
(cÚ¡ *
buf
, 
Ën
, 
boŞ
 
»adIds
=
çl£
);

70 
İ’_acûss_group
();

71 
şo£_acûss_group
();

72 
İ’_cŞumn_çmy
();

73 
şo£_cŞumn_çmy
();

74 
£t_acûss_group_·¿m‘”
(cÚ¡ *
·¿m
, cÚ¡ *
v®ue
);

75 
£t_cŞumn_çmy_·¿m‘”
(cÚ¡ *
·¿m
, cÚ¡ *
v®ue
);

77 
assign_ids
();

79 
»nd”
(
¡d
::
¡ršg
 &
ouut
);

81 
»nd”_hql_ü—‹_bË
(
¡d
::
¡ršg
 
bË_Çme
, std::¡ršg &
ouut
);

83 
boŞ
 
is_v®id
();

85 cÚ¡ *
g‘_”rÜ_¡ršg
() {

86  (
	gm_”rÜ_¡ršg
.
Ëngth
(è=ğ0è? 0 : 
m_”rÜ_¡ršg
.
c_¡r
();

89 
£t_”rÜ_¡ršg
(
¡d
::
¡ršg
 
”rSŒ
) {

90 ià(
m_”rÜ_¡ršg
.
Ëngth
() == 0)

91 
m_”rÜ_¡ršg
 = 
”rSŒ
;

94 
£t_g’”©iÚ
(cÚ¡ *
g’”©iÚ
);

95 
št32_t
 
g‘_g’”©iÚ
(è{  
	gm_g’”©iÚ
; }

97 
size_t
 
g‘_max_cŞumn_çmy_id
(è{  
	gm_max_cŞumn_çmy_id
; }

99 
	gli¡
<
	gAcûssGroup
 *> *
g‘_acûss_group_li¡
(è{  &
	gm_acûss_groups
; }

101 
CŞumnFamy
 *
g‘_cŞumn_çmy
(
¡ršg
 
Çme
è{  
	gm_cŞumn_çmy_m­
[name]; }

103 
CŞumnFamy
 *
g‘_cŞumn_çmy
(
ušt32_t
 
id
è{  
	gm_cŞumn_çmy_id_m­
[id]; }

105 
add_acûss_group
(
AcûssGroup
 *
ag
);

107 
add_cŞumn_çmy
(
CŞumnFamy
 *
cf
);

109 
£t_com´essÜ
(
¡d
::
¡ršg
 
com´essÜ
è{ 
m_com´essÜ
 = compressor; }

110 
	g¡d
::
¡ršg
 &
g‘_com´essÜ
(è{  
m_com´essÜ
; }

112 
	g__gnu_cxx
::
	thash_m­
<
	t¡ršg
, 
	tCŞumnFamy
 *> 
	tCŞumnFamyM­T
;

113 
	g__gnu_cxx
::
	thash_m­
<
	t¡ršg
, 
	tAcûssGroup
 *> 
	tAcûssGroupM­T
;

115 
	g´iv©e
:

117 
__gnu_cxx
::
	thash_m­
<
	tušt32_t
, 
	tCŞumnFamy
 *> 
	tCŞumnFamyIdM­T
;

119 
	g¡d
::
¡ršg
 
m_”rÜ_¡ršg
;

120 
	gm_Ãxt_cŞumn_id
;

121 
AcûssGroupM­T
 
	gm_acûss_group_m­
;

122 
CŞumnFamyM­T
 
	gm_cŞumn_çmy_m­
;

123 
CŞumnFamyIdM­T
 
	gm_cŞumn_çmy_id_m­
;

124 
št32_t
 
	gm_g’”©iÚ
;

125 
	gli¡
<
	gAcûssGroup
 *> 
	gm_acûss_groups
;

126 
AcûssGroup
 *
	gm_İ’_acûss_group
;

127 
CŞumnFamy
 *
	gm_İ’_cŞumn_çmy
;

128 
boŞ
 
	gm_»ad_ids
;

129 
boŞ
 
	gm_ouut_ids
;

130 
size_t
 
	gm_max_cŞumn_çmy_id
;

131 
	g¡d
::
¡ršg
 
m_com´essÜ
;

133 
¡¬t_–em’t_hªdËr
(*
u£rD©a
, cÚ¡ 
XML_Ch¬
 *
Çme
, cÚ¡ XML_Ch¬ **
©ts
);

134 
’d_–em’t_hªdËr
(*
u£rD©a
, cÚ¡ 
XML_Ch¬
 *
Çme
);

135 
ch¬aù”_d©a_hªdËr
(*
u£rD©a
, cÚ¡ 
XML_Ch¬
 *
s
, 
Ën
);

137 
Schema
 *
	gms_schema
;

138 
	g¡d
::
¡ršg
 
ms_cŞËùed_‹xt
;

139 
	gboo¡
::
mu‹x
 
ms_mu‹x
;

142 
	gboo¡
::
	tšŒusive_±r
<
	tSchema
> 
	tSchemaPŒ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/Table.cc

21 
	~<c¡ršg
>

23 
	~<boo¡/®gÜ™hm/¡ršg.hµ
>

25 
	~"CommÚ/DyÇmicBufãr.h
"

26 
	~"CommÚ/E¼Ü.h
"

27 
	~"CommÚ/Logg”.h
"

29 
	~"Hy³r¥aû/HªdËC®lback.h
"

30 
	~"Hy³r¥aû/SessiÚ.h
"

32 
	~"TabË.h
"

34 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

35 
usšg
 
Çme¥aû
 
	gHy³r¥aû
;

41 
	gTabË
::
TabË
(
Prİ”t›sPŒ
 &
´İs_±r
, 
CÚÃùiÚMªag”PŒ
 &
cÚn_mªag”_±r
, 
Hy³r¥aû
::
SessiÚPŒ
 &
hy³r¥aû_±r
, 
¡d
::
¡ršg
 
Çme
è: 
m_´İs_±r
Õrİs_±r), 
m_comm
(cÚn_mªag”_±r->
g‘_comm
()), 
m_cÚn_mªag”_±r
(cÚn_mªag”_±r), 
	$m_hy³r¥aû_±r
(
hy³r¥aû_±r
) {

43 #ià
	`defšed
(
__APPLE__
)

44 
boo¡
::
	`to_uµ”
(
Çme
);

47 
	`š™Ÿlize
(
Çme
);

48 
m_¿nge_loÿtÜ_±r
 = 
Ãw
 
	`RªgeLoÿtÜ
(
´İs_±r
, 
m_cÚn_mªag”_±r
, 
m_hy³r¥aû_±r
);

49 
	}
}

54 
	gTabË
::
TabË
(
Prİ”t›sPŒ
 &
´İs_±r
, 
Comm
 *
comm
, 
Hy³r¥aû
::
SessiÚPŒ
 &
hy³r¥aû_±r
, 
¡d
::
¡ršg
 
Çme
è: 
m_´İs_±r
Õrİs_±r), 
m_comm
(comm), 
m_cÚn_mªag”_±r
(0), 
	$m_hy³r¥aû_±r
(
hy³r¥aû_±r
) {

56 #ià
	`defšed
(
__APPLE__
)

57 
boo¡
::
	`to_uµ”
(
Çme
);

60 
	`š™Ÿlize
(
Çme
);

61 
m_¿nge_loÿtÜ_±r
 = 
Ãw
 
	`RªgeLoÿtÜ
(
´İs_±r
, 
m_comm
, 
m_hy³r¥aû_±r
);

62 
	}
}

65 
	gTabË
::
š™Ÿlize
(
¡d
::
¡ršg
 &
Çme
) {

66 
”rÜ
;

67 
	g¡d
::
¡ršg
 
bËFe
 = (
¡d
::¡ršg)"/hy³¹abË/bËs/" + 
Çme
;

68 
DyÇmicBufãr
 
v®ue_buf
(0);

69 
ušt64_t
 
	ghªdË
;

70 
HªdËC®lbackPŒ
 
	gnuÎHªdËC®lback
;

71 
	g¡d
::
¡ršg
 
”rMsg
;

76 
	gm_hy³r¥aû_±r
->
£t_s’t_æag
(
Œue
);

77 ià((
	g”rÜ
 = 
m_hy³r¥aû_±r
->
İ’
(
bËFe
, 
OPEN_FLAG_READ
, 
nuÎHªdËC®lback
, &
hªdË
)è!ğ
E¼Ü
::
OK
) {

78 
m_hy³r¥aû_±r
->
£t_s’t_æag
(
çl£
);

79 ià(
	g”rÜ
 =ğ
E¼Ü
::
HYPERSPACE_BAD_PATHNAME
)

80 
throw
 
Exû±iÚ
(
E¼Ü
::
TABLE_DOES_NOT_EXIST
);

81 
HT_ERRORF
("UÇbËØİ’ Hy³r¥aûabË f'%s' - %s", 
bËFe
.
c_¡r
(), 
E¼Ü
::
g‘_‹xt
(
”rÜ
));

82 
throw
 
Exû±iÚ
(
”rÜ
);

84 
	gm_hy³r¥aû_±r
->
£t_s’t_æag
(
çl£
);

87 *
	gbË_Çme
 = 
Ãw
 [ 
¡¾’
(
Çme
.
c_¡r
()) + 1 ];

88 
¡rıy
(
bË_Çme
, 
Çme
.
c_¡r
());

89 
	gm_bË
.
	gÇme
 = 
bË_Çme
;

95 
	gv®ue_buf
.
ş—r
();

96 ià((
	g”rÜ
 = 
m_hy³r¥aû_±r
->
©Œ_g‘
(
hªdË
, "bË_id", 
v®ue_buf
)è!ğ
E¼Ü
::
OK
) {

97 
HT_ERRORF
("ProbËm g‘tšg‡‰ribu‹ 'bË_id' fÜabË f'%s' - %s", 
bËFe
.
c_¡r
(), 
E¼Ü
::
g‘_‹xt
(
”rÜ
));

98 
throw
 
Exû±iÚ
(
”rÜ
);

101 
as£¹
(
v®ue_buf
.
fl
(è=ğ(
št32_t
));

104 
memıy
(&
m_bË
.
id
, 
v®ue_buf
.
buf
, (
št32_t
));

109 
	gv®ue_buf
.
ş—r
();

110 ià((
	g”rÜ
 = 
m_hy³r¥aû_±r
->
©Œ_g‘
(
hªdË
, "schema", 
v®ue_buf
)è!ğ
E¼Ü
::
OK
) {

111 
HT_ERRORF
("ProbËm g‘tšg‡‰ribu‹ 'schema' fÜabË f'%s' - %s", 
bËFe
.
c_¡r
(), 
E¼Ü
::
g‘_‹xt
(
”rÜ
));

112 
throw
 
Exû±iÚ
(
”rÜ
);

115 
	gm_hy³r¥aû_±r
->
şo£
(
hªdË
);

117 
	gm_schema_±r
 = 
Schema
::
Ãw_š¡ªû
((cÚ¡ *)
v®ue_buf
.
buf
, 
¡¾’
((cÚ¡ *)v®ue_buf.buf), 
Œue
);

119 ià(!
	gm_schema_±r
->
is_v®id
()) {

120 
HT_ERRORF
("Schem¨P¬£ E¼Ü: %s", 
m_schema_±r
->
g‘_”rÜ_¡ršg
());

121 
throw
 
Exû±iÚ
(
E¼Ü
::
BAD_SCHEMA
);

124 
	gm_bË
.
	gg’”©iÚ
 = 
m_schema_±r
->
g‘_g’”©iÚ
();

128 
	gTabË
::~
	$TabË
() {

129 
d–‘e
 [] 
m_bË
.
Çme
;

130 
	}
}

133 
	gTabË
::
	$ü—‹_mutÜ
(
TabËMutÜPŒ
 &
mutÜ_±r
) {

134 
mutÜ_±r
 = 
Ãw
 
	`TabËMutÜ
(
m_´İs_±r
, 
m_comm
, &
m_bË
, 
m_schema_±r
, 
m_¿nge_loÿtÜ_±r
);

135  
E¼Ü
::
OK
;

136 
	}
}

139 
	gTabË
::
	$ü—‹_sÿÂ”
(
SÿnS³cifiÿtiÚT
 &
sÿn_¥ec
, 
TabËSÿÂ”PŒ
 &
sÿÂ”_±r
) {

140 
sÿÂ”_±r
 = 
Ãw
 
	`TabËSÿÂ”
(
m_´İs_±r
, 
m_comm
, &
m_bË
, 
m_schema_±r
, 
m_¿nge_loÿtÜ_±r
, 
sÿn_¥ec
);

141  
E¼Ü
::
OK
;

142 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/Table.h

21 #iâdeà
HYPERTABLE_TABLE_H


22 
	#HYPERTABLE_TABLE_H


	)

24 
	~"CommÚ/Prİ”t›s.h
"

25 
	~"CommÚ/Reã»nûCouÁ.h
"

27 
	~"TabËMutÜ.h
"

28 
	~"Schema.h
"

29 
	~"RªgeLoÿtÜ.h
"

30 
	~"TabËSÿÂ”.h
"

31 
	~"Ty³s.h
"

33 
Çme¥aû
 
	gHy³r¥aû
 {

34 
şass
 
	gSessiÚ
;

37 
Çme¥aû
 
	gHy³¹abË
 {

39 
şass
 
	gCÚÃùiÚMªag”
;

43 şas 
	cTabË
 : 
public
 
Reã»nûCouÁ
 {

45 
public
:

46 
TabË
(
Prİ”t›sPŒ
 &
´İs_±r
, 
CÚÃùiÚMªag”PŒ
 &
cÚn_mªag”_±r
, 
Hy³r¥aû
::
SessiÚPŒ
 &
hy³r¥aû_±r
, 
¡d
::
¡ršg
 
Çme
);

47 
TabË
(
Prİ”t›sPŒ
 &
´İs_±r
, 
Comm
 *
comm
, 
Hy³r¥aû
::
SessiÚPŒ
 &
hy³r¥aû_±r
, 
¡d
::
¡ršg
 
Çme
);

48 
	gvœtu®
 ~
TabË
();

50 
ü—‹_mutÜ
(
TabËMutÜPŒ
 &
mutÜ_±r
);

51 
ü—‹_sÿÂ”
(
SÿnS³cifiÿtiÚT
 &
sÿn_¥ec
, 
TabËSÿÂ”PŒ
 &
sÿÂ”_±r
);

53 
g‘_id’tif›r
(
TabËId’tif›rT
 *
bË_id_p
) {

54 
memıy
(
bË_id_p
, &
m_bË
, (
TabËId’tif›rT
));

57 
	g´iv©e
:

59 
š™Ÿlize
(
¡d
::
¡ršg
 &
Çme
);

61 
Prİ”t›sPŒ
 
	gm_´İs_±r
;

62 
Comm
 *
	gm_comm
;

63 
CÚÃùiÚMªag”PŒ
 
	gm_cÚn_mªag”_±r
;

64 
	gHy³r¥aû
::
SessiÚPŒ
 
m_hy³r¥aû_±r
;

65 
SchemaPŒ
 
	gm_schema_±r
;

66 
RªgeLoÿtÜPŒ
 
	gm_¿nge_loÿtÜ_±r
;

67 
TabËId’tif›rT
 
	gm_bË
;

69 
	gboo¡
::
	tšŒusive_±r
<
	tTabË
> 
	tTabËPŒ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/TableMutator.cc

21 
	~<c¡ršg
>

24 
	~<pŞl.h
>

27 
	~<boo¡/®gÜ™hm/¡ršg.hµ
>

29 
	~"CommÚ/SŒšgExt.h
"

31 
	~"Key.h
"

32 
	~"TabËMutÜ.h
"

34 
Çme¥aû
 {

35 cÚ¡ 
ušt64_t
 
DEFAULT_MAX_MEMORY
 = 20000000LL;

42 
TabËMutÜ
::
	$TabËMutÜ
(
Prİ”t›sPŒ
 &
´İs_±r
, 
Comm
 *
comm
, 
TabËId’tif›rT
 *
bË_id’tif›r
, 
SchemaPŒ
 &
schema_±r
, 
RªgeLoÿtÜPŒ
 &
¿nge_loÿtÜ_±r
è: 
	`m_´İs_±r
Õrİs_±r), 
	`m_comm
(comm), 
	`m_schema_±r
(schema_±r), 
	`m_¿nge_loÿtÜ_±r
Ôªge_loÿtÜ_±r), 
	`m_bË_Çme
ÑabË_id’tif›r->
Çme
), 
	`m_memÜy_u£d
(0), 
	`m_max_memÜy
(
DEFAULT_MAX_MEMORY
), 
	$m_»£nds
(0) {

44 
	`memıy
(&
m_bË_id’tif›r
, 
bË_id’tif›r
, (
TabËId’tif›rT
));

45 
m_bË_id’tif›r
.
Çme
 = 
m_bË_Çme
.
	`c_¡r
();

47 
m_bufãr_±r
 = 
Ãw
 
	`TabËMutÜSÿ‰”Bufãr
(
´İs_±r
, 
m_comm
, &
m_bË_id’tif›r
, 
m_schema_±r
, 
m_¿nge_loÿtÜ_±r
);

49 
	}
}

55 
TabËMutÜ
::
	$£t
(
ušt64_t
 
time¡amp
, 
KeyS³c
 &
key
, cÚ¡ *
v®ue
, 
ušt32_t
 
v®ue_Ën
) {

56 
”rÜ
;

58 
	`§n™y_check_key
(
key
);

60 ià(
key
.
cŞumn_çmy
 == 0)

61 
throw
 
	`Exû±iÚ
(
E¼Ü
::
BAD_KEY
, "Invalid key - column family‚ot specified");

64 
Key
 
fuÎ_key
;

65 
Schema
::
CŞumnFamy
 *
cf
 = 
m_schema_±r
->
	`g‘_cŞumn_çmy
(
key
.
cŞumn_çmy
);

66 ià(
cf
 == 0)

67 
throw
 
	`Exû±iÚ
(
E¼Ü
::
BAD_KEY
, (
¡d
::
¡ršg
)"Inv®id key - bad cŞumÀçmy '" + 
key
.
cŞumn_çmy
 + "'");

68 
fuÎ_key
.
row
 = (cÚ¡ *)
key
.row;

69 
fuÎ_key
.
cŞumn_qu®if›r
 = (cÚ¡ *)
key
.column_qualifier;

70 
fuÎ_key
.
cŞumn_çmy_code
 = (
ušt8_t
)
cf
->
id
;

71 
fuÎ_key
.
time¡amp
 =imestamp;

73 ià((
”rÜ
 = 
m_bufãr_±r
->
	`£t
(
fuÎ_key
, 
v®ue
, 
v®ue_Ën
)è!ğ
E¼Ü
::
OK
) {

74 
	`HT_ERROR
("Problem setting cell/value");

78 
m_memÜy_u£d
 +ğ20 + 
key
.
row_Ën
 + key.
cŞumn_qu®if›r_Ën
 + 
v®ue_Ën
;

80 ià(
m_bufãr_±r
->
	`fuÎ
(è|| 
m_memÜy_u£d
 > 
m_max_memÜy
) {

82 ià(
m_´ev_bufãr_±r
)

83 
	`wa™_fÜ_´evious_bufãr
();

85 
m_bufãr_±r
->
	`£nd
();

87 
m_´ev_bufãr_±r
 = 
m_bufãr_±r
;

89 
m_bufãr_±r
 = 
Ãw
 
	`TabËMutÜSÿ‰”Bufãr
(
m_´İs_±r
, 
m_comm
, &
m_bË_id’tif›r
, 
m_schema_±r
, 
m_¿nge_loÿtÜ_±r
);

90 
m_memÜy_u£d
 = 0;

93 
	}
}

97 
TabËMutÜ
::
	$£t_d–‘e
(
ušt64_t
 
time¡amp
, 
KeyS³c
 &
key
) {

98 
”rÜ
;

99 
Key
 
fuÎ_key
;

101 
	`§n™y_check_key
(
key
);

103 ià(
key
.
cŞumn_çmy
 == 0) {

104 
fuÎ_key
.
row
 = (cÚ¡ *)
key
.row;

105 
fuÎ_key
.
cŞumn_çmy_code
 = 0;

106 
fuÎ_key
.
cŞumn_qu®if›r
 = 0;

107 
fuÎ_key
.
time¡amp
 =imestamp;

110 
Schema
::
CŞumnFamy
 *
cf
 = 
m_schema_±r
->
	`g‘_cŞumn_çmy
(
key
.
cŞumn_çmy
);

111 ià(
cf
 == 0)

112 
throw
 
	`Exû±iÚ
(
E¼Ü
::
BAD_KEY
, (
¡d
::
¡ršg
)"Inv®id key - bad cŞumÀçmy '" + 
key
.
cŞumn_çmy
 + "'");

113 
fuÎ_key
.
row
 = (cÚ¡ *)
key
.row;

114 
fuÎ_key
.
cŞumn_qu®if›r
 = (cÚ¡ *)
key
.column_qualifier;

115 
fuÎ_key
.
cŞumn_çmy_code
 = (
ušt8_t
)
cf
->
id
;

116 
fuÎ_key
.
time¡amp
 =imestamp;

119 ià((
”rÜ
 = 
m_bufãr_±r
->
	`£t_d–‘e
(
fuÎ_key
)è!ğ
E¼Ü
::
OK
) {

120 
	`HT_ERRORF
("ProbËm došg d–‘- %s", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

123 
m_memÜy_u£d
 +ğ20 + 
key
.
row_Ën
 + key.
cŞumn_qu®if›r_Ën
;

125 ià(
m_bufãr_±r
->
	`fuÎ
(è|| 
m_memÜy_u£d
 > 
m_max_memÜy
) {

127 ià(
m_´ev_bufãr_±r
)

128 
	`wa™_fÜ_´evious_bufãr
();

130 
m_bufãr_±r
->
	`£nd
();

132 
m_´ev_bufãr_±r
 = 
m_bufãr_±r
;

134 
m_bufãr_±r
 = 
Ãw
 
	`TabËMutÜSÿ‰”Bufãr
(
m_´İs_±r
, 
m_comm
, &
m_bË_id’tif›r
, 
m_schema_±r
, 
m_¿nge_loÿtÜ_±r
);

135 
m_memÜy_u£d
 = 0;

138 
	}
}

141 
TabËMutÜ
::
	$æush
() {

143 ià(
m_´ev_bufãr_±r
)

144 
	`wa™_fÜ_´evious_bufãr
();

149 ià(
m_memÜy_u£d
 > 0) {

150 
m_bufãr_±r
->
	`£nd
();

151 
m_´ev_bufãr_±r
 = 
m_bufãr_±r
;

152 
	`wa™_fÜ_´evious_bufãr
();

155 
m_bufãr_±r
->
	`»£t
();

156 
m_´ev_bufãr_±r
 = 0;

157 
	}
}

159 
TabËMutÜ
::
	$wa™_fÜ_´evious_bufãr
() {

160 
”rÜ
;

161 
TabËMutÜSÿ‰”Bufãr
 *
»do_bufãr
 = 0;

162 
wa™_time
 = 1;

164 (
”rÜ
 = 
m_´ev_bufãr_±r
->
	`wa™_fÜ_com¶‘iÚ
()è!ğ
E¼Ü
::
OK
 && 
wa™_time
 < 16) {

166 ià(
”rÜ
 =ğ
E¼Ü
::
RANGESERVER_TIMESTAMP_ORDER_ERROR
) {

167 
¡d
::
¡ršg
 
bË_Çme_uµ”
 = 
m_bË_Çme
;

168 
boo¡
::
	`to_uµ”
(
bË_Çme_uµ”
);

170 
throw
 
	`Exû±iÚ
(
”rÜ
, (
¡d
::
¡ršg
)"ProbËm s’dšg upd©e ÑabË=" + 
bË_Çme_uµ”
.
	`c_¡r
() + ")");

174 
	`pŞl
(0, 0, 
wa™_time
*1000);

175 
wa™_time
 += 2;

180 ià((
»do_bufãr
 = 
m_´ev_bufãr_±r
->
	`ü—‹_»do_bufãr
()) == 0)

183 
m_»£nds
 +ğ
m_´ev_bufãr_±r
->
	`g‘_»£nd_couÁ
();

185 
m_´ev_bufãr_±r
 = 
»do_bufãr
;

190 
m_´ev_bufãr_±r
->
	`£nd
();

194 ià(
”rÜ
 !ğ
E¼Ü
::
OK
) {

195 
	`HT_ERRORF
("ProbËm„e£ndšg faed upd©e ÑabË=%sè- %s", 
m_bË_Çme
.
	`c_¡r
(), 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

196 
throw
 
	`Exû±iÚ
(
”rÜ
, (
¡d
::
¡ršg
)"ProbËm„e£ndšg faed upd©e ÑabË=" + 
m_bË_Çme
.
	`c_¡r
() + ")");

199 
	}
}

203 
TabËMutÜ
::
	$§n™y_check_key
(
KeyS³c
 &
key
) {

204 cÚ¡ *
row
 = (cÚ¡ *)
key
.row;

205 cÚ¡ *
cŞumn_qu®if›r
 = (cÚ¡ *)
key
.column_qualifier;

210 ià(
key
.
row_Ën
 == 0)

211 
throw
 
	`Exû±iÚ
(
E¼Ü
::
BAD_KEY
, "Invalid„ow key - cannot be zero†ength");

213 ià(
row
[
key
.
row_Ën
] != 0)

214 
throw
 
	`Exû±iÚ
(
E¼Ü
::
BAD_KEY
, "Invalid„ow key - must be followed by‡ '\\0' character");

216 ià(
	`¡¾’
(
row
è!ğ
key
.
row_Ën
)

217 
throw
 
	`Exû±iÚ
(
E¼Ü
::
BAD_KEY
, (
¡d
::
¡ršg
)"Inv®id„ow key - '\\0' ch¬aù”‚Ù‡Îowed (off£t=" + (
ušt32_t
)
	`¡¾’
(
row
) + ")");

219 ià(
row
[0] == ()0xff &&„ow[1] == ()0xff)

220 
throw
 
	`Exû±iÚ
(
E¼Ü
::
BAD_KEY
, "Invalid„ow key - cannot start with character sequence 0xff 0xff");

225 ià(
key
.
cŞumn_qu®if›r_Ën
 > 0) {

226 ià(
cŞumn_qu®if›r
[
key
.
cŞumn_qu®if›r_Ën
] != 0)

227 
throw
 
	`Exû±iÚ
(
E¼Ü
::
BAD_KEY
, "Invalid column qualifier - must be followed by‡ '\\0' character");

228 ià(
	`¡¾’
(
cŞumn_qu®if›r
è!ğ
key
.
cŞumn_qu®if›r_Ën
)

229 
throw
 
	`Exû±iÚ
(
E¼Ü
::
BAD_KEY
, (
¡d
::
¡ršg
)"Inv®id cŞumÀqu®if›¸- '\\0' ch¬aù”‚Ù‡Îowed (off£t=" + (
ušt32_t
)
	`¡¾’
(
cŞumn_qu®if›r
) + ")");

231 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/TableMutator.h

21 #iâdeà
HYPERTABLE_TABLEMUTATOR_H


22 
	#HYPERTABLE_TABLEMUTATOR_H


	)

24 
	~"AsyncComm/CÚÃùiÚMªag”.h
"

26 
	~"CommÚ/Prİ”t›s.h
"

27 
	~"CommÚ/SŒšgExt.h
"

28 
	~"CommÚ/Reã»nûCouÁ.h
"

30 
	~"C–l.h
"

31 
	~"KeyS³c.h
"

32 
	~"TabËMutÜSÿ‰”Bufãr.h
"

33 
	~"RªgeLoÿtÜ.h
"

34 
	~"RªgeS”v”Cl›Á.h
"

35 
	~"Schema.h
"

36 
	~"Ty³s.h
"

38 
Çme¥aû
 
	gHy³¹abË
 {

47 şas 
	cTabËMutÜ
 : 
public
 
Reã»nûCouÁ
 {

49 
public
:

61 
TabËMutÜ
(
Prİ”t›sPŒ
 &
´İs_±r
, 
Comm
 *
comm
, 
TabËId’tif›rT
 *
bË_id’tif›r
, 
SchemaPŒ
 &
schema_±r
, 
RªgeLoÿtÜPŒ
 &
¿nge_loÿtÜ_±r
);

63 
	gvœtu®
 ~
TabËMutÜ
() { ; }

78 
£t
(
ušt64_t
 
time¡amp
, 
KeyS³c
 &
key
, cÚ¡ *
v®ue
, 
ušt32_t
 
v®ue_Ën
);

87 
£t
(
KeyS³c
 &
key
, cÚ¡ *
v®ue
, 
ušt32_t
 
v®ue_Ën
) {

88 
£t
(0, 
key
, 
v®ue
, 
v®ue_Ën
);

103 
£t_d–‘e
(
ušt64_t
 
time¡amp
, 
KeyS³c
 &
key
);

111 
£t_d–‘e
(
KeyS³c
 &
key
) {

112 
£t_d–‘e
(0, 
key
);

118 
æush
();

125 
ušt64_t
 
memÜy_u£d
();

136 
ušt64_t
 
g‘_»£nd_couÁ
(è{  
	gm_»£nds
; }

138 
	g´iv©e
:

140 
wa™_fÜ_´evious_bufãr
();

142 
§n™y_check_key
(
KeyS³c
 &
key
);

144 
Prİ”t›sPŒ
 
	gm_´İs_±r
;

145 
Comm
 *
	gm_comm
;

146 
SchemaPŒ
 
	gm_schema_±r
;

147 
RªgeLoÿtÜPŒ
 
	gm_¿nge_loÿtÜ_±r
;

148 
	g¡d
::
¡ršg
 
m_bË_Çme
;

149 
TabËId’tif›rT
 
	gm_bË_id’tif›r
;

150 
ušt64_t
 
	gm_memÜy_u£d
;

151 
ušt64_t
 
	gm_max_memÜy
;

152 
TabËMutÜSÿ‰”BufãrPŒ
 
	gm_bufãr_±r
;

153 
TabËMutÜSÿ‰”BufãrPŒ
 
	gm_´ev_bufãr_±r
;

154 
ušt64_t
 
	gm_»£nds
;

156 
	gboo¡
::
	tšŒusive_±r
<
	tTabËMutÜ
> 
	tTabËMutÜPŒ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/TableMutatorDispatchHandler.cc

21 
	~"AsyncComm/PrÙocŞ.h
"

23 
	~"CommÚ/E¼Ü.h
"

24 
	~"CommÚ/Logg”.h
"

26 
	~"TabËMutÜDi¥©chHªdËr.h
"

28 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

34 
	gTabËMutÜDi¥©chHªdËr
::
TabËMutÜDi¥©chHªdËr
(
TabËMutÜSÿ‰”Bufãr
::
Upd©eBufãr
 *
upd©e_bufãr
è: 
	$m_upd©e_bufãr
(
upd©e_bufãr
) {

36 
	}
}

43 
	gTabËMutÜDi¥©chHªdËr
::
	$hªdË
(
Ev’tPŒ
 &
ev’t_±r
) {

45 ià(
ev’t_±r
->
ty³
 =ğ
Ev’t
::
MESSAGE
) {

46 
m_upd©e_bufãr
->
”rÜ
 = 
PrÙocŞ
::
	`»¥Ú£_code
(
ev’t_±r
);

47 ià(
m_upd©e_bufãr
->
”rÜ
 =ğ
E¼Ü
::
RANGESERVER_PARTIAL_UPDATE
) {

48 
m_upd©e_bufãr
->
ev’t_±r
 =ƒvent_ptr;

51 
m_upd©e_bufãr
->
couÁ”p
->
	`deüem’t
(m_upd©e_bufãr->
”rÜ
);

53 ià(
ev’t_±r
->
ty³
 =ğ
Ev’t
::
ERROR
) {

54 
m_upd©e_bufãr
->
”rÜ
 = 
ev’t_±r
->error;

55 
m_upd©e_bufãr
->
couÁ”p
->
	`deüem’t
(
ev’t_±r
->
”rÜ
);

56 
	`HT_WARNF
("%s", 
ev’t_±r
->
	`toSŒšg
().
	`c_¡r
());

60 
	`HT_INFOF
("%s", 
ev’t_±r
->
	`toSŒšg
().
	`c_¡r
());

61 
m_upd©e_bufãr
->
couÁ”p
->
	`deüem’t
(
ev’t_±r
->
”rÜ
);

64 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/TableMutatorDispatchHandler.h

21 #iâdeà
HYPERTABLE_TABLEMUTATORDISPATCHHANDLER_H


22 
	#HYPERTABLE_TABLEMUTATORDISPATCHHANDLER_H


	)

24 
	~"AsyncComm/Di¥©chHªdËr.h
"

25 
	~"AsyncComm/Ev’t.h
"

27 
	~"TabËMutÜSÿ‰”Bufãr.h
"

29 
Çme¥aû
 
	gHy³¹abË
 {

35 şas 
	cTabËMutÜDi¥©chHªdËr
 : 
public
 
Di¥©chHªdËr
 {

37 
public
:

41 
TabËMutÜDi¥©chHªdËr
(
TabËMutÜSÿ‰”Bufãr
::
Upd©eBufãr
 *
upd©e_bufãr
);

50 
vœtu®
 
hªdË
(
Ev’tPŒ
 &
ev’t_±r
);

52 
	g´iv©e
:

53 
TabËMutÜSÿ‰”Bufãr
::
Upd©eBufãr
 *
m_upd©e_bufãr
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/TableMutatorScatterBuffer.cc

21 
	~"DeçuÉs.h
"

22 
	~"Key.h
"

23 
	~"KeyS³c.h
"

24 
	~"TabËMutÜDi¥©chHªdËr.h
"

25 
	~"TabËMutÜSÿ‰”Bufãr.h
"

27 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

29 
	gÇme¥aû
 {

30 cÚ¡ 
ušt32_t
 
	gMAX_SEND_BUFFER_SIZE
 = 1000000;

37 
	gTabËMutÜSÿ‰”Bufãr
::
	$TabËMutÜSÿ‰”Bufãr
(
Prİ”t›sPŒ
 &
´İs_±r
, 
Comm
 *
comm
, 
TabËId’tif›rT
 *
bË_id’tif›r
, 
SchemaPŒ
 &
schema_±r
, 
RªgeLoÿtÜPŒ
 &
¿nge_loÿtÜ_±r
è: 
	`m_´İs_±r
Õrİs_±r), 
	`m_comm
(comm), 
	`m_schema_±r
(schema_±r), 
	`m_¿nge_loÿtÜ_±r
Ôªge_loÿtÜ_±r), 
	`m_¿nge_£rv”
(comm, 
HYPERTABLE_RANGESERVER_CLIENT_TIMEOUT
), 
	`m_bË_Çme
ÑabË_id’tif›r->
Çme
), 
	`m_fuÎ
(
çl£
), 
	$m_»£nds
(0) {

38 
ş›Á_timeout
;

40 ià((
ş›Á_timeout
 = 
´İs_±r
->
	`g‘_št
("Hypertable.Request.Timeout", 0)) != 0)

41 
m_¿nge_£rv”
.
	`£t_timeout
(
ş›Á_timeout
);

44 
	`memıy
(&
m_bË_id’tif›r
, 
bË_id’tif›r
, (
TabËId’tif›rT
));

45 
m_bË_id’tif›r
.
Çme
 = 
m_bË_Çme
.
	`c_¡r
();

46 
	}
}

53 
	gTabËMutÜSÿ‰”Bufãr
::
	$£t
(
Key
 &
key
, cÚ¡ *
v®ue
, 
ušt32_t
 
v®ue_Ën
) {

54 
”rÜ
;

55 
RªgeLoÿtiÚInfo
 
¿nge_šfo
;

56 
Upd©eBufãrM­T
::
cÚ¡_™”©Ü
 
™”
;

58 ià((
”rÜ
 = 
m_¿nge_loÿtÜ_±r
->
	`fšd
(&
m_bË_id’tif›r
, 
key
.
row
, &
¿nge_šfo
, 
çl£
)è!ğ
E¼Ü
::
OK
) {

59 ià((
”rÜ
 = 
m_¿nge_loÿtÜ_±r
->
	`fšd
(&
m_bË_id’tif›r
, 
key
.
row
, &
¿nge_šfo
, 21)è!ğ
E¼Ü
::
OK
) {

60 
	`HT_ERRORF
("UÇbËØloÿ‹„ªg£rv” fÜabË % row %s", 
m_bË_Çme
.
	`c_¡r
(), (cÚ¡ *)
key
.
row
);

61  
”rÜ
;

65 
™”
 = 
m_bufãr_m­
.
	`fšd
(
¿nge_šfo
.
loÿtiÚ
);

67 ià(
™”
 =ğ
m_bufãr_m­
.
	`’d
()) {

68 
m_bufãr_m­
[
¿nge_šfo
.
loÿtiÚ
] = 
Ãw
 
	`Upd©eBufãr
(&
m_com¶‘iÚ_couÁ”
);

69 
™”
 = 
m_bufãr_m­
.
	`fšd
(
¿nge_šfo
.
loÿtiÚ
);

71 ià(!
LoÿtiÚCache
::
	`loÿtiÚ_to_addr
(
¿nge_šfo
.
loÿtiÚ
.
	`c_¡r
(), (*
™”
).
£cÚd
->
addr
))

72  
E¼Ü
::
INVALID_METADATA
;

75 (*
™”
).
£cÚd
->
key_off£ts
.
	`push_back
((*™”).£cÚd->
buf
.
	`fl
());

76 
	`C»©eKeyAndAµ’d
((*
™”
).
£cÚd
->
buf
, 
FLAG_INSERT
, 
key
.
row
, key.
cŞumn_çmy_code
, key.
cŞumn_qu®if›r
, key.
time¡amp
);

77 
	`C»©eAndAµ’d
((*
™”
).
£cÚd
->
buf
, 
v®ue
, 
v®ue_Ën
);

79 ià((*
™”
).
£cÚd
->
buf
.
	`fl
(è> 
MAX_SEND_BUFFER_SIZE
)

80 
m_fuÎ
 = 
Œue
;

82  
E¼Ü
::
OK
;

83 
	}
}

89 
	gTabËMutÜSÿ‰”Bufãr
::
	$£t_d–‘e
(
Key
 &
key
) {

90 
”rÜ
;

91 
RªgeLoÿtiÚInfo
 
¿nge_šfo
;

92 
Upd©eBufãrM­T
::
cÚ¡_™”©Ü
 
™”
;

94 ià((
”rÜ
 = 
m_¿nge_loÿtÜ_±r
->
	`fšd
(&
m_bË_id’tif›r
, 
key
.
row
, &
¿nge_šfo
, 
çl£
)è!ğ
E¼Ü
::
OK
) {

95 ià((
”rÜ
 = 
m_¿nge_loÿtÜ_±r
->
	`fšd
(&
m_bË_id’tif›r
, 
key
.
row
, &
¿nge_šfo
, 21)è!ğ
E¼Ü
::
OK
) {

96 
	`HT_ERRORF
("UÇbËØloÿ‹„ªg£rv” fÜabË % row %s", 
m_bË_Çme
.
	`c_¡r
(), (cÚ¡ *)
key
.
row
);

97  
”rÜ
;

101 
™”
 = 
m_bufãr_m­
.
	`fšd
(
¿nge_šfo
.
loÿtiÚ
);

103 ià(
™”
 =ğ
m_bufãr_m­
.
	`’d
()) {

104 
m_bufãr_m­
[
¿nge_šfo
.
loÿtiÚ
] = 
Ãw
 
	`Upd©eBufãr
(&
m_com¶‘iÚ_couÁ”
);

105 
™”
 = 
m_bufãr_m­
.
	`fšd
(
¿nge_šfo
.
loÿtiÚ
);

107 ià(!
LoÿtiÚCache
::
	`loÿtiÚ_to_addr
(
¿nge_šfo
.
loÿtiÚ
.
	`c_¡r
(), (*
™”
).
£cÚd
->
addr
))

108  
E¼Ü
::
INVALID_METADATA
;

111 (*
™”
).
£cÚd
->
key_off£ts
.
	`push_back
((*™”).£cÚd->
buf
.
	`fl
());

112 
ušt8_t
 
key_æag
;

113 ià(
key
.
cŞumn_çmy_code
 == 0)

114 
key_æag
 = 
FLAG_DELETE_ROW
;

115 ià(
key
.
cŞumn_qu®if›r
)

116 
key_æag
 = 
FLAG_DELETE_CELL
;

118 
key_æag
 = 
FLAG_DELETE_COLUMN_FAMILY
;

120 
cout
 << "d–‘e: " << 
key
 << 
’dl
;

122 
	`C»©eKeyAndAµ’d
((*
™”
).
£cÚd
->
buf
, 
key_æag
, 
key
.
row
, key.
cŞumn_çmy_code
, key.
cŞumn_qu®if›r
, key.
time¡amp
);

123 
	`C»©eAndAµ’d
((*
™”
).
£cÚd
->
buf
, 0, 0);

125 ià((*
™”
).
£cÚd
->
buf
.
	`fl
(è> 
MAX_SEND_BUFFER_SIZE
)

126 
m_fuÎ
 = 
Œue
;

128  
E¼Ü
::
OK
;

129 
	}
}

136 
	gTabËMutÜSÿ‰”Bufãr
::
	$£t
(
By‹SŒšg32T
 *
key
, By‹SŒšg32T *
v®ue
) {

137 
”rÜ
;

138 
RªgeLoÿtiÚInfo
 
¿nge_šfo
;

139 
Upd©eBufãrM­T
::
cÚ¡_™”©Ü
 
™”
;

141 ià((
”rÜ
 = 
m_¿nge_loÿtÜ_±r
->
	`fšd
(&
m_bË_id’tif›r
, (cÚ¡ *)
key
->
d©a
, &
¿nge_šfo
, 
çl£
)è!ğ
E¼Ü
::
OK
) {

142 ià((
”rÜ
 = 
m_¿nge_loÿtÜ_±r
->
	`fšd
(&
m_bË_id’tif›r
, (cÚ¡ *)
key
->
d©a
, &
¿nge_šfo
, 21)è!ğ
E¼Ü
::
OK
) {

143 
	`HT_ERRORF
("UÇbËØloÿ‹„ªg£rv” fÜabË % row %s", 
m_bË_Çme
.
	`c_¡r
(), (cÚ¡ *)
key
->
d©a
);

144  
”rÜ
;

148 
™”
 = 
m_bufãr_m­
.
	`fšd
(
¿nge_šfo
.
loÿtiÚ
);

150 ià(
™”
 =ğ
m_bufãr_m­
.
	`’d
()) {

151 
m_bufãr_m­
[
¿nge_šfo
.
loÿtiÚ
] = 
Ãw
 
	`Upd©eBufãr
(&
m_com¶‘iÚ_couÁ”
);

152 
™”
 = 
m_bufãr_m­
.
	`fšd
(
¿nge_šfo
.
loÿtiÚ
);

154 ià(!
LoÿtiÚCache
::
	`loÿtiÚ_to_addr
(
¿nge_šfo
.
loÿtiÚ
.
	`c_¡r
(), (*
™”
).
£cÚd
->
addr
))

155  
E¼Ü
::
INVALID_METADATA
;

158 (*
™”
).
£cÚd
->
key_off£ts
.
	`push_back
((*™”).£cÚd->
buf
.
	`fl
());

159 (*
™”
).
£cÚd
->
buf
.
	`add
(
key
, 
	`L’gth
(key));

160 (*
™”
).
£cÚd
->
buf
.
	`add
(
v®ue
, 
	`L’gth
(value));

162 ià((*
™”
).
£cÚd
->
buf
.
	`fl
(è> 
MAX_SEND_BUFFER_SIZE
)

163 
m_fuÎ
 = 
Œue
;

165  
E¼Ü
::
OK
;

166 
	}
}

168 
	gÇme¥aû
 {

169 
	sÉBy‹SŒšg32ChrÚŞogiÿl
 {

170 
boŞ
 
İ”©Ü
()(cÚ¡ 
By‹SŒšg32T
 * 
	gbs1±r
, cÚ¡ By‹SŒšg32T *
	gbs2±r
) const {

171 
	grv®
 = 
¡rcmp
((cÚ¡ *)
bs1±r
->
d©a
, (cÚ¡ *)
bs2±r
->data);

172 ià(
	grv®
 == 0) {

173 cÚ¡ 
ušt8_t
 *
ts1±r
 = 
bs1±r
->
d©a
 + bs1±r->
Ën
 - 8;

174 cÚ¡ 
ušt8_t
 *
	gts2±r
 = 
bs2±r
->
d©a
 + bs2±r->
Ën
 - 8;

175  
memcmp
(
ts1±r
, 
ts2±r
, 8) > 0;

177  
	grv®
 < 0;

186 
	gTabËMutÜSÿ‰”Bufãr
::
	$£nd
() {

187 
Upd©eBufãrPŒ
 
upd©e_bufãr_±r
;

188 
ÉBy‹SŒšg32ChrÚŞogiÿl
 
swo_bs32
;

189 
¡d
::
veùÜ
<
By‹SŒšg32T
 *> 
kvec
;

190 
ušt8_t
 *
d©a
, *
±r
;

192 
m_com¶‘iÚ_couÁ”
.
	`£t
(
m_bufãr_m­
.
	`size
());

194 
Upd©eBufãrM­T
::
cÚ¡_™”©Ü
 
™”
 = 
m_bufãr_m­
.
	`begš
(); i‹¸!ğm_bufãr_m­.
	`’d
(); iter++) {

195 
upd©e_bufãr_±r
 = (*
™”
).
£cÚd
;

196 ià(!
upd©e_bufãr_±r
->
sÜ‹d
) {

197 
kvec
.
	`ş—r
();

198 
kvec
.
	`»£rve
Ğ
upd©e_bufãr_±r
->
key_off£ts
.
	`size
() );

199 
size_t
 
i
=0; i<
upd©e_bufãr_±r
->
key_off£ts
.
	`size
(); i++)

200 
kvec
.
	`push_back
((
By‹SŒšg32T
 *)(
upd©e_bufãr_±r
->
buf
.buà+ upd©e_bufãr_±r->
key_off£ts
[
i
]));

201 
	`sÜt
(
kvec
.
	`begš
(), kvec.
	`’d
(), 
swo_bs32
);

202 
ušt8_t
 *
¤c_ba£
, *
¤c_±r
;

203 
size_t
 
Ën
 = 
upd©e_bufãr_±r
->
buf
.
	`fl
();

204 
±r
 = 
d©a
 = 
Ãw
 
ušt8_t
 [ 
Ën
 ];

206 
size_t
 
i
=0; i<
kvec
.
	`size
(); i++) {

207 
¤c_±r
 = 
¤c_ba£
 = (
ušt8_t
 *)
kvec
[
i
];

208 
¤c_±r
 +ğ
	`L’gth
((cÚ¡ 
By‹SŒšg32T
 *)src_ptr);

209 
¤c_±r
 +ğ
	`L’gth
((cÚ¡ 
By‹SŒšg32T
 *)src_ptr);

210 
	`memıy
(
±r
, 
¤c_ba£
, 
¤c_±r
-src_base);

211 
±r
 +ğ
¤c_±r
 - 
¤c_ba£
;

215 
size_t
 
Ën
 = 
upd©e_bufãr_±r
->
buf
.
	`fl
();

216 
d©a
 = 
Ãw
 
ušt8_t
 [ 
Ën
 ];

217 
	`memıy
(
d©a
, 
upd©e_bufãr_±r
->
buf
.buf, 
Ën
);

218 
±r
 = 
d©a
 + 
Ën
;

221 
upd©e_bufãr_±r
->
di¥©ch_hªdËr_±r
 = 
Ãw
 
	`TabËMutÜDi¥©chHªdËr
(upd©e_bufãr_±r.
	`g‘
());

226 ià((
upd©e_bufãr_±r
->
”rÜ
 = 
m_¿nge_£rv”
.
	`upd©e
(upd©e_bufãr_±r->
addr
, 
m_bË_id’tif›r
, 
d©a
, 
±r
-data,

227 
upd©e_bufãr_±r
->
di¥©ch_hªdËr_±r
.
	`g‘
())è!ğ
E¼Ü
::
OK
)

228 
upd©e_bufãr_±r
->
couÁ”p
->
	`deüem’t
(upd©e_bufãr_±r->
”rÜ
);

230 
	}
}

237 
boŞ
 
	gTabËMutÜSÿ‰”Bufãr
::
	$com¶‘ed
() {

238  
m_com¶‘iÚ_couÁ”
.
	`is_com¶‘e
();

239 
	}
}

246 
	gTabËMutÜSÿ‰”Bufãr
::
	$wa™_fÜ_com¶‘iÚ
() {

247  
m_com¶‘iÚ_couÁ”
.
	`wa™_fÜ_com¶‘iÚ
();

248 
	}
}

251 
TabËMutÜSÿ‰”Bufãr
 *
	gTabËMutÜSÿ‰”Bufãr
::
	$ü—‹_»do_bufãr
() {

252 
”rÜ
;

253 
Upd©eBufãrPŒ
 
upd©e_bufãr_±r
;

254 
RªgeLoÿtiÚInfo
 
¿nge_šfo
;

255 
¡d
::
veùÜ
<
By‹SŒšg32T
 *> 
kvec
;

256 
By‹SŒšg32T
 *
low_key
, *
key
, *
v®ue
;

257 
couÁ
 = 0;

259 
TabËMutÜSÿ‰”Bufãr
 *
»do_bufãr
 = 
Ãw
 
	`TabËMutÜSÿ‰”Bufãr
(
m_´İs_±r
, 
m_comm
, &
m_bË_id’tif›r
, 
m_schema_±r
, 
m_¿nge_loÿtÜ_±r
);

261 
Upd©eBufãrM­T
::
cÚ¡_™”©Ü
 
™”
 = 
m_bufãr_m­
.
	`begš
(); i‹¸!ğm_bufãr_m­.
	`’d
(); iter++) {

262 
upd©e_bufãr_±r
 = (*
™”
).
£cÚd
;

264 ià(
upd©e_bufãr_±r
->
”rÜ
 !ğ
E¼Ü
::
OK
) {

266 ià(
upd©e_bufãr_±r
->
”rÜ
 =ğ
E¼Ü
::
RANGESERVER_PARTIAL_UPDATE
) {

267 
ušt8_t
 *
¤c_ba£
, *
¤c_±r
, *
¤c_’d
;

269 
¤c_±r
 = 
¤c_ba£
 = 
upd©e_bufãr_±r
->
ev’t_±r
->
mes§ge
 + 4;

270 
¤c_’d
 = 
upd©e_bufãr_±r
->
ev’t_±r
->
mes§ge
 + upd©e_bufãr_±r->ev’t_±r->
mes§geL’
;

272 
low_key
 = (
By‹SŒšg32T
 *)
¤c_ba£
;

275 ià((
”rÜ
 = 
m_¿nge_loÿtÜ_±r
->
	`fšd
(&
m_bË_id’tif›r
, (cÚ¡ *)
low_key
->
d©a
, &
¿nge_šfo
, 21)è!ğ
E¼Ü
::
OK
) {

276 
	`HT_WARNF
("UÇbËØloÿ‹„ªg£rv” fÜabË % row %s", 
m_bË_Çme
.
	`c_¡r
(), (cÚ¡ *)
low_key
->
d©a
);

277 
d–‘e
 
»do_bufãr
;

282 
¤c_±r
 < 
¤c_’d
) {

283 
key
 = (
By‹SŒšg32T
 *)
¤c_±r
;

284 
v®ue
 = (
By‹SŒšg32T
 *)(((
ušt8_t
 *)
key
è+ 
	`L’gth
(key));

285 ià((
”rÜ
 = 
»do_bufãr
->
	`£t
(
key
, 
v®ue
)è!ğ
E¼Ü
::
OK
) {

286 
	`HT_ERRORF
("ProbËm‡ddšg„ow '%s' oàbË '%s'Ø»dØbufãr", (cÚ¡ *)
low_key
->
d©a
, 
m_bË_Çme
.
	`c_¡r
());

287 
d–‘e
 
»do_bufãr
;

290 
¤c_±r
 +ğ
	`L’gth
(
key
è+ L’gth(
v®ue
);

291 
m_»£nds
++;

298 
low_key
 = (
By‹SŒšg32T
 *)
upd©e_bufãr_±r
->
buf
.buf;

301 
size_t
 
i
=0; i<
upd©e_bufãr_±r
->
key_off£ts
.
	`size
(); i++) {

302 
key
 = (
By‹SŒšg32T
 *)(
upd©e_bufãr_±r
->
buf
.buà+ upd©e_bufãr_±r->
key_off£ts
[
i
]);

303 ià(
	`¡rcmp
((*)
key
->
d©a
, (*)
low_key
->data) < 0)

304 
low_key
 = 
key
;

308 ià((
”rÜ
 = 
m_¿nge_loÿtÜ_±r
->
	`fšd
(&
m_bË_id’tif›r
, (cÚ¡ *)
low_key
->
d©a
, &
¿nge_šfo
, 21)è!ğ
E¼Ü
::
OK
) {

309 
	`HT_WARNF
("UÇbËØloÿ‹„ªg£rv” fÜabË % row %s", 
m_bË_Çme
.
	`c_¡r
(), (cÚ¡ *)
low_key
->
d©a
);

310 
d–‘e
 
»do_bufãr
;

314 
couÁ
 = 0;

317 
size_t
 
i
=0; i<
upd©e_bufãr_±r
->
key_off£ts
.
	`size
(); i++) {

318 
key
 = (
By‹SŒšg32T
 *)(
upd©e_bufãr_±r
->
buf
.buà+ upd©e_bufãr_±r->
key_off£ts
[
i
]);

319 
v®ue
 = (
By‹SŒšg32T
 *)(((
ušt8_t
 *)
key
è+ 
	`L’gth
(key));

320 ià((
”rÜ
 = 
»do_bufãr
->
	`£t
(
key
, 
v®ue
)è!ğ
E¼Ü
::
OK
) {

321 
	`HT_ERRORF
("ProbËm‡ddšg„ow '%s' oàbË '%s'Ø»dØbufãr", (cÚ¡ *)
low_key
->
d©a
, 
m_bË_Çme
.
	`c_¡r
());

322 
d–‘e
 
»do_bufãr
;

325 
couÁ
++;

328 
	`HT_INFOF
("S’dƒ¼Ü '%s',„e£ndšg %d upd©es", 
E¼Ü
::
	`g‘_‹xt
(
upd©e_bufãr_±r
->
”rÜ
), 
couÁ
);

336  
»do_bufãr
;

337 
	}
}

340 
	gTabËMutÜSÿ‰”Bufãr
::
	$»£t
() {

341 
Upd©eBufãrM­T
::
cÚ¡_™”©Ü
 
™”
 = 
m_bufãr_m­
.
	`begš
(); i‹¸!ğm_bufãr_m­.
	`’d
(); iter++) {

342 (*
™”
).
£cÚd
->
key_off£ts
.
	`ş—r
();

343 (*
™”
).
£cÚd
->
buf
.
	`ş—r
();

344 (*
™”
).
£cÚd
->
sÜ‹d
 = 
çl£
;

345 (*
™”
).
£cÚd
->
”rÜ
 = 
E¼Ü
::
OK
;

346 (*
™”
).
£cÚd
->
ev’t_±r
 = 0;

347 (*
™”
).
£cÚd
->
di¥©ch_hªdËr_±r
 = 0;

349 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/TableMutatorScatterBuffer.h

21 #iâdeà
HYPERTABLE_TABLEMUTATORSCATTERBUFFER_H


22 
	#HYPERTABLE_TABLEMUTATORSCATTERBUFFER_H


	)

24 
	~<veùÜ
>

26 
	~<boo¡/th»ad/mu‹x.hµ
>

27 
	~<boo¡/th»ad/cÚd™iÚ.hµ
>

29 
	~"AsyncComm/Di¥©chHªdËr.h
"

30 
	~"AsyncComm/Ev’t.h
"

32 
	~"CommÚ/©omic.h
"

33 
	~"CommÚ/By‹SŒšg.h
"

34 
	~"CommÚ/Reã»nûCouÁ.h
"

35 
	~"CommÚ/SŒšgExt.h
"

37 
	~"Key.h
"

38 
	~"RªgeLoÿtÜ.h
"

39 
	~"RªgeS”v”Cl›Á.h
"

40 
	~"Schema.h
"

42 
Çme¥aû
 
	gHy³¹abË
 {

44 şas 
	cTabËMutÜSÿ‰”Bufãr
 : 
public
 
Reã»nûCouÁ
 {

46 
public
:

48 
TabËMutÜSÿ‰”Bufãr
(
Prİ”t›sPŒ
 &
´İs_±r
, 
Comm
 *
comm
, 
TabËId’tif›rT
 *
bË_id’tif›r
, 
SchemaPŒ
 &
schema_±r
, 
RªgeLoÿtÜPŒ
 &
¿nge_loÿtÜ_±r
);

49 
£t
(
Key
 &
key
, cÚ¡ *
v®ue
, 
ušt32_t
 
v®ue_Ën
);

50 
£t_d–‘e
(
Key
 &
key
);

51 
£t
(
By‹SŒšg32T
 *
key
, By‹SŒšg32T *
v®ue
);

52 
boŞ
 
fuÎ
(è{  
	gm_fuÎ
; }

53 
£nd
();

54 
boŞ
 
com¶‘ed
();

55 
wa™_fÜ_com¶‘iÚ
();

56 
»£t
();

57 
TabËMutÜSÿ‰”Bufãr
 *
ü—‹_»do_bufãr
();

58 
ušt64_t
 
g‘_»£nd_couÁ
(è{  
	gm_»£nds
; }

60 
	g´iv©e
:

65 şas 
	cCom¶‘iÚCouÁ”
 {

66 
public
:

67 
Com¶‘iÚCouÁ”
(è: 
m_out¡ªdšg
(0), 
m_Ï¡_”rÜ
(0), 
m_dÚe
(
çl£
) { }

68 
£t
(
size_t
 
couÁ
) {

69 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

70 
	gm_out¡ªdšg
 = 
couÁ
;

71 
	gm_dÚe
 = (
m_out¡ªdšg
 =ğ0è? 
Œue
 : 
çl£
;

72 
	gm_Ï¡_”rÜ
 = 0;

74 
deüem’t
(
”rÜ
) {

75 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

76 
as£¹
(
m_out¡ªdšg
);

77 
	gm_out¡ªdšg
--;

78 ià(
	g”rÜ
 !ğ
E¼Ü
::
OK
) {

79 ià(
m_Ï¡_”rÜ
 =ğ0 || 
”rÜ
 !ğ
E¼Ü
::
RANGESERVER_PARTIAL_UPDATE
)

80 
m_Ï¡_”rÜ
 = 
”rÜ
;

82 ià(
	gm_out¡ªdšg
 == 0) {

83 
m_dÚe
 = 
Œue
;

84 
	gm_cÚd
.
nÙify_®l
();

87 
wa™_fÜ_com¶‘iÚ
() {

88 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

89 
	gm_out¡ªdšg
)

90 
	gm_cÚd
.
wa™
(
lock
);

91  
	gm_Ï¡_”rÜ
;

94 
boŞ
 
is_com¶‘e
(è{  
	gm_dÚe
; }

96 
	g´iv©e
:

97 
boo¡
::
mu‹x
 
m_mu‹x
;

98 
	gboo¡
::
cÚd™iÚ
 
m_cÚd
;

99 
size_t
 
	gm_out¡ªdšg
;

100 
	gm_Ï¡_”rÜ
;

101 
boŞ
 
	gm_dÚe
;

104 
ä›nd
 
şass
 
	gTabËMutÜDi¥©chHªdËr
;

109 şas 
	cUpd©eBufãr
 : 
public
 
Reã»nûCouÁ
 {

110 
public
:

111 
Upd©eBufãr
(
Com¶‘iÚCouÁ”
 *
cc
è: 
buf
(1024), 
sÜ‹d
(
çl£
), 
”rÜ
(0), 
couÁ”p
(cc) { ; }

112 
	g¡d
::
veùÜ
<
ušt64_t
> 
key_off£ts
;

113 
DyÇmicBufãr
 
	gbuf
;

114 
boŞ
 
	gsÜ‹d
;

115 
sockaddr_š
 
	gaddr
;

116 
	g”rÜ
;

117 
Ev’tPŒ
 
	gev’t_±r
;

118 
Com¶‘iÚCouÁ”
 *
	gcouÁ”p
;

119 
Di¥©chHªdËrPŒ
 
	gdi¥©ch_hªdËr_±r
;

121 
	gboo¡
::
	tšŒusive_±r
<
	tUpd©eBufãr
> 
	tUpd©eBufãrPŒ
;

123 
	g__gnu_cxx
::
	thash_m­
<
	t¡ršg
, 
	tUpd©eBufãrPŒ
> 
	tUpd©eBufãrM­T
;

125 
Prİ”t›sPŒ
 
	gm_´İs_±r
;

126 
Comm
 *
	gm_comm
;

127 
SchemaPŒ
 
	gm_schema_±r
;

128 
RªgeLoÿtÜPŒ
 
	gm_¿nge_loÿtÜ_±r
;

129 
RªgeS”v”Cl›Á
 
	gm_¿nge_£rv”
;

130 
	g¡d
::
¡ršg
 
m_bË_Çme
;

131 
TabËId’tif›rT
 
	gm_bË_id’tif›r
;

132 
Upd©eBufãrM­T
 
	gm_bufãr_m­
;

133 
Com¶‘iÚCouÁ”
 
	gm_com¶‘iÚ_couÁ”
;

134 
boŞ
 
	gm_fuÎ
;

135 
ušt64_t
 
	gm_»£nds
;

137 
	gboo¡
::
	tšŒusive_±r
<
	tTabËMutÜSÿ‰”Bufãr
> 
	tTabËMutÜSÿ‰”BufãrPŒ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/TableScanner.cc

21 
	~<¡ršg
>

22 
	~<veùÜ
>

24 
	~"DeçuÉs.h
"

25 
	~"Key.h
"

26 
	~"TabËSÿÂ”.h
"

28 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

30 
	gÇme¥aû
 {

31 cÚ¡ 
	g’d_row_key
[2] = { ()0xff, ()0xff };

41 
	gTabËSÿÂ”
::
	$TabËSÿÂ”
(
Prİ”t›sPŒ
 &
´İs_±r
, 
Comm
 *
comm
, 
TabËId’tif›rT
 *
bË_id’tif›r
, 
SchemaPŒ
 &
schema_±r
, 
RªgeLoÿtÜPŒ
 &
¿nge_loÿtÜ_±r
, 
SÿnS³cifiÿtiÚT
 &
sÿn_¥ec
è: 
	`m_comm
(comm), 
	`m_schema_±r
(schema_±r), 
	`m_¿nge_loÿtÜ_±r
Ôªge_loÿtÜ_±r), 
	`m_¿nge_£rv”
(comm, 
HYPERTABLE_RANGESERVER_CLIENT_TIMEOUT
), 
	`m_bË_Çme
ÑabË_id’tif›r->
Çme
), 
	`m_¡¬‹d
(
çl£
), 
	`m_eos
(çl£), 
	`m_»adah—d
(
Œue
), 
	`m_ãtch_out¡ªdšg
(çl£), 
	$m_rows_£’
(0) {

42 *
¡r
;

43 
time_t
 
ş›Á_timeout
;

45 ià((
ş›Á_timeout
 = 
´İs_±r
->
	`g‘_št
("Hypertable.Request.Timeout", 0)) != 0)

46 
m_¿nge_£rv”
.
	`£t_timeout
(
ş›Á_timeout
);

48 
m_sÿn_¥ec
.
rowLim™
 = 
sÿn_¥ec
.rowLimit;

49 
m_sÿn_¥ec
.
max_v”siÚs
 = 
sÿn_¥ec
.max_versions;

52 
size_t
 
i
=0; i<
sÿn_¥ec
.
cŞumns
.
	`size
(); i++) {

53 
¡r
 = 
Ãw
 [ 
	`¡¾’
(
sÿn_¥ec
.
cŞumns
[
i
]) + 1 ];

54 
	`¡rıy
(
¡r
, 
sÿn_¥ec
.
cŞumns
[
i
]);

55 
m_sÿn_¥ec
.
cŞumns
.
	`push_back
(
¡r
);

59 ià(
sÿn_¥ec
.
¡¬tRow
) {

60 
¡r
 = 
Ãw
 [ 
	`¡¾’
(
sÿn_¥ec
.
¡¬tRow
) + 1 ];

61 
	`¡rıy
(
¡r
, 
sÿn_¥ec
.
¡¬tRow
);

62 
m_sÿn_¥ec
.
¡¬tRow
 = 
¡r
;

65 
m_sÿn_¥ec
.
¡¬tRow
 = 0;

66 
m_sÿn_¥ec
.
¡¬tRowInşusive
 = 
sÿn_¥ec
.startRowInclusive;

69 ià(
sÿn_¥ec
.
’dRow
) {

70 
¡r
 = 
Ãw
 [ 
	`¡¾’
(
sÿn_¥ec
.
’dRow
) + 1 ];

71 
	`¡rıy
(
¡r
, 
sÿn_¥ec
.
’dRow
);

72 
m_sÿn_¥ec
.
’dRow
 = 
¡r
;

75 
m_sÿn_¥ec
.
’dRow
 = 0;

76 
m_sÿn_¥ec
.
’dRowInşusive
 = 
sÿn_¥ec
.endRowInclusive;

78 ià(
m_sÿn_¥ec
.
rowLim™
 == 1 ||

79 ((
m_sÿn_¥ec
.
¡¬tRow
 && m_sÿn_¥ec.
’dRow
è&& !
	`¡rcmp
(m_scan_spec.startRow, m_scan_spec.endRow)))

80 
m_»adah—d
 = 
çl£
;

82 
	`memıy
(&
m_sÿn_¥ec
.
š‹rv®
, &
sÿn_¥ec
.interval, (m_scan_spec.interval));

84 
m_sÿn_¥ec
.
»tuº_d–‘es
 = 
sÿn_¥ec
.return_deletes;

87 
	`memıy
(&
m_bË_id’tif›r
, 
bË_id’tif›r
, (
TabËId’tif›rT
));

88 
m_bË_id’tif›r
.
Çme
 = 
m_bË_Çme
.
	`c_¡r
();

90 
	}
}

96 
	gTabËSÿÂ”
::~
	$TabËSÿÂ”
() {

97 
size_t
 
i
=0; i<
m_sÿn_¥ec
.
cŞumns
.
	`size
(); i++)

98 
d–‘e
 [] 
m_sÿn_¥ec
.
cŞumns
[
i
];

99 
d–‘e
 [] 
m_sÿn_¥ec
.
¡¬tRow
;

100 
d–‘e
 [] 
m_sÿn_¥ec
.
’dRow
;

103 ià(
m_ãtch_out¡ªdšg
)

104 
m_sync_hªdËr
.
	`wa™_fÜ_»¶y
(
m_ev’t_±r
);

105 
	}
}

109 
boŞ
 
	gTabËSÿÂ”
::
	$Ãxt
(
C–lT
 &
ûÎ
) {

110 
”rÜ
;

111 cÚ¡ 
By‹SŒšg32T
 *
key
, *
v®ue
;

112 
Key
 
keyComps
;

114 ià(
m_eos
)

115  
çl£
;

117 ià(!
m_¡¬‹d
)

118 
	`fšd_¿nge_ªd_¡¬t_sÿn
(
m_sÿn_¥ec
.
¡¬tRow
);

120 !
m_sÿnblock
.
	`mÜe
()) {

121 ià(
m_sÿnblock
.
	`eos
()) {

122 ià(!
	`¡rcmp
(
m_¿nge_šfo
.
’d_row
.
	`c_¡r
(), 
Key
::
END_ROW_MARKER
) ||

123 (
m_sÿn_¥ec
.
’dRow
 && (
	`¡rcmp
(m_sÿn_¥ec.’dRow, 
m_¿nge_šfo
.
’d_row
.
	`c_¡r
()) <= 0))) {

124 
m_¿nge_£rv”
.
	`de¡roy_sÿÂ”
(
m_cur_addr
, 
m_sÿnblock
.
	`g‘_sÿÂ”_id
(), 0);

125 
m_eos
 = 
Œue
;

126  
çl£
;

128 
¡d
::
¡ršg
 
Ãxt_row
 = 
m_¿nge_šfo
.
’d_row
;

129 
Ãxt_row
.
	`­³nd
(1,1);

130 
	`fšd_¿nge_ªd_¡¬t_sÿn
(
Ãxt_row
.
	`c_¡r
());

133 ià(
m_ãtch_out¡ªdšg
) {

134 ià(!
m_sync_hªdËr
.
	`wa™_fÜ_»¶y
(
m_ev’t_±r
)) {

135 
m_ãtch_out¡ªdšg
 = 
çl£
;

136 
	`HT_ERRORF
("RªgeS”v” 'ãtch sÿnblock'ƒ¼Ü : %s", 
PrÙocŞ
::
	`¡ršg_fÜm©_mes§ge
(
m_ev’t_±r
).
	`c_¡r
());

137 
throw
 
	`Exû±iÚ
(()
PrÙocŞ
::
	`»¥Ú£_code
(
m_ev’t_±r
));

140 
”rÜ
 = 
m_sÿnblock
.
	`lßd
(
m_ev’t_±r
);

141 ià(
m_»adah—d
 && !
m_sÿnblock
.
	`eos
()) {

142 ià((
”rÜ
 = 
m_¿nge_£rv”
.
	`ãtch_sÿnblock
(
m_cur_addr
, 
m_sÿnblock
.
	`g‘_sÿÂ”_id
(), &
m_sync_hªdËr
)è!ğ
E¼Ü
::
OK
)

143 
throw
 
	`Exû±iÚ
(
”rÜ
);

144 
m_ãtch_out¡ªdšg
 = 
Œue
;

147 
m_ãtch_out¡ªdšg
 = 
çl£
;

151 ià((
”rÜ
 = 
m_¿nge_£rv”
.
	`ãtch_sÿnblock
(
m_cur_addr
, 
m_sÿnblock
.
	`g‘_sÿÂ”_id
(), m_sÿnblock)è!ğ
E¼Ü
::
OK
)

152 
throw
 
	`Exû±iÚ
(
”rÜ
);

157 ià(
m_sÿnblock
.
	`Ãxt
(
key
, 
v®ue
)) {

158 
Schema
::
CŞumnFamy
 *
cf
;

159 ià(!
keyComps
.
	`lßd
(
key
))

160 
throw
 
	`Exû±iÚ
(
E¼Ü
::
BAD_KEY
);

163 ià(
m_sÿn_¥ec
.
’dRow
) {

164 ià(
m_sÿn_¥ec
.
’dRowInşusive
) {

165 ià(
	`¡rcmp
(
keyComps
.
row
, 
m_sÿn_¥ec
.
’dRow
) > 0) {

166 
m_¿nge_£rv”
.
	`de¡roy_sÿÂ”
(
m_cur_addr
, 
m_sÿnblock
.
	`g‘_sÿÂ”_id
(), 0);

167 
m_eos
 = 
Œue
;

168  
çl£
;

172 ià(
	`¡rcmp
(
keyComps
.
row
, 
m_sÿn_¥ec
.
’dRow
) >= 0) {

173 
m_¿nge_£rv”
.
	`de¡roy_sÿÂ”
(
m_cur_addr
, 
m_sÿnblock
.
	`g‘_sÿÂ”_id
(), 0);

174 
m_eos
 = 
Œue
;

175  
çl£
;

179 ià(!
	`¡rcmp
(
keyComps
.
row
, 
’d_row_key
)) {

180 
m_¿nge_£rv”
.
	`de¡roy_sÿÂ”
(
m_cur_addr
, 
m_sÿnblock
.
	`g‘_sÿÂ”_id
(), 0);

181 
m_eos
 = 
Œue
;

182  
çl£
;

186 ià(
	`¡rcmp
(
m_cur_row
.
	`c_¡r
(), 
keyComps
.
row
)) {

187 
m_rows_£’
++;

188 
m_cur_row
 = 
keyComps
.
row
;

189 ià(
m_sÿn_¥ec
.
rowLim™
 > 0 && 
m_rows_£’
 > m_scan_spec.rowLimit) {

190 
m_¿nge_£rv”
.
	`de¡roy_sÿÂ”
(
m_cur_addr
, 
m_sÿnblock
.
	`g‘_sÿÂ”_id
(), 0);

191 
m_eos
 = 
Œue
;

192  
çl£
;

196 
ûÎ
.
row_key
 = 
keyComps
.
row
;

197 
ûÎ
.
cŞumn_qu®if›r
 = 
keyComps
.column_qualifier;

198 ià((
cf
 = 
m_schema_±r
->
	`g‘_cŞumn_çmy
(
keyComps
.
cŞumn_çmy_code
)) == 0) {

201 
ûÎ
.
cŞumn_çmy
 = 0;

204 
ûÎ
.
cŞumn_çmy
 = 
cf
->
Çme
.
	`c_¡r
();

205 
ûÎ
.
time¡amp
 = 
keyComps
.timestamp;

206 
ûÎ
.
v®ue
 = v®ue->
d©a
;

207 
ûÎ
.
v®ue_Ën
 = 
v®ue
->
Ën
;

208 
ûÎ
.
æag
 = 
keyComps
.flag;

209  
Œue
;

212 
	`HT_ERROR
("Noƒnd marker found‡tƒnd ofable.");

214 
m_¿nge_£rv”
.
	`de¡roy_sÿÂ”
(
m_cur_addr
, 
m_sÿnblock
.
	`g‘_sÿÂ”_id
(), 0);

215 
m_eos
 = 
Œue
;

216  
çl£
;

217 
	}
}

221 
	gTabËSÿÂ”
::
	$fšd_¿nge_ªd_¡¬t_sÿn
(cÚ¡ *
row_key
) {

222 
”rÜ
;

223 
RªgeT
 
¿nge
;

224 
DyÇmicBufãr
 
	`dbuf
(0);

226 ià((
”rÜ
 = 
m_¿nge_loÿtÜ_±r
->
	`fšd
(&
m_bË_id’tif›r
, 
row_key
, &
m_¿nge_šfo
, 
çl£
)è!ğ
E¼Ü
::
OK
) {

228 ià((
”rÜ
 = 
m_¿nge_loÿtÜ_±r
->
	`fšd
(&
m_bË_id’tif›r
, 
row_key
, &
m_¿nge_šfo
, 21)è!ğ
E¼Ü
::
OK
)

229 
throw
 
	`Exû±iÚ
(
”rÜ
, 
¡d
::
	`¡ršg
("UÇbËØfšd„ªg£rv” fÜabË '"è+ 
m_bË_id’tif›r
.
Çme
 + "'„ow key '" + (
row_key
 ?„ow_key : "") + "'");

232 
m_¡¬‹d
 = 
Œue
;

234 
dbuf
.
	`’su»
(
m_¿nge_šfo
.
¡¬t_row
.
	`Ëngth
(è+ m_¿nge_šfo.
’d_row
.length() + 2);

235 
¿nge
.
¡¬tRow
 = (cÚ¡ *)
dbuf
.
	`addNoCheck
(
m_¿nge_šfo
.
¡¬t_row
.
	`c_¡r
(), m_¿nge_šfo.¡¬t_row.
	`Ëngth
()+1);

236 
¿nge
.
’dRow
 = (cÚ¡ *)
dbuf
.
	`addNoCheck
(
m_¿nge_šfo
.
’d_row
.
	`c_¡r
(), m_¿nge_šfo.’d_row.
	`Ëngth
()+1);

237 ià(!
LoÿtiÚCache
::
	`loÿtiÚ_to_addr
(
m_¿nge_šfo
.
loÿtiÚ
.
	`c_¡r
(), 
m_cur_addr
)) {

238 
	`HT_ERRORF
("Invalid†ocation found in METADATAƒntry„ange [%s..%s] - %s",

239 
¿nge
.
¡¬tRow
,„ªge.
’dRow
, 
m_¿nge_šfo
.
loÿtiÚ
.
	`c_¡r
());

240 
throw
 
	`Exû±iÚ
(
E¼Ü
::
INVALID_METADATA
);

243 ià((
”rÜ
 = 
m_¿nge_£rv”
.
	`ü—‹_sÿÂ”
(
m_cur_addr
, 
m_bË_id’tif›r
, 
¿nge
, 
m_sÿn_¥ec
, 
m_sÿnblock
)è!ğ
E¼Ü
::
OK
) {

246 ià((
”rÜ
 = 
m_¿nge_loÿtÜ_±r
->
	`fšd
(&
m_bË_id’tif›r
, 
row_key
, &
m_¿nge_šfo
, 21)è!ğ
E¼Ü
::
OK
)

247 
throw
 
	`Exû±iÚ
(
”rÜ
, 
¡d
::
	`¡ršg
("UÇbËØfšd„ªg£rv” fÜabË '"è+ 
m_bË_id’tif›r
.
Çme
 + "'„ow key '" + (
row_key
 ?„ow_key : "") + "'");

250 
dbuf
.
	`’su»
(
m_¿nge_šfo
.
¡¬t_row
.
	`Ëngth
(è+ m_¿nge_šfo.
’d_row
.length() + 2);

251 
¿nge
.
¡¬tRow
 = (cÚ¡ *)
dbuf
.
	`addNoCheck
(
m_¿nge_šfo
.
¡¬t_row
.
	`c_¡r
(), m_¿nge_šfo.¡¬t_row.
	`Ëngth
()+1);

252 
¿nge
.
’dRow
 = (cÚ¡ *)
dbuf
.
	`addNoCheck
(
m_¿nge_šfo
.
’d_row
.
	`c_¡r
(), m_¿nge_šfo.’d_row.
	`Ëngth
()+1);

253 ià(!
LoÿtiÚCache
::
	`loÿtiÚ_to_addr
(
m_¿nge_šfo
.
loÿtiÚ
.
	`c_¡r
(), 
m_cur_addr
)) {

254 
	`HT_ERRORF
("Invalid†ocation found in METADATAƒntry„ange [%s..%s] - %s",

255 
¿nge
.
¡¬tRow
,„ªge.
’dRow
, 
m_¿nge_šfo
.
loÿtiÚ
.
	`c_¡r
());

256 
throw
 
	`Exû±iÚ
(
E¼Ü
::
INVALID_METADATA
);

260 ià((
”rÜ
 = 
m_¿nge_£rv”
.
	`ü—‹_sÿÂ”
(
m_cur_addr
, 
m_bË_id’tif›r
, 
¿nge
, 
m_sÿn_¥ec
, 
m_sÿnblock
)è!ğ
E¼Ü
::
OK
)

261 
throw
 
	`Exû±iÚ
(
”rÜ
, 
¡d
::
	`¡ršg
("ProbËm c»©šg sÿÂ” oÀ"è+ 
m_bË_id’tif›r
.
Çme
 + "[" + 
¿nge
.
¡¬tRow
 + ".." +„ªge.
’dRow
 + "]");

265 ià(
m_»adah—d
 && !
m_sÿnblock
.
	`eos
()) {

266 ià((
”rÜ
 = 
m_¿nge_£rv”
.
	`ãtch_sÿnblock
(
m_cur_addr
, 
m_sÿnblock
.
	`g‘_sÿÂ”_id
(), &
m_sync_hªdËr
)è!ğ
E¼Ü
::
OK
)

267 
throw
 
	`Exû±iÚ
(
”rÜ
);

268 
m_ãtch_out¡ªdšg
 = 
Œue
;

271 
m_ãtch_out¡ªdšg
 = 
çl£
;

272 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/TableScanner.h

21 #iâdeà
HYPERTABLE_TABLESCANNER_H


22 
	#HYPERTABLE_TABLESCANNER_H


	)

24 
	~"CommÚ/Prİ”t›s.h
"

25 
	~"CommÚ/Reã»nûCouÁ.h
"

27 
	~"AsyncComm/Di¥©chHªdËrSynchrÚiz”.h
"

29 
	~"C–l.h
"

30 
	~"RªgeLoÿtÜ.h
"

31 
	~"RªgeS”v”Cl›Á.h
"

32 
	~"SÿnBlock.h
"

33 
	~"Schema.h
"

34 
	~"Ty³s.h
"

36 
Çme¥aû
 
	gHy³¹abË
 {

38 şas 
	cTabËSÿÂ”
 : 
public
 
Reã»nûCouÁ
 {

40 
public
:

41 
TabËSÿÂ”
(
Prİ”t›sPŒ
 &
´İs_±r
, 
Comm
 *
comm
, 
TabËId’tif›rT
 *
bË_id’tif›r
, 
SchemaPŒ
 &
schema_±r
, 
RªgeLoÿtÜPŒ
 &
¿nge_loÿtÜ_±r
, 
SÿnS³cifiÿtiÚT
 &
sÿn_¥ec
);

42 
	gvœtu®
 ~
TabËSÿÂ”
();

44 
boŞ
 
Ãxt
(
C–lT
 &
ûÎ
);

46 
	g´iv©e
:

48 
fšd_¿nge_ªd_¡¬t_sÿn
(cÚ¡ *
row_key
);

50 
Comm
 *
	gm_comm
;

51 
SchemaPŒ
 
	gm_schema_±r
;

52 
RªgeLoÿtÜPŒ
 
	gm_¿nge_loÿtÜ_±r
;

53 
SÿnS³cifiÿtiÚT
 
	gm_sÿn_¥ec
;

54 
RªgeS”v”Cl›Á
 
	gm_¿nge_£rv”
;

55 
	g¡d
::
¡ršg
 
m_bË_Çme
;

56 
TabËId’tif›rT
 
	gm_bË_id’tif›r
;

57 
boŞ
 
	gm_¡¬‹d
;

58 
boŞ
 
	gm_eos
;

59 
SÿnBlock
 
	gm_sÿnblock
;

60 
	g¡d
::
¡ršg
 
m_cur_row
;

61 
RªgeLoÿtiÚInfo
 
	gm_¿nge_šfo
;

62 
sockaddr_š
 
	gm_cur_addr
;

63 
boŞ
 
	gm_»adah—d
;

64 
boŞ
 
	gm_ãtch_out¡ªdšg
;

65 
Di¥©chHªdËrSynchrÚiz”
 
	gm_sync_hªdËr
;

66 
Ev’tPŒ
 
	gm_ev’t_±r
;

67 
ušt32_t
 
	gm_rows_£’
;

69 
	gboo¡
::
	tšŒusive_±r
<
	tTabËSÿÂ”
> 
	tTabËSÿÂ”PŒ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/TestData.h

21 #iâdeà
HYPERTABLE_TESTDATA_H


22 
	#HYPERTABLE_TESTDATA_H


	)

24 
	~<boo¡/sh¬ed_¬¿y.hµ
>

26 
	~"CommÚ/FeUts.h
"

27 
	~"CommÚ/Logg”.h
"

28 
	~"CommÚ/Te¡H¬Ãss.h
"

30 
Çme¥aû
 
	gHy³¹abË
 {

32 
	gboo¡
::
	tsh¬ed_¬¿y
<cÚ¡ > 
	tCh¬PŒ
;

34 şas 
	cTe¡D©a
 {

35 
	gpublic
:

36 
boŞ
 
lßd
(
¡d
::
¡ršg
 
d©aDœ
) {

37 
¡©
 
¡©buf
;

38 *
	gcÚ‹ÁD©a
, *
	gwÜdD©a
, *
	gu¾D©a
;

39 *
	gba£
, *
	g±r
, *
	gÏ¡
, *
	g¡r
;

40 
off_t
 
	gËn
;

41 
	g¡d
::
¡ršg
 
shake¥—»Fe
 = 
d©aDœ
 + "/shakespeare.txt";

42 
	g¡d
::
¡ršg
 
shake¥—»FeGz
 = 
d©aDœ
 + "/shakespeare.txt.gz";

43 
	g¡d
::
¡ršg
 
wÜdsFe
 = 
d©aDœ
 + "/words";

44 
	g¡d
::
¡ršg
 
wÜdsFeGz
 = 
d©aDœ
 + "/words.gz";

45 
	g¡d
::
¡ršg
 
u¾sFe
 = 
d©aDœ
 + "/urls.txt";

46 
	g¡d
::
¡ršg
 
u¾sFeGz
 = 
d©aDœ
 + "/urls.txt.gz";

47 
	g¡d
::
¡ršg
 
sy¡emCommªd
;

52 ià(
¡©
(
shake¥—»Fe
.
c_¡r
(), &
¡©buf
) != 0) {

53 ià(
¡©
(
shake¥—»FeGz
.
c_¡r
(), &
¡©buf
) != 0) {

54 
HT_ERRORF
("UÇbËØ¡© f'shake¥—».txt.gz' : %s", 
¡»¼Ü
(
”ºo
));

55  
	gçl£
;

57 
	gsy¡emCommªd
 = "zÿˆ" + 
shake¥—»FeGz
 + " > " + 
shake¥—»Fe
;

58 ià(
sy¡em
(
sy¡emCommªd
.
c_¡r
())) {

59 
HT_ERRORF
("UÇbËØdecom´es f'%s'", 
shake¥—»FeGz
.
c_¡r
());

60  
	gçl£
;

62 ià(
¡©
(
shake¥—»Fe
.
c_¡r
(), &
¡©buf
) != 0) {

63 
HT_ERRORF
("UÇbËØ¡© f'%s' : %s", 
shake¥—»Fe
.
c_¡r
(), 
¡»¼Ü
(
”ºo
));

64  
	gçl£
;

67 ià((
	gcÚ‹ÁD©a
 = 
FeUts
::
fe_to_bufãr
(
shake¥—»Fe
.
c_¡r
(), &
Ën
)) == 0)

68  
çl£
;

69 
	gba£
 = 
cÚ‹ÁD©a
;

70 (
	g±r
 = 
¡r¡r
(
ba£
, "\n\n")) != 0) {

71 *
±r
++ = 0;

72 
	g¡r
 = 
Ãw
 [ 
¡¾’
(
ba£
) + 1 ];

73 
¡rıy
(
¡r
, 
ba£
);

74 
	gcÚ‹Á
.
push_back
(
Ch¬PŒ
(
¡r
));

75 
	gba£
 = 
±r
 + 2;

78 
	gd–‘e
 [] 
	gcÚ‹ÁD©a
;

83 ià(
¡©
(
wÜdsFe
.
c_¡r
(), &
¡©buf
) != 0) {

84 ià(
¡©
(
wÜdsFeGz
.
c_¡r
(), &
¡©buf
) != 0) {

85 
HT_ERRORF
("UÇbËØ¡© f'%s' : %s", 
wÜdsFeGz
.
c_¡r
(), 
¡»¼Ü
(
”ºo
));

86  
	gçl£
;

88 
	gsy¡emCommªd
 = "zÿˆ" + 
wÜdsFeGz
 + " > " + 
wÜdsFe
;

89 ià(
sy¡em
(
sy¡emCommªd
.
c_¡r
())) {

90 
HT_ERRORF
("UÇbËØdecom´es f'%s'", 
wÜdsFeGz
.
c_¡r
());

91  
	gçl£
;

93 ià(
¡©
(
wÜdsFe
.
c_¡r
(), &
¡©buf
) != 0) {

94 
HT_ERRORF
("UÇbËØ¡© f'%s' : %s", 
wÜdsFe
.
c_¡r
(), 
¡»¼Ü
(
”ºo
));

95  
	gçl£
;

98 ià((
	gwÜdD©a
 = 
FeUts
::
fe_to_bufãr
(
wÜdsFe
.
c_¡r
(), &
Ën
)) == 0)

99  
çl£
;

100 
	gba£
 = 
¡¹ok_r
(
wÜdD©a
, "\n\r", &
Ï¡
);

101 
	gba£
) {

102 
	g¡r
 = 
Ãw
 [ 
¡¾’
(
ba£
) + 1 ];

103 
¡rıy
(
¡r
, 
ba£
);

104 
	gwÜds
.
push_back
(
Ch¬PŒ
(
¡r
));

105 
	gba£
 = 
¡¹ok_r
(0, "\n\r", &
Ï¡
);

107 
	gd–‘e
 [] 
	gwÜdD©a
;

113 ià(
¡©
(
u¾sFe
.
c_¡r
(), &
¡©buf
) != 0) {

114 ià(
¡©
(
u¾sFeGz
.
c_¡r
(), &
¡©buf
) != 0) {

115 
HT_ERRORF
("UÇbËØ¡© f'u¾s.txt.gz' : %s", 
¡»¼Ü
(
”ºo
));

116  
	gçl£
;

118 
	gsy¡emCommªd
 = "zÿˆ" + 
u¾sFeGz
 + " > " + 
u¾sFe
;

119 ià(
sy¡em
(
sy¡emCommªd
.
c_¡r
())) {

120 
HT_ERRORF
("UÇbËØdecom´es f'%s'", 
u¾sFeGz
.
c_¡r
());

121  
	gçl£
;

123 ià(
¡©
(
u¾sFe
.
c_¡r
(), &
¡©buf
) != 0) {

124 
HT_ERRORF
("UÇbËØ¡© f'%s' : %s", 
u¾sFe
.
c_¡r
(), 
¡»¼Ü
(
”ºo
));

125  
	gçl£
;

128 ià((
	gu¾D©a
 = 
FeUts
::
fe_to_bufãr
(
u¾sFe
.
c_¡r
(), &
Ën
)) == 0)

129  
çl£
;

130 
	gba£
 = 
¡¹ok_r
(
u¾D©a
, "\n\r", &
Ï¡
);

131 
	gba£
) {

132 
	g¡r
 = 
Ãw
 [ 
¡¾’
(
ba£
) + 1 ];

133 
¡rıy
(
¡r
, 
ba£
);

134 
	gu¾s
.
push_back
(
Ch¬PŒ
(
¡r
));

135 
	gba£
 = 
¡¹ok_r
(0, "\n\r", &
Ï¡
);

138  
	gŒue
;

141 
	gveùÜ
<
	gCh¬PŒ
> 
	gcÚ‹Á
;

142 
	gveùÜ
<
	gCh¬PŒ
> 
	gwÜds
;

143 
	gveùÜ
<
	gCh¬PŒ
> 
	gu¾s
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/TestSource.cc

21 
	~<û¼no
>

22 
	~<c¡ršg
>

24 
	~<boo¡/®gÜ™hm/¡ršg.hµ
>

25 
	~<boo¡/sh¬ed_¬¿y.hµ
>

28 
	~<¡ršgs.h
>

31 
	~"CommÚ/By‹Ord”.h
"

32 
	~"CommÚ/DyÇmicBufãr.h
"

34 
	~"Key.h
"

36 
	~"Te¡Sourû.h
"

38 
usšg
 
Çme¥aû
 
¡d
;

40 
boŞ
 
	gTe¡Sourû
::
	$Ãxt
(
By‹SŒšg32T
 **
keyp
, By‹SŒšg32T **
v®u•
) {

41 
¡ršg
 
lše
;

42 
boo¡
::
sh¬ed_¬¿y
<> 
lšePŒ
;

43 *
ba£
, *
±r
, *
Ï¡
;

44 *
rowKey
;

45 *
cŞumn
;

46 *
v®ue
;

47 
ušt64_t
 
time¡amp
;

49 
	`g‘lše
(
m_fš
, 
lše
)) {

50 
m_cur_lše
++;

52 
boo¡
::
	`Œim
(
lše
);

54 
lšePŒ
.
	`»£t
(
Ãw
 [ 
	`¡¾’
(
lše
.
	`c_¡r
()) + 1 ]);

55 
ba£
 = 
lšePŒ
.
	`g‘
();

56 
	`¡rıy
(
ba£
, 
lše
.
	`c_¡r
());

58 ià((
±r
 = 
	`¡¹ok_r
(
ba£
, "\t", &
Ï¡
)) == 0) {

59 
û¼
 << "M®-fÜmed iÅuˆÚ†š" << (
m_cur_lše
-1è<< 
’dl
;

63 ià(!
	`¡rÿ£cmp
(
±r
, "AUTO")) {

64 
time¡amp
 = 0;

67 
time¡amp
 = 
	`¡¹Şl
(
±r
, 0, 0);

68 ià(
time¡amp
 =ğ0 && 
”ºo
 =ğ
EINVAL
) {

69 
û¼
 << "Inv®idime¡am°(" << 
±r
 << "èÚ†š" << (
m_cur_lše
-1è<< 
’dl
;

72 ià(
m_mš_time¡amp
 =ğ0 || 
time¡amp
 < m_min_timestamp)

73 
m_mš_time¡amp
 = 
time¡amp
;

76 ià((
rowKey
 = 
	`¡¹ok_r
(0, "\t", &
Ï¡
)) == 0) {

77 
û¼
 << "M®-fÜmed iÅuˆÚ†š" << (
m_cur_lše
-1è<< 
’dl
;

84 
size_t
 
row_key_Ën
 = 
	`¡¾’
(
rowKey
);

85 ià(
row_key_Ën
 >= 2) {

86 ià(!
	`¡rcmp
(&
rowKey
[
row_key_Ën
-2], "??")) {

87 
rowKey
[
row_key_Ën
-1] = ()0xff;

88 
rowKey
[
row_key_Ën
-2] = ()0xff;

92 ià((
cŞumn
 = 
	`¡¹ok_r
(0, "\t", &
Ï¡
)) == 0) {

93 
û¼
 << "M®-fÜmed iÅuˆÚ†š" << (
m_cur_lše
-1è<< 
’dl
;

97 ià(!
	`¡rcmp
(
cŞumn
, "DELETE")) {

98 ià(!
	`ü—‹_row_d–‘e
(
rowKey
, 
time¡amp
, 
keyp
, 
v®u•
)) {

99 
û¼
 << "M®-fÜmed iÅuˆÚ†š" << (
m_cur_lše
-1è<< 
’dl
;

102  
Œue
;

105 ià((
v®ue
 = 
	`¡¹ok_r
(0, "\t", &
Ï¡
)) == 0)

106 
v®ue
 = "";

108 ià(!
	`¡rcmp
(
v®ue
, "DELETE")) {

109 ià(!
	`ü—‹_cŞumn_d–‘e
(
rowKey
, 
cŞumn
, 
time¡amp
, 
keyp
, 
v®u•
)) {

110 
û¼
 << "M®-fÜmed iÅuˆÚ†š" << (
m_cur_lše
-1è<< 
’dl
;

113  
Œue
;

116 
row_key_Ën
 = 
	`¡¾’
(
v®ue
);

117 ià(
row_key_Ën
 >= 2) {

118 ià(!
	`¡rcmp
(&
v®ue
[
row_key_Ën
-2], "??")) {

119 
v®ue
[
row_key_Ën
-1] = ()0xff;

120 
v®ue
[
row_key_Ën
-2] = ()0xff;

121 
û¼
 << "cÚv”tšgƒnd oàv®u(" << 
v®ue
 << ")" << 
’dl
;

125 ià(!
	`ü—‹_š£¹
(
rowKey
, 
cŞumn
, 
time¡amp
, 
v®ue
, 
keyp
, 
v®u•
)) {

126 
û¼
 << "M®-fÜmed iÅuˆÚ†š" << (
m_cur_lše
-1è<< 
’dl
;

130  
Œue
;

133  
çl£
;

134 
	}
}

137 
boŞ
 
	gTe¡Sourû
::
	$ü—‹_row_d–‘e
(cÚ¡ *
row
, 
ušt64_t
 
time¡amp
, 
By‹SŒšg32T
 **
keyp
, By‹SŒšg32T **
v®u•
) {

138 
št32_t
 
keyL’
 = 
	`¡¾’
(
row
) + 12;

139 
št32_t
 
v®ueL’
 = 0;

141 
m_key_bufãr
.
	`ş—r
();

142 
m_key_bufãr
.
	`’su»
((
št32_t
)+
keyL’
);

144 
m_key_bufãr
.
	`addNoCheck
(&
keyL’
, (
št32_t
));

145 
m_key_bufãr
.
	`addNoCheck
(
row
, 
	`¡¾’
(row)+1);

146 *
m_key_bufãr
.
±r
++ = 0;

147 *
m_key_bufãr
.
±r
++ = 0;

148 *
m_key_bufãr
.
±r
++ = 
FLAG_DELETE_ROW
;

150 
time¡amp
 = 
	`By‹Ord”Sw­IÁ64
(timestamp);

151 
time¡amp
 = ~timestamp;

152 
m_key_bufãr
.
	`addNoCheck
(&
time¡amp
, (timestamp));

153 *
keyp
 = (
By‹SŒšg32T
 *)
m_key_bufãr
.
buf
;

155 
m_v®ue_bufãr
.
	`ş—r
();

156 
m_v®ue_bufãr
.
	`’su»
((
št32_t
));

157 
m_v®ue_bufãr
.
	`addNoCheck
(&
v®ueL’
, (
št32_t
));

158 *
v®u•
 = (
By‹SŒšg32T
 *)
m_v®ue_bufãr
.
buf
;

159  
Œue
;

160 
	}
}

163 
boŞ
 
	gTe¡Sourû
::
	$ü—‹_cŞumn_d–‘e
(cÚ¡ *
row
, cÚ¡ *
cŞumn
, 
ušt64_t
 
time¡amp
, 
By‹SŒšg32T
 **
keyp
, By‹SŒšg32T **
v®u•
) {

164 
št32_t
 
keyL’
 = 0;

165 
št32_t
 
v®ueL’
 = 0;

166 
¡ršg
 
cŞumnFamy
;

167 cÚ¡ *
qu®if›r
;

168 cÚ¡ *
±r
 = 
	`¡rchr
(
cŞumn
, ':');

170 ià(
±r
 == 0) {

171 
û¼
 << "Bad cŞumÀçmy s³cif›¸ÒØçmy)" << 
’dl
;

172  
çl£
;

175 
cŞumnFamy
 = 
	`¡ršg
(
cŞumn
, 
±r
-column);

176 
qu®if›r
 = 
±r
+1;

178 
Schema
::
CŞumnFamy
 *
cf
 = 
m_schema
->
	`g‘_cŞumn_çmy
(
cŞumnFamy
);

179 ià(
cf
 == 0) {

180 
û¼
 << "CŞumÀçmy '" << 
cŞumnFamy
 << "'‚Ù found iÀschema" << 
’dl
;

181  
çl£
;

184 
m_key_bufãr
.
	`ş—r
();

185 
keyL’
 = 
	`¡¾’
(
row
è+ sŒËn(
qu®if›r
) + 12;

186 
m_key_bufãr
.
	`’su»
((
št32_t
)+
keyL’
);

188 
m_key_bufãr
.
	`addNoCheck
(&
keyL’
, (
št32_t
));

189 
m_key_bufãr
.
	`addNoCheck
(
row
, 
	`¡¾’
(row)+1);

190 *
m_key_bufãr
.
±r
++ = 
cf
->
id
;

191 
m_key_bufãr
.
	`addNoCheck
(
qu®if›r
, 
	`¡¾’
(qualifier)+1);

192 *
m_key_bufãr
.
±r
++ = 
FLAG_DELETE_CELL
;

194 
time¡amp
 = 
	`By‹Ord”Sw­IÁ64
(timestamp);

195 
time¡amp
 = ~timestamp;

196 
m_key_bufãr
.
	`addNoCheck
(&
time¡amp
, (timestamp));

197 *
keyp
 = (
By‹SŒšg32T
 *)
m_key_bufãr
.
buf
;

199 
m_v®ue_bufãr
.
	`ş—r
();

200 
m_v®ue_bufãr
.
	`’su»
((
št32_t
));

201 
m_v®ue_bufãr
.
	`addNoCheck
(&
v®ueL’
, (
št32_t
));

202 *
v®u•
 = (
By‹SŒšg32T
 *)
m_v®ue_bufãr
.
buf
;

203  
Œue
;

204 
	}
}

207 
boŞ
 
	gTe¡Sourû
::
	$ü—‹_š£¹
(cÚ¡ *
row
, cÚ¡ *
cŞumn
, 
ušt64_t
 
time¡amp
, cÚ¡ *
v®ue
, 
By‹SŒšg32T
 **
keyp
, By‹SŒšg32T **
v®u•
) {

208 
št32_t
 
keyL’
 = 0;

209 
št32_t
 
v®ueL’
 = 
	`¡¾’
(
v®ue
);

210 
¡ršg
 
cŞumnFamy
;

211 cÚ¡ *
qu®if›r
;

212 cÚ¡ *
±r
 = 
	`¡rchr
(
cŞumn
, ':');

214 ià(
±r
 == 0) {

215 
û¼
 << "Bad cŞumÀçmy s³cif›¸ÒØçmy)" << 
’dl
;

216  
çl£
;

219 
cŞumnFamy
 = 
	`¡ršg
(
cŞumn
, 
±r
-column);

220 
qu®if›r
 = 
±r
+1;

222 
Schema
::
CŞumnFamy
 *
cf
 = 
m_schema
->
	`g‘_cŞumn_çmy
(
cŞumnFamy
);

223 ià(
cf
 == 0) {

224 
û¼
 << "CŞumÀçmy '" << 
cŞumnFamy
 << "'‚Ù found iÀschema" << 
’dl
;

225  
çl£
;

228 
m_key_bufãr
.
	`ş—r
();

229 
keyL’
 = 
	`¡¾’
(
row
è+ sŒËn(
qu®if›r
) + 12;

230 
m_key_bufãr
.
	`’su»
(
keyL’
+(
št32_t
));

232 
m_key_bufãr
.
	`addNoCheck
(&
keyL’
, (
št32_t
));

233 
m_key_bufãr
.
	`addNoCheck
(
row
, 
	`¡¾’
(row)+1);

234 *
m_key_bufãr
.
±r
++ = 
cf
->
id
;

235 
m_key_bufãr
.
	`addNoCheck
(
qu®if›r
, 
	`¡¾’
(qualifier)+1);

236 *
m_key_bufãr
.
±r
++ = 
FLAG_INSERT
;

238 
time¡amp
 = 
	`By‹Ord”Sw­IÁ64
(timestamp);

239 
time¡amp
 = ~timestamp;

240 
m_key_bufãr
.
	`addNoCheck
(&
time¡amp
, (timestamp));

241 *
keyp
 = (
By‹SŒšg32T
 *)
m_key_bufãr
.
buf
;

243 
m_v®ue_bufãr
.
	`ş—r
();

244 
m_v®ue_bufãr
.
	`’su»
((
št32_t
è+ 
v®ueL’
);

245 
m_v®ue_bufãr
.
	`addNoCheck
(&
v®ueL’
, (
št32_t
));

246 
m_v®ue_bufãr
.
	`addNoCheck
(
v®ue
, 
v®ueL’
);

247 *
v®u•
 = (
By‹SŒšg32T
 *)
m_v®ue_bufãr
.
buf
;

248  
Œue
;

249 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/TestSource.h

21 #iâdeà
HYPERTABLE_TESTSOURCE_H


22 
	#HYPERTABLE_TESTSOURCE_H


	)

24 
	~<f¡»am
>

25 
	~<io¡»am
>

26 
	~<¡ršg
>

28 
	~"CommÚ/By‹SŒšg.h
"

29 
	~"CommÚ/DyÇmicBufãr.h
"

30 
	~"Hy³¹abË/Lib/Schema.h
"

32 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

34 
Çme¥aû
 
	gHy³¹abË
 {

36 şas 
	cTe¡Sourû
 {

38 
	gpublic
:

39 
Te¡Sourû
(
¡d
::
¡ršg
 &
âame
, 
Schema
 *
schema
è: 
m_schema
(schema), 
m_fš
(âame.
c_¡r
()), 
m_cur_lše
(0), 
m_key_bufãr
(0), 
m_v®ue_bufãr
(0), 
m_mš_time¡amp
(0) {

43 
boŞ
 
Ãxt
(
By‹SŒšg32T
 **
keyp
, By‹SŒšg32T **
v®u•
);

44 
ş—r_mš_time¡amp
(è{ 
	gm_mš_time¡amp
 = 0; }

45 
ušt64_t
 
g‘_mš_time¡amp
(è{  
	gm_mš_time¡amp
; }

47 
	g´iv©e
:

48 
boŞ
 
ü—‹_row_d–‘e
(cÚ¡ *
row
, 
ušt64_t
 
time¡amp
, 
By‹SŒšg32T
 **
keyp
, By‹SŒšg32T **
v®u•
);

49 
boŞ
 
ü—‹_cŞumn_d–‘e
(cÚ¡ *
row
, cÚ¡ *
cŞumn
, 
ušt64_t
 
time¡amp
, 
By‹SŒšg32T
 **
keyp
, By‹SŒšg32T **
v®u•
);

50 
boŞ
 
ü—‹_š£¹
(cÚ¡ *
row
, cÚ¡ *
cŞumn
, 
ušt64_t
 
time¡amp
, cÚ¡ *
v®ue
, 
By‹SŒšg32T
 **
keyp
, By‹SŒšg32T **
v®u•
);

52 
Schema
 *
	gm_schema
;

53 
if¡»am
 
	gm_fš
;

54 
	gm_cur_lše
;

55 
DyÇmicBufãr
 
	gm_key_bufãr
;

56 
DyÇmicBufãr
 
	gm_v®ue_bufãr
;

57 
ušt64_t
 
	gm_mš_time¡amp
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/Types.cc

21 
	~<c¡ršg
>

22 
	~<io¡»am
>

24 
	~"AsyncComm/CommBuf.h
"

25 
	~"AsyncComm/S”Ÿliz©iÚ.h
"

27 
	~"Ty³s.h
"

29 
usšg
 
Çme¥aû
 
	g¡d
;

31 
Çme¥aû
 
	gHy³¹abË
 {

33 
Cİy
(
TabËId’tif›rT
 &
¤c
, TabËId’tif›rT &
d¡
) {

34 
memıy
(&
d¡
, &
¤c
, (
TabËId’tif›rT
));

35 
	gd¡
.
	gÇme
 = 
Ãw
 [ 
¡¾’
(
¤c
.
Çme
) + 1 ];

36 
¡rıy
((*)
d¡
.
Çme
, 
¤c
.name);

41 
size_t
 
EncodedL’gthTabËId’tif›r
(
TabËId’tif›rT
 &
bË_id’tif›r
) {

42  8 + 
	gS”Ÿliz©iÚ
::
’coded_Ëngth_¡ršg
(
bË_id’tif›r
.
Çme
);

46 
EncodeTabËId’tif›r
(
ušt8_t
 **
bufPŒ
, 
TabËId’tif›rT
 &
bË_id’tif›r
) {

47 
	gS”Ÿliz©iÚ
::
’code_¡ršg
(
bufPŒ
, 
bË_id’tif›r
.
Çme
);

48 
	gS”Ÿliz©iÚ
::
’code_št
(
bufPŒ
, 
bË_id’tif›r
.
id
);

49 
	gS”Ÿliz©iÚ
::
’code_št
(
bufPŒ
, 
bË_id’tif›r
.
g’”©iÚ
);

53 
boŞ
 
DecodeTabËId’tif›r
(
ušt8_t
 **
bufPŒ
, 
size_t
 *
»maššgPŒ
, 
TabËId’tif›rT
 *
bË_id’tif›r
) {

54 
mem£t
(
bË_id’tif›r
, 0, (
TabËId’tif›rT
));

55 ià(!
	gS”Ÿliz©iÚ
::
decode_¡ršg
(
bufPŒ
, 
»maššgPŒ
, &
bË_id’tif›r
->
Çme
))

56  
	gçl£
;

57 ià(!
	gS”Ÿliz©iÚ
::
decode_št
(
bufPŒ
, 
»maššgPŒ
, &
bË_id’tif›r
->
id
))

58  
	gçl£
;

59 ià(!
	gS”Ÿliz©iÚ
::
decode_št
(
bufPŒ
, 
»maššgPŒ
, &
bË_id’tif›r
->
g’”©iÚ
))

60  
	gçl£
;

61  
	gŒue
;

65 
size_t
 
EncodedL’gthRªge
(
RªgeT
 &
¿nge
) {

66  
	gS”Ÿliz©iÚ
::
’coded_Ëngth_¡ršg
(
¿nge
.
¡¬tRow
è+ 
S”Ÿliz©iÚ
::’coded_Ëngth_¡ršgÔªge.
’dRow
);

70 
EncodeRªge
(
ušt8_t
 **
bufPŒ
, 
RªgeT
 &
¿nge
) {

71 
	gS”Ÿliz©iÚ
::
’code_¡ršg
(
bufPŒ
, 
¿nge
.
¡¬tRow
);

72 
	gS”Ÿliz©iÚ
::
’code_¡ršg
(
bufPŒ
, 
¿nge
.
’dRow
);

76 
boŞ
 
DecodeRªge
(
ušt8_t
 **
bufPŒ
, 
size_t
 *
»maššgPŒ
, 
RªgeT
 *
¿nge
) {

77 
mem£t
(
¿nge
, 0, (
RªgeT
));

78 ià(!
	gS”Ÿliz©iÚ
::
decode_¡ršg
(
bufPŒ
, 
»maššgPŒ
, &
¿nge
->
¡¬tRow
))

79  
	gçl£
;

80 ià(!
	gS”Ÿliz©iÚ
::
decode_¡ršg
(
bufPŒ
, 
»maššgPŒ
, &
¿nge
->
’dRow
))

81  
	gçl£
;

82  
	gŒue
;

89 
size_t
 
EncodedL’gthSÿnS³cifiÿtiÚ
(
SÿnS³cifiÿtiÚT
 &
sÿnS³c
) {

90 
size_t
 
	gËn
 = 29;

91 
	gËn
 +ğ
S”Ÿliz©iÚ
::
’coded_Ëngth_¡ršg
(
sÿnS³c
.
¡¬tRow
);

92 
	gËn
 +ğ
S”Ÿliz©iÚ
::
’coded_Ëngth_¡ršg
(
sÿnS³c
.
’dRow
);

93 
size_t
 
	gi
=0; i<
	gsÿnS³c
.
	gcŞumns
.
size
(); i++)

94 
	gËn
 +ğ
S”Ÿliz©iÚ
::
’coded_Ëngth_¡ršg
(
sÿnS³c
.
cŞumns
[
i
]);

95  
	gËn
;

99 
EncodeSÿnS³cifiÿtiÚ
(
ušt8_t
 **
bufPŒ
, 
SÿnS³cifiÿtiÚT
 &
sÿnS³c
) {

100 
	gS”Ÿliz©iÚ
::
’code_št
(
bufPŒ
, 
sÿnS³c
.
rowLim™
);

101 
	gS”Ÿliz©iÚ
::
’code_št
(
bufPŒ
, 
sÿnS³c
.
max_v”siÚs
);

102 
	gS”Ÿliz©iÚ
::
’code_¡ršg
(
bufPŒ
, 
sÿnS³c
.
¡¬tRow
);

103 *(*
	gbufPŒ
)++ = (
ušt8_t
)
sÿnS³c
.
¡¬tRowInşusive
;

104 
	gS”Ÿliz©iÚ
::
’code_¡ršg
(
bufPŒ
, 
sÿnS³c
.
’dRow
);

105 *(*
	gbufPŒ
)++ = (
ušt8_t
)
sÿnS³c
.
’dRowInşusive
;

106 
	gS”Ÿliz©iÚ
::
’code_shÜt
(
bufPŒ
, ()
sÿnS³c
.
cŞumns
.
size
());

107 
size_t
 
	gi
=0; i<
	gsÿnS³c
.
	gcŞumns
.
size
(); i++)

108 
	gS”Ÿliz©iÚ
::
’code_¡ršg
(
bufPŒ
, 
sÿnS³c
.
cŞumns
[
i
]);

109 
	gS”Ÿliz©iÚ
::
’code_lÚg
(
bufPŒ
, 
sÿnS³c
.
š‹rv®
.
fœ¡
);

110 
	gS”Ÿliz©iÚ
::
’code_lÚg
(
bufPŒ
, 
sÿnS³c
.
š‹rv®
.
£cÚd
);

111 
	gS”Ÿliz©iÚ
::
’code_boŞ
(
bufPŒ
, 
sÿnS³c
.
»tuº_d–‘es
);

115 
boŞ
 
DecodeSÿnS³cifiÿtiÚ
(
ušt8_t
 **
bufPŒ
, 
size_t
 *
»maššgPŒ
, 
SÿnS³cifiÿtiÚT
 *
sÿnS³c
) {

116 
ušt16_t
 
	gcŞumnCouÁ
;

117 cÚ¡ *
	gcŞumn
;

118 
ušt8_t
 
	gšşusiveBy‹
;

120 ià(!
	gS”Ÿliz©iÚ
::
decode_št
(
bufPŒ
, 
»maššgPŒ
, &
sÿnS³c
->
rowLim™
))

121  
	gçl£
;

122 ià(!
	gS”Ÿliz©iÚ
::
decode_št
(
bufPŒ
, 
»maššgPŒ
, &
sÿnS³c
->
max_v”siÚs
))

123  
	gçl£
;

124 ià(!
	gS”Ÿliz©iÚ
::
decode_¡ršg
(
bufPŒ
, 
»maššgPŒ
, &
sÿnS³c
->
¡¬tRow
))

125  
	gçl£
;

126 ià(!
	gS”Ÿliz©iÚ
::
decode_by‹
(
bufPŒ
, 
»maššgPŒ
, &
šşusiveBy‹
))

127  
	gçl£
;

128 
	gsÿnS³c
->
	g¡¬tRowInşusive
 = 
šşusiveBy‹
 ? 
Œue
 : 
çl£
;

129 ià(!
	gS”Ÿliz©iÚ
::
decode_¡ršg
(
bufPŒ
, 
»maššgPŒ
, &
sÿnS³c
->
’dRow
))

130  
	gçl£
;

131 ià(!
	gS”Ÿliz©iÚ
::
decode_by‹
(
bufPŒ
, 
»maššgPŒ
, &
šşusiveBy‹
))

132  
	gçl£
;

133 
	gsÿnS³c
->
	g’dRowInşusive
 = 
šşusiveBy‹
 ? 
Œue
 : 
çl£
;

134 ià(!
	gS”Ÿliz©iÚ
::
decode_shÜt
(
bufPŒ
, 
»maššgPŒ
, &
cŞumnCouÁ
))

135  
	gçl£
;

136 
	gi
=0; i<
	gcŞumnCouÁ
; i++) {

137 ià(!
	gS”Ÿliz©iÚ
::
decode_¡ršg
(
bufPŒ
, 
»maššgPŒ
, &
cŞumn
))

138  
	gçl£
;

139 
	gsÿnS³c
->
	gcŞumns
.
push_back
(
cŞumn
);

141 ià(!
	gS”Ÿliz©iÚ
::
decode_lÚg
(
bufPŒ
, 
»maššgPŒ
, &
sÿnS³c
->
š‹rv®
.
fœ¡
))

142  
	gçl£
;

143 ià(!
	gS”Ÿliz©iÚ
::
decode_lÚg
(
bufPŒ
, 
»maššgPŒ
, &
sÿnS³c
->
š‹rv®
.
£cÚd
))

144  
	gçl£
;

145 ià(!
	gS”Ÿliz©iÚ
::
decode_boŞ
(
bufPŒ
, 
»maššgPŒ
, &
sÿnS³c
->
»tuº_d–‘es
))

146  
	gçl£
;

148  
	gŒue
;

152 
	g¡d
::
o¡»am
 &
İ”©Ü
<<(
¡d
::o¡»am &
os
, cÚ¡ 
	gTabËId’tif›rT
 &
	gbË_id’tif›r
) {

153 
	gos
 << "TabË Namğ" << 
	gbË_id’tif›r
.
	gÇme
 << 
	g’dl
;

154 
	gos
 << "TabË ID = " << 
	gbË_id’tif›r
.
	gid
 << 
	g’dl
;

155 
	gos
 << "G’”©iÚ = " << 
	gbË_id’tif›r
.
	gg’”©iÚ
 << 
	g’dl
;

156  
	gos
;

159 
	g¡d
::
o¡»am
 &
İ”©Ü
<<(
¡d
::o¡»am &
os
, cÚ¡ 
	gRªgeT
 &
	g¿nge
) {

160 ià(
	g¿nge
.
	g¡¬tRow
 == 0)

161 
os
 << "S¹Row = [NULL]" << 
’dl
;

163 
	gos
 << "S¹Row = \"" << 
	g¿nge
.
	g¡¬tRow
 << "\"" << 
	g’dl
;

164 ià(
	g¿nge
.
	g’dRow
 == 0)

165 
os
 << "EndRow = [NULL]" << 
’dl
;

167 
	gos
 << "EndRow = \"" << 
	g¿nge
.
	g’dRow
 << "\"" << 
	g’dl
;

168  
	gos
;

171 
	g¡d
::
o¡»am
 &
İ”©Ü
<<(
¡d
::o¡»am &
os
, cÚ¡ 
	gSÿnS³cifiÿtiÚT
 &
	gsÿnS³c
) {

172 
	gos
 << "RowLim™ = " << 
	gsÿnS³c
.
	growLim™
 << 
	g’dl
;

173 
	gos
 << "MaxV”siÚ ğ" << 
	gsÿnS³c
.
	gmax_v”siÚs
 << 
	g’dl
;

174 
	gos
 << "Columns = ";

175 
	g¡d
::
veùÜ
<cÚ¡ *>::
cÚ¡_™”©Ü
 
™”
 = 
sÿnS³c
.
cŞumns
.
begš
(); 
	g™”
 !ğsÿnS³c.cŞumns.
’d
(); iter++)

176 
	gos
 << *
	g™”
 << " ";

177 
	gos
 << 
	g’dl
;

178 ià(
	gsÿnS³c
.
	g¡¬tRow
)

179 
	gos
 << "S¹Row = " << 
	gsÿnS³c
.
	g¡¬tRow
 << 
	g’dl
;

181 
	gos
 << "S¹Row = " << 
	g’dl
;

182 
	gos
 << "S¹RowInşusivğ" << 
	gsÿnS³c
.
	g¡¬tRowInşusive
 << 
	g’dl
;

183 ià(
	gsÿnS³c
.
	g’dRow
)

184 
	gos
 << "EndRow = " << 
	gsÿnS³c
.
	g’dRow
 << 
	g’dl
;

186 
	gos
 << "EndRow = " << 
	g’dl
;

187 
	gos
 << "EndRowInşusivğ" << 
	gsÿnS³c
.
	g’dRowInşusive
 << 
	g’dl
;

188 
	gos
 << "MšTim = " << 
	gsÿnS³c
.
	gš‹rv®
.
	gfœ¡
 << 
	g’dl
;

189 
	gos
 << "MaxTim = " << 
	gsÿnS³c
.
	gš‹rv®
.
	g£cÚd
 << 
	g’dl
;

190  
	gos
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/Types.h

21 #iâdeà
HYPERTABLE_TYPES_H


22 
	#HYPERTABLE_TYPES_H


	)

24 
	~<ut™y
>

25 
	~<veùÜ
>

28 
	~<¡ddef.h
>

29 
	~<¡dšt.h
>

32 
	~"CommÚ/By‹SŒšg.h
"

34 
Çme¥aû
 
Hy³¹abË
 {

38 cÚ¡ *
Çme
;

39 
ušt32_t
 
id
;

40 
ušt32_t
 
g’”©iÚ
;

41 } 
	tTabËId’tif›rT
;

45 cÚ¡ *
¡¬tRow
;

46 cÚ¡ *
’dRow
;

47 } 
	tRªgeT
;

51 
ušt32_t
 
rowLim™
;

52 
ušt32_t
 
max_v”siÚs
;

53 
¡d
::
veùÜ
<cÚ¡ *> 
cŞumns
;

54 cÚ¡ *
¡¬tRow
;

55 
boŞ
 
¡¬tRowInşusive
;

56 cÚ¡ *
’dRow
;

57 
boŞ
 
’dRowInşusive
;

58 
¡d
::
·œ
<
ušt64_t
,ušt64_t> 
š‹rv®
;

59 
boŞ
 
»tuº_d–‘es
;

60 } 
	tSÿnS³cifiÿtiÚT
;

63 
ušt8_t
 *
buf
;

64 
št32_t
 
Ën
;

65 } 
	tBufãrT
;

67 
Cİy
(
TabËId’tif›rT
 &
¤c
, TabËId’tif›rT &
d¡
);

68 
šlše
 
F»e
(
TabËId’tif›rT
 &
id’tif›r
è{ 
d–‘e
 [] id’tif›r.
Çme
; }

75 
size_t
 
EncodedL’gthTabËId’tif›r
(
TabËId’tif›rT
 &
bË_id’tif›r
);

78 
EncodeTabËId’tif›r
(
ušt8_t
 **
bufPŒ
, 
TabËId’tif›rT
 &
bË_id’tif›r
);

81 
boŞ
 
DecodeTabËId’tif›r
(
ušt8_t
 **
bufPŒ
, 
size_t
 *
»maššgPŒ
, 
TabËId’tif›rT
 *
bË_id’tif›r
);

84 
size_t
 
EncodedL’gthRªge
(
RªgeT
 &
¿nge
);

87 
EncodeRªge
(
ušt8_t
 **
bufPŒ
, 
RªgeT
 &
¿nge
);

90 
boŞ
 
DecodeRªge
(
ušt8_t
 **
bufPŒ
, 
size_t
 *
»maššgPŒ
, 
RªgeT
 *
¿nge
);

93 
size_t
 
EncodedL’gthSÿnS³cifiÿtiÚ
(
SÿnS³cifiÿtiÚT
 &
sÿnS³c
);

96 
EncodeSÿnS³cifiÿtiÚ
(
ušt8_t
 **
bufPŒ
, 
SÿnS³cifiÿtiÚT
 &
sÿnS³c
);

99 
boŞ
 
DecodeSÿnS³cifiÿtiÚ
(
ušt8_t
 **
bufPŒ
, 
size_t
 *
»maššgPŒ
, 
SÿnS³cifiÿtiÚT
 *
sÿnS³c
);

101 
¡d
::
o¡»am
 &
İ”©Ü
<<(¡d::o¡»am &
os
, cÚ¡ 
TabËId’tif›rT
 &
bË_id’tif›r
);

103 
¡d
::
o¡»am
 &
İ”©Ü
<<(¡d::o¡»am &
os
, cÚ¡ 
RªgeT
 &
¿nge
);

105 
¡d
::
o¡»am
 &
İ”©Ü
<<(¡d::o¡»am &
os
, cÚ¡ 
SÿnS³cifiÿtiÚT
 &
sÿÂ”S³c
);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/bmz/bmz-internal.h

20 #iâdeà
BMZ_INTERNAL_H


21 
	#BMZ_INTERNAL_H


	)

23 
	~"bmz.h
"

28 
	#BMZ_HASH_MOD
 1

	)

29 
	#BMZ_HASH_MOD16X2
 2

	)

30 
	#BMZ_HASH_MASK16X2
 3

	)

31 
	#BMZ_HASH_MASK
 4

	)

32 
	#BMZ_HASH_MASK32X2
 5

	)

34 
	$HT_EXTERN
(
size_t
)

35 
	`bmz_hash_mod
(cÚ¡ *
š
, 
size_t
 
š_Ën
, size_ˆ
b
, size_ˆ
m
);

37 
	$HT_EXTERN
(
size_t
)

38 
	`bmz_hash_mod16x2
(cÚ¡ *
š
, 
size_t
 
š_Ën
, size_ˆ
b1
, size_ˆ
b2
,

39 
size_t
 
m1
, size_ˆ
m2
);

41 
	$HT_EXTERN
(
size_t
)

42 
	`bmz_hash_mask16x2
(cÚ¡ *
š
, 
size_t
 
š_Ën
, size_ˆ
b1
, size_ˆ
b2
);

44 
	$HT_EXTERN
(
size_t
)

45 
	`bmz_hash_mask
(cÚ¡ *
š
, 
size_t
 
š_Ën
, size_ˆ
b
);

47 
	$HT_EXTERN
(
size_t
)

48 
	`bmz_hash_mask32x2
(cÚ¡ *
š
, 
size_t
 
š_Ën
, size_ˆ
b1
, size_ˆ
b2
);

50 
	$HT_EXTERN
()

51 
	`bmz_check_hash_mod
(cÚ¡ *
š
, 
size_t
 
š_Ën
, size_ˆ
å_Ën
,

52 
size_t
 
b
, size_ˆ
m
);

54 
	$HT_EXTERN
()

55 
	`bmz_check_hash_mod16x2
(cÚ¡ *
š
, 
size_t
 
š_Ën
, size_ˆ
å_Ën
,

56 
size_t
 
b1
, size_ˆ
b2
, size_ˆ
m1
, size_ˆ
m2
);

58 
	$HT_EXTERN
()

59 
	`bmz_check_hash_mask16x2
(cÚ¡ *
š
, 
size_t
 
š_Ën
, size_ˆ
å_Ën
,

60 
size_t
 
b1
, size_ˆ
b2
);

62 
	$HT_EXTERN
()

63 
	`bmz_check_hash_mask
(cÚ¡ *
š
, 
size_t
 
š_Ën
, size_ˆ
å_Ën
, size_ˆ
b
);

65 
	$HT_EXTERN
()

66 
	`bmz_check_hash_mask32x2
(cÚ¡ *
š
, 
size_t
 
š_Ën
, size_ˆ
å_Ën
,

67 
size_t
 
b1
, size_ˆ
b2
);

69 
	$HT_EXTERN
()

70 
	`bmz_b’ch_hash
(cÚ¡ *
š
, 
size_t
 
š_Ën
, 
ty³
);

72 
	$HT_EXTERN
()

73 
	`bmz_b’ch_lut_mod
(cÚ¡ *
š
, 
size_t
 
š_Ën
, size_ˆ
å_Ën
, *
mem
,

74 
size_t
 
b
, size_ˆ
m
);

76 
	$HT_EXTERN
()

77 
	`bmz_b’ch_lut_mod16x2
(cÚ¡ *
š
, 
size_t
 
š_Ën
, size_ˆ
å_Ën
, *
mem
,

78 
size_t
 
b1
, size_ˆ
b2
, size_ˆ
m1
, size_ˆ
m2
);

80 
	$HT_EXTERN
()

81 
	`bmz_b’ch_lut_mask16x2
(cÚ¡ *
š
, 
size_t
 
š_Ën
, size_ˆ
å_Ën
, *
mem
,

82 
size_t
 
b1
, size_ˆ
b2
);

84 
	$HT_EXTERN
()

85 
	`bmz_b’ch_lut_mask
(cÚ¡ *
š
, 
size_t
 
š_Ën
, size_ˆ
å_Ën
, *
mem
,

86 
size_t
 
b
);

88 
	$HT_EXTERN
()

89 
	`bmz_b’ch_lut_mask32x2
(cÚ¡ *
š
, 
size_t
 
š_Ën
, size_ˆ
å_Ën
, *
mem
,

90 
size_t
 
b1
, size_ˆ
b2
);

96 
	$HT_EXTERN
()

97 
	`bmz_·ck_mod
(cÚ¡ *
š
, 
size_t
 
š_Ën
, *
out
, size_ˆ*
out_Ën_p
,

98 
size_t
 
off£t
, size_ˆ
å_Ën
, 
æags
, *
wÜk_mem
,

99 
size_t
 
b
, size_ˆ
m
);

101 
	$HT_EXTERN
()

102 
	`bmz_·ck_mod16x2
(cÚ¡ *
š
, 
size_t
 
š_Ën
, *
out
, size_ˆ*
out_Ën_p
,

103 
size_t
 
off£t
, size_ˆ
å_Ën
, 
æags
, *
wÜk_mem
,

104 
size_t
 
b1
, size_ˆ
b2
, size_ˆ
m1
, size_ˆ
m2
);

106 
	$HT_EXTERN
()

107 
	`bmz_·ck_mask16x2
(cÚ¡ *
š
, 
size_t
 
š_Ën
, *
out
, size_ˆ*
out_Ën_p
,

108 
size_t
 
off£t
, size_ˆ
å_Ën
, 
æags
, *
wÜk_mem
,

109 
size_t
 
b1
, size_ˆ
b2
);

111 
	$HT_EXTERN
()

112 
	`bmz_·ck_mask
(cÚ¡ *
š
, 
size_t
 
š_Ën
, *
out
, size_ˆ*
out_Ën_p
,

113 
size_t
 
off£t
, size_ˆ
å_Ën
, 
æags
, *
wÜk_mem
,

114 
size_t
 
b
);

116 
	$HT_EXTERN
()

117 
	`bmz_·ck_mask32x2
(cÚ¡ *
š
, 
size_t
 
š_Ën
, *
out
, size_ˆ*
out_Ën_p
,

118 
size_t
 
off£t
, size_ˆ
å_Ën
, 
æags
, *
wÜk_mem
,

119 
size_t
 
b1
, size_ˆ
b2
);

121 
	$HT_EXTERN
()

122 
	`bmz_bm_·ck_mod
(cÚ¡ *
š
, 
size_t
 
š_Ën
, *
out
, size_ˆ*
out_Ën_p
,

123 
size_t
 
off£t
, size_ˆ
å_Ën
, *
wÜk_mem
,

124 
size_t
 
b
, size_ˆ
m
);

126 
	$HT_EXTERN
()

127 
	`bmz_bm_·ck_mod16x2
(cÚ¡ *
š
, 
size_t
 
š_Ën
, *
out
, size_ˆ*
out_Ën_p
,

128 
size_t
 
off£t
, size_ˆ
å_Ën
, *
wÜk_mem
,

129 
size_t
 
b1
, size_ˆ
b2
, size_ˆ
m1
, size_ˆ
m2
);

131 
	$HT_EXTERN
()

132 
	`bmz_bm_·ck_mask16x2
(cÚ¡ *
š
, 
size_t
 
š_Ën
, *
out
,

133 
size_t
 *
out_Ën_p
, size_ˆ
off£t
, size_ˆ
å_Ën
,

134 *
wÜk_mem
, 
size_t
 
b1
, size_ˆ
b2
);

136 
	$HT_EXTERN
()

137 
	`bmz_bm_·ck_mask
(cÚ¡ *
š
, 
size_t
 
š_Ën
, *
out
, size_ˆ*
out_Ën_p
,

138 
size_t
 
off£t
, size_ˆ
å_Ën
, *
wÜk_mem
, size_ˆ
b
);

140 
	$HT_EXTERN
()

141 
	`bmz_bm_·ck_mask32x2
(cÚ¡ *
š
, 
size_t
 
š_Ën
, *
out
,

142 
size_t
 *
out_Ën_p
, size_ˆ
off£t
, size_ˆ
å_Ën
,

143 *
wÜk_mem
, 
size_t
 
b1
, size_ˆ
b2
);

145 
	$HT_EXTERN
(
size_t
)

146 
	`bmz_bm_·ck_wÜkËn
(
size_t
 
š_Ën
, size_ˆ
å_Ën
);

148 
	$HT_EXTERN
()

149 
	`bmz_bm_dump
(cÚ¡ *
š
, 
size_t
 
š_Ën
);

151 
	$HT_EXTERN
()

152 
	`bmz_bm_uÅack
(cÚ¡ *
š
, 
size_t
 
š_Ën
, *
out
, size_ˆ*
out_Ën_p
);

154 
	$HT_EXTERN
()

155 
	`bmz_lz_·ck
(cÚ¡ *
š
, 
size_t
 
š_Ën
, *
out
, size_ˆ*
out_Ën_p
,

156 *
wÜk_mem
);

158 
	$HT_EXTERN
(
size_t
)

159 
	`bmz_lz_·ck_wÜkËn
(
size_t
 
š_Ën
);

161 
	$HT_EXTERN
()

162 
	`bmz_lz_uÅack
(cÚ¡ *
š
, 
size_t
 
š_Ën
, *
out
, size_ˆ*
out_Ën_p
);

164 
	$HT_EXTERN
()

165 
	`bmz_£t_cŞlisiÚ_th»sh
(
th»sh
);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/bmz/bmz-test.c

20 
	~<¡dio.h
>

21 
	~<¡dlib.h
>

22 
	~<¡ršg.h
>

23 
	~<sys/¡©.h
>

24 
	~<”ºo.h
>

25 
	~<fú.h
>

26 
	~<uni¡d.h
>

27 
	~"bmz-š‹º®.h
"

28 
	~"‹¡-h–³r.h
"

29 #iâdeà
HT_NO_MMAP


30 
	~<sys/mmª.h
>

31 
size_t
 
	gs_no_mm­
 = 0;

33 
size_t
 
	gs_no_mm­
 = 1;

37 
	tLu
;

39 
	#TIMES
(
_n_
, 
_code_
) do { \

40 
size_t
 
_n
 = 
_n_
; \

41 
_n
--è{ 
_code_
; } \

42 } 0)

	)

44 
	#BENCH
(
_Ïb–_
, 
_code_
, 
_n_
, 
_times_
) do { \

45 
t1
; \

46 
	`HT_MEASURE
(
t1
, 
	`TIMES
(
_times_
, 
_code_
)); \

47 
	`´štf
("%16s: %.3fs (%.3fMB/s)\n", \

48 
_Ïb–_
, 
t1
, (
_n_
è/ 1e6 /1 *Ğ
_times_
)); \

49 
	`fæush
(
¡dout
); fæush(
¡d”r
); \

50 } 0)

	)

52 
	#LOG
(
_lvl_
, 
_fmt_
, ...èià(
s_v”bos™y
 >= _lvl_) do { \

53 
	`årštf
(
¡d”r
, "%s: " 
_fmt_
 "\n", 
__FUNCTION__
, ##
__VA_ARGS__
); \

54 } 0)

	)

56 
	#DIE
(
_fmt_
, ...) do { \

57 
	`LOG
(0, "çl: " 
_fmt_
, ##
__VA_ARGS__
); \

58 
	`ex™
(1); \

59 } 0)

	)

62 
	#O_BENCH_HASH
 (1 << 0)

	)

63 
	#O_BENCH_LUT
 (1 << 1)

	)

64 
	#O_CHECK_HASH
 (1 << 2)

	)

65 
	#O_MEMCPY
 (1 << 3)

	)

66 
	#O_HASH_MOD
 (1 << 4)

	)

67 
	#O_HASH_MOD16X2
 (1 << 5)

	)

68 
	#O_HASH_MASK16X2
 (1 << 6)

	)

69 
	#O_HASH_MASK
 (1 << 7)

	)

70 
	#O_HASH_MASK32X2
 (1 << 8)

	)

71 
	#O_DEFAULT
 (0xfffffffà& ~
O_CHECK_HASH
)

	)

72 
	#O_HASHES
 0xfffffff0

	)

75 
size_t
 
	gs_İtiÚs
 = 0;

76 
size_t
 
	gs_å_Ën
 = 20;

77 
size_t
 
	gs_off£t
 = 0;

78 
size_t
 
	gs_times
 = 1;

79 
	gs_v”bos™y
 = 0;

80 
	gs_bm_dump
 = 0;

81 
	gs_show_hash
 = 0;

86 
size_t
 
	gs_b1
 = 257;

87 
size_t
 
	gs_b2
 = 277;

88 
size_t
 
	gs_m
 = 0xffffffff;

89 
size_t
 
	gs_m1
 = 0xffff;

90 
size_t
 
	gs_m2
 = (0xffff - 4);

93 
	$dump_bm
(cÚ¡ *
Ïb–
, cÚ¡ *
š
, 
size_t
 
Ën
) {

94 
»t
;

96 ià(
s_v”bos™y
 > 1) {

97 
	`´štf
("----% ’coded:\n", 
Ïb–
);

98 
	`fwr™e
(
š
, 1, 
Ën
, 
¡dout
);

100 ià(
s_bm_dump
) {

101 
	`´štf
("\n----% dum³d:\n", 
Ïb–
);

103 ià((
»t
 = 
	`bmz_bm_dump
(
š
, 
Ën
)è!ğ
BMZ_E_OK
)

104 
	`LOG
(1, "”rÜ: badƒncoded d©¨Ô‘=%d)", 
»t
);

106 
	`puts
("\n----end-dump");

108 
	}
}

111 
	$‹¡_bm_mod
(cÚ¡ *
š
, 
size_t
 
Ën
, *
out
, size_ˆ*
Ën_p
,

112 *
wÜk_mem
) {

113 
	`bmz_bm_·ck_mod
(
š
, 
Ën
, 
out
, 
Ën_p
, 
s_off£t
, 
s_å_Ën
, 
wÜk_mem
, 
s_b1
, 
s_m
);

114 
	`dump_bm
("mod", 
out
, *
Ën_p
);

115 
	}
}

118 
	$‹¡_bm_mod16x2
(cÚ¡ *
š
, 
size_t
 
Ën
, *
out
, size_ˆ*
Ën_p
,

119 *
wÜk_mem
) {

120 
	`bmz_bm_·ck_mod16x2
(
š
, 
Ën
, 
out
, 
Ën_p
, 
s_off£t
, 
s_å_Ën
,

121 
wÜk_mem
, 
s_b1
, 
s_b2
, 
s_m1
, 
s_m2
);

122 
	`dump_bm
("mod16x2", 
out
, *
Ën_p
);

123 
	}
}

126 
	$‹¡_bm_mask16x2
(cÚ¡ *
š
, 
size_t
 
Ën
, *
out
, size_ˆ*
Ën_p
,

127 *
wÜk_mem
) {

128 
	`bmz_bm_·ck_mask16x2
(
š
, 
Ën
, 
out
, 
Ën_p
, 
s_off£t
, 
s_å_Ën
,

129 
wÜk_mem
, 
s_b1
, 
s_b2
);

130 
	`dump_bm
("mask16x2", 
out
, *
Ën_p
);

131 
	}
}

134 
	$‹¡_bm_mask
(cÚ¡ *
š
, 
size_t
 
Ën
, *
out
, size_ˆ*
Ën_p
,

135 *
wÜk_mem
) {

136 
	`bmz_bm_·ck_mask
(
š
, 
Ën
, 
out
, 
Ën_p
, 
s_off£t
, 
s_å_Ën
, 
wÜk_mem
, 
s_b1
);

137 
	`dump_bm
("mask", 
out
, *
Ën_p
);

138 
	}
}

141 
	$‹¡_bm_mask32x2
(cÚ¡ *
š
, 
size_t
 
Ën
, *
out
, size_ˆ*
Ën_p
,

142 *
wÜk_mem
) {

143 
	`bmz_bm_·ck_mask32x2
(
š
, 
Ën
, 
out
, 
Ën_p
, 
s_off£t
, 
s_å_Ën
,

144 
wÜk_mem
, 
s_b1
, 
s_b2
);

145 
	`dump_bm
("mask32x2", 
out
, *
Ën_p
);

146 
	}
}

149 
	$‹¡_bm_uÅack
(cÚ¡ *
š
, 
size_t
 
Ën
, *
out
, size_ˆ*
Ën_p
) {

150 
»t
 = 
	`bmz_bm_uÅack
(
š
, 
Ën
, 
out
, 
Ën_p
);

151 
	`LOG
(1, "\nbm_uÅack„‘uºed %d, size: %lu\n", 
»t
, (
Lu
)*
Ën_p
);

152 ià(
s_v”bos™y
 < 2) ;

153 
	`puts
("bm decoded:");

154 
	`fwr™e
(
out
, 1, *
Ën_p
, 
¡dout
);

155 
	`puts
("\nend-decoded");

156 
	}
}

159 
	$»ad_äom_å
(
FILE
 *
å
, 
size_t
 *
Ën_p
) {

160 *
d©a
 = 
NULL
;

161 
buf
[65536];

162 
size_t
 
Ën
 = 0, 
size
 = 0, 
»t
;

164 (
»t
 = 
	`ä—d
(
buf
, 1, (buf), 
å
)) > 0) {

165 
Ën
 +ğ
»t
;

167 ià(
Ën
 > 
size
) {

168 
size
 = (
Ën
 + 16) * 3 / 2;

169 
d©a
 = 
	`»®loc
(d©a, 
size
);

171 
	`memıy
(
d©a
 + 
Ën
 - 
»t
, 
buf
,„et);

173 *
Ën_p
 = 
Ën
;

174  
d©a
;

175 
	}
}

178 
	$´št_hash
(cÚ¡ *
Ïb–
, 
size_t
 
h
) {

179 
	`´štf
("%16s: %lx\n", 
Ïb–
, (
Lu
)
h
);

180 
	}
}

183 
	$show_hash
(cÚ¡ *
d©a
, 
size_t
 
Ën
) {

185 ià(
s_İtiÚs
 & 
O_HASH_MOD
)

186 
	`´št_hash
("hash-mod", 
	`bmz_hash_mod
(
d©a
, 
Ën
, 
s_b1
, 
s_m
));

188 ià(
s_İtiÚs
 & 
O_HASH_MOD16X2
)

189 
	`´št_hash
("hash-mod16x2", 
	`bmz_hash_mod16x2
(
d©a
, 
Ën
, 
s_b1
, 
s_b2
,

190 
s_m1
, 
s_m2
));

191 ià(
s_İtiÚs
 & 
O_HASH_MASK16X2
)

192 
	`´št_hash
("hash-mask16X2", 
	`bmz_hash_mask16x2
(
d©a
, 
Ën
, 
s_b1
, 
s_b2
));

194 ià(
s_İtiÚs
 & 
O_HASH_MASK
)

195 
	`´št_hash
("hash-mask", 
	`bmz_hash_mask
(
d©a
, 
Ën
, 
s_b1
));

197 ià(
s_İtiÚs
 & 
O_HASH_MASK32X2
)

198 
	`´št_hash
("hash-mask32x2", 
	`bmz_hash_mask32x2
(
d©a
, 
Ën
, 
s_b1
, 
s_b2
));

199 
	}
}

202 
	$‹¡_äom_¡ršg
(cÚ¡ *
d©a
, 
size_t
 
Ën
) {

203 *
buf
, *
mem
;

204 
size_t
 
n
 = 
s_times
;

205 
İt
 = 
s_İtiÚs
;

206 
size_t
 
out_Ën
, 
out_Ën0
, 
Ën2
 = 
Ën
, 
wÜk_Ën
;

208 ià(
s_show_hash
) {

209 
	`show_hash
(
d©a
, 
Ën
);

213 
out_Ën0
 = 
out_Ën
 = 
	`bmz_·ck_buæ’
(
Ën
);

214 
buf
 = 
	`m®loc
(
out_Ën
);

215 
wÜk_Ën
 = 
	`bmz_bm_·ck_wÜkËn
(
Ën
, 
s_å_Ën
);

216 
mem
 = 
	`m®loc
(
wÜk_Ën
);

217 
	`LOG
(1, "input†ength: %lu, out_len %lu, work_len: %lu\n",

218 (
Lu
)
Ën
, (Lu)
out_Ën
, (Lu)
wÜk_Ën
);

221 ià(
İt
 & 
O_MEMCPY
) {

222 
	`BENCH
("memıy", 
	`memıy
(
buf
, 
d©a
, 
Ën
),†’, 
n
);

225 ià(
İt
 & 
O_CHECK_HASH
) {

227 ià(
İt
 & 
O_HASH_MOD
)

228 
	`HT_CHECK
(
	`bmz_check_hash_mod
(
d©a
, 
Ën
, 
s_å_Ën
, 
s_b1
, 
s_m
è=ğ
BMZ_E_OK
);

230 ià(
İt
 & 
O_HASH_MOD16X2
)

231 
	`HT_CHECK
(
	`bmz_check_hash_mod16x2
(
d©a
, 
Ën
, 
s_å_Ën
,

232 
s_b1
, 
s_b2
, 
s_m1
, 
s_m2
è=ğ
BMZ_E_OK
);

233 ià(
İt
 & 
O_HASH_MASK16X2
)

234 
	`HT_CHECK
(
	`bmz_check_hash_mask16x2
(
d©a
, 
Ën
, 
s_å_Ën
, 
s_b1
, 
s_b2
)

235 =ğ
BMZ_E_OK
);

237 ià(
İt
 & 
O_HASH_MASK
)

238 
	`HT_CHECK
(
	`bmz_check_hash_mask
(
d©a
, 
Ën
, 
s_å_Ën
, 
s_b1
è=ğ
BMZ_E_OK
);

240 ià(
İt
 & 
O_HASH_MASK32X2
)

241 
	`HT_CHECK
(
	`bmz_check_hash_mask32x2
(
d©a
, 
Ën
, 
s_å_Ën
, 
s_b1
, 
s_b2
)

242 =ğ
BMZ_E_OK
);

245 ià(
İt
 & 
O_BENCH_HASH
) {

247 ià(
İt
 & 
O_HASH_MOD
)

248 
	`BENCH
("hash mod", 
	`bmz_b’ch_hash
(
d©a
, 
Ën
, 
BMZ_HASH_MOD
),†’, 
n
);

250 ià(
İt
 & 
O_HASH_MOD16X2
)

251 
	`BENCH
("hash mod16x2", 
	`bmz_b’ch_hash
(
d©a
, 
Ën
, 
BMZ_HASH_MOD16X2
),

252 
Ën
, 
n
);

254 ià(
İt
 & 
O_HASH_MASK16X2
)

255 
	`BENCH
("hash mask16x2", 
	`bmz_b’ch_hash
(
d©a
, 
Ën
, 
BMZ_HASH_MASK16X2
),

256 
Ën
, 
n
);

258 ià(
İt
 & 
O_HASH_MASK
)

259 
	`BENCH
("hash mask", 
	`bmz_b’ch_hash
(
d©a
, 
Ën
, 
BMZ_HASH_MASK
),†’, 
n
);

261 ià(
İt
 & 
O_HASH_MASK32X2
)

262 
	`BENCH
("hash mask32x2", 
	`bmz_b’ch_hash
(
d©a
, 
Ën
, 
BMZ_HASH_MASK32X2
),

263 
Ën
, 
n
);

266 ià(
İt
 & 
O_BENCH_LUT
) {

268 ià(
İt
 & 
O_HASH_MOD
)

269 
	`BENCH
("luˆmod", 
	`bmz_b’ch_lut_mod
(
d©a
, 
Ën
, 
s_å_Ën
, 
mem
, 
s_b1
, 
s_m
),

270 
Ën
, 
n
);

272 ià(
İt
 & 
O_HASH_MOD16X2
)

273 
	`BENCH
("luˆmod16x2", 
	`bmz_b’ch_lut_mod16x2
(
d©a
, 
Ën
, 
s_å_Ën
, 
mem
,

274 
s_b1
, 
s_b2
, 
s_m1
, 
s_m2
), 
Ën
, 
n
);

276 ià(
İt
 & 
O_HASH_MASK16X2
)

277 
	`BENCH
("luˆmask16x2", 
	`bmz_b’ch_lut_mask16x2
(
d©a
, 
Ën
, 
s_å_Ën
, 
mem
,

278 
s_b1
, 
s_b2
), 
Ën
, 
n
);

280 ià(
İt
 & 
O_HASH_MASK
)

281 
	`BENCH
("luˆmask", 
	`bmz_b’ch_lut_mask
(
d©a
, 
Ën
, 
s_å_Ën
, 
mem
, 
s_b1
),

282 
Ën
, 
n
);

284 ià(
İt
 & 
O_HASH_MASK32X2
)

285 
	`BENCH
("luˆmask32x2", 
	`bmz_b’ch_lut_mask32x2
(
d©a
, 
Ën
, 
s_å_Ën
, 
mem
,

286 
s_b1
, 
s_b2
), 
Ën
, 
n
);

289 ià(
İt
 !ğ
O_DEFAULT
 && (opt & 0xf)) ;

291 ià(
İt
 & 
O_HASH_MOD
) {

292 
	`BENCH
("bm…ack mod", 
	`‹¡_bm_mod
(
d©a
, 
Ën
, 
buf
, &
out_Ën
, 
mem
),†’, 
n
);

293 
	`BENCH
("bm uÅack", 
	`‹¡_bm_uÅack
(
buf
, 
out_Ën
, buà+ out_Ën, &
Ën2
),

294 
Ën
, 
n
);

295 
	`HT_CHECK
(
Ën
 =ğ
Ën2
);

296 
	`HT_CHECK
(
	`memcmp
(
d©a
, 
buf
 + 
out_Ën
, 
Ën
) == 0);

299 ià(
İt
 & 
O_HASH_MOD16X2
) {

300 
	`mem£t
(
buf
, 0, 
out_Ën
); out_ËÀğ
out_Ën0
;

301 
	`BENCH
("bm…ack mod16x2", 
	`‹¡_bm_mod16x2
(
d©a
, 
Ën
, 
buf
, &
out_Ën
, 
mem
),

302 
Ën
, 
n
);

303 
	`BENCH
("bm uÅack", 
	`‹¡_bm_uÅack
(
buf
, 
out_Ën
, buà+ out_Ën, &
Ën2
),

304 
Ën
, 
n
);

305 
	`HT_CHECK
(
Ën
 =ğ
Ën2
);

306 
	`HT_CHECK
(
	`memcmp
(
d©a
, 
buf
 + 
out_Ën
, 
Ën
) == 0);

309 ià(
İt
 & 
O_HASH_MASK16X2
) {

310 
	`mem£t
(
buf
, 0, 
out_Ën
); out_ËÀğ
out_Ën0
;

311 
	`BENCH
("bm…ack mask16x2", 
	`‹¡_bm_mask16x2
(
d©a
, 
Ën
, 
buf
, &
out_Ën
, 
mem
),

312 
Ën
, 
n
);

313 
	`BENCH
("bm uÅack", 
	`‹¡_bm_uÅack
(
buf
, 
out_Ën
, buà+ out_Ën, &
Ën2
),

314 
Ën
, 
n
);

315 
	`HT_CHECK
(
Ën
 =ğ
Ën2
);

316 
	`HT_CHECK
(
	`memcmp
(
d©a
, 
buf
 + 
out_Ën
, 
Ën
) == 0);

319 ià(
İt
 & 
O_HASH_MASK
) {

320 
	`mem£t
(
buf
, 0, 
out_Ën
); out_ËÀğ
out_Ën0
;

321 
	`BENCH
("bm…ack mask", 
	`‹¡_bm_mask
(
d©a
, 
Ën
, 
buf
, &
out_Ën
, 
mem
),†’, 
n
);

322 
	`BENCH
("bm uÅack", 
	`‹¡_bm_uÅack
(
buf
, 
out_Ën
, buà+ out_Ën, &
Ën2
),

323 
Ën
, 
n
);

324 
	`HT_CHECK
(
Ën
 =ğ
Ën2
);

325 
	`HT_CHECK
(
	`memcmp
(
d©a
, 
buf
 + 
out_Ën
, 
Ën
) == 0);

328 ià(
İt
 & 
O_HASH_MASK32X2
) {

329 
	`mem£t
(
buf
, 0, 
out_Ën
); out_ËÀğ
out_Ën0
;

330 
	`BENCH
("bm…ack mask32x2", 
	`‹¡_bm_mask32x2
(
d©a
, 
Ën
, 
buf
, &
out_Ën
, 
mem
),

331 
Ën
, 
n
);

332 
	`BENCH
("bm uÅack", 
	`‹¡_bm_uÅack
(
buf
, 
out_Ën
, buà+ out_Ën, &
Ën2
),

333 
Ën
, 
n
);

334 
	`HT_CHECK
(
Ën
 =ğ
Ën2
);

335 
	`HT_CHECK
(
	`memcmp
(
d©a
, 
buf
 + 
out_Ën
, 
Ën
) == 0);

337 
	}
}

340 
	$‹¡_äom_¡dš
() {

341 
size_t
 
Ën
;

342 *
d©a
 = 
	`»ad_äom_å
(
¡dš
, &
Ën
);

343 
	`‹¡_äom_¡ršg
(
d©a
, 
Ën
);

344 
	}
}

347 
	$‹¡_äom_fe
(cÚ¡ *
âame
) {

348 
fd
 = 
	`İ’
(
âame
, 
O_RDONLY
, 0);

349 *
d©a
 = 
NULL
;

350 
¡©
 
¡
;

351 
Ën
;

353 ià(
fd
 =ğ-1è
	`DIE
("ÿÂÙ o³À'%s'", 
âame
);

355 ià(
	`f¡©
(
fd
, &
¡
è!ğ0è
	`DIE
("¡© faed oÀ'%s'", 
âame
);

357 
Ën
 = 
¡
.
¡_size
;

359 ià(!
s_no_mm­
) {

360 #iâdeà
HT_NO_MMAP


361 
	`LOG
(1, "mm­šg %ld by‹ šØmemÜy...", 
Ën
);

362 
d©a
 = 
	`mm­
(
NULL
, 
¡
.
¡_size
, 
PROT_READ
, 
MAP_PRIVATE
, 
fd
, 0);

364 ià((*)-1 =ğ
d©a
) {

365 
	`LOG
(0, "mm­ faed oÀ'%s',ryšg‡É”Çtive...", 
âame
);

366 
”ºo
 = 0;

367 
d©a
 = 
NULL
;

372 ià(!
d©a
) {

373 
	`LOG
(1, "»adšg %ld by‹ šØmemÜy...", 
Ën
);

375 
d©a
 = 
	`m®loc
(
Ën
);

377 ià(!
d©a
è
	`DIE
("”rÜ‡Îoc'šg %ld by‹s", 
Ën
);

379 ià((
Ën
 = 
	`»ad
(
fd
, 
d©a
,†’)è!ğ
¡
.
¡_size
)

380 
	`DIE
("error„eading %s (expecting %ld bytes, got %ld",

381 
âame
, ()
¡
.
¡_size
, 
Ën
);

386 
	`‹¡_äom_¡ršg
(
d©a
, 
¡
.
¡_size
);

387 
	}
}

390 
	$show_u§ge
() {

391 
	`´štf
("usage: bmz-test [options] [string...]\n%s%s%s",

413 
	`ex™
(0);

414 
	}
}

417 
	$maš
(
ac
, *
av
[]) {

418 **
Ÿ
 = 
av
 + 1, **
a_’d
 =‡v + 
ac
, *
•
;

419 cÚ¡ *
âame
 = 
NULL
;

421 ; 
Ÿ
 < 
a_’d
; ++ia) {

422 ià(!
	`¡rcmp
("--å-Ën", *
Ÿ
)è
s_å_Ën
 = 
	`©oi
(*++ia);

423 ià(!
	`¡rcmp
("--off£t", *
Ÿ
)è
s_off£t
 = 
	`©oi
(*++ia);

424 ià(!
	`¡rcmp
("--times", *
Ÿ
)è
s_times
 = 
	`©oi
(*++ia);

425 ià(!
	`¡rcmp
("--hash", *
Ÿ
)è
s_show_hash
 = 1;

426 ià(!
	`¡rcmp
("--b1", *
Ÿ
)è
s_b1
 = 
	`©oi
(*++ia);

427 ià(!
	`¡rcmp
("--b2", *
Ÿ
)è
s_b2
 = 
	`©oi
(*++ia);

428 ià(!
	`¡rcmp
("--m", *
Ÿ
)è
s_m
 = 
	`¡¹Ş
(*++Ÿ, &
•
, 0);

429 ià(!
	`¡rcmp
("--m1", *
Ÿ
)è
s_m1
 = 
	`¡¹Ş
(*++Ÿ, &
•
, 0);

430 ià(!
	`¡rcmp
("--m2", *
Ÿ
)è
s_m2
 = 
	`¡¹Ş
(*++Ÿ, &
•
, 0);

431 ià(!
	`¡rcmp
("--fe", *
Ÿ
)è
âame
 = *++ia;

432 ià(!
	`¡rcmp
("--no-mm­", *
Ÿ
)è
s_no_mm­
 = 1;

433 ià(!
	`¡rcmp
("--v”bo£", *
Ÿ
)è
s_v”bos™y
 = 1;

434 ià(!
	`¡ºcmp
("--v”bo£=", *
Ÿ
, 10)è
s_v”bos™y
 = 
	`©oi
(*ia + 10);

435 ià(!
	`¡rcmp
("--bm-dump", *
Ÿ
)è
s_bm_dump
 = 1;

436 ià(!
	`¡rcmp
("--b’ch-hash", *
Ÿ
)è
s_İtiÚs
 |ğ
O_BENCH_HASH
;

437 ià(!
	`¡rcmp
("--check-hash", *
Ÿ
)è
s_İtiÚs
 |ğ
O_CHECK_HASH
;

438 ià(!
	`¡rcmp
("--b’ch-lut", *
Ÿ
)è
s_İtiÚs
 |ğ
O_BENCH_LUT
;

439 ià(!
	`¡rcmp
("--hash-mod", *
Ÿ
)è
s_İtiÚs
 |ğ
O_HASH_MOD
;

440 ià(!
	`¡rcmp
("--hash-mod16x2", *
Ÿ
)è
s_İtiÚs
 |ğ
O_HASH_MOD16X2
;

441 ià(!
	`¡rcmp
("--hash-mask16x2", *
Ÿ
)è
s_İtiÚs
 |ğ
O_HASH_MASK16X2
;

442 ià(!
	`¡rcmp
("--hash-mask", *
Ÿ
)è
s_İtiÚs
 |ğ
O_HASH_MASK
;

443 ià(!
	`¡rcmp
("--hash-mask32x2", *
Ÿ
)è
s_İtiÚs
 |ğ
O_HASH_MASK32X2
;

444 ià(!
	`¡rcmp
("--h–p", *
Ÿ
)è
	`show_u§ge
();

445 ià(!
	`¡rcmp
("--", *
Ÿ
)) {

446 ++
Ÿ
;

449 ià('-' =ğ**
Ÿ
) {

450 
	`DIE
("unknowÀİtiÚ: %s\n", *
Ÿ
);

454 
	`bmz_£t_v”bos™y
(
s_v”bos™y
);

456 ià(!
s_İtiÚs
ès_İtiÚ ğ
O_DEFAULT
;

457 ià(!(
s_İtiÚs
 & 
O_HASHES
)) s_options |= O_HASHES;

459 ià(
âame
)

460 
	`‹¡_äom_fe
(
âame
);

461 ià(
Ÿ
 >ğ
a_’d
)

462 
	`‹¡_äom_¡dš
();

463 ; 
Ÿ
 < 
a_’d
; ++ia)

464 
	`‹¡_äom_¡ršg
(*
Ÿ
, 
	`¡¾’
(*ia));

467 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/bmz/bmz.c

25 
	~<¡dio.h
>

26 
	~<¡dlib.h
>

27 
	~<¡dšt.h
>

28 
	~<¡ršg.h
>

29 
	~<m©h.h
>

30 
	~<time.h
>

32 
	~"bmz-š‹º®.h
"

33 
	~"../lzo/mšzo.h
"

36 
	#BM_B1
 257

	)

37 
	#BM_B2
 277

	)

38 
	#BM_M1
 0xffff

	)

39 
	#BM_M2
 (0xfffà- 4)

	)

41 
	#BM_MASK16
 0xffff

	)

42 
	#BM_MASK24
 0xffffff

	)

43 
	#BM_MASK32
 0xffffffff

	)

44 
	#BM_MASKSZ
 
BM_MASK32


	)

49 
	#BM_ESC
 0xã

	)

50 
	#BM_MAX_LEN
 0xfdffffffffffuÎ

	)

51 
	#BM_MAX_1B
 0xfd

	)

52 
	#BM_MAX_2B
 0xfdff

	)

53 
	#BM_MAX_3B
 0xfdffff

	)

54 
	#BM_MAX_4B
 0xfdfffffful

	)

55 
	#BM_MAX_5B
 0xfdffffffffuÎ

	)

58 
	#BM_MAX_V1B
 0x7f

	)

59 
	#BM_MAX_V2B
 0x3fff

	)

60 
	#BM_MAX_V3B
 0x1fffff

	)

61 
	#BM_MAX_V4B
 0xfffffff

	)

62 
	#BM_MAX_V5B
 0x7ffffffffuÎ

	)

63 
	#BM_MAX_V6B
 0x3ffffffffffuÎ

	)

66 
	#BM_COLLISION_ABORT_THRESH
 1

	)

67 
	#BM_ABORT_COLLISIONS
 \

68 ((
BM_COLLISION_ABORT_THRESH
 + 1è* 
cŞlisiÚ_th»sh
 + 1)

	)

71 
	#BM_COLOR_DBG
 "\x1b[31m"

	)

72 
	#BM_COLOR_ALT
 "\x1b[32m"

	)

73 
	#BM_COLOR_END
 "\x1b[m"

	)

76 
ušt8_t
 
	tBy‹
;

77 
ušt32_t
 
	tUIÁ32
;

78 
ušt64_t
 
	tUIÁ64
;

79 
št64_t
 
	tIÁ64
;

80 
št32_t
 
	tIÁ32
;

83 
	tLlu
;

86 
	#BM_NPOS
 ((
size_t
)-1)

	)

89 
	#BM_ALIGN
(
_mem_
, 
_n_
è(
By‹
 *)(_mem_è+ _n_ - (((
size_t
)(_mem_))%(_n_))

	)

92 
size_t
 
	gs_´imes
[] = {

197 
size_t
 
	gs_cŞlisiÚ_th»sh
 = 0;

200 
	gs_v”bos™y
 = 0;

203 
	$butš_out
(cÚ¡ *
buf
, 
size_t
 
Ën
) {

204 
	`fwr™e
(
buf
, 1, 
Ën
, 
¡d”r
);

205 
	}
}

207 
HT_NORETURN
 

208 
	$butš_d›
(cÚ¡ *
msg
) {

209 
	`åuts
(
msg
, 
¡d”r
);

210 
	`ex™
(1);

211 
	}
}

213 
BmzOutProc
 
	gs_out_´oc
 = 
butš_out
;

214 
BmzD›Proc
 
	gs_d›_´oc
 = 
butš_d›
;

216 
	#BM_LOG
(
_Ëv–_
, 
_fmt_
, ...èià(
s_v”bos™y
 >= _level_) do { \

217 
msg
[256]; \

218 
Ën
 = 
	`¢´štf
(
msg
, (msg), "%s: " 
_fmt_
, 
__FUNCTION__
, \

219 ##
__VA_ARGS__
); \

220 
	`s_out_´oc
(
msg
, 
Ën
); \

221 } 0)

	)

223 
	#BM_LOG_
(
_Ëv–_
, 
_buf_
, 
_Ën_
èià(
s_v”bos™y
 >= _level_) do { \

224 
	`s_out_´oc
((*)
_buf_
, 
_Ën_
); \

225 } 0)

	)

227 
	#BM_DIE
(
_fmt_
, ...) do { \

228 
msg
[256]; \

229 
	`¢´štf
(
msg
, (msg), "çl: %s: " 
_fmt_
 "\n", \

230 
__FUNCTION__
, ##
__VA_ARGS__
); \

231 
	`s_d›_´oc
(
msg
); \

232 } 0)

	)

234 
	#BM_CHECK
(
_cÚd_
) \

235 ià(
_cÚd_
); 
	`BM_DIE
("%s:%d:ƒxpects: %s", \

236 
__FILE__
, 
__LINE__
, #_cÚd_)

	)

239 
	$bmz_£t_v”bos™y
(
v”bos™y
) {

240 
Şd
 = 
s_v”bos™y
;

241 
s_v”bos™y
 = 
v”bos™y
;

242  
Şd
;

243 
	}
}

245 
BmzOutProc


246 
	$bmz_£t_out_´oc
(
BmzOutProc
 
´oc
) {

247 
BmzOutProc
 
Şd
 = 
s_out_´oc
;

248 
s_out_´oc
 = 
´oc
;

249  
Şd
;

250 
	}
}

253 
	$bmz_£t_cŞlisiÚ_th»sh
(
th»sh
) {

254 
Şd
 = 
s_cŞlisiÚ_th»sh
;

255 
s_cŞlisiÚ_th»sh
 = 
th»sh
;

256  
Şd
;

257 
	}
}

262 
size_t


263 
	$¿ndom_´ime
(
size_t
 
exşuded
) {

264 cÚ¡ 
size_t
 
n
 = (
s_´imes
) / (size_t);

265 
size_t
 
i
 = 0;

269 
¤ªded
 = 0;

271 ià(!
¤ªded
) {

272 
	`¤ªd
(
	`time
(
NULL
));

273 
¤ªded
 = 1;

276 ; 
i
 < 
n
; ++i) {

278 
size_t
 
s
 = 
s_´imes
[
	`¿nd
(è% 
n
];

279 ià(
s
 !ğ
exşuded
)  s;

283 
	}
}

285 
size_t


286 
	$bm_lut_size
(
size_t
 
n
) {

287 
UIÁ64
 
x
 = 
n
;

291 
x
 |= (x >> 1);

292 
x
 |= (x >> 2);

293 
x
 |= (x >> 4);

294 
x
 |= (x >> 8);

295 
x
 |= (x >> 16);

296 
x
 |= (x >> 32);

297 ++
x
;

298 } 
x
 < 
n
 * 8 / 5);

299  
x
;

300 
	}
}

303 
size_t
 
	mhash
;

304 
size_t
 
	mpos
;

305 } 
	tBmLutEÁry
;

308 
size_t
 
	msize
, 
	mcŞlisiÚs
, 
	mad­ts
, 
	m´obes
;

309 
BmLutEÁry
 *
	m’Œ›s
;

310 } 
	tBmLut
;

313 
	$š™_bmlut
(
BmLut
 *
bË
, 
size_t
 
n
, *
wÜk_mem
) {

314 
BmLutEÁry
 *
p
, *
’dp
;

316 
bË
->
´obes
 =abË->
ad­ts
 =abË->
cŞlisiÚs
 = 0;

317 
bË
->
size
 = 
	`bm_lut_size
(
n
);

318 
bË
->
’Œ›s
 = (
BmLutEÁry
 *è
wÜk_mem
;

320 
p
 = 
bË
->
’Œ›s
, 
’dp
 =… +abË->
size
;… <ƒndp; ++p)

321 
p
->
pos
 = 
BM_NPOS
;

323 
	`BM_LOG
(1, "n(ås): %Îu, size: %Îu\n", (
Llu
)
n
, (Llu)
bË
->
size
);

324 
	}
}

327 
	#BM_LOOKUP
(
_lut_
, 
_hash_
, 
_’Œy_
) do { \

328 
size_t
 
sz
 = 
_lut_
.
size
, 
idx
 = (
_hash_
è& (sz - 1), 
´obes
 = 0; \

329 
BmLutEÁry
 *
b
 = 
_lut_
.
’Œ›s
, *
p
 = b + 
idx
, *
’dp
 = b + 
sz
; \

331 
p
->
pos
 !ğ
BM_NPOS
) { \

332 ià(
p
->
hash
 =ğ
_hash_
) ; \

333 ++
p
; \

334 ià(
p
 >ğ
’dp
è°ğ
b
; \

335 ++
´obes
; \

337 ià(
´obes
è
_lut_
.probes +=…robes; \

338 
_’Œy_
 = 
p
; \

339 } 0)

	)

342 
	#R_HASH_MOD_BODY
(
_št_ty³_
) \

343 
_št_ty³_
 
h
 = 0, 
p
 = 1; \

345 
Ën
--) { \

346 
h
 +ğ
p
 * 
buf
[
Ën
]; \

347 
h
 %ğ
m
; \

348 
p
 *ğ
b
; \

349 
p
 %ğ
m
; \

351  
h


	)

353 
UIÁ64


354 
	$r_hash_mod
(cÚ¡ 
By‹
 *
buf
, 
size_t
 
Ën
, size_ˆ
b
, 
UIÁ64
 
m
) {

355 
	`R_HASH_MOD_BODY
(
UIÁ64
);

356 
	}
}

358 
UIÁ32


359 
	$r_hash_mod32
(cÚ¡ 
By‹
 *
buf
, 
size_t
 
Ën
, 
UIÁ32
 
b
, UIÁ32 
m
) {

360 
	`R_HASH_MOD_BODY
(
UIÁ32
);

361 
	}
}

364 
UIÁ32


365 
	$r_hash_mod16x2
(cÚ¡ 
By‹
 *
buf
, 
size_t
 
Ën
, 
UIÁ32
 
b1
, UIÁ32 
b2
,

366 
UIÁ32
 
m1
, UIÁ32 
m2
) {

367  (
	`r_hash_mod32
(
buf
, 
Ën
, 
b1
, 
m1
) << 16) |

368 
	`r_hash_mod32
(
buf
, 
Ën
, 
b2
, 
m2
);

369 
	}
}

372 
	#POW_MOD_BODY
(
_pow_fun_
, 
_št_ty³_
) \

373 ià(
n
 == 0)  1; \

374 ià(
n
 =ğ1è 
x
 % 
m
; \

376 
_št_ty³_
 
sqr
 = (
x
 * xè% 
m
; \

377 
_št_ty³_
 
pow
 = 
	`_pow_fun_
(
sqr
, 
n
 / 2, 
m
); \

378 ià(
n
 & 1è (
pow
 * 
x
è% 
m
; \

379  
pow
 % 
m
; \

380 }

	)

382 
UIÁ64


383 
	$pow_mod
(
UIÁ64
 
x
, UIÁ64 
n
, UIÁ64 
m
) {

384 
	`POW_MOD_BODY
(
pow_mod
, 
UIÁ64
)

385 
	}
}

387 
UIÁ32


388 
	$pow_mod32
(
UIÁ32
 
x
, UIÁ32 
n
, UIÁ32 
m
) {

389 
	`POW_MOD_BODY
(
pow_mod32
, 
UIÁ32
)

390 
	}
}

393 
	#UPDATE_HASH_MOD_BODY
 \

394 
h
 *ğ
b
; \

395 
h
 -ğ(
out
 * 
pow_n
è% 
m
; \

396 
h
 +ğ
š
; \

397 ià(
h
 < 0èh +ğ
m
; \

398  (
h
 % 
m
)

	)

400 
šlše
 
IÁ64


401 
	$upd©e_hash_mod
(
IÁ64
 
h
, 
By‹
 
š
, By‹ 
out
, IÁ64 
pow_n
, IÁ64 
b
, IÁ64 
m
) {

402 
UPDATE_HASH_MOD_BODY
;

403 
	}
}

405 
šlše
 
IÁ32


406 
	$upd©e_hash_mod32
(
IÁ32
 
h
, 
By‹
 
š
, By‹ 
out
, IÁ32 
pow_n
, IÁ32 
b
, IÁ32 
m
) {

407 
UPDATE_HASH_MOD_BODY
;

408 
	}
}

410 
šlše
 
UIÁ32


411 
	$upd©e_hash_mod16x2
(
UIÁ32
 
h
, 
š
, 
out
, UIÁ32 
pow1
, UIÁ32 
pow2
,

412 
UIÁ32
 
b1
, UIÁ32 
b2
, UIÁ32 
m1
, UIÁ32 
m2
) {

413  (
	`upd©e_hash_mod32
((
h
 >> 16), 
š
, 
out
, 
pow1
, 
b1
, 
m1
) << 16) |

414 
	`upd©e_hash_mod32
((
h
 & 
BM_MASK16
), 
š
, 
out
, 
pow2
, 
b2
, 
m2
);

415 
	}
}

420 
	#R_HASH_MASK_BODY
(
št_ty³
) \

421 
št_ty³
 
h
 = 0, 
p
 = 1; \

423 
Ën
--) { \

424 
h
 +ğ
p
 * 
buf
[
Ën
]; \

425 
h
 &ğ
m
; \

426 
p
 *ğ
b
; \

427 
p
 &ğ
m
; \

429  
h


	)

431 
UIÁ64


432 
	$r_hash_mask
(cÚ¡ 
By‹
 *
buf
, 
size_t
 
Ën
, 
UIÁ64
 
b
, UIÁ64 
m
) {

433 
	`R_HASH_MASK_BODY
(
UIÁ64
);

434 
	}
}

436 
UIÁ32


437 
	$r_hash_mask32
(cÚ¡ 
By‹
 *
buf
, 
size_t
 
Ën
, 
UIÁ32
 
b
, UIÁ32 
m
) {

438 
	`R_HASH_MASK_BODY
(
UIÁ32
);

439 
	}
}

442 
UIÁ32


443 
	$r_hash_mask16x2
(cÚ¡ 
By‹
 *
buf
, 
size_t
 
Ën
, 
UIÁ32
 
b1
, UIÁ32 
b2
) {

444  (
	`r_hash_mask32
(
buf
, 
Ën
, 
b1
, 
BM_MASK16
) << 16) |

445 
	`r_hash_mask32
(
buf
, 
Ën
, 
b2
, 
BM_MASK16
);

446 
	}
}

448 
UIÁ64


449 
	$r_hash_mask32x2
(cÚ¡ 
By‹
 *
buf
, 
size_t
 
Ën
, 
UIÁ64
 
b1
, UIÁ64 
b2
) {

450  (
	`r_hash_mask
(
buf
, 
Ën
, 
b1
, 
BM_MASK32
) << 32) |

451 
	`r_hash_mask
(
buf
, 
Ën
, 
b2
, 
BM_MASK32
);

452 
	}
}

454 
	#POW_MASK_BODY
(
_pow_fun_
, 
_št_ty³_
) \

455 ià(
n
 == 0)  1; \

456 ià(
n
 =ğ1è (
x
 & 
m
); \

458 
_št_ty³_
 
sqr
 = (
x
 * xè& 
m
; \

459 
_št_ty³_
 
pow
 = 
	`_pow_fun_
(
sqr
, 
n
 / 2, 
m
); \

460 ià(
n
 & 1è ((
pow
 * 
x
è& 
m
); \

461  (
pow
 & 
m
); \

462 }

	)

464 
UIÁ64


465 
	$pow_mask
(
UIÁ64
 
x
, UIÁ64 
n
, UIÁ64 
m
) {

466 
	`POW_MASK_BODY
(
pow_mask
, 
UIÁ64
)

467 
	}
}

469 
UIÁ32


470 
	$pow_mask32
(
UIÁ32
 
x
, UIÁ32 
n
, UIÁ32 
m
) {

471 
	`POW_MASK_BODY
(
pow_mask32
, 
UIÁ32
)

472 
	}
}

474 
	#UPDATE_HASH_MASK_BODY
 \

475 
h
 *ğ
b
; \

476 
h
 -ğ(
out
 * 
pow_n
è& 
m
; \

477 
h
 +ğ
š
; \

478  (
h
 & 
m
)

	)

480 
šlše
 
UIÁ64


481 
	$upd©e_hash_mask
(
UIÁ64
 
h
, 
š
, 
out
, UIÁ64 
pow_n
, UIÁ64 
b
, UIÁ64 
m
) {

482 
UPDATE_HASH_MASK_BODY
;

483 
	}
}

485 
šlše
 
UIÁ32


486 
	$upd©e_hash_mask32
(
UIÁ32
 
h
, 
š
, 
out
, UIÁ32 
pow_n
,

487 
UIÁ32
 
b
, UIÁ32 
m
) {

488 
UPDATE_HASH_MASK_BODY
;

489 
	}
}

491 
šlše
 
UIÁ32


492 
	$upd©e_hash_mask16x2
(
UIÁ32
 
h
, 
š
, 
out
, UIÁ32 
pow1
, UIÁ32 
pow2
,

493 
UIÁ32
 
b1
, UIÁ32 
b2
) {

494  (
	`upd©e_hash_mask32
((
h
 >> 16), 
š
, 
out
, 
pow1
, 
b1
, 
BM_MASK16
) << 16) |

495 
	`upd©e_hash_mask32
((
h
 & 
BM_MASK16
), 
š
, 
out
, 
pow2
, 
b2
, BM_MASK16);

496 
	}
}

498 
šlše
 
UIÁ64


499 
	$upd©e_hash_mask32x2
(
UIÁ64
 
h
, 
š
, 
out
, UIÁ64 
pow1
, UIÁ64 
pow2
,

500 
UIÁ64
 
b1
, UIÁ64 
b2
) {

501  (
	`upd©e_hash_mask
((
h
 >> 32), 
š
, 
out
, 
pow1
, 
b1
, 
BM_MASK32
) << 32) |

502 
	`upd©e_hash_mask
((
h
 & 
BM_MASK32
), 
š
, 
out
, 
pow2
, 
b2
, BM_MASK32);

503 
	}
}

506 
size_t


507 
	$bmz_hash_mod
(cÚ¡ *
š
, 
size_t
 
š_Ën
, size_ˆ
b
, size_ˆ
m
) {

508  
	`r_hash_mod
((
By‹
 *)
š
, 
š_Ën
, 
b
, 
m
);

509 
	}
}

511 
size_t


512 
	$bmz_hash_mod16x2
(cÚ¡ *
š
, 
size_t
 
š_Ën
, size_ˆ
b1
, size_ˆ
b2
,

513 
size_t
 
m1
, size_ˆ
m2
) {

514  
	`r_hash_mod16x2
((
By‹
 *)
š
, 
š_Ën
, 
b1
, 
b2
, 
m1
, 
m2
);

515 
	}
}

517 
size_t


518 
	$bmz_hash_mask16x2
(cÚ¡ *
š
, 
size_t
 
š_Ën
, size_ˆ
b1
, size_ˆ
b2
) {

519  
	`r_hash_mask16x2
((
By‹
 *)
š
, 
š_Ën
, 
b1
, 
b2
);

520 
	}
}

522 
size_t


523 
	$bmz_hash_mask
(cÚ¡ *
š
, 
size_t
 
š_Ën
, size_ˆ
b
) {

524  
	`r_hash_mask
((
By‹
 *)
š
, 
š_Ën
, 
b
, 
BM_MASKSZ
);

525 
	}
}

527 
size_t


528 
	$bmz_hash_mask32x2
(cÚ¡ *
š
, 
size_t
 
š_Ën
, size_ˆ
b1
, size_ˆ
b2
) {

529  
	`r_hash_mask32x2
((
By‹
 *)
š
, 
š_Ën
, 
b1
, 
b2
);

530 
	}
}

533 
	#BM_HASH_CHECK_BODY
(
_š™_hash_
, 
_»hash_
, 
_upd©e_hash_
) \

534 
size_t
 
hash
; \

535 
By‹
 *
š
 = (By‹ *)
¤c
, *

 = in, *
š_’d
 = iÀ+ 
š_Ën
; \

536 
”rs
 = 0; \

538 
	`BM_CHECK
(
å_Ën
 < 
š_Ën
); \

539 
_š™_hash_
; \

541 ; 

 < 
š_’d
 - 
å_Ën
 - 1; ++ip) { \

542 
size_t
 
h0
 = 
_»hash_
; \

543 
hash
 = 
_upd©e_hash_
; \

544 ià(
h0
 !ğ
hash
) { \

545 
	`BM_LOG
(0, "mismatch‡t…os %ld: %lx vs %lx\n", \

546 ()(

 - 
š
), ()
h0
, ()
hash
); \

547 ++
”rs
; \

550 
	`BM_LOG
(1, "tÙ®ƒ¼Üs: %d\n", 
”rs
); \

551  
”rs
 ? 
BMZ_E_ERROR
 : 
BMZ_E_OK


	)

553 
	#BM_HASH_BENCH_BODY
(
_š™_hash_
, 
_upd©e_hash_
) \

554 
size_t
 
hash
; \

555 
By‹
 *
š
 = (By‹ *)
¤c
, *

 = in, *
š_’d
 = iÀ+ 
š_Ën
; \

557 
	`BM_CHECK
(
å_Ën
 < 
š_Ën
); \

558 
_š™_hash_
; \

560 ; 

 < 
š_’d
 - 
å_Ën
 - 1; ++ip) { \

561 
hash
 = 
_upd©e_hash_
; \

563 
	`BM_LOG
(1, "Ï¡ hash: %lx\n", ()
hash
è

	)

566 
	$bmz_check_hash_mod
(cÚ¡ *
¤c
, 
size_t
 
š_Ën
, size_ˆ
å_Ën
,

567 
size_t
 
b
, size_ˆ
m
) {

568 
size_t
 
pow_n
;

570 
	`BM_HASH_CHECK_BODY
(
hash
 = 
	`r_hash_mod
(
š
, 
å_Ën
, 
b
, 
m
);

571 
pow_n
 = 
	`pow_mod
(
b
, 
å_Ën
, 
m
),

572 
	`r_hash_mod
(

 + 1, 
å_Ën
, 
b
, 
m
),

573 
	`upd©e_hash_mod
(
hash
, 

[
å_Ën
], *, 
pow_n
, 
b
, 
m
));

574 
	}
}

577 
	$bmz_b’ch_hash_mod
(cÚ¡ *
¤c
, 
size_t
 
š_Ën
, size_ˆ
å_Ën
) {

578 
UIÁ64
 
b
 = 
BM_B1
, 
m
 = 
BM_MASKSZ
;

579 
size_t
 
pow_n
;

581 
	`BM_HASH_BENCH_BODY
(
hash
 = 
	`r_hash_mod
(
š
, 
å_Ën
, 
b
, 
m
);

582 
pow_n
 = 
	`pow_mod
(
b
, 
å_Ën
, 
m
),

583 
	`upd©e_hash_mod
(
hash
, 

[
å_Ën
], *, 
pow_n
, 
b
, 
m
));

584 
	}
}

587 
	$bmz_check_hash_mod16x2
(cÚ¡ *
¤c
, 
size_t
 
š_Ën
, size_ˆ
å_Ën
,

588 
size_t
 
b1
, size_ˆ
b2
, size_ˆ
m1
, size_ˆ
m2
) {

589 
size_t
 
pow_n_b1
, 
pow_n_b2
;

591 
	`BM_HASH_CHECK_BODY
(
hash
 = 
	`r_hash_mod16x2
(
š
, 
å_Ën
, 
b1
, 
b2
, 
m1
, 
m2
);

592 
pow_n_b1
 = 
	`pow_mod32
(
b1
, 
å_Ën
, 
m1
);

593 
pow_n_b2
 = 
	`pow_mod32
(
b2
, 
å_Ën
, 
m2
),

594 
	`r_hash_mod16x2
(

 + 1, 
å_Ën
, 
b1
, 
b2
, 
m1
, 
m2
),

595 
	`upd©e_hash_mod16x2
(
hash
, 

[
å_Ën
], *, 
pow_n_b1
,

596 
pow_n_b2
, 
b1
, 
b2
, 
m1
, 
m2
));

597 
	}
}

600 
	$bmz_b’ch_hash_mod16x2
(cÚ¡ *
¤c
, 
size_t
 
š_Ën
, size_ˆ
å_Ën
) {

601 
size_t
 
pow_n_b1
, 
pow_n_b2
, 
b1
 = 
BM_B1
, 
b2
 = 
BM_B2
, 
m1
 = 
BM_M1
, 
m2
 = 
BM_M2
;

603 
	`BM_HASH_BENCH_BODY
(
hash
 = 
	`r_hash_mod16x2
(
š
, 
å_Ën
, 
b1
, 
b2
, 
m1
, 
m2
);

604 
pow_n_b1
 = 
	`pow_mod32
(
b1
, 
å_Ën
, 
m1
);

605 
pow_n_b2
 = 
	`pow_mod32
(
b2
, 
å_Ën
, 
m2
),

606 
	`upd©e_hash_mod16x2
(
hash
, 

[
å_Ën
], *, 
pow_n_b1
,

607 
pow_n_b2
, 
b1
, 
b2
, 
m1
, 
m2
));

608 
	}
}

611 
	$bmz_check_hash_mask16x2
(cÚ¡ *
¤c
, 
size_t
 
š_Ën
, size_ˆ
å_Ën
,

612 
size_t
 
b1
, size_ˆ
b2
) {

613 
size_t
 
pow_n_b1
, 
pow_n_b2
;

615 
	`BM_HASH_CHECK_BODY
(
hash
 = 
	`r_hash_mask16x2
(
š
, 
å_Ën
, 
b1
, 
b2
);

616 
pow_n_b1
 = 
	`pow_mask32
(
b1
, 
å_Ën
, 
BM_MASK16
);

617 
pow_n_b2
 = 
	`pow_mask32
(
b2
, 
å_Ën
, 
BM_MASK16
),

618 
	`r_hash_mask16x2
(

 + 1, 
å_Ën
, 
b1
, 
b2
),

619 
	`upd©e_hash_mask16x2
(
hash
, 

[
å_Ën
], *, 
pow_n_b1
,

620 
pow_n_b2
, 
b1
, 
b2
));

621 
	}
}

624 
	$bmz_b’ch_hash_mask16x2
(cÚ¡ *
¤c
, 
size_t
 
š_Ën
, size_ˆ
å_Ën
) {

625 
size_t
 
pow_n_b1
, 
pow_n_b2
, 
b1
 = 
BM_B1
, 
b2
 = 
BM_B2
;

627 
	`BM_HASH_BENCH_BODY
(
hash
 = 
	`r_hash_mask16x2
(
š
, 
å_Ën
, 
b1
, 
b2
);

628 
pow_n_b1
 = 
	`pow_mask32
(
b1
, 
å_Ën
, 
BM_MASK16
);

629 
pow_n_b2
 = 
	`pow_mask32
(
b2
, 
å_Ën
, 
BM_MASK16
),

630 
	`upd©e_hash_mask16x2
(
hash
, 

[
å_Ën
], *, 
pow_n_b1
,

631 
pow_n_b2
, 
b1
, 
b2
));

632 
	}
}

635 
	$bmz_check_hash_mask
(cÚ¡ *
¤c
, 
size_t
 
š_Ën
, size_ˆ
å_Ën
,

636 
size_t
 
b
) {

637 
size_t
 
pow_n
, 
m
 = 
BM_MASKSZ
;

639 
	`BM_HASH_CHECK_BODY
(
hash
 = 
	`r_hash_mask
(
š
, 
å_Ën
, 
b
, 
m
);

640 
pow_n
 = 
	`pow_mask
(
b
, 
å_Ën
, 
m
),

641 
	`r_hash_mask
(

 + 1, 
å_Ën
, 
b
, 
m
),

642 
	`upd©e_hash_mask
(
hash
, 

[
å_Ën
], *, 
pow_n
, 
b
, 
m
));

643 
	}
}

646 
	$bmz_b’ch_hash_mask
(cÚ¡ *
¤c
, 
size_t
 
š_Ën
, size_ˆ
å_Ën
) {

647 
size_t
 
pow_n
, 
b
 = 
BM_B1
, 
m
 = 
BM_MASKSZ
;

649 
	`BM_HASH_BENCH_BODY
(
hash
 = 
	`r_hash_mask
(
š
, 
å_Ën
, 
b
, 
m
);

650 
pow_n
 = 
	`pow_mask
(
b
, 
å_Ën
, 
m
),

651 
	`upd©e_hash_mask
(
hash
, *

, ip[
å_Ën
], 
pow_n
, 
b
, 
m
));

652 
	}
}

655 
	$bmz_check_hash_mask32x2
(cÚ¡ *
¤c
, 
size_t
 
š_Ën
, size_ˆ
å_Ën
,

656 
size_t
 
b1
, size_ˆ
b2
) {

657 
size_t
 
pow_n_b1
, 
pow_n_b2
;

659 
	`BM_HASH_CHECK_BODY
(
hash
 = 
	`r_hash_mask32x2
(
š
, 
å_Ën
, 
b1
, 
b2
);

660 
pow_n_b1
 = 
	`pow_mask
(
b1
, 
å_Ën
, 
BM_MASK32
);

661 
pow_n_b2
 = 
	`pow_mask
(
b2
, 
å_Ën
, 
BM_MASK32
),

662 
	`r_hash_mask32x2
(

 + 1, 
å_Ën
, 
b1
, 
b2
),

663 
	`upd©e_hash_mask32x2
(
hash
, 

[
å_Ën
], *, 
pow_n_b1
,

664 
pow_n_b2
, 
b1
, 
b2
));

665 
	}
}

668 
	$bmz_b’ch_hash_mask32x2
(cÚ¡ *
¤c
, 
size_t
 
š_Ën
, size_ˆ
å_Ën
) {

669 
size_t
 
pow_n_b1
, 
pow_n_b2
, 
b1
 = 
BM_B1
, 
b2
 = 
BM_B2
;

671 
	`BM_HASH_BENCH_BODY
(
hash
 = 
	`r_hash_mask32x2
(
š
, 
å_Ën
, 
b1
, 
b2
);

672 
pow_n_b1
 = 
	`pow_mask
(
b1
, 
å_Ën
, 
BM_MASK32
);

673 
pow_n_b2
 = 
	`pow_mask
(
b2
, 
å_Ën
, 
BM_MASK32
),

674 
	`upd©e_hash_mask32x2
(
hash
, 

[
å_Ën
], *, 
pow_n_b1
,

675 
pow_n_b2
, 
b1
, 
b2
));

676 
	}
}

679 
	$bmz_b’ch_hash
(cÚ¡ *
š
, 
size_t
 
š_Ën
, 
ty³
) {

680 
size_t
 
å_Ën
 = 100;

682 
ty³
) {

683 
BMZ_HASH_MOD
:

684 
	`bmz_b’ch_hash_mod
(
š
, 
š_Ën
, 
å_Ën
);

686 
BMZ_HASH_MOD16X2
:

687 
	`bmz_b’ch_hash_mod16x2
(
š
, 
š_Ën
, 
å_Ën
);

689 
BMZ_HASH_MASK16X2
:

690 
	`bmz_b’ch_hash_mask16x2
(
š
, 
š_Ën
, 
å_Ën
);

692 
BMZ_HASH_MASK
:

693 
	`bmz_b’ch_hash_mask
(
š
, 
š_Ën
, 
å_Ën
);

695 
BMZ_HASH_MASK32X2
:

696 
	`bmz_b’ch_hash_mask32x2
(
š
, 
š_Ën
, 
å_Ën
);

698 
	}
}

701 
	#BM_LUT_BENCH_BODY
(
_š™_hash_
, 
_upd©e_hash_
) \

702 
size_t
 
hash
; \

703 
By‹
 *
š
 = (By‹ *)
¤c
, *

 = in, *
š_’d
 = iÀ+ 
š_Ën
; \

704 
size_t
 
sÿn_Ën
 = 
š_Ën
 - 
å_Ën
, 
c
, 
bound¬y
; \

705 
BmLut
 
lut
; \

706 
BmLutEÁry
 *
’Œy
; \

708 
	`BM_CHECK
(
å_Ën
 < 
š_Ën
); \

709 
	`š™_bmlut
(&
lut
, 
š_Ën
 / 
å_Ën
, 
wÜk_mem
); \

710 
_š™_hash_
; \

712 
bound¬y
 = 
å_Ën
; 

 < 
š_’d
 - fp_len - 1; ++ip) { \

713 
size_t
 
pos
 = 

 - 
š
; \

714 
	`BM_LOOKUP
(
lut
, 
hash
, 
’Œy
); \

716 ià(
’Œy
->
pos
 !ğ
BM_NPOS
) { \

717 ià(
	`memcmp
(
š
 + 
’Œy
->
pos
, 

, 
å_Ën
è!ğ0è++
lut
.
cŞlisiÚs
; \

719 ià(
pos
 =ğ
bound¬y
) { \

720 
’Œy
->
hash
 = hash; \

721 
’Œy
->
pos
 =…os; \

722 
bound¬y
 +ğ
å_Ën
; \

724 
hash
 = 
_upd©e_hash_
; \

726 
c
 = 
lut
.
cŞlisiÚs
; \

727 
	`BM_LOG
(1, "length: %llu,†ut.size: %llu,†ut.collisions: %llu (eff. bits: " \

728 "%.3f),†ut.´obes: %Îu (%.3f/lu)\n", (
Llu
)
š_Ën
, (Llu)
lut
.
size
, \

729 (
Llu
)
c
, c ? 
	`log
(()
š_Ën
 / 
å_Ën
 * 
sÿn_Ën
 / c) /†og(2) \

730 : (
size_t
) * 8., \

731 (
Llu
)
lut
.
´obes
, (îut.´obe / 
sÿn_Ën
)

	)

734 
	$bmz_b’ch_lut_mod
(cÚ¡ *
¤c
, 
size_t
 
š_Ën
, size_ˆ
å_Ën
,

735 *
wÜk_mem
, 
size_t
 
b
, size_ˆ
m
) {

736 
size_t
 
pow_n
;

738 
	`BM_LUT_BENCH_BODY
(
hash
 = 
	`r_hash_mod
(
š
, 
å_Ën
, 
b
, 
m
);

739 
pow_n
 = 
	`pow_mod
(
b
, 
å_Ën
, 
m
),

740 
	`upd©e_hash_mod
(
hash
, 

[
å_Ën
], *, 
pow_n
, 
b
, 
m
));

741 
	}
}

744 
	$bmz_b’ch_lut_mod16x2
(cÚ¡ *
¤c
, 
size_t
 
š_Ën
, size_ˆ
å_Ën
,

745 *
wÜk_mem
, 
size_t
 
b1
, size_ˆ
b2
,

746 
size_t
 
m1
, size_ˆ
m2
) {

747 
size_t
 
pow_n_b1
, 
pow_n_b2
;

749 
	`BM_LUT_BENCH_BODY
(
hash
 = 
	`r_hash_mod16x2
(
š
, 
å_Ën
, 
b1
, 
b2
, 
m1
, 
m2
);

750 
pow_n_b1
 = 
	`pow_mod32
(
b1
, 
å_Ën
, 
m1
);

751 
pow_n_b2
 = 
	`pow_mod32
(
b2
, 
å_Ën
, 
m2
),

752 
	`upd©e_hash_mod16x2
(
hash
, 

[
å_Ën
], *, 
pow_n_b1
,

753 
pow_n_b2
, 
b1
, 
b2
, 
m1
, 
m2
));

754 
	}
}

757 
	$bmz_b’ch_lut_mask16x2
(cÚ¡ *
¤c
, 
size_t
 
š_Ën
, size_ˆ
å_Ën
,

758 *
wÜk_mem
, 
size_t
 
b1
, size_ˆ
b2
) {

759 
size_t
 
pow_n_b1
, 
pow_n_b2
;

761 
	`BM_LUT_BENCH_BODY
(
hash
 = 
	`r_hash_mask16x2
(
š
, 
å_Ën
, 
b1
, 
b2
);

762 
pow_n_b1
 = 
	`pow_mask32
(
b1
, 
å_Ën
, 
BM_MASK16
);

763 
pow_n_b2
 = 
	`pow_mask32
(
b2
, 
å_Ën
, 
BM_MASK16
),

764 
	`upd©e_hash_mask16x2
(
hash
, 

[
å_Ën
], *, 
pow_n_b1
,

765 
pow_n_b2
, 
b1
, 
b2
));

766 
	}
}

769 
	$bmz_b’ch_lut_mask
(cÚ¡ *
¤c
, 
size_t
 
š_Ën
, size_ˆ
å_Ën
,

770 *
wÜk_mem
, 
size_t
 
b
) {

771 
size_t
 
pow_n
, 
m
 = 
BM_MASKSZ
;

773 
	`BM_LUT_BENCH_BODY
(
hash
 = 
	`r_hash_mask
(
š
, 
å_Ën
, 
b
, 
m
);

774 
pow_n
 = 
	`pow_mask
(
b
, 
å_Ën
, 
m
),

775 
	`upd©e_hash_mask
(
hash
, *

, ip[
å_Ën
], 
pow_n
, 
b
, 
m
));

776 
	}
}

779 
	$bmz_b’ch_lut_mask32x2
(cÚ¡ *
¤c
, 
size_t
 
š_Ën
, size_ˆ
å_Ën
,

780 *
wÜk_mem
, 
size_t
 
b1
, size_ˆ
b2
) {

781 
size_t
 
pow_n_b1
, 
pow_n_b2
;

783 
	`BM_LUT_BENCH_BODY
(
hash
 = 
	`r_hash_mask32x2
(
š
, 
å_Ën
, 
b1
, 
b2
);

784 
pow_n_b1
 = 
	`pow_mask
(
b1
, 
å_Ën
, 
BM_MASK32
);

785 
pow_n_b2
 = 
	`pow_mask
(
b2
, 
å_Ën
, 
BM_MASK32
),

786 
	`upd©e_hash_mask32x2
(
hash
, 

[
å_Ën
], *, 
pow_n_b1
,

787 
pow_n_b2
, 
b1
, 
b2
));

788 
	}
}

794 
	#BM_NEED_IN
(
_n_
) \

795 ià(()(
š_’d
 - 

è< ()(
_n_
)è
šput_ov”run


	)

797 
	#BM_NEED_OUT
(
_n_
) \

798 ià(()(
out_’d
 - 
İ
è< ()(
_n_
)è
ouut_ov”run


	)

800 
	#BM_ENCODE_OUTPUT
(
_İ_
, 
__
, 
__’d_
) \

801 
__
 < 
__’d_
) { \

802 ià(*
__
 =ğ
BM_ESC
) { \

803 
	`BM_NEED_OUT
(1); \

804 *
_İ_
++ = 
BM_ESC
; \

806 
	`BM_NEED_OUT
(1); \

807 *
_İ_
++ = *
__
++; \

808 }

	)

811 
	#BM_ENCODE_FINAL_OUTPUT
(
_İ_
, 
__
, 
__’d_
) \

812 
	`BM_NEED_OUT
((
__’d_
è- (
__
)); \

813 
__
 < 
__’d_
) { \

814 ià(*
__
 =ğ
BM_ESC
) { \

815 
	`BM_NEED_OUT
((
__’d_
è- (
__
) + 1); \

816 *
_İ_
++ = 
BM_ESC
; \

818 *
_İ_
++ = *
__
++; \

819 }

	)

821 
	#BM_ENCODE_PASS
 do { \

822 *
out
 = 0; \

823 
	`memıy
(
out
 + 1, 
š
, 
š_Ën
); \

824 *
out_Ën_p
 = 
š_Ën
 + 1; \

825 
	`BM_ENCODE_STAT
("no„eduction"); \

826  
BMZ_E_OK
; \

827 } 0)

	)

829 
	#BM_ENCODE_INT
(
_İ_
, 
_n_
, 
_width_
) do { \

830 
UIÁ64
 
_n
 = 
_n_
; \

831 
_width_
) { \

833 *
_İ_
++ = (
By‹
è
_n
; \

836 *
_İ_
++ = (
By‹
)(
_n
 >> 8); \

837 *
_İ_
++ = (
By‹
)(
_n
); \

840 *
_İ_
++ = (
By‹
)(
_n
 >> 16); \

841 *
_İ_
++ = (
By‹
)(
_n
 >> 8); \

842 *
_İ_
++ = (
By‹
)(
_n
); \

845 *
_İ_
++ = (
By‹
)(
_n
 >> 24); \

846 *
_İ_
++ = (
By‹
)(
_n
 >> 16); \

847 *
_İ_
++ = (
By‹
)(
_n
 >> 8); \

848 *
_İ_
++ = (
By‹
)(
_n
); \

851 *
_İ_
++ = (
By‹
)(
_n
 >> 32); \

852 *
_İ_
++ = (
By‹
)(
_n
 >> 24); \

853 *
_İ_
++ = (
By‹
)(
_n
 >> 16); \

854 *
_İ_
++ = (
By‹
)(
_n
 >> 8); \

855 *
_İ_
++ = (
By‹
)(
_n
); \

858 *
_İ_
++ = (
By‹
)(
_n
 >> 40); \

859 *
_İ_
++ = (
By‹
)(
_n
 >> 32); \

860 *
_İ_
++ = (
By‹
)(
_n
 >> 24); \

861 *
_İ_
++ = (
By‹
)(
_n
 >> 16); \

862 *
_İ_
++ = (
By‹
)(
_n
 >> 8); \

863 *
_İ_
++ = (
By‹
)(
_n
); \

866 
	`BM_DIE
("%s", "256TB oughto beƒnough for‡nyone!"); \

868 } 0)

	)

870 
	#BM_ENCODE_VINT
(
_İ_
, 
_n_
, 
_width_
) do { \

871 
UIÁ64
 
_n
 = 
_n_
; \

872 
_width_
) { \

874 *
_İ_
++ = (
By‹
)((
_n
) & 0x7f); \

877 *
_İ_
++ = (
By‹
)(
_n
 | 0x80); \

878 *
_İ_
++ = (
By‹
)((
_n
 >> 7) & 0x7f); \

881 *
_İ_
++ = (
By‹
)(
_n
 | 0x80); \

882 *
_İ_
++ = (
By‹
)((
_n
 >> 7) | 0x80); \

883 *
_İ_
++ = (
By‹
)((
_n
 >> 14) & 0x7f); \

886 *
_İ_
++ = (
By‹
)(
_n
 | 0x80); \

887 *
_İ_
++ = (
By‹
)((
_n
 >> 7) | 0x80); \

888 *
_İ_
++ = (
By‹
)((
_n
 >> 14) | 0x80); \

889 *
_İ_
++ = (
By‹
)((
_n
 >> 21) & 0x7f); \

892 *
_İ_
++ = (
By‹
)(
_n
 | 0x80); \

893 *
_İ_
++ = (
By‹
)((
_n
 >> 7) | 0x80); \

894 *
_İ_
++ = (
By‹
)((
_n
 >> 14) | 0x80); \

895 *
_İ_
++ = (
By‹
)((
_n
 >> 21) | 0x80); \

896 *
_İ_
++ = (
By‹
)((
_n
 >> 28) & 0x7f); \

899 *
_İ_
++ = (
By‹
)(
_n
 | 0x80); \

900 *
_İ_
++ = (
By‹
)((
_n
 >> 7) | 0x80); \

901 *
_İ_
++ = (
By‹
)((
_n
 >> 14) | 0x80); \

902 *
_İ_
++ = (
By‹
)((
_n
 >> 21) | 0x80); \

903 *
_İ_
++ = (
By‹
)((
_n
 >> 28) | 0x80); \

904 *
_İ_
++ = (
By‹
)((
_n
 >> 35) & 0x7f); \

907 *
_İ_
++ = (
By‹
)(
_n
 | 0x80); \

908 *
_İ_
++ = (
By‹
)((
_n
 >> 7) | 0x80); \

909 *
_İ_
++ = (
By‹
)((
_n
 >> 14) | 0x80); \

910 *
_İ_
++ = (
By‹
)((
_n
 >> 21) | 0x80); \

911 *
_İ_
++ = (
By‹
)((
_n
 >> 28) | 0x80); \

912 *
_İ_
++ = (
By‹
)((
_n
 >> 35) | 0x80); \

913 *
_İ_
++ = (
By‹
)((
_n
 >> 42) & 0x7f); \

916 
	`BM_DIE
("%s", "512TB oughto beƒnough for‡nyone!"); \

918 } 0)

	)

920 
	#BM_DECODE_VINT
(
_n_
) do { \

921 
	`BM_NEED_IN
(1); \

922 
_n_
 = (*

++ & 0x7f); \

923 ià(

[-1] & 0x80) { \

924 
	`BM_NEED_IN
(1); \

925 
_n_
 |ğ((*

++ & 0x7f) << 7); \

927 ià(

[-1] & 0x80) { \

928 
	`BM_NEED_IN
(1); \

929 
_n_
 |ğ((*

++ & 0x7f) << 14); \

931 ià(

[-1] & 0x80) { \

932 
	`BM_NEED_IN
(1); \

933 
_n_
 |ğ((*

++ & 0x7f) << 21); \

935 ià(

[-1] & 0x80) { \

936 
	`BM_NEED_IN
(1); \

937 
_n_
 |ğ((
UIÁ64
)(*

++ & 0x7f) << 28); \

939 ià(

[-1] & 0x80) { \

940 
	`BM_NEED_IN
(1); \

941 
_n_
 |ğ((
UIÁ64
)(*

++ & 0x7f) << 35); \

943 ià(

[-1] & 0x80) { \

944 
	`BM_NEED_IN
(1); \

945 
_n_
 |ğ((
UIÁ64
)(*

++ & 0x7f) << 42); \

947 } 0)

	)

949 
	#BM_INT_WIDTH
(
_n_
) \

950 (
_n_
 > 
BM_MAX_5B
 ? 6 : \

951 (
_n_
 > 
BM_MAX_4B
 ? 5 : \

952 (
_n_
 > 
BM_MAX_3B
 ? 4 : \

953 (
_n_
 > 
BM_MAX_2B
 ? 3 : \

954 (
_n_
 > 
BM_MAX_1B
 ? 2 : 1)))))

	)

956 
	#BM_VINT_WIDTH
(
_n_
) \

957 (
_n_
 > 
BM_MAX_V6B
 ? 7 : \

958 (
_n_
 > 
BM_MAX_V5B
 ? 6 : \

959 (
_n_
 > 
BM_MAX_V4B
 ? 5 : \

960 (
_n_
 > 
BM_MAX_V3B
 ? 4 : \

961 (
_n_
 > 
BM_MAX_V2B
 ? 3 : \

962 (
_n_
 > 
BM_MAX_V1B
 ? 2 : 1))))))

	)

964 
	#BM_ENCODE_DELTA
(
_İ_
, 
_os_
, 
_pos_
, 
_Ën_
) do { \

965 
UIÁ64
 
_os
 = 
_os_
, 
_Ën
 = 
_Ën_
; \

966 
pos_w
 = 
	`BM_INT_WIDTH
(
_os
); \

967 
Ën_w
 = 
	`BM_VINT_WIDTH
(
_Ën
); \

968 
	`BM_NEED_OUT
(
pos_w
 + 
Ën_w
 + 1); \

969 *
_İ_
++ = 
BM_ESC
; \

970 
	`BM_ENCODE_INT
(
_İ_
, 
_pos_
, 
pos_w
); \

971 
	`BM_ENCODE_VINT
(
_İ_
, 
_Ën_
, 
Ën_w
); \

972 } 0)

	)

974 
	#BM_HANDLE_COLLISIONS
(
_¿ndomize_
, 
_š™_hash_
) do { \

975 
size_t
 
ad­ts
 = 
lut
.ad­ts, 
cŞlisiÚs
 = ++lut.collisions; \

977 ià(
ad­ts
 > 
BM_COLLISION_ABORT_THRESH
) { \

979 
	`BM_LOG
(1, "too much collisions: %llu, giving up.\n", \

980 (
Llu
)
BM_ABORT_COLLISIONS
); \

981 
ouut_ov”run
; \

983 ià(
cŞlisiÚs
 > 
cŞlisiÚ_th»sh
) { \

987 
	`BM_LOG
(2, "hash cŞlisiÚ %Îu: %Îx:…os: %Îu‡nd %Îu: [" 
BM_COLOR_DBG
, \

988 (
Llu
)
lut
.
cŞlisiÚs
, (Llu)
hash
, (Llu)
pos
, (Llu)
i
); \

989 
	`BM_LOG_
(2, 
š
 + 
pos
, 
å_Ën
); \

990 
	`BM_LOG
(2, "%s", 
BM_COLOR_END
 "] v [" 
BM_COLOR_ALT
); \

991 
	`BM_LOG_
(2, 
š
 + 
i
, 
å_Ën
); \

992 
	`BM_LOG
(2, "%s", 
BM_COLOR_END
 "]ryingo‡dapt.\n"); \

993 
_¿ndomize_
; \

994 
bound¬y
 = 
Ï¡_i
 = 
i
 = 
off£t
; \

995 
_š™_hash_
; \

996 
	`š™_bmlut
(&
lut
, 
š_Ën
 / 
å_Ën
, 
wÜk_mem
); \

997 
lut
.
ad­ts
 =‡dapts + 1; \

998 
İ
 = 
out
 + 1; \

999 
Ï¡_
 = 
š
; \

1002 } 0)

	)

1004 
	#BM_ENCODE_STAT
(
_msg_
) do { \

1005 
size_t
 
c
 = 
lut
.
cŞlisiÚs
; \

1006 
	`BM_LOG
(1, "%s: in: %llu, out: %llu,†ut.collisions: %llu (eff. bits: %.3f) " \

1007 "th»sh: %Îu),†ut.´obes: %Îu (%.3f/lu)\n", 
_msg_
, (
Llu
)
š_Ën
, \

1008 (
Llu
)*
out_Ën_p
, (Llu)
c
, \

1009 
c
 ? 
	`log
(()
nås
 * 
sÿn_Ën
 / cè/†og(2è: (
size_t
) * 8., \

1010 (
Llu
)
cŞlisiÚ_th»sh
, (Llu)
lut
.
´obes
, \

1011 ()
lut
.
´obes
 / 
sÿn_Ën
); \

1012 } 0)

	)

1015 
	#BM_ENCODE_BODY
(
_š™_hash_
, 
_upd©e_hash_
, 
_¿ndomize_
) \

1016 
size_t
 
i
 = 
off£t
, 
Ï¡_i
 = i, 
’d_i
 = 
š_Ën
 - 
å_Ën
; \

1017 
size_t
 
bound¬y
 = 
i
, 
sÿn_Ën
 = 
’d_i
 - 
off£t
; \

1018 
size_t
 
nås
, 
hash
, 
pos
, 
cŞlisiÚ_th»sh
; \

1019 
By‹
 *
š
 = (By‹ *è
¤c
, *
out
 = (By‹ *è
d¡
; \

1020 
By‹
 *

 = 
š
, *
Ï¡_
 = ip, *
š_’d
 = iÀ+ 
š_Ën
; \

1021 
By‹
 *
İ
 = 
out
, *
out_’d
; \

1022 
BmLut
 
lut
 = { 0, 0, 0, 0, 
NULL
 }; \

1023 
BmLutEÁry
 *
’Œy
 = 
NULL
; \

1025 
	`BM_CHECK
(
å_Ën
 > 0); \

1026 
nås
 = 
š_Ën
 / 
å_Ën
; \

1027 
cŞlisiÚ_th»sh
 = 
s_cŞlisiÚ_th»sh
 ? s_collision_thresh \

1028 : 
sÿn_Ën
 / 1e9 * 
nås
 + 8; \

1029 ià(
š_Ën
 <ğ
off£t
 + 
å_Ën
è
BM_ENCODE_PASS
; \

1031 
	`š™_bmlut
(&
lut
, 
nås
, 
wÜk_mem
); \

1032 
_š™_hash_
; \

1034 *
İ
++ = 1; \

1035 
out_’d
 = 
İ
 + (*
out_Ën_p
 < 
š_Ën
 ? *out_len_p : in_len); \

1037 ; 
i
 <ğ
’d_i
; ++i) { \

1038 ià(
i
 > 
Ï¡_i
) { \

1039 
	`BM_LOOKUP
(
lut
, 
hash
, 
’Œy
); \

1040 
pos
 = 
’Œy
->pos; \

1042 ià(
pos
 !ğ
BM_NPOS
) { \

1043 
By‹
 *
0
 = 
š
 + 
pos
, *
ı
 = iÀ+ 
i
, *
ı0
 = cp; \

1044 
By‹
 *
1
 = 
0
 + 
å_Ën
, *
ı1
 = 
ı0
 + fp_len; \

1046 ià(
	`memcmp
(
0
, 
ı0
, 
å_Ën
) == 0) { \

1048 
size_t
 
mËn
 = 0; \

1050 

 = 
0
; i°> 
š
 && 
ı
 > 
Ï¡_
 && \

1051 
mËn
 < 
å_Ën
 - 1 && *--

 =ğ*--
ı
; ++mlen); \

1052 
ı
 = 
ı0
 - 
mËn
; \

1053 
	`BM_ENCODE_OUTPUT
(
İ
, 
Ï¡_
, 
ı
); \

1054 
pos
 = 
0
 - 
mËn
 - 
š
; \

1055 
mËn
 +ğ
å_Ën
; \

1057 

 = 
1
, 
ı
 = 
ı1
; c°< 
š_’d
 && *++ =ğ*ı++; ++
mËn
); \

1058 
	`BM_ENCODE_DELTA
(
İ
, 
Ï¡_
 - 
š
, 
pos
, 
mËn
); \

1059 
Ï¡_
 = 
ı0
 - (
0
 - (
š
 + 
pos
)è+ 
mËn
; \

1060 ià(
Ï¡_
 =ğ
š_’d
) ; \

1061 
Ï¡_i
 = 
Ï¡_
 - 
š
; \

1063 
	`BM_HANDLE_COLLISIONS
(
_¿ndomize_
, 
_š™_hash_
); \

1066 ià((
i
 - 
off£t
è=ğ
bound¬y
) { \

1067 ià(
i
 <ğ
Ï¡_i
è
	`BM_LOOKUP
(
lut
, 
hash
, 
’Œy
); \

1069 
’Œy
->
hash
 = hash; \

1070 
’Œy
->
pos
 = 
i
; \

1071 
bound¬y
 +ğ
å_Ën
; \

1073 ià(
i
 < 
’d_i
è
hash
 = 
_upd©e_hash_
; \

1076 
	`BM_ENCODE_FINAL_OUTPUT
(
İ
, 
Ï¡_
, 
š_’d
); \

1077 *
out_Ën_p
 = 
İ
 - 
out
; \

1078 
	`BM_ENCODE_STAT
("success"); \

1080  
BMZ_E_OK
; \

1082 
ouut_ov”run
: \

1083 ià(*
out_Ën_p
 > 
š_Ën
è
BM_ENCODE_PASS
; \

1084 
	`BM_ENCODE_STAT
("tip: make output buffer‡t†east input†ength + 1"); \

1085  
BMZ_E_OUTPUT_OVERRUN


	)

1089 
	$bmz_bm_·ck_mod
(cÚ¡ *
¤c
, 
size_t
 
š_Ën
, *
d¡
, size_ˆ*
out_Ën_p
,

1090 
size_t
 
off£t
, size_ˆ
å_Ën
, *
wÜk_mem
,

1091 
size_t
 
b
, size_ˆ
m
) {

1092 
size_t
 
pow_n
;

1093 
	`BM_ENCODE_BODY
(
hash
 = 
	`r_hash_mod
(
š
 + 
i
, 
å_Ën
, 
b
, 
m
);

1094 
pow_n
 = 
	`pow_mod
(
b
, 
å_Ën
, 
m
),

1095 
	`upd©e_hash_mod
(
hash
, 
š
[
i
 + 
å_Ën
], in[i], 
pow_n
, 
b
, 
m
),

1096 
b
 = 
	`¿ndom_´ime
(0));

1097 
	}
}

1100 
	$bmz_bm_·ck_mod16x2
(cÚ¡ *
¤c
, 
size_t
 
š_Ën
, *
d¡
,

1101 
size_t
 *
out_Ën_p
, size_ˆ
off£t
, size_ˆ
å_Ën
,

1102 *
wÜk_mem
, 
size_t
 
b1
, size_ˆ
b2
,

1103 
size_t
 
m1
, size_ˆ
m2
) {

1104 
size_t
 
pow_n_b1
, 
pow_n_b2
;

1105 
	`BM_ENCODE_BODY
(
hash
 = 
	`r_hash_mod16x2
(
š
 + 
i
, 
å_Ën
, 
b1
, 
b2
, 
m1
, 
m2
);

1106 
pow_n_b1
 = 
	`pow_mod32
(
b1
, 
å_Ën
, 
m1
);

1107 
pow_n_b2
 = 
	`pow_mod32
(
b2
, 
å_Ën
, 
m2
),

1108 
	`upd©e_hash_mod16x2
(
hash
, 
š
[
i
 + 
å_Ën
], in[i],

1109 
pow_n_b1
, 
pow_n_b2
, 
b1
, 
b2
, 
m1
, 
m2
),

1110 
b1
 = 
	`¿ndom_´ime
(0);

1111 
b2
 = 
	`¿ndom_´ime
(
b1
));

1112 
	}
}

1115 
	$bmz_bm_·ck_mask16x2
(cÚ¡ *
¤c
, 
size_t
 
š_Ën
, *
d¡
,

1116 
size_t
 *
out_Ën_p
, size_ˆ
off£t
, size_ˆ
å_Ën
,

1117 *
wÜk_mem
, 
size_t
 
b1
, size_ˆ
b2
) {

1118 
size_t
 
pow_n_b1
, 
pow_n_b2
;

1119 
	`BM_ENCODE_BODY
(
hash
 = 
	`r_hash_mask16x2
(
š
 + 
i
, 
å_Ën
, 
b1
, 
b2
);

1120 
pow_n_b1
 = 
	`pow_mask32
(
b1
, 
å_Ën
, 
BM_MASK16
);

1121 
pow_n_b2
 = 
	`pow_mask32
(
b2
, 
å_Ën
, 
BM_MASK16
),

1122 
	`upd©e_hash_mask16x2
(
hash
, 
š
[
i
 + 
å_Ën
], in[i],

1123 
pow_n_b1
, 
pow_n_b2
, 
b1
, 
b2
),

1124 
b1
 = 
	`¿ndom_´ime
(0);

1125 
b2
 = 
	`¿ndom_´ime
(
b1
));

1126 
	}
}

1129 
	$bmz_bm_·ck_mask
(cÚ¡ *
¤c
, 
size_t
 
š_Ën
, *
d¡
, size_ˆ*
out_Ën_p
,

1130 
size_t
 
off£t
, size_ˆ
å_Ën
, *
wÜk_mem
, size_ˆ
b
) {

1131 
size_t
 
pow_n
;

1132 
	`BM_ENCODE_BODY
(
hash
 = 
	`r_hash_mask
(
š
 + 
i
, 
å_Ën
, 
b
, 
BM_MASKSZ
);

1133 
pow_n
 = 
	`pow_mask
(
b
, 
å_Ën
, 
BM_MASKSZ
),

1134 
	`upd©e_hash_mask
(
hash
, 
š
[
i
 + 
å_Ën
], in[i],

1135 
pow_n
, 
b
, 
BM_MASKSZ
),

1136 
b
 = 
	`¿ndom_´ime
(0));

1137 
	}
}

1140 
	$bmz_bm_·ck_mask32x2
(cÚ¡ *
¤c
, 
size_t
 
š_Ën
, *
d¡
,

1141 
size_t
 *
out_Ën_p
, size_ˆ
off£t
, size_ˆ
å_Ën
,

1142 *
wÜk_mem
, 
size_t
 
b1
, size_ˆ
b2
) {

1143 
size_t
 
pow_n_b1
, 
pow_n_b2
;

1144 
	`BM_ENCODE_BODY
(
hash
 = 
	`r_hash_mask32x2
(
š
 + 
i
, 
å_Ën
, 
b1
, 
b2
);

1145 
pow_n_b1
 = 
	`pow_mask
(
b1
, 
å_Ën
, 
BM_MASK32
);

1146 
pow_n_b2
 = 
	`pow_mask
(
b2
, 
å_Ën
, 
BM_MASK32
),

1147 
	`upd©e_hash_mask32x2
(
hash
, 
š
[
i
 + 
å_Ën
], in[i],

1148 
pow_n_b1
, 
pow_n_b2
, 
b1
, 
b2
),

1149 
b1
 = 
	`¿ndom_´ime
(0);

1150 
b2
 = 
	`¿ndom_´ime
(
b1
));

1151 
	}
}

1154 
	#BM_LZ_MAX
(
_Ën_
è((_Ën_è/ 16 + 64 + 3)

	)

1156 
size_t


1157 
	$bmz_·ck_buæ’
(
size_t
 
š_Ën
) {

1158  
š_Ën
 + 
	`BM_LZ_MAX
(in_len) + 1;

1159 
	}
}

1164 
size_t


1165 
	$bmz_bm_·ck_wÜkËn
(
size_t
 
š_Ën
, size_ˆ
å_Ën
) {

1166  
	`bm_lut_size
(
š_Ën
 / 
å_Ën
è* (
BmLutEÁry
);

1167 
	}
}

1170 
size_t


1171 
	$bmz_·ck_auxËn
(
size_t
 
š_Ën
, size_ˆ
å_Ën
) {

1172 
size_t
 
lz_wÜkËn
 = 
	`bmz_lz_·ck_wÜkËn
(
š_Ën
) + 16;

1173 
size_t
 
bm_wÜkËn
 = 
	`bmz_bm_·ck_wÜkËn
(
š_Ën
, 
å_Ën
) + 16;

1174  
bm_wÜkËn
 > 
lz_wÜkËn
 ? bm_worklen :†z_worklen;

1175 
	}
}

1178 
size_t


1179 
	$bmz_·ck_wÜkËn
(
size_t
 
š_Ën
, size_ˆ
å_Ën
) {

1180 
	`BM_CHECK
(
å_Ën
 > 0);

1181  
š_Ën
 + 
	`bmz_·ck_auxËn
(š_Ën, 
å_Ën
);

1182 
	}
}

1184 
size_t


1185 
	$bmz_uÅack_wÜkËn
(
size_t
 
out_Ën
) {

1186  
out_Ën
 + 1;

1187 
	}
}

1189 
	#BMZ_PACK_BODY
(
_bm_·ck_
) \

1190 
size_t
 
’
 = 
š_Ën
 + 1; \

1191 
By‹
 *
d¡
 = (By‹ *)
wÜk_mem
; \

1192 
By‹
 *
aux_mem
 = 
d¡
 + 
’
; \

1193 
By‹
 *
wÜk_mem_®igÃd
 = 
	`BM_ALIGN
(
aux_mem
, 8); \

1194 
»t
; \

1202 
»t
 = 
_bm_·ck_
; \

1203 ià(
»t
 !ğ
BMZ_E_OK
) „et; \

1204  
	`bmz_lz_·ck
(
d¡
, 
’
, 
out
, 
out_Ën_p
, 
wÜk_mem_®igÃd
)

	)

1207 
	$bmz_·ck_mod
(cÚ¡ *
š
, 
size_t
 
š_Ën
, *
out
, size_ˆ*
out_Ën_p
,

1208 
size_t
 
off£t
, size_ˆ
å_Ën
, 
æags
, *
wÜk_mem
,

1209 
size_t
 
b
, size_ˆ
m
) {

1210 
	`BMZ_PACK_BODY
(
	`bmz_bm_·ck_mod
(
š
, 
š_Ën
, 
d¡
, &
’
,

1211 
off£t
, 
å_Ën
, 
wÜk_mem_®igÃd
, 
b
, 
m
));

1212 
	}
}

1215 
	$bmz_·ck_mod16x2
(cÚ¡ *
š
, 
size_t
 
š_Ën
, *
out
, size_ˆ*
out_Ën_p
,

1216 
size_t
 
off£t
, size_ˆ
å_Ën
, 
æags
, *
wÜk_mem
,

1217 
size_t
 
b1
, size_ˆ
b2
, size_ˆ
m1
, size_ˆ
m2
) {

1218 
	`BMZ_PACK_BODY
(
	`bmz_bm_·ck_mod16x2
(
š
, 
š_Ën
, 
d¡
, &
’
,

1219 
off£t
, 
å_Ën
, 
wÜk_mem_®igÃd
, 
b1
, 
b2
, 
m1
, 
m2
));

1220 
	}
}

1223 
	$bmz_·ck_mask16x2
(cÚ¡ *
š
, 
size_t
 
š_Ën
, *
out
, size_ˆ*
out_Ën_p
,

1224 
size_t
 
off£t
, size_ˆ
å_Ën
, 
æags
, *
wÜk_mem
,

1225 
size_t
 
b1
, size_ˆ
b2
) {

1226 
	`BMZ_PACK_BODY
(
	`bmz_bm_·ck_mask16x2
(
š
, 
š_Ën
, 
d¡
, &
’
,

1227 
off£t
, 
å_Ën
, 
wÜk_mem_®igÃd
, 
b1
, 
b2
));

1228 
	}
}

1231 
	$bmz_·ck_mask
(cÚ¡ *
š
, 
size_t
 
š_Ën
, *
out
, size_ˆ*
out_Ën_p
,

1232 
size_t
 
off£t
, size_ˆ
å_Ën
, 
æags
, *
wÜk_mem
,

1233 
size_t
 
b
) {

1234 
	`BMZ_PACK_BODY
(
	`bmz_bm_·ck_mask
(
š
, 
š_Ën
, 
d¡
, &
’
,

1235 
off£t
, 
å_Ën
, 
wÜk_mem_®igÃd
, 
b
));

1236 
	}
}

1239 
	$bmz_·ck_mask32x2
(cÚ¡ *
š
, 
size_t
 
š_Ën
, *
out
, size_ˆ*
out_Ën_p
,

1240 
size_t
 
off£t
, size_ˆ
å_Ën
, 
æags
, *
wÜk_mem
,

1241 
size_t
 
b1
, size_ˆ
b2
) {

1242 
	`BMZ_PACK_BODY
(
	`bmz_bm_·ck_mask32x2
(
š
, 
š_Ën
, 
d¡
, &
’
,

1243 
off£t
, 
å_Ën
, 
wÜk_mem_®igÃd
, 
b1
, 
b2
));

1244 
	}
}

1247 
	$bmz_·ck
(cÚ¡ *
š
, 
size_t
 
š_Ën
, *
out
, size_ˆ*
out_Ën_p
,

1248 
size_t
 
off£t
, size_ˆ
å_Ën
, 
æags
, *
wÜk_mem
) {

1249 
æags
 >> 24) {

1250 
BMZ_HASH_MOD
:

1251  
	`bmz_·ck_mod
(
š
, 
š_Ën
, 
out
, 
out_Ën_p
, 
off£t
, 
å_Ën
, 
æags
,

1252 
wÜk_mem
, 
BM_B1
, 
BM_M1
);

1253 
BMZ_HASH_MOD16X2
:

1254  
	`bmz_·ck_mod16x2
(
š
, 
š_Ën
, 
out
, 
out_Ën_p
, 
off£t
, 
å_Ën
, 
æags
,

1255 
wÜk_mem
, 
BM_B1
, 
BM_B2
, 
BM_M1
, 
BM_M2
);

1256 
BMZ_HASH_MASK16X2
:

1257  
	`bmz_·ck_mask16x2
(
š
, 
š_Ën
, 
out
, 
out_Ën_p
, 
off£t
, 
å_Ën
, 
æags
,

1258 
wÜk_mem
, 
BM_B1
, 
BM_B2
);

1260 
BMZ_HASH_MASK
:

1261  
	`bmz_·ck_mask
(
š
, 
š_Ën
, 
out
, 
out_Ën_p
, 
off£t
, 
å_Ën
, 
æags
,

1262 
wÜk_mem
, 
BM_B1
);

1263 
BMZ_HASH_MASK32X2
:

1264  
	`bmz_·ck_mask32x2
(
š
, 
š_Ën
, 
out
, 
out_Ën_p
, 
off£t
, 
å_Ën
, 
æags
,

1265 
wÜk_mem
, 
BM_B1
, 
BM_B2
);

1267 
	`BM_DIE
("unknowÀhash‡lgÜ™hm: %u", (
æags
 >> 24));

1269  
BMZ_E_ERROR
;

1270 
	}
}

1273 
	$bmz_uÅack
(cÚ¡ *
š
, 
size_t
 
š_Ën
, *
out
, size_ˆ*
out_Ën_p
,

1274 *
wÜk_mem
) {

1275 
By‹
 *
d¡
 = (By‹ *)
wÜk_mem
;

1276 
size_t
 
’
 = *
out_Ën_p
 + 1;

1277 
»t
;

1279 
»t
 = 
	`bmz_lz_uÅack
((
By‹
 *)
š
, 
š_Ën
, 
d¡
, &
’
);

1280 ià(
»t
 !ğ
BMZ_E_OK
) „et;

1281  
	`bmz_bm_uÅack
(
d¡
, 
’
, 
out
, 
out_Ën_p
);

1282 
	}
}

1285 
	#BM_DECODE_POS
(
_ıos_
, 
_n_
) do { \

1286 
UIÁ64
 
_os
 = 
_ıos_
; \

1287 
w
 = 
	`BM_INT_WIDTH
(
_os
); \

1288 
	`BM_NEED_IN
(
w
); \

1290 
w
) { \

1292 
_n_
 = *

++; \

1295 
_n_
 = (*

++ << 8); \

1296 
_n_
 |ğ*

++; \

1299 
_n_
 = (*

++ << 16); \

1300 
_n_
 |ğ(*

++ << 8); \

1301 
_n_
 |ğ*

++; \

1304 
_n_
 = (*

++ << 24); \

1305 
_n_
 |ğ(*

++ << 16); \

1306 
_n_
 |ğ(*

++ << 8); \

1307 
_n_
 |ğ*

++; \

1310 
_n_
 = ((
UIÁ64
)*

++ << 32); \

1311 
_n_
 |ğ(*

++ << 24); \

1312 
_n_
 |ğ(*

++ << 16); \

1313 
_n_
 |ğ(*

++ << 8); \

1314 
_n_
 |ğ*

++; \

1317 
_n_
 = ((
UIÁ64
)*

++ << 40); \

1318 
_n_
 |ğ((
UIÁ64
)*

++ << 32); \

1319 
_n_
 |ğ(*

++ << 24); \

1320 
_n_
 |ğ(*

++ << 16); \

1321 
_n_
 |ğ(*

++ << 8); \

1322 
_n_
 |ğ*

++; \

1324 
	`BM_DIE
("%s", "256TB oughto beƒnough for‡nyone!"); \

1326 } 0)

	)

1328 
	#BM_DECODE_LEN
(
_n_
è
	`BM_DECODE_VINT
(_n_)

	)

1331 
	$bmz_bm_uÅack
(cÚ¡ *
¤c
, 
size_t
 
š_Ën
, *
d¡
, size_ˆ*
out_Ën_p
) {

1332 
By‹
 *
š
 = (By‹ *)
¤c
, *
out
 = (By‹ *)
d¡
;

1333 
By‹
 *

 = 
š
, *
Ï¡_
 = i°+ 1, *
İ
 = 
out
, *
ı
;

1334 
By‹
 *
š_’d
 = 

 + 
š_Ën
, *
out_’d
 = 
İ
 + *
out_Ën_p
;

1335 
»mašs
;

1337 ià(*

++ == 0) {

1338 
	`memıy
(
out
, 

, --
š_Ën
);

1339 *
out_Ën_p
 = 
š_Ën
;

1340  
BMZ_E_OK
;

1343 

 < 
š_’d
) {

1344 ià(*

 =ğ
BM_ESC
) {

1345 
UIÁ64
 
Ën
 = 

 - 
Ï¡_
, 
pos
 = 0;

1347 ià(
Ën
) {

1348 
	`BM_NEED_OUT
(
Ën
);

1349 
	`memıy
(
İ
, 
Ï¡_
, 
Ën
);

1350 
İ
 +ğ
Ën
;

1351 
Ï¡_
 = 

;

1353 
	`BM_NEED_IN
(1);

1355 ià(

[1] =ğ
BM_ESC
) {

1356 ++
Ï¡_
;

1357 

 += 2;

1360 ++

;

1361 
	`BM_DECODE_POS
(
İ
 - 
out
, 
pos
);

1362 
	`BM_DECODE_LEN
(
Ën
);

1363 
	`BM_NEED_OUT
(
Ën
);

1364 
Ï¡_
 = 

;

1365 
ı
 = 
out
 + 
pos
;

1367 
Ën
--è*
İ
++ = *
ı
++;

1370 ++

;

1372 
»mašs
 = 
š_’d
 - 
Ï¡_
;

1373 
	`BM_NEED_OUT
(
»mašs
);

1374 
	`memıy
(
İ
, 
Ï¡_
, 
»mašs
);

1375 *
out_Ën_p
 = 
İ
 - 
out
 + 
»mašs
;

1377  
BMZ_E_OK
;

1379 
šput_ov”run
:

1380 *
out_Ën_p
 = 
İ
 - 
out
;

1381  
BMZ_E_INPUT_OVERRUN
;

1383 
ouut_ov”run
:

1384 *
out_Ën_p
 = 
İ
 - 
out
;

1385  
BMZ_E_OUTPUT_OVERRUN
;

1386 
	}
}

1389 
	$bmz_bm_dump
(cÚ¡ *
¤c
, 
size_t
 
š_Ën
) {

1390 
By‹
 *
š
 = (By‹ *)
¤c
, *

 = in, *
š_’d
 = i°+ 
š_Ën
;

1391 
UIÁ64
 
pos
 = 0, 
Ën
, 
ıos
 = 0, 
tÙ_±e_sz
 = 0, 
tÙ_±r_sz
 = 0, 
ÅŒs
 = 0;

1392 
is_Ú
 = *

++;

1394 
	`´štf
(
BM_COLOR_DBG
 "%d" 
BM_COLOR_END
, 
is_Ú
);

1396 ià(!
is_Ú
) {

1397 
	`fwr™e
(

, 1, 
š_’d
 - ip, 
¡dout
);

1398  
BMZ_E_OK
;

1401 

 < 
š_’d
) {

1402 ià(*

 =ğ
BM_ESC
) {

1403 
By‹
 *
0
 = 

;

1404 
	`BM_NEED_IN
(1);

1406 ià(

[1] !ğ
BM_ESC
) {

1407 ++

;

1408 
	`BM_DECODE_POS
(
ıos
, 
pos
);

1409 
	`BM_DECODE_LEN
(
Ën
);

1410 
	`´štf
(
BM_COLOR_DBG
 "<%Îu,%Îu>" 
BM_COLOR_END
,

1411 ()
pos
, ()
Ën
);

1412 
ıos
 +ğ
Ën
;

1413 
tÙ_±e_sz
 +ğ
Ën
;

1414 
tÙ_±r_sz
 +ğ

 - 
0
;

1415 ++
ÅŒs
;

1418 
	`putch¬
(*

++);

1419 
	`putch¬
(*

++);

1420 
ıos
 += 2;

1424 
	`putch¬
(*

++);

1425 ++
ıos
;

1428 
	`BM_LOG
(1, "%llu…ointers,‡vg…ointee size: %.3f,‡vg…ointer size: %.3f\n",

1429 ()
ÅŒs
, ()
tÙ_±e_sz
 /‚ptrs,

1430 ()
tÙ_±r_sz
 / 
ÅŒs
);

1431  
BMZ_E_OK
;

1433 
šput_ov”run
:

1434  
BMZ_E_INPUT_OVERRUN
;

1435 
	}
}

1438 
	$bmz_š™
() {

1439 
»t
 = 
	`lzo_š™
();

1440  
»t
 =ğ
LZO_E_OK
 ? 
BMZ_E_OK
 : 
BMZ_E_ERROR
;

1441 
	}
}

1444 
	$bmz_lz_·ck
(cÚ¡ *
š
, 
size_t
 
š_Ën
, *
out
, size_ˆ*
out_Ën_p
,

1445 *
wÜk_mem
) {

1446 
lzo_ušt
 
Ş’
 = *
out_Ën_p
;

1447 
»t
 = 
	`lzo1x_1_com´ess
((
By‹
 *)
š
, 
š_Ën
, (By‹ *)
out
, &
Ş’
, 
wÜk_mem
);

1448 *
out_Ën_p
 = 
Ş’
;

1449  
»t
;

1450 
	}
}

1452 
size_t


1453 
	$bmz_lz_·ck_wÜkËn
(
size_t
 
š_Ën
) {

1454  
LZO1X_MEM_COMPRESS
;

1455 
	}
}

1458 
	$bmz_lz_uÅack
(cÚ¡ *
š
, 
size_t
 
š_Ën
, *
out
, size_ˆ*
out_Ën_p
) {

1459 
lzo_ušt
 
Ş’
 = *
out_Ën_p
;

1460 
»t
 = 
	`lzo1x_decom´ess
((
By‹
 *)
š
, 
š_Ën
, (By‹ *)
out
, &
Ş’
, 
NULL
);

1461 *
out_Ën_p
 = 
Ş’
;

1462  
»t
;

1463 
	}
}

1466 
	$bmz_checksum
(cÚ¡ *
š
, 
size_t
 
š_Ën
) {

1467  
	`lzo_adËr32
(1, (
By‹
 *)
š
, 
š_Ën
);

1468 
	}
}

1471 
	$bmz_upd©e_checksum
(
s
, cÚ¡ *
š
, 
size_t
 
š_Ën
) {

1472  
	`lzo_adËr32
(
s
, (
By‹
 *)
š
, 
š_Ën
);

1473 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/bmz/bmz.h

20 #iâdeà
HYPERTABLE_BMZ_H


21 
	#HYPERTABLE_BMZ_H


	)

23 
	~"com·t-c.h
"

25 
	#BMZ_VER_NUM
 0x0110

	)

26 
	#BMZ_VER_MAJOR
 (
BMZ_VER_NUM
 >> 12)

	)

27 
	#BMZ_VER_MINOR
 ((
BMZ_VER_NUM
 >> 8è& 0xf)

	)

28 
	#BMZ_VER_RELEASE
 ((
BMZ_VER_NUM
 >> 4è& 0xf)

	)

29 
	#BMZ_VER_PATCH
 (
BMZ_VER_NUM
 & 0xf)

	)

32 
	#BMZ_E_OK
 0

	)

33 
	#BMZ_E_ERROR
 (-1)

	)

34 
	#BMZ_E_INPUT_OVERRUN
 (-4)

	)

35 
	#BMZ_E_OUTPUT_OVERRUN
 (-5)

	)

43 
	$HT_EXTERN
()

44 
	`bmz_š™
();

60 
	$HT_EXTERN
()

61 
	`bmz_·ck
(cÚ¡ *
š
, 
size_t
 
š_Ën
, *
out
, size_ˆ*
out_Ën_p
,

62 
size_t
 
off£t
, size_ˆ
å_Ën
, 
æags
, *
wÜk_mem
);

75 
	$HT_EXTERN
()

76 
	`bmz_uÅack
(cÚ¡ *
š
, 
size_t
 
š_Ën
, *
out
, size_ˆ*
out_Ën_p
,

77 *
wÜk_mem
);

84 
	$HT_EXTERN
(
size_t
)

85 
	`bmz_·ck_buæ’
(
size_t
 
š_Ën
);

96 
	$HT_EXTERN
(
size_t
)

97 
	`bmz_·ck_wÜkËn
(
size_t
 
š_Ën
, size_ˆ
å_Ën
);

104 
	$HT_EXTERN
(
size_t
)

105 
	`bmz_uÅack_wÜkËn
(
size_t
 
out_Ën
);

112 
	$HT_EXTERN
()

113 
	`bmz_£t_v”bos™y
(
v”bos™y
);

117 (*
	tBmzOutProc
)(cÚ¡ *
	tmsg
, 
	tsize_t
 
	tËn
);

121 (*
	tBmzD›Proc
)(cÚ¡ *
	tmsg
è
	tHT_NORETURN
;

128 
	$HT_EXTERN
(
BmzOutProc
)

129 
	`bmz_£t_out_´oc
(
BmzOutProc
 
´oc
);

136 
	$HT_EXTERN
(
BmzD›Proc
)

137 
	`bmz_£t_d›_´oc
(
BmzD›Proc
 
´oc
);

144 
	$HT_EXTERN
()

145 
	`bmz_checksum
(cÚ¡ *
š
, 
size_t
 
š_Ën
);

147 
	$HT_EXTERN
()

148 
	`bmz_upd©e_checksum
(
s
, cÚ¡ *
š
, 
size_t
 
š_Ën
);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/bmz/bmzip.c

22 
	~"com·t-c.h
"

23 
	~<¡dio.h
>

24 
	~<¡dlib.h
>

25 
	~<¡ršg.h
>

26 
	~<uni¡d.h
>

27 
	~<lim™s.h
>

28 
	~<¡dšt.h
>

29 
	~<¡d¬g.h
>

30 
	~<”ºo.h
>

31 
	~<fú.h
>

32 
	~<sys/¡©.h
>

33 #iâdeà
HT_NO_MMAP


34 
	~<sys/mmª.h
>

35 
	gs_no_mm­
 = 0;

37 
	gs_no_mm­
 = 1;

40 
	~"bmz-š‹º®.h
"

42 
	#BMZ_MAGIC
 "BMZ"

	)

43 
	#BMZIP_VER
 0x0110

	)

44 
	#BMZ_HEADER_SZ
 (
	`¡¾’
(
BMZ_MAGIC
è+ 2 + 1 + 6 + 4)

	)

46 
	#BMZ_A_PACK
 0

	)

47 
	#BMZ_A_UNPACK
 1

	)

48 
	#BMZ_A_LIST
 2

	)

50 
	#BMZ_O_BM_ONLY
 1

	)

51 
	#BMZ_O_STREAM
 2

	)

53 
	tBy‹
;

56 
	tLlu
;

57 
	tLu
;

59 
	gs_v”bos™y
 = 0;

60 
	gs_bm_dump
 = 0;

61 
	gs_bm_hash
 = 0;

63 
	#LOG
(
_lvl_
, 
_fmt_
, ...èià(
s_v”bos™y
 >= _lvl_) do { \

64 
	`årštf
(
¡d”r
, "bmz: %s: " 
_fmt_
, 
__FUNCTION__
, ##
__VA_ARGS__
); \

65 ià(
”ºo
è
	`årštf
(
¡d”r
, ": %s", 
	`¡»¼Ü
(errno)); \

66 
	`putc
('\n', 
¡d”r
); \

67 } 0)

	)

69 
	#WARN
(
_fmt_
, ...) do { \

70 
	`LOG
(0, "w¬nšg: " 
_fmt_
, ##
__VA_ARGS__
); \

71 } 0)

	)

73 
	#DIE
(
_fmt_
, ...) do { \

74 
	`LOG
(0, "çl: " 
_fmt_
, ##
__VA_ARGS__
); \

75 
	`ex™
(1); \

76 } 0)

	)

78 
	#BMZ_ALIGN
(
_mem_
, 
_n_
è(
By‹
 *)(_mem_è+ _n_ - (((
size_t
)(_mem_))%(_n_))

	)

80 
	#BMZ_READ_INT16
(
_p_
, 
_n_
) \

81 
_n_
 = (*
_p_
++ << 8); \

82 
_n_
 |ğ(*
_p_
++)

	)

84 
	#BMZ_READ_INT32
(
_p_
, 
_n_
) \

85 
_n_
 = (*
_p_
++ << 24); \

86 
_n_
 |ğ(*
_p_
++ << 16); \

87 
_n_
 |ğ(*
_p_
++ << 8); \

88 
_n_
 |ğ(*
_p_
++)

	)

90 
	#BMZ_READ_INT48
(
_p_
, 
_n_
) \

91 
_n_
 = ((
ušt64_t
)*
_p_
++ << 40); \

92 
_n_
 |ğ((
ušt64_t
)*
_p_
++ << 32); \

93 
_n_
 |ğ(*
_p_
++ << 24); \

94 
_n_
 |ğ(*
_p_
++ << 16); \

95 
_n_
 |ğ(*
_p_
++ << 8); \

96 
_n_
 |ğ(*
_p_
++)

	)

98 
	#BMZ_WRITE_INT16
(
_p_
, 
_n_
) \

99 *
_p_
++ = (
By‹
)(
_n_
 >> 8); \

100 *
_p_
++ = (
By‹
)(
_n_
)

	)

102 
	#BMZ_WRITE_INT32
(
_p_
, 
_n_
) \

103 *
_p_
++ = (
By‹
)(
_n_
 >> 24); \

104 *
_p_
++ = (
By‹
)(
_n_
 >> 16); \

105 *
_p_
++ = (
By‹
)(
_n_
 >> 8); \

106 *
_p_
++ = (
By‹
)(
_n_
)

	)

108 
	#BMZ_WRITE_INT48
(
_p_
, 
_n_
) \

109 *
_p_
++ = (
By‹
)(
_n_
 >> 40); \

110 *
_p_
++ = (
By‹
)(
_n_
 >> 32); \

111 *
_p_
++ = (
By‹
)(
_n_
 >> 24); \

112 *
_p_
++ = (
By‹
)(
_n_
 >> 16); \

113 *
_p_
++ = (
By‹
)(
_n_
 >> 8); \

114 *
_p_
++ = (
By‹
)(
_n_
)

	)

117 
	$»ad_bmz_h—d”
(
fd
, 
By‹
 *
buf
) {

118 ià(
	`»ad
(
fd
, 
buf
, 
BMZ_HEADER_SZ
) != BMZ_HEADER_SZ)

119 
	`DIE
("”rÜ„—dšg bmz fh—d” (%lu by‹s)", (
Lu
)
BMZ_HEADER_SZ
);

120 
	}
}

123 
	$·r£_bmz_h—d”
(cÚ¡ 
By‹
 *
buf
, 
ušt16_t
 *
v”siÚ_p
, 
ušt64_t
 *
Üig_size_p
,

124 
ušt32_t
 *
checksum_p
, ušt32_ˆ*
İtiÚs
) {

125 cÚ¡ 
By‹
 *
bp
 = 
buf
;

126 
size_t
 
magic_Ën
 = 
	`¡¾’
(
BMZ_MAGIC
);

128 ià(
	`memcmp
(
buf
, 
BMZ_MAGIC
, 
magic_Ën
)) {

129 
	`DIE
("bad magiøš fh—d” (%lu by‹s)", (
Lu
)
magic_Ën
);

131 
bp
 +ğ
magic_Ën
;

132 
	`BMZ_READ_INT16
(
bp
, *
v”siÚ_p
);

134 ià(*
v”siÚ_p
 > 
BMZIP_VER
)

135 
	`DIE
("šcom­tibË v”siÚ: %04x", *
v”siÚ_p
);

137 *
İtiÚs
 = *
bp
++;

138 
	`BMZ_READ_INT48
(
bp
, *
Üig_size_p
);

139 
	`BMZ_READ_INT32
(
bp
, *
checksum_p
);

140 
	}
}

143 
	$wr™e_bmz_h—d”
(
fd
, 
size_t
 
š_Ën
, 
ušt32_t
 
checksum
, 
By‹
 
İtiÚs
) {

144 
buf
[
BMZ_HEADER_SZ
], *
bp
 = buf;

145 
ušt64_t
 
Üig_size
 = 
š_Ën
;

147 
	`¡rıy
(
buf
, 
BMZ_MAGIC
);

148 
bp
 +ğ
	`¡¾’
(
BMZ_MAGIC
);

149 
	`BMZ_WRITE_INT16
(
bp
, 
BMZIP_VER
);

150 *
bp
++ = 
İtiÚs
;

151 
	`BMZ_WRITE_INT48
(
bp
, 
Üig_size
);

152 
	`BMZ_WRITE_INT32
(
bp
, 
checksum
);

154 ià(
	`wr™e
(
fd
, 
buf
, 
BMZ_HEADER_SZ
) != BMZ_HEADER_SZ)

155 
	`DIE
("”rÜ wr™šg h—d” (%lu by‹s)", (
Lu
)
BMZ_HEADER_SZ
);

156 
	}
}

159 
	$do_li¡
(
fd
) {

160 
By‹
 
buf
[
BMZ_HEADER_SZ
];

161 
ušt16_t
 
v”siÚ
;

162 
ušt64_t
 
Üig_size
, 
size
;

163 
ušt32_t
 
checksum
, 
İtiÚs
;

164 
¡©
 
¡
;

166 ià(
	`f¡©
(
fd
, &
¡
è!ğ0è
	`DIE
("error getting stat from file (%d)", fd);

168 
size
 = 
¡
.
¡_size
;

169 
	`»ad_bmz_h—d”
(
fd
, 
buf
);

170 
	`·r£_bmz_h—d”
(
buf
, &
v”siÚ
, &
Üig_size
, &
checksum
, &
İtiÚs
);

171 
	`´štf
("%8s%16s%16s%8s\n", "version", "compressed", "uncompressed", "ratio");

172 
	`´štf
(" %04x%16Îu%16Îu%7.2f%%\n", 
v”siÚ
, (
Llu
)
size
,

173 (
Llu
)
Üig_size
, orig_siz? 
size
 * 100. / orig_size : 1);

174 
	}
}

177 
	$do_·ck
(cÚ¡ *
š
, 
size_t
 
š_Ën
, size_ˆ
buf_Ën
,

178 
size_t
 
off£t
, size_ˆ
å_Ën
, 
By‹
 
İtiÚs
) {

179 
size_t
 
buæ’
 = 
	`bmz_·ck_buæ’
(
š_Ën
), 
out_Ën
 = buflen;

180 
size_t
 
wÜkËn
 = 
	`bmz_·ck_wÜkËn
(
š_Ën
, 
å_Ën
);

181 
»t
, 
bm_Úly
 = (
İtiÚs
 & 
BMZ_O_BM_ONLY
è|| 
s_bm_dump
;

182 
By‹
 *
out
, *
wÜk_mem
;

184 ià(
bm_Úly
) {

185 
out_Ën
 = 
š_Ën
 + 1;

187 ià(
buf_Ën
 > 
š_Ën
 + 
wÜkËn
) {

188 
out
 = (
By‹
 *)
š
 + 
š_Ën
;

189 
wÜk_mem
 = 
out
 + 
out_Ën
;

192 
out
 = 
	`m®loc
(
wÜkËn
);

194 ià(!
out
)

195 
	`DIE
("”rÜ‡Îoÿtšg %lu by‹ memÜy", (
Lu
)
wÜkËn
);

197 
wÜk_mem
 = 
out
 + 
out_Ën
;

200 
wÜk_mem
 = 
	`BMZ_ALIGN
(work_mem, 8);

202 ià(
buf_Ën
 > 
buæ’
 + 
wÜkËn
) {

203 
wÜk_mem
 = (
By‹
 *)
š
 + 
buæ’
;

204 
out
 = (
By‹
 *)
š
;

207 
out
 = 
	`m®loc
(
buæ’
 + 
wÜkËn
);

209 ià(!
out
)

210 
	`DIE
("”rÜ‡Îoÿtšg %lu by‹ memÜy", (
Lu
)
buæ’
 + 
wÜkËn
);

212 
wÜk_mem
 = 
out
 + 
buæ’
;

215 ià(
bm_Úly
) {

216 
»t
 = 
	`bmz_bm_·ck_mask
(
š
, 
š_Ën
, 
out
, &
out_Ën
, 
off£t
, 
å_Ën
,

217 
wÜk_mem
, 257);

218 ià(
»t
 !ğ
BMZ_E_OK
)

219 
	`DIE
("”rÜƒncodšg bm ouuˆÓ¼Ü %d)", 
»t
);

221 ià(
s_bm_dump
) {

222 ià((
»t
 = 
	`bmz_bm_dump
(
out
, 
out_Ën
)è!ğ
BMZ_E_OK
)

223 
	`WARN
("”rÜ dumpšg bmƒncodšg (»t=%d)", 
»t
);

228 ià((
»t
 = 
	`bmz_·ck
(
š
, 
š_Ën
, 
out
, &
out_Ën
, 
off£t
, 
å_Ën
,

229 (
s_bm_hash
 << 24), 
wÜk_mem
))

230 !ğ
BMZ_E_OK
) {

231 
	`DIE
("”rÜ com´essšg iÅuˆÓ¼Ü %d)", 
»t
);

233 
	`wr™e_bmz_h—d”
(1, 
š_Ën
, 
	`bmz_checksum
(
out
, 
out_Ën
), 
İtiÚs
);

234 
	`wr™e
(1, 
out
, 
out_Ën
);

235 
	}
}

238 
	$do_uÅack
(cÚ¡ *
š
, 
size_t
 
š_Ën
, size_ˆ
buf_Ën
) {

239 cÚ¡ 
By‹
 *
bp
 = (By‹ *)
š
;

240 
ušt16_t
 
v”siÚ
;

241 
ušt64_t
 
Üig_size
;

242 
ušt32_t
 
checksum
, 
cs
, 
İtiÚs
;

243 
size_t
 
ou’
, 
wÜkËn
, 
Ën
 = 
š_Ën
 - 
BMZ_HEADER_SZ
;

244 
By‹
 *
out
, *
wÜkmem
;

245 
»t
;

247 ià(
š_Ën
 < 
BMZ_HEADER_SZ
è
	`DIE
("fŒunÿ‹d (size: %lu)", (
Lu
)in_len);

249 
	`·r£_bmz_h—d”
(
bp
, &
v”siÚ
, &
Üig_size
, &
checksum
, &
İtiÚs
);

251 ià(
Üig_size
 > 
INT_MAX
 && (
size_t
) == 4)

252 
	`DIE
("original file size %llu„equires 64-bit version of bmzip",

253 (
Llu
)
Üig_size
);

255 
bp
 +ğ
BMZ_HEADER_SZ
;

256 
buf_Ën
 -ğ
BMZ_HEADER_SZ
;

257 
cs
 = 
	`bmz_checksum
(
bp
, 
Ën
);

258 
ou’
 = 
Üig_size
;

260 ià(
cs
 !ğ
checksum
)

261 
	`DIE
("checksum mism©ch (ex³ùšg %x, gÙ %x).", 
checksum
, 
cs
);

263 ià(
İtiÚs
 & 
BMZ_O_BM_ONLY
) {

264 
out
 = 
buf_Ën
 > 
š_Ën
 + 
Üig_size
 ? (
By‹
*)
bp
 + 
Ën
 : 
	`m®loc
(
ou’
);

266 ià((
»t
 = 
	`bmz_bm_uÅack
(
bp
, 
Ën
, 
out
, &
ou’
)è!ğ
BMZ_E_OK
)

267 
	`DIE
("”rÜ decodšg bm iÅuˆÓ¼Ü %d)", 
»t
);

270 
wÜkËn
 = 
	`bmz_uÅack_wÜkËn
(
Üig_size
 > 
Ën
 ? orig_size :†en);

271 
out
 = (
buf_Ën
 > 
ou’
 + 
wÜkËn
è? (
By‹
 *)
bp
 : 
	`m®loc
(outlen + worklen);

272 
wÜkmem
 = 
out
 + 
ou’
;

274 ià((
»t
 = 
	`bmz_uÅack
(
bp
, 
Ën
, 
out
, &
ou’
, 
wÜkmem
)è!ğ
BMZ_E_OK
)

275 
	`DIE
("”rÜ decom´essšg (”rÜ %d)", 
»t
);

277 ià(
Üig_size
 !ğ
ou’
)

278 
	`WARN
("size mismatch (expecting %llu, got %llu)",

279 (
Llu
)
Üig_size
, (Llu)
ou’
);

281 
	`wr™e
(1, 
out
, 
ou’
);

282 
	}
}

285 
	$do_block
(cÚ¡ *
š
, 
size_t
 
Ën
, size_ˆ
buf_Ën
, size_ˆ
off£t
,

286 
size_t
 
å_Ën
, 
aùiÚ
, 
İtiÚs
) {

287 
aùiÚ
) {

288 
BMZ_A_PACK
:

289 
	`do_·ck
(
š
, 
Ën
, 
buf_Ën
, 
off£t
, 
å_Ën
, 
İtiÚs
);

291 
BMZ_A_UNPACK
:

292 
	`do_uÅack
(
š
, 
Ën
, 
buf_Ën
);

295 
	`DIE
("unknowÀaùiÚ: %d", 
aùiÚ
);

297 
	}
}

300 
	$»ad_äom_å
(
FILE
 *
å
, 
size_t
 *
Ën_p
, size_ˆ*
size_p
) {

301 *
d©a
 = 
NULL
;

302 
buf
[65536];

303 
št64_t
 
Ën
 = 0, 
size
 = 0, 
»t
;

305 (
»t
 = 
	`ä—d
(
buf
, 1, (buf), 
å
)) > 0) {

306 
Ën
 +ğ
»t
;

307 ià(
Ën
 > 
INT_MAX
)

308 
	`DIE
("reading from stdin for data size greaterhan 2GB "

309 "nÙ y‘ suµÜ‹d (cu¼’ˆsize: %Îd)", ()
Ën
);

311 ià(
Ën
 > 
size
) {

312 
size
 = (
Ën
 + 16) * 5 / 2;

313 
d©a
 = 
	`»®loc
(d©a, 
size
);

315 
	`memıy
(
d©a
 + 
Ën
 - 
»t
, 
buf
,„et);

317 *
Ën_p
 = 
Ën
;

318 *
size_p
 = 
size
;

319  
d©a
;

320 
	}
}

323 
	$»ad_äom_fd
(
fd
, 
size_t
 *
Ën_p
, size_ˆ*
size_p
) {

324 
¡©
 
¡
;

325 *
d©a
 = 
NULL
;

326 
size_t
 
sz
;

328 ià(
	`f¡©
(
fd
, &
¡
è!ğ0è
	`DIE
("cannot stat fd <%d>", fd);

330 ià(
¡
.
¡_size
 > 
INT_MAX
 && (
size_t
) == 4)

331 
	`DIE
("file size %llu„equires 64-bit version of bmzip",

332 (
Llu
)
¡
.
¡_size
);

334 
sz
 = *
Ën_p
 = *
size_p
 = 
¡
.
¡_size
;

336 ià(!
sz
è 
d©a
;

338 ià(!
s_no_mm­
) {

339 #iâdeà
HT_NO_MMAP


340 
	`LOG
(1, "mm­pšg f(size: %lu)...", (
Lu
)
sz
);

341 
d©a
 = 
	`mm­
(
NULL
, 
sz
, 
PROT_READ
, 
MAP_PRIVATE
, 
fd
, 0);

343 ià(!
d©a
 || (*)-1 == data) {

344 
	`LOG
(1, "mm­ faed oÀfd %d", 
fd
);

345 
”ºo
 = 0;

346 
	`LOG
(1, "%s", "trying‡lternative");

347 
d©a
 = 
NULL
;

351 ià(!
d©a
) {

352 
	`LOG
(1, "»adšg f(size: %luèštØmemÜy...", (
Lu
)
sz
);

353 
d©a
 = 
	`m®loc
(
sz
);

355 ià(!
d©a
è
	`DIE
("ÿÂÙ‡Îoÿ‹ %lu by‹ memÜy", (
Lu
)
sz
);

357 ià(
	`»ad
(
fd
, 
d©a
, 
sz
è!ğszè
	`DIE
("”rÜ„—dšg %lu by‹s", (
Lu
)sz);

360  
d©a
;

361 
	}
}

364 
	$šput_äom_¡dš
(
size_t
 
off£t
, size_ˆ
å_Ën
, 
aùiÚ
, 
İtiÚs
) {

365 
size_t
 
Ën
, 
buf_Ën
;

367 ià(
aùiÚ
 =ğ
BMZ_A_LIST
) {

368 
	`do_li¡
(0);

371 *
d©a
 = 
	`»ad_äom_å
(
¡dš
, &
Ën
, &
buf_Ën
);

372 
	`do_block
(
d©a
, 
Ën
, 
buf_Ën
, 
off£t
, 
å_Ën
, 
aùiÚ
, 
İtiÚs
);

374 
	}
}

377 
	$šput_äom_fe
(cÚ¡ *
âame
, 
size_t
 
off£t
, size_ˆ
å_Ën
, 
aùiÚ
,

378 
İtiÚs
) {

379 
size_t
 
Ën
, 
buf_Ën
;

380 
fd
 = 
	`İ’
(
âame
, 
O_RDONLY
, 0);

382 ià(
fd
 =ğ-1è
	`DIE
("ÿÂÙ o³À'%s'", 
âame
);

384 ià(
aùiÚ
 =ğ
BMZ_A_LIST
) {

385 
	`do_li¡
(
fd
);

388 *
d©a
 = 
	`»ad_äom_fd
(
fd
, &
Ën
, &
buf_Ën
);

389 
	`do_block
(
d©a
, 
Ën
, 
buf_Ën
, 
off£t
, 
å_Ën
, 
aùiÚ
, 
İtiÚs
);

392 
	}
}

395 
	$bm_hash
(cÚ¡ *
Çme
) {

397 ià(!
	`¡rcmp
("mod", 
Çme
)è 
BMZ_HASH_MOD
;

398 ià(!
	`¡rcmp
("mod16x2", 
Çme
)è 
BMZ_HASH_MOD16X2
;

399 ià(!
	`¡rcmp
("mask16x2", 
Çme
)è 
BMZ_HASH_MASK16X2
;

400 ià(!
	`¡rcmp
("mask", 
Çme
)è 
BMZ_HASH_MASK
;

401 ià(!
	`¡rcmp
("mask32x2", 
Çme
)è 
BMZ_HASH_MASK32X2
;

403 
	`DIE
("unknowÀhash: %s", 
Çme
);

405 
	}
}

407 
HT_NORETURN


408 
	$show_u§ge
() {

409 
	`årštf
(
¡d”r
, "%s%s",

422 
	`ex™
(0);

423 
	}
}

426 
	$maš
(
ac
, *
av
[]) {

427 **
Ÿ
 = 
av
 + 1, **
a_’d
 =‡v + 
ac
;

429 
size_t
 
å_Ën
 = 64, 
off£t
 = 0;

430 
bm_th»sh
 = 0, 
aùiÚ
 = 
BMZ_A_PACK
, 
İtiÚs
 = 0;

432 ; 
Ÿ
 < 
a_’d
; ++ia) {

433 ià(!
	`¡rcmp
("-d", *
Ÿ
) ||

434 !
	`¡rcmp
("--decom´ess", *
Ÿ
)è
aùiÚ
 = 
BMZ_A_UNPACK
;

435 ià(!
	`¡rcmp
("--v”bo£", *
Ÿ
)è
s_v”bos™y
 = 1;

436 ià(!
	`¡rcmp
("--v”bo£=", *
Ÿ
)è
s_v”bos™y
 = 
	`©oi
(*ia + 9);

437 ià(!
	`¡rcmp
("--off£t", *
Ÿ
)è
off£t
 = 
	`©oi
(*++ia);

438 ià(!
	`¡rcmp
("--å-Ën", *
Ÿ
)è
å_Ën
 = 
	`©oi
(*++ia);

439 ià(!
	`¡rcmp
("--bm-Úly", *
Ÿ
)è
İtiÚs
 |ğ
BMZ_O_BM_ONLY
;

440 ià(!
	`¡rcmp
("--bm-dump", *
Ÿ
)è
s_bm_dump
 = 1;

441 ià(!
	`¡rcmp
("--no-mm­", *
Ÿ
)è
s_no_mm­
 = 1;

442 ià(!
	`¡rcmp
("--bm-th»sh", *
Ÿ
)è
bm_th»sh
 = 
	`©oi
(*++ia);

443 ià(!
	`¡rcmp
("--bm-hash", *
Ÿ
)è
s_bm_hash
 = 
	`bm_hash
(*++ia);

444 ià(!
	`¡rcmp
("-l", *
Ÿ
) ||

445 !
	`¡rcmp
("--li¡", *
Ÿ
)è
aùiÚ
 = 
BMZ_A_LIST
;

446 ià(!
	`¡rcmp
("-h", *
Ÿ
) ||

447 !
	`¡rcmp
("--h–p", *
Ÿ
)) {

448 
	`show_u§ge
();

450 ià(!
	`¡rcmp
("--v”siÚ", *
Ÿ
)) {

451 
	`LOG
(0, "v”siÚ %d.%d.%d.%d", 
BMZIP_VER
 >> 12, (BMZIP_VER >> 8) & 0xf,

452 (
BMZIP_VER
 >> 4) & 0xf, BMZIP_VER & 0xf);

453 
	`ex™
(0);

455 ià(!
	`¡rcmp
("--", *
Ÿ
)) {

456 ++
Ÿ
;

459 ià('-' =ğ**
Ÿ
)

460 
	`DIE
("unknowÀİtiÚ: %s\n", *
Ÿ
);

463 ià(
s_v”bos™y
)

464 
	`bmz_£t_v”bos™y
(
s_v”bos™y
);

466 ià(
bm_th»sh
)

467 
	`bmz_£t_cŞlisiÚ_th»sh
(
bm_th»sh
);

469 ià(
Ÿ
 >ğ
a_’d
)

470 
	`šput_äom_¡dš
(
off£t
, 
å_Ën
, 
aùiÚ
, 
İtiÚs
);

472 
	`šput_äom_fe
(*
Ÿ
, 
off£t
, 
å_Ën
, 
aùiÚ
, 
İtiÚs
);

475 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/bmz/compat-c.h

20 #iâdeà
HYPERTABLE_COMPAT_C_H


21 
	#HYPERTABLE_COMPAT_C_H


	)

26 #ifdeà
__ılu¥lus


27 
	#HT_EXTERN_C
 "C"

	)

29 
	#HT_EXTERN_C
 

	)

33 #ifdeà
_MSC_VER


34 
	#HT_CDECL
 
__cdeş


	)

36 
	#HT_CDECL


	)

39 
	#HT_PUBLIC
(
»t_ty³
è»t_ty³ 
HT_CDECL


	)

40 
	#HT_EXTERN
(
»t_ty³
è
HT_EXTERN_C
 
	`HT_PUBLIC
Ô‘_ty³)

	)

42 #ifdeà
__GNUC__


43 
	#HT_NORETURN
 
	`__©Œibu‹__
((
__nÜ‘uº__
))

	)

44 
	#HT_FORMAT
(
x
è
	`__©Œibu‹__
((
fÜm©
 x))

	)

46 
	#HT_NORETURN


	)

47 
	#HT_FORMAT
(
x
)

	)

48 #iâdeà
__©Œibu‹__


49 
	#__©Œibu‹__
(
x
)

	)

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/bmz/test-helper.h

20 #iâdeà
HT_SIMPLE_TEST_HELPER_H


21 
	#HT_SIMPLE_TEST_HELPER_H


	)

23 
	~<sys/time.h
>

25 
	#HT_MEASURE
(
_t_
, 
_code_
) do { \

26 
t0
 = 
	`ht_time_d
(); 
_code_
; 
_t_
 = ht_time_d() -0; \

27 } 0)

	)

29 
šlše
 

30 
	$ht_time_d
() {

31 
timev®
 
tv
;

32 ià(
	`g‘timeofday
(&
tv
, 
NULL
)) {

33 
	`³¼Ü
(
__FUNCTION__
);

35  ()(
tv
.
tv_£c
è+ ()Ñv.
tv_u£c
) / 1e6;

36 
	}
}

38 
	#HT_CHECK
(
e
) \

39 (()((
e
è? 0 : 
	`HT_CHECK_FAIL
(#e)))

	)

41 
	#HT_CHECK_FAIL
(
e
) \

42 (()
	`´štf
("%s:%u: %s: bad‡ssertion: `%s'\n", \

43 
__FILE__
, 
__LINE__
, 
__FUNCTION__
, 
e
), 
	`abÜt
(), 0)

	)

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/fletcher16.cc

21 
	~"æ‘ch”16.h
"

23 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

25 
ušt16_t
 
	gHy³¹abË
::
	$æ‘ch”16
(
ušt8_t
 *
d©a
, 
ušt32_t
 
Ën
) {

26 
ušt16_t
 
sum1
 = 0xff, 
sum2
 = 0xff;

28 
Ën
) {

29 
’
 = 
Ën
 > 20 ? 20 :†en;

30 
Ën
 -ğ
’
;

32 
sum1
 +ğ*
d©a
++;

33 
sum2
 +ğ
sum1
;

34 } --
’
);

35 
sum1
 = (sum1 & 0xff) + (sum1 >> 8);

36 
sum2
 = (sum2 & 0xff) + (sum2 >> 8);

39 
sum1
 = (sum1 & 0xff) + (sum1 >> 8);

40 
sum2
 = (sum2 & 0xff) + (sum2 >> 8);

41  
sum2
 << 8 | 
sum1
;

42 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/fletcher16.h

21 #iâdeà
HYPERTABLE_FLETCHER16_H


22 
	#HYPERTABLE_FLETCHER16_H


	)

25 
	~<¡dšt.h
>

28 
Çme¥aû
 
Hy³¹abË
 {

30 
ušt16_t
 
æ‘ch”16
(
ušt8_t
 *
d©a
, 
ušt32_t
 
Ën
);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/generate_test_data.cc

21 
	~<c¡ršg
>

22 
	~<¡ršg
>

23 
	~<veùÜ
>

26 
	~<¡ršg.h
>

27 
	~<sys/time.h
>

30 
	~"CommÚ/E¼Ü.h
"

31 
	~"CommÚ/Sy¡em.h
"

32 
	~"CommÚ/Te¡H¬Ãss.h
"

33 
	~"CommÚ/U§ge.h
"

35 
	~"AsyncComm/Comm.h
"

37 
	~"Hy³¹abË/Lib/Cl›Á.h
"

38 
	~"Hy³¹abË/Lib/Schema.h
"

40 
	~"Te¡D©a.h
"

43 
usšg
 
Çme¥aû
 
Hy³¹abË
;

44 
usšg
 
Çme¥aû
 
	g¡d
;

46 
	gÇme¥aû
 {

47 cÚ¡ *
	gu§ge
[] = {

89 
	$maš
(
¬gc
, **
¬gv
) {

90 
Te¡D©a
 
td©a
;

91 
Schema
 *
schema
;

92 
¡d
::
¡ršg
 
schemaS³c
;

93 
timev®
 
tv®
;

94 
ušt64_t
 
time¡amp
 = 0;

95 
ušt32_t
 
šdex
;

96 cÚ¡ *
rowKey
;

97 cÚ¡ *
qu®if›r
;

98 
ušt8_t
 
çmy
;

99 cÚ¡ *
cÚ‹Á
, *
±r
;

100 
¡d
::
¡ršg
 
v®ue
;

101 
size_t
 
cfMax
;

102 
veùÜ
<
¡d
::
¡ršg
> 
cfNames
;

103 
modV®ue
;

104 
¡d
::
¡ršg
 
cÚfigFe
 = "";

105 
Cl›Á
 *
ş›Á
;

106 
”rÜ
;

107 
¡d
::
¡ršg
 
bËName
 = "";

108 
£ed
 = 1234;

109 
boŞ
 
g’”©eTime¡amps
 = 
çl£
;

110 
ušt32_t
 
qu®if›rLim™
 = 0;

111 
ušt32_t
 
rowLim™
 = 0;

112 
ušt32_t
 
lim™
 = 0;

113 
ušt32_t
 
em™‹d
 = 0;

114 
boŞ
 
no_d–‘es
 = 
çl£
;

116 
i
=1; i<
¬gc
; i++) {

117 ià(!
	`¡ºcmp
(
¬gv
[
i
], "--config=", 9))

118 
cÚfigFe
 = &
¬gv
[
i
][9];

119 ià(!
	`¡ºcmp
(
¬gv
[
i
], "--seed=", 7)) {

120 
£ed
 = 
	`©oi
(&
¬gv
[
i
][7]);

122 ià(!
	`¡ºcmp
(
¬gv
[
i
], "--qualifier-limit=", 18)) {

123 
qu®if›rLim™
 = 
	`©oi
(&
¬gv
[
i
][18]);

125 ià(!
	`¡ºcmp
(
¬gv
[
i
], "--row-limit=", 12)) {

126 
rowLim™
 = 
	`©oi
(&
¬gv
[
i
][12]);

128 ià(!
	`¡ºcmp
(
¬gv
[
i
], "--limit=", 8)) {

129 
lim™
 = 
	`©oi
(&
¬gv
[
i
][8]);

131 ià(!
	`¡rcmp
(
¬gv
[
i
], "--timestamps")) {

132 
g’”©eTime¡amps
 = 
Œue
;

134 ià(!
	`¡rcmp
(
¬gv
[
i
], "--no-deletes")) {

135 
no_d–‘es
 = 
Œue
;

137 ià(
bËName
 == "")

138 
bËName
 = 
¬gv
[
i
];

140 
U§ge
::
	`dump_ªd_ex™
(
u§ge
);

143 ià(
bËName
 == "")

144 
U§ge
::
	`dump_ªd_ex™
(
u§ge
);

146 ià(
cÚfigFe
 == "")

147 
cÚfigFe
 = 
Sy¡em
::
š¡®lDœ
 + "/conf/hypertable.cfg";

149 ià(!
td©a
.
	`lßd
(
Sy¡em
::
š¡®lDœ
 + "/demo"))

150 
	`ex™
(1);

152 
ş›Á
 = 
Ãw
 
	`Cl›Á
(
¬gv
[0], 
cÚfigFe
);

154 ià((
”rÜ
 = 
ş›Á
->
	`g‘_schema
(
bËName
, 
schemaS³c
)è!ğ
E¼Ü
::
OK
) {

155 
	`HT_ERRORF
("ProbËm g‘tšg schem¨fÜabË '%s' - %s", 
¬gv
[1], 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

156  
”rÜ
;

159 
schema
 = 
Schema
::
	`Ãw_š¡ªû
(
schemaS³c
.
	`c_¡r
(), 
	`¡¾’
(schemaS³c.c_¡r()), 
Œue
);

160 ià(!
schema
->
	`is_v®id
()) {

161 
	`HT_ERRORF
("Schem¨P¬£ E¼Ü: %s", 
schema
->
	`g‘_”rÜ_¡ršg
());

162 
	`ex™
(1);

165 
cfMax
 = 
schema
->
	`g‘_max_cŞumn_çmy_id
();

166 
cfNames
.
	`»size
(
cfMax
+1);

168 
li¡
<
Schema
::
AcûssGroup
 *> *
lgLi¡
 = 
schema
->
	`g‘_acûss_group_li¡
();

169 
li¡
<
Schema
::
AcûssGroup
 *>::
™”©Ü
 
™”
 = 
lgLi¡
->
	`begš
(); i‹¸!ğlgLi¡->
	`’d
(); iter++) {

170 
li¡
<
Schema
::
CŞumnFamy
 *>::
™”©Ü
 
cfI‹r
 = (*
™”
)->
cŞumns
.
	`begš
(); cfI‹¸!ğ(*™”)->cŞumns.
	`’d
(); cfIter++)

171 
cfNames
[(*
cfI‹r
)->
id
] = (*cfI‹r)->
Çme
;

174 ià(
qu®if›rLim™
 == 0)

175 
qu®if›rLim™
 = 
td©a
.
u¾s
.
	`size
();

176 ià(
td©a
.
u¾s
.
	`size
(è< 
qu®if›rLim™
)

177 
qu®if›rLim™
 = 
td©a
.
u¾s
.
	`size
();

179 ià(
rowLim™
 == 0)

180 
rowLim™
 = 
td©a
.
wÜds
.
	`size
();

181 ià(
td©a
.
wÜds
.
	`size
(è< 
rowLim™
)

182 
rowLim™
 = 
td©a
.
wÜds
.
	`size
();

184 
	`¤ªd
(
£ed
);

189 ià(
g’”©eTime¡amps
)

190 
cout
 << "time¡amp\Œowkey\tcŞumnkey\tv®ue" << 
’dl
;

192 
cout
 << "rowkey\tcŞumnkey\tv®ue" << 
’dl
;

194 
Œue
) {

196 ià(
lim™
 && 
em™‹d
 >=†imit)

198 
em™‹d
++;

200 ià(
g’”©eTime¡amps
) {

202 
	`g‘timeofday
(&
tv®
, 0);

203 
time¡amp
 = ((
ušt64_t
)
tv®
.
tv_£c
 * 1000000LLè+v®.
tv_u£c
;

207 
šdex
 = 
	`¿nd
(è% 
rowLim™
;

208 
rowKey
 = 
td©a
.
wÜds
[
šdex
].
	`g‘
();

210 
šdex
 = 
	`¿nd
();

211 
modV®ue
 = 
	`¿nd
() % 49;

212 ià(!
no_d–‘es
 && (
šdex
 % 49è=ğ(
size_t
)
modV®ue
) {

213 ià(
g’”©eTime¡amps
)

214 
cout
 << 
time¡amp
 << "\t" << 
rowKey
 << "\tDELETE" << 
’dl
;

216 
cout
 << 
rowKey
 << "\tDELETE" << 
’dl
;

220 
šdex
 = 
	`¿nd
();

221 
çmy
 = (
šdex
 % 
cfMax
) + 1;

223 
šdex
 = 
	`¿nd
(è% 
qu®if›rLim™
;

224 
qu®if›r
 = 
td©a
.
u¾s
[
šdex
].
	`g‘
();

226 
šdex
 = 
	`¿nd
();

227 
modV®ue
 = 
	`¿nd
() % 29;

228 ià(!
no_d–‘es
 && (
šdex
 % 29) == 0) {

229 ià(
g’”©eTime¡amps
)

230 
cout
 << 
time¡amp
 << "\t" << 
rowKey
 << "\t" << 
cfNames
[
çmy
] << ":" << 
qu®if›r
 << "\tDELETE" << 
’dl
;

232 
cout
 << 
rowKey
 << "\t" << 
cfNames
[
çmy
] << ":" << 
qu®if›r
 << "\tDELETE" << 
’dl
;

236 
šdex
 = 
	`¿nd
(è% 
td©a
.
cÚ‹Á
.
	`size
();

237 
cÚ‹Á
 = 
td©a
.cÚ‹Á[
šdex
].
	`g‘
();

239 ià((
±r
 = 
	`¡rchr
(
cÚ‹Á
, '\n')) != 0)

240 
v®ue
 = 
¡d
::
	`¡ršg
(
cÚ‹Á
, 
±r
-content);

242 
v®ue
 = 
cÚ‹Á
;

244 ià(
g’”©eTime¡amps
)

245 
cout
 << 
time¡amp
 << "\t" << 
rowKey
 << "\t" << 
cfNames
[
çmy
] << ":" << 
qu®if›r
 << "\t" << 
v®ue
 << 
’dl
;

247 
cout
 << 
rowKey
 << "\t" << 
cfNames
[
çmy
] << ":" << 
qu®if›r
 << "\t" << 
v®ue
 << 
’dl
;

251 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/lzo/lzoconf.h

37 #iâdeà
__LZOCONF_H_INCLUDED


38 
	#__LZOCONF_H_INCLUDED


	)

40 
	#LZO_VERSION
 0x2020

	)

41 
	#LZO_VERSION_STRING
 "2.02"

	)

42 
	#LZO_VERSION_DATE
 "Où 17 2005"

	)

45 #ià
defšed
(
LZO_HAVE_CONFIG_H
)

46 
	~<cÚfig.h
>

48 
	~<lim™s.h
>

49 
	~<¡ddef.h
>

56 #ià!
defšed
(
CHAR_BIT
) || (CHAR_BIT != 8)

59 #ià!
defšed
(
UCHAR_MAX
è|| !defšed(
UINT_MAX
è|| !defšed(
ULONG_MAX
)

62 #ià(
USHRT_MAX
 < 1è|| (
UINT_MAX
 < 1è|| (
ULONG_MAX
 < 1)

67 #iâdeà
__LZODEFS_H_INCLUDED


68 
	~"lzodefs.h
"

72 #ifdeà
__ılu¥lus


81 #ià!
defšed
(
LZO_UINT32_C
)

82 #ià(
UINT_MAX
 < 
LZO_0xffffffffL
)

83 
	#LZO_UINT32_C
(
c
èø## 
UL


	)

85 
	#LZO_UINT32_C
(
c
è((cè+ 0U)

	)

90 #ià!
defšed
(
__LZO_CHECKER
)

91 #ià
defšed
(
__BOUNDS_CHECKING_ON
)

92 
	#__LZO_CHECKER
 1

	)

93 #–ià
defšed
(
__CHECKER__
)

94 
	#__LZO_CHECKER
 1

	)

95 #–ià
defšed
(
__INSURE__
)

96 
	#__LZO_CHECKER
 1

	)

97 #–ià
defšed
(
__PURIFY__
)

98 
	#__LZO_CHECKER
 1

	)

108 #ià!
defšed
(
LZO_UINT_MAX
)

109 #ià
defšed
(
LZO_ABI_LLP64
)

110 #ià
defšed
(
LZO_OS_WIN64
)

111 
	t__št64
 
	tlzo_ušt
;

112 
__št64
 
	tlzo_št
;

114 
	tlzo_ušt
;

115 
	tlzo_št
;

117 
	#LZO_UINT_MAX
 0xffffffffffffffffuÎ

	)

118 
	#LZO_INT_MAX
 9223372036854775807LL

	)

119 
	#LZO_INT_MIN
 (-1LL - 
LZO_INT_MAX
)

	)

120 #–ià
defšed
(
LZO_ABI_IP32L64
)

121 
	tlzo_ušt
;

122 
	tlzo_št
;

123 
	#LZO_UINT_MAX
 
UINT_MAX


	)

124 
	#LZO_INT_MAX
 
INT_MAX


	)

125 
	#LZO_INT_MIN
 
INT_MIN


	)

126 #–ià(
ULONG_MAX
 >ğ
LZO_0xffffffffL
)

127 
	tlzo_ušt
;

128 
	tlzo_št
;

129 
	#LZO_UINT_MAX
 
ULONG_MAX


	)

130 
	#LZO_INT_MAX
 
LONG_MAX


	)

131 
	#LZO_INT_MIN
 
LONG_MIN


	)

138 #ià!
defšed
(
LZO_UINT32_MAX
)

139 #ià(
UINT_MAX
 >ğ
LZO_0xffffffffL
)

140 
	tlzo_ušt32
;

141 
	tlzo_št32
;

142 
	#LZO_UINT32_MAX
 
UINT_MAX


	)

143 
	#LZO_INT32_MAX
 
INT_MAX


	)

144 
	#LZO_INT32_MIN
 
INT_MIN


	)

145 #–ià(
ULONG_MAX
 >ğ
LZO_0xffffffffL
)

146 
	tlzo_ušt32
;

147 
	tlzo_št32
;

148 
	#LZO_UINT32_MAX
 
ULONG_MAX


	)

149 
	#LZO_INT32_MAX
 
LONG_MAX


	)

150 
	#LZO_INT32_MIN
 
LONG_MIN


	)

157 #ià(
LZO_UINT_MAX
 >ğ
LZO_UINT32_MAX
)

158 
	#lzo_xšt
 
lzo_ušt


	)

160 
	#lzo_xšt
 
lzo_ušt32


	)

164 #ià!
defšed
(
__LZO_MMODEL
)

165 #ià(
LZO_UINT_MAX
 <ğ
UINT_MAX
)

166 
	#__LZO_MMODEL


	)

167 #–ià
defšed
(
LZO_HAVE_MM_HUGE_PTR
)

168 
	#__LZO_MMODEL_HUGE
 1

	)

169 
	#__LZO_MMODEL
 
__huge


	)

171 
	#__LZO_MMODEL


	)

176 
	#lzo_by‹p
 
__LZO_MMODEL
 *

	)

177 
	#lzo_ch¬p
 
__LZO_MMODEL
 *

	)

178 
	#lzo_voidp
 
__LZO_MMODEL
 *

	)

179 
	#lzo_shÜ
 
__LZO_MMODEL
 *

	)

180 
	#lzo_ushÜ
 
__LZO_MMODEL
 *

	)

181 
	#lzo_ušt32p
 
lzo_ušt32
 
__LZO_MMODEL
 *

	)

182 
	#lzo_št32p
 
lzo_št32
 
__LZO_MMODEL
 *

	)

183 
	#lzo_uš
 
lzo_ušt
 
__LZO_MMODEL
 *

	)

184 
	#lzo_š
 
lzo_št
 
__LZO_MMODEL
 *

	)

185 
	#lzo_xš
 
lzo_xšt
 
__LZO_MMODEL
 *

	)

186 
	#lzo_voidµ
 
lzo_voidp
 
__LZO_MMODEL
 *

	)

187 
	#lzo_by‹µ
 
lzo_by‹p
 
__LZO_MMODEL
 *

	)

189 
	#lzo_by‹
 
__LZO_MMODEL


	)

191 
	tlzo_boŞ
;

199 #ià!
defšed
(
__LZO_EXTERN_C
)

200 #ifdeà
__ılu¥lus


201 
	#__LZO_EXTERN_C
 "C"

	)

203 
	#__LZO_EXTERN_C
 

	)

208 #ià!
defšed
(
__LZO_CDECL
)

209 
	#__LZO_CDECL
 
__lzo_cdeş


	)

213 #ià!
defšed
(
__LZO_EXPORT1
)

214 
	#__LZO_EXPORT1


	)

216 #ià!
defšed
(
__LZO_EXPORT2
)

217 
	#__LZO_EXPORT2


	)

221 #ià!
defšed
(
LZO_PUBLIC
)

222 
	#LZO_PUBLIC
(
_»‰y³
è
__LZO_EXPORT1
 _»‰y³ 
__LZO_EXPORT2
 
__LZO_CDECL


	)

224 #ià!
defšed
(
LZO_EXTERN
)

225 
	#LZO_EXTERN
(
_»‰y³
è
__LZO_EXTERN_C
 
	`LZO_PUBLIC
(_»‰y³)

	)

227 #ià!
defšed
(
LZO_PRIVATE
)

228 
	#LZO_PRIVATE
(
_»‰y³
è_»‰y³ 
__LZO_CDECL


	)

233 (
	t__LZO_CDECL
 *
	tlzo_com´ess_t
èĞcÚ¡ 
	tlzo_by‹p
 
	t¤c
, 
	tlzo_ušt
 
	t¤c_Ën
,

234 
	tlzo_by‹p
 
	td¡
, 
	tlzo_uš
 
	td¡_Ën
,

235 
	tlzo_voidp
 
	twrkmem
 );

238 (
	t__LZO_CDECL
 *
	tlzo_decom´ess_t
èĞcÚ¡ 
	tlzo_by‹p
 
	t¤c
, 
	tlzo_ušt
 
	t¤c_Ën
,

239 
	tlzo_by‹p
 
	td¡
, 
	tlzo_uš
 
	td¡_Ën
,

240 
	tlzo_voidp
 
	twrkmem
 );

243 (
	t__LZO_CDECL
 *
	tlzo_İtimize_t
èĞ
	tlzo_by‹p
 
	t¤c
, 
	tlzo_ušt
 
	t¤c_Ën
,

244 
	tlzo_by‹p
 
	td¡
, 
	tlzo_uš
 
	td¡_Ën
,

245 
	tlzo_voidp
 
	twrkmem
 );

248 (
	t__LZO_CDECL
 *
	tlzo_com´ess_diù_t
)(cÚ¡ 
	tlzo_by‹p
 
	t¤c
, 
	tlzo_ušt
 
	t¤c_Ën
,

249 
	tlzo_by‹p
 
	td¡
, 
	tlzo_uš
 
	td¡_Ën
,

250 
	tlzo_voidp
 
	twrkmem
,

251 cÚ¡ 
	tlzo_by‹p
 
	tdiù
, 
	tlzo_ušt
 
	tdiù_Ën
 );

254 (
	t__LZO_CDECL
 *
	tlzo_decom´ess_diù_t
)(cÚ¡ 
	tlzo_by‹p
 
	t¤c
, 
	tlzo_ušt
 
	t¤c_Ën
,

255 
	tlzo_by‹p
 
	td¡
, 
	tlzo_uš
 
	td¡_Ën
,

256 
	tlzo_voidp
 
	twrkmem
,

257 cÚ¡ 
	tlzo_by‹p
 
	tdiù
, 
	tlzo_ušt
 
	tdiù_Ën
 );

263 
	glzo_ÿÎback_t
;

264 
lzo_ÿÎback_t
 
	tlzo_ÿÎback_t
;

265 
	#lzo_ÿÎback_p
 
lzo_ÿÎback_t
 
__LZO_MMODEL
 *

	)

268 
lzo_voidp
 (
	t__LZO_CDECL
 *
	tlzo_®loc_func_t
)

269 (
	tlzo_ÿÎback_p
 
	t£lf
, 
	tlzo_ušt
 
	t™ems
,†zo_ušˆ
	tsize
);

270 (
__LZO_CDECL
 *
	tlzo_ä“_func_t
)

271 (
	tlzo_ÿÎback_p
 
	t£lf
, 
	tlzo_voidp
 
	t±r
);

274 (
__LZO_CDECL
 *
	tlzo_´og»ss_func_t
)

275 (
	tlzo_ÿÎback_p
, 
	tlzo_ušt
,†zo_uint, );

277 
	slzo_ÿÎback_t


280 
lzo_®loc_func_t
 
	gÇÎoc
;

281 
lzo_ä“_func_t
 
	gnä“
;

284 
lzo_´og»ss_func_t
 
	gÅrog»ss
;

289 
lzo_voidp
 
	gu£r1
;

290 
lzo_xšt
 
	gu£r2
;

291 
lzo_xšt
 
	gu£r3
;

303 
	#LZO_E_OK
 0

	)

304 
	#LZO_E_ERROR
 (-1)

	)

305 
	#LZO_E_OUT_OF_MEMORY
 (-2è

	)

306 
	#LZO_E_NOT_COMPRESSIBLE
 (-3è

	)

307 
	#LZO_E_INPUT_OVERRUN
 (-4)

	)

308 
	#LZO_E_OUTPUT_OVERRUN
 (-5)

	)

309 
	#LZO_E_LOOKBEHIND_OVERRUN
 (-6)

	)

310 
	#LZO_E_EOF_NOT_FOUND
 (-7)

	)

311 
	#LZO_E_INPUT_NOT_CONSUMED
 (-8)

	)

312 
	#LZO_E_NOT_YET_IMPLEMENTED
 (-9è

	)

315 #iâdeà
lzo_sizeof_diù_t


316 
	#lzo_sizeof_diù_t
 (()(
lzo_by‹p
))

	)

325 
	#lzo_š™
(è
	`__lzo_š™_v2
(
LZO_VERSION
,()(),()(),\

326 ()(),()(
lzo_ušt32
),()(
lzo_ušt
),\

327 ()
lzo_sizeof_diù_t
,()(*),()(
lzo_voidp
),\

328 ()(
lzo_ÿÎback_t
))

	)

329 
LZO_EXTERN
(è
__lzo_š™_v2
(,,,,,,,,,);

332 
LZO_EXTERN
(è
lzo_v”siÚ
();

333 
LZO_EXTERN
(cÚ¡ *è
lzo_v”siÚ_¡ršg
();

334 
LZO_EXTERN
(cÚ¡ *è
lzo_v”siÚ_d©e
();

335 
LZO_EXTERN
(cÚ¡ 
lzo_ch¬p
è
_lzo_v”siÚ_¡ršg
();

336 
LZO_EXTERN
(cÚ¡ 
lzo_ch¬p
è
_lzo_v”siÚ_d©e
();

339 
LZO_EXTERN
()

340 
lzo_memcmp
(cÚ¡ 
lzo_voidp
 
_s1
, cÚ¡†zo_void°
_s2
, 
lzo_ušt
 
_Ën
);

341 
LZO_EXTERN
(
lzo_voidp
)

342 
lzo_memıy
(
lzo_voidp
 
_de¡
, cÚ¡†zo_void°
_¤c
, 
lzo_ušt
 
_Ën
);

343 
LZO_EXTERN
(
lzo_voidp
)

344 
lzo_memmove
(
lzo_voidp
 
_de¡
, cÚ¡†zo_void°
_¤c
, 
lzo_ušt
 
_Ën
);

345 
LZO_EXTERN
(
lzo_voidp
)

346 
lzo_mem£t
(
lzo_voidp
 
_s
, 
_c
, 
lzo_ušt
 
_Ën
);

349 
LZO_EXTERN
(
lzo_ušt32
)

350 
lzo_adËr32
(
lzo_ušt32
 
_adËr
, cÚ¡ 
lzo_by‹p
 
_buf
, 
lzo_ušt
 
_Ën
);

351 
LZO_EXTERN
(
lzo_ušt32
)

352 
lzo_üc32
(
lzo_ušt32
 
_c
, cÚ¡ 
lzo_by‹p
 
_buf
, 
lzo_ušt
 
_Ën
);

353 
LZO_EXTERN
(cÚ¡ 
lzo_ušt32p
)

354 
lzo_g‘_üc32_bË
();

357 
LZO_EXTERN
(è
_lzo_cÚfig_check
();

358 uniÚ { 
lzo_by‹p
 
	gp
; 
lzo_ušt
 
	gu
; } 
	t__lzo_pu_u
;

359 uniÚ { 
lzo_by‹p
 
	gp
; 
lzo_ušt32
 
	gu32
; } 
	t__lzo_pu32_u
;

360 uniÚ { *
	gvp
; 
lzo_by‹p
 
	gbp
; 
lzo_ušt32
 
	gu32
; 
	gl
; } 
	tlzo_®ign_t
;

363 
LZO_EXTERN
(è
__lzo_®ign_g­
(cÚ¡ 
lzo_voidp
 
_±r
, 
lzo_ušt
 
_size
);

364 
	#LZO_PTR_ALIGN_UP
(
_±r
,
_size
) \

365 ((
_±r
è+ (
lzo_ušt
è
	`__lzo_®ign_g­
((cÚ¡ 
lzo_voidp
)(_±r),Özo_ušt)(
_size
)))

	)

372 #ià
defšed
(
LZO_CFG_COMPAT
)

374 
	#__LZOCONF_H
 1

	)

376 #ià
defšed
(
LZO_ARCH_I086
)

377 
	#__LZO_i386
 1

	)

378 #–ià
defšed
(
LZO_ARCH_I386
)

379 
	#__LZO_i386
 1

	)

382 #ià
defšed
(
LZO_OS_DOS16
)

383 
	#__LZO_DOS
 1

	)

384 
	#__LZO_DOS16
 1

	)

385 #–ià
defšed
(
LZO_OS_DOS32
)

386 
	#__LZO_DOS
 1

	)

387 #–ià
defšed
(
LZO_OS_WIN16
)

388 
	#__LZO_WIN
 1

	)

389 
	#__LZO_WIN16
 1

	)

390 #–ià
defšed
(
LZO_OS_WIN32
)

391 
	#__LZO_WIN
 1

	)

394 
	#__LZO_CMODEL


	)

395 
	#__LZO_DMODEL


	)

396 
	#__LZO_ENTRY
 
__LZO_CDECL


	)

397 
	#LZO_EXTERN_CDECL
 
LZO_EXTERN


	)

398 
	#LZO_ALIGN
 
LZO_PTR_ALIGN_UP


	)

400 
	#lzo_com´ess_asm_t
 
lzo_com´ess_t


	)

401 
	#lzo_decom´ess_asm_t
 
lzo_decom´ess_t


	)

406 #ifdeà
__ılu¥lus


	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/lzo/lzodefs.h

37 #iâdeà
__LZODEFS_H_INCLUDED


38 
	#__LZODEFS_H_INCLUDED
 1

	)

40 #ià
defšed
(
__CYGWIN32__
è&& !defšed(
__CYGWIN__
)

41 
	#__CYGWIN__
 
__CYGWIN32__


	)

43 #ià
defšed
(
__IBMCPP__
è&& !defšed(
__IBMC__
)

44 
	#__IBMC__
 
__IBMCPP__


	)

46 #ià
defšed
(
__ICL
è&& defšed(
_WIN32
è&& !defšed(
__INTEL_COMPILER
)

47 
	#__INTEL_COMPILER
 
__ICL


	)

49 #ià1 && 
defšed
(
__INTERIX
è&& defšed(
__GNUC__
è&& !defšed(
_ALL_SOURCE
)

50 
	#_ALL_SOURCE
 1

	)

52 #ià
defšed
(
__ms__
è&& defšed(
__R5900__
)

53 #ià!
defšed
(
__LONG_MAX__
)

54 
	#__LONG_MAX__
 9223372036854775807L

	)

57 #ià
defšed
(
__INTEL_COMPILER
è&& defšed(
__lšux__
)

58 #´agm¨
w¬nšg
(
di§bË
: 193)

60 #ià
defšed
(
__KEIL__
è&& defšed(
__C166__
)

61 #´agm¨
w¬nšg
 
di§bË
 = 322

62 #–ià0 && 
defšed
(
__C251__
)

63 #´agm¨
w¬nšg
 
di§bË
 = 322

65 #ià
defšed
(
_MSC_VER
è&& !defšed(
__INTEL_COMPILER
è&& !defšed(
__MWERKS__
)

66 #ià(
_MSC_VER
 >= 1300)

67 #´agm¨
w¬nšg
(
di§bË
: 4668)

70 #ià0 && 
defšed
(
__WATCOMC__
)

71 #ià(
__WATCOMC__
 >= 1050) && (__WATCOMC__ < 1060)

72 #´agm¨
w¬nšg
 203 9

75 #ià
defšed
(
__BORLANDC__
è&& defšed(
__MSDOS__
è&& !defšed(
__FLAT__
)

76 #´agm¨
İtiÚ
 -
h


79 
	#LZO_0xffffL
 0xfffful

	)

80 
	#LZO_0xffffffffL
 0xfffffffful

	)

82 
	#LZO_0xffffL
 65535ul

	)

83 
	#LZO_0xffffffffL
 4294967295ul

	)

85 #ià(
LZO_0xffffL
 =ğ
LZO_0xffffffffL
)

99 #ià(
UINT_MAX
 =ğ
LZO_0xffffL
)

100 #ià
defšed
(
__ZTC__
è&& defšed(
__I86__
è&& !defšed(
__OS2__
)

101 #ià!
defšed
(
MSDOS
)

102 
	#MSDOS
 1

	)

104 #ià!
defšed
(
_MSDOS
)

105 
	#_MSDOS
 1

	)

107 #–ià0 && 
defšed
(
__VERSION
è&& defšed(
MB_LEN_MAX
)

108 #ià(
__VERSION
 =ğ520è&& (
MB_LEN_MAX
 == 1)

109 #ià!
defšed
(
__AZTEC_C__
)

110 
	#__AZTEC_C__
 
__VERSION


	)

112 #ià!
defšed
(
__DOS__
)

113 
	#__DOS__
 1

	)

118 #ià
defšed
(
_MSC_VER
è&& defšed(
M_I86HM
è&& (
UINT_MAX
 =ğ
LZO_0xffffL
)

119 
	#±rdiff_t
 

	)

120 
	#_PTRDIFF_T_DEFINED


	)

122 #ià(
UINT_MAX
 =ğ
LZO_0xffffL
)

123 #undeà
__LZO_RENAME_A


124 #undeà
__LZO_RENAME_B


125 #ià
defšed
(
__AZTEC_C__
è&& defšed(
__DOS__
)

126 
	#__LZO_RENAME_A
 1

	)

127 #–ià
defšed
(
_MSC_VER
è&& defšed(
MSDOS
)

128 #ià(
_MSC_VER
 < 600)

129 
	#__LZO_RENAME_A
 1

	)

130 #–ià(
_MSC_VER
 < 700)

131 
	#__LZO_RENAME_B
 1

	)

133 #–ià
defšed
(
__TSC__
è&& defšed(
__OS2__
)

134 
	#__LZO_RENAME_A
 1

	)

135 #–ià
defšed
(
__MSDOS__
è&& defšed(
__TURBOC__
) && (__TURBOC__ < 0x0410)

136 
	#__LZO_RENAME_A
 1

	)

137 #–ià
defšed
(
__PACIFIC__
è&& defšed(
DOS
)

138 #ià!
defšed
(
__çr
)

139 
	#__çr
 
çr


	)

141 #ià!
defšed
(
__Ã¬
)

142 
	#__Ã¬
 
Ã¬


	)

145 #ià
defšed
(
__LZO_RENAME_A
)

146 #ià!
defšed
(
__cdeş
)

147 
	#__cdeş
 
cdeş


	)

149 #ià!
defšed
(
__çr
)

150 
	#__çr
 
çr


	)

152 #ià!
defšed
(
__huge
)

153 
	#__huge
 
huge


	)

155 #ià!
defšed
(
__Ã¬
)

156 
	#__Ã¬
 
Ã¬


	)

158 #ià!
defšed
(
__·sÿl
)

159 
	#__·sÿl
 
·sÿl


	)

161 #ià!
defšed
(
__huge
)

162 
	#__huge
 
huge


	)

164 #–ià
defšed
(
__LZO_RENAME_B
)

165 #ià!
defšed
(
__cdeş
)

166 
	#__cdeş
 
_cdeş


	)

168 #ià!
defšed
(
__çr
)

169 
	#__çr
 
_çr


	)

171 #ià!
defšed
(
__huge
)

172 
	#__huge
 
_huge


	)

174 #ià!
defšed
(
__Ã¬
)

175 
	#__Ã¬
 
_Ã¬


	)

177 #ià!
defšed
(
__·sÿl
)

178 
	#__·sÿl
 
_·sÿl


	)

180 #–ià(
defšed
(
__PUREC__
è|| defšed(
__TURBOC__
)è&& defšed(
__TOS__
)

181 #ià!
defšed
(
__cdeş
)

182 
	#__cdeş
 
cdeş


	)

184 #ià!
defšed
(
__·sÿl
)

185 
	#__·sÿl
 
·sÿl


	)

188 #undeà
__LZO_RENAME_A


189 #undeà
__LZO_RENAME_B


191 #ià(
UINT_MAX
 =ğ
LZO_0xffffL
)

192 #ià
defšed
(
__AZTEC_C__
è&& defšed(
__DOS__
)

193 
	#LZO_BROKEN_CDECL_ALT_SYNTAX
 1

	)

194 #–ià
defšed
(
_MSC_VER
è&& defšed(
MSDOS
)

195 #ià(
_MSC_VER
 < 600)

196 
	#LZO_BROKEN_INTEGRAL_CONSTANTS
 1

	)

198 #ià(
_MSC_VER
 < 700)

199 
	#LZO_BROKEN_INTEGRAL_PROMOTION
 1

	)

200 
	#LZO_BROKEN_SIZEOF
 1

	)

202 #–ià
defšed
(
__PACIFIC__
è&& defšed(
DOS
)

203 
	#LZO_BROKEN_INTEGRAL_CONSTANTS
 1

	)

204 #–ià
defšed
(
__TURBOC__
è&& defšed(
__MSDOS__
)

205 #ià(
__TURBOC__
 < 0x0150)

206 
	#LZO_BROKEN_CDECL_ALT_SYNTAX
 1

	)

207 
	#LZO_BROKEN_INTEGRAL_CONSTANTS
 1

	)

208 
	#LZO_BROKEN_INTEGRAL_PROMOTION
 1

	)

210 #ià(
__TURBOC__
 < 0x0200)

211 
	#LZO_BROKEN_SIZEOF
 1

	)

213 #ià(
__TURBOC__
 < 0x0400è&& 
defšed
(
__ılu¥lus
)

214 
	#LZO_BROKEN_CDECL_ALT_SYNTAX
 1

	)

216 #–ià(
defšed
(
__PUREC__
è|| defšed(
__TURBOC__
)è&& defšed(
__TOS__
)

217 
	#LZO_BROKEN_CDECL_ALT_SYNTAX
 1

	)

218 
	#LZO_BROKEN_SIZEOF
 1

	)

221 #ià
defšed
(
__WATCOMC__
) && (__WATCOMC__ < 900)

222 
	#LZO_BROKEN_INTEGRAL_CONSTANTS
 1

	)

224 
	#LZO_CPP_STRINGIZE
(
x
è#x

	)

225 
	#LZO_CPP_MACRO_EXPAND
(
x
è
	`LZO_CPP_STRINGIZE
(x)

	)

226 
	#LZO_CPP_CONCAT2
(
a
,
b
è¨## 
	)
b

227 
	#LZO_CPP_CONCAT3
(
a
,
b
,
c
è¨## b ## 
	)
c

228 
	#LZO_CPP_CONCAT4
(
a
,
b
,
c
,
d
è¨## b ## c ## 
	)
d

229 
	#LZO_CPP_CONCAT5
(
a
,
b
,
c
,
d
,
e
è¨## b ## c ## d ## 
	)
e

230 
	#LZO_CPP_ECONCAT2
(
a
,
b
è
	`LZO_CPP_CONCAT2
×,b)

	)

231 
	#LZO_CPP_ECONCAT3
(
a
,
b
,
c
è
	`LZO_CPP_CONCAT3
×,b,c)

	)

232 
	#LZO_CPP_ECONCAT4
(
a
,
b
,
c
,
d
è
	`LZO_CPP_CONCAT4
×,b,c,d)

	)

233 
	#LZO_CPP_ECONCAT5
(
a
,
b
,
c
,
d
,
e
è
	`LZO_CPP_CONCAT5
×,b,c,d,e)

	)

234 
	#__LZO_MASK_GEN
(
o
,
b
è(((((oè<< ((b)-1)è- (o)è<< 1è+ (o))

	)

235 #ià1 && 
defšed
(
__ılu¥lus
)

236 #ià!
defšed
(
__STDC_CONSTANT_MACROS
)

237 
	#__STDC_CONSTANT_MACROS
 1

	)

239 #ià!
defšed
(
__STDC_LIMIT_MACROS
)

240 
	#__STDC_LIMIT_MACROS
 1

	)

243 #ià
defšed
(
__ılu¥lus
)

244 
	#LZO_EXTERN_C
 "C"

	)

246 
	#LZO_EXTERN_C
 

	)

248 #ià!
defšed
(
__LZO_OS_OVERRIDE
)

249 #ià
defšed
(
LZO_OS_FREESTANDING
)

250 
	#LZO_INFO_OS
 "ä“¡ªdšg"

	)

251 #–ià
defšed
(
LZO_OS_EMBEDDED
)

252 
	#LZO_INFO_OS
 "embedded"

	)

253 #–ià
defšed
(
__CYGWIN__
è&& defšed(
__GNUC__
)

254 
	#LZO_OS_CYGWIN
 1

	)

255 
	#LZO_INFO_OS
 "cygwš"

	)

256 #–ià
defšed
(
__EMX__
è&& defšed(
__GNUC__
)

257 
	#LZO_OS_EMX
 1

	)

258 
	#LZO_INFO_OS
 "emx"

	)

259 #–ià
defšed
(
__BEOS__
)

260 
	#LZO_OS_BEOS
 1

	)

261 
	#LZO_INFO_OS
 "beos"

	)

262 #–ià
defšed
(
__Lynx__
)

263 
	#LZO_OS_LYNXOS
 1

	)

264 
	#LZO_INFO_OS
 "lynxos"

	)

265 #–ià
defšed
(
__OS400__
)

266 
	#LZO_OS_OS400
 1

	)

267 
	#LZO_INFO_OS
 "os400"

	)

268 #–ià
defšed
(
__QNX__
)

269 
	#LZO_OS_QNX
 1

	)

270 
	#LZO_INFO_OS
 "qnx"

	)

271 #–ià
defšed
(
__BORLANDC__
è&& defšed(
__DPMI32__
) && (__BORLANDC__ >= 0x0460)

272 
	#LZO_OS_DOS32
 1

	)

273 
	#LZO_INFO_OS
 "dos32"

	)

274 #–ià
defšed
(
__BORLANDC__
è&& defšed(
__DPMI16__
)

275 
	#LZO_OS_DOS16
 1

	)

276 
	#LZO_INFO_OS
 "dos16"

	)

277 #–ià
defšed
(
__ZTC__
è&& defšed(
DOS386
)

278 
	#LZO_OS_DOS32
 1

	)

279 
	#LZO_INFO_OS
 "dos32"

	)

280 #–ià
defšed
(
__OS2__
è|| defšed(
__OS2V2__
)

281 #ià(
UINT_MAX
 =ğ
LZO_0xffffL
)

282 
	#LZO_OS_OS216
 1

	)

283 
	#LZO_INFO_OS
 "os216"

	)

284 #–ià(
UINT_MAX
 =ğ
LZO_0xffffffffL
)

285 
	#LZO_OS_OS2
 1

	)

286 
	#LZO_INFO_OS
 "os2"

	)

290 #–ià
defšed
(
__WIN64__
è|| defšed(
_WIN64
è|| defšed(
WIN64
)

291 
	#LZO_OS_WIN64
 1

	)

292 
	#LZO_INFO_OS
 "wš64"

	)

293 #–ià
defšed
(
__WIN32__
è|| defšed(
_WIN32
è|| defšed(
WIN32
è|| defšed(
__WINDOWS_386__
)

294 
	#LZO_OS_WIN32
 1

	)

295 
	#LZO_INFO_OS
 "wš32"

	)

296 #–ià
defšed
(
__MWERKS__
è&& defšed(
__INTEL__
)

297 
	#LZO_OS_WIN32
 1

	)

298 
	#LZO_INFO_OS
 "wš32"

	)

299 #–ià
defšed
(
__WINDOWS__
è|| defšed(
_WINDOWS
è|| defšed(
_Wšdows
)

300 #ià(
UINT_MAX
 =ğ
LZO_0xffffL
)

301 
	#LZO_OS_WIN16
 1

	)

302 
	#LZO_INFO_OS
 "wš16"

	)

303 #–ià(
UINT_MAX
 =ğ
LZO_0xffffffffL
)

304 
	#LZO_OS_WIN32
 1

	)

305 
	#LZO_INFO_OS
 "wš32"

	)

309 #–ià
defšed
(
__DOS__
è|| defšed(
__MSDOS__
è|| defšed(
_MSDOS
è|| defšed(
MSDOS
è|| (defšed(
__PACIFIC__
è&& defšed(
DOS
))

310 #ià(
UINT_MAX
 =ğ
LZO_0xffffL
)

311 
	#LZO_OS_DOS16
 1

	)

312 
	#LZO_INFO_OS
 "dos16"

	)

313 #–ià(
UINT_MAX
 =ğ
LZO_0xffffffffL
)

314 
	#LZO_OS_DOS32
 1

	)

315 
	#LZO_INFO_OS
 "dos32"

	)

319 #–ià
defšed
(
__WATCOMC__
)

320 #ià
defšed
(
__NT__
è&& (
UINT_MAX
 =ğ
LZO_0xffffL
)

321 
	#LZO_OS_DOS16
 1

	)

322 
	#LZO_INFO_OS
 "dos16"

	)

323 #–ià
defšed
(
__NT__
è&& (
__WATCOMC__
 < 1100)

324 
	#LZO_OS_WIN32
 1

	)

325 
	#LZO_INFO_OS
 "wš32"

	)

329 #–ià
defšed
(
__·lmos__
)

330 
	#LZO_OS_PALMOS
 1

	)

331 
	#LZO_INFO_OS
 "·lmos"

	)

332 #–ià
defšed
(
__TOS__
è|| defšed(
__©¬i¡__
)

333 
	#LZO_OS_TOS
 1

	)

334 
	#LZO_INFO_OS
 "tos"

	)

335 #–ià
defšed
(
macštosh
è&& !defšed(
__µc__
)

336 
	#LZO_OS_MACCLASSIC
 1

	)

337 
	#LZO_INFO_OS
 "macşassic"

	)

338 #–ià
defšed
(
__VMS
)

339 
	#LZO_OS_VMS
 1

	)

340 
	#LZO_INFO_OS
 "vms"

	)

341 #–ià((
defšed
(
__ms__
è&& defšed(
__R5900__
)è|| defšed(
__MIPS_PSX2__
))

342 
	#LZO_OS_CONSOLE
 1

	)

343 
	#LZO_OS_CONSOLE_PS2
 1

	)

344 
	#LZO_INFO_OS
 "cÚsŞe"

	)

345 
	#LZO_INFO_OS_CONSOLE
 "ps2"

	)

346 #–ià(
defšed
(
__ms__
è&& defšed(
__p¥__
))

347 
	#LZO_OS_CONSOLE
 1

	)

348 
	#LZO_OS_CONSOLE_PSP
 1

	)

349 
	#LZO_INFO_OS
 "cÚsŞe"

	)

350 
	#LZO_INFO_OS_CONSOLE
 "p¥"

	)

352 
	#LZO_OS_POSIX
 1

	)

353 
	#LZO_INFO_OS
 "posix"

	)

355 #ià(
LZO_OS_POSIX
)

356 #ià
defšed
(
_AIX
è|| defšed(
__AIX__
è|| defšed(
__aix__
)

357 
	#LZO_OS_POSIX_AIX
 1

	)

358 
	#LZO_INFO_OS_POSIX
 "aix"

	)

359 #–ià
defšed
(
__F»eBSD__
)

360 
	#LZO_OS_POSIX_FREEBSD
 1

	)

361 
	#LZO_INFO_OS_POSIX
 "ä“bsd"

	)

362 #–ià
defšed
(
__hpux__
è|| defšed(
__hpux
)

363 
	#LZO_OS_POSIX_HPUX
 1

	)

364 
	#LZO_INFO_OS_POSIX
 "hpux"

	)

365 #–ià
defšed
(
__INTERIX
)

366 
	#LZO_OS_POSIX_INTERIX
 1

	)

367 
	#LZO_INFO_OS_POSIX
 "š‹rix"

	)

368 #–ià
defšed
(
__IRIX__
è|| defšed(
__œix__
)

369 
	#LZO_OS_POSIX_IRIX
 1

	)

370 
	#LZO_INFO_OS_POSIX
 "œix"

	)

371 #–ià
defšed
(
__lšux__
è|| defšed(
__lšux
)

372 
	#LZO_OS_POSIX_LINUX
 1

	)

373 
	#LZO_INFO_OS_POSIX
 "lšux"

	)

374 #–ià
defšed
(
__APPLE__
è|| defšed(
__MACOS__
)

375 
	#LZO_OS_POSIX_MACOSX
 1

	)

376 
	#LZO_INFO_OS_POSIX
 "macosx"

	)

377 #–ià
defšed
(
__N‘BSD__
)

378 
	#LZO_OS_POSIX_NETBSD
 1

	)

379 
	#LZO_INFO_OS_POSIX
 "Ãtbsd"

	)

380 #–ià
defšed
(
__O³nBSD__
)

381 
	#LZO_OS_POSIX_OPENBSD
 1

	)

382 
	#LZO_INFO_OS_POSIX
 "İ’bsd"

	)

383 #–ià
defšed
(
__osf__
)

384 
	#LZO_OS_POSIX_OSF
 1

	)

385 
	#LZO_INFO_OS_POSIX
 "osf"

	)

386 #–ià
defšed
(
__sŞ¬is__
è|| defšed(
__sun
)

387 #ià
defšed
(
__SVR4
è|| defšed(
__svr4__
)

388 
	#LZO_OS_POSIX_SOLARIS
 1

	)

389 
	#LZO_INFO_OS_POSIX
 "sŞ¬is"

	)

391 
	#LZO_OS_POSIX_SUNOS
 1

	)

392 
	#LZO_INFO_OS_POSIX
 "sunos"

	)

394 #–ià
defšed
(
__uÉrix__
è|| defšed(
__uÉrix
)

395 
	#LZO_OS_POSIX_ULTRIX
 1

	)

396 
	#LZO_INFO_OS_POSIX
 "uÉrix"

	)

398 
	#LZO_OS_POSIX_UNKNOWN
 1

	)

399 
	#LZO_INFO_OS_POSIX
 "unknown"

	)

403 #ià(
LZO_OS_DOS16
 || 
LZO_OS_OS216
 || 
LZO_OS_WIN16
)

404 #ià(
UINT_MAX
 !ğ
LZO_0xffffL
)

407 #ià(
ULONG_MAX
 !ğ
LZO_0xffffffffL
)

411 #ià(
LZO_OS_DOS32
 || 
LZO_OS_OS2
 || 
LZO_OS_WIN32
 || 
LZO_OS_WIN64
)

412 #ià(
UINT_MAX
 !ğ
LZO_0xffffffffL
)

415 #ià(
ULONG_MAX
 !ğ
LZO_0xffffffffL
)

419 #ià
defšed
(
CIL
è&& defšed(
_GNUCC
è&& defšed(
__GNUC__
)

420 
	#LZO_CC_CILLY
 1

	)

421 
	#LZO_INFO_CC
 "Cly"

	)

422 #ià
defšed
(
__CILLY__
)

423 
	#LZO_INFO_CCVER
 
	`LZO_CPP_MACRO_EXPAND
(
__CILLY__
)

	)

425 
	#LZO_INFO_CCVER
 "unknown"

	)

427 #–ià0 && 
defšed
(
SDCC
è&& defšed(
__VERSION__
è&& !defšed(
__GNUC__
)

428 
	#LZO_CC_SDCC
 1

	)

429 
	#LZO_INFO_CC
 "sdcc"

	)

430 
	#LZO_INFO_CCVER
 
	`LZO_CPP_MACRO_EXPAND
(
SDCC
)

	)

431 #–ià
defšed
(
__PATHSCALE__
è&& defšed(
__PATHCC_PATCHLEVEL__
)

432 
	#LZO_CC_PATHSCALE
 (
__PATHCC__
 * 0x10000L + 
__PATHCC_MINOR__
 * 0x100 + 
__PATHCC_PATCHLEVEL__
)

	)

433 
	#LZO_INFO_CC
 "P©hsÿË C"

	)

434 
	#LZO_INFO_CCVER
 
__PATHSCALE__


	)

435 #–ià
defšed
(
__INTEL_COMPILER
)

436 
	#LZO_CC_INTELC
 1

	)

437 
	#LZO_INFO_CC
 "IÁ– C"

	)

438 
	#LZO_INFO_CCVER
 
	`LZO_CPP_MACRO_EXPAND
(
__INTEL_COMPILER
)

	)

439 #–ià
defšed
(
__POCC__
è&& defšed(
_WIN32
)

440 
	#LZO_CC_PELLESC
 1

	)

441 
	#LZO_INFO_CC
 "P–Ë C"

	)

442 
	#LZO_INFO_CCVER
 
	`LZO_CPP_MACRO_EXPAND
(
__POCC__
)

	)

443 #–ià
defšed
(
__Îvm__
è&& defšed(
__GNUC__
è&& defšed(
__VERSION__
)

444 
	#LZO_CC_LLVM
 1

	)

445 
	#LZO_INFO_CC
 "Îvm-gcc"

	)

446 
	#LZO_INFO_CCVER
 
__VERSION__


	)

447 #–ià
defšed
(
__GNUC__
è&& defšed(
__VERSION__
)

448 #ià
defšed
(
__GNUC_MINOR__
è&& defšed(
__GNUC_PATCHLEVEL__
)

449 
	#LZO_CC_GNUC
 (
__GNUC__
 * 0x10000L + 
__GNUC_MINOR__
 * 0x100 + 
__GNUC_PATCHLEVEL__
)

	)

450 #–ià
defšed
(
__GNUC_MINOR__
)

451 
	#LZO_CC_GNUC
 (
__GNUC__
 * 0x10000L + 
__GNUC_MINOR__
 * 0x100)

	)

453 
	#LZO_CC_GNUC
 (
__GNUC__
 * 0x10000L)

	)

455 
	#LZO_INFO_CC
 "gcc"

	)

456 
	#LZO_INFO_CCVER
 
__VERSION__


	)

457 #–ià
defšed
(
__AZTEC_C__
)

458 
	#LZO_CC_AZTECC
 1

	)

459 
	#LZO_INFO_CC
 "Az‹øC"

	)

460 
	#LZO_INFO_CCVER
 
	`LZO_CPP_MACRO_EXPAND
(
__AZTEC_C__
)

	)

461 #–ià
defšed
(
__BORLANDC__
)

462 
	#LZO_CC_BORLANDC
 1

	)

463 
	#LZO_INFO_CC
 "BÜÏnd C"

	)

464 
	#LZO_INFO_CCVER
 
	`LZO_CPP_MACRO_EXPAND
(
__BORLANDC__
)

	)

465 #–ià
defšed
(
__DMC__
è&& defšed(
__SC__
)

466 
	#LZO_CC_DMC
 1

	)

467 
	#LZO_INFO_CC
 "Dig™® M¬ C"

	)

468 
	#LZO_INFO_CCVER
 
	`LZO_CPP_MACRO_EXPAND
(
__DMC__
)

	)

469 #–ià
defšed
(
__DECC
)

470 
	#LZO_CC_DECC
 1

	)

471 
	#LZO_INFO_CC
 "DEC C"

	)

472 
	#LZO_INFO_CCVER
 
	`LZO_CPP_MACRO_EXPAND
(
__DECC
)

	)

473 #–ià
defšed
(
__HIGHC__
)

474 
	#LZO_CC_HIGHC
 1

	)

475 
	#LZO_INFO_CC
 "M‘aW¬High C"

	)

476 
	#LZO_INFO_CCVER
 "unknown"

	)

477 #–ià
defšed
(
__IBMC__
)

478 
	#LZO_CC_IBMC
 1

	)

479 
	#LZO_INFO_CC
 "IBM C"

	)

480 
	#LZO_INFO_CCVER
 
	`LZO_CPP_MACRO_EXPAND
(
__IBMC__
)

	)

481 #–ià
defšed
(
__KEIL__
è&& defšed(
__C166__
)

482 
	#LZO_CC_KEILC
 1

	)

483 
	#LZO_INFO_CC
 "Ke C"

	)

484 
	#LZO_INFO_CCVER
 
	`LZO_CPP_MACRO_EXPAND
(
__C166__
)

	)

485 #–ià
defšed
(
__LCC__
è&& defšed(
_WIN32
è&& defšed(
__LCCOPTIMLEVEL
)

486 
	#LZO_CC_LCCWIN32
 1

	)

487 
	#LZO_INFO_CC
 "lcc-wš32"

	)

488 
	#LZO_INFO_CCVER
 "unknown"

	)

489 #–ià
defšed
(
__LCC__
)

490 
	#LZO_CC_LCC
 1

	)

491 
	#LZO_INFO_CC
 "lcc"

	)

492 #ià
defšed
(
__LCC_VERSION__
)

493 
	#LZO_INFO_CCVER
 
	`LZO_CPP_MACRO_EXPAND
(
__LCC_VERSION__
)

	)

495 
	#LZO_INFO_CCVER
 "unknown"

	)

497 #–ià
defšed
(
_MSC_VER
)

498 
	#LZO_CC_MSC
 1

	)

499 
	#LZO_INFO_CC
 "Miüosoá C"

	)

500 #ià
defšed
(
_MSC_FULL_VER
)

501 
	#LZO_INFO_CCVER
 
	`LZO_CPP_MACRO_EXPAND
(
_MSC_VER
è"." LZO_CPP_MACRO_EXPAND(
_MSC_FULL_VER
)

	)

503 
	#LZO_INFO_CCVER
 
	`LZO_CPP_MACRO_EXPAND
(
_MSC_VER
)

	)

505 #–ià
defšed
(
__MWERKS__
)

506 
	#LZO_CC_MWERKS
 1

	)

507 
	#LZO_INFO_CC
 "M‘row”k C"

	)

508 
	#LZO_INFO_CCVER
 
	`LZO_CPP_MACRO_EXPAND
(
__MWERKS__
)

	)

509 #–ià(
defšed
(
__NDPC__
è|| defšed(
__NDPX__
)è&& defšed(
__i386
)

510 
	#LZO_CC_NDPC
 1

	)

511 
	#LZO_INFO_CC
 "Miüoway NDP C"

	)

512 
	#LZO_INFO_CCVER
 "unknown"

	)

513 #–ià
defšed
(
__PACIFIC__
)

514 
	#LZO_CC_PACIFICC
 1

	)

515 
	#LZO_INFO_CC
 "PacifiøC"

	)

516 
	#LZO_INFO_CCVER
 
	`LZO_CPP_MACRO_EXPAND
(
__PACIFIC__
)

	)

517 #–ià
defšed
(
__PGI
è&& (defšed(
__lšux__
è|| defšed(
__WIN32__
))

518 
	#LZO_CC_PGI
 1

	)

519 
	#LZO_INFO_CC
 "PÜªd Grou°PGI C"

	)

520 
	#LZO_INFO_CCVER
 "unknown"

	)

521 #–ià
defšed
(
__PUREC__
è&& defšed(
__TOS__
)

522 
	#LZO_CC_PUREC
 1

	)

523 
	#LZO_INFO_CC
 "Pu» C"

	)

524 
	#LZO_INFO_CCVER
 
	`LZO_CPP_MACRO_EXPAND
(
__PUREC__
)

	)

525 #–ià
defšed
(
__SC__
è&& defšed(
__ZTC__
)

526 
	#LZO_CC_SYMANTECC
 1

	)

527 
	#LZO_INFO_CC
 "Symª‹øC"

	)

528 
	#LZO_INFO_CCVER
 
	`LZO_CPP_MACRO_EXPAND
(
__SC__
)

	)

529 #–ià
defšed
(
__SUNPRO_C
)

530 
	#LZO_CC_SUNPROC
 1

	)

531 
	#LZO_INFO_CC
 "SuÀC"

	)

532 
	#LZO_INFO_CCVER
 "unknown"

	)

533 #–ià
defšed
(
__TINYC__
)

534 
	#LZO_CC_TINYC
 1

	)

535 
	#LZO_INFO_CC
 "Tšy C"

	)

536 
	#LZO_INFO_CCVER
 
	`LZO_CPP_MACRO_EXPAND
(
__TINYC__
)

	)

537 #–ià
defšed
(
__TSC__
)

538 
	#LZO_CC_TOPSPEEDC
 1

	)

539 
	#LZO_INFO_CC
 "TİS³ed C"

	)

540 
	#LZO_INFO_CCVER
 
	`LZO_CPP_MACRO_EXPAND
(
__TSC__
)

	)

541 #–ià
defšed
(
__WATCOMC__
)

542 
	#LZO_CC_WATCOMC
 1

	)

543 
	#LZO_INFO_CC
 "W©com C"

	)

544 
	#LZO_INFO_CCVER
 
	`LZO_CPP_MACRO_EXPAND
(
__WATCOMC__
)

	)

545 #–ià
defšed
(
__TURBOC__
)

546 
	#LZO_CC_TURBOC
 1

	)

547 
	#LZO_INFO_CC
 "TurbØC"

	)

548 
	#LZO_INFO_CCVER
 
	`LZO_CPP_MACRO_EXPAND
(
__TURBOC__
)

	)

549 #–ià
defšed
(
__ZTC__
)

550 
	#LZO_CC_ZORTECHC
 1

	)

551 
	#LZO_INFO_CC
 "ZÜ‹ch C"

	)

552 #ià(
__ZTC__
 == 0x310)

553 
	#LZO_INFO_CCVER
 "0x310"

	)

555 
	#LZO_INFO_CCVER
 
	`LZO_CPP_MACRO_EXPAND
(
__ZTC__
)

	)

558 
	#LZO_CC_UNKNOWN
 1

	)

559 
	#LZO_INFO_CC
 "unknown"

	)

560 
	#LZO_INFO_CCVER
 "unknown"

	)

562 #ià0 && (
LZO_CC_MSC
 && (
_MSC_VER
 >ğ1200)è&& !
defšed
(
_MSC_FULL_VER
)

565 #ià!
defšed
(
__LZO_ARCH_OVERRIDE
)

566 #ià
defšed
(
LZO_ARCH_GENERIC
)

567 
	#LZO_INFO_ARCH
 "g’”ic"

	)

568 #–ià(
LZO_OS_DOS16
 || 
LZO_OS_OS216
 || 
LZO_OS_WIN16
)

569 
	#LZO_ARCH_I086
 1

	)

570 
	#LZO_ARCH_IA16
 1

	)

571 
	#LZO_INFO_ARCH
 "i086"

	)

572 #–ià
defšed
(
__®pha__
è|| defšed(
__®pha
è|| defšed(
_M_ALPHA
)

573 
	#LZO_ARCH_ALPHA
 1

	)

574 
	#LZO_INFO_ARCH
 "®pha"

	)

575 #–ià
defšed
(
__amd64__
è|| defšed(
__x86_64__
è|| defšed(
_M_AMD64
)

576 
	#LZO_ARCH_AMD64
 1

	)

577 
	#LZO_INFO_ARCH
 "amd64"

	)

578 #–ià
defšed
(
__thumb__
è|| (defšed(
_M_ARM
è&& defšed(
_M_THUMB
))

579 
	#LZO_ARCH_ARM
 1

	)

580 
	#LZO_ARCH_ARM_THUMB
 1

	)

581 
	#LZO_INFO_ARCH
 "¬m_thumb"

	)

582 #–ià
defšed
(
__¬m__
è|| defšed(
_M_ARM
)

583 
	#LZO_ARCH_ARM
 1

	)

584 
	#LZO_INFO_ARCH
 "¬m"

	)

585 #–ià(
UINT_MAX
 <ğ
LZO_0xffffL
è&& 
defšed
(
__AVR__
)

586 
	#LZO_ARCH_AVR
 1

	)

587 
	#LZO_INFO_ARCH
 "avr"

	)

588 #–ià
defšed
(
__bfš__
)

589 
	#LZO_ARCH_BLACKFIN
 1

	)

590 
	#LZO_INFO_ARCH
 "bÏckfš"

	)

591 #–ià(
UINT_MAX
 =ğ
LZO_0xffffL
è&& 
defšed
(
__C166__
)

592 
	#LZO_ARCH_C166
 1

	)

593 
	#LZO_INFO_ARCH
 "c166"

	)

594 #–ià
defšed
(
__üis__
)

595 
	#LZO_ARCH_CRIS
 1

	)

596 
	#LZO_INFO_ARCH
 "üis"

	)

597 #–ià
defšed
(
__H8300__
è|| defšed(
__H8300H__
è|| defšed(
__H8300S__
è|| defšed(
__H8300SX__
)

598 
	#LZO_ARCH_H8300
 1

	)

599 
	#LZO_INFO_ARCH
 "h8300"

	)

600 #–ià
defšed
(
__hµa__
è|| defšed(
__hµa
)

601 
	#LZO_ARCH_HPPA
 1

	)

602 
	#LZO_INFO_ARCH
 "hµa"

	)

603 #–ià
defšed
(
__386__
è|| defšed(
__i386__
è|| defšed(
__i386
è|| defšed(
_M_IX86
è|| defšed(
_M_I386
)

604 
	#LZO_ARCH_I386
 1

	)

605 
	#LZO_ARCH_IA32
 1

	)

606 
	#LZO_INFO_ARCH
 "i386"

	)

607 #–ià(
LZO_CC_ZORTECHC
 && 
defšed
(
__I86__
))

608 
	#LZO_ARCH_I386
 1

	)

609 
	#LZO_ARCH_IA32
 1

	)

610 
	#LZO_INFO_ARCH
 "i386"

	)

611 #–ià(
LZO_OS_DOS32
 && 
LZO_CC_HIGHC
è&& 
defšed
(
_I386
)

612 
	#LZO_ARCH_I386
 1

	)

613 
	#LZO_ARCH_IA32
 1

	)

614 
	#LZO_INFO_ARCH
 "i386"

	)

615 #–ià
defšed
(
__Ÿ64__
è|| defšed(
__Ÿ64
è|| defšed(
_M_IA64
)

616 
	#LZO_ARCH_IA64
 1

	)

617 
	#LZO_INFO_ARCH
 "Ÿ64"

	)

618 #–ià(
UINT_MAX
 =ğ
LZO_0xffffL
è&& 
defšed
(
__m32c__
)

619 
	#LZO_ARCH_M16C
 1

	)

620 
	#LZO_INFO_ARCH
 "m16c"

	)

621 #–ià
defšed
(
__m32r__
)

622 
	#LZO_ARCH_M32R
 1

	)

623 
	#LZO_INFO_ARCH
 "m32r"

	)

624 #–ià(
LZO_OS_TOS
è|| 
defšed
(
__m68k__
è|| defšed(
__m68000__
è|| defšed(
__mc68000__
è|| defšed(
_M_M68K
)

625 
	#LZO_ARCH_M68K
 1

	)

626 
	#LZO_INFO_ARCH
 "m68k"

	)

627 #–ià(
UINT_MAX
 =ğ
LZO_0xffffL
è&& 
defšed
(
__C251__
)

628 
	#LZO_ARCH_MCS251
 1

	)

629 
	#LZO_INFO_ARCH
 "mcs251"

	)

630 #–ià(
UINT_MAX
 =ğ
LZO_0xffffL
è&& 
defšed
(
__C51__
)

631 
	#LZO_ARCH_MCS51
 1

	)

632 
	#LZO_INFO_ARCH
 "mcs51"

	)

633 #–ià
defšed
(
__ms__
è|| defšed(
__ms
è|| defšed(
_MIPS_ARCH
è|| defšed(
_M_MRX000
)

634 
	#LZO_ARCH_MIPS
 1

	)

635 
	#LZO_INFO_ARCH
 "ms"

	)

636 #–ià(
UINT_MAX
 =ğ
LZO_0xffffL
è&& 
defšed
(
__MSP430__
)

637 
	#LZO_ARCH_MSP430
 1

	)

638 
	#LZO_INFO_ARCH
 "m¥430"

	)

639 #–ià
defšed
(
__pow”pc__
è|| defšed(
__pow”pc
è|| defšed(
__µc__
è|| defšed(
__PPC__
è|| defšed(
_M_PPC
)

640 
	#LZO_ARCH_POWERPC
 1

	)

641 
	#LZO_INFO_ARCH
 "pow”pc"

	)

642 #–ià
defšed
(
__s390__
è|| defšed(
__s390
è|| defšed(
__s390x__
è|| defšed(
__s390x
)

643 
	#LZO_ARCH_S390
 1

	)

644 
	#LZO_INFO_ARCH
 "s390"

	)

645 #–ià
defšed
(
__sh__
è|| defšed(
_M_SH
)

646 
	#LZO_ARCH_SH
 1

	)

647 
	#LZO_INFO_ARCH
 "sh"

	)

648 #–ià
defšed
(
__¥¬c__
è|| defšed(
__¥¬c
è|| defšed(
__¥¬cv8
)

649 
	#LZO_ARCH_SPARC
 1

	)

650 
	#LZO_INFO_ARCH
 "¥¬c"

	)

651 #–ià(
UINT_MAX
 =ğ
LZO_0xffffL
è&& 
defšed
(
__z80
)

652 
	#LZO_ARCH_Z80
 1

	)

653 
	#LZO_INFO_ARCH
 "z80"

	)

655 
	#LZO_ARCH_UNKNOWN
 1

	)

656 
	#LZO_INFO_ARCH
 "unknown"

	)

659 #ià1 && (
LZO_ARCH_UNKNOWN
è&& (
LZO_OS_DOS32
 || 
LZO_OS_OS2
)

662 #ià1 && (
LZO_ARCH_UNKNOWN
è&& (
LZO_OS_WIN32
)

665 #ià1 && (
LZO_ARCH_UNKNOWN
è&& (
LZO_OS_WIN64
)

668 #ià(
LZO_OS_OS216
 || 
LZO_OS_WIN16
)

669 
	#LZO_ARCH_I086PM
 1

	)

670 
	#LZO_ARCH_IA16PM
 1

	)

671 #–ià1 && (
LZO_OS_DOS16
 && 
defšed
(
BLX286
))

672 
	#LZO_ARCH_I086PM
 1

	)

673 
	#LZO_ARCH_IA16PM
 1

	)

674 #–ià1 && (
LZO_OS_DOS16
 && 
defšed
(
DOSX286
))

675 
	#LZO_ARCH_I086PM
 1

	)

676 
	#LZO_ARCH_IA16PM
 1

	)

677 #–ià1 && (
LZO_OS_DOS16
 && 
LZO_CC_BORLANDC
 && 
defšed
(
__DPMI16__
))

678 
	#LZO_ARCH_I086PM
 1

	)

679 
	#LZO_ARCH_IA16PM
 1

	)

681 #ià
defšed
(
LZO_ARCH_ARM_THUMB
è&& !defšed(
LZO_ARCH_ARM
)

684 #ià
defšed
(
LZO_ARCH_I086PM
è&& !defšed(
LZO_ARCH_I086
)

687 #ià(
LZO_ARCH_I086
)

688 #ià(
UINT_MAX
 !ğ
LZO_0xffffL
)

691 #ià(
ULONG_MAX
 !ğ
LZO_0xffffffffL
)

695 #ià(
LZO_ARCH_I386
)

696 #ià(
UINT_MAX
 !ğ
LZO_0xffffL
è&& 
defšed
(
__i386_št16__
)

699 #ià(
UINT_MAX
 !ğ
LZO_0xffffffffL
è&& !
defšed
(
__i386_št16__
)

702 #ià(
ULONG_MAX
 !ğ
LZO_0xffffffffL
)

706 #ià!
defšed
(
__LZO_MM_OVERRIDE
)

707 #ià(
LZO_OS_DOS16
 || 
LZO_OS_OS216
 || 
LZO_OS_WIN16
)

708 #ià(
UINT_MAX
 !ğ
LZO_0xffffL
)

711 #ià
defšed
(
__TINY__
è|| defšed(
M_I86TM
è|| defšed(
_M_I86TM
)

712 
	#LZO_MM_TINY
 1

	)

713 #–ià
defšed
(
__HUGE__
è|| defšed(
_HUGE_
è|| defšed(
M_I86HM
è|| defšed(
_M_I86HM
)

714 
	#LZO_MM_HUGE
 1

	)

715 #–ià
defšed
(
__SMALL__
è|| defšed(
M_I86SM
è|| defšed(
_M_I86SM
è|| defšed(
SMALL_MODEL
)

716 
	#LZO_MM_SMALL
 1

	)

717 #–ià
defšed
(
__MEDIUM__
è|| defšed(
M_I86MM
è|| defšed(
_M_I86MM
)

718 
	#LZO_MM_MEDIUM
 1

	)

719 #–ià
defšed
(
__COMPACT__
è|| defšed(
M_I86CM
è|| defšed(
_M_I86CM
)

720 
	#LZO_MM_COMPACT
 1

	)

721 #–ià
defšed
(
__LARGE__
è|| defšed(
M_I86LM
è|| defšed(
_M_I86LM
è|| defšed(
LARGE_MODEL
)

722 
	#LZO_MM_LARGE
 1

	)

723 #–ià(
LZO_CC_AZTECC
)

724 #ià
defšed
(
_LARGE_CODE
è&& defšed(
_LARGE_DATA
)

725 
	#LZO_MM_LARGE
 1

	)

726 #–ià
defšed
(
_LARGE_CODE
)

727 
	#LZO_MM_MEDIUM
 1

	)

728 #–ià
defšed
(
_LARGE_DATA
)

729 
	#LZO_MM_COMPACT
 1

	)

731 
	#LZO_MM_SMALL
 1

	)

733 #–ià(
LZO_CC_ZORTECHC
 && 
defšed
(
__VCM__
))

734 
	#LZO_MM_LARGE
 1

	)

738 
	#LZO_HAVE_MM_HUGE_PTR
 1

	)

739 
	#LZO_HAVE_MM_HUGE_ARRAY
 1

	)

740 #ià(
LZO_MM_TINY
)

741 #undeà
LZO_HAVE_MM_HUGE_ARRAY


743 #ià(
LZO_CC_AZTECC
 || 
LZO_CC_PACIFICC
 || 
LZO_CC_ZORTECHC
)

744 #undeà
LZO_HAVE_MM_HUGE_PTR


745 #undeà
LZO_HAVE_MM_HUGE_ARRAY


746 #–ià(
LZO_CC_DMC
 || 
LZO_CC_SYMANTECC
)

747 #undeà
LZO_HAVE_MM_HUGE_ARRAY


748 #–ià(
LZO_CC_MSC
 && 
defšed
(
_QC
))

749 #undeà
LZO_HAVE_MM_HUGE_ARRAY


750 #ià(
_MSC_VER
 < 600)

751 #undeà
LZO_HAVE_MM_HUGE_PTR


753 #–ià(
LZO_CC_TURBOC
 && (
__TURBOC__
 < 0x0295))

754 #undeà
LZO_HAVE_MM_HUGE_ARRAY


756 #ià(
LZO_ARCH_I086PM
è&& !
defšed
(
LZO_HAVE_MM_HUGE_PTR
)

757 #ià(
LZO_OS_DOS16
)

759 #–ià(
LZO_CC_ZORTECHC
)

764 #ifdeà
__ılu¥lus


767 #ià(
LZO_CC_BORLANDC
 && (
__BORLANDC__
 >= 0x0200))

768 
__Ã¬
 
__cdeş
 
_AHSHIFT
();

769 
	#LZO_MM_AHSHIFT
 ((è
_AHSHIFT
)

	)

770 #–ià(
LZO_CC_DMC
 || 
LZO_CC_SYMANTECC
 || 
LZO_CC_ZORTECHC
)

771 
__Ã¬
 
__cdeş
 
_AHSHIFT
();

772 
	#LZO_MM_AHSHIFT
 ((è
_AHSHIFT
)

	)

773 #–ià(
LZO_CC_MSC
 || 
LZO_CC_TOPSPEEDC
)

774 
__Ã¬
 
__cdeş
 
_AHSHIFT
();

775 
	#LZO_MM_AHSHIFT
 ((è
_AHSHIFT
)

	)

776 #–ià(
LZO_CC_TURBOC
 && (
__TURBOC__
 >= 0x0295))

777 
__Ã¬
 
__cdeş
 
_AHSHIFT
();

778 
	#LZO_MM_AHSHIFT
 ((è
_AHSHIFT
)

	)

779 #–ià((
LZO_CC_AZTECC
 || 
LZO_CC_PACIFICC
 || 
LZO_CC_TURBOC
è&& 
LZO_OS_DOS16
)

780 
	#LZO_MM_AHSHIFT
 12

	)

781 #–ià(
LZO_CC_WATCOMC
)

782 
_HShiá
;

783 
	#LZO_MM_AHSHIFT
 ((è
_HShiá
)

	)

787 #ifdeà
__ılu¥lus


790 #–ià(
LZO_ARCH_C166
)

791 #ià!
defšed
(
__MODEL__
)

793 #–ià((
__MODEL__
) == 0)

794 
	#LZO_MM_SMALL
 1

	)

795 #–ià((
__MODEL__
) == 1)

796 
	#LZO_MM_SMALL
 1

	)

797 #–ià((
__MODEL__
) == 2)

798 
	#LZO_MM_LARGE
 1

	)

799 #–ià((
__MODEL__
) == 3)

800 
	#LZO_MM_TINY
 1

	)

801 #–ià((
__MODEL__
) == 4)

802 
	#LZO_MM_XTINY
 1

	)

803 #–ià((
__MODEL__
) == 5)

804 
	#LZO_MM_XSMALL
 1

	)

808 #–ià(
LZO_ARCH_MCS251
)

809 #ià!
defšed
(
__MODEL__
)

811 #–ià((
__MODEL__
) == 0)

812 
	#LZO_MM_SMALL
 1

	)

813 #–ià((
__MODEL__
) == 2)

814 
	#LZO_MM_LARGE
 1

	)

815 #–ià((
__MODEL__
) == 3)

816 
	#LZO_MM_TINY
 1

	)

817 #–ià((
__MODEL__
) == 4)

818 
	#LZO_MM_XTINY
 1

	)

819 #–ià((
__MODEL__
) == 5)

820 
	#LZO_MM_XSMALL
 1

	)

824 #–ià(
LZO_ARCH_MCS51
)

825 #ià!
defšed
(
__MODEL__
)

827 #–ià((
__MODEL__
) == 1)

828 
	#LZO_MM_SMALL
 1

	)

829 #–ià((
__MODEL__
) == 2)

830 
	#LZO_MM_LARGE
 1

	)

831 #–ià((
__MODEL__
) == 3)

832 
	#LZO_MM_TINY
 1

	)

833 #–ià((
__MODEL__
) == 4)

834 
	#LZO_MM_XTINY
 1

	)

835 #–ià((
__MODEL__
) == 5)

836 
	#LZO_MM_XSMALL
 1

	)

841 
	#LZO_MM_FLAT
 1

	)

843 #ià(
LZO_MM_FLAT
)

844 
	#LZO_INFO_MM
 "æ©"

	)

845 #–ià(
LZO_MM_TINY
)

846 
	#LZO_INFO_MM
 "tšy"

	)

847 #–ià(
LZO_MM_SMALL
)

848 
	#LZO_INFO_MM
 "sm®l"

	)

849 #–ià(
LZO_MM_MEDIUM
)

850 
	#LZO_INFO_MM
 "medium"

	)

851 #–ià(
LZO_MM_COMPACT
)

852 
	#LZO_INFO_MM
 "com·ù"

	)

853 #–ià(
LZO_MM_LARGE
)

854 
	#LZO_INFO_MM
 "Ïrge"

	)

855 #–ià(
LZO_MM_HUGE
)

856 
	#LZO_INFO_MM
 "huge"

	)

861 #ià
defšed
(
SIZEOF_SHORT
)

862 
	#LZO_SIZEOF_SHORT
 (
SIZEOF_SHORT
)

	)

864 #ià
defšed
(
SIZEOF_INT
)

865 
	#LZO_SIZEOF_INT
 (
SIZEOF_INT
)

	)

867 #ià
defšed
(
SIZEOF_LONG
)

868 
	#LZO_SIZEOF_LONG
 (
SIZEOF_LONG
)

	)

870 #ià
defšed
(
SIZEOF_LONG_LONG
)

871 
	#LZO_SIZEOF_LONG_LONG
 (
SIZEOF_LONG_LONG
)

	)

873 #ià
defšed
(
SIZEOF___INT16
)

874 
	#LZO_SIZEOF___INT16
 (
SIZEOF___INT16
)

	)

876 #ià
defšed
(
SIZEOF___INT32
)

877 
	#LZO_SIZEOF___INT32
 (
SIZEOF___INT32
)

	)

879 #ià
defšed
(
SIZEOF___INT64
)

880 
	#LZO_SIZEOF___INT64
 (
SIZEOF___INT64
)

	)

882 #ià
defšed
(
SIZEOF_VOID_P
)

883 
	#LZO_SIZEOF_VOID_P
 (
SIZEOF_VOID_P
)

	)

885 #ià
defšed
(
SIZEOF_SIZE_T
)

886 
	#LZO_SIZEOF_SIZE_T
 (
SIZEOF_SIZE_T
)

	)

888 #ià
defšed
(
SIZEOF_PTRDIFF_T
)

889 
	#LZO_SIZEOF_PTRDIFF_T
 (
SIZEOF_PTRDIFF_T
)

	)

891 
	#__LZO_LSR
(
x
,
b
è(((x)+0ulè>> (b))

	)

892 #ià!
defšed
(
LZO_SIZEOF_SHORT
)

893 #ià(
USHRT_MAX
 =ğ
LZO_0xffffL
)

894 
	#LZO_SIZEOF_SHORT
 2

	)

895 #–ià(
__LZO_LSR
(
USHRT_MAX
,7) == 1)

896 
	#LZO_SIZEOF_SHORT
 1

	)

897 #–ià(
__LZO_LSR
(
USHRT_MAX
,15) == 1)

898 
	#LZO_SIZEOF_SHORT
 2

	)

899 #–ià(
__LZO_LSR
(
USHRT_MAX
,31) == 1)

900 
	#LZO_SIZEOF_SHORT
 4

	)

901 #–ià(
__LZO_LSR
(
USHRT_MAX
,63) == 1)

902 
	#LZO_SIZEOF_SHORT
 8

	)

903 #–ià(
__LZO_LSR
(
USHRT_MAX
,127) == 1)

904 
	#LZO_SIZEOF_SHORT
 16

	)

909 #ià!
defšed
(
LZO_SIZEOF_INT
)

910 #ià(
UINT_MAX
 =ğ
LZO_0xffffL
)

911 
	#LZO_SIZEOF_INT
 2

	)

912 #–ià(
UINT_MAX
 =ğ
LZO_0xffffffffL
)

913 
	#LZO_SIZEOF_INT
 4

	)

914 #–ià(
__LZO_LSR
(
UINT_MAX
,7) == 1)

915 
	#LZO_SIZEOF_INT
 1

	)

916 #–ià(
__LZO_LSR
(
UINT_MAX
,15) == 1)

917 
	#LZO_SIZEOF_INT
 2

	)

918 #–ià(
__LZO_LSR
(
UINT_MAX
,31) == 1)

919 
	#LZO_SIZEOF_INT
 4

	)

920 #–ià(
__LZO_LSR
(
UINT_MAX
,63) == 1)

921 
	#LZO_SIZEOF_INT
 8

	)

922 #–ià(
__LZO_LSR
(
UINT_MAX
,127) == 1)

923 
	#LZO_SIZEOF_INT
 16

	)

928 #ià!
defšed
(
LZO_SIZEOF_LONG
)

929 #ià(
ULONG_MAX
 =ğ
LZO_0xffffffffL
)

930 
	#LZO_SIZEOF_LONG
 4

	)

931 #–ià(
__LZO_LSR
(
ULONG_MAX
,7) == 1)

932 
	#LZO_SIZEOF_LONG
 1

	)

933 #–ià(
__LZO_LSR
(
ULONG_MAX
,15) == 1)

934 
	#LZO_SIZEOF_LONG
 2

	)

935 #–ià(
__LZO_LSR
(
ULONG_MAX
,31) == 1)

936 
	#LZO_SIZEOF_LONG
 4

	)

937 #–ià(
__LZO_LSR
(
ULONG_MAX
,63) == 1)

938 
	#LZO_SIZEOF_LONG
 8

	)

939 #–ià(
__LZO_LSR
(
ULONG_MAX
,127) == 1)

940 
	#LZO_SIZEOF_LONG
 16

	)

945 #ià!
defšed
(
LZO_SIZEOF_LONG_LONG
è&& !defšed(
LZO_SIZEOF___INT64
)

946 #ià(
LZO_SIZEOF_LONG
 > 0 && LZO_SIZEOF_LONG < 8)

947 #ià
defšed
(
__LONG_MAX__
è&& defšed(
__LONG_LONG_MAX__
)

948 #ià(
LZO_CC_GNUC
 >= 0x030300ul)

949 #ià((
__LONG_MAX__
)+0 =ğ(
__LONG_LONG_MAX__
)+0)

950 
	#LZO_SIZEOF_LONG_LONG
 
LZO_SIZEOF_LONG


	)

956 #ià!
defšed
(
LZO_SIZEOF_LONG_LONG
è&& !defšed(
LZO_SIZEOF___INT64
)

957 #ià(
LZO_SIZEOF_LONG
 > 0 && LZO_SIZEOF_LONG < 8)

958 #ià(
LZO_ARCH_I086
 && 
LZO_CC_DMC
)

959 #–ià(
LZO_CC_CILLY
è&& 
defšed
(
__GNUC__
)

960 
	#LZO_SIZEOF_LONG_LONG
 8

	)

961 #–ià(
LZO_CC_GNUC
 || 
LZO_CC_LLVM
 || 
LZO_CC_PATHSCALE
)

962 
	#LZO_SIZEOF_LONG_LONG
 8

	)

963 #–ià((
LZO_OS_WIN32
 || 
LZO_OS_WIN64
è&& 
LZO_CC_MSC
 && (
_MSC_VER
 >= 1400))

964 
	#LZO_SIZEOF_LONG_LONG
 8

	)

965 #–ià(
LZO_OS_WIN64
)

966 
	#LZO_SIZEOF___INT64
 8

	)

967 #–ià(
LZO_ARCH_I386
 && (
LZO_CC_DMC
))

968 
	#LZO_SIZEOF_LONG_LONG
 8

	)

969 #–ià(
LZO_ARCH_I386
 && (
LZO_CC_SYMANTECC
 && (
__SC__
 >= 0x700)))

970 
	#LZO_SIZEOF_LONG_LONG
 8

	)

971 #–ià(
LZO_ARCH_I386
 && (
LZO_CC_INTELC
 && 
defšed
(
__lšux__
)))

972 
	#LZO_SIZEOF_LONG_LONG
 8

	)

973 #–ià(
LZO_ARCH_I386
 && (
LZO_CC_MWERKS
 || 
LZO_CC_PELLESC
 || 
LZO_CC_PGI
))

974 
	#LZO_SIZEOF_LONG_LONG
 8

	)

975 #–ià(
LZO_ARCH_I386
 && (
LZO_CC_INTELC
 || 
LZO_CC_MSC
))

976 
	#LZO_SIZEOF___INT64
 8

	)

977 #–ià(
LZO_OS_WIN32
 && (
LZO_CC_MSC
))

978 
	#LZO_SIZEOF___INT64
 8

	)

979 #–ià(
LZO_ARCH_I386
 && (
LZO_CC_BORLANDC
 && (
__BORLANDC__
 >= 0x0520)))

980 
	#LZO_SIZEOF___INT64
 8

	)

981 #–ià(
LZO_ARCH_I386
 && (
LZO_CC_WATCOMC
 && (
__WATCOMC__
 >= 1100)))

982 
	#LZO_SIZEOF___INT64
 8

	)

983 #–ià(
LZO_CC_WATCOMC
 && 
defšed
(
_INTEGRAL_MAX_BITS
) && (_INTEGRAL_MAX_BITS == 64))

984 
	#LZO_SIZEOF___INT64
 8

	)

985 #–ià(
LZO_OS_OS400
è&& 
defšed
(
__LLP64_IFC__
)

986 
	#LZO_SIZEOF_LONG_LONG
 8

	)

987 #–ià(
defšed
(
__vms
è|| defšed(
__VMS
)è&& (
__INITIAL_POINTER_SIZE
+0 == 64)

988 
	#LZO_SIZEOF_LONG_LONG
 8

	)

989 #–ià(
LZO_CC_SDCC
è&& (
LZO_SIZEOF_INT
 == 2)

990 #–ià1 && 
defšed
(
__STDC_VERSION__
) && (__STDC_VERSION__ >= 199901L)

991 
	#LZO_SIZEOF_LONG_LONG
 8

	)

995 #ià
defšed
(
__ılu¥lus
è&& defšed(
LZO_CC_GNUC
)

996 #ià(
LZO_CC_GNUC
 < 0x020800ul)

997 #undeà
LZO_SIZEOF_LONG_LONG


1000 #ià
defšed
(
LZO_CFG_NO_LONG_LONG
è|| defšed(
__NO_LONG_LONG
)

1001 #undeà
LZO_SIZEOF_LONG_LONG


1003 #ià!
defšed
(
LZO_SIZEOF_VOID_P
)

1004 #ià(
LZO_ARCH_I086
)

1005 
	#__LZO_WORDSIZE
 2

	)

1006 #ià(
LZO_MM_TINY
 || 
LZO_MM_SMALL
 || 
LZO_MM_MEDIUM
)

1007 
	#LZO_SIZEOF_VOID_P
 2

	)

1008 #–ià(
LZO_MM_COMPACT
 || 
LZO_MM_LARGE
 || 
LZO_MM_HUGE
)

1009 
	#LZO_SIZEOF_VOID_P
 4

	)

1013 #–ià(
LZO_ARCH_AVR
 || 
LZO_ARCH_Z80
)

1014 
	#__LZO_WORDSIZE
 1

	)

1015 
	#LZO_SIZEOF_VOID_P
 2

	)

1016 #–ià(
LZO_ARCH_C166
 || 
LZO_ARCH_MCS51
 || 
LZO_ARCH_MCS251
 || 
LZO_ARCH_MSP430
)

1017 
	#LZO_SIZEOF_VOID_P
 2

	)

1018 #–ià(
LZO_ARCH_H8300
)

1019 #ià
defšed
(
__NORMAL_MODE__
)

1020 
	#__LZO_WORDSIZE
 4

	)

1021 
	#LZO_SIZEOF_VOID_P
 2

	)

1022 #–ià
defšed
(
__H8300H__
è|| defšed(
__H8300S__
è|| defšed(
__H8300SX__
)

1023 
	#__LZO_WORDSIZE
 4

	)

1024 
	#LZO_SIZEOF_VOID_P
 4

	)

1026 
	#__LZO_WORDSIZE
 2

	)

1027 
	#LZO_SIZEOF_VOID_P
 2

	)

1029 #ià(
LZO_CC_GNUC
 && (LZO_CC_GNUC < 0x040000ul)è&& (
LZO_SIZEOF_INT
 == 4)

1030 
	#LZO_SIZEOF_SIZE_T
 
LZO_SIZEOF_INT


	)

1031 
	#LZO_SIZEOF_PTRDIFF_T
 
LZO_SIZEOF_INT


	)

1033 #–ià(
LZO_ARCH_M16C
)

1034 
	#__LZO_WORDSIZE
 2

	)

1035 #ià
defšed
(
__m32c_ıu__
è|| defšed(
__m32cm_ıu__
)

1036 
	#LZO_SIZEOF_VOID_P
 4

	)

1038 
	#LZO_SIZEOF_VOID_P
 2

	)

1040 #–ià(
LZO_SIZEOF_LONG
 =ğ8è&& ((
defšed
(
__ms__
è&& defšed(
__R5900__
)è|| defšed(
__MIPS_PSX2__
))

1041 
	#__LZO_WORDSIZE
 8

	)

1042 
	#LZO_SIZEOF_VOID_P
 4

	)

1043 #–ià
defšed
(
__LLP64__
è|| defšed(
__LLP64
è|| defšed(
_LLP64
è|| defšed(
_WIN64
)

1044 
	#__LZO_WORDSIZE
 8

	)

1045 
	#LZO_SIZEOF_VOID_P
 8

	)

1046 #–ià(
LZO_OS_OS400
è&& 
defšed
(
__LLP64_IFC__
)

1047 
	#LZO_SIZEOF_VOID_P
 
LZO_SIZEOF_LONG


	)

1048 
	#LZO_SIZEOF_SIZE_T
 
LZO_SIZEOF_LONG


	)

1049 
	#LZO_SIZEOF_PTRDIFF_T
 
LZO_SIZEOF_LONG


	)

1050 #–ià(
LZO_OS_OS400
)

1051 
	#__LZO_WORDSIZE
 
LZO_SIZEOF_LONG


	)

1052 
	#LZO_SIZEOF_VOID_P
 16

	)

1053 
	#LZO_SIZEOF_SIZE_T
 
LZO_SIZEOF_LONG


	)

1054 
	#LZO_SIZEOF_PTRDIFF_T
 
LZO_SIZEOF_LONG


	)

1055 #–ià(
defšed
(
__vms
è|| defšed(
__VMS
)è&& (
__INITIAL_POINTER_SIZE
+0 == 64)

1056 
	#LZO_SIZEOF_VOID_P
 8

	)

1057 
	#LZO_SIZEOF_SIZE_T
 
LZO_SIZEOF_LONG


	)

1058 
	#LZO_SIZEOF_PTRDIFF_T
 
LZO_SIZEOF_LONG


	)

1060 
	#LZO_SIZEOF_VOID_P
 
LZO_SIZEOF_LONG


	)

1063 #ià!
defšed
(
LZO_WORDSIZE
)

1064 #ià
defšed
(
__LZO_WORDSIZE
)

1065 
	#LZO_WORDSIZE
 
__LZO_WORDSIZE


	)

1067 
	#LZO_WORDSIZE
 
LZO_SIZEOF_VOID_P


	)

1070 #ià!
defšed
(
LZO_SIZEOF_SIZE_T
)

1071 #ià(
LZO_ARCH_I086
 || 
LZO_ARCH_M16C
)

1072 
	#LZO_SIZEOF_SIZE_T
 2

	)

1074 
	#LZO_SIZEOF_SIZE_T
 
LZO_SIZEOF_VOID_P


	)

1077 #ià!
defšed
(
LZO_SIZEOF_PTRDIFF_T
)

1078 #ià(
LZO_ARCH_I086
)

1079 #ià(
LZO_MM_TINY
 || 
LZO_MM_SMALL
 || 
LZO_MM_MEDIUM
 || 
LZO_MM_HUGE
)

1080 
	#LZO_SIZEOF_PTRDIFF_T
 
LZO_SIZEOF_VOID_P


	)

1081 #–ià(
LZO_MM_COMPACT
 || 
LZO_MM_LARGE
)

1082 #ià(
LZO_CC_BORLANDC
 || 
LZO_CC_TURBOC
)

1083 
	#LZO_SIZEOF_PTRDIFF_T
 4

	)

1085 
	#LZO_SIZEOF_PTRDIFF_T
 2

	)

1091 
	#LZO_SIZEOF_PTRDIFF_T
 
LZO_SIZEOF_SIZE_T


	)

1094 #ià!
defšed
(
LZO_ABI_BIG_ENDIAN
è&& !defšed(
LZO_ABI_LITTLE_ENDIAN
è&& !defšed(
LZO_ABI_NEUTRAL_ENDIAN
)

1095 #ià(
LZO_ARCH_AMD64
 || 
LZO_ARCH_CRIS
 || 
LZO_ARCH_I086
 || 
LZO_ARCH_I386
 || 
LZO_ARCH_MSP430
)

1096 
	#LZO_ABI_LITTLE_ENDIAN
 1

	)

1097 #–ià(
LZO_ARCH_M68K
 || 
LZO_ARCH_S390
)

1098 
	#LZO_ABI_BIG_ENDIAN
 1

	)

1099 #–ià1 && 
defšed
(
__BIG_ENDIAN__
è&& !defšed(
__LITTLE_ENDIAN__
)

1100 
	#LZO_ABI_BIG_ENDIAN
 1

	)

1101 #–ià1 && 
defšed
(
__LITTLE_ENDIAN__
è&& !defšed(
__BIG_ENDIAN__
)

1102 
	#LZO_ABI_LITTLE_ENDIAN
 1

	)

1103 #–ià1 && (
LZO_ARCH_MIPS
è&& 
defšed
(
__MIPSEB__
è&& !defšed(
__MIPSEL__
)

1104 
	#LZO_ABI_BIG_ENDIAN
 1

	)

1105 #–ià1 && (
LZO_ARCH_MIPS
è&& 
defšed
(
__MIPSEL__
è&& !defšed(
__MIPSEB__
)

1106 
	#LZO_ABI_LITTLE_ENDIAN
 1

	)

1109 #ià
defšed
(
LZO_ABI_BIG_ENDIAN
è&& defšed(
LZO_ABI_LITTLE_ENDIAN
)

1112 #ià
defšed
(
LZO_ABI_BIG_ENDIAN
)

1113 
	#LZO_INFO_ABI_ENDIAN
 "be"

	)

1114 #–ià
defšed
(
LZO_ABI_LITTLE_ENDIAN
)

1115 
	#LZO_INFO_ABI_ENDIAN
 "Ë"

	)

1116 #–ià
defšed
(
LZO_ABI_NEUTRAL_ENDIAN
)

1117 
	#LZO_INFO_ABI_ENDIAN
 "ÃuŒ®"

	)

1119 #ià(
LZO_SIZEOF_INT
 =ğ1 && 
LZO_SIZEOF_LONG
 =ğ2 && 
LZO_SIZEOF_VOID_P
 == 2)

1120 
	#LZO_ABI_I8LP16
 1

	)

1121 
	#LZO_INFO_ABI_PM
 "i8Í16"

	)

1122 #–ià(
LZO_SIZEOF_INT
 =ğ2 && 
LZO_SIZEOF_LONG
 =ğ2 && 
LZO_SIZEOF_VOID_P
 == 2)

1123 
	#LZO_ABI_ILP16
 1

	)

1124 
	#LZO_INFO_ABI_PM
 "p16"

	)

1125 #–ià(
LZO_SIZEOF_INT
 =ğ4 && 
LZO_SIZEOF_LONG
 =ğ4 && 
LZO_SIZEOF_VOID_P
 == 4)

1126 
	#LZO_ABI_ILP32
 1

	)

1127 
	#LZO_INFO_ABI_PM
 "p32"

	)

1128 #–ià(
LZO_SIZEOF_INT
 =ğ4 && 
LZO_SIZEOF_LONG
 =ğ4 && 
LZO_SIZEOF_VOID_P
 =ğ8 && 
LZO_SIZEOF_SIZE_T
 == 8)

1129 
	#LZO_ABI_LLP64
 1

	)

1130 
	#LZO_INFO_ABI_PM
 "Îp64"

	)

1131 #–ià(
LZO_SIZEOF_INT
 =ğ4 && 
LZO_SIZEOF_LONG
 =ğ8 && 
LZO_SIZEOF_VOID_P
 == 8)

1132 
	#LZO_ABI_LP64
 1

	)

1133 
	#LZO_INFO_ABI_PM
 "Í64"

	)

1134 #–ià(
LZO_SIZEOF_INT
 =ğ8 && 
LZO_SIZEOF_LONG
 =ğ8 && 
LZO_SIZEOF_VOID_P
 == 8)

1135 
	#LZO_ABI_ILP64
 1

	)

1136 
	#LZO_INFO_ABI_PM
 "p64"

	)

1137 #–ià(
LZO_SIZEOF_INT
 =ğ4 && 
LZO_SIZEOF_LONG
 =ğ8 && 
LZO_SIZEOF_VOID_P
 == 4)

1138 
	#LZO_ABI_IP32L64
 1

	)

1139 
	#LZO_INFO_ABI_PM
 "32l64"

	)

1141 #ià!
defšed
(
__LZO_LIBC_OVERRIDE
)

1142 #ià
defšed
(
LZO_LIBC_NAKED
)

1143 
	#LZO_INFO_LIBC
 "Çked"

	)

1144 #–ià
defšed
(
LZO_LIBC_FREESTANDING
)

1145 
	#LZO_INFO_LIBC
 "ä“¡ªdšg"

	)

1146 #–ià
defšed
(
LZO_LIBC_MOSTLY_FREESTANDING
)

1147 
	#LZO_INFO_LIBC
 "mä“¡ªdšg"

	)

1148 #–ià
defšed
(
LZO_LIBC_ISOC90
)

1149 
	#LZO_INFO_LIBC
 "isoc90"

	)

1150 #–ià
defšed
(
LZO_LIBC_ISOC99
)

1151 
	#LZO_INFO_LIBC
 "isoc99"

	)

1152 #–ià
defšed
(
__d›ibc__
)

1153 
	#LZO_LIBC_DIETLIBC
 1

	)

1154 
	#LZO_INFO_LIBC
 "d›ibc"

	)

1155 #–ià
defšed
(
_NEWLIB_VERSION
)

1156 
	#LZO_LIBC_NEWLIB
 1

	)

1157 
	#LZO_INFO_LIBC
 "Ãwlib"

	)

1158 #–ià
defšed
(
__UCLIBC__
è&& defšed(
__UCLIBC_MAJOR__
è&& defšed(
__UCLIBC_MINOR__
)

1159 #ià
defšed
(
__UCLIBC_SUBLEVEL__
)

1160 
	#LZO_LIBC_UCLIBC
 (
__UCLIBC_MAJOR__
 * 0x10000L + 
__UCLIBC_MINOR__
 * 0x100 + 
__UCLIBC_SUBLEVEL__
)

	)

1162 
	#LZO_LIBC_UCLIBC
 0x00090bL

	)

1164 
	#LZO_INFO_LIBC
 "uşibc"

	)

1165 #–ià
defšed
(
__GLIBC__
è&& defšed(
__GLIBC_MINOR__
)

1166 
	#LZO_LIBC_GLIBC
 (
__GLIBC__
 * 0x10000L + 
__GLIBC_MINOR__
 * 0x100)

	)

1167 
	#LZO_INFO_LIBC
 "glibc"

	)

1168 #–ià(
LZO_CC_MWERKS
è&& 
defšed
(
__MSL__
)

1169 
	#LZO_LIBC_MSL
 
__MSL__


	)

1170 
	#LZO_INFO_LIBC
 "m¦"

	)

1172 
	#LZO_LIBC_DEFAULT
 1

	)

1173 
	#LZO_INFO_LIBC
 "deçuÉ"

	)

1176 #ià(
LZO_CC_GNUC
 >= 0x020800ul)

1177 
	#__lzo_gnuc_ex‹nsiÚ__
 
__ex‹nsiÚ__


	)

1178 #–ià(
LZO_CC_LLVM
 || 
LZO_CC_PATHSCALE
)

1179 
	#__lzo_gnuc_ex‹nsiÚ__
 
__ex‹nsiÚ__


	)

1181 
	#__lzo_gnuc_ex‹nsiÚ__


	)

1183 #ià(
LZO_CC_CILLY
 || 
LZO_CC_GNUC
 || 
LZO_CC_LLVM
 || 
LZO_CC_PATHSCALE
 || 
LZO_CC_PGI
)

1184 
	#lzo_®ignof
(
e
è
	`__®ignof__
Ó)

	)

1185 #–ià(
LZO_CC_INTELC
 && (
__INTEL_COMPILER
 >= 700))

1186 
	#lzo_®ignof
(
e
è
	`__®ignof__
Ó)

	)

1187 #–ià(
LZO_CC_MSC
 && (
_MSC_VER
 >= 1300))

1188 
	#lzo_®ignof
(
e
è
	`__®ignof
Ó)

	)

1190 #ià(
LZO_CC_TURBOC
 && (
__TURBOC__
 <= 0x0295))

1191 #–ià
defšed
(
__ılu¥lus
)

1192 
	#__lzo_šlše
 
šlše


	)

1193 #–ià(
LZO_CC_BORLANDC
 && (
__BORLANDC__
 >= 0x0550))

1194 
	#__lzo_šlše
 
__šlše


	)

1195 #–ià(
LZO_CC_CILLY
 || 
LZO_CC_GNUC
 || 
LZO_CC_LLVM
 || 
LZO_CC_PATHSCALE
 || 
LZO_CC_PGI
)

1196 
	#__lzo_šlše
 
__šlše__


	)

1197 #–ià(
LZO_CC_DMC
)

1198 
	#__lzo_šlše
 
__šlše


	)

1199 #–ià(
LZO_CC_INTELC
)

1200 
	#__lzo_šlše
 
__šlše


	)

1201 #–ià(
LZO_CC_MWERKS
 && (
__MWERKS__
 >= 0x2405))

1202 
	#__lzo_šlše
 
__šlše


	)

1203 #–ià(
LZO_CC_MSC
 && (
_MSC_VER
 >= 900))

1204 
	#__lzo_šlše
 
__šlše


	)

1205 #–ià
defšed
(
__STDC_VERSION__
) && (__STDC_VERSION__ >= 199901L)

1206 
	#__lzo_šlše
 
šlše


	)

1208 #ià(
LZO_CC_GNUC
 >= 0x030200ul)

1209 
	#__lzo_fÜûšlše
 
__šlše__
 
	`__©Œibu‹__
((
__®ways_šlše__
))

	)

1210 #–ià(
LZO_CC_INTELC
 && (
__INTEL_COMPILER
 >ğ450è&& (
LZO_OS_WIN32
 || 
LZO_OS_WIN64
))

1211 
	#__lzo_fÜûšlše
 
__fÜûšlše


	)

1212 #–ià(
LZO_CC_INTELC
 && (
__INTEL_COMPILER
 >= 800))

1213 
	#__lzo_fÜûšlše
 
__šlše__
 
	`__©Œibu‹__
((
__®ways_šlše__
))

	)

1214 #–ià(
LZO_CC_LLVM
 || 
LZO_CC_PATHSCALE
)

1215 
	#__lzo_fÜûšlše
 
__šlše__
 
	`__©Œibu‹__
((
__®ways_šlše__
))

	)

1216 #–ià(
LZO_CC_MSC
 && (
_MSC_VER
 >= 1200))

1217 
	#__lzo_fÜûšlše
 
__fÜûšlše


	)

1219 #ià(
LZO_CC_GNUC
 >= 0x030200ul)

1220 
	#__lzo_nošlše
 
	`__©Œibu‹__
((
__nošlše__
))

	)

1221 #–ià(
LZO_CC_INTELC
 && (
__INTEL_COMPILER
 >ğ600è&& (
LZO_OS_WIN32
 || 
LZO_OS_WIN64
))

1222 
	#__lzo_nošlše
 
	`__deş¥ec
(
nošlše
)

	)

1223 #–ià(
LZO_CC_INTELC
 && (
__INTEL_COMPILER
 >= 800))

1224 
	#__lzo_nošlše
 
	`__©Œibu‹__
((
__nošlše__
))

	)

1225 #–ià(
LZO_CC_LLVM
 || 
LZO_CC_PATHSCALE
)

1226 
	#__lzo_nošlše
 
	`__©Œibu‹__
((
__nošlše__
))

	)

1227 #–ià(
LZO_CC_MSC
 && (
_MSC_VER
 >= 1300))

1228 
	#__lzo_nošlše
 
	`__deş¥ec
(
nošlše
)

	)

1229 #–ià(
LZO_CC_MWERKS
 && (
__MWERKS__
 >ğ0x3200è&& (
LZO_OS_WIN32
 || 
LZO_OS_WIN64
))

1230 #ià
defšed
(
__ılu¥lus
)

1232 
	#__lzo_nošlše
 
	`__deş¥ec
(
nošlše
)

	)

1235 #ià(
defšed
(
__lzo_fÜûšlše
è|| defšed(
__lzo_nošlše
)è&& !defšed(
__lzo_šlše
)

1238 #ià(
LZO_CC_GNUC
 >= 0x020700ul)

1239 
	#__lzo_nÜ‘uº
 
	`__©Œibu‹__
((
__nÜ‘uº__
))

	)

1240 #–ià(
LZO_CC_INTELC
 && (
__INTEL_COMPILER
 >ğ450è&& (
LZO_OS_WIN32
 || 
LZO_OS_WIN64
))

1241 
	#__lzo_nÜ‘uº
 
	`__deş¥ec
(
nÜ‘uº
)

	)

1242 #–ià(
LZO_CC_INTELC
 && (
__INTEL_COMPILER
 >ğ600è&& (
LZO_OS_POSIX
))

1243 
	#__lzo_nÜ‘uº
 
	`__©Œibu‹__
((
__nÜ‘uº__
))

	)

1244 #–ià(
LZO_CC_LLVM
 || 
LZO_CC_PATHSCALE
)

1245 
	#__lzo_nÜ‘uº
 
	`__©Œibu‹__
((
__nÜ‘uº__
))

	)

1246 #–ià(
LZO_CC_MSC
 && (
_MSC_VER
 >= 1200))

1247 
	#__lzo_nÜ‘uº
 
	`__deş¥ec
(
nÜ‘uº
)

	)

1249 #ià(
LZO_CC_GNUC
 >= 0x030400ul)

1250 
	#__lzo_cÚ¡ruùÜ
 
	`__©Œibu‹__
((
__cÚ¡ruùÜ__
,
__u£d__
))

	)

1251 #–ià(
LZO_CC_GNUC
 >= 0x020700ul)

1252 
	#__lzo_cÚ¡ruùÜ
 
	`__©Œibu‹__
((
__cÚ¡ruùÜ__
))

	)

1253 #–ià(
LZO_CC_LLVM
 || 
LZO_CC_PATHSCALE
)

1254 
	#__lzo_cÚ¡ruùÜ
 
	`__©Œibu‹__
((
__cÚ¡ruùÜ__
))

	)

1256 #ià(
LZO_CC_GNUC
 >= 0x030400ul)

1257 
	#__lzo_de¡ruùÜ
 
	`__©Œibu‹__
((
__de¡ruùÜ__
,
__u£d__
))

	)

1258 #–ià(
LZO_CC_GNUC
 >= 0x020700ul)

1259 
	#__lzo_de¡ruùÜ
 
	`__©Œibu‹__
((
__de¡ruùÜ__
))

	)

1260 #–ià(
LZO_CC_LLVM
 || 
LZO_CC_PATHSCALE
)

1261 
	#__lzo_de¡ruùÜ
 
	`__©Œibu‹__
((
__de¡ruùÜ__
))

	)

1263 #ià
defšed
(
__lzo_de¡ruùÜ
è&& !defšed(
__lzo_cÚ¡ruùÜ
)

1266 #ià(
LZO_CC_GNUC
 >= 0x030200ul)

1267 
	#__lzo_lik–y
(
e
è(
	`__butš_ex³ù
(!!Ó),1))

	)

1268 
	#__lzo_uÆik–y
(
e
è(
	`__butš_ex³ù
(!!Ó),0))

	)

1269 #–ià(
LZO_CC_INTELC
 && (
__INTEL_COMPILER
 >= 800))

1270 
	#__lzo_lik–y
(
e
è(
	`__butš_ex³ù
(!!Ó),1))

	)

1271 
	#__lzo_uÆik–y
(
e
è(
	`__butš_ex³ù
(!!Ó),0))

	)

1272 #–ià(
LZO_CC_LLVM
 || 
LZO_CC_PATHSCALE
)

1273 
	#__lzo_lik–y
(
e
è(
	`__butš_ex³ù
(!!Ó),1))

	)

1274 
	#__lzo_uÆik–y
(
e
è(
	`__butš_ex³ù
(!!Ó),0))

	)

1276 
	#__lzo_lik–y
(
e
èÓ)

	)

1277 
	#__lzo_uÆik–y
(
e
èÓ)

	)

1279 #ià!
defšed
(
LZO_UNUSED
)

1280 #ià(
LZO_CC_BORLANDC
 && (
__BORLANDC__
 >= 0x0600))

1281 
	#LZO_UNUSED
(
v¬
è((è&v¬)

	)

1282 #–ià(
LZO_CC_BORLANDC
 || 
LZO_CC_HIGHC
 || 
LZO_CC_NDPC
 || 
LZO_CC_PELLESC
 || 
LZO_CC_TURBOC
)

1283 
	#LZO_UNUSED
(
v¬
èià(&v¬è; 

	)

1284 #–ià(
LZO_CC_GNUC
 || 
LZO_CC_LLVM
 || 
LZO_CC_PATHSCALE
)

1285 
	#LZO_UNUSED
(
v¬
è((èv¬)

	)

1286 #–ià(
LZO_CC_MSC
 && (
_MSC_VER
 < 900))

1287 
	#LZO_UNUSED
(
v¬
èià(&v¬è; 

	)

1288 #–ià(
LZO_CC_KEILC
)

1289 
	#LZO_UNUSED
(
v¬
è{
__lzo_unu£d
[1-2*!((v¬)>0)];}

	)

1290 #–ià(
LZO_CC_PACIFICC
)

1291 
	#LZO_UNUSED
(
v¬
è((è(v¬))

	)

1292 #–ià(
LZO_CC_WATCOMC
è&& 
defšed
(
__ılu¥lus
)

1293 
	#LZO_UNUSED
(
v¬
è((èv¬)

	)

1295 
	#LZO_UNUSED
(
v¬
è((è&v¬)

	)

1298 #ià!
defšed
(
LZO_UNUSED_FUNC
)

1299 #ià(
LZO_CC_BORLANDC
 && (
__BORLANDC__
 >= 0x0600))

1300 
	#LZO_UNUSED_FUNC
(
func
è((èfunc)

	)

1301 #–ià(
LZO_CC_BORLANDC
 || 
LZO_CC_NDPC
 || 
LZO_CC_TURBOC
)

1302 
	#LZO_UNUSED_FUNC
(
func
èià(funcè; 

	)

1303 #–ià(
LZO_CC_LLVM
)

1304 
	#LZO_UNUSED_FUNC
(
func
è((è&func)

	)

1305 #–ià(
LZO_CC_MSC
 && (
_MSC_VER
 < 900))

1306 
	#LZO_UNUSED_FUNC
(
func
èià(funcè; 

	)

1307 #–ià(
LZO_CC_MSC
)

1308 
	#LZO_UNUSED_FUNC
(
func
è((è&func)

	)

1309 #–ià(
LZO_CC_KEILC
 || 
LZO_CC_PELLESC
)

1310 
	#LZO_UNUSED_FUNC
(
func
è{
__lzo_unu£d
[1-2*!((()func)>0)];}

	)

1312 
	#LZO_UNUSED_FUNC
(
func
è((èfunc)

	)

1315 #ià!
defšed
(
LZO_UNUSED_LABEL
)

1316 #ià(
LZO_CC_WATCOMC
è&& 
defšed
(
__ılu¥lus
)

1317 
	#LZO_UNUSED_LABEL
(
l
è0è1:
	)
l

1318 #–ià(
LZO_CC_INTELC
 || 
LZO_CC_WATCOMC
)

1319 
	#LZO_UNUSED_LABEL
(
l
èià(0è
	)
l

1321 
	#LZO_UNUSED_LABEL
(
l
è0è1:
	)
l

1324 #ià!
defšed
(
LZO_COMPILE_TIME_ASSERT_HEADER
)

1325 #ià(
LZO_CC_AZTECC
 || 
LZO_CC_ZORTECHC
)

1326 
	#LZO_COMPILE_TIME_ASSERT_HEADER
(
e
è
__lzo_ùa
[1-!Ó)];

	)

1327 #–ià(
LZO_CC_DMC
 || 
LZO_CC_SYMANTECC
)

1328 
	#LZO_COMPILE_TIME_ASSERT_HEADER
(
e
è
__lzo_ùa
[1u-2*!Ó)];

	)

1329 #–ià(
LZO_CC_TURBOC
 && (
__TURBOC__
 == 0x0295))

1330 
	#LZO_COMPILE_TIME_ASSERT_HEADER
(
e
è
__lzo_ùa
[1-!Ó)];

	)

1332 
	#LZO_COMPILE_TIME_ASSERT_HEADER
(
e
è
__lzo_ùa
[1-2*!Ó)];

	)

1335 #ià!
defšed
(
LZO_COMPILE_TIME_ASSERT
)

1336 #ià(
LZO_CC_AZTECC
)

1337 
	#LZO_COMPILE_TIME_ASSERT
(
e
è{
	t__lzo_ùa_t
[1-!Ó)];}

	)

1338 #–ià(
LZO_CC_DMC
 || 
LZO_CC_PACIFICC
 || 
LZO_CC_SYMANTECC
 || 
LZO_CC_ZORTECHC
)

1339 
	#LZO_COMPILE_TIME_ASSERT
(
e
è0è1:!Ó):;

	)

1340 #–ià(
LZO_CC_MSC
 && (
_MSC_VER
 < 900))

1341 
	#LZO_COMPILE_TIME_ASSERT
(
e
è0è1:!Ó):;

	)

1342 #–ià(
LZO_CC_TURBOC
 && (
__TURBOC__
 == 0x0295))

1343 
	#LZO_COMPILE_TIME_ASSERT
(
e
è0è1:!Ó):;

	)

1345 
	#LZO_COMPILE_TIME_ASSERT
(
e
è{
	t__lzo_ùa_t
[1-2*!Ó)];}

	)

1348 #ià(
LZO_ARCH_I086
 || 
LZO_ARCH_I386
è&& (
LZO_OS_DOS16
 || 
LZO_OS_DOS32
 || 
LZO_OS_OS2
 || 
LZO_OS_OS216
 || 
LZO_OS_WIN16
 || 
LZO_OS_WIN32
 || 
LZO_OS_WIN64
)

1349 #ià(
LZO_CC_GNUC
 || 
LZO_CC_HIGHC
 || 
LZO_CC_NDPC
 || 
LZO_CC_PACIFICC
)

1350 #–ià(
LZO_CC_DMC
 || 
LZO_CC_SYMANTECC
 || 
LZO_CC_ZORTECHC
)

1351 
	#__lzo_cdeş
 
__cdeş


	)

1352 
	#__lzo_cdeş_©ex™


	)

1353 
	#__lzo_cdeş_maš
 
__cdeş


	)

1354 #ià(
LZO_OS_OS2
 && (
LZO_CC_DMC
 || 
LZO_CC_SYMANTECC
))

1355 
	#__lzo_cdeş_qsÜt
 
__·sÿl


	)

1356 #–ià(
LZO_OS_OS2
 && (
LZO_CC_ZORTECHC
))

1357 
	#__lzo_cdeş_qsÜt
 
_¡dÿÎ


	)

1359 
	#__lzo_cdeş_qsÜt
 
__cdeş


	)

1361 #–ià(
LZO_CC_WATCOMC
)

1362 
	#__lzo_cdeş
 
__cdeş


	)

1364 
	#__lzo_cdeş
 
__cdeş


	)

1365 
	#__lzo_cdeş_©ex™
 
__cdeş


	)

1366 
	#__lzo_cdeş_maš
 
__cdeş


	)

1367 
	#__lzo_cdeş_qsÜt
 
__cdeş


	)

1369 #ià(
LZO_CC_GNUC
 || 
LZO_CC_HIGHC
 || 
LZO_CC_NDPC
 || 
LZO_CC_PACIFICC
 || 
LZO_CC_WATCOMC
)

1370 #–ià(
LZO_OS_OS2
 && (
LZO_CC_DMC
 || 
LZO_CC_SYMANTECC
))

1371 
	#__lzo_cdeş_sighªdËr
 
__·sÿl


	)

1372 #–ià(
LZO_OS_OS2
 && (
LZO_CC_ZORTECHC
))

1373 
	#__lzo_cdeş_sighªdËr
 
_¡dÿÎ


	)

1374 #–ià(
LZO_CC_MSC
 && (
_MSC_VER
 >ğ1400)è&& 
defšed
(
_M_CEE_PURE
)

1375 
	#__lzo_cdeş_sighªdËr
 
__şrÿÎ


	)

1376 #–ià(
LZO_CC_MSC
 && (
_MSC_VER
 >= 600 && _MSC_VER < 700))

1377 #ià
defšed
(
_DLL
)

1378 
	#__lzo_cdeş_sighªdËr
 
_çr
 
_cdeş
 
_lßdds


	)

1379 #–ià
defšed
(
_MT
)

1380 
	#__lzo_cdeş_sighªdËr
 
_çr
 
_cdeş


	)

1382 
	#__lzo_cdeş_sighªdËr
 
_cdeş


	)

1385 
	#__lzo_cdeş_sighªdËr
 
__cdeş


	)

1387 #–ià(
LZO_ARCH_M68K
 && 
LZO_OS_TOS
 && (
LZO_CC_PUREC
 || 
LZO_CC_TURBOC
))

1388 
	#__lzo_cdeş
 
cdeş


	)

1390 #ià!
defšed
(
__lzo_cdeş
)

1391 
	#__lzo_cdeş


	)

1393 #ià!
defšed
(
__lzo_cdeş_©ex™
)

1394 
	#__lzo_cdeş_©ex™


	)

1396 #ià!
defšed
(
__lzo_cdeş_maš
)

1397 
	#__lzo_cdeş_maš


	)

1399 #ià!
defšed
(
__lzo_cdeş_qsÜt
)

1400 
	#__lzo_cdeş_qsÜt


	)

1402 #ià!
defšed
(
__lzo_cdeş_sighªdËr
)

1403 
	#__lzo_cdeş_sighªdËr


	)

1405 #ià!
defšed
(
__lzo_cdeş_va
)

1406 
	#__lzo_cdeş_va
 
__lzo_cdeş


	)

1408 #ià(
LZO_OS_CYGWIN
 || (
LZO_OS_EMX
 && 
defšed
(
__RSXNT__
)è|| 
LZO_OS_WIN32
 || 
LZO_OS_WIN64
)

1409 #ià(
LZO_CC_WATCOMC
 && (
__WATCOMC__
 < 1000))

1410 #–ià(
LZO_OS_WIN32
 && 
LZO_CC_GNUC
è&& 
defšed
(
__PW32__
)

1411 #–ià((
LZO_OS_CYGWIN
 || 
defšed
(
__MINGW32__
)è&& (
LZO_CC_GNUC
 && (LZO_CC_GNUC < 0x025f00ul)))

1413 
	#LZO_HAVE_WINDOWS_H
 1

	)

1416 #ià(
LZO_ARCH_ALPHA
)

1417 
	#LZO_OPT_AVOID_UINT_INDEX
 1

	)

1418 
	#LZO_OPT_AVOID_SHORT
 1

	)

1419 
	#LZO_OPT_AVOID_USHORT
 1

	)

1420 #–ià(
LZO_ARCH_AMD64
)

1421 
	#LZO_OPT_AVOID_INT_INDEX
 1

	)

1422 
	#LZO_OPT_AVOID_UINT_INDEX
 1

	)

1423 
	#LZO_OPT_UNALIGNED16
 1

	)

1424 
	#LZO_OPT_UNALIGNED32
 1

	)

1425 
	#LZO_OPT_UNALIGNED64
 1

	)

1426 #–ià(
LZO_ARCH_ARM
 && 
LZO_ARCH_ARM_THUMB
)

1427 #–ià(
LZO_ARCH_ARM
)

1428 
	#LZO_OPT_AVOID_SHORT
 1

	)

1429 
	#LZO_OPT_AVOID_USHORT
 1

	)

1430 #–ià(
LZO_ARCH_CRIS
)

1431 
	#LZO_OPT_UNALIGNED16
 1

	)

1432 
	#LZO_OPT_UNALIGNED32
 1

	)

1433 #–ià(
LZO_ARCH_I386
)

1434 
	#LZO_OPT_UNALIGNED16
 1

	)

1435 
	#LZO_OPT_UNALIGNED32
 1

	)

1436 #–ià(
LZO_ARCH_IA64
)

1437 
	#LZO_OPT_AVOID_INT_INDEX
 1

	)

1438 
	#LZO_OPT_AVOID_UINT_INDEX
 1

	)

1439 
	#LZO_OPT_PREFER_POSTINC
 1

	)

1440 #–ià(
LZO_ARCH_M68K
)

1441 
	#LZO_OPT_PREFER_POSTINC
 1

	)

1442 
	#LZO_OPT_PREFER_PREDEC
 1

	)

1443 #ià
defšed
(
__mc68020__
è&& !defšed(
__mcŞdfœe__
)

1444 
	#LZO_OPT_UNALIGNED16
 1

	)

1445 
	#LZO_OPT_UNALIGNED32
 1

	)

1447 #–ià(
LZO_ARCH_MIPS
)

1448 
	#LZO_OPT_AVOID_UINT_INDEX
 1

	)

1449 #–ià(
LZO_ARCH_POWERPC
)

1450 
	#LZO_OPT_PREFER_PREINC
 1

	)

1451 
	#LZO_OPT_PREFER_PREDEC
 1

	)

1452 #ià
defšed
(
LZO_ABI_BIG_ENDIAN
)

1453 
	#LZO_OPT_UNALIGNED16
 1

	)

1454 
	#LZO_OPT_UNALIGNED32
 1

	)

1456 #–ià(
LZO_ARCH_S390
)

1457 
	#LZO_OPT_UNALIGNED16
 1

	)

1458 
	#LZO_OPT_UNALIGNED32
 1

	)

1459 #ià(
LZO_SIZEOF_SIZE_T
 == 8)

1460 
	#LZO_OPT_UNALIGNED64
 1

	)

1462 #–ià(
LZO_ARCH_SH
)

1463 
	#LZO_OPT_PREFER_POSTINC
 1

	)

1464 
	#LZO_OPT_PREFER_PREDEC
 1

	)

1466 #ià!
defšed
(
LZO_CFG_NO_INLINE_ASM
)

1467 #ià
defšed
(
LZO_CC_LLVM
)

1468 
	#LZO_CFG_NO_INLINE_ASM
 1

	)

1471 #ià!
defšed
(
LZO_CFG_NO_UNALIGNED
)

1472 #ià
defšed
(
LZO_ABI_NEUTRAL_ENDIAN
è|| defšed(
LZO_ARCH_GENERIC
)

1473 
	#LZO_CFG_NO_UNALIGNED
 1

	)

1476 #ià
defšed
(
LZO_CFG_NO_UNALIGNED
)

1477 #undeà
LZO_OPT_UNALIGNED16


1478 #undeà
LZO_OPT_UNALIGNED32


1479 #undeà
LZO_OPT_UNALIGNED64


1481 #ià
defšed
(
LZO_CFG_NO_INLINE_ASM
)

1482 #–ià(
LZO_ARCH_I386
 && (
LZO_OS_DOS32
 || 
LZO_OS_WIN32
è&& (
LZO_CC_DMC
 || 
LZO_CC_INTELC
 || 
LZO_CC_MSC
 || 
LZO_CC_PELLESC
))

1483 
	#LZO_ASM_SYNTAX_MSC
 1

	)

1484 #–ià(
LZO_OS_WIN64
 && (
LZO_CC_DMC
 || 
LZO_CC_INTELC
 || 
LZO_CC_MSC
 || 
LZO_CC_PELLESC
))

1485 #–ià(
LZO_ARCH_I386
 && (
LZO_CC_GNUC
 || 
LZO_CC_INTELC
 || 
LZO_CC_PATHSCALE
))

1486 
	#LZO_ASM_SYNTAX_GNUC
 1

	)

1487 #–ià(
LZO_ARCH_AMD64
 && (
LZO_CC_GNUC
 || 
LZO_CC_INTELC
 || 
LZO_CC_PATHSCALE
))

1488 
	#LZO_ASM_SYNTAX_GNUC
 1

	)

1490 #ià(
LZO_ASM_SYNTAX_GNUC
)

1491 #ià(
LZO_ARCH_I386
 && 
LZO_CC_GNUC
 && (LZO_CC_GNUC < 0x020000ul))

1492 
	#__LZO_ASM_CLOBBER
 "ax"

	)

1493 #–ià(
LZO_CC_INTELC
)

1494 
	#__LZO_ASM_CLOBBER
 "memÜy"

	)

1496 
	#__LZO_ASM_CLOBBER
 "cc", "memÜy"

	)

1499 #ià
defšed
(
__LZO_INFOSTR_MM
)

1500 #–ià(
LZO_MM_FLAT
è&& (
defšed
(
__LZO_INFOSTR_PM
è|| defšed(
LZO_INFO_ABI_PM
))

1501 
	#__LZO_INFOSTR_MM
 ""

	)

1502 #–ià
defšed
(
LZO_INFO_MM
)

1503 
	#__LZO_INFOSTR_MM
 "." 
LZO_INFO_MM


	)

1505 
	#__LZO_INFOSTR_MM
 ""

	)

1507 #ià
defšed
(
__LZO_INFOSTR_PM
)

1508 #–ià
defšed
(
LZO_INFO_ABI_PM
)

1509 
	#__LZO_INFOSTR_PM
 "." 
LZO_INFO_ABI_PM


	)

1511 
	#__LZO_INFOSTR_PM
 ""

	)

1513 #ià
defšed
(
__LZO_INFOSTR_ENDIAN
)

1514 #–ià
defšed
(
LZO_INFO_ABI_ENDIAN
)

1515 
	#__LZO_INFOSTR_ENDIAN
 "." 
LZO_INFO_ABI_ENDIAN


	)

1517 
	#__LZO_INFOSTR_ENDIAN
 ""

	)

1519 #ià
defšed
(
__LZO_INFOSTR_OSNAME
)

1520 #–ià
defšed
(
LZO_INFO_OS_CONSOLE
)

1521 
	#__LZO_INFOSTR_OSNAME
 
LZO_INFO_OS
 "." 
LZO_INFO_OS_CONSOLE


	)

1522 #–ià
defšed
(
LZO_INFO_OS_POSIX
)

1523 
	#__LZO_INFOSTR_OSNAME
 
LZO_INFO_OS
 "." 
LZO_INFO_OS_POSIX


	)

1525 
	#__LZO_INFOSTR_OSNAME
 
LZO_INFO_OS


	)

1527 #ià
defšed
(
__LZO_INFOSTR_LIBC
)

1528 #–ià
defšed
(
LZO_INFO_LIBC
)

1529 
	#__LZO_INFOSTR_LIBC
 "." 
LZO_INFO_LIBC


	)

1531 
	#__LZO_INFOSTR_LIBC
 ""

	)

1533 #ià
defšed
(
__LZO_INFOSTR_CCVER
)

1534 #–ià
defšed
(
LZO_INFO_CCVER
)

1535 
	#__LZO_INFOSTR_CCVER
 " " 
LZO_INFO_CCVER


	)

1537 
	#__LZO_INFOSTR_CCVER
 ""

	)

1539 
	#LZO_INFO_STRING
 \

1540 
LZO_INFO_ARCH
 
__LZO_INFOSTR_MM
 
__LZO_INFOSTR_PM
 
__LZO_INFOSTR_ENDIAN
 \

1541 " " 
__LZO_INFOSTR_OSNAME
 
__LZO_INFOSTR_LIBC
 " " 
LZO_INFO_CC
 
__LZO_INFOSTR_CCVER


	)

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/lzo/minilzo.c

42 
	#__LZO_IN_MINILZO


	)

43 
	#LZO_BUILD


	)

45 #ià
defšed
(
LZO_CFG_FREESTANDING
)

46 #undeà
MINILZO_HAVE_CONFIG_H


47 
	#LZO_LIBC_FREESTANDING
 1

	)

48 
	#LZO_OS_FREESTANDING
 1

	)

51 #ifdeà
MINILZO_HAVE_CONFIG_H


52 
	~<cÚfig.h
>

54 
	~<lim™s.h
>

55 
	~<¡ddef.h
>

56 #ià
defšed
(
MINILZO_CFG_USE_INTERNAL_LZODEFS
)

58 #iâdeà
__LZODEFS_H_INCLUDED


59 
	#__LZODEFS_H_INCLUDED
 1

	)

61 #ià
defšed
(
__CYGWIN32__
è&& !defšed(
__CYGWIN__
)

62 
	#__CYGWIN__
 
__CYGWIN32__


	)

64 #ià
defšed
(
__IBMCPP__
è&& !defšed(
__IBMC__
)

65 
	#__IBMC__
 
__IBMCPP__


	)

67 #ià
defšed
(
__ICL
è&& defšed(
_WIN32
è&& !defšed(
__INTEL_COMPILER
)

68 
	#__INTEL_COMPILER
 
__ICL


	)

70 #ià1 && 
defšed
(
__INTERIX
è&& defšed(
__GNUC__
è&& !defšed(
_ALL_SOURCE
)

71 
	#_ALL_SOURCE
 1

	)

73 #ià
defšed
(
__ms__
è&& defšed(
__R5900__
)

74 #ià!
defšed
(
__LONG_MAX__
)

75 
	#__LONG_MAX__
 9223372036854775807L

	)

78 #ià
defšed
(
__INTEL_COMPILER
è&& defšed(
__lšux__
)

79 #´agm¨
w¬nšg
(
di§bË
: 193)

81 #ià
defšed
(
__KEIL__
è&& defšed(
__C166__
)

82 #´agm¨
w¬nšg
 
di§bË
 = 322

83 #–ià0 && 
defšed
(
__C251__
)

84 #´agm¨
w¬nšg
 
di§bË
 = 322

86 #ià
defšed
(
_MSC_VER
è&& !defšed(
__INTEL_COMPILER
è&& !defšed(
__MWERKS__
)

87 #ià(
_MSC_VER
 >= 1300)

88 #´agm¨
w¬nšg
(
di§bË
: 4668)

91 #ià0 && 
defšed
(
__WATCOMC__
)

92 #ià(
__WATCOMC__
 >= 1050) && (__WATCOMC__ < 1060)

93 #´agm¨
w¬nšg
 203 9

96 #ià
defšed
(
__BORLANDC__
è&& defšed(
__MSDOS__
è&& !defšed(
__FLAT__
)

97 #´agm¨
İtiÚ
 -
h


100 
	#LZO_0xffffL
 0xfffful

	)

101 
	#LZO_0xffffffffL
 0xfffffffful

	)

103 
	#LZO_0xffffL
 65535ul

	)

104 
	#LZO_0xffffffffL
 4294967295ul

	)

106 #ià(
LZO_0xffffL
 =ğ
LZO_0xffffffffL
)

120 #ià(
UINT_MAX
 =ğ
LZO_0xffffL
)

121 #ià
defšed
(
__ZTC__
è&& defšed(
__I86__
è&& !defšed(
__OS2__
)

122 #ià!
defšed
(
MSDOS
)

123 
	#MSDOS
 1

	)

125 #ià!
defšed
(
_MSDOS
)

126 
	#_MSDOS
 1

	)

128 #–ià0 && 
defšed
(
__VERSION
è&& defšed(
MB_LEN_MAX
)

129 #ià(
__VERSION
 =ğ520è&& (
MB_LEN_MAX
 == 1)

130 #ià!
defšed
(
__AZTEC_C__
)

131 
	#__AZTEC_C__
 
__VERSION


	)

133 #ià!
defšed
(
__DOS__
)

134 
	#__DOS__
 1

	)

139 #ià
defšed
(
_MSC_VER
è&& defšed(
M_I86HM
è&& (
UINT_MAX
 =ğ
LZO_0xffffL
)

140 
	#±rdiff_t
 

	)

141 
	#_PTRDIFF_T_DEFINED


	)

143 #ià(
UINT_MAX
 =ğ
LZO_0xffffL
)

144 #undeà
__LZO_RENAME_A


145 #undeà
__LZO_RENAME_B


146 #ià
defšed
(
__AZTEC_C__
è&& defšed(
__DOS__
)

147 
	#__LZO_RENAME_A
 1

	)

148 #–ià
defšed
(
_MSC_VER
è&& defšed(
MSDOS
)

149 #ià(
_MSC_VER
 < 600)

150 
	#__LZO_RENAME_A
 1

	)

151 #–ià(
_MSC_VER
 < 700)

152 
	#__LZO_RENAME_B
 1

	)

154 #–ià
defšed
(
__TSC__
è&& defšed(
__OS2__
)

155 
	#__LZO_RENAME_A
 1

	)

156 #–ià
defšed
(
__MSDOS__
è&& defšed(
__TURBOC__
) && (__TURBOC__ < 0x0410)

157 
	#__LZO_RENAME_A
 1

	)

158 #–ià
defšed
(
__PACIFIC__
è&& defšed(
DOS
)

159 #ià!
defšed
(
__çr
)

160 
	#__çr
 
çr


	)

162 #ià!
defšed
(
__Ã¬
)

163 
	#__Ã¬
 
Ã¬


	)

166 #ià
defšed
(
__LZO_RENAME_A
)

167 #ià!
defšed
(
__cdeş
)

168 
	#__cdeş
 
cdeş


	)

170 #ià!
defšed
(
__çr
)

171 
	#__çr
 
çr


	)

173 #ià!
defšed
(
__huge
)

174 
	#__huge
 
huge


	)

176 #ià!
defšed
(
__Ã¬
)

177 
	#__Ã¬
 
Ã¬


	)

179 #ià!
defšed
(
__·sÿl
)

180 
	#__·sÿl
 
·sÿl


	)

182 #ià!
defšed
(
__huge
)

183 
	#__huge
 
huge


	)

185 #–ià
defšed
(
__LZO_RENAME_B
)

186 #ià!
defšed
(
__cdeş
)

187 
	#__cdeş
 
_cdeş


	)

189 #ià!
defšed
(
__çr
)

190 
	#__çr
 
_çr


	)

192 #ià!
defšed
(
__huge
)

193 
	#__huge
 
_huge


	)

195 #ià!
defšed
(
__Ã¬
)

196 
	#__Ã¬
 
_Ã¬


	)

198 #ià!
defšed
(
__·sÿl
)

199 
	#__·sÿl
 
_·sÿl


	)

201 #–ià(
defšed
(
__PUREC__
è|| defšed(
__TURBOC__
)è&& defšed(
__TOS__
)

202 #ià!
defšed
(
__cdeş
)

203 
	#__cdeş
 
cdeş


	)

205 #ià!
defšed
(
__·sÿl
)

206 
	#__·sÿl
 
·sÿl


	)

209 #undeà
__LZO_RENAME_A


210 #undeà
__LZO_RENAME_B


212 #ià(
UINT_MAX
 =ğ
LZO_0xffffL
)

213 #ià
defšed
(
__AZTEC_C__
è&& defšed(
__DOS__
)

214 
	#LZO_BROKEN_CDECL_ALT_SYNTAX
 1

	)

215 #–ià
defšed
(
_MSC_VER
è&& defšed(
MSDOS
)

216 #ià(
_MSC_VER
 < 600)

217 
	#LZO_BROKEN_INTEGRAL_CONSTANTS
 1

	)

219 #ià(
_MSC_VER
 < 700)

220 
	#LZO_BROKEN_INTEGRAL_PROMOTION
 1

	)

221 
	#LZO_BROKEN_SIZEOF
 1

	)

223 #–ià
defšed
(
__PACIFIC__
è&& defšed(
DOS
)

224 
	#LZO_BROKEN_INTEGRAL_CONSTANTS
 1

	)

225 #–ià
defšed
(
__TURBOC__
è&& defšed(
__MSDOS__
)

226 #ià(
__TURBOC__
 < 0x0150)

227 
	#LZO_BROKEN_CDECL_ALT_SYNTAX
 1

	)

228 
	#LZO_BROKEN_INTEGRAL_CONSTANTS
 1

	)

229 
	#LZO_BROKEN_INTEGRAL_PROMOTION
 1

	)

231 #ià(
__TURBOC__
 < 0x0200)

232 
	#LZO_BROKEN_SIZEOF
 1

	)

234 #ià(
__TURBOC__
 < 0x0400è&& 
defšed
(
__ılu¥lus
)

235 
	#LZO_BROKEN_CDECL_ALT_SYNTAX
 1

	)

237 #–ià(
defšed
(
__PUREC__
è|| defšed(
__TURBOC__
)è&& defšed(
__TOS__
)

238 
	#LZO_BROKEN_CDECL_ALT_SYNTAX
 1

	)

239 
	#LZO_BROKEN_SIZEOF
 1

	)

242 #ià
defšed
(
__WATCOMC__
) && (__WATCOMC__ < 900)

243 
	#LZO_BROKEN_INTEGRAL_CONSTANTS
 1

	)

245 
	#LZO_CPP_STRINGIZE
(
x
è#x

	)

246 
	#LZO_CPP_MACRO_EXPAND
(
x
è
	`LZO_CPP_STRINGIZE
(x)

	)

247 
	#LZO_CPP_CONCAT2
(
a
,
b
è¨## 
	)
b

248 
	#LZO_CPP_CONCAT3
(
a
,
b
,
c
è¨## b ## 
	)
c

249 
	#LZO_CPP_CONCAT4
(
a
,
b
,
c
,
d
è¨## b ## c ## 
	)
d

250 
	#LZO_CPP_CONCAT5
(
a
,
b
,
c
,
d
,
e
è¨## b ## c ## d ## 
	)
e

251 
	#LZO_CPP_ECONCAT2
(
a
,
b
è
	`LZO_CPP_CONCAT2
×,b)

	)

252 
	#LZO_CPP_ECONCAT3
(
a
,
b
,
c
è
	`LZO_CPP_CONCAT3
×,b,c)

	)

253 
	#LZO_CPP_ECONCAT4
(
a
,
b
,
c
,
d
è
	`LZO_CPP_CONCAT4
×,b,c,d)

	)

254 
	#LZO_CPP_ECONCAT5
(
a
,
b
,
c
,
d
,
e
è
	`LZO_CPP_CONCAT5
×,b,c,d,e)

	)

255 
	#__LZO_MASK_GEN
(
o
,
b
è(((((oè<< ((b)-1)è- (o)è<< 1è+ (o))

	)

256 #ià1 && 
defšed
(
__ılu¥lus
)

257 #ià!
defšed
(
__STDC_CONSTANT_MACROS
)

258 
	#__STDC_CONSTANT_MACROS
 1

	)

260 #ià!
defšed
(
__STDC_LIMIT_MACROS
)

261 
	#__STDC_LIMIT_MACROS
 1

	)

264 #ià
defšed
(
__ılu¥lus
)

265 
	#LZO_EXTERN_C
 "C"

	)

267 
	#LZO_EXTERN_C
 

	)

269 #ià!
defšed
(
__LZO_OS_OVERRIDE
)

270 #ià
defšed
(
LZO_OS_FREESTANDING
)

271 
	#LZO_INFO_OS
 "ä“¡ªdšg"

	)

272 #–ià
defšed
(
LZO_OS_EMBEDDED
)

273 
	#LZO_INFO_OS
 "embedded"

	)

274 #–ià
defšed
(
__CYGWIN__
è&& defšed(
__GNUC__
)

275 
	#LZO_OS_CYGWIN
 1

	)

276 
	#LZO_INFO_OS
 "cygwš"

	)

277 #–ià
defšed
(
__EMX__
è&& defšed(
__GNUC__
)

278 
	#LZO_OS_EMX
 1

	)

279 
	#LZO_INFO_OS
 "emx"

	)

280 #–ià
defšed
(
__BEOS__
)

281 
	#LZO_OS_BEOS
 1

	)

282 
	#LZO_INFO_OS
 "beos"

	)

283 #–ià
defšed
(
__Lynx__
)

284 
	#LZO_OS_LYNXOS
 1

	)

285 
	#LZO_INFO_OS
 "lynxos"

	)

286 #–ià
defšed
(
__OS400__
)

287 
	#LZO_OS_OS400
 1

	)

288 
	#LZO_INFO_OS
 "os400"

	)

289 #–ià
defšed
(
__QNX__
)

290 
	#LZO_OS_QNX
 1

	)

291 
	#LZO_INFO_OS
 "qnx"

	)

292 #–ià
defšed
(
__BORLANDC__
è&& defšed(
__DPMI32__
) && (__BORLANDC__ >= 0x0460)

293 
	#LZO_OS_DOS32
 1

	)

294 
	#LZO_INFO_OS
 "dos32"

	)

295 #–ià
defšed
(
__BORLANDC__
è&& defšed(
__DPMI16__
)

296 
	#LZO_OS_DOS16
 1

	)

297 
	#LZO_INFO_OS
 "dos16"

	)

298 #–ià
defšed
(
__ZTC__
è&& defšed(
DOS386
)

299 
	#LZO_OS_DOS32
 1

	)

300 
	#LZO_INFO_OS
 "dos32"

	)

301 #–ià
defšed
(
__OS2__
è|| defšed(
__OS2V2__
)

302 #ià(
UINT_MAX
 =ğ
LZO_0xffffL
)

303 
	#LZO_OS_OS216
 1

	)

304 
	#LZO_INFO_OS
 "os216"

	)

305 #–ià(
UINT_MAX
 =ğ
LZO_0xffffffffL
)

306 
	#LZO_OS_OS2
 1

	)

307 
	#LZO_INFO_OS
 "os2"

	)

311 #–ià
defšed
(
__WIN64__
è|| defšed(
_WIN64
è|| defšed(
WIN64
)

312 
	#LZO_OS_WIN64
 1

	)

313 
	#LZO_INFO_OS
 "wš64"

	)

314 #–ià
defšed
(
__WIN32__
è|| defšed(
_WIN32
è|| defšed(
WIN32
è|| defšed(
__WINDOWS_386__
)

315 
	#LZO_OS_WIN32
 1

	)

316 
	#LZO_INFO_OS
 "wš32"

	)

317 #–ià
defšed
(
__MWERKS__
è&& defšed(
__INTEL__
)

318 
	#LZO_OS_WIN32
 1

	)

319 
	#LZO_INFO_OS
 "wš32"

	)

320 #–ià
defšed
(
__WINDOWS__
è|| defšed(
_WINDOWS
è|| defšed(
_Wšdows
)

321 #ià(
UINT_MAX
 =ğ
LZO_0xffffL
)

322 
	#LZO_OS_WIN16
 1

	)

323 
	#LZO_INFO_OS
 "wš16"

	)

324 #–ià(
UINT_MAX
 =ğ
LZO_0xffffffffL
)

325 
	#LZO_OS_WIN32
 1

	)

326 
	#LZO_INFO_OS
 "wš32"

	)

330 #–ià
defšed
(
__DOS__
è|| defšed(
__MSDOS__
è|| defšed(
_MSDOS
è|| defšed(
MSDOS
è|| (defšed(
__PACIFIC__
è&& defšed(
DOS
))

331 #ià(
UINT_MAX
 =ğ
LZO_0xffffL
)

332 
	#LZO_OS_DOS16
 1

	)

333 
	#LZO_INFO_OS
 "dos16"

	)

334 #–ià(
UINT_MAX
 =ğ
LZO_0xffffffffL
)

335 
	#LZO_OS_DOS32
 1

	)

336 
	#LZO_INFO_OS
 "dos32"

	)

340 #–ià
defšed
(
__WATCOMC__
)

341 #ià
defšed
(
__NT__
è&& (
UINT_MAX
 =ğ
LZO_0xffffL
)

342 
	#LZO_OS_DOS16
 1

	)

343 
	#LZO_INFO_OS
 "dos16"

	)

344 #–ià
defšed
(
__NT__
è&& (
__WATCOMC__
 < 1100)

345 
	#LZO_OS_WIN32
 1

	)

346 
	#LZO_INFO_OS
 "wš32"

	)

350 #–ià
defšed
(
__·lmos__
)

351 
	#LZO_OS_PALMOS
 1

	)

352 
	#LZO_INFO_OS
 "·lmos"

	)

353 #–ià
defšed
(
__TOS__
è|| defšed(
__©¬i¡__
)

354 
	#LZO_OS_TOS
 1

	)

355 
	#LZO_INFO_OS
 "tos"

	)

356 #–ià
defšed
(
macštosh
è&& !defšed(
__µc__
)

357 
	#LZO_OS_MACCLASSIC
 1

	)

358 
	#LZO_INFO_OS
 "macşassic"

	)

359 #–ià
defšed
(
__VMS
)

360 
	#LZO_OS_VMS
 1

	)

361 
	#LZO_INFO_OS
 "vms"

	)

362 #–ià((
defšed
(
__ms__
è&& defšed(
__R5900__
)è|| defšed(
__MIPS_PSX2__
))

363 
	#LZO_OS_CONSOLE
 1

	)

364 
	#LZO_OS_CONSOLE_PS2
 1

	)

365 
	#LZO_INFO_OS
 "cÚsŞe"

	)

366 
	#LZO_INFO_OS_CONSOLE
 "ps2"

	)

367 #–ià(
defšed
(
__ms__
è&& defšed(
__p¥__
))

368 
	#LZO_OS_CONSOLE
 1

	)

369 
	#LZO_OS_CONSOLE_PSP
 1

	)

370 
	#LZO_INFO_OS
 "cÚsŞe"

	)

371 
	#LZO_INFO_OS_CONSOLE
 "p¥"

	)

373 
	#LZO_OS_POSIX
 1

	)

374 
	#LZO_INFO_OS
 "posix"

	)

376 #ià(
LZO_OS_POSIX
)

377 #ià
defšed
(
_AIX
è|| defšed(
__AIX__
è|| defšed(
__aix__
)

378 
	#LZO_OS_POSIX_AIX
 1

	)

379 
	#LZO_INFO_OS_POSIX
 "aix"

	)

380 #–ià
defšed
(
__F»eBSD__
)

381 
	#LZO_OS_POSIX_FREEBSD
 1

	)

382 
	#LZO_INFO_OS_POSIX
 "ä“bsd"

	)

383 #–ià
defšed
(
__hpux__
è|| defšed(
__hpux
)

384 
	#LZO_OS_POSIX_HPUX
 1

	)

385 
	#LZO_INFO_OS_POSIX
 "hpux"

	)

386 #–ià
defšed
(
__INTERIX
)

387 
	#LZO_OS_POSIX_INTERIX
 1

	)

388 
	#LZO_INFO_OS_POSIX
 "š‹rix"

	)

389 #–ià
defšed
(
__IRIX__
è|| defšed(
__œix__
)

390 
	#LZO_OS_POSIX_IRIX
 1

	)

391 
	#LZO_INFO_OS_POSIX
 "œix"

	)

392 #–ià
defšed
(
__lšux__
è|| defšed(
__lšux
)

393 
	#LZO_OS_POSIX_LINUX
 1

	)

394 
	#LZO_INFO_OS_POSIX
 "lšux"

	)

395 #–ià
defšed
(
__APPLE__
è|| defšed(
__MACOS__
)

396 
	#LZO_OS_POSIX_MACOSX
 1

	)

397 
	#LZO_INFO_OS_POSIX
 "macosx"

	)

398 #–ià
defšed
(
__N‘BSD__
)

399 
	#LZO_OS_POSIX_NETBSD
 1

	)

400 
	#LZO_INFO_OS_POSIX
 "Ãtbsd"

	)

401 #–ià
defšed
(
__O³nBSD__
)

402 
	#LZO_OS_POSIX_OPENBSD
 1

	)

403 
	#LZO_INFO_OS_POSIX
 "İ’bsd"

	)

404 #–ià
defšed
(
__osf__
)

405 
	#LZO_OS_POSIX_OSF
 1

	)

406 
	#LZO_INFO_OS_POSIX
 "osf"

	)

407 #–ià
defšed
(
__sŞ¬is__
è|| defšed(
__sun
)

408 #ià
defšed
(
__SVR4
è|| defšed(
__svr4__
)

409 
	#LZO_OS_POSIX_SOLARIS
 1

	)

410 
	#LZO_INFO_OS_POSIX
 "sŞ¬is"

	)

412 
	#LZO_OS_POSIX_SUNOS
 1

	)

413 
	#LZO_INFO_OS_POSIX
 "sunos"

	)

415 #–ià
defšed
(
__uÉrix__
è|| defšed(
__uÉrix
)

416 
	#LZO_OS_POSIX_ULTRIX
 1

	)

417 
	#LZO_INFO_OS_POSIX
 "uÉrix"

	)

419 
	#LZO_OS_POSIX_UNKNOWN
 1

	)

420 
	#LZO_INFO_OS_POSIX
 "unknown"

	)

424 #ià(
LZO_OS_DOS16
 || 
LZO_OS_OS216
 || 
LZO_OS_WIN16
)

425 #ià(
UINT_MAX
 !ğ
LZO_0xffffL
)

428 #ià(
ULONG_MAX
 !ğ
LZO_0xffffffffL
)

432 #ià(
LZO_OS_DOS32
 || 
LZO_OS_OS2
 || 
LZO_OS_WIN32
 || 
LZO_OS_WIN64
)

433 #ià(
UINT_MAX
 !ğ
LZO_0xffffffffL
)

436 #ià(
ULONG_MAX
 !ğ
LZO_0xffffffffL
)

440 #ià
defšed
(
CIL
è&& defšed(
_GNUCC
è&& defšed(
__GNUC__
)

441 
	#LZO_CC_CILLY
 1

	)

442 
	#LZO_INFO_CC
 "Cly"

	)

443 #ià
defšed
(
__CILLY__
)

444 
	#LZO_INFO_CCVER
 
	`LZO_CPP_MACRO_EXPAND
(
__CILLY__
)

	)

446 
	#LZO_INFO_CCVER
 "unknown"

	)

448 #–ià0 && 
defšed
(
SDCC
è&& defšed(
__VERSION__
è&& !defšed(
__GNUC__
)

449 
	#LZO_CC_SDCC
 1

	)

450 
	#LZO_INFO_CC
 "sdcc"

	)

451 
	#LZO_INFO_CCVER
 
	`LZO_CPP_MACRO_EXPAND
(
SDCC
)

	)

452 #–ià
defšed
(
__PATHSCALE__
è&& defšed(
__PATHCC_PATCHLEVEL__
)

453 
	#LZO_CC_PATHSCALE
 (
__PATHCC__
 * 0x10000L + 
__PATHCC_MINOR__
 * 0x100 + 
__PATHCC_PATCHLEVEL__
)

	)

454 
	#LZO_INFO_CC
 "P©hsÿË C"

	)

455 
	#LZO_INFO_CCVER
 
__PATHSCALE__


	)

456 #–ià
defšed
(
__INTEL_COMPILER
)

457 
	#LZO_CC_INTELC
 1

	)

458 
	#LZO_INFO_CC
 "IÁ– C"

	)

459 
	#LZO_INFO_CCVER
 
	`LZO_CPP_MACRO_EXPAND
(
__INTEL_COMPILER
)

	)

460 #–ià
defšed
(
__POCC__
è&& defšed(
_WIN32
)

461 
	#LZO_CC_PELLESC
 1

	)

462 
	#LZO_INFO_CC
 "P–Ë C"

	)

463 
	#LZO_INFO_CCVER
 
	`LZO_CPP_MACRO_EXPAND
(
__POCC__
)

	)

464 #–ià
defšed
(
__Îvm__
è&& defšed(
__GNUC__
è&& defšed(
__VERSION__
)

465 
	#LZO_CC_LLVM
 1

	)

466 
	#LZO_INFO_CC
 "Îvm-gcc"

	)

467 
	#LZO_INFO_CCVER
 
__VERSION__


	)

468 #–ià
defšed
(
__GNUC__
è&& defšed(
__VERSION__
)

469 #ià
defšed
(
__GNUC_MINOR__
è&& defšed(
__GNUC_PATCHLEVEL__
)

470 
	#LZO_CC_GNUC
 (
__GNUC__
 * 0x10000L + 
__GNUC_MINOR__
 * 0x100 + 
__GNUC_PATCHLEVEL__
)

	)

471 #–ià
defšed
(
__GNUC_MINOR__
)

472 
	#LZO_CC_GNUC
 (
__GNUC__
 * 0x10000L + 
__GNUC_MINOR__
 * 0x100)

	)

474 
	#LZO_CC_GNUC
 (
__GNUC__
 * 0x10000L)

	)

476 
	#LZO_INFO_CC
 "gcc"

	)

477 
	#LZO_INFO_CCVER
 
__VERSION__


	)

478 #–ià
defšed
(
__AZTEC_C__
)

479 
	#LZO_CC_AZTECC
 1

	)

480 
	#LZO_INFO_CC
 "Az‹øC"

	)

481 
	#LZO_INFO_CCVER
 
	`LZO_CPP_MACRO_EXPAND
(
__AZTEC_C__
)

	)

482 #–ià
defšed
(
__BORLANDC__
)

483 
	#LZO_CC_BORLANDC
 1

	)

484 
	#LZO_INFO_CC
 "BÜÏnd C"

	)

485 
	#LZO_INFO_CCVER
 
	`LZO_CPP_MACRO_EXPAND
(
__BORLANDC__
)

	)

486 #–ià
defšed
(
__DMC__
è&& defšed(
__SC__
)

487 
	#LZO_CC_DMC
 1

	)

488 
	#LZO_INFO_CC
 "Dig™® M¬ C"

	)

489 
	#LZO_INFO_CCVER
 
	`LZO_CPP_MACRO_EXPAND
(
__DMC__
)

	)

490 #–ià
defšed
(
__DECC
)

491 
	#LZO_CC_DECC
 1

	)

492 
	#LZO_INFO_CC
 "DEC C"

	)

493 
	#LZO_INFO_CCVER
 
	`LZO_CPP_MACRO_EXPAND
(
__DECC
)

	)

494 #–ià
defšed
(
__HIGHC__
)

495 
	#LZO_CC_HIGHC
 1

	)

496 
	#LZO_INFO_CC
 "M‘aW¬High C"

	)

497 
	#LZO_INFO_CCVER
 "unknown"

	)

498 #–ià
defšed
(
__IBMC__
)

499 
	#LZO_CC_IBMC
 1

	)

500 
	#LZO_INFO_CC
 "IBM C"

	)

501 
	#LZO_INFO_CCVER
 
	`LZO_CPP_MACRO_EXPAND
(
__IBMC__
)

	)

502 #–ià
defšed
(
__KEIL__
è&& defšed(
__C166__
)

503 
	#LZO_CC_KEILC
 1

	)

504 
	#LZO_INFO_CC
 "Ke C"

	)

505 
	#LZO_INFO_CCVER
 
	`LZO_CPP_MACRO_EXPAND
(
__C166__
)

	)

506 #–ià
defšed
(
__LCC__
è&& defšed(
_WIN32
è&& defšed(
__LCCOPTIMLEVEL
)

507 
	#LZO_CC_LCCWIN32
 1

	)

508 
	#LZO_INFO_CC
 "lcc-wš32"

	)

509 
	#LZO_INFO_CCVER
 "unknown"

	)

510 #–ià
defšed
(
__LCC__
)

511 
	#LZO_CC_LCC
 1

	)

512 
	#LZO_INFO_CC
 "lcc"

	)

513 #ià
defšed
(
__LCC_VERSION__
)

514 
	#LZO_INFO_CCVER
 
	`LZO_CPP_MACRO_EXPAND
(
__LCC_VERSION__
)

	)

516 
	#LZO_INFO_CCVER
 "unknown"

	)

518 #–ià
defšed
(
_MSC_VER
)

519 
	#LZO_CC_MSC
 1

	)

520 
	#LZO_INFO_CC
 "Miüosoá C"

	)

521 #ià
defšed
(
_MSC_FULL_VER
)

522 
	#LZO_INFO_CCVER
 
	`LZO_CPP_MACRO_EXPAND
(
_MSC_VER
è"." LZO_CPP_MACRO_EXPAND(
_MSC_FULL_VER
)

	)

524 
	#LZO_INFO_CCVER
 
	`LZO_CPP_MACRO_EXPAND
(
_MSC_VER
)

	)

526 #–ià
defšed
(
__MWERKS__
)

527 
	#LZO_CC_MWERKS
 1

	)

528 
	#LZO_INFO_CC
 "M‘row”k C"

	)

529 
	#LZO_INFO_CCVER
 
	`LZO_CPP_MACRO_EXPAND
(
__MWERKS__
)

	)

530 #–ià(
defšed
(
__NDPC__
è|| defšed(
__NDPX__
)è&& defšed(
__i386
)

531 
	#LZO_CC_NDPC
 1

	)

532 
	#LZO_INFO_CC
 "Miüoway NDP C"

	)

533 
	#LZO_INFO_CCVER
 "unknown"

	)

534 #–ià
defšed
(
__PACIFIC__
)

535 
	#LZO_CC_PACIFICC
 1

	)

536 
	#LZO_INFO_CC
 "PacifiøC"

	)

537 
	#LZO_INFO_CCVER
 
	`LZO_CPP_MACRO_EXPAND
(
__PACIFIC__
)

	)

538 #–ià
defšed
(
__PGI
è&& (defšed(
__lšux__
è|| defšed(
__WIN32__
))

539 
	#LZO_CC_PGI
 1

	)

540 
	#LZO_INFO_CC
 "PÜªd Grou°PGI C"

	)

541 
	#LZO_INFO_CCVER
 "unknown"

	)

542 #–ià
defšed
(
__PUREC__
è&& defšed(
__TOS__
)

543 
	#LZO_CC_PUREC
 1

	)

544 
	#LZO_INFO_CC
 "Pu» C"

	)

545 
	#LZO_INFO_CCVER
 
	`LZO_CPP_MACRO_EXPAND
(
__PUREC__
)

	)

546 #–ià
defšed
(
__SC__
è&& defšed(
__ZTC__
)

547 
	#LZO_CC_SYMANTECC
 1

	)

548 
	#LZO_INFO_CC
 "Symª‹øC"

	)

549 
	#LZO_INFO_CCVER
 
	`LZO_CPP_MACRO_EXPAND
(
__SC__
)

	)

550 #–ià
defšed
(
__SUNPRO_C
)

551 
	#LZO_CC_SUNPROC
 1

	)

552 
	#LZO_INFO_CC
 "SuÀC"

	)

553 
	#LZO_INFO_CCVER
 "unknown"

	)

554 #–ià
defšed
(
__TINYC__
)

555 
	#LZO_CC_TINYC
 1

	)

556 
	#LZO_INFO_CC
 "Tšy C"

	)

557 
	#LZO_INFO_CCVER
 
	`LZO_CPP_MACRO_EXPAND
(
__TINYC__
)

	)

558 #–ià
defšed
(
__TSC__
)

559 
	#LZO_CC_TOPSPEEDC
 1

	)

560 
	#LZO_INFO_CC
 "TİS³ed C"

	)

561 
	#LZO_INFO_CCVER
 
	`LZO_CPP_MACRO_EXPAND
(
__TSC__
)

	)

562 #–ià
defšed
(
__WATCOMC__
)

563 
	#LZO_CC_WATCOMC
 1

	)

564 
	#LZO_INFO_CC
 "W©com C"

	)

565 
	#LZO_INFO_CCVER
 
	`LZO_CPP_MACRO_EXPAND
(
__WATCOMC__
)

	)

566 #–ià
defšed
(
__TURBOC__
)

567 
	#LZO_CC_TURBOC
 1

	)

568 
	#LZO_INFO_CC
 "TurbØC"

	)

569 
	#LZO_INFO_CCVER
 
	`LZO_CPP_MACRO_EXPAND
(
__TURBOC__
)

	)

570 #–ià
defšed
(
__ZTC__
)

571 
	#LZO_CC_ZORTECHC
 1

	)

572 
	#LZO_INFO_CC
 "ZÜ‹ch C"

	)

573 #ià(
__ZTC__
 == 0x310)

574 
	#LZO_INFO_CCVER
 "0x310"

	)

576 
	#LZO_INFO_CCVER
 
	`LZO_CPP_MACRO_EXPAND
(
__ZTC__
)

	)

579 
	#LZO_CC_UNKNOWN
 1

	)

580 
	#LZO_INFO_CC
 "unknown"

	)

581 
	#LZO_INFO_CCVER
 "unknown"

	)

583 #ià0 && (
LZO_CC_MSC
 && (
_MSC_VER
 >ğ1200)è&& !
defšed
(
_MSC_FULL_VER
)

586 #ià!
defšed
(
__LZO_ARCH_OVERRIDE
)

587 #ià
defšed
(
LZO_ARCH_GENERIC
)

588 
	#LZO_INFO_ARCH
 "g’”ic"

	)

589 #–ià(
LZO_OS_DOS16
 || 
LZO_OS_OS216
 || 
LZO_OS_WIN16
)

590 
	#LZO_ARCH_I086
 1

	)

591 
	#LZO_ARCH_IA16
 1

	)

592 
	#LZO_INFO_ARCH
 "i086"

	)

593 #–ià
defšed
(
__®pha__
è|| defšed(
__®pha
è|| defšed(
_M_ALPHA
)

594 
	#LZO_ARCH_ALPHA
 1

	)

595 
	#LZO_INFO_ARCH
 "®pha"

	)

596 #–ià
defšed
(
__amd64__
è|| defšed(
__x86_64__
è|| defšed(
_M_AMD64
)

597 
	#LZO_ARCH_AMD64
 1

	)

598 
	#LZO_INFO_ARCH
 "amd64"

	)

599 #–ià
defšed
(
__thumb__
è|| (defšed(
_M_ARM
è&& defšed(
_M_THUMB
))

600 
	#LZO_ARCH_ARM
 1

	)

601 
	#LZO_ARCH_ARM_THUMB
 1

	)

602 
	#LZO_INFO_ARCH
 "¬m_thumb"

	)

603 #–ià
defšed
(
__¬m__
è|| defšed(
_M_ARM
)

604 
	#LZO_ARCH_ARM
 1

	)

605 
	#LZO_INFO_ARCH
 "¬m"

	)

606 #–ià(
UINT_MAX
 <ğ
LZO_0xffffL
è&& 
defšed
(
__AVR__
)

607 
	#LZO_ARCH_AVR
 1

	)

608 
	#LZO_INFO_ARCH
 "avr"

	)

609 #–ià
defšed
(
__bfš__
)

610 
	#LZO_ARCH_BLACKFIN
 1

	)

611 
	#LZO_INFO_ARCH
 "bÏckfš"

	)

612 #–ià(
UINT_MAX
 =ğ
LZO_0xffffL
è&& 
defšed
(
__C166__
)

613 
	#LZO_ARCH_C166
 1

	)

614 
	#LZO_INFO_ARCH
 "c166"

	)

615 #–ià
defšed
(
__üis__
)

616 
	#LZO_ARCH_CRIS
 1

	)

617 
	#LZO_INFO_ARCH
 "üis"

	)

618 #–ià
defšed
(
__H8300__
è|| defšed(
__H8300H__
è|| defšed(
__H8300S__
è|| defšed(
__H8300SX__
)

619 
	#LZO_ARCH_H8300
 1

	)

620 
	#LZO_INFO_ARCH
 "h8300"

	)

621 #–ià
defšed
(
__hµa__
è|| defšed(
__hµa
)

622 
	#LZO_ARCH_HPPA
 1

	)

623 
	#LZO_INFO_ARCH
 "hµa"

	)

624 #–ià
defšed
(
__386__
è|| defšed(
__i386__
è|| defšed(
__i386
è|| defšed(
_M_IX86
è|| defšed(
_M_I386
)

625 
	#LZO_ARCH_I386
 1

	)

626 
	#LZO_ARCH_IA32
 1

	)

627 
	#LZO_INFO_ARCH
 "i386"

	)

628 #–ià(
LZO_CC_ZORTECHC
 && 
defšed
(
__I86__
))

629 
	#LZO_ARCH_I386
 1

	)

630 
	#LZO_ARCH_IA32
 1

	)

631 
	#LZO_INFO_ARCH
 "i386"

	)

632 #–ià(
LZO_OS_DOS32
 && 
LZO_CC_HIGHC
è&& 
defšed
(
_I386
)

633 
	#LZO_ARCH_I386
 1

	)

634 
	#LZO_ARCH_IA32
 1

	)

635 
	#LZO_INFO_ARCH
 "i386"

	)

636 #–ià
defšed
(
__Ÿ64__
è|| defšed(
__Ÿ64
è|| defšed(
_M_IA64
)

637 
	#LZO_ARCH_IA64
 1

	)

638 
	#LZO_INFO_ARCH
 "Ÿ64"

	)

639 #–ià(
UINT_MAX
 =ğ
LZO_0xffffL
è&& 
defšed
(
__m32c__
)

640 
	#LZO_ARCH_M16C
 1

	)

641 
	#LZO_INFO_ARCH
 "m16c"

	)

642 #–ià
defšed
(
__m32r__
)

643 
	#LZO_ARCH_M32R
 1

	)

644 
	#LZO_INFO_ARCH
 "m32r"

	)

645 #–ià(
LZO_OS_TOS
è|| 
defšed
(
__m68k__
è|| defšed(
__m68000__
è|| defšed(
__mc68000__
è|| defšed(
_M_M68K
)

646 
	#LZO_ARCH_M68K
 1

	)

647 
	#LZO_INFO_ARCH
 "m68k"

	)

648 #–ià(
UINT_MAX
 =ğ
LZO_0xffffL
è&& 
defšed
(
__C251__
)

649 
	#LZO_ARCH_MCS251
 1

	)

650 
	#LZO_INFO_ARCH
 "mcs251"

	)

651 #–ià(
UINT_MAX
 =ğ
LZO_0xffffL
è&& 
defšed
(
__C51__
)

652 
	#LZO_ARCH_MCS51
 1

	)

653 
	#LZO_INFO_ARCH
 "mcs51"

	)

654 #–ià
defšed
(
__ms__
è|| defšed(
__ms
è|| defšed(
_MIPS_ARCH
è|| defšed(
_M_MRX000
)

655 
	#LZO_ARCH_MIPS
 1

	)

656 
	#LZO_INFO_ARCH
 "ms"

	)

657 #–ià(
UINT_MAX
 =ğ
LZO_0xffffL
è&& 
defšed
(
__MSP430__
)

658 
	#LZO_ARCH_MSP430
 1

	)

659 
	#LZO_INFO_ARCH
 "m¥430"

	)

660 #–ià
defšed
(
__pow”pc__
è|| defšed(
__pow”pc
è|| defšed(
__µc__
è|| defšed(
__PPC__
è|| defšed(
_M_PPC
)

661 
	#LZO_ARCH_POWERPC
 1

	)

662 
	#LZO_INFO_ARCH
 "pow”pc"

	)

663 #–ià
defšed
(
__s390__
è|| defšed(
__s390
è|| defšed(
__s390x__
è|| defšed(
__s390x
)

664 
	#LZO_ARCH_S390
 1

	)

665 
	#LZO_INFO_ARCH
 "s390"

	)

666 #–ià
defšed
(
__sh__
è|| defšed(
_M_SH
)

667 
	#LZO_ARCH_SH
 1

	)

668 
	#LZO_INFO_ARCH
 "sh"

	)

669 #–ià
defšed
(
__¥¬c__
è|| defšed(
__¥¬c
è|| defšed(
__¥¬cv8
)

670 
	#LZO_ARCH_SPARC
 1

	)

671 
	#LZO_INFO_ARCH
 "¥¬c"

	)

672 #–ià(
UINT_MAX
 =ğ
LZO_0xffffL
è&& 
defšed
(
__z80
)

673 
	#LZO_ARCH_Z80
 1

	)

674 
	#LZO_INFO_ARCH
 "z80"

	)

676 
	#LZO_ARCH_UNKNOWN
 1

	)

677 
	#LZO_INFO_ARCH
 "unknown"

	)

680 #ià1 && (
LZO_ARCH_UNKNOWN
è&& (
LZO_OS_DOS32
 || 
LZO_OS_OS2
)

683 #ià1 && (
LZO_ARCH_UNKNOWN
è&& (
LZO_OS_WIN32
)

686 #ià1 && (
LZO_ARCH_UNKNOWN
è&& (
LZO_OS_WIN64
)

689 #ià(
LZO_OS_OS216
 || 
LZO_OS_WIN16
)

690 
	#LZO_ARCH_I086PM
 1

	)

691 
	#LZO_ARCH_IA16PM
 1

	)

692 #–ià1 && (
LZO_OS_DOS16
 && 
defšed
(
BLX286
))

693 
	#LZO_ARCH_I086PM
 1

	)

694 
	#LZO_ARCH_IA16PM
 1

	)

695 #–ià1 && (
LZO_OS_DOS16
 && 
defšed
(
DOSX286
))

696 
	#LZO_ARCH_I086PM
 1

	)

697 
	#LZO_ARCH_IA16PM
 1

	)

698 #–ià1 && (
LZO_OS_DOS16
 && 
LZO_CC_BORLANDC
 && 
defšed
(
__DPMI16__
))

699 
	#LZO_ARCH_I086PM
 1

	)

700 
	#LZO_ARCH_IA16PM
 1

	)

702 #ià
defšed
(
LZO_ARCH_ARM_THUMB
è&& !defšed(
LZO_ARCH_ARM
)

705 #ià
defšed
(
LZO_ARCH_I086PM
è&& !defšed(
LZO_ARCH_I086
)

708 #ià(
LZO_ARCH_I086
)

709 #ià(
UINT_MAX
 !ğ
LZO_0xffffL
)

712 #ià(
ULONG_MAX
 !ğ
LZO_0xffffffffL
)

716 #ià(
LZO_ARCH_I386
)

717 #ià(
UINT_MAX
 !ğ
LZO_0xffffL
è&& 
defšed
(
__i386_št16__
)

720 #ià(
UINT_MAX
 !ğ
LZO_0xffffffffL
è&& !
defšed
(
__i386_št16__
)

723 #ià(
ULONG_MAX
 !ğ
LZO_0xffffffffL
)

727 #ià!
defšed
(
__LZO_MM_OVERRIDE
)

728 #ià(
LZO_OS_DOS16
 || 
LZO_OS_OS216
 || 
LZO_OS_WIN16
)

729 #ià(
UINT_MAX
 !ğ
LZO_0xffffL
)

732 #ià
defšed
(
__TINY__
è|| defšed(
M_I86TM
è|| defšed(
_M_I86TM
)

733 
	#LZO_MM_TINY
 1

	)

734 #–ià
defšed
(
__HUGE__
è|| defšed(
_HUGE_
è|| defšed(
M_I86HM
è|| defšed(
_M_I86HM
)

735 
	#LZO_MM_HUGE
 1

	)

736 #–ià
defšed
(
__SMALL__
è|| defšed(
M_I86SM
è|| defšed(
_M_I86SM
è|| defšed(
SMALL_MODEL
)

737 
	#LZO_MM_SMALL
 1

	)

738 #–ià
defšed
(
__MEDIUM__
è|| defšed(
M_I86MM
è|| defšed(
_M_I86MM
)

739 
	#LZO_MM_MEDIUM
 1

	)

740 #–ià
defšed
(
__COMPACT__
è|| defšed(
M_I86CM
è|| defšed(
_M_I86CM
)

741 
	#LZO_MM_COMPACT
 1

	)

742 #–ià
defšed
(
__LARGE__
è|| defšed(
M_I86LM
è|| defšed(
_M_I86LM
è|| defšed(
LARGE_MODEL
)

743 
	#LZO_MM_LARGE
 1

	)

744 #–ià(
LZO_CC_AZTECC
)

745 #ià
defšed
(
_LARGE_CODE
è&& defšed(
_LARGE_DATA
)

746 
	#LZO_MM_LARGE
 1

	)

747 #–ià
defšed
(
_LARGE_CODE
)

748 
	#LZO_MM_MEDIUM
 1

	)

749 #–ià
defšed
(
_LARGE_DATA
)

750 
	#LZO_MM_COMPACT
 1

	)

752 
	#LZO_MM_SMALL
 1

	)

754 #–ià(
LZO_CC_ZORTECHC
 && 
defšed
(
__VCM__
))

755 
	#LZO_MM_LARGE
 1

	)

759 
	#LZO_HAVE_MM_HUGE_PTR
 1

	)

760 
	#LZO_HAVE_MM_HUGE_ARRAY
 1

	)

761 #ià(
LZO_MM_TINY
)

762 #undeà
LZO_HAVE_MM_HUGE_ARRAY


764 #ià(
LZO_CC_AZTECC
 || 
LZO_CC_PACIFICC
 || 
LZO_CC_ZORTECHC
)

765 #undeà
LZO_HAVE_MM_HUGE_PTR


766 #undeà
LZO_HAVE_MM_HUGE_ARRAY


767 #–ià(
LZO_CC_DMC
 || 
LZO_CC_SYMANTECC
)

768 #undeà
LZO_HAVE_MM_HUGE_ARRAY


769 #–ià(
LZO_CC_MSC
 && 
defšed
(
_QC
))

770 #undeà
LZO_HAVE_MM_HUGE_ARRAY


771 #ià(
_MSC_VER
 < 600)

772 #undeà
LZO_HAVE_MM_HUGE_PTR


774 #–ià(
LZO_CC_TURBOC
 && (
__TURBOC__
 < 0x0295))

775 #undeà
LZO_HAVE_MM_HUGE_ARRAY


777 #ià(
LZO_ARCH_I086PM
è&& !
defšed
(
LZO_HAVE_MM_HUGE_PTR
)

778 #ià(
LZO_OS_DOS16
)

780 #–ià(
LZO_CC_ZORTECHC
)

785 #ifdeà
__ılu¥lus


788 #ià(
LZO_CC_BORLANDC
 && (
__BORLANDC__
 >= 0x0200))

789 
__Ã¬
 
__cdeş
 
_AHSHIFT
();

790 
	#LZO_MM_AHSHIFT
 ((è
_AHSHIFT
)

	)

791 #–ià(
LZO_CC_DMC
 || 
LZO_CC_SYMANTECC
 || 
LZO_CC_ZORTECHC
)

792 
__Ã¬
 
__cdeş
 
_AHSHIFT
();

793 
	#LZO_MM_AHSHIFT
 ((è
_AHSHIFT
)

	)

794 #–ià(
LZO_CC_MSC
 || 
LZO_CC_TOPSPEEDC
)

795 
__Ã¬
 
__cdeş
 
_AHSHIFT
();

796 
	#LZO_MM_AHSHIFT
 ((è
_AHSHIFT
)

	)

797 #–ià(
LZO_CC_TURBOC
 && (
__TURBOC__
 >= 0x0295))

798 
__Ã¬
 
__cdeş
 
_AHSHIFT
();

799 
	#LZO_MM_AHSHIFT
 ((è
_AHSHIFT
)

	)

800 #–ià((
LZO_CC_AZTECC
 || 
LZO_CC_PACIFICC
 || 
LZO_CC_TURBOC
è&& 
LZO_OS_DOS16
)

801 
	#LZO_MM_AHSHIFT
 12

	)

802 #–ià(
LZO_CC_WATCOMC
)

803 
_HShiá
;

804 
	#LZO_MM_AHSHIFT
 ((è
_HShiá
)

	)

808 #ifdeà
__ılu¥lus


811 #–ià(
LZO_ARCH_C166
)

812 #ià!
defšed
(
__MODEL__
)

814 #–ià((
__MODEL__
) == 0)

815 
	#LZO_MM_SMALL
 1

	)

816 #–ià((
__MODEL__
) == 1)

817 
	#LZO_MM_SMALL
 1

	)

818 #–ià((
__MODEL__
) == 2)

819 
	#LZO_MM_LARGE
 1

	)

820 #–ià((
__MODEL__
) == 3)

821 
	#LZO_MM_TINY
 1

	)

822 #–ià((
__MODEL__
) == 4)

823 
	#LZO_MM_XTINY
 1

	)

824 #–ià((
__MODEL__
) == 5)

825 
	#LZO_MM_XSMALL
 1

	)

829 #–ià(
LZO_ARCH_MCS251
)

830 #ià!
defšed
(
__MODEL__
)

832 #–ià((
__MODEL__
) == 0)

833 
	#LZO_MM_SMALL
 1

	)

834 #–ià((
__MODEL__
) == 2)

835 
	#LZO_MM_LARGE
 1

	)

836 #–ià((
__MODEL__
) == 3)

837 
	#LZO_MM_TINY
 1

	)

838 #–ià((
__MODEL__
) == 4)

839 
	#LZO_MM_XTINY
 1

	)

840 #–ià((
__MODEL__
) == 5)

841 
	#LZO_MM_XSMALL
 1

	)

845 #–ià(
LZO_ARCH_MCS51
)

846 #ià!
defšed
(
__MODEL__
)

848 #–ià((
__MODEL__
) == 1)

849 
	#LZO_MM_SMALL
 1

	)

850 #–ià((
__MODEL__
) == 2)

851 
	#LZO_MM_LARGE
 1

	)

852 #–ià((
__MODEL__
) == 3)

853 
	#LZO_MM_TINY
 1

	)

854 #–ià((
__MODEL__
) == 4)

855 
	#LZO_MM_XTINY
 1

	)

856 #–ià((
__MODEL__
) == 5)

857 
	#LZO_MM_XSMALL
 1

	)

862 
	#LZO_MM_FLAT
 1

	)

864 #ià(
LZO_MM_FLAT
)

865 
	#LZO_INFO_MM
 "æ©"

	)

866 #–ià(
LZO_MM_TINY
)

867 
	#LZO_INFO_MM
 "tšy"

	)

868 #–ià(
LZO_MM_SMALL
)

869 
	#LZO_INFO_MM
 "sm®l"

	)

870 #–ià(
LZO_MM_MEDIUM
)

871 
	#LZO_INFO_MM
 "medium"

	)

872 #–ià(
LZO_MM_COMPACT
)

873 
	#LZO_INFO_MM
 "com·ù"

	)

874 #–ià(
LZO_MM_LARGE
)

875 
	#LZO_INFO_MM
 "Ïrge"

	)

876 #–ià(
LZO_MM_HUGE
)

877 
	#LZO_INFO_MM
 "huge"

	)

882 #ià
defšed
(
SIZEOF_SHORT
)

883 
	#LZO_SIZEOF_SHORT
 (
SIZEOF_SHORT
)

	)

885 #ià
defšed
(
SIZEOF_INT
)

886 
	#LZO_SIZEOF_INT
 (
SIZEOF_INT
)

	)

888 #ià
defšed
(
SIZEOF_LONG
)

889 
	#LZO_SIZEOF_LONG
 (
SIZEOF_LONG
)

	)

891 #ià
defšed
(
SIZEOF_LONG_LONG
)

892 
	#LZO_SIZEOF_LONG_LONG
 (
SIZEOF_LONG_LONG
)

	)

894 #ià
defšed
(
SIZEOF___INT16
)

895 
	#LZO_SIZEOF___INT16
 (
SIZEOF___INT16
)

	)

897 #ià
defšed
(
SIZEOF___INT32
)

898 
	#LZO_SIZEOF___INT32
 (
SIZEOF___INT32
)

	)

900 #ià
defšed
(
SIZEOF___INT64
)

901 
	#LZO_SIZEOF___INT64
 (
SIZEOF___INT64
)

	)

903 #ià
defšed
(
SIZEOF_VOID_P
)

904 
	#LZO_SIZEOF_VOID_P
 (
SIZEOF_VOID_P
)

	)

906 #ià
defšed
(
SIZEOF_SIZE_T
)

907 
	#LZO_SIZEOF_SIZE_T
 (
SIZEOF_SIZE_T
)

	)

909 #ià
defšed
(
SIZEOF_PTRDIFF_T
)

910 
	#LZO_SIZEOF_PTRDIFF_T
 (
SIZEOF_PTRDIFF_T
)

	)

912 
	#__LZO_LSR
(
x
,
b
è(((x)+0ulè>> (b))

	)

913 #ià!
defšed
(
LZO_SIZEOF_SHORT
)

914 #ià(
USHRT_MAX
 =ğ
LZO_0xffffL
)

915 
	#LZO_SIZEOF_SHORT
 2

	)

916 #–ià(
__LZO_LSR
(
USHRT_MAX
,7) == 1)

917 
	#LZO_SIZEOF_SHORT
 1

	)

918 #–ià(
__LZO_LSR
(
USHRT_MAX
,15) == 1)

919 
	#LZO_SIZEOF_SHORT
 2

	)

920 #–ià(
__LZO_LSR
(
USHRT_MAX
,31) == 1)

921 
	#LZO_SIZEOF_SHORT
 4

	)

922 #–ià(
__LZO_LSR
(
USHRT_MAX
,63) == 1)

923 
	#LZO_SIZEOF_SHORT
 8

	)

924 #–ià(
__LZO_LSR
(
USHRT_MAX
,127) == 1)

925 
	#LZO_SIZEOF_SHORT
 16

	)

930 #ià!
defšed
(
LZO_SIZEOF_INT
)

931 #ià(
UINT_MAX
 =ğ
LZO_0xffffL
)

932 
	#LZO_SIZEOF_INT
 2

	)

933 #–ià(
UINT_MAX
 =ğ
LZO_0xffffffffL
)

934 
	#LZO_SIZEOF_INT
 4

	)

935 #–ià(
__LZO_LSR
(
UINT_MAX
,7) == 1)

936 
	#LZO_SIZEOF_INT
 1

	)

937 #–ià(
__LZO_LSR
(
UINT_MAX
,15) == 1)

938 
	#LZO_SIZEOF_INT
 2

	)

939 #–ià(
__LZO_LSR
(
UINT_MAX
,31) == 1)

940 
	#LZO_SIZEOF_INT
 4

	)

941 #–ià(
__LZO_LSR
(
UINT_MAX
,63) == 1)

942 
	#LZO_SIZEOF_INT
 8

	)

943 #–ià(
__LZO_LSR
(
UINT_MAX
,127) == 1)

944 
	#LZO_SIZEOF_INT
 16

	)

949 #ià!
defšed
(
LZO_SIZEOF_LONG
)

950 #ià(
ULONG_MAX
 =ğ
LZO_0xffffffffL
)

951 
	#LZO_SIZEOF_LONG
 4

	)

952 #–ià(
__LZO_LSR
(
ULONG_MAX
,7) == 1)

953 
	#LZO_SIZEOF_LONG
 1

	)

954 #–ià(
__LZO_LSR
(
ULONG_MAX
,15) == 1)

955 
	#LZO_SIZEOF_LONG
 2

	)

956 #–ià(
__LZO_LSR
(
ULONG_MAX
,31) == 1)

957 
	#LZO_SIZEOF_LONG
 4

	)

958 #–ià(
__LZO_LSR
(
ULONG_MAX
,63) == 1)

959 
	#LZO_SIZEOF_LONG
 8

	)

960 #–ià(
__LZO_LSR
(
ULONG_MAX
,127) == 1)

961 
	#LZO_SIZEOF_LONG
 16

	)

966 #ià!
defšed
(
LZO_SIZEOF_LONG_LONG
è&& !defšed(
LZO_SIZEOF___INT64
)

967 #ià(
LZO_SIZEOF_LONG
 > 0 && LZO_SIZEOF_LONG < 8)

968 #ià
defšed
(
__LONG_MAX__
è&& defšed(
__LONG_LONG_MAX__
)

969 #ià(
LZO_CC_GNUC
 >= 0x030300ul)

970 #ià((
__LONG_MAX__
)+0 =ğ(
__LONG_LONG_MAX__
)+0)

971 
	#LZO_SIZEOF_LONG_LONG
 
LZO_SIZEOF_LONG


	)

977 #ià!
defšed
(
LZO_SIZEOF_LONG_LONG
è&& !defšed(
LZO_SIZEOF___INT64
)

978 #ià(
LZO_SIZEOF_LONG
 > 0 && LZO_SIZEOF_LONG < 8)

979 #ià(
LZO_ARCH_I086
 && 
LZO_CC_DMC
)

980 #–ià(
LZO_CC_CILLY
è&& 
defšed
(
__GNUC__
)

981 
	#LZO_SIZEOF_LONG_LONG
 8

	)

982 #–ià(
LZO_CC_GNUC
 || 
LZO_CC_LLVM
 || 
LZO_CC_PATHSCALE
)

983 
	#LZO_SIZEOF_LONG_LONG
 8

	)

984 #–ià((
LZO_OS_WIN32
 || 
LZO_OS_WIN64
è&& 
LZO_CC_MSC
 && (
_MSC_VER
 >= 1400))

985 
	#LZO_SIZEOF_LONG_LONG
 8

	)

986 #–ià(
LZO_OS_WIN64
)

987 
	#LZO_SIZEOF___INT64
 8

	)

988 #–ià(
LZO_ARCH_I386
 && (
LZO_CC_DMC
))

989 
	#LZO_SIZEOF_LONG_LONG
 8

	)

990 #–ià(
LZO_ARCH_I386
 && (
LZO_CC_SYMANTECC
 && (
__SC__
 >= 0x700)))

991 
	#LZO_SIZEOF_LONG_LONG
 8

	)

992 #–ià(
LZO_ARCH_I386
 && (
LZO_CC_INTELC
 && 
defšed
(
__lšux__
)))

993 
	#LZO_SIZEOF_LONG_LONG
 8

	)

994 #–ià(
LZO_ARCH_I386
 && (
LZO_CC_MWERKS
 || 
LZO_CC_PELLESC
 || 
LZO_CC_PGI
))

995 
	#LZO_SIZEOF_LONG_LONG
 8

	)

996 #–ià(
LZO_ARCH_I386
 && (
LZO_CC_INTELC
 || 
LZO_CC_MSC
))

997 
	#LZO_SIZEOF___INT64
 8

	)

998 #–ià(
LZO_OS_WIN32
 && (
LZO_CC_MSC
))

999 
	#LZO_SIZEOF___INT64
 8

	)

1000 #–ià(
LZO_ARCH_I386
 && (
LZO_CC_BORLANDC
 && (
__BORLANDC__
 >= 0x0520)))

1001 
	#LZO_SIZEOF___INT64
 8

	)

1002 #–ià(
LZO_ARCH_I386
 && (
LZO_CC_WATCOMC
 && (
__WATCOMC__
 >= 1100)))

1003 
	#LZO_SIZEOF___INT64
 8

	)

1004 #–ià(
LZO_CC_WATCOMC
 && 
defšed
(
_INTEGRAL_MAX_BITS
) && (_INTEGRAL_MAX_BITS == 64))

1005 
	#LZO_SIZEOF___INT64
 8

	)

1006 #–ià(
LZO_OS_OS400
è&& 
defšed
(
__LLP64_IFC__
)

1007 
	#LZO_SIZEOF_LONG_LONG
 8

	)

1008 #–ià(
defšed
(
__vms
è|| defšed(
__VMS
)è&& (
__INITIAL_POINTER_SIZE
+0 == 64)

1009 
	#LZO_SIZEOF_LONG_LONG
 8

	)

1010 #–ià(
LZO_CC_SDCC
è&& (
LZO_SIZEOF_INT
 == 2)

1011 #–ià1 && 
defšed
(
__STDC_VERSION__
) && (__STDC_VERSION__ >= 199901L)

1012 
	#LZO_SIZEOF_LONG_LONG
 8

	)

1016 #ià
defšed
(
__ılu¥lus
è&& defšed(
LZO_CC_GNUC
)

1017 #ià(
LZO_CC_GNUC
 < 0x020800ul)

1018 #undeà
LZO_SIZEOF_LONG_LONG


1021 #ià
defšed
(
LZO_CFG_NO_LONG_LONG
è|| defšed(
__NO_LONG_LONG
)

1022 #undeà
LZO_SIZEOF_LONG_LONG


1024 #ià!
defšed
(
LZO_SIZEOF_VOID_P
)

1025 #ià(
LZO_ARCH_I086
)

1026 
	#__LZO_WORDSIZE
 2

	)

1027 #ià(
LZO_MM_TINY
 || 
LZO_MM_SMALL
 || 
LZO_MM_MEDIUM
)

1028 
	#LZO_SIZEOF_VOID_P
 2

	)

1029 #–ià(
LZO_MM_COMPACT
 || 
LZO_MM_LARGE
 || 
LZO_MM_HUGE
)

1030 
	#LZO_SIZEOF_VOID_P
 4

	)

1034 #–ià(
LZO_ARCH_AVR
 || 
LZO_ARCH_Z80
)

1035 
	#__LZO_WORDSIZE
 1

	)

1036 
	#LZO_SIZEOF_VOID_P
 2

	)

1037 #–ià(
LZO_ARCH_C166
 || 
LZO_ARCH_MCS51
 || 
LZO_ARCH_MCS251
 || 
LZO_ARCH_MSP430
)

1038 
	#LZO_SIZEOF_VOID_P
 2

	)

1039 #–ià(
LZO_ARCH_H8300
)

1040 #ià
defšed
(
__NORMAL_MODE__
)

1041 
	#__LZO_WORDSIZE
 4

	)

1042 
	#LZO_SIZEOF_VOID_P
 2

	)

1043 #–ià
defšed
(
__H8300H__
è|| defšed(
__H8300S__
è|| defšed(
__H8300SX__
)

1044 
	#__LZO_WORDSIZE
 4

	)

1045 
	#LZO_SIZEOF_VOID_P
 4

	)

1047 
	#__LZO_WORDSIZE
 2

	)

1048 
	#LZO_SIZEOF_VOID_P
 2

	)

1050 #ià(
LZO_CC_GNUC
 && (LZO_CC_GNUC < 0x040000ul)è&& (
LZO_SIZEOF_INT
 == 4)

1051 
	#LZO_SIZEOF_SIZE_T
 
LZO_SIZEOF_INT


	)

1052 
	#LZO_SIZEOF_PTRDIFF_T
 
LZO_SIZEOF_INT


	)

1054 #–ià(
LZO_ARCH_M16C
)

1055 
	#__LZO_WORDSIZE
 2

	)

1056 #ià
defšed
(
__m32c_ıu__
è|| defšed(
__m32cm_ıu__
)

1057 
	#LZO_SIZEOF_VOID_P
 4

	)

1059 
	#LZO_SIZEOF_VOID_P
 2

	)

1061 #–ià(
LZO_SIZEOF_LONG
 =ğ8è&& ((
defšed
(
__ms__
è&& defšed(
__R5900__
)è|| defšed(
__MIPS_PSX2__
))

1062 
	#__LZO_WORDSIZE
 8

	)

1063 
	#LZO_SIZEOF_VOID_P
 4

	)

1064 #–ià
defšed
(
__LLP64__
è|| defšed(
__LLP64
è|| defšed(
_LLP64
è|| defšed(
_WIN64
)

1065 
	#__LZO_WORDSIZE
 8

	)

1066 
	#LZO_SIZEOF_VOID_P
 8

	)

1067 #–ià(
LZO_OS_OS400
è&& 
defšed
(
__LLP64_IFC__
)

1068 
	#LZO_SIZEOF_VOID_P
 
LZO_SIZEOF_LONG


	)

1069 
	#LZO_SIZEOF_SIZE_T
 
LZO_SIZEOF_LONG


	)

1070 
	#LZO_SIZEOF_PTRDIFF_T
 
LZO_SIZEOF_LONG


	)

1071 #–ià(
LZO_OS_OS400
)

1072 
	#__LZO_WORDSIZE
 
LZO_SIZEOF_LONG


	)

1073 
	#LZO_SIZEOF_VOID_P
 16

	)

1074 
	#LZO_SIZEOF_SIZE_T
 
LZO_SIZEOF_LONG


	)

1075 
	#LZO_SIZEOF_PTRDIFF_T
 
LZO_SIZEOF_LONG


	)

1076 #–ià(
defšed
(
__vms
è|| defšed(
__VMS
)è&& (
__INITIAL_POINTER_SIZE
+0 == 64)

1077 
	#LZO_SIZEOF_VOID_P
 8

	)

1078 
	#LZO_SIZEOF_SIZE_T
 
LZO_SIZEOF_LONG


	)

1079 
	#LZO_SIZEOF_PTRDIFF_T
 
LZO_SIZEOF_LONG


	)

1081 
	#LZO_SIZEOF_VOID_P
 
LZO_SIZEOF_LONG


	)

1084 #ià!
defšed
(
LZO_WORDSIZE
)

1085 #ià
defšed
(
__LZO_WORDSIZE
)

1086 
	#LZO_WORDSIZE
 
__LZO_WORDSIZE


	)

1088 
	#LZO_WORDSIZE
 
LZO_SIZEOF_VOID_P


	)

1091 #ià!
defšed
(
LZO_SIZEOF_SIZE_T
)

1092 #ià(
LZO_ARCH_I086
 || 
LZO_ARCH_M16C
)

1093 
	#LZO_SIZEOF_SIZE_T
 2

	)

1095 
	#LZO_SIZEOF_SIZE_T
 
LZO_SIZEOF_VOID_P


	)

1098 #ià!
defšed
(
LZO_SIZEOF_PTRDIFF_T
)

1099 #ià(
LZO_ARCH_I086
)

1100 #ià(
LZO_MM_TINY
 || 
LZO_MM_SMALL
 || 
LZO_MM_MEDIUM
 || 
LZO_MM_HUGE
)

1101 
	#LZO_SIZEOF_PTRDIFF_T
 
LZO_SIZEOF_VOID_P


	)

1102 #–ià(
LZO_MM_COMPACT
 || 
LZO_MM_LARGE
)

1103 #ià(
LZO_CC_BORLANDC
 || 
LZO_CC_TURBOC
)

1104 
	#LZO_SIZEOF_PTRDIFF_T
 4

	)

1106 
	#LZO_SIZEOF_PTRDIFF_T
 2

	)

1112 
	#LZO_SIZEOF_PTRDIFF_T
 
LZO_SIZEOF_SIZE_T


	)

1115 #ià!
defšed
(
LZO_ABI_BIG_ENDIAN
è&& !defšed(
LZO_ABI_LITTLE_ENDIAN
è&& !defšed(
LZO_ABI_NEUTRAL_ENDIAN
)

1116 #ià(
LZO_ARCH_AMD64
 || 
LZO_ARCH_CRIS
 || 
LZO_ARCH_I086
 || 
LZO_ARCH_I386
 || 
LZO_ARCH_MSP430
)

1117 
	#LZO_ABI_LITTLE_ENDIAN
 1

	)

1118 #–ià(
LZO_ARCH_M68K
 || 
LZO_ARCH_S390
)

1119 
	#LZO_ABI_BIG_ENDIAN
 1

	)

1120 #–ià1 && 
defšed
(
__BIG_ENDIAN__
è&& !defšed(
__LITTLE_ENDIAN__
)

1121 
	#LZO_ABI_BIG_ENDIAN
 1

	)

1122 #–ià1 && 
defšed
(
__LITTLE_ENDIAN__
è&& !defšed(
__BIG_ENDIAN__
)

1123 
	#LZO_ABI_LITTLE_ENDIAN
 1

	)

1124 #–ià1 && (
LZO_ARCH_MIPS
è&& 
defšed
(
__MIPSEB__
è&& !defšed(
__MIPSEL__
)

1125 
	#LZO_ABI_BIG_ENDIAN
 1

	)

1126 #–ià1 && (
LZO_ARCH_MIPS
è&& 
defšed
(
__MIPSEL__
è&& !defšed(
__MIPSEB__
)

1127 
	#LZO_ABI_LITTLE_ENDIAN
 1

	)

1130 #ià
defšed
(
LZO_ABI_BIG_ENDIAN
è&& defšed(
LZO_ABI_LITTLE_ENDIAN
)

1133 #ià
defšed
(
LZO_ABI_BIG_ENDIAN
)

1134 
	#LZO_INFO_ABI_ENDIAN
 "be"

	)

1135 #–ià
defšed
(
LZO_ABI_LITTLE_ENDIAN
)

1136 
	#LZO_INFO_ABI_ENDIAN
 "Ë"

	)

1137 #–ià
defšed
(
LZO_ABI_NEUTRAL_ENDIAN
)

1138 
	#LZO_INFO_ABI_ENDIAN
 "ÃuŒ®"

	)

1140 #ià(
LZO_SIZEOF_INT
 =ğ1 && 
LZO_SIZEOF_LONG
 =ğ2 && 
LZO_SIZEOF_VOID_P
 == 2)

1141 
	#LZO_ABI_I8LP16
 1

	)

1142 
	#LZO_INFO_ABI_PM
 "i8Í16"

	)

1143 #–ià(
LZO_SIZEOF_INT
 =ğ2 && 
LZO_SIZEOF_LONG
 =ğ2 && 
LZO_SIZEOF_VOID_P
 == 2)

1144 
	#LZO_ABI_ILP16
 1

	)

1145 
	#LZO_INFO_ABI_PM
 "p16"

	)

1146 #–ià(
LZO_SIZEOF_INT
 =ğ4 && 
LZO_SIZEOF_LONG
 =ğ4 && 
LZO_SIZEOF_VOID_P
 == 4)

1147 
	#LZO_ABI_ILP32
 1

	)

1148 
	#LZO_INFO_ABI_PM
 "p32"

	)

1149 #–ià(
LZO_SIZEOF_INT
 =ğ4 && 
LZO_SIZEOF_LONG
 =ğ4 && 
LZO_SIZEOF_VOID_P
 =ğ8 && 
LZO_SIZEOF_SIZE_T
 == 8)

1150 
	#LZO_ABI_LLP64
 1

	)

1151 
	#LZO_INFO_ABI_PM
 "Îp64"

	)

1152 #–ià(
LZO_SIZEOF_INT
 =ğ4 && 
LZO_SIZEOF_LONG
 =ğ8 && 
LZO_SIZEOF_VOID_P
 == 8)

1153 
	#LZO_ABI_LP64
 1

	)

1154 
	#LZO_INFO_ABI_PM
 "Í64"

	)

1155 #–ià(
LZO_SIZEOF_INT
 =ğ8 && 
LZO_SIZEOF_LONG
 =ğ8 && 
LZO_SIZEOF_VOID_P
 == 8)

1156 
	#LZO_ABI_ILP64
 1

	)

1157 
	#LZO_INFO_ABI_PM
 "p64"

	)

1158 #–ià(
LZO_SIZEOF_INT
 =ğ4 && 
LZO_SIZEOF_LONG
 =ğ8 && 
LZO_SIZEOF_VOID_P
 == 4)

1159 
	#LZO_ABI_IP32L64
 1

	)

1160 
	#LZO_INFO_ABI_PM
 "32l64"

	)

1162 #ià!
defšed
(
__LZO_LIBC_OVERRIDE
)

1163 #ià
defšed
(
LZO_LIBC_NAKED
)

1164 
	#LZO_INFO_LIBC
 "Çked"

	)

1165 #–ià
defšed
(
LZO_LIBC_FREESTANDING
)

1166 
	#LZO_INFO_LIBC
 "ä“¡ªdšg"

	)

1167 #–ià
defšed
(
LZO_LIBC_MOSTLY_FREESTANDING
)

1168 
	#LZO_INFO_LIBC
 "mä“¡ªdšg"

	)

1169 #–ià
defšed
(
LZO_LIBC_ISOC90
)

1170 
	#LZO_INFO_LIBC
 "isoc90"

	)

1171 #–ià
defšed
(
LZO_LIBC_ISOC99
)

1172 
	#LZO_INFO_LIBC
 "isoc99"

	)

1173 #–ià
defšed
(
__d›ibc__
)

1174 
	#LZO_LIBC_DIETLIBC
 1

	)

1175 
	#LZO_INFO_LIBC
 "d›ibc"

	)

1176 #–ià
defšed
(
_NEWLIB_VERSION
)

1177 
	#LZO_LIBC_NEWLIB
 1

	)

1178 
	#LZO_INFO_LIBC
 "Ãwlib"

	)

1179 #–ià
defšed
(
__UCLIBC__
è&& defšed(
__UCLIBC_MAJOR__
è&& defšed(
__UCLIBC_MINOR__
)

1180 #ià
defšed
(
__UCLIBC_SUBLEVEL__
)

1181 
	#LZO_LIBC_UCLIBC
 (
__UCLIBC_MAJOR__
 * 0x10000L + 
__UCLIBC_MINOR__
 * 0x100 + 
__UCLIBC_SUBLEVEL__
)

	)

1183 
	#LZO_LIBC_UCLIBC
 0x00090bL

	)

1185 
	#LZO_INFO_LIBC
 "uşibc"

	)

1186 #–ià
defšed
(
__GLIBC__
è&& defšed(
__GLIBC_MINOR__
)

1187 
	#LZO_LIBC_GLIBC
 (
__GLIBC__
 * 0x10000L + 
__GLIBC_MINOR__
 * 0x100)

	)

1188 
	#LZO_INFO_LIBC
 "glibc"

	)

1189 #–ià(
LZO_CC_MWERKS
è&& 
defšed
(
__MSL__
)

1190 
	#LZO_LIBC_MSL
 
__MSL__


	)

1191 
	#LZO_INFO_LIBC
 "m¦"

	)

1193 
	#LZO_LIBC_DEFAULT
 1

	)

1194 
	#LZO_INFO_LIBC
 "deçuÉ"

	)

1197 #ià(
LZO_CC_GNUC
 >= 0x020800ul)

1198 
	#__lzo_gnuc_ex‹nsiÚ__
 
__ex‹nsiÚ__


	)

1199 #–ià(
LZO_CC_LLVM
 || 
LZO_CC_PATHSCALE
)

1200 
	#__lzo_gnuc_ex‹nsiÚ__
 
__ex‹nsiÚ__


	)

1202 
	#__lzo_gnuc_ex‹nsiÚ__


	)

1204 #ià(
LZO_CC_CILLY
 || 
LZO_CC_GNUC
 || 
LZO_CC_LLVM
 || 
LZO_CC_PATHSCALE
 || 
LZO_CC_PGI
)

1205 
	#lzo_®ignof
(
e
è
	`__®ignof__
Ó)

	)

1206 #–ià(
LZO_CC_INTELC
 && (
__INTEL_COMPILER
 >= 700))

1207 
	#lzo_®ignof
(
e
è
	`__®ignof__
Ó)

	)

1208 #–ià(
LZO_CC_MSC
 && (
_MSC_VER
 >= 1300))

1209 
	#lzo_®ignof
(
e
è
	`__®ignof
Ó)

	)

1211 #ià(
LZO_CC_TURBOC
 && (
__TURBOC__
 <= 0x0295))

1212 #–ià
defšed
(
__ılu¥lus
)

1213 
	#__lzo_šlše
 
šlše


	)

1214 #–ià(
LZO_CC_BORLANDC
 && (
__BORLANDC__
 >= 0x0550))

1215 
	#__lzo_šlše
 
__šlše


	)

1216 #–ià(
LZO_CC_CILLY
 || 
LZO_CC_GNUC
 || 
LZO_CC_LLVM
 || 
LZO_CC_PATHSCALE
 || 
LZO_CC_PGI
)

1217 
	#__lzo_šlše
 
__šlše__


	)

1218 #–ià(
LZO_CC_DMC
)

1219 
	#__lzo_šlše
 
__šlše


	)

1220 #–ià(
LZO_CC_INTELC
)

1221 
	#__lzo_šlše
 
__šlše


	)

1222 #–ià(
LZO_CC_MWERKS
 && (
__MWERKS__
 >= 0x2405))

1223 
	#__lzo_šlše
 
__šlše


	)

1224 #–ià(
LZO_CC_MSC
 && (
_MSC_VER
 >= 900))

1225 
	#__lzo_šlše
 
__šlše


	)

1226 #–ià
defšed
(
__STDC_VERSION__
) && (__STDC_VERSION__ >= 199901L)

1227 
	#__lzo_šlše
 
šlše


	)

1229 #ià(
LZO_CC_GNUC
 >= 0x030200ul)

1230 
	#__lzo_fÜûšlše
 
__šlše__
 
	`__©Œibu‹__
((
__®ways_šlše__
))

	)

1231 #–ià(
LZO_CC_INTELC
 && (
__INTEL_COMPILER
 >ğ450è&& (
LZO_OS_WIN32
 || 
LZO_OS_WIN64
))

1232 
	#__lzo_fÜûšlše
 
__fÜûšlše


	)

1233 #–ià(
LZO_CC_INTELC
 && (
__INTEL_COMPILER
 >= 800))

1234 
	#__lzo_fÜûšlše
 
__šlše__
 
	`__©Œibu‹__
((
__®ways_šlše__
))

	)

1235 #–ià(
LZO_CC_LLVM
 || 
LZO_CC_PATHSCALE
)

1236 
	#__lzo_fÜûšlše
 
__šlše__
 
	`__©Œibu‹__
((
__®ways_šlše__
))

	)

1237 #–ià(
LZO_CC_MSC
 && (
_MSC_VER
 >= 1200))

1238 
	#__lzo_fÜûšlše
 
__fÜûšlše


	)

1240 #ià(
LZO_CC_GNUC
 >= 0x030200ul)

1241 
	#__lzo_nošlše
 
	`__©Œibu‹__
((
__nošlše__
))

	)

1242 #–ià(
LZO_CC_INTELC
 && (
__INTEL_COMPILER
 >ğ600è&& (
LZO_OS_WIN32
 || 
LZO_OS_WIN64
))

1243 
	#__lzo_nošlše
 
	`__deş¥ec
(
nošlše
)

	)

1244 #–ià(
LZO_CC_INTELC
 && (
__INTEL_COMPILER
 >= 800))

1245 
	#__lzo_nošlše
 
	`__©Œibu‹__
((
__nošlše__
))

	)

1246 #–ià(
LZO_CC_LLVM
 || 
LZO_CC_PATHSCALE
)

1247 
	#__lzo_nošlše
 
	`__©Œibu‹__
((
__nošlše__
))

	)

1248 #–ià(
LZO_CC_MSC
 && (
_MSC_VER
 >= 1300))

1249 
	#__lzo_nošlše
 
	`__deş¥ec
(
nošlše
)

	)

1250 #–ià(
LZO_CC_MWERKS
 && (
__MWERKS__
 >ğ0x3200è&& (
LZO_OS_WIN32
 || 
LZO_OS_WIN64
))

1251 #ià
defšed
(
__ılu¥lus
)

1253 
	#__lzo_nošlše
 
	`__deş¥ec
(
nošlše
)

	)

1256 #ià(
defšed
(
__lzo_fÜûšlše
è|| defšed(
__lzo_nošlše
)è&& !defšed(
__lzo_šlše
)

1259 #ià(
LZO_CC_GNUC
 >= 0x020700ul)

1260 
	#__lzo_nÜ‘uº
 
	`__©Œibu‹__
((
__nÜ‘uº__
))

	)

1261 #–ià(
LZO_CC_INTELC
 && (
__INTEL_COMPILER
 >ğ450è&& (
LZO_OS_WIN32
 || 
LZO_OS_WIN64
))

1262 
	#__lzo_nÜ‘uº
 
	`__deş¥ec
(
nÜ‘uº
)

	)

1263 #–ià(
LZO_CC_INTELC
 && (
__INTEL_COMPILER
 >ğ600è&& (
LZO_OS_POSIX
))

1264 
	#__lzo_nÜ‘uº
 
	`__©Œibu‹__
((
__nÜ‘uº__
))

	)

1265 #–ià(
LZO_CC_LLVM
 || 
LZO_CC_PATHSCALE
)

1266 
	#__lzo_nÜ‘uº
 
	`__©Œibu‹__
((
__nÜ‘uº__
))

	)

1267 #–ià(
LZO_CC_MSC
 && (
_MSC_VER
 >= 1200))

1268 
	#__lzo_nÜ‘uº
 
	`__deş¥ec
(
nÜ‘uº
)

	)

1270 #ià(
LZO_CC_GNUC
 >= 0x030400ul)

1271 
	#__lzo_cÚ¡ruùÜ
 
	`__©Œibu‹__
((
__cÚ¡ruùÜ__
,
__u£d__
))

	)

1272 #–ià(
LZO_CC_GNUC
 >= 0x020700ul)

1273 
	#__lzo_cÚ¡ruùÜ
 
	`__©Œibu‹__
((
__cÚ¡ruùÜ__
))

	)

1274 #–ià(
LZO_CC_LLVM
 || 
LZO_CC_PATHSCALE
)

1275 
	#__lzo_cÚ¡ruùÜ
 
	`__©Œibu‹__
((
__cÚ¡ruùÜ__
))

	)

1277 #ià(
LZO_CC_GNUC
 >= 0x030400ul)

1278 
	#__lzo_de¡ruùÜ
 
	`__©Œibu‹__
((
__de¡ruùÜ__
,
__u£d__
))

	)

1279 #–ià(
LZO_CC_GNUC
 >= 0x020700ul)

1280 
	#__lzo_de¡ruùÜ
 
	`__©Œibu‹__
((
__de¡ruùÜ__
))

	)

1281 #–ià(
LZO_CC_LLVM
 || 
LZO_CC_PATHSCALE
)

1282 
	#__lzo_de¡ruùÜ
 
	`__©Œibu‹__
((
__de¡ruùÜ__
))

	)

1284 #ià
defšed
(
__lzo_de¡ruùÜ
è&& !defšed(
__lzo_cÚ¡ruùÜ
)

1287 #ià(
LZO_CC_GNUC
 >= 0x030200ul)

1288 
	#__lzo_lik–y
(
e
è(
	`__butš_ex³ù
(!!Ó),1))

	)

1289 
	#__lzo_uÆik–y
(
e
è(
	`__butš_ex³ù
(!!Ó),0))

	)

1290 #–ià(
LZO_CC_INTELC
 && (
__INTEL_COMPILER
 >= 800))

1291 
	#__lzo_lik–y
(
e
è(
	`__butš_ex³ù
(!!Ó),1))

	)

1292 
	#__lzo_uÆik–y
(
e
è(
	`__butš_ex³ù
(!!Ó),0))

	)

1293 #–ià(
LZO_CC_LLVM
 || 
LZO_CC_PATHSCALE
)

1294 
	#__lzo_lik–y
(
e
è(
	`__butš_ex³ù
(!!Ó),1))

	)

1295 
	#__lzo_uÆik–y
(
e
è(
	`__butš_ex³ù
(!!Ó),0))

	)

1297 
	#__lzo_lik–y
(
e
èÓ)

	)

1298 
	#__lzo_uÆik–y
(
e
èÓ)

	)

1300 #ià!
defšed
(
LZO_UNUSED
)

1301 #ià(
LZO_CC_BORLANDC
 && (
__BORLANDC__
 >= 0x0600))

1302 
	#LZO_UNUSED
(
v¬
è((è&v¬)

	)

1303 #–ià(
LZO_CC_BORLANDC
 || 
LZO_CC_HIGHC
 || 
LZO_CC_NDPC
 || 
LZO_CC_PELLESC
 || 
LZO_CC_TURBOC
)

1304 
	#LZO_UNUSED
(
v¬
èià(&v¬è; 

	)

1305 #–ià(
LZO_CC_GNUC
 || 
LZO_CC_LLVM
 || 
LZO_CC_PATHSCALE
)

1306 
	#LZO_UNUSED
(
v¬
è((èv¬)

	)

1307 #–ià(
LZO_CC_MSC
 && (
_MSC_VER
 < 900))

1308 
	#LZO_UNUSED
(
v¬
èià(&v¬è; 

	)

1309 #–ià(
LZO_CC_KEILC
)

1310 
	#LZO_UNUSED
(
v¬
è{
__lzo_unu£d
[1-2*!((v¬)>0)];}

	)

1311 #–ià(
LZO_CC_PACIFICC
)

1312 
	#LZO_UNUSED
(
v¬
è((è(v¬))

	)

1313 #–ià(
LZO_CC_WATCOMC
è&& 
defšed
(
__ılu¥lus
)

1314 
	#LZO_UNUSED
(
v¬
è((èv¬)

	)

1316 
	#LZO_UNUSED
(
v¬
è((è&v¬)

	)

1319 #ià!
defšed
(
LZO_UNUSED_FUNC
)

1320 #ià(
LZO_CC_BORLANDC
 && (
__BORLANDC__
 >= 0x0600))

1321 
	#LZO_UNUSED_FUNC
(
func
è((èfunc)

	)

1322 #–ià(
LZO_CC_BORLANDC
 || 
LZO_CC_NDPC
 || 
LZO_CC_TURBOC
)

1323 
	#LZO_UNUSED_FUNC
(
func
èià(funcè; 

	)

1324 #–ià(
LZO_CC_LLVM
)

1325 
	#LZO_UNUSED_FUNC
(
func
è((è&func)

	)

1326 #–ià(
LZO_CC_MSC
 && (
_MSC_VER
 < 900))

1327 
	#LZO_UNUSED_FUNC
(
func
èià(funcè; 

	)

1328 #–ià(
LZO_CC_MSC
)

1329 
	#LZO_UNUSED_FUNC
(
func
è((è&func)

	)

1330 #–ià(
LZO_CC_KEILC
 || 
LZO_CC_PELLESC
)

1331 
	#LZO_UNUSED_FUNC
(
func
è{
__lzo_unu£d
[1-2*!((()func)>0)];}

	)

1333 
	#LZO_UNUSED_FUNC
(
func
è((èfunc)

	)

1336 #ià!
defšed
(
LZO_UNUSED_LABEL
)

1337 #ià(
LZO_CC_WATCOMC
è&& 
defšed
(
__ılu¥lus
)

1338 
	#LZO_UNUSED_LABEL
(
l
è0è1:
	)
l

1339 #–ià(
LZO_CC_INTELC
 || 
LZO_CC_WATCOMC
)

1340 
	#LZO_UNUSED_LABEL
(
l
èià(0è
	)
l

1342 
	#LZO_UNUSED_LABEL
(
l
è0è1:
	)
l

1345 #ià!
defšed
(
LZO_COMPILE_TIME_ASSERT_HEADER
)

1346 #ià(
LZO_CC_AZTECC
 || 
LZO_CC_ZORTECHC
)

1347 
	#LZO_COMPILE_TIME_ASSERT_HEADER
(
e
è
__lzo_ùa
[1-!Ó)];

	)

1348 #–ià(
LZO_CC_DMC
 || 
LZO_CC_SYMANTECC
)

1349 
	#LZO_COMPILE_TIME_ASSERT_HEADER
(
e
è
__lzo_ùa
[1u-2*!Ó)];

	)

1350 #–ià(
LZO_CC_TURBOC
 && (
__TURBOC__
 == 0x0295))

1351 
	#LZO_COMPILE_TIME_ASSERT_HEADER
(
e
è
__lzo_ùa
[1-!Ó)];

	)

1353 
	#LZO_COMPILE_TIME_ASSERT_HEADER
(
e
è
__lzo_ùa
[1-2*!Ó)];

	)

1356 #ià!
defšed
(
LZO_COMPILE_TIME_ASSERT
)

1357 #ià(
LZO_CC_AZTECC
)

1358 
	#LZO_COMPILE_TIME_ASSERT
(
e
è{
	t__lzo_ùa_t
[1-!Ó)];}

	)

1359 #–ià(
LZO_CC_DMC
 || 
LZO_CC_PACIFICC
 || 
LZO_CC_SYMANTECC
 || 
LZO_CC_ZORTECHC
)

1360 
	#LZO_COMPILE_TIME_ASSERT
(
e
è0è1:!Ó):;

	)

1361 #–ià(
LZO_CC_MSC
 && (
_MSC_VER
 < 900))

1362 
	#LZO_COMPILE_TIME_ASSERT
(
e
è0è1:!Ó):;

	)

1363 #–ià(
LZO_CC_TURBOC
 && (
__TURBOC__
 == 0x0295))

1364 
	#LZO_COMPILE_TIME_ASSERT
(
e
è0è1:!Ó):;

	)

1366 
	#LZO_COMPILE_TIME_ASSERT
(
e
è{
	t__lzo_ùa_t
[1-2*!Ó)];}

	)

1369 #ià(
LZO_ARCH_I086
 || 
LZO_ARCH_I386
è&& (
LZO_OS_DOS16
 || 
LZO_OS_DOS32
 || 
LZO_OS_OS2
 || 
LZO_OS_OS216
 || 
LZO_OS_WIN16
 || 
LZO_OS_WIN32
 || 
LZO_OS_WIN64
)

1370 #ià(
LZO_CC_GNUC
 || 
LZO_CC_HIGHC
 || 
LZO_CC_NDPC
 || 
LZO_CC_PACIFICC
)

1371 #–ià(
LZO_CC_DMC
 || 
LZO_CC_SYMANTECC
 || 
LZO_CC_ZORTECHC
)

1372 
	#__lzo_cdeş
 
__cdeş


	)

1373 
	#__lzo_cdeş_©ex™


	)

1374 
	#__lzo_cdeş_maš
 
__cdeş


	)

1375 #ià(
LZO_OS_OS2
 && (
LZO_CC_DMC
 || 
LZO_CC_SYMANTECC
))

1376 
	#__lzo_cdeş_qsÜt
 
__·sÿl


	)

1377 #–ià(
LZO_OS_OS2
 && (
LZO_CC_ZORTECHC
))

1378 
	#__lzo_cdeş_qsÜt
 
_¡dÿÎ


	)

1380 
	#__lzo_cdeş_qsÜt
 
__cdeş


	)

1382 #–ià(
LZO_CC_WATCOMC
)

1383 
	#__lzo_cdeş
 
__cdeş


	)

1385 
	#__lzo_cdeş
 
__cdeş


	)

1386 
	#__lzo_cdeş_©ex™
 
__cdeş


	)

1387 
	#__lzo_cdeş_maš
 
__cdeş


	)

1388 
	#__lzo_cdeş_qsÜt
 
__cdeş


	)

1390 #ià(
LZO_CC_GNUC
 || 
LZO_CC_HIGHC
 || 
LZO_CC_NDPC
 || 
LZO_CC_PACIFICC
 || 
LZO_CC_WATCOMC
)

1391 #–ià(
LZO_OS_OS2
 && (
LZO_CC_DMC
 || 
LZO_CC_SYMANTECC
))

1392 
	#__lzo_cdeş_sighªdËr
 
__·sÿl


	)

1393 #–ià(
LZO_OS_OS2
 && (
LZO_CC_ZORTECHC
))

1394 
	#__lzo_cdeş_sighªdËr
 
_¡dÿÎ


	)

1395 #–ià(
LZO_CC_MSC
 && (
_MSC_VER
 >ğ1400)è&& 
defšed
(
_M_CEE_PURE
)

1396 
	#__lzo_cdeş_sighªdËr
 
__şrÿÎ


	)

1397 #–ià(
LZO_CC_MSC
 && (
_MSC_VER
 >= 600 && _MSC_VER < 700))

1398 #ià
defšed
(
_DLL
)

1399 
	#__lzo_cdeş_sighªdËr
 
_çr
 
_cdeş
 
_lßdds


	)

1400 #–ià
defšed
(
_MT
)

1401 
	#__lzo_cdeş_sighªdËr
 
_çr
 
_cdeş


	)

1403 
	#__lzo_cdeş_sighªdËr
 
_cdeş


	)

1406 
	#__lzo_cdeş_sighªdËr
 
__cdeş


	)

1408 #–ià(
LZO_ARCH_M68K
 && 
LZO_OS_TOS
 && (
LZO_CC_PUREC
 || 
LZO_CC_TURBOC
))

1409 
	#__lzo_cdeş
 
cdeş


	)

1411 #ià!
defšed
(
__lzo_cdeş
)

1412 
	#__lzo_cdeş


	)

1414 #ià!
defšed
(
__lzo_cdeş_©ex™
)

1415 
	#__lzo_cdeş_©ex™


	)

1417 #ià!
defšed
(
__lzo_cdeş_maš
)

1418 
	#__lzo_cdeş_maš


	)

1420 #ià!
defšed
(
__lzo_cdeş_qsÜt
)

1421 
	#__lzo_cdeş_qsÜt


	)

1423 #ià!
defšed
(
__lzo_cdeş_sighªdËr
)

1424 
	#__lzo_cdeş_sighªdËr


	)

1426 #ià!
defšed
(
__lzo_cdeş_va
)

1427 
	#__lzo_cdeş_va
 
__lzo_cdeş


	)

1429 #ià(
LZO_OS_CYGWIN
 || (
LZO_OS_EMX
 && 
defšed
(
__RSXNT__
)è|| 
LZO_OS_WIN32
 || 
LZO_OS_WIN64
)

1430 #ià(
LZO_CC_WATCOMC
 && (
__WATCOMC__
 < 1000))

1431 #–ià(
LZO_OS_WIN32
 && 
LZO_CC_GNUC
è&& 
defšed
(
__PW32__
)

1432 #–ià((
LZO_OS_CYGWIN
 || 
defšed
(
__MINGW32__
)è&& (
LZO_CC_GNUC
 && (LZO_CC_GNUC < 0x025f00ul)))

1434 
	#LZO_HAVE_WINDOWS_H
 1

	)

1437 #ià(
LZO_ARCH_ALPHA
)

1438 
	#LZO_OPT_AVOID_UINT_INDEX
 1

	)

1439 
	#LZO_OPT_AVOID_SHORT
 1

	)

1440 
	#LZO_OPT_AVOID_USHORT
 1

	)

1441 #–ià(
LZO_ARCH_AMD64
)

1442 
	#LZO_OPT_AVOID_INT_INDEX
 1

	)

1443 
	#LZO_OPT_AVOID_UINT_INDEX
 1

	)

1444 
	#LZO_OPT_UNALIGNED16
 1

	)

1445 
	#LZO_OPT_UNALIGNED32
 1

	)

1446 
	#LZO_OPT_UNALIGNED64
 1

	)

1447 #–ià(
LZO_ARCH_ARM
 && 
LZO_ARCH_ARM_THUMB
)

1448 #–ià(
LZO_ARCH_ARM
)

1449 
	#LZO_OPT_AVOID_SHORT
 1

	)

1450 
	#LZO_OPT_AVOID_USHORT
 1

	)

1451 #–ià(
LZO_ARCH_CRIS
)

1452 
	#LZO_OPT_UNALIGNED16
 1

	)

1453 
	#LZO_OPT_UNALIGNED32
 1

	)

1454 #–ià(
LZO_ARCH_I386
)

1455 
	#LZO_OPT_UNALIGNED16
 1

	)

1456 
	#LZO_OPT_UNALIGNED32
 1

	)

1457 #–ià(
LZO_ARCH_IA64
)

1458 
	#LZO_OPT_AVOID_INT_INDEX
 1

	)

1459 
	#LZO_OPT_AVOID_UINT_INDEX
 1

	)

1460 
	#LZO_OPT_PREFER_POSTINC
 1

	)

1461 #–ià(
LZO_ARCH_M68K
)

1462 
	#LZO_OPT_PREFER_POSTINC
 1

	)

1463 
	#LZO_OPT_PREFER_PREDEC
 1

	)

1464 #ià
defšed
(
__mc68020__
è&& !defšed(
__mcŞdfœe__
)

1465 
	#LZO_OPT_UNALIGNED16
 1

	)

1466 
	#LZO_OPT_UNALIGNED32
 1

	)

1468 #–ià(
LZO_ARCH_MIPS
)

1469 
	#LZO_OPT_AVOID_UINT_INDEX
 1

	)

1470 #–ià(
LZO_ARCH_POWERPC
)

1471 
	#LZO_OPT_PREFER_PREINC
 1

	)

1472 
	#LZO_OPT_PREFER_PREDEC
 1

	)

1473 #ià
defšed
(
LZO_ABI_BIG_ENDIAN
)

1474 
	#LZO_OPT_UNALIGNED16
 1

	)

1475 
	#LZO_OPT_UNALIGNED32
 1

	)

1477 #–ià(
LZO_ARCH_S390
)

1478 
	#LZO_OPT_UNALIGNED16
 1

	)

1479 
	#LZO_OPT_UNALIGNED32
 1

	)

1480 #ià(
LZO_SIZEOF_SIZE_T
 == 8)

1481 
	#LZO_OPT_UNALIGNED64
 1

	)

1483 #–ià(
LZO_ARCH_SH
)

1484 
	#LZO_OPT_PREFER_POSTINC
 1

	)

1485 
	#LZO_OPT_PREFER_PREDEC
 1

	)

1487 #ià!
defšed
(
LZO_CFG_NO_INLINE_ASM
)

1488 #ià
defšed
(
LZO_CC_LLVM
)

1489 
	#LZO_CFG_NO_INLINE_ASM
 1

	)

1492 #ià!
defšed
(
LZO_CFG_NO_UNALIGNED
)

1493 #ià
defšed
(
LZO_ABI_NEUTRAL_ENDIAN
è|| defšed(
LZO_ARCH_GENERIC
)

1494 
	#LZO_CFG_NO_UNALIGNED
 1

	)

1497 #ià
defšed
(
LZO_CFG_NO_UNALIGNED
)

1498 #undeà
LZO_OPT_UNALIGNED16


1499 #undeà
LZO_OPT_UNALIGNED32


1500 #undeà
LZO_OPT_UNALIGNED64


1502 #ià
defšed
(
LZO_CFG_NO_INLINE_ASM
)

1503 #–ià(
LZO_ARCH_I386
 && (
LZO_OS_DOS32
 || 
LZO_OS_WIN32
è&& (
LZO_CC_DMC
 || 
LZO_CC_INTELC
 || 
LZO_CC_MSC
 || 
LZO_CC_PELLESC
))

1504 
	#LZO_ASM_SYNTAX_MSC
 1

	)

1505 #–ià(
LZO_OS_WIN64
 && (
LZO_CC_DMC
 || 
LZO_CC_INTELC
 || 
LZO_CC_MSC
 || 
LZO_CC_PELLESC
))

1506 #–ià(
LZO_ARCH_I386
 && (
LZO_CC_GNUC
 || 
LZO_CC_INTELC
 || 
LZO_CC_PATHSCALE
))

1507 
	#LZO_ASM_SYNTAX_GNUC
 1

	)

1508 #–ià(
LZO_ARCH_AMD64
 && (
LZO_CC_GNUC
 || 
LZO_CC_INTELC
 || 
LZO_CC_PATHSCALE
))

1509 
	#LZO_ASM_SYNTAX_GNUC
 1

	)

1511 #ià(
LZO_ASM_SYNTAX_GNUC
)

1512 #ià(
LZO_ARCH_I386
 && 
LZO_CC_GNUC
 && (LZO_CC_GNUC < 0x020000ul))

1513 
	#__LZO_ASM_CLOBBER
 "ax"

	)

1514 #–ià(
LZO_CC_INTELC
)

1515 
	#__LZO_ASM_CLOBBER
 "memÜy"

	)

1517 
	#__LZO_ASM_CLOBBER
 "cc", "memÜy"

	)

1520 #ià
defšed
(
__LZO_INFOSTR_MM
)

1521 #–ià(
LZO_MM_FLAT
è&& (
defšed
(
__LZO_INFOSTR_PM
è|| defšed(
LZO_INFO_ABI_PM
))

1522 
	#__LZO_INFOSTR_MM
 ""

	)

1523 #–ià
defšed
(
LZO_INFO_MM
)

1524 
	#__LZO_INFOSTR_MM
 "." 
LZO_INFO_MM


	)

1526 
	#__LZO_INFOSTR_MM
 ""

	)

1528 #ià
defšed
(
__LZO_INFOSTR_PM
)

1529 #–ià
defšed
(
LZO_INFO_ABI_PM
)

1530 
	#__LZO_INFOSTR_PM
 "." 
LZO_INFO_ABI_PM


	)

1532 
	#__LZO_INFOSTR_PM
 ""

	)

1534 #ià
defšed
(
__LZO_INFOSTR_ENDIAN
)

1535 #–ià
defšed
(
LZO_INFO_ABI_ENDIAN
)

1536 
	#__LZO_INFOSTR_ENDIAN
 "." 
LZO_INFO_ABI_ENDIAN


	)

1538 
	#__LZO_INFOSTR_ENDIAN
 ""

	)

1540 #ià
defšed
(
__LZO_INFOSTR_OSNAME
)

1541 #–ià
defšed
(
LZO_INFO_OS_CONSOLE
)

1542 
	#__LZO_INFOSTR_OSNAME
 
LZO_INFO_OS
 "." 
LZO_INFO_OS_CONSOLE


	)

1543 #–ià
defšed
(
LZO_INFO_OS_POSIX
)

1544 
	#__LZO_INFOSTR_OSNAME
 
LZO_INFO_OS
 "." 
LZO_INFO_OS_POSIX


	)

1546 
	#__LZO_INFOSTR_OSNAME
 
LZO_INFO_OS


	)

1548 #ià
defšed
(
__LZO_INFOSTR_LIBC
)

1549 #–ià
defšed
(
LZO_INFO_LIBC
)

1550 
	#__LZO_INFOSTR_LIBC
 "." 
LZO_INFO_LIBC


	)

1552 
	#__LZO_INFOSTR_LIBC
 ""

	)

1554 #ià
defšed
(
__LZO_INFOSTR_CCVER
)

1555 #–ià
defšed
(
LZO_INFO_CCVER
)

1556 
	#__LZO_INFOSTR_CCVER
 " " 
LZO_INFO_CCVER


	)

1558 
	#__LZO_INFOSTR_CCVER
 ""

	)

1560 
	#LZO_INFO_STRING
 \

1561 
LZO_INFO_ARCH
 
__LZO_INFOSTR_MM
 
__LZO_INFOSTR_PM
 
__LZO_INFOSTR_ENDIAN
 \

1562 " " 
__LZO_INFOSTR_OSNAME
 
__LZO_INFOSTR_LIBC
 " " 
LZO_INFO_CC
 
__LZO_INFOSTR_CCVER


	)

1568 #undeà
LZO_HAVE_CONFIG_H


1569 
	~"mšzo.h
"

1571 #ià!
defšed
(
MINILZO_VERSION
) || (MINILZO_VERSION != 0x2020)

1575 #ifdeà
MINILZO_HAVE_CONFIG_H


1576 
	#LZO_HAVE_CONFIG_H


	)

1579 #iâdeà
__LZO_CONF_H


1580 
	#__LZO_CONF_H


	)

1582 #ià!
defšed
(
__LZO_IN_MINILZO
)

1583 #ià
defšed
(
LZO_CFG_FREESTANDING
)

1584 
	#LZO_LIBC_FREESTANDING
 1

	)

1585 
	#LZO_OS_FREESTANDING
 1

	)

1586 
	#ACC_LIBC_FREESTANDING
 1

	)

1587 
	#ACC_OS_FREESTANDING
 1

	)

1589 #ià
defšed
(
LZO_CFG_NO_UNALIGNED
)

1590 
	#ACC_CFG_NO_UNALIGNED
 1

	)

1592 #ià
defšed
(
LZO_HAVE_CONFIG_H
)

1593 
	#ACC_CONFIG_NO_HEADER
 1

	)

1595 #ià
defšed
(
__LZOCONF_H
è|| defšed(
__LZOCONF_H_INCLUDED
)

1598 
	~"lzo/lzocÚf.h
"

1601 #ià(
LZO_VERSION
 < 0x02000è|| !
defšed
(
__LZOCONF_H_INCLUDED
)

1605 #ià(
LZO_CC_BORLANDC
 && 
LZO_ARCH_I086
)

1606 #´agm¨
İtiÚ
 -
h


1609 #ià(
LZO_CC_MSC
 && (
_MSC_VER
 >= 1000))

1610 #´agm¨
w¬nšg
(
di§bË
: 4127 4701)

1612 #ià(
LZO_CC_MSC
 && (
_MSC_VER
 >= 1300))

1613 #´agm¨
w¬nšg
(
di§bË
: 4820)

1614 #´agm¨
w¬nšg
(
di§bË
: 4514 4710 4711)

1617 #ià
defšed
(
__LZO_MMODEL_HUGE
è&& (!
LZO_HAVE_MM_HUGE_PTR
)

1621 #ià
defšed
(
__LZO_IN_MINILZO
è|| defšed(
LZO_CFG_FREESTANDING
)

1622 #–ià(
LZO_OS_DOS16
 || 
LZO_OS_OS216
 || 
LZO_OS_WIN16
)

1623 
	#ACC_WANT_ACC_INCD_H
 1

	)

1624 
	#ACC_WANT_ACC_INCE_H
 1

	)

1625 
	#ACC_WANT_ACC_INCI_H
 1

	)

1627 
	~<¡ršg.h
>

1629 
	#ACC_WANT_ACC_INCD_H
 1

	)

1632 #ià(
LZO_ARCH_I086
)

1633 
	#ACC_MM_AHSHIFT
 
LZO_MM_AHSHIFT


	)

1634 
	#ACC_PTR_FP_OFF
(
x
è(((cÚ¡ 
__çr
*)&(x))[0])

	)

1635 
	#ACC_PTR_FP_SEG
(
x
è(((cÚ¡ 
__çr
*)&(x))[1])

	)

1636 
	#ACC_PTR_MK_FP
(
s
,
o
è((
__çr
*)((()(s)<<16)+()(o)))

	)

1639 #ià!
defšed
(
lzo_ušŒ_t
)

1640 #ià
defšed
(
__LZO_MMODEL_HUGE
)

1641 
	#lzo_ušŒ_t
 

	)

1642 #–ià1 && 
defšed
(
LZO_OS_OS400
è&& (
LZO_SIZEOF_VOID_P
 == 16)

1643 
	#__LZO_UINTPTR_T_IS_POINTER
 1

	)

1644 * 
	tlzo_ušŒ_t
;

1645 
	#lzo_ušŒ_t
 
lzo_ušŒ_t


	)

1646 #–ià(
LZO_SIZEOF_SIZE_T
 =ğ
LZO_SIZEOF_VOID_P
)

1647 
	#lzo_ušŒ_t
 
size_t


	)

1648 #–ià(
LZO_SIZEOF_LONG
 =ğ
LZO_SIZEOF_VOID_P
)

1649 
	#lzo_ušŒ_t
 

	)

1650 #–ià(
LZO_SIZEOF_INT
 =ğ
LZO_SIZEOF_VOID_P
)

1651 
	#lzo_ušŒ_t
 

	)

1652 #–ià(
LZO_SIZEOF_LONG_LONG
 =ğ
LZO_SIZEOF_VOID_P
)

1653 
	#lzo_ušŒ_t
 

	)

1655 
	#lzo_ušŒ_t
 
size_t


	)

1658 
LZO_COMPILE_TIME_ASSERT_HEADER
((
lzo_ušŒ_t
è>ğ(
lzo_voidp
))

1660 #ià1 && !
	`defšed
(
LZO_CFG_FREESTANDING
)

1661 #ià1 && !
	`defšed
(
HAVE_STRING_H
)

1662 
	#HAVE_STRING_H
 1

	)

1664 #ià1 && !
	`defšed
(
HAVE_MEMCMP
)

1665 
	#HAVE_MEMCMP
 1

	)

1667 #ià1 && !
	`defšed
(
HAVE_MEMCPY
)

1668 
	#HAVE_MEMCPY
 1

	)

1670 #ià1 && !
	`defšed
(
HAVE_MEMMOVE
)

1671 
	#HAVE_MEMMOVE
 1

	)

1673 #ià1 && !
	`defšed
(
HAVE_MEMSET
)

1674 
	#HAVE_MEMSET
 1

	)

1678 #ià1 && 
	`defšed
(
HAVE_STRING_H
)

1679 
	~<¡ršg.h
>

1682 #ià
	`defšed
(
LZO_CFG_FREESTANDING
)

1683 #undeà
HAVE_MEMCMP


1684 #undeà
HAVE_MEMCPY


1685 #undeà
HAVE_MEMMOVE


1686 #undeà
HAVE_MEMSET


1689 #ià!
	`defšed
(
HAVE_MEMCMP
)

1690 #undeà
memcmp


1691 
	#memcmp
(
a
,
b
,
c
è
	`lzo_memcmp
×,b,c)

	)

1692 #–ià!
	`defšed
(
__LZO_MMODEL_HUGE
)

1693 
	#lzo_memcmp
(
a
,
b
,
c
è
	`memcmp
×,b,c)

	)

1695 #ià!
	`defšed
(
HAVE_MEMCPY
)

1696 #undeà
memıy


1697 
	#memıy
(
a
,
b
,
c
è
	`lzo_memıy
×,b,c)

	)

1698 #–ià!
	`defšed
(
__LZO_MMODEL_HUGE
)

1699 
	#lzo_memıy
(
a
,
b
,
c
è
	`memıy
×,b,c)

	)

1701 #ià!
	`defšed
(
HAVE_MEMMOVE
)

1702 #undeà
memmove


1703 
	#memmove
(
a
,
b
,
c
è
	`lzo_memmove
×,b,c)

	)

1704 #–ià!
	`defšed
(
__LZO_MMODEL_HUGE
)

1705 
	#lzo_memmove
(
a
,
b
,
c
è
	`memmove
×,b,c)

	)

1707 #ià!
	`defšed
(
HAVE_MEMSET
)

1708 #undeà
mem£t


1709 
	#mem£t
(
a
,
b
,
c
è
	`lzo_mem£t
×,b,c)

	)

1710 #–ià!
	`defšed
(
__LZO_MMODEL_HUGE
)

1711 
	#lzo_mem£t
(
a
,
b
,
c
è
	`mem£t
×,b,c)

	)

1714 #undeà
NDEBUG


1715 #ià
	`defšed
(
LZO_CFG_FREESTANDING
)

1716 #undeà
LZO_DEBUG


1717 
	#NDEBUG
 1

	)

1718 #undeà
as£¹


1719 
	#as£¹
(
e
è(()0)

	)

1721 #ià!
	`defšed
(
LZO_DEBUG
)

1722 
	#NDEBUG
 1

	)

1724 
	~<as£¹.h
>

1727 #ià0 && 
	`defšed
(
__BOUNDS_CHECKING_ON
)

1728 
	~<unchecked.h
>

1730 
	#BOUNDS_CHECKING_OFF_DURING
(
¡mt
è
	)
stmt

1731 
	#BOUNDS_CHECKING_OFF_IN_EXPR
(
ex´
èÓx´)

	)

1734 #ià!
	`defšed
(
__lzo_šlše
)

1735 
	#__lzo_šlše


	)

1737 #ià!
	`defšed
(
__lzo_fÜûšlše
)

1738 
	#__lzo_fÜûšlše


	)

1740 #ià!
	`defšed
(
__lzo_nošlše
)

1741 
	#__lzo_nošlše


	)

1745 
	#LZO_BYTE
(
x
è((è(x))

	)

1747 
	#LZO_BYTE
(
x
è((è((xè& 0xff))

	)

1750 
	#LZO_MAX
(
a
,
b
è(×è>ğ(bè? (aè: (b))

	)

1751 
	#LZO_MIN
(
a
,
b
è(×è<ğ(bè? (aè: (b))

	)

1752 
	#LZO_MAX3
(
a
,
b
,
c
è(×è>ğ(bè? 
	`LZO_MAX
×,cè: LZO_MAX(b,c))

	)

1753 
	#LZO_MIN3
(
a
,
b
,
c
è(×è<ğ(bè? 
	`LZO_MIN
×,cè: LZO_MIN(b,c))

	)

1755 
	#lzo_sizeof
(
ty³
è((
lzo_ušt
è(Ñy³)))

	)

1757 
	#LZO_HIGH
(
¬¿y
è((
lzo_ušt
è(×¼ay)/(*×¼ay))))

	)

1759 
	#LZO_SIZE
(
b™s
è(1u << (b™s))

	)

1760 
	#LZO_MASK
(
b™s
è(
	`LZO_SIZE
(b™sè- 1)

	)

1762 
	#LZO_LSIZE
(
b™s
è(1uÈ<< (b™s))

	)

1763 
	#LZO_LMASK
(
b™s
è(
	`LZO_LSIZE
(b™sè- 1)

	)

1765 
	#LZO_USIZE
(
b™s
è((
lzo_ušt
è1 << (b™s))

	)

1766 
	#LZO_UMASK
(
b™s
è(
	`LZO_USIZE
(b™sè- 1)

	)

1768 #ià!
	`defšed
(
DMUL
)

1771 
	#DMUL
(
a
,
b
è((
lzo_xšt
è((
lzo_ušt32
)×è* (lzo_ušt32)(b)))

	)

1773 
	#DMUL
(
a
,
b
è((
lzo_xšt
è(×è* (b)))

	)

1777 #ià1 && !
	`defšed
(
LZO_CFG_NO_UNALIGNED
)

1778 #ià1 && (
LZO_ARCH_AMD64
 || 
LZO_ARCH_I386
)

1779 #ià(
LZO_SIZEOF_SHORT
 == 2)

1780 
	#LZO_UNALIGNED_OK_2


	)

1782 #ià(
LZO_SIZEOF_INT
 == 4)

1783 
	#LZO_UNALIGNED_OK_4


	)

1788 #ià
	`defšed
(
LZO_UNALIGNED_OK_2
)

1789 
	`LZO_COMPILE_TIME_ASSERT_HEADER
(() == 2)

1791 #ià
	`defšed
(
LZO_UNALIGNED_OK_4
)

1792 
	`LZO_COMPILE_TIME_ASSERT_HEADER
((
lzo_ušt32
) == 4)

1793 #–ià
	`defšed
(
LZO_ALIGNED_OK_4
)

1794 
	`LZO_COMPILE_TIME_ASSERT_HEADER
((
lzo_ušt32
) == 4)

1797 
	#MEMCPY8_DS
(
de¡
,
¤c
,
Ën
) \

1798 
	`lzo_memıy
(
de¡
,
¤c
,
Ën
); de¡ +ğËn; srø+ğ
	)
len

1800 
	#BZERO8_PTR
(
s
,
l
,
n
) \

1801 
	`lzo_mem£t
((
lzo_voidp
)(
s
),0,(
lzo_ušt
)(
l
)*(
n
))

	)

1803 
	#MEMCPY_DS
(
de¡
,
¤c
,
Ën
) \

1804 dØ*
de¡
++ = *
¤c
++; --
Ën
 > 0)

	)

1806 
__LZO_EXTERN_C
 
__lzo_š™_dÚe
;

1807 
__LZO_EXTERN_C
 cÚ¡ 
__lzo_cİyright
[];

1808 
	$LZO_EXTERN
(cÚ¡ 
lzo_by‹p
è
	`lzo_cİyright
();

1810 #iâdeà
__LZO_PTR_H


1811 
	#__LZO_PTR_H


	)

1813 #ifdeà
__ılu¥lus


1817 #ià!
	`defšed
(
lzo_ušŒ_t
)

1818 #ià
	`defšed
(
__LZO_MMODEL_HUGE
)

1819 
	#lzo_ušŒ_t
 

	)

1821 
	#lzo_ušŒ_t
 
acc_ušŒ_t


	)

1822 #ifdeà
__ACC_INTPTR_T_IS_POINTER


1823 
	#__LZO_UINTPTR_T_IS_POINTER
 1

	)

1828 #ià(
LZO_ARCH_I086
)

1829 
	#PTR
(
a
è((
lzo_by‹p
è×))

	)

1830 
	#PTR_ALIGNED_4
(
a
è((
	`ACC_PTR_FP_OFF
×è& 3è=ğ0)

	)

1831 
	#PTR_ALIGNED2_4
(
a
,
b
è(((
	`ACC_PTR_FP_OFF
×è| ACC_PTR_FP_OFF(b)è& 3è=ğ0)

	)

1833 
	#PTR
(
a
è((
lzo_ušŒ_t
è×))

	)

1834 
	#PTR_LINEAR
(
a
è
	`PTR
×)

	)

1835 
	#PTR_ALIGNED_4
(
a
è((
	`PTR_LINEAR
×è& 3è=ğ0)

	)

1836 
	#PTR_ALIGNED_8
(
a
è((
	`PTR_LINEAR
×è& 7è=ğ0)

	)

1837 
	#PTR_ALIGNED2_4
(
a
,
b
è(((
	`PTR_LINEAR
×è| PTR_LINEAR(b)è& 3è=ğ0)

	)

1838 
	#PTR_ALIGNED2_8
(
a
,
b
è(((
	`PTR_LINEAR
×è| PTR_LINEAR(b)è& 7è=ğ0)

	)

1841 
	#PTR_LT
(
a
,
b
è(
	`PTR
×è< PTR(b))

	)

1842 
	#PTR_GE
(
a
,
b
è(
	`PTR
×è>ğPTR(b))

	)

1843 
	#PTR_DIFF
(
a
,
b
è(
	`PTR
×è- PTR(b))

	)

1844 
	#pd
(
a
,
b
è((
lzo_ušt
è(×)-(b)))

	)

1846 
	`LZO_EXTERN
(
lzo_ušŒ_t
)

1847 
	`__lzo_±r_lš—r
(cÚ¡ 
lzo_voidp
 
±r
);

1851 
a_ch¬
;

1852 
a_uch¬
;

1853 
a_shÜt
;

1854 
a_ushÜt
;

1855 
a_št
;

1856 
a_ušt
;

1857 
a_lÚg
;

1858 
a_ulÚg
;

1859 
lzo_št
 
a_lzo_št
;

1860 
lzo_ušt
 
a_lzo_ušt
;

1861 
lzo_št32
 
a_lzo_št32
;

1862 
lzo_ušt32
 
a_lzo_ušt32
;

1863 
±rdiff_t
 
a_±rdiff_t
;

1864 
lzo_ušŒ_t
 
a_lzo_ušŒ_t
;

1865 
lzo_voidp
 
a_lzo_voidp
;

1866 * 
a_void_p
;

1867 
lzo_by‹p
 
a_lzo_by‹p
;

1868 
lzo_by‹µ
 
a_lzo_by‹µ
;

1869 
lzo_uš
 
a_lzo_uš
;

1870 
lzo_ušt
 * 
a_lzo_ušt_p
;

1871 
lzo_ušt32p
 
a_lzo_ušt32p
;

1872 
lzo_ušt32
 * 
a_lzo_ušt32_p
;

1873 * 
a_uch¬_p
;

1874 * 
a_ch¬_p
;

1876 
	tlzo_fuÎ_®ign_t
;

1878 #ifdeà
__ılu¥lus


1879 
	}
}

1884 
	#LZO_DETERMINISTIC


	)

1886 
	#LZO_DICT_USE_PTR


	)

1887 #ià0 && (
LZO_ARCH_I086
)

1888 #undeà
LZO_DICT_USE_PTR


1891 #ià
defšed
(
LZO_DICT_USE_PTR
)

1892 
	#lzo_diù_t
 cÚ¡ 
lzo_by‹p


	)

1893 
	#lzo_diù_p
 
lzo_diù_t
 
__LZO_MMODEL
 *

	)

1895 
	#lzo_diù_t
 
lzo_ušt


	)

1896 
	#lzo_diù_p
 
lzo_diù_t
 
__LZO_MMODEL
 *

	)

1901 #ià!
defšed
(
MINILZO_CFG_SKIP_LZO_PTR
)

1903 
	$LZO_PUBLIC
(
lzo_ušŒ_t
)

1904 
	$__lzo_±r_lš—r
(cÚ¡ 
lzo_voidp
 
±r
)

1906 
lzo_ušŒ_t
 
p
;

1908 #ià(
LZO_ARCH_I086
)

1909 
p
 = (((
lzo_ušŒ_t
)(
	`ACC_PTR_FP_SEG
(
±r
))è<< (16 - 
ACC_MM_AHSHIFT
)è+ (
	`ACC_PTR_FP_OFF
(ptr));

1911 
p
 = (
lzo_ušŒ_t
è
	`PTR_LINEAR
(
±r
);

1914  
p
;

1915 
	}
}

1917 
	$LZO_PUBLIC
()

1918 
	$__lzo_®ign_g­
(cÚ¡ 
lzo_voidp
 
±r
, 
lzo_ušt
 
size
)

1920 #ià
	`defšed
(
__LZO_UINTPTR_T_IS_POINTER
)

1921 
size_t
 
n
 = (size_tè
±r
;

1922 
n
 = ((Ò + 
size
 - 1) / size) * size) -‚;

1924 
lzo_ušŒ_t
 
p
, 
n
;

1925 
p
 = 
	`__lzo_±r_lš—r
(
±r
);

1926 
n
 = (((
p
 + 
size
 - 1) / size) * size) -…;

1929 
	`as£¹
(
size
 > 0);

1930 
	`as£¹
(()
n
 >= 0);

1931 
	`as£¹
(
n
 <ğ
s
);

1932  ()
n
;

1933 
	}
}

1941 cÚ¡ 
__lzo_cİyright
[] =

1942 #ià!
defšed
(
__LZO_IN_MINLZO
)

1943 
LZO_VERSION_STRING
;

1950 "$Id: LZO v”siÚ: v" 
	gLZO_VERSION_STRING
 ", " 
	gLZO_VERSION_DATE
 " $\n"

1951 "$But: " 
	g__DATE__
 " " 
	g__TIME__
 " $\n"

1952 "$Info: " 
	gLZO_INFO_STRING
 " $\n";

1955 
	$LZO_PUBLIC
(cÚ¡ 
lzo_by‹p
)

1956 
	$lzo_cİyright
()

1958 #ià(
LZO_OS_DOS16
 && 
LZO_CC_TURBOC
)

1959  (
lzo_voidp
è
__lzo_cİyright
;

1961  (cÚ¡ 
lzo_by‹p
è
__lzo_cİyright
;

1963 
	}
}

1965 
	$LZO_PUBLIC
()

1966 
	$lzo_v”siÚ
()

1968  
LZO_VERSION
;

1969 
	}
}

1971 
	$LZO_PUBLIC
(const *)

1972 
	$lzo_v”siÚ_¡ršg
()

1974  
LZO_VERSION_STRING
;

1975 
	}
}

1977 
	$LZO_PUBLIC
(const *)

1978 
	$lzo_v”siÚ_d©e
()

1980  
LZO_VERSION_DATE
;

1981 
	}
}

1983 
	$LZO_PUBLIC
(cÚ¡ 
lzo_ch¬p
)

1984 
	$_lzo_v”siÚ_¡ršg
()

1986  
LZO_VERSION_STRING
;

1987 
	}
}

1989 
	$LZO_PUBLIC
(cÚ¡ 
lzo_ch¬p
)

1990 
	$_lzo_v”siÚ_d©e
()

1992  
LZO_VERSION_DATE
;

1993 
	}
}

1995 
	#LZO_BASE
 65521u

	)

1996 
	#LZO_NMAX
 5552

	)

1998 
	#LZO_DO1
(
buf
,
i
è
s1
 +ğbuf[i]; 
s2
 +ğ
	)
s1

1999 
	#LZO_DO2
(
buf
,
i
è
	`LZO_DO1
(buf,i); LZO_DO1(buf,i+1);

	)

2000 
	#LZO_DO4
(
buf
,
i
è
	`LZO_DO2
(buf,i); LZO_DO2(buf,i+2);

	)

2001 
	#LZO_DO8
(
buf
,
i
è
	`LZO_DO4
(buf,i); LZO_DO4(buf,i+4);

	)

2002 
	#LZO_DO16
(
buf
,
i
è
	`LZO_DO8
(buf,i); LZO_DO8(buf,i+8);

	)

2004 
	$LZO_PUBLIC
(
lzo_ušt32
)

2005 
	$lzo_adËr32
(
lzo_ušt32
 
adËr
, cÚ¡ 
lzo_by‹p
 
buf
, 
lzo_ušt
 
Ën
)

2007 
lzo_ušt32
 
s1
 = 
adËr
 & 0xffff;

2008 
lzo_ušt32
 
s2
 = (
adËr
 >> 16) & 0xffff;

2009 
k
;

2011 ià(
buf
 =ğ
NULL
)

2014 
Ën
 > 0)

2016 
k
 = 
Ën
 < 
LZO_NMAX
 ? ()†en : LZO_NMAX;

2017 
Ën
 -ğ
k
;

2018 ià(
k
 >= 16) do

2020 
	`LZO_DO16
(
buf
,0);

2021 
buf
 += 16;

2022 
k
 -= 16;

2023 } 
k
 >= 16);

2024 ià(
k
 != 0) do

2026 
s1
 +ğ*
buf
++;

2027 
s2
 +ğ
s1
;

2028 } --
k
 > 0);

2029 
s1
 %ğ
LZO_BASE
;

2030 
s2
 %ğ
LZO_BASE
;

2032  (
s2
 << 16è| 
s1
;

2033 
	}
}

2035 #undeà
LZO_DO1


2036 #undeà
LZO_DO2


2037 #undeà
LZO_DO4


2038 #undeà
LZO_DO8


2039 #undeà
LZO_DO16


2041 #ià!
defšed
(
MINILZO_CFG_SKIP_LZO_STRING
)

2042 #undeà
lzo_memcmp


2043 #undeà
lzo_memıy


2044 #undeà
lzo_memmove


2045 #undeà
lzo_mem£t


2046 #ià!
defšed
(
__LZO_MMODEL_HUGE
)

2047 #undeà
LZO_HAVE_MM_HUGE_PTR


2049 
	#lzo_hsize_t
 
lzo_ušt


	)

2050 
	#lzo_hvoid_p
 
lzo_voidp


	)

2051 
	#lzo_hby‹_p
 
lzo_by‹p


	)

2052 
	#LZOLIB_PUBLIC
(
r
,
f
è
	`LZO_PUBLIC
Ôè
	)
f

2053 
	#lzo_hmemcmp
 
lzo_memcmp


	)

2054 
	#lzo_hmemıy
 
lzo_memıy


	)

2055 
	#lzo_hmemmove
 
lzo_memmove


	)

2056 
	#lzo_hmem£t
 
lzo_mem£t


	)

2057 
	#__LZOLIB_HMEMCPY_CH_INCLUDED
 1

	)

2058 #ià!
defšed
(
LZOLIB_PUBLIC
)

2059 
	#LZOLIB_PUBLIC
(
r
,
f
è¸
	`__LZOLIB_FUNCNAME
(f)

	)

2061 
	$LZOLIB_PUBLIC
(, 
lzo_hmemcmp
è(cÚ¡ 
lzo_hvoid_p
 
s1
, cÚ¡†zo_hvoid_°
s2
, 
lzo_hsize_t
 
Ën
)

2063 #ià(
LZO_HAVE_MM_HUGE_PTR
è|| !
	`defšed
(
HAVE_MEMCMP
)

2064 cÚ¡ 
lzo_hby‹_p
 
p1
 = (cÚ¡†zo_hby‹_pè
s1
;

2065 cÚ¡ 
lzo_hby‹_p
 
p2
 = (cÚ¡†zo_hby‹_pè
s2
;

2066 
	`__lzo_lik–y
(
Ën
 > 0) do

2068 
d
 = *
p1
 - *
p2
;

2069 ià(
d
 != 0)

2070  
d
;

2071 
p1
++; 
p2
++;

2072 } 
	`__lzo_lik–y
(--
Ën
 > 0);

2075  
	`memcmp
(
s1
, 
s2
, 
Ën
);

2077 
	}
}

2078 
	$LZOLIB_PUBLIC
(
lzo_hvoid_p
, 
lzo_hmemıy
èÖzo_hvoid_°
de¡
, cÚ¡†zo_hvoid_°
¤c
, 
lzo_hsize_t
 
Ën
)

2080 #ià(
LZO_HAVE_MM_HUGE_PTR
è|| !
	`defšed
(
HAVE_MEMCPY
)

2081 
lzo_hby‹_p
 
p1
 = (lzo_hby‹_pè
de¡
;

2082 cÚ¡ 
lzo_hby‹_p
 
p2
 = (cÚ¡†zo_hby‹_pè
¤c
;

2083 ià(
Ën
 <ğ0 || 
p1
 =ğ
p2
)

2084  
de¡
;

2086 *
p1
++ = *
p2
++;

2087 
	`__lzo_lik–y
(--
Ën
 > 0);

2088  
de¡
;

2090  
	`memıy
(
de¡
, 
¤c
, 
Ën
);

2092 
	}
}

2093 
	$LZOLIB_PUBLIC
(
lzo_hvoid_p
, 
lzo_hmemmove
èÖzo_hvoid_°
de¡
, cÚ¡†zo_hvoid_°
¤c
, 
lzo_hsize_t
 
Ën
)

2095 #ià(
LZO_HAVE_MM_HUGE_PTR
è|| !
	`defšed
(
HAVE_MEMMOVE
)

2096 
lzo_hby‹_p
 
p1
 = (lzo_hby‹_pè
de¡
;

2097 cÚ¡ 
lzo_hby‹_p
 
p2
 = (cÚ¡†zo_hby‹_pè
¤c
;

2098 ià(
Ën
 <ğ0 || 
p1
 =ğ
p2
)

2099  
de¡
;

2100 ià(
p1
 < 
p2
)

2103 *
p1
++ = *
p2
++;

2104 
	`__lzo_lik–y
(--
Ën
 > 0);

2108 
p1
 +ğ
Ën
;

2109 
p2
 +ğ
Ën
;

2111 *--
p1
 = *--
p2
;

2112 
	`__lzo_lik–y
(--
Ën
 > 0);

2114  
de¡
;

2116  
	`memmove
(
de¡
, 
¤c
, 
Ën
);

2118 
	}
}

2119 
	$LZOLIB_PUBLIC
(
lzo_hvoid_p
, 
lzo_hmem£t
èÖzo_hvoid_°
s
, 
c
, 
lzo_hsize_t
 
Ën
)

2121 #ià(
LZO_HAVE_MM_HUGE_PTR
è|| !
	`defšed
(
HAVE_MEMSET
)

2122 
lzo_hby‹_p
 
p
 = (lzo_hby‹_pè
s
;

2123 
	`__lzo_lik–y
(
Ën
 > 0) do

2124 *
p
++ = (è
c
;

2125 
	`__lzo_lik–y
(--
Ën
 > 0);

2126  
s
;

2128  
	`mem£t
(
s
, 
c
, 
Ën
);

2130 
	}
}

2131 #undeà
LZOLIB_PUBLIC


2134 #ià!
defšed
(
__LZO_IN_MINILZO
)

2136 
	#ACC_WANT_ACC_CHK_CH
 1

	)

2137 #undeà
ACCCHK_ASSERT


2139 
	$ACCCHK_ASSERT_IS_SIGNED_T
(
lzo_št
)

2140 
	$ACCCHK_ASSERT_IS_UNSIGNED_T
(
lzo_ušt
)

2142 
	$ACCCHK_ASSERT_IS_SIGNED_T
(
lzo_št32
)

2143 
	$ACCCHK_ASSERT_IS_UNSIGNED_T
(
lzo_ušt32
)

2144 
	`ACCCHK_ASSERT
((
	`LZO_UINT32_C
(1) << ()(8*(LZO_UINT32_C(1))-1)) > 0)

2145 
	`ACCCHK_ASSERT
((
lzo_ušt32
) >= 4)

2147 #ià!
	`defšed
(
__LZO_UINTPTR_T_IS_POINTER
)

2148 
	$ACCCHK_ASSERT_IS_UNSIGNED_T
(
lzo_ušŒ_t
)

2150 
	`ACCCHK_ASSERT
((
lzo_ušŒ_t
è>ğ(
lzo_voidp
))

2152 
	$ACCCHK_ASSERT_IS_UNSIGNED_T
(
lzo_xšt
)

2153 
	`ACCCHK_ASSERT
((
lzo_xšt
è>ğ(
lzo_ušt32
))

2154 
	`ACCCHK_ASSERT
((
lzo_xšt
è>ğ(
lzo_ušt
))

2155 
	`ACCCHK_ASSERT
((
lzo_xšt
è=ğ(
lzo_ušt32
è|| Özo_xštè=ğ(
lzo_ušt
))

2158 #undeà
ACCCHK_ASSERT


2160 
	$LZO_PUBLIC
()

2161 
	$_lzo_cÚfig_check
()

2163 
lzo_boŞ
 
r
 = 1;

2164 uniÚ { 
c
[2*(
lzo_xšt
)];†zo_xšˆ
l
[2]; } 
u
;

2166 #ià!
	`defšed
(
LZO_CFG_NO_CONFIG_CHECK
)

2167 #ià
	`defšed
(
LZO_ABI_BIG_ENDIAN
)

2168 
u
.
l
[0] = u.l[1] = 0; u.
c
[(
lzo_xšt
) - 1] = 128;

2169 
r
 &ğ(
u
.
l
[0] == 128);

2171 #ià
	`defšed
(
LZO_ABI_LITTLE_ENDIAN
)

2172 
u
.
l
[0] = u.l[1] = 0; u.
c
[0] = 128;

2173 
r
 &ğ(
u
.
l
[0] == 128);

2175 #ià
	`defšed
(
LZO_UNALIGNED_OK_2
)

2176 
u
.
l
[0] = u.l[1] = 0;

2177 
r
 &ğ((* (cÚ¡ 
lzo_ushÜ
è(cÚ¡ 
lzo_voidp
è&
u
.
c
[1]) == 0);

2179 #ià
	`defšed
(
LZO_UNALIGNED_OK_4
)

2180 
u
.
l
[0] = u.l[1] = 0;

2181 
r
 &ğ((* (cÚ¡ 
lzo_ušt32p
è(cÚ¡ 
lzo_voidp
è&
u
.
c
[1]) == 0);

2185 
	`LZO_UNUSED
(
u
);

2186  
r
 =ğ1 ? 
LZO_E_OK
 : 
LZO_E_ERROR
;

2187 
	}
}

2189 
	g__lzo_š™_dÚe
 = 0;

2191 
	$LZO_PUBLIC
()

2192 
	$__lzo_š™_v2
(
v
, 
s1
, 
s2
, 
s3
, 
s4
, 
s5
,

2193 
s6
, 
s7
, 
s8
, 
s9
)

2195 
r
;

2197 #ià
	`defšed
(
__LZO_IN_MINILZO
)

2198 #–ià(
LZO_CC_MSC
 && ((
_MSC_VER
) < 700))

2200 
	#ACC_WANT_ACC_CHK_CH
 1

	)

2201 #undeà
ACCCHK_ASSERT


2202 
	#ACCCHK_ASSERT
(
ex´
è
	`LZO_COMPILE_TIME_ASSERT
Óx´)

	)

2204 #undeà
ACCCHK_ASSERT


2206 
__lzo_š™_dÚe
 = 1;

2208 ià(
v
 == 0)

2209  
LZO_E_ERROR
;

2211 
r
 = (
s1
 == -1 || s1 == () ()) &&

2212 (
s2
 == -1 || s2 == () ()) &&

2213 (
s3
 == -1 || s3 == () ()) &&

2214 (
s4
 =ğ-1 || s4 =ğ(è(
lzo_ušt32
)) &&

2215 (
s5
 =ğ-1 || s5 =ğ(è(
lzo_ušt
)) &&

2216 (
s6
 =ğ-1 || s6 =ğ(è
lzo_sizeof_diù_t
) &&

2217 (
s7
 == -1 || s7 == () (*)) &&

2218 (
s8
 =ğ-1 || s8 =ğ(è(
lzo_voidp
)) &&

2219 (
s9
 =ğ-1 || s9 =ğ(è(
lzo_ÿÎback_t
));

2220 ià(!
r
)

2221  
LZO_E_ERROR
;

2223 
r
 = 
	`_lzo_cÚfig_check
();

2224 ià(
r
 !ğ
LZO_E_OK
)

2225  
r
;

2227  
r
;

2228 
	}
}

2230 #ià!
defšed
(
__LZO_IN_MINILZO
)

2232 #ià(
LZO_OS_WIN16
 && 
LZO_CC_WATCOMC
è&& 
defšed
(
__SW_BD
)

2235 
BOOL
 
FAR
 
PASCAL
 
	$LibMaš
 ( 
HANDLE
 
hIn¡ªû
, 
WORD
 
wD©aSegm’t
,

2236 
WORD
 
wH—pSize
, 
LPSTR
 
ÍszCmdLše
 )

2238 
__çr
 
__·sÿl
 
	$LibMaš
 ( 
a
, 
b
, 
c
, 
d
 )

2241 
	`LZO_UNUSED
(
a
); LZO_UNUSED(
b
); LZO_UNUSED(
c
); LZO_UNUSED(
d
);

2243 
	}
}

2249 
	#do_com´ess
 
_lzo1x_1_do_com´ess


	)

2251 #ià!
defšed
(
MINILZO_CFG_SKIP_LZO1X_1_COMPRESS
)

2253 
	#LZO_NEED_DICT_H


	)

2254 
	#D_BITS
 14

	)

2255 
	#D_INDEX1
(
d
,
p
èd = 
	`DM
(
	`DMUL
(0x21,
	`DX3
Õ,5,5,6)è>> 5)

	)

2256 
	#D_INDEX2
(
d
,
p
èd = (d & (
D_MASK
 & 0x7ff)è^ (
D_HIGH
 | 0x1f)

	)

2258 #iâdeà
__LZO_CONFIG1X_H


2259 
	#__LZO_CONFIG1X_H


	)

2261 #ià!
defšed
(
LZO1X
è&& !defšed(
LZO1Y
è&& !defšed(
LZO1Z
)

2262 
	#LZO1X


	)

2265 #ià!
defšed
(
__LZO_IN_MINILZO
)

2266 
	~"lzo/lzo1x.h
"

2269 
	#LZO_EOF_CODE


	)

2270 #undeà
LZO_DETERMINISTIC


2272 
	#M1_MAX_OFFSET
 0x0400

	)

2273 #iâdeà
M2_MAX_OFFSET


2274 
	#M2_MAX_OFFSET
 0x0800

	)

2276 
	#M3_MAX_OFFSET
 0x4000

	)

2277 
	#M4_MAX_OFFSET
 0xbfff

	)

2279 
	#MX_MAX_OFFSET
 (
M1_MAX_OFFSET
 + 
M2_MAX_OFFSET
)

	)

2281 
	#M1_MIN_LEN
 2

	)

2282 
	#M1_MAX_LEN
 2

	)

2283 
	#M2_MIN_LEN
 3

	)

2284 #iâdeà
M2_MAX_LEN


2285 
	#M2_MAX_LEN
 8

	)

2287 
	#M3_MIN_LEN
 3

	)

2288 
	#M3_MAX_LEN
 33

	)

2289 
	#M4_MIN_LEN
 3

	)

2290 
	#M4_MAX_LEN
 9

	)

2292 
	#M1_MARKER
 0

	)

2293 
	#M2_MARKER
 64

	)

2294 
	#M3_MARKER
 32

	)

2295 
	#M4_MARKER
 16

	)

2297 #iâdeà
MIN_LOOKAHEAD


2298 
	#MIN_LOOKAHEAD
 (
M2_MAX_LEN
 + 1)

	)

2301 #ià
defšed
(
LZO_NEED_DICT_H
)

2303 #iâdeà
LZO_HASH


2304 
	#LZO_HASH
 
LZO_HASH_LZO_INCREMENTAL_B


	)

2306 
	#DL_MIN_LEN
 
M2_MIN_LEN


	)

2308 #iâdeà
__LZO_DICT_H


2309 
	#__LZO_DICT_H


	)

2311 #ifdeà
__ılu¥lus


2315 #ià!
defšed
(
D_BITS
è&& defšed(
DBITS
)

2316 
	#D_BITS
 
DBITS


	)

2318 #ià!
defšed
(
D_BITS
)

2321 #ià(
D_BITS
 < 16)

2322 
	#D_SIZE
 
	`LZO_SIZE
(
D_BITS
)

	)

2323 
	#D_MASK
 
	`LZO_MASK
(
D_BITS
)

	)

2325 
	#D_SIZE
 
	`LZO_USIZE
(
D_BITS
)

	)

2326 
	#D_MASK
 
	`LZO_UMASK
(
D_BITS
)

	)

2328 
	#D_HIGH
 ((
D_MASK
 >> 1è+ 1)

	)

2330 #ià!
defšed
(
DD_BITS
)

2331 
	#DD_BITS
 0

	)

2333 
	#DD_SIZE
 
	`LZO_SIZE
(
DD_BITS
)

	)

2334 
	#DD_MASK
 
	`LZO_MASK
(
DD_BITS
)

	)

2336 #ià!
defšed
(
DL_BITS
)

2337 
	#DL_BITS
 (
D_BITS
 - 
DD_BITS
)

	)

2339 #ià(
DL_BITS
 < 16)

2340 
	#DL_SIZE
 
	`LZO_SIZE
(
DL_BITS
)

	)

2341 
	#DL_MASK
 
	`LZO_MASK
(
DL_BITS
)

	)

2343 
	#DL_SIZE
 
	`LZO_USIZE
(
DL_BITS
)

	)

2344 
	#DL_MASK
 
	`LZO_UMASK
(
DL_BITS
)

	)

2347 #ià(
D_BITS
 !ğ
DL_BITS
 + 
DD_BITS
)

2350 #ià(
D_BITS
 < 8 || D_BITS > 18)

2353 #ià(
DL_BITS
 < 8 || DL_BITS > 20)

2356 #ià(
DD_BITS
 < 0 || DD_BITS > 6)

2360 #ià!
defšed
(
DL_MIN_LEN
)

2361 
	#DL_MIN_LEN
 3

	)

2363 #ià!
defšed
(
DL_SHIFT
)

2364 
	#DL_SHIFT
 ((
DL_BITS
 + (
DL_MIN_LEN
 - 1)è/ DL_MIN_LEN)

	)

2367 
	#LZO_HASH_GZIP
 1

	)

2368 
	#LZO_HASH_GZIP_INCREMENTAL
 2

	)

2369 
	#LZO_HASH_LZO_INCREMENTAL_A
 3

	)

2370 
	#LZO_HASH_LZO_INCREMENTAL_B
 4

	)

2372 #ià!
defšed
(
LZO_HASH
)

2376 #undeà
DM


2377 #undeà
DX


2379 #ià(
DL_MIN_LEN
 == 3)

2380 
	#_DV2_A
(
p
,
shiá1
,
shiá2
) \

2381 (((Ğ(
lzo_xšt
)((
p
)[0]è<< 
shiá1
è^ (p)[1]è<< 
shiá2
è^ (p)[2])

	)

2382 
	#_DV2_B
(
p
,
shiá1
,
shiá2
) \

2383 (((Ğ(
lzo_xšt
)((
p
)[2]è<< 
shiá1
è^ (p)[1]è<< 
shiá2
è^ (p)[0])

	)

2384 
	#_DV3_B
(
p
,
shiá1
,
shiá2
,
shiá3
) \

2385 ((
	`_DV2_B
((
p
)+1,
shiá1
,
shiá2
è<< (
shiá3
)è^ (p)[0])

	)

2386 #–ià(
DL_MIN_LEN
 == 2)

2387 
	#_DV2_A
(
p
,
shiá1
,
shiá2
) \

2388 (Ğ(
lzo_xšt
)(
p
[0]è<< 
shiá1
è^…[1])

	)

2389 
	#_DV2_B
(
p
,
shiá1
,
shiá2
) \

2390 (Ğ(
lzo_xšt
)(
p
[1]è<< 
shiá1
è^…[2])

	)

2394 
	#_DV_A
(
p
,
shiá
è
	`_DV2_A
Õ,shiá,shiá)

	)

2395 
	#_DV_B
(
p
,
shiá
è
	`_DV2_B
Õ,shiá,shiá)

	)

2396 
	#DA2
(
p
,
s1
,
s2
) \

2397 (((((
lzo_xšt
)((
p
)[2]è<< (
s2
)è+ (p)[1]è<< (
s1
)è+ (p)[0])

	)

2398 
	#DS2
(
p
,
s1
,
s2
) \

2399 (((((
lzo_xšt
)((
p
)[2]è<< (
s2
)è- (p)[1]è<< (
s1
)è- (p)[0])

	)

2400 
	#DX2
(
p
,
s1
,
s2
) \

2401 (((((
lzo_xšt
)((
p
)[2]è<< (
s2
)è^ (p)[1]è<< (
s1
)è^ (p)[0])

	)

2402 
	#DA3
(
p
,
s1
,
s2
,
s3
è((
	`DA2
(Õ)+1,s2,s3è<< (s1)è+ (p)[0])

	)

2403 
	#DS3
(
p
,
s1
,
s2
,
s3
è((
	`DS2
(Õ)+1,s2,s3è<< (s1)è- (p)[0])

	)

2404 
	#DX3
(
p
,
s1
,
s2
,
s3
è((
	`DX2
(Õ)+1,s2,s3è<< (s1)è^ (p)[0])

	)

2405 
	#DMS
(
v
,
s
è((
lzo_ušt
è(((vè& (
D_MASK
 >> (s))è<< (s)))

	)

2406 
	#DM
(
v
è
	`DMS
(v,0)

	)

2408 #ià(
LZO_HASH
 =ğ
LZO_HASH_GZIP
)

2409 
	#_DINDEX
(
dv
,
p
è(
	`_DV_A
(Õ),
DL_SHIFT
))

	)

2411 #–ià(
LZO_HASH
 =ğ
LZO_HASH_GZIP_INCREMENTAL
)

2412 
	#__LZO_HASH_INCREMENTAL


	)

2413 
	#DVAL_FIRST
(
dv
,
p
èdv = 
	`_DV_A
(Õ),
DL_SHIFT
)

	)

2414 
	#DVAL_NEXT
(
dv
,
p
èdv = (((dvè<< 
DL_SHIFT
è^…[2])

	)

2415 
	#_DINDEX
(
dv
,
p
è(dv)

	)

2416 
	#DVAL_LOOKAHEAD
 
DL_MIN_LEN


	)

2418 #–ià(
LZO_HASH
 =ğ
LZO_HASH_LZO_INCREMENTAL_A
)

2419 
	#__LZO_HASH_INCREMENTAL


	)

2420 
	#DVAL_FIRST
(
dv
,
p
èdv = 
	`_DV_A
(Õ),5)

	)

2421 
	#DVAL_NEXT
(
dv
,
p
) \

2422 
dv
 ^ğ(
lzo_xšt
)(
p
[-1]è<< (2*5); dv = (((dvè<< 5è^…[2])

	)

2423 
	#_DINDEX
(
dv
,
p
è((
	`DMUL
(0x9f5f,dv)è>> 5)

	)

2424 
	#DVAL_LOOKAHEAD
 
DL_MIN_LEN


	)

2426 #–ià(
LZO_HASH
 =ğ
LZO_HASH_LZO_INCREMENTAL_B
)

2427 
	#__LZO_HASH_INCREMENTAL


	)

2428 
	#DVAL_FIRST
(
dv
,
p
èdv = 
	`_DV_B
(Õ),5)

	)

2429 
	#DVAL_NEXT
(
dv
,
p
) \

2430 
dv
 ^ğ
p
[-1]; dv = (((dvè>> 5è^ ((
lzo_xšt
)Õ[2]è<< (2*5)))

	)

2431 
	#_DINDEX
(
dv
,
p
è((
	`DMUL
(0x9f5f,dv)è>> 5)

	)

2432 
	#DVAL_LOOKAHEAD
 
DL_MIN_LEN


	)

2438 #iâdeà
DINDEX


2439 
	#DINDEX
(
dv
,
p
è((
lzo_ušt
)((
	`_DINDEX
(dv,p)è& 
DL_MASK
è<< 
DD_BITS
)

	)

2441 #ià!
defšed
(
DINDEX1
è&& defšed(
D_INDEX1
)

2442 
	#DINDEX1
 
D_INDEX1


	)

2444 #ià!
defšed
(
DINDEX2
è&& defšed(
D_INDEX2
)

2445 
	#DINDEX2
 
D_INDEX2


	)

2448 #ià!
defšed
(
__LZO_HASH_INCREMENTAL
)

2449 
	#DVAL_FIRST
(
dv
,
p
è((è0)

	)

2450 
	#DVAL_NEXT
(
dv
,
p
è((è0)

	)

2451 
	#DVAL_LOOKAHEAD
 0

	)

2454 #ià!
defšed
(
DVAL_ASSERT
)

2455 #ià
defšed
(
__LZO_HASH_INCREMENTAL
è&& !defšed(
NDEBUG
)

2456 
DVAL_ASSERT
(
lzo_xšt
 
dv
, cÚ¡ 
lzo_by‹p
 
p
)

2458 
lzo_xšt
 
df
;

2459 
DVAL_FIRST
(
df
,(
p
));

2460 
as£¹
(
DINDEX
(
dv
,
p
è=ğDINDEX(
df
,p));

2463 
	#DVAL_ASSERT
(
dv
,
p
è((è0)

	)

2467 #ià
defšed
(
LZO_DICT_USE_PTR
)

2468 
	#DENTRY
(
p
,
š
èÕ)

	)

2469 
	#GINDEX
(
m_pos
,
m_off
,
diù
,
dšdex
,
š
èm_po ğdiù[dšdex]

	)

2471 
	#DENTRY
(
p
,
š
è((
lzo_ušt
è(Õ)-(š)))

	)

2472 
	#GINDEX
(
m_pos
,
m_off
,
diù
,
dšdex
,
š
èm_ofàğdiù[dšdex]

	)

2475 #ià(
DD_BITS
 == 0)

2477 
	#UPDATE_D
(
diù
,
drun
,
dv
,
p
,
š
èdiù[ 
	`DINDEX
(dv,pè] = 
	`DENTRY
Õ,š)

	)

2478 
	#UPDATE_I
(
diù
,
drun
,
šdex
,
p
,
š
èdiù[šdex] = 
	`DENTRY
Õ,š)

	)

2479 
	#UPDATE_P
(
±r
,
drun
,
p
,
š
èÕŒ)[0] = 
	`DENTRY
Õ,š)

	)

2483 
	#UPDATE_D
(
diù
,
drun
,
dv
,
p
,
š
) \

2484 
diù
[ 
	`DINDEX
(
dv
,
p
è+ 
drun
++ ] = 
	`DENTRY
Õ,
š
); druÀ&ğ
DD_MASK


	)

2485 
	#UPDATE_I
(
diù
,
drun
,
šdex
,
p
,
š
) \

2486 
diù
[ (
šdex
è+ 
drun
++ ] = 
	`DENTRY
(
p
,
š
); druÀ&ğ
DD_MASK


	)

2487 
	#UPDATE_P
(
±r
,
drun
,
p
,
š
) \

2488 (
±r
è[ 
drun
++ ] = 
	`DENTRY
(
p
,
š
); druÀ&ğ
DD_MASK


	)

2492 #ià
defšed
(
LZO_DICT_USE_PTR
)

2494 
	#LZO_CHECK_MPOS_DET
(
m_pos
,
m_off
,
š
,

,
max_off£t
) \

2495 (
m_pos
 =ğ
NULL
 || (
m_off
 = 
	`pd
(

, m_pos)è> 
max_off£t
)

	)

2497 
	#LZO_CHECK_MPOS_NON_DET
(
m_pos
,
m_off
,
š
,

,
max_off£t
) \

2498 (
	`BOUNDS_CHECKING_OFF_IN_EXPR
(( \

2499 
m_pos
 = 

 - (
lzo_ušt
è
	`PTR_DIFF
(ip,m_pos), \

2500 
	`PTR_LT
(
m_pos
,
š
) || \

2501 (
m_off
 = (
lzo_ušt
è
	`PTR_DIFF
(

,
m_pos
)) <= 0 || \

2502 
m_off
 > 
max_off£t
 )))

	)

2506 
	#LZO_CHECK_MPOS_DET
(
m_pos
,
m_off
,
š
,

,
max_off£t
) \

2507 (
m_off
 == 0 || \

2508 ((
m_off
 = 
	`pd
(

, 
š
è- m_offè> 
max_off£t
) || \

2509 (
m_pos
 = (

è- (
m_off
), 0è)

	)

2511 
	#LZO_CHECK_MPOS_NON_DET
(
m_pos
,
m_off
,
š
,

,
max_off£t
) \

2512 (
	`pd
(

, 
š
è<ğ
m_off
 || \

2513 ((
m_off
 = 
	`pd
(

, 
š
è- m_offè> 
max_off£t
) || \

2514 (
m_pos
 = (

è- (
m_off
), 0è)

	)

2518 #ià
defšed
(
LZO_DETERMINISTIC
)

2519 
	#LZO_CHECK_MPOS
 
LZO_CHECK_MPOS_DET


	)

2521 
	#LZO_CHECK_MPOS
 
LZO_CHECK_MPOS_NON_DET


	)

2524 #ifdeà
__ılu¥lus


2534 
	#DO_COMPRESS
 
lzo1x_1_com´ess


	)

2536 
__lzo_nošlše
 
lzo_ušt


2537 
	$do_com´ess
 ( cÚ¡ 
lzo_by‹p
 
š
 , 
lzo_ušt
 
š_Ën
,

2538 
lzo_by‹p
 
out
, 
lzo_uš
 
out_Ën
,

2539 
lzo_voidp
 
wrkmem
 )

2541 cÚ¡ 
lzo_by‹p
 

;

2542 
lzo_by‹p
 
İ
;

2543 cÚ¡ 
lzo_by‹p
 cÚ¡ 
š_’d
 = 
š
 + 
š_Ën
;

2544 cÚ¡ 
lzo_by‹p
 cÚ¡ 
_’d
 = 
š
 + 
š_Ën
 - 
M2_MAX_LEN
 - 5;

2545 cÚ¡ 
lzo_by‹p
 
ii
;

2546 
lzo_diù_p
 cÚ¡ 
diù
 = (lzo_diù_pè
wrkmem
;

2548 
İ
 = 
out
;

2549 

 = 
š
;

2550 
ii
 = 

;

2552 

 += 4;

2555 cÚ¡ 
lzo_by‹p
 
m_pos
;

2556 
lzo_ušt
 
m_off
;

2557 
lzo_ušt
 
m_Ën
;

2558 
lzo_ušt
 
dšdex
;

2560 
	`DINDEX1
(
dšdex
,

);

2561 
	`GINDEX
(
m_pos
,
m_off
,
diù
,
dšdex
,
š
);

2562 ià(
	`LZO_CHECK_MPOS_NON_DET
(
m_pos
,
m_off
,
š
,

,
M4_MAX_OFFSET
))

2563 
l™”®
;

2565 ià(
m_off
 <ğ
M2_MAX_OFFSET
 || 
m_pos
[3] =ğ

[3])

2566 
Œy_m©ch
;

2567 
	`DINDEX2
(
dšdex
,

);

2569 
	`GINDEX
(
m_pos
,
m_off
,
diù
,
dšdex
,
š
);

2570 ià(
	`LZO_CHECK_MPOS_NON_DET
(
m_pos
,
m_off
,
š
,

,
M4_MAX_OFFSET
))

2571 
l™”®
;

2572 ià(
m_off
 <ğ
M2_MAX_OFFSET
 || 
m_pos
[3] =ğ

[3])

2573 
Œy_m©ch
;

2574 
l™”®
;

2576 
Œy_m©ch
:

2577 #ià1 && 
	`defšed
(
LZO_UNALIGNED_OK_2
)

2578 ià(* (cÚ¡ 
lzo_ushÜ
è
m_pos
 !ğ* (cÚ¡†zo_ushÜè

)

2580 ià(
m_pos
[0] !ğ

[0] || m_pos[1] != ip[1])

2586 
	`__lzo_lik–y
(
m_pos
[2] =ğ

[2])

2589 ià(
m_off
 <ğ
M2_MAX_OFFSET
)

2590 
m©ch
;

2591 ià(
l™
 <= 3)

2592 
m©ch
;

2593 ià(
l™
 == 3)

2595 
	`as£¹
(
İ
 - 2 > 
out
); op[-2] |ğ
	`LZO_BYTE
(3);

2596 *
İ
++ = *
ii
++; *op++ = *ii++; *op++ = *ii++;

2597 
code_m©ch
;

2599 ià(
m_pos
[3] =ğ

[3])

2601 
m©ch
;

2607 ià(
m_off
 <ğ
M1_MAX_OFFSET
 && 
l™
 > 0 &&†it <= 3)

2609 ià(
m_off
 <ğ
M1_MAX_OFFSET
 && 
l™
 == 3)

2612 
lzo_ušt
 
t
;

2614 
t
 = 
l™
;

2615 
	`as£¹
(
İ
 - 2 > 
out
); op[-2] |ğ
	`LZO_BYTE
(
t
);

2616 dØ*
İ
++ = *
ii
++; --
t
 > 0);

2617 
	`as£¹
(
ii
 =ğ

);

2618 
m_off
 -= 1;

2619 *
İ
++ = 
	`LZO_BYTE
(
M1_MARKER
 | ((
m_off
 & 3) << 2));

2620 *
İ
++ = 
	`LZO_BYTE
(
m_off
 >> 2);

2621 

 += 2;

2622 
m©ch_dÚe
;

2628 
l™”®
:

2629 
	`UPDATE_I
(
diù
,0,
dšdex
,

,
š
);

2630 ++

;

2631 
	`__lzo_uÆik–y
(

 >ğ
_’d
)

2635 
m©ch
:

2636 
	`UPDATE_I
(
diù
,0,
dšdex
,

,
š
);

2637 ià(
	`pd
(

,
ii
) > 0)

2639 
lzo_ušt
 
t
 = 
	`pd
(

,
ii
);

2641 ià(
t
 <= 3)

2643 
	`as£¹
(
İ
 - 2 > 
out
);

2644 
İ
[-2] |ğ
	`LZO_BYTE
(
t
);

2646 ià(
t
 <= 18)

2647 *
İ
++ = 
	`LZO_BYTE
(
t
 - 3);

2650 
lzo_ušt
 
‰
 = 
t
 - 18;

2652 *
İ
++ = 0;

2653 
‰
 > 255)

2655 
‰
 -= 255;

2656 *
İ
++ = 0;

2658 
	`as£¹
(
‰
 > 0);

2659 *
İ
++ = 
	`LZO_BYTE
(
‰
);

2661 dØ*
İ
++ = *
ii
++; --
t
 > 0);

2664 
	`as£¹
(
ii
 =ğ

);

2665 

 += 3;

2666 ià(
m_pos
[3] !ğ*

++ || m_pos[4] != *ip++ || m_pos[5] != *ip++ ||

2667 
m_pos
[6] !ğ*

++ || m_pos[7] != *ip++ || m_pos[8] != *ip++

2668 #ifdeà
LZO1Y


2669 || 
m_pos
[ 9] !ğ*

++ || m_pos[10] != *ip++ || m_pos[11] != *ip++

2670 || 
m_pos
[12] !ğ*

++ || m_pos[13] != *ip++ || m_pos[14] != *ip++

2674 --

;

2675 
m_Ën
 = 
	`pd
(

, 
ii
);

2676 
	`as£¹
(
m_Ën
 >ğ3);‡s£¹(m_ËÀ<ğ
M2_MAX_LEN
);

2678 ià(
m_off
 <ğ
M2_MAX_OFFSET
)

2680 
m_off
 -= 1;

2681 #ià
	`defšed
(
LZO1X
)

2682 *
İ
++ = 
	`LZO_BYTE
(((
m_Ën
 - 1è<< 5è| ((
m_off
 & 7) << 2));

2683 *
İ
++ = 
	`LZO_BYTE
(
m_off
 >> 3);

2684 #–ià
	`defšed
(
LZO1Y
)

2685 *
İ
++ = 
	`LZO_BYTE
(((
m_Ën
 + 1è<< 4è| ((
m_off
 & 3) << 2));

2686 *
İ
++ = 
	`LZO_BYTE
(
m_off
 >> 2);

2689 ià(
m_off
 <ğ
M3_MAX_OFFSET
)

2691 
m_off
 -= 1;

2692 *
İ
++ = 
	`LZO_BYTE
(
M3_MARKER
 | (
m_Ën
 - 2));

2693 
m3_m4_off£t
;

2696 #ià
	`defšed
(
LZO1X
)

2698 
m_off
 -= 0x4000;

2699 
	`as£¹
(
m_off
 > 0);‡ssert(m_off <= 0x7fff);

2700 *
İ
++ = 
	`LZO_BYTE
(
M4_MARKER
 |

2701 ((
m_off
 & 0x4000è>> 11è| (
m_Ën
 - 2));

2702 
m3_m4_off£t
;

2704 #–ià
	`defšed
(
LZO1Y
)

2705 
m4_m©ch
;

2711 cÚ¡ 
lzo_by‹p
 
’d
 = 
š_’d
;

2712 cÚ¡ 
lzo_by‹p
 
m
 = 
m_pos
 + 
M2_MAX_LEN
 + 1;

2713 

 < 
’d
 && *
m
 == *ip)

2714 
m
++, 

++;

2715 
m_Ën
 = 
	`pd
(

, 
ii
);

2717 
	`as£¹
(
m_Ën
 > 
M2_MAX_LEN
);

2719 ià(
m_off
 <ğ
M3_MAX_OFFSET
)

2721 
m_off
 -= 1;

2722 ià(
m_Ën
 <= 33)

2723 *
İ
++ = 
	`LZO_BYTE
(
M3_MARKER
 | (
m_Ën
 - 2));

2726 
m_Ën
 -= 33;

2727 *
İ
++ = 
M3_MARKER
 | 0;

2728 
m3_m4_Ën
;

2733 #ià
	`defšed
(
LZO1Y
)

2734 
m4_m©ch
:

2736 
m_off
 -= 0x4000;

2737 
	`as£¹
(
m_off
 > 0);‡ssert(m_off <= 0x7fff);

2738 ià(
m_Ën
 <ğ
M4_MAX_LEN
)

2739 *
İ
++ = 
	`LZO_BYTE
(
M4_MARKER
 |

2740 ((
m_off
 & 0x4000è>> 11è| (
m_Ën
 - 2));

2743 
m_Ën
 -ğ
M4_MAX_LEN
;

2744 *
İ
++ = 
	`LZO_BYTE
(
M4_MARKER
 | ((
m_off
 & 0x4000) >> 11));

2745 
m3_m4_Ën
:

2746 
m_Ën
 > 255)

2748 
m_Ën
 -= 255;

2749 *
İ
++ = 0;

2751 
	`as£¹
(
m_Ën
 > 0);

2752 *
İ
++ = 
	`LZO_BYTE
(
m_Ën
);

2756 
m3_m4_off£t
:

2757 *
İ
++ = 
	`LZO_BYTE
((
m_off
 & 63) << 2);

2758 *
İ
++ = 
	`LZO_BYTE
(
m_off
 >> 6);

2762 
m©ch_dÚe
:

2764 
ii
 = 

;

2765 
	`__lzo_uÆik–y
(

 >ğ
_’d
)

2769 *
out_Ën
 = 
	`pd
(
İ
, 
out
);

2770  
	`pd
(
š_’d
,
ii
);

2771 
	}
}

2773 
	$LZO_PUBLIC
()

2774 
	$DO_COMPRESS
 ( cÚ¡ 
lzo_by‹p
 
š
 , 
lzo_ušt
 
š_Ën
,

2775 
lzo_by‹p
 
out
, 
lzo_uš
 
out_Ën
,

2776 
lzo_voidp
 
wrkmem
 )

2778 
lzo_by‹p
 
İ
 = 
out
;

2779 
lzo_ušt
 
t
;

2781 
	`__lzo_uÆik–y
(
š_Ën
 <ğ
M2_MAX_LEN
 + 5)

2782 
t
 = 
š_Ën
;

2785 
t
 = 
	`do_com´ess
(
š
,
š_Ën
,
İ
,
out_Ën
,
wrkmem
);

2786 
İ
 +ğ*
out_Ën
;

2789 ià(
t
 > 0)

2791 cÚ¡ 
lzo_by‹p
 
ii
 = 
š
 + 
š_Ën
 - 
t
;

2793 ià(
İ
 =ğ
out
 && 
t
 <= 238)

2794 *
İ
++ = 
	`LZO_BYTE
(17 + 
t
);

2795 ià(
t
 <= 3)

2796 
İ
[-2] |ğ
	`LZO_BYTE
(
t
);

2797 ià(
t
 <= 18)

2798 *
İ
++ = 
	`LZO_BYTE
(
t
 - 3);

2801 
lzo_ušt
 
‰
 = 
t
 - 18;

2803 *
İ
++ = 0;

2804 
‰
 > 255)

2806 
‰
 -= 255;

2807 *
İ
++ = 0;

2809 
	`as£¹
(
‰
 > 0);

2810 *
İ
++ = 
	`LZO_BYTE
(
‰
);

2812 dØ*
İ
++ = *
ii
++; --
t
 > 0);

2815 *
İ
++ = 
M4_MARKER
 | 1;

2816 *
İ
++ = 0;

2817 *
İ
++ = 0;

2819 *
out_Ën
 = 
	`pd
(
İ
, 
out
);

2820  
LZO_E_OK
;

2821 
	}
}

2825 #undeà
do_com´ess


2826 #undeà
DO_COMPRESS


2827 #undeà
LZO_HASH


2829 #undeà
LZO_TEST_OVERRUN


2830 #undeà
DO_DECOMPRESS


2831 
	#DO_DECOMPRESS
 
lzo1x_decom´ess


	)

2833 #ià!
defšed
(
MINILZO_CFG_SKIP_LZO1X_DECOMPRESS
)

2835 #ià
defšed
(
LZO_TEST_OVERRUN
)

2836 #ià!
defšed
(
LZO_TEST_OVERRUN_INPUT
)

2837 
	#LZO_TEST_OVERRUN_INPUT
 2

	)

2839 #ià!
defšed
(
LZO_TEST_OVERRUN_OUTPUT
)

2840 
	#LZO_TEST_OVERRUN_OUTPUT
 2

	)

2842 #ià!
defšed
(
LZO_TEST_OVERRUN_LOOKBEHIND
)

2843 
	#LZO_TEST_OVERRUN_LOOKBEHIND


	)

2847 #undeà
TEST_IP


2848 #undeà
TEST_OP


2849 #undeà
TEST_LB


2850 #undeà
TEST_LBO


2851 #undeà
NEED_IP


2852 #undeà
NEED_OP


2853 #undeà
HAVE_TEST_IP


2854 #undeà
HAVE_TEST_OP


2855 #undeà
HAVE_NEED_IP


2856 #undeà
HAVE_NEED_OP


2857 #undeà
HAVE_ANY_IP


2858 #undeà
HAVE_ANY_OP


2860 #ià
defšed
(
LZO_TEST_OVERRUN_INPUT
)

2861 #ià(
LZO_TEST_OVERRUN_INPUT
 >= 1)

2862 
	#TEST_IP
 (

 < 
_’d
)

	)

2864 #ià(
LZO_TEST_OVERRUN_INPUT
 >= 2)

2865 
	#NEED_IP
(
x
) \

2866 ià((
lzo_ušt
)(
_’d
 - 

è< (lzo_ušt)(
x
)è
šput_ov”run


	)

2870 #ià
defšed
(
LZO_TEST_OVERRUN_OUTPUT
)

2871 #ià(
LZO_TEST_OVERRUN_OUTPUT
 >= 1)

2872 
	#TEST_OP
 (
İ
 <ğ
İ_’d
)

	)

2874 #ià(
LZO_TEST_OVERRUN_OUTPUT
 >= 2)

2875 #undeà
TEST_OP


2876 
	#NEED_OP
(
x
) \

2877 ià((
lzo_ušt
)(
İ_’d
 - 
İ
è< (lzo_ušt)(
x
)è
ouut_ov”run


	)

2881 #ià
defšed
(
LZO_TEST_OVERRUN_LOOKBEHIND
)

2882 
	#TEST_LB
(
m_pos
èià(m_po < 
out
 || m_po >ğ
İ
è
lookbehšd_ov”run


	)

2883 
	#TEST_LBO
(
m_pos
,
o
èià(m_po < 
out
 || m_po >ğ
İ
 - (o)è
lookbehšd_ov”run


	)

2885 
	#TEST_LB
(
m_pos
è((è0)

	)

2886 
	#TEST_LBO
(
m_pos
,
o
è((è0)

	)

2889 #ià!
defšed
(
LZO_EOF_CODE
è&& !defšed(
TEST_IP
)

2890 
	#TEST_IP
 (

 < 
_’d
)

	)

2893 #ià
defšed
(
TEST_IP
)

2894 
	#HAVE_TEST_IP


	)

2896 
	#TEST_IP
 1

	)

2898 #ià
defšed
(
TEST_OP
)

2899 
	#HAVE_TEST_OP


	)

2901 
	#TEST_OP
 1

	)

2904 #ià
defšed
(
NEED_IP
)

2905 
	#HAVE_NEED_IP


	)

2907 
	#NEED_IP
(
x
è((è0)

	)

2909 #ià
defšed
(
NEED_OP
)

2910 
	#HAVE_NEED_OP


	)

2912 
	#NEED_OP
(
x
è((è0)

	)

2915 #ià
defšed
(
HAVE_TEST_IP
è|| defšed(
HAVE_NEED_IP
)

2916 
	#HAVE_ANY_IP


	)

2918 #ià
defšed
(
HAVE_TEST_OP
è|| defšed(
HAVE_NEED_OP
)

2919 
	#HAVE_ANY_OP


	)

2922 #undeà
__COPY4


2923 
	#__COPY4
(
d¡
,
¤c
è* (
lzo_ušt32p
)(d¡èğ* (cÚ¡†zo_ušt32p)(¤c)

	)

2925 #undeà
COPY4


2926 #ià
defšed
(
LZO_UNALIGNED_OK_4
)

2927 
	#COPY4
(
d¡
,
¤c
è
	`__COPY4
(d¡,¤c)

	)

2928 #–ià
defšed
(
LZO_ALIGNED_OK_4
)

2929 
	#COPY4
(
d¡
,
¤c
è
	`__COPY4
((
lzo_ušŒ_t
)(d¡),Özo_ušŒ_t)(¤c))

	)

2932 #ià
defšed
(
DO_DECOMPRESS
)

2933 
	$LZO_PUBLIC
()

2934 
	$DO_DECOMPRESS
 ( cÚ¡ 
lzo_by‹p
 
š
 , 
lzo_ušt
 
š_Ën
,

2935 
lzo_by‹p
 
out
, 
lzo_uš
 
out_Ën
,

2936 
lzo_voidp
 
wrkmem
 )

2939 
lzo_by‹p
 
İ
;

2940 cÚ¡ 
lzo_by‹p
 

;

2941 
lzo_ušt
 
t
;

2942 #ià
	`defšed
(
COPY_DICT
)

2943 
lzo_ušt
 
m_off
;

2944 cÚ¡ 
lzo_by‹p
 
diù_’d
;

2946 cÚ¡ 
lzo_by‹p
 
m_pos
;

2949 cÚ¡ 
lzo_by‹p
 cÚ¡ 
_’d
 = 
š
 + 
š_Ën
;

2950 #ià
	`defšed
(
HAVE_ANY_OP
)

2951 
lzo_by‹p
 cÚ¡ 
İ_’d
 = 
out
 + *
out_Ën
;

2953 #ià
	`defšed
(
LZO1Z
)

2954 
lzo_ušt
 
Ï¡_m_off
 = 0;

2957 
	`LZO_UNUSED
(
wrkmem
);

2959 #ià
	`defšed
(
COPY_DICT
)

2960 ià(
diù
)

2962 ià(
diù_Ën
 > 
M4_MAX_OFFSET
)

2964 
diù
 +ğ
diù_Ën
 - 
M4_MAX_OFFSET
;

2965 
diù_Ën
 = 
M4_MAX_OFFSET
;

2967 
diù_’d
 = 
diù
 + 
diù_Ën
;

2971 
diù_Ën
 = 0;

2972 
diù_’d
 = 
NULL
;

2976 *
out_Ën
 = 0;

2978 
İ
 = 
out
;

2979 

 = 
š
;

2981 ià(*

 > 17)

2983 
t
 = *

++ - 17;

2984 ià(
t
 < 4)

2985 
m©ch_Ãxt
;

2986 
	`as£¹
(
t
 > 0); 
	`NEED_OP
Ñ); 
	`NEED_IP
(t+1);

2987 dØ*
İ
++ = *

++; --
t
 > 0);

2988 
fœ¡_l™”®_run
;

2991 
TEST_IP
 && 
TEST_OP
)

2993 
t
 = *

++;

2994 ià(
t
 >= 16)

2995 
m©ch
;

2996 ià(
t
 == 0)

2998 
	`NEED_IP
(1);

2999 *

 == 0)

3001 
t
 += 255;

3002 

++;

3003 
	`NEED_IP
(1);

3005 
t
 +ğ15 + *

++;

3007 
	`as£¹
(
t
 > 0); 
	`NEED_OP
Ñ+3); 
	`NEED_IP
(t+4);

3008 #ià
	`defšed
(
LZO_UNALIGNED_OK_4
è|| defšed(
LZO_ALIGNED_OK_4
)

3009 #ià!
	`defšed
(
LZO_UNALIGNED_OK_4
)

3010 ià(
	`PTR_ALIGNED2_4
(
İ
,

))

3013 
	`COPY4
(
İ
,

);

3014 
İ
 +ğ4; 

 += 4;

3015 ià(--
t
 > 0)

3017 ià(
t
 >= 4)

3020 
	`COPY4
(
İ
,

);

3021 
İ
 +ğ4; 

 +ğ4; 
t
 -= 4;

3022 } 
t
 >= 4);

3023 ià(
t
 > 0èdØ*
İ
++ = *

++; --t > 0);

3026 dØ*
İ
++ = *

++; --
t
 > 0);

3028 #ià!
	`defšed
(
LZO_UNALIGNED_OK_4
)

3033 #ià!
	`defšed
(
LZO_UNALIGNED_OK_4
)

3035 *
İ
++ = *

++; *op++ = *ip++; *op++ = *ip++;

3036 dØ*
İ
++ = *

++; --
t
 > 0);

3040 
fœ¡_l™”®_run
:

3042 
t
 = *

++;

3043 ià(
t
 >= 16)

3044 
m©ch
;

3045 #ià
	`defšed
(
COPY_DICT
)

3046 #ià
	`defšed
(
LZO1Z
)

3047 
m_off
 = (1 + 
M2_MAX_OFFSET
è+ (
t
 << 6è+ (*

++ >> 2);

3048 
Ï¡_m_off
 = 
m_off
;

3050 
m_off
 = (1 + 
M2_MAX_OFFSET
è+ (
t
 >> 2è+ (*

++ << 2);

3052 
	`NEED_OP
(3);

3053 
t
 = 3; 
	`COPY_DICT
Ñ,
m_off
)

3055 #ià
	`defšed
(
LZO1Z
)

3056 
t
 = (1 + 
M2_MAX_OFFSET
è+ (ˆ<< 6è+ (*

++ >> 2);

3057 
m_pos
 = 
İ
 - 
t
;

3058 
Ï¡_m_off
 = 
t
;

3060 
m_pos
 = 
İ
 - (1 + 
M2_MAX_OFFSET
);

3061 
m_pos
 -ğ
t
 >> 2;

3062 
m_pos
 -ğ*

++ << 2;

3064 
	`TEST_LB
(
m_pos
); 
	`NEED_OP
(3);

3065 *
İ
++ = *
m_pos
++; *op++ = *m_pos++; *op++ = *m_pos;

3067 
m©ch_dÚe
;

3070 
m©ch
:

3071 ià(
t
 >= 64)

3073 #ià
	`defšed
(
COPY_DICT
)

3074 #ià
	`defšed
(
LZO1X
)

3075 
m_off
 = 1 + ((
t
 >> 2è& 7è+ (*

++ << 3);

3076 
t
 = (t >> 5) - 1;

3077 #–ià
	`defšed
(
LZO1Y
)

3078 
m_off
 = 1 + ((
t
 >> 2è& 3è+ (*

++ << 2);

3079 
t
 = (t >> 4) - 3;

3080 #–ià
	`defšed
(
LZO1Z
)

3081 
m_off
 = 
t
 & 0x1f;

3082 ià(
m_off
 >= 0x1c)

3083 
m_off
 = 
Ï¡_m_off
;

3086 
m_off
 = 1 + (m_ofà<< 6è+ (*

++ >> 2);

3087 
Ï¡_m_off
 = 
m_off
;

3089 
t
 = (t >> 5) - 1;

3092 #ià
	`defšed
(
LZO1X
)

3093 
m_pos
 = 
İ
 - 1;

3094 
m_pos
 -ğ(
t
 >> 2) & 7;

3095 
m_pos
 -ğ*

++ << 3;

3096 
t
 = (t >> 5) - 1;

3097 #–ià
	`defšed
(
LZO1Y
)

3098 
m_pos
 = 
İ
 - 1;

3099 
m_pos
 -ğ(
t
 >> 2) & 3;

3100 
m_pos
 -ğ*

++ << 2;

3101 
t
 = (t >> 4) - 3;

3102 #–ià
	`defšed
(
LZO1Z
)

3104 
lzo_ušt
 
off
 = 
t
 & 0x1f;

3105 
m_pos
 = 
İ
;

3106 ià(
off
 >= 0x1c)

3108 
	`as£¹
(
Ï¡_m_off
 > 0);

3109 
m_pos
 -ğ
Ï¡_m_off
;

3113 
off
 = 1 + (ofà<< 6è+ (*

++ >> 2);

3114 
m_pos
 -ğ
off
;

3115 
Ï¡_m_off
 = 
off
;

3118 
t
 = (t >> 5) - 1;

3120 
	`TEST_LB
(
m_pos
); 
	`as£¹
(
t
 > 0); 
	`NEED_OP
(t+3-1);

3121 
cİy_m©ch
;

3124 ià(
t
 >= 32)

3126 
t
 &= 31;

3127 ià(
t
 == 0)

3129 
	`NEED_IP
(1);

3130 *

 == 0)

3132 
t
 += 255;

3133 

++;

3134 
	`NEED_IP
(1);

3136 
t
 +ğ31 + *

++;

3138 #ià
	`defšed
(
COPY_DICT
)

3139 #ià
	`defšed
(
LZO1Z
)

3140 
m_off
 = 1 + (

[0] << 6) + (ip[1] >> 2);

3141 
Ï¡_m_off
 = 
m_off
;

3143 
m_off
 = 1 + (

[0] >> 2) + (ip[1] << 6);

3146 #ià
	`defšed
(
LZO1Z
)

3148 
lzo_ušt
 
off
 = 1 + (

[0] << 6) + (ip[1] >> 2);

3149 
m_pos
 = 
İ
 - 
off
;

3150 
Ï¡_m_off
 = 
off
;

3152 #–ià
	`defšed
(
LZO_UNALIGNED_OK_2
è&& defšed(
LZO_ABI_LITTLE_ENDIAN
)

3153 
m_pos
 = 
İ
 - 1;

3154 
m_pos
 -ğ(* (cÚ¡ 
lzo_ushÜ
è

) >> 2;

3156 
m_pos
 = 
İ
 - 1;

3157 
m_pos
 -ğ(

[0] >> 2) + (ip[1] << 6);

3160 

 += 2;

3162 ià(
t
 >= 16)

3164 #ià
	`defšed
(
COPY_DICT
)

3165 
m_off
 = (
t
 & 8) << 11;

3167 
m_pos
 = 
İ
;

3168 
m_pos
 -ğ(
t
 & 8) << 11;

3170 
t
 &= 7;

3171 ià(
t
 == 0)

3173 
	`NEED_IP
(1);

3174 *

 == 0)

3176 
t
 += 255;

3177 

++;

3178 
	`NEED_IP
(1);

3180 
t
 +ğ7 + *

++;

3182 #ià
	`defšed
(
COPY_DICT
)

3183 #ià
	`defšed
(
LZO1Z
)

3184 
m_off
 +ğ(

[0] << 6) + (ip[1] >> 2);

3186 
m_off
 +ğ(

[0] >> 2) + (ip[1] << 6);

3188 

 += 2;

3189 ià(
m_off
 == 0)

3190 
eof_found
;

3191 
m_off
 += 0x4000;

3192 #ià
	`defšed
(
LZO1Z
)

3193 
Ï¡_m_off
 = 
m_off
;

3196 #ià
	`defšed
(
LZO1Z
)

3197 
m_pos
 -ğ(

[0] << 6) + (ip[1] >> 2);

3198 #–ià
	`defšed
(
LZO_UNALIGNED_OK_2
è&& defšed(
LZO_ABI_LITTLE_ENDIAN
)

3199 
m_pos
 -ğ(* (cÚ¡ 
lzo_ushÜ
è

) >> 2;

3201 
m_pos
 -ğ(

[0] >> 2) + (ip[1] << 6);

3203 

 += 2;

3204 ià(
m_pos
 =ğ
İ
)

3205 
eof_found
;

3206 
m_pos
 -= 0x4000;

3207 #ià
	`defšed
(
LZO1Z
)

3208 
Ï¡_m_off
 = 
	`pd
((cÚ¡ 
lzo_by‹p
)
İ
, 
m_pos
);

3214 #ià
	`defšed
(
COPY_DICT
)

3215 #ià
	`defšed
(
LZO1Z
)

3216 
m_off
 = 1 + (
t
 << 6è+ (*

++ >> 2);

3217 
Ï¡_m_off
 = 
m_off
;

3219 
m_off
 = 1 + (
t
 >> 2è+ (*

++ << 2);

3221 
	`NEED_OP
(2);

3222 
t
 = 2; 
	`COPY_DICT
Ñ,
m_off
)

3224 #ià
	`defšed
(
LZO1Z
)

3225 
t
 = 1 + (ˆ<< 6è+ (*

++ >> 2);

3226 
m_pos
 = 
İ
 - 
t
;

3227 
Ï¡_m_off
 = 
t
;

3229 
m_pos
 = 
İ
 - 1;

3230 
m_pos
 -ğ
t
 >> 2;

3231 
m_pos
 -ğ*

++ << 2;

3233 
	`TEST_LB
(
m_pos
); 
	`NEED_OP
(2);

3234 *
İ
++ = *
m_pos
++; *op++ = *m_pos;

3236 
m©ch_dÚe
;

3239 #ià
	`defšed
(
COPY_DICT
)

3241 
	`NEED_OP
(
t
+3-1);

3242 
t
 +ğ3-1; 
	`COPY_DICT
Ñ,
m_off
)

3246 
	`TEST_LB
(
m_pos
); 
	`as£¹
(
t
 > 0); 
	`NEED_OP
(t+3-1);

3247 #ià
	`defšed
(
LZO_UNALIGNED_OK_4
è|| defšed(
LZO_ALIGNED_OK_4
)

3248 #ià!
	`defšed
(
LZO_UNALIGNED_OK_4
)

3249 ià(
t
 >ğ2 * 4 - (3 - 1è&& 
	`PTR_ALIGNED2_4
(
İ
,
m_pos
))

3251 
	`as£¹
((
İ
 - 
m_pos
) >= 4);

3253 ià(
t
 >ğ2 * 4 - (3 - 1è&& (
İ
 - 
m_pos
) >= 4)

3256 
	`COPY4
(
İ
,
m_pos
);

3257 
İ
 +ğ4; 
m_pos
 +ğ4; 
t
 -= 4 - (3 - 1);

3259 
	`COPY4
(
İ
,
m_pos
);

3260 
İ
 +ğ4; 
m_pos
 +ğ4; 
t
 -= 4;

3261 } 
t
 >= 4);

3262 ià(
t
 > 0èdØ*
İ
++ = *
m_pos
++; --t > 0);

3267 
cİy_m©ch
:

3268 *
İ
++ = *
m_pos
++; *op++ = *m_pos++;

3269 dØ*
İ
++ = *
m_pos
++; --
t
 > 0);

3274 
m©ch_dÚe
:

3275 #ià
	`defšed
(
LZO1Z
)

3276 
t
 = 

[-1] & 3;

3278 
t
 = 

[-2] & 3;

3280 ià(
t
 == 0)

3283 
m©ch_Ãxt
:

3284 
	`as£¹
(
t
 > 0);‡s£¹Ñ < 4); 
	`NEED_OP
Ñ); 
	`NEED_IP
(t+1);

3286 dØ*
İ
++ = *

++; --
t
 > 0);

3288 *
İ
++ = *

++;

3289 ià(
t
 > 1è{ *
İ
++ = *

++; if (t > 2) { *op++ = *ip++; } }

3291 
t
 = *

++;

3292 } 
TEST_IP
 && 
TEST_OP
);

3295 #ià
	`defšed
(
HAVE_TEST_IP
è|| defšed(
HAVE_TEST_OP
)

3296 *
out_Ën
 = 
	`pd
(
İ
, 
out
);

3297  
LZO_E_EOF_NOT_FOUND
;

3300 
eof_found
:

3301 
	`as£¹
(
t
 == 1);

3302 *
out_Ën
 = 
	`pd
(
İ
, 
out
);

3303  (

 =ğ
_’d
 ? 
LZO_E_OK
 :

3304 (

 < 
_’d
 ? 
LZO_E_INPUT_NOT_CONSUMED
 : 
LZO_E_INPUT_OVERRUN
));

3306 #ià
	`defšed
(
HAVE_NEED_IP
)

3307 
šput_ov”run
:

3308 *
out_Ën
 = 
	`pd
(
İ
, 
out
);

3309  
LZO_E_INPUT_OVERRUN
;

3312 #ià
	`defšed
(
HAVE_NEED_OP
)

3313 
ouut_ov”run
:

3314 *
out_Ën
 = 
	`pd
(
İ
, 
out
);

3315  
LZO_E_OUTPUT_OVERRUN
;

3318 #ià
	`defšed
(
LZO_TEST_OVERRUN_LOOKBEHIND
)

3319 
lookbehšd_ov”run
:

3320 *
out_Ën
 = 
	`pd
(
İ
, 
out
);

3321  
LZO_E_LOOKBEHIND_OVERRUN
;

3323 
	}
}

3327 
	#LZO_TEST_OVERRUN


	)

3328 #undeà
DO_DECOMPRESS


3329 
	#DO_DECOMPRESS
 
lzo1x_decom´ess_§ã


	)

3331 #ià!
defšed
(
MINILZO_CFG_SKIP_LZO1X_DECOMPRESS_SAFE
)

3333 #ià
defšed
(
LZO_TEST_OVERRUN
)

3334 #ià!
defšed
(
LZO_TEST_OVERRUN_INPUT
)

3335 
	#LZO_TEST_OVERRUN_INPUT
 2

	)

3337 #ià!
defšed
(
LZO_TEST_OVERRUN_OUTPUT
)

3338 
	#LZO_TEST_OVERRUN_OUTPUT
 2

	)

3340 #ià!
defšed
(
LZO_TEST_OVERRUN_LOOKBEHIND
)

3341 
	#LZO_TEST_OVERRUN_LOOKBEHIND


	)

3345 #undeà
TEST_IP


3346 #undeà
TEST_OP


3347 #undeà
TEST_LB


3348 #undeà
TEST_LBO


3349 #undeà
NEED_IP


3350 #undeà
NEED_OP


3351 #undeà
HAVE_TEST_IP


3352 #undeà
HAVE_TEST_OP


3353 #undeà
HAVE_NEED_IP


3354 #undeà
HAVE_NEED_OP


3355 #undeà
HAVE_ANY_IP


3356 #undeà
HAVE_ANY_OP


3358 #ià
defšed
(
LZO_TEST_OVERRUN_INPUT
)

3359 #ià(
LZO_TEST_OVERRUN_INPUT
 >= 1)

3360 
	#TEST_IP
 (

 < 
_’d
)

	)

3362 #ià(
LZO_TEST_OVERRUN_INPUT
 >= 2)

3363 
	#NEED_IP
(
x
) \

3364 ià((
lzo_ušt
)(
_’d
 - 

è< (lzo_ušt)(
x
)è
šput_ov”run


	)

3368 #ià
defšed
(
LZO_TEST_OVERRUN_OUTPUT
)

3369 #ià(
LZO_TEST_OVERRUN_OUTPUT
 >= 1)

3370 
	#TEST_OP
 (
İ
 <ğ
İ_’d
)

	)

3372 #ià(
LZO_TEST_OVERRUN_OUTPUT
 >= 2)

3373 #undeà
TEST_OP


3374 
	#NEED_OP
(
x
) \

3375 ià((
lzo_ušt
)(
İ_’d
 - 
İ
è< (lzo_ušt)(
x
)è
ouut_ov”run


	)

3379 #ià
defšed
(
LZO_TEST_OVERRUN_LOOKBEHIND
)

3380 
	#TEST_LB
(
m_pos
èià(m_po < 
out
 || m_po >ğ
İ
è
lookbehšd_ov”run


	)

3381 
	#TEST_LBO
(
m_pos
,
o
èià(m_po < 
out
 || m_po >ğ
İ
 - (o)è
lookbehšd_ov”run


	)

3383 
	#TEST_LB
(
m_pos
è((è0)

	)

3384 
	#TEST_LBO
(
m_pos
,
o
è((è0)

	)

3387 #ià!
defšed
(
LZO_EOF_CODE
è&& !defšed(
TEST_IP
)

3388 
	#TEST_IP
 (

 < 
_’d
)

	)

3391 #ià
defšed
(
TEST_IP
)

3392 
	#HAVE_TEST_IP


	)

3394 
	#TEST_IP
 1

	)

3396 #ià
defšed
(
TEST_OP
)

3397 
	#HAVE_TEST_OP


	)

3399 
	#TEST_OP
 1

	)

3402 #ià
defšed
(
NEED_IP
)

3403 
	#HAVE_NEED_IP


	)

3405 
	#NEED_IP
(
x
è((è0)

	)

3407 #ià
defšed
(
NEED_OP
)

3408 
	#HAVE_NEED_OP


	)

3410 
	#NEED_OP
(
x
è((è0)

	)

3413 #ià
defšed
(
HAVE_TEST_IP
è|| defšed(
HAVE_NEED_IP
)

3414 
	#HAVE_ANY_IP


	)

3416 #ià
defšed
(
HAVE_TEST_OP
è|| defšed(
HAVE_NEED_OP
)

3417 
	#HAVE_ANY_OP


	)

3420 #undeà
__COPY4


3421 
	#__COPY4
(
d¡
,
¤c
è* (
lzo_ušt32p
)(d¡èğ* (cÚ¡†zo_ušt32p)(¤c)

	)

3423 #undeà
COPY4


3424 #ià
defšed
(
LZO_UNALIGNED_OK_4
)

3425 
	#COPY4
(
d¡
,
¤c
è
	`__COPY4
(d¡,¤c)

	)

3426 #–ià
defšed
(
LZO_ALIGNED_OK_4
)

3427 
	#COPY4
(
d¡
,
¤c
è
	`__COPY4
((
lzo_ušŒ_t
)(d¡),Özo_ušŒ_t)(¤c))

	)

3430 #ià
defšed
(
DO_DECOMPRESS
)

3431 
	$LZO_PUBLIC
()

3432 
	$DO_DECOMPRESS
 ( cÚ¡ 
lzo_by‹p
 
š
 , 
lzo_ušt
 
š_Ën
,

3433 
lzo_by‹p
 
out
, 
lzo_uš
 
out_Ën
,

3434 
lzo_voidp
 
wrkmem
 )

3437 
lzo_by‹p
 
İ
;

3438 cÚ¡ 
lzo_by‹p
 

;

3439 
lzo_ušt
 
t
;

3440 #ià
	`defšed
(
COPY_DICT
)

3441 
lzo_ušt
 
m_off
;

3442 cÚ¡ 
lzo_by‹p
 
diù_’d
;

3444 cÚ¡ 
lzo_by‹p
 
m_pos
;

3447 cÚ¡ 
lzo_by‹p
 cÚ¡ 
_’d
 = 
š
 + 
š_Ën
;

3448 #ià
	`defšed
(
HAVE_ANY_OP
)

3449 
lzo_by‹p
 cÚ¡ 
İ_’d
 = 
out
 + *
out_Ën
;

3451 #ià
	`defšed
(
LZO1Z
)

3452 
lzo_ušt
 
Ï¡_m_off
 = 0;

3455 
	`LZO_UNUSED
(
wrkmem
);

3457 #ià
	`defšed
(
COPY_DICT
)

3458 ià(
diù
)

3460 ià(
diù_Ën
 > 
M4_MAX_OFFSET
)

3462 
diù
 +ğ
diù_Ën
 - 
M4_MAX_OFFSET
;

3463 
diù_Ën
 = 
M4_MAX_OFFSET
;

3465 
diù_’d
 = 
diù
 + 
diù_Ën
;

3469 
diù_Ën
 = 0;

3470 
diù_’d
 = 
NULL
;

3474 *
out_Ën
 = 0;

3476 
İ
 = 
out
;

3477 

 = 
š
;

3479 ià(*

 > 17)

3481 
t
 = *

++ - 17;

3482 ià(
t
 < 4)

3483 
m©ch_Ãxt
;

3484 
	`as£¹
(
t
 > 0); 
	`NEED_OP
Ñ); 
	`NEED_IP
(t+1);

3485 dØ*
İ
++ = *

++; --
t
 > 0);

3486 
fœ¡_l™”®_run
;

3489 
TEST_IP
 && 
TEST_OP
)

3491 
t
 = *

++;

3492 ià(
t
 >= 16)

3493 
m©ch
;

3494 ià(
t
 == 0)

3496 
	`NEED_IP
(1);

3497 *

 == 0)

3499 
t
 += 255;

3500 

++;

3501 
	`NEED_IP
(1);

3503 
t
 +ğ15 + *

++;

3505 
	`as£¹
(
t
 > 0); 
	`NEED_OP
Ñ+3); 
	`NEED_IP
(t+4);

3506 #ià
	`defšed
(
LZO_UNALIGNED_OK_4
è|| defšed(
LZO_ALIGNED_OK_4
)

3507 #ià!
	`defšed
(
LZO_UNALIGNED_OK_4
)

3508 ià(
	`PTR_ALIGNED2_4
(
İ
,

))

3511 
	`COPY4
(
İ
,

);

3512 
İ
 +ğ4; 

 += 4;

3513 ià(--
t
 > 0)

3515 ià(
t
 >= 4)

3518 
	`COPY4
(
İ
,

);

3519 
İ
 +ğ4; 

 +ğ4; 
t
 -= 4;

3520 } 
t
 >= 4);

3521 ià(
t
 > 0èdØ*
İ
++ = *

++; --t > 0);

3524 dØ*
İ
++ = *

++; --
t
 > 0);

3526 #ià!
	`defšed
(
LZO_UNALIGNED_OK_4
)

3531 #ià!
	`defšed
(
LZO_UNALIGNED_OK_4
)

3533 *
İ
++ = *

++; *op++ = *ip++; *op++ = *ip++;

3534 dØ*
İ
++ = *

++; --
t
 > 0);

3538 
fœ¡_l™”®_run
:

3540 
t
 = *

++;

3541 ià(
t
 >= 16)

3542 
m©ch
;

3543 #ià
	`defšed
(
COPY_DICT
)

3544 #ià
	`defšed
(
LZO1Z
)

3545 
m_off
 = (1 + 
M2_MAX_OFFSET
è+ (
t
 << 6è+ (*

++ >> 2);

3546 
Ï¡_m_off
 = 
m_off
;

3548 
m_off
 = (1 + 
M2_MAX_OFFSET
è+ (
t
 >> 2è+ (*

++ << 2);

3550 
	`NEED_OP
(3);

3551 
t
 = 3; 
	`COPY_DICT
Ñ,
m_off
)

3553 #ià
	`defšed
(
LZO1Z
)

3554 
t
 = (1 + 
M2_MAX_OFFSET
è+ (ˆ<< 6è+ (*

++ >> 2);

3555 
m_pos
 = 
İ
 - 
t
;

3556 
Ï¡_m_off
 = 
t
;

3558 
m_pos
 = 
İ
 - (1 + 
M2_MAX_OFFSET
);

3559 
m_pos
 -ğ
t
 >> 2;

3560 
m_pos
 -ğ*

++ << 2;

3562 
	`TEST_LB
(
m_pos
); 
	`NEED_OP
(3);

3563 *
İ
++ = *
m_pos
++; *op++ = *m_pos++; *op++ = *m_pos;

3565 
m©ch_dÚe
;

3568 
m©ch
:

3569 ià(
t
 >= 64)

3571 #ià
	`defšed
(
COPY_DICT
)

3572 #ià
	`defšed
(
LZO1X
)

3573 
m_off
 = 1 + ((
t
 >> 2è& 7è+ (*

++ << 3);

3574 
t
 = (t >> 5) - 1;

3575 #–ià
	`defšed
(
LZO1Y
)

3576 
m_off
 = 1 + ((
t
 >> 2è& 3è+ (*

++ << 2);

3577 
t
 = (t >> 4) - 3;

3578 #–ià
	`defšed
(
LZO1Z
)

3579 
m_off
 = 
t
 & 0x1f;

3580 ià(
m_off
 >= 0x1c)

3581 
m_off
 = 
Ï¡_m_off
;

3584 
m_off
 = 1 + (m_ofà<< 6è+ (*

++ >> 2);

3585 
Ï¡_m_off
 = 
m_off
;

3587 
t
 = (t >> 5) - 1;

3590 #ià
	`defšed
(
LZO1X
)

3591 
m_pos
 = 
İ
 - 1;

3592 
m_pos
 -ğ(
t
 >> 2) & 7;

3593 
m_pos
 -ğ*

++ << 3;

3594 
t
 = (t >> 5) - 1;

3595 #–ià
	`defšed
(
LZO1Y
)

3596 
m_pos
 = 
İ
 - 1;

3597 
m_pos
 -ğ(
t
 >> 2) & 3;

3598 
m_pos
 -ğ*

++ << 2;

3599 
t
 = (t >> 4) - 3;

3600 #–ià
	`defšed
(
LZO1Z
)

3602 
lzo_ušt
 
off
 = 
t
 & 0x1f;

3603 
m_pos
 = 
İ
;

3604 ià(
off
 >= 0x1c)

3606 
	`as£¹
(
Ï¡_m_off
 > 0);

3607 
m_pos
 -ğ
Ï¡_m_off
;

3611 
off
 = 1 + (ofà<< 6è+ (*

++ >> 2);

3612 
m_pos
 -ğ
off
;

3613 
Ï¡_m_off
 = 
off
;

3616 
t
 = (t >> 5) - 1;

3618 
	`TEST_LB
(
m_pos
); 
	`as£¹
(
t
 > 0); 
	`NEED_OP
(t+3-1);

3619 
cİy_m©ch
;

3622 ià(
t
 >= 32)

3624 
t
 &= 31;

3625 ià(
t
 == 0)

3627 
	`NEED_IP
(1);

3628 *

 == 0)

3630 
t
 += 255;

3631 

++;

3632 
	`NEED_IP
(1);

3634 
t
 +ğ31 + *

++;

3636 #ià
	`defšed
(
COPY_DICT
)

3637 #ià
	`defšed
(
LZO1Z
)

3638 
m_off
 = 1 + (

[0] << 6) + (ip[1] >> 2);

3639 
Ï¡_m_off
 = 
m_off
;

3641 
m_off
 = 1 + (

[0] >> 2) + (ip[1] << 6);

3644 #ià
	`defšed
(
LZO1Z
)

3646 
lzo_ušt
 
off
 = 1 + (

[0] << 6) + (ip[1] >> 2);

3647 
m_pos
 = 
İ
 - 
off
;

3648 
Ï¡_m_off
 = 
off
;

3650 #–ià
	`defšed
(
LZO_UNALIGNED_OK_2
è&& defšed(
LZO_ABI_LITTLE_ENDIAN
)

3651 
m_pos
 = 
İ
 - 1;

3652 
m_pos
 -ğ(* (cÚ¡ 
lzo_ushÜ
è

) >> 2;

3654 
m_pos
 = 
İ
 - 1;

3655 
m_pos
 -ğ(

[0] >> 2) + (ip[1] << 6);

3658 

 += 2;

3660 ià(
t
 >= 16)

3662 #ià
	`defšed
(
COPY_DICT
)

3663 
m_off
 = (
t
 & 8) << 11;

3665 
m_pos
 = 
İ
;

3666 
m_pos
 -ğ(
t
 & 8) << 11;

3668 
t
 &= 7;

3669 ià(
t
 == 0)

3671 
	`NEED_IP
(1);

3672 *

 == 0)

3674 
t
 += 255;

3675 

++;

3676 
	`NEED_IP
(1);

3678 
t
 +ğ7 + *

++;

3680 #ià
	`defšed
(
COPY_DICT
)

3681 #ià
	`defšed
(
LZO1Z
)

3682 
m_off
 +ğ(

[0] << 6) + (ip[1] >> 2);

3684 
m_off
 +ğ(

[0] >> 2) + (ip[1] << 6);

3686 

 += 2;

3687 ià(
m_off
 == 0)

3688 
eof_found
;

3689 
m_off
 += 0x4000;

3690 #ià
	`defšed
(
LZO1Z
)

3691 
Ï¡_m_off
 = 
m_off
;

3694 #ià
	`defšed
(
LZO1Z
)

3695 
m_pos
 -ğ(

[0] << 6) + (ip[1] >> 2);

3696 #–ià
	`defšed
(
LZO_UNALIGNED_OK_2
è&& defšed(
LZO_ABI_LITTLE_ENDIAN
)

3697 
m_pos
 -ğ(* (cÚ¡ 
lzo_ushÜ
è

) >> 2;

3699 
m_pos
 -ğ(

[0] >> 2) + (ip[1] << 6);

3701 

 += 2;

3702 ià(
m_pos
 =ğ
İ
)

3703 
eof_found
;

3704 
m_pos
 -= 0x4000;

3705 #ià
	`defšed
(
LZO1Z
)

3706 
Ï¡_m_off
 = 
	`pd
((cÚ¡ 
lzo_by‹p
)
İ
, 
m_pos
);

3712 #ià
	`defšed
(
COPY_DICT
)

3713 #ià
	`defšed
(
LZO1Z
)

3714 
m_off
 = 1 + (
t
 << 6è+ (*

++ >> 2);

3715 
Ï¡_m_off
 = 
m_off
;

3717 
m_off
 = 1 + (
t
 >> 2è+ (*

++ << 2);

3719 
	`NEED_OP
(2);

3720 
t
 = 2; 
	`COPY_DICT
Ñ,
m_off
)

3722 #ià
	`defšed
(
LZO1Z
)

3723 
t
 = 1 + (ˆ<< 6è+ (*

++ >> 2);

3724 
m_pos
 = 
İ
 - 
t
;

3725 
Ï¡_m_off
 = 
t
;

3727 
m_pos
 = 
İ
 - 1;

3728 
m_pos
 -ğ
t
 >> 2;

3729 
m_pos
 -ğ*

++ << 2;

3731 
	`TEST_LB
(
m_pos
); 
	`NEED_OP
(2);

3732 *
İ
++ = *
m_pos
++; *op++ = *m_pos;

3734 
m©ch_dÚe
;

3737 #ià
	`defšed
(
COPY_DICT
)

3739 
	`NEED_OP
(
t
+3-1);

3740 
t
 +ğ3-1; 
	`COPY_DICT
Ñ,
m_off
)

3744 
	`TEST_LB
(
m_pos
); 
	`as£¹
(
t
 > 0); 
	`NEED_OP
(t+3-1);

3745 #ià
	`defšed
(
LZO_UNALIGNED_OK_4
è|| defšed(
LZO_ALIGNED_OK_4
)

3746 #ià!
	`defšed
(
LZO_UNALIGNED_OK_4
)

3747 ià(
t
 >ğ2 * 4 - (3 - 1è&& 
	`PTR_ALIGNED2_4
(
İ
,
m_pos
))

3749 
	`as£¹
((
İ
 - 
m_pos
) >= 4);

3751 ià(
t
 >ğ2 * 4 - (3 - 1è&& (
İ
 - 
m_pos
) >= 4)

3754 
	`COPY4
(
İ
,
m_pos
);

3755 
İ
 +ğ4; 
m_pos
 +ğ4; 
t
 -= 4 - (3 - 1);

3757 
	`COPY4
(
İ
,
m_pos
);

3758 
İ
 +ğ4; 
m_pos
 +ğ4; 
t
 -= 4;

3759 } 
t
 >= 4);

3760 ià(
t
 > 0èdØ*
İ
++ = *
m_pos
++; --t > 0);

3765 
cİy_m©ch
:

3766 *
İ
++ = *
m_pos
++; *op++ = *m_pos++;

3767 dØ*
İ
++ = *
m_pos
++; --
t
 > 0);

3772 
m©ch_dÚe
:

3773 #ià
	`defšed
(
LZO1Z
)

3774 
t
 = 

[-1] & 3;

3776 
t
 = 

[-2] & 3;

3778 ià(
t
 == 0)

3781 
m©ch_Ãxt
:

3782 
	`as£¹
(
t
 > 0);‡s£¹Ñ < 4); 
	`NEED_OP
Ñ); 
	`NEED_IP
(t+1);

3784 dØ*
İ
++ = *

++; --
t
 > 0);

3786 *
İ
++ = *

++;

3787 ià(
t
 > 1è{ *
İ
++ = *

++; if (t > 2) { *op++ = *ip++; } }

3789 
t
 = *

++;

3790 } 
TEST_IP
 && 
TEST_OP
);

3793 #ià
	`defšed
(
HAVE_TEST_IP
è|| defšed(
HAVE_TEST_OP
)

3794 *
out_Ën
 = 
	`pd
(
İ
, 
out
);

3795  
LZO_E_EOF_NOT_FOUND
;

3798 
eof_found
:

3799 
	`as£¹
(
t
 == 1);

3800 *
out_Ën
 = 
	`pd
(
İ
, 
out
);

3801  (

 =ğ
_’d
 ? 
LZO_E_OK
 :

3802 (

 < 
_’d
 ? 
LZO_E_INPUT_NOT_CONSUMED
 : 
LZO_E_INPUT_OVERRUN
));

3804 #ià
	`defšed
(
HAVE_NEED_IP
)

3805 
šput_ov”run
:

3806 *
out_Ën
 = 
	`pd
(
İ
, 
out
);

3807  
LZO_E_INPUT_OVERRUN
;

3810 #ià
	`defšed
(
HAVE_NEED_OP
)

3811 
ouut_ov”run
:

3812 *
out_Ën
 = 
	`pd
(
İ
, 
out
);

3813  
LZO_E_OUTPUT_OVERRUN
;

3816 #ià
	`defšed
(
LZO_TEST_OVERRUN_LOOKBEHIND
)

3817 
lookbehšd_ov”run
:

3818 *
out_Ën
 = 
	`pd
(
İ
, 
out
);

3819  
LZO_E_LOOKBEHIND_OVERRUN
;

3821 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/lzo/minilzo.h

43 #iâdeà
__MINILZO_H


44 
	#__MINILZO_H


	)

46 
	#MINILZO_VERSION
 0x2020

	)

48 #ifdeà
__LZOCONF_H


52 #undeà
LZO_HAVE_CONFIG_H


53 
	~"lzocÚf.h
"

55 #ià!
defšed
(
LZO_VERSION
è|| (LZO_VERSION !ğ
MINILZO_VERSION
)

60 #ifdeà
__ılu¥lus


73 
	#LZO1X_MEM_COMPRESS
 
LZO1X_1_MEM_COMPRESS


	)

74 
	#LZO1X_1_MEM_COMPRESS
 ((
lzo_ušt32
è(16384L * 
lzo_sizeof_diù_t
))

	)

75 
	#LZO1X_MEM_DECOMPRESS
 (0)

	)

79 
LZO_EXTERN
()

80 
lzo1x_1_com´ess
 ( cÚ¡ 
lzo_by‹p
 
¤c
, 
lzo_ušt
 
¤c_Ën
,

81 
lzo_by‹p
 
d¡
, 
lzo_uš
 
d¡_Ën
,

82 
lzo_voidp
 
wrkmem
 );

85 
LZO_EXTERN
()

86 
lzo1x_decom´ess
 ( cÚ¡ 
lzo_by‹p
 
¤c
, 
lzo_ušt
 
¤c_Ën
,

87 
lzo_by‹p
 
d¡
, 
lzo_uš
 
d¡_Ën
,

88 
lzo_voidp
 
wrkmem
 );

91 
LZO_EXTERN
()

92 
lzo1x_decom´ess_§ã
 ( cÚ¡ 
lzo_by‹p
 
¤c
, 
lzo_ušt
 
¤c_Ën
,

93 
lzo_by‹p
 
d¡
, 
lzo_uš
 
d¡_Ën
,

94 
lzo_voidp
 
wrkmem
 );

97 #ifdeà
__ılu¥lus


	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/quicklz.c

11 
	#QLZ_VERSION_MAJOR
 1

	)

12 
	#QLZ_VERSION_MINOR
 3

	)

13 
	#QLZ_VERSION_REVISION
 0

	)

16 
	#COMPRESSION_LEVEL
 0

	)

18 
	#‹¡_¾e


	)

19 
	#¥“dup_šcom´essibË


	)

23 
size_t
 
qlz_decom´ess
(cÚ¡ *
sourû
, *
de¡š©iÚ
, *
sü©ch
);

24 
size_t
 
qlz_com´ess
(cÚ¡ *
sourû
, *
de¡š©iÚ
, size_ˆ
size
, *
sü©ch
);

25 
size_t
 
qlz_size_decom´es£d
(cÚ¡ *
sourû
);

26 
size_t
 
qlz_size_com´es£d
(cÚ¡ *
sourû
);

27 
qlz_g‘_£‰šg
(
£‰šg
);

29 
	~<¡ršg.h
>

31 #ià(
defšed
(
__X86__
è|| defšed(
__i386__
è|| defšed(
i386
è|| defšed(
_M_IX86
è|| defšed(
__386__
è|| defšed(
__x86_64__
è|| defšed(
_M_X64
))

32 
	#X86X64


	)

36 #ià
COMPRESSION_LEVEL
 =ğ0 && 
defšed
(
memÜy_§ã
)

37 #”rÜ 
memÜy_§ã
 
æag
 
ÿÂÙ
 
be
 
u£d
 
w™h
 
COMPRESSION_LEVEL
 0

40 
	#HASH_ENTRIES
 4096

	)

42 #ià(
COMPRESSION_LEVEL
 == 0 || COMPRESSION_LEVEL == 1 || COMPRESSION_LEVEL == 2)

43 
	#AND
 1

	)

44 #–ià(
COMPRESSION_LEVEL
 == 3)

45 
	#AND
 0x7

	)

47 #”rÜ 
COMPRESSION_LEVEL
 
mu¡
 
be
 0, 1, 2 
Ü
 3

50 
	#HASH_SIZE
 (
AND
 + 1)*
HASH_ENTRIES
*(*)

	)

52 #ifdeà
STREAMING_MODE


53 
	#STREAMING_MODE_VALUE
 
STREAMING_MODE


	)

55 
	#STREAMING_MODE_VALUE
 0

	)

58 
	#STREAMING_MODE_ROUNDED
 ((
STREAMING_MODE_VALUE
 >> 3è<< 3)

	)

60 #ià(
COMPRESSION_LEVEL
 > 1)

61 
	#SCRATCH_COMPRESS
 
HASH_SIZE
 + 
STREAMING_MODE_VALUE
 + 16 + 
HASH_ENTRIES


	)

63 
	#SCRATCH_COMPRESS
 
HASH_SIZE
 + 
STREAMING_MODE_VALUE
 + 16

	)

66 #ià(
COMPRESSION_LEVEL
 == 0)

67 
	#SCRATCH_DECOMPRESS
 
HASH_ENTRIES
*(*è+ 16 + 
STREAMING_MODE_VALUE


	)

69 
	#SCRATCH_DECOMPRESS
 16 + 
STREAMING_MODE_VALUE


	)

72 
	$qlz_g‘_£‰šg
(
£‰šg
)

74 
£‰šg
)

76 0:  
COMPRESSION_LEVEL
;

77 1:  
SCRATCH_COMPRESS
;

78 2:  
SCRATCH_DECOMPRESS
;

79 3:  
STREAMING_MODE_VALUE
;

80 #ifdeà
‹¡_¾e


85 #ifdeà
¥“dup_šcom´essibË


90 #ifdeà
memÜy_§ã


95 7:  
QLZ_VERSION_MAJOR
;

96 8:  
QLZ_VERSION_MINOR
;

97 9:  
QLZ_VERSION_REVISION
;

100 
	}
}

102 
__šlše
 
	$hash_func
(
i
)

104  ((
i
 >> 12) ^ i) & 0x0fff;

105 
	}
}

107 
__šlše
 
	$ç¡_»ad
(cÚ¡ *
¤c
, 
by‹s
)

109 #iâdeà
X86X64


110 *
p
 = (*)
¤c
;

111 
by‹s
)

114 (*
p
 | *(p + 1) << 8 | *(p + 2) << 16 | *(p + 3) << 24);

116 (*
p
 | *(p + 1) << 8 | *(p + 2) << 16);

118 (*
p
 | *(p + 1) << 8);

120 (*
p
);

124 ià(
by‹s
 >= 1 && bytes <= 4)

125  *((*)
¤c
);

129 
	}
}

131 
__šlše
 
	$ç¡_wr™e
(
f
, *
d¡
, 
by‹s
)

133 #iâdeà
X86X64


134 *
p
 = (*)
d¡
;

136 
by‹s
)

139 *
p
 = ()
f
;

140 *(
p
 + 1èğ()(
f
 >> 8);

141 *(
p
 + 2èğ()(
f
 >> 16);

142 *(
p
 + 3èğ()(
f
 >> 24);

145 *
p
 = ()
f
;

146 *(
p
 + 1èğ()(
f
 >> 8);

147 *(
p
 + 2èğ()(
f
 >> 16);

150 *
p
 = ()
f
;

151 *(
p
 + 1èğ()(
f
 >> 8);

154 *
p
 = ()
f
;

158 
by‹s
)

161 *((*)
d¡
èğ
f
;

164 *((*)
d¡
èğ
f
;

167 #ià
COMPRESSION_LEVEL
 == 0

169 *((*)
d¡
èğ()
f
;

171 *((*)
d¡
èğ
f
;

175 *((*)
d¡
èğ()
f
;

179 
	}
}

181 
__šlše
 
	$memıy_up
(*
d¡
, cÚ¡ *
¤c
, 
n
)

184 #iâdeà
X86X64


186 if(
n
 > 8 && 
¤c
 +‚ < 
d¡
)

187 
	`memıy
(
d¡
, 
¤c
, 
n
);

190 *
’d
 = 
d¡
 + 
n
;

191 
d¡
 < 
’d
)

193 *
d¡
 = *
¤c
;

194 
d¡
++;

195 
¤c
++;

199 ià(
n
 < 5)

200 *((*)
d¡
èğ*((*)
¤c
);

203 *
’d
 = 
d¡
 + 
n
;

204 
d¡
 < 
’d
)

206 *((*)
d¡
èğ*((*)
¤c
);

207 
d¡
 = dst + 4;

208 
¤c
 = src + 4;

212 
	}
}

214 
__šlše
 
	$ç¡_»ad_§ã
(cÚ¡ *
¤c
, 
by‹s
, cÚ¡ *
šv®id
)

216 #ifdeà
memÜy_§ã


217 ià((cÚ¡ *)
¤c
 + 4 > (cÚ¡ *)
šv®id
)

220 
šv®id
 = invalid;

221  
	`ç¡_»ad
(
¤c
, 
by‹s
);

222 
	}
}

224 
qlz_com´ess_cÜe
(cÚ¡ *
sourû
, *
de¡š©iÚ
, 
size
, cÚ¡ *
hashbË
[][
AND
 + 1], cÚ¡ *
fœ¡_v®id
, *
hash_couÁ”
)

226 cÚ¡ *
	gsourû_c
 = (cÚ¡ *)
sourû
;

227 *
	gde¡š©iÚ_c
 = (*)
de¡š©iÚ
;

228 cÚ¡ *
	gÏ¡_by‹
 = 
sourû_c
 + 
size
 - 1;

229 cÚ¡ *
	g¤c
 = 
sourû_c
;

230 *
	gcwÜd_±r
 = 
de¡š©iÚ_c
;

231 *
	gd¡
 = 
de¡š©iÚ_c
 + 4;

232 
	gcwÜd_v®
 = 1U << 31;

233 cÚ¡ *
	ggu¬ª‹e_uncom´es£d
 = 
Ï¡_by‹
 - 8;

235 #ifdeà
¥“dup_šcom´essibË


236 *
	g´ev_d¡
 = 
d¡
;

237 cÚ¡ *
	g´ev_¤c
 = 
¤c
;

240 
	ghash_couÁ”
 = 
hash_couÁ”
;

241 
	gfœ¡_v®id
 = 
fœ¡_v®id
;

244 
	g¤c
 < 
	gsourû_c
 + 4 && srø< 
	ggu¬ª‹e_uncom´es£d
)

246 
	gcwÜd_v®
 = (
cwÜd_v®
 >> 1);

247 *
	gd¡
 = *
¤c
;

248 
	gd¡
++;

249 
	g¤c
++;

252 
	g¤c
 < 
	ggu¬ª‹e_uncom´es£d
)

254 
	gãtch
;

255 ià((
	gcwÜd_v®
 & 1) == 1)

258 ià(
d¡
 > 
de¡š©iÚ_c
 + 
size
)

262 
ç¡_wr™e
((
cwÜd_v®
 >> 1è| (1U << 31), 
cwÜd_±r
, 4);

263 
	gcwÜd_±r
 = 
d¡
;

264 
	gd¡
 += 4;

265 
	gcwÜd_v®
 = 1U << 31;

267 #ifdeà
¥“dup_šcom´essibË


269 ià(
	gd¡
 - 
	g´ev_d¡
 > 
	g¤c
 - 
	g´ev_¤c
 && srø> 
	gsourû_c
 + 1000)

271 
	gq
;

272 
	gq
 = 0; q < 30 && 
	g¤c
 + 31 < 
	ggu¬ª‹e_uncom´es£d
 && 
	gd¡
 + 35 < 
	gde¡š©iÚ_c
 + 
	gsize
; q++)

275 #if(
COMPRESSION_LEVEL
 == 0)

276 
	gw
;

277 
	gw
 = 0; w < 31; w++)

279 
	gãtch
 = 
ç¡_»ad
(
¤c
 + 
w
, 4);

280 *(*)&
	ghashbË
[
hash_func
(
ãtch
)][0] = 
ç¡_»ad
(
¤c
 + 
w
, 4);

281 
	ghashbË
[
hash_func
(
ãtch
)][1] = 
¤c
 + 
w
;

284 
ç¡_wr™e
((1U << 31), 
d¡
 - 4, 4);

285 
memıy
(
d¡
, 
¤c
, 31);

287 
	gd¡
 += 4*8 - 1 + 4;

288 
	g¤c
 += 4*8 - 1;

289 
	g´ev_¤c
 = 
¤c
;

290 
	g´ev_d¡
 = 
d¡
;

291 
	gcwÜd_±r
 = 
d¡
 - 4;

296 #ifdeà
‹¡_¾e


298 ià(
ç¡_»ad
(
¤c
, 4) == fast_read(src + 1, 4))

300 cÚ¡ *
	gÜig_¤c
;

301 
	gãtch
 = 
ç¡_»ad
(
¤c
, 4);

302 
	gÜig_¤c
 = 
¤c
;

303 dØ
	g¤c
 = 
¤c
 + 4; ¤ø<ğ
gu¬ª‹e_uncom´es£d
 - 4 && 
ãtch
 =ğ
ç¡_»ad
(src, 4));

304 if((
	g¤c
 - 
	gÜig_¤c
) <= 2047)

306 
ç¡_wr™e
(((
ãtch
 & 0xffè<< 16è| ()((
¤c
 - 
Üig_¤c
è<< 4è| 15, 
d¡
, 4);

307 
	gd¡
 = 
d¡
 + 3;

311 
ç¡_wr™e
(((
ãtch
 & 0xffè<< 16è| 15, 
d¡
, 4);

312 
ç¡_wr™e
(()(
¤c
 - 
Üig_¤c
), 
d¡
 + 3, 4);

313 
	gd¡
 = 
d¡
 + 7;

315 
	gcwÜd_v®
 = (
cwÜd_v®
 >> 1) | (1 << 31);

320 cÚ¡ *
	go
;

321 
	ghash
, 
	gm©chËn
;

323 #if(
COMPRESSION_LEVEL
 < 2)

324 
	gÿched
;

326 
	gãtch
 = 
ç¡_»ad
(
¤c
, 4);

327 
	ghash
 = 
hash_func
(
ãtch
);

329 
	gÿched
 = 
ãtch
 ^ *(*)&
hashbË
[
hash
][0];

330 *(*)&
	ghashbË
[
hash
][0] = 
ãtch
;

332 
	go
 = 
hashbË
[
hash
][1];

333 
	ghashbË
[
hash
][1] = 
¤c
;

336 
	gc
;

337 
	gk
, 
	gm
;

338 cÚ¡ *
	goff£t2
 = 0;

340 
	gãtch
 = 
ç¡_»ad
(
¤c
, 4);

341 
	ghash
 = 
hash_func
(
ãtch
);

343 
	gm©chËn
 = 0;

344 
	gc
 = 
hash_couÁ”
[
hash
];

345 
	gk
 = 0; k < 
	gAND
 + 1; k++)

347 
	go
 = 
hashbË
[
hash
][(
c
 - 
k
è& 
AND
];

348 if(
	go
 > 
	gfœ¡_v®id
 && o < 
	g¤c
 - 3 && *(¤ø+ 
	gm©chËn
è=ğ*(
o
 + 
m©chËn
è&& (
ç¡_»ad
(o, 3è& 0xffffffè=ğ(
ãtch
 & 0xffffffè&& 
¤c
 - o < 131071)

350 
size_t
 
»maššg
;

351 
	g»maššg
 = 
gu¬ª‹e_uncom´es£d
 - 
¤c
;

352 
	gm
 = 3;

353 ià(
ç¡_»ad
(
o
, 4è=ğ
ãtch
)

355 *(
o
 + 
m
è=ğ*(
¤c
 + mè&& m < 
»maššg
)

356 
m
++;

358 ià(
	gm
 > 
	gm©chËn
)

360 
	gm©chËn
 = 
m
;

361 
	goff£t2
 = 
o
;

365 
	go
 = 
off£t2
;

366 
	gc
 = (
hash_couÁ”
[
hash
] + 1è& 
AND
;

367 
	ghash_couÁ”
[
hash
] = 
c
;

368 
	ghashbË
[
hash
][
c
] = 
¤c
;

371 #if(
COMPRESSION_LEVEL
 == 0)

372 ià(
	go
 !ğ0 && (
ÿched
 & 0xffffffè=ğ0 && 
¤c
 - 
o
 > 3)

373 #–if(
COMPRESSION_LEVEL
 == 1)

374 ià((
ÿched
 & 0xffffffè=ğ0 && 
o
 > 
fœ¡_v®id
 && o < 
¤c
 - 3 && ((
ç¡_»ad
(o, 3) ^ fast_read(src, 3)) & 0xffffff) == 0 && src - o < 131071)

375 #–if(
COMPRESSION_LEVEL
 > 1)

376 if(
m©chËn
 == 3)

379 
off£t
;

380 
	goff£t
 = ()(
¤c
 - 
o
);

382 #if(
COMPRESSION_LEVEL
 < 2)

383 ià(
	gÿched
 & 0xffffffff)

386 #ià(
COMPRESSION_LEVEL
 > 2)

387 
	gu
;

388 
	gu
 = 1; u < 3; u++)

390 
	ghash
 = 
hash_func
(
ç¡_»ad
(
¤c
 + 
u
, 4));

391 
	gc
 = (
hash_couÁ”
[
hash
] + 1è& 
AND
;

392 
	ghash_couÁ”
[
hash
] = 
c
;

393 
	ghashbË
[
hash
][
c
] = 
¤c
 + 
u
;

397 #ià(
COMPRESSION_LEVEL
 == 0)

398 
	gcwÜd_v®
 = (
cwÜd_v®
 >> 1) | (1U << 31);

399 
ç¡_wr™e
(3 | (
hash
 << 4), 
d¡
, 2);

400 
	g¤c
 += 3;

401 
	gd¡
 += 2;

404 if(
	goff£t
 <= 63)

407 *
d¡
 = ()(
off£t
 << 2);

408 
	gcwÜd_v®
 = (
cwÜd_v®
 >> 1) | (1U << 31);

409 
	g¤c
 += 3;

410 
	gd¡
++;

412 ià(
	goff£t
 <= 16383)

415 
f
 = (
off£t
 << 2) | 1;

416 
ç¡_wr™e
(
f
, 
d¡
, 2);

417 
	gcwÜd_v®
 = (
cwÜd_v®
 >> 1) | (1U << 31);

418 
	g¤c
 += 3;

419 
	gd¡
 += 2;

424 *
	gd¡
 = *
¤c
;

425 
	g¤c
++;

426 
	gd¡
++;

427 
	gcwÜd_v®
 = (
cwÜd_v®
 >> 1);

431 #if(
COMPRESSION_LEVEL
 > 1)

433 if(
	gm©chËn
 > 3)

435 #–if(
COMPRESSION_LEVEL
 < 2)

440 
	goff£t
;

442 #if(
COMPRESSION_LEVEL
 < 2)

443 cÚ¡ *
	gŞd_¤c
 = 
¤c
;

444 
	goff£t
 = ()(
¤c
 - 
o
);

445 
	gcwÜd_v®
 = (
cwÜd_v®
 >> 1) | (1U << 31);

447 
	g¤c
 += 3;

448 *(
	go
 + (
	g¤c
 - 
	gŞd_¤c
)è=ğ*
¤c
 && srø< 
gu¬ª‹e_uncom´es£d
)

449 
¤c
++;

450 
	gm©chËn
 = ()(
¤c
 - 
Şd_¤c
);

452 
	gu
;

453 
	goff£t
 = ()(
¤c
 - 
o
);

454 
	gcwÜd_v®
 = (
cwÜd_v®
 >> 1) | (1U << 31);

456 #ià(
COMPRESSION_LEVEL
 > 2)

457 
	gu
 = 1; u < 
	gm©chËn
; u++)

459 
	gu
 = 1; u < 
	gm©chËn
 && u < 5; u++)

462 
	ghash
 = 
hash_func
(
ç¡_»ad
(
¤c
 + 
u
, 4));

463 
	gc
 = (
hash_couÁ”
[
hash
] + 1è& 
AND
;

464 
	ghash_couÁ”
[
hash
] = 
c
;

465 
	ghashbË
[
hash
][
c
] = 
¤c
 + 
u
;

467 
	g¤c
 +ğ
m©chËn
;

470 #ià(
COMPRESSION_LEVEL
 == 0)

471 ià(
	gm©chËn
 < 15)

473 
ç¡_wr™e
(
m©chËn
 | (
hash
 << 4), 
d¡
, 2);

474 
	gd¡
 += 2;

476 ià(
	gm©chËn
 < 255)

478 
ç¡_wr™e
(
hash
 << 4, 
d¡
, 2);

479 *(
	gd¡
 + 2èğ()
m©chËn
;

480 
	gd¡
 += 3;

484 
ç¡_wr™e
(
hash
 << 4, 
d¡
, 2);

485 *(
	gd¡
 + 2) = 0;

486 
ç¡_wr™e
(
m©chËn
, 
d¡
 + 3, 4);

487 
	gd¡
 += 7;

490 ià(
	gm©chËn
 <ğ18 && 
off£t
 <= 1023)

492 
f
 = ((
m©chËn
 - 3è<< 2è| (
off£t
 << 6) | 2;

493 
ç¡_wr™e
(
f
, 
d¡
, 2);

494 
	gd¡
 += 2;

497 if(
	gm©chËn
 <ğ34 && 
off£t
 <= 65535)

499 
f
 = ((
m©chËn
 - 3è<< 3è| (
off£t
 << 8) | 3;

500 
ç¡_wr™e
(
f
, 
d¡
, 3);

501 
	gd¡
 += 3;

503 ià(
	gm©chËn
 >= 3)

505 ià(
m©chËn
 <= 2050)

507 
f
 = ((
m©chËn
 - 3è<< 4è| (
off£t
 << 15) | 7;

508 
ç¡_wr™e
(
f
, 
d¡
, 4);

509 
	gd¡
 += 4;

513 
ç¡_wr™e
(7, 
d¡
, 4);

514 
ç¡_wr™e
(
m©chËn
, 
d¡
 + 4, 4);

515 
ç¡_wr™e
(
off£t
, 
d¡
 + 8, 4);

516 
	gd¡
 += 12;

526 *
	gd¡
 = *
¤c
;

527 
	g¤c
++;

528 
	gd¡
++;

529 
	gcwÜd_v®
 = (
cwÜd_v®
 >> 1);

535 
	g¤c
 <ğ
Ï¡_by‹
)

537 ià((
cwÜd_v®
 & 1) == 1)

539 
ç¡_wr™e
((
cwÜd_v®
 >> 1è| (1U << 31), 
cwÜd_±r
, 4);

540 
	gcwÜd_±r
 = 
d¡
;

541 
	gd¡
 += 4;

542 
	gcwÜd_v®
 = 1U << 31;

545 ià(
	g¤c
 < 
	gÏ¡_by‹
 - 2 && srø> 
	gsourû_c
 + 3)

547 
	ghashbË
[
hash_func
(
ç¡_»ad
(
¤c
, 4))][1] = src;

548 *(*)&
	ghashbË
[
hash_func
(
ç¡_»ad
(
¤c
, 4))][0] = fast_read(src, 4);

550 *
	gd¡
 = *
¤c
;

551 
	g¤c
++;

552 
	gd¡
++;

554 
	gcwÜd_v®
 = (
cwÜd_v®
 >> 1);

557 (
	gcwÜd_v®
 & 1) != 1)

558 
cwÜd_v®
 = (cword_val >> 1);

560 
ç¡_wr™e
((
cwÜd_v®
 >> 1è| (1U << 31), 
cwÜd_±r
, 4);

563 ià(
	gd¡
 - 
	gde¡š©iÚ_c
 < 9)

566  ()(
	gd¡
 - 
	gde¡š©iÚ_c
);

569 
size_t
 
	$qlz_decom´ess_cÜe
(cÚ¡ *
sourû
, *
de¡š©iÚ
, 
size_t
 
size
, size_ˆ
sourû_size
, *
fœ¡_v®id
, cÚ¡ *
hashbË
[])

571 cÚ¡ *
sourû_c
 = (cÚ¡ *)
sourû
;

572 *
de¡š©iÚ_c
 = (*)
de¡š©iÚ
;

573 cÚ¡ *
¤c
 = 
sourû_c
;

574 *
d¡
 = 
de¡š©iÚ_c
;

575 cÚ¡ * 
Ï¡_by‹_sucûssÜ
 = 
de¡š©iÚ_c
 + 
size
;

576 
cwÜd_v®
 = 1;

577 cÚ¡ 
b™lut
[16] = {4, 0, 1, 0, 2, 0, 1, 0, 3, 0, 1, 0, 2, 0, 1, 0};

578 cÚ¡ *
gu¬ª‹ed_uncom´es£d
 = 
Ï¡_by‹_sucûssÜ
 - 4;

579 *
Ï¡_hashed
 = 
de¡š©iÚ_c
 + 3;

581 
fœ¡_v®id
 = first_valid;

582 
Ï¡_hashed
 =†ast_hashed;

583 
hashbË
 = hashtable;

586 ià(
d¡
 >ğ
gu¬ª‹ed_uncom´es£d
)

588 
¤c
 += 4;

589 
d¡
 < 
Ï¡_by‹_sucûssÜ
)

591 *
d¡
 = *
¤c
;

592 
d¡
++;

593 
¤c
++;

596  ()(
d¡
 - 
de¡š©iÚ_c
);

602 
ãtch
;

604 ià(
cwÜd_v®
 == 1)

607 
cwÜd_v®
 = 
	`ç¡_»ad_§ã
(
¤c
, 4, 
sourû_c
 + 
sourû_size
) | (1U << 31);

608 
¤c
 += 4;

611 
ãtch
 = 
	`ç¡_»ad_§ã
(
¤c
, 4, 
sourû_c
 + 
sourû_size
);

614 ià((
cwÜd_v®
 & 1) == 1)

616 
m©chËn
;

618 #if(
COMPRESSION_LEVEL
 == 0)

619 
hash
;

620 cÚ¡ *
off£t2
;

622 
cwÜd_v®
 = cword_val >> 1;

624 if((
ãtch
 & 0xf) != 15)

626 
hash
 = (
ãtch
 >> 4) & 0xfff;

627 
off£t2
 = 
hashbË
[
hash
];

629 if((
ãtch
 & 0xf) != 0)

631 
m©chËn
 = (
ãtch
 & 0xf);

632 
¤c
 += 2;

634 if((
ãtch
 & 0x00ff0000) != 0)

636 
m©chËn
 = *(
¤c
 + 2);

637 
¤c
 += 3;

641 
m©chËn
 = 
	`ç¡_»ad
(
¤c
 + 3, 4);

642 
¤c
 += 7;

644 
	`memıy_up
(
d¡
, 
off£t2
, 
m©chËn
);

645 
Ï¡_hashed
 < 
d¡
)

647 
Ï¡_hashed
++;

648 
hashbË
[
	`hash_func
(
	`ç¡_»ad
(
Ï¡_hashed
, 4))] =†ast_hashed;

650 
d¡
 +ğ
m©chËn
;

651 
Ï¡_hashed
 = 
d¡
 - 1;

655 
off£t
;

656 
cwÜd_v®
 = cword_val >> 1;

658 ià((
ãtch
 & 3) == 0)

660 
off£t
 = (
ãtch
 & 0xff) >> 2;

661 #ifdeà
memÜy_§ã


662 ià(3 > ()(
gu¬ª‹ed_uncom´es£d
 - 
d¡
è|| 
off£t
 > ()(d¡ - 
fœ¡_v®id
))

665 
	`memıy_up
(
d¡
, d¡ - 
off£t
, 3);

666 
d¡
 += 3;

667 
¤c
++;

669 ià((
ãtch
 & 2) == 0)

671 
off£t
 = (
ãtch
 & 0xffff) >> 2;

672 #ifdeà
memÜy_§ã


673 ià(3 > ()(
gu¬ª‹ed_uncom´es£d
 - 
d¡
è|| 
off£t
 > ()(d¡ - 
fœ¡_v®id
))

676 
	`memıy_up
(
d¡
, d¡ - 
off£t
, 3);

677 
d¡
 += 3;

678 
¤c
 += 2;

680 ià((
ãtch
 & 1) == 0)

682 
off£t
 = (
ãtch
 & 0xffff) >> 6;

683 
m©chËn
 = ((
ãtch
 >> 2) & 15) + 3;

684 #ifdeà
memÜy_§ã


685 ià(
m©chËn
 > ()(
gu¬ª‹ed_uncom´es£d
 - 
d¡
è|| 
off£t
 > ()(d¡ - 
fœ¡_v®id
))

688 
	`memıy_up
(
d¡
, d¡ - 
off£t
, 
m©chËn
);

689 
¤c
 += 2;

690 
d¡
 +ğ
m©chËn
;

692 ià((
ãtch
 & 4) == 0)

694 
off£t
 = (
ãtch
 & 0xffffff) >> 8;

695 
m©chËn
 = ((
ãtch
 >> 3) & 31) + 3;

696 #ifdeà
memÜy_§ã


697 ià(
m©chËn
 > ()(
gu¬ª‹ed_uncom´es£d
 - 
d¡
è|| 
off£t
 > ()(d¡ - 
fœ¡_v®id
))

700 
	`memıy_up
(
d¡
, d¡ - 
off£t
, 
m©chËn
);

701 
¤c
 += 3;

702 
d¡
 +ğ
m©chËn
;

704 ià((
ãtch
 & 8) == 0)

706 
off£t
 = (
ãtch
 >> 15);

707 ià(
off£t
 != 0)

709 
m©chËn
 = ((
ãtch
 >> 4) & 2047) + 3;

710 
¤c
 += 4;

714 
m©chËn
 = 
	`ç¡_»ad_§ã
(
¤c
 + 4, 4, 
sourû_c
 + 
sourû_size
);

715 
off£t
 = 
	`ç¡_»ad_§ã
(
¤c
 + 8, 4, 
sourû_c
 + 
sourû_size
);

716 
¤c
 += 12;

718 #ifdeà
memÜy_§ã


719 ià(
m©chËn
 > ()(
gu¬ª‹ed_uncom´es£d
 - 
d¡
è|| 
off£t
 > ()(d¡ - 
fœ¡_v®id
))

722 
	`memıy_up
(
d¡
, d¡ - 
off£t
, 
m©chËn
);

723 
d¡
 +ğ
m©chËn
;

729 
¾e_ch¬
;

730 
¾e_ch¬
 = ()(
ãtch
 >> 16);

731 
m©chËn
 = ((
ãtch
 >> 4) & 0xfff);

733 if(
m©chËn
 != 0)

734 
¤c
 += 3;

737 
m©chËn
 = 
	`ç¡_»ad_§ã
(
¤c
 + 3, 4, 
sourû_c
 + 
sourû_size
);

738 
¤c
 += 7;

741 #ifdeà
memÜy_§ã


742 if(
m©chËn
 > ()(
gu¬ª‹ed_uncom´es£d
 - 
d¡
))

745 
	`mem£t
(
d¡
, 
¾e_ch¬
, 
m©chËn
);

747 #if(
COMPRESSION_LEVEL
 == 0)

748 
Ï¡_hashed
 < 
d¡
 - 1)

750 
Ï¡_hashed
++;

751 
hashbË
[
	`hash_func
(
	`ç¡_»ad
(
Ï¡_hashed
, 4))] =†ast_hashed;

753 
Ï¡_hashed
 = 
d¡
 - 1 + 
m©chËn
;

755 
d¡
 +ğ
m©chËn
;

761 #ifdeà
memÜy_§ã


762 ià(4 > 
de¡š©iÚ_c
 + 
size
 - 
d¡
 || 
¤c
 > 
sourû_c
 + 
sourû_size
 + 4)

765 
	`memıy_up
(
d¡
, 
¤c
, 4);

767 
d¡
 +ğ
b™lut
[
cwÜd_v®
 & 0xf];

768 
¤c
 +ğ
b™lut
[
cwÜd_v®
 & 0xf];

769 
cwÜd_v®
 = cwÜd_v® >> (
b™lut
[cword_val & 0xf]);

771 #if(
COMPRESSION_LEVEL
 == 0)

772 
Ï¡_hashed
 < 
d¡
 - 3)

774 
Ï¡_hashed
++;

775 
hashbË
[
	`hash_func
(
	`ç¡_»ad
(
Ï¡_hashed
, 4))] =†ast_hashed;

778 ià(
d¡
 >ğ
gu¬ª‹ed_uncom´es£d
)

781 
d¡
 < 
Ï¡_by‹_sucûssÜ
)

783 ià(
cwÜd_v®
 == 1)

785 
¤c
 += 4;

786 
cwÜd_v®
 = 1U << 31;

788 ià(1 > 
de¡š©iÚ_c
 + 
size
 - 
d¡
)

791 *
d¡
 = *
¤c
;

792 
d¡
++;

793 
¤c
++;

794 
cwÜd_v®
 = cword_val >> 1;

797 #if(
COMPRESSION_LEVEL
 == 0)

798 
Ï¡_hashed
 < 
Ï¡_by‹_sucûssÜ
 - 4)

800 
Ï¡_hashed
++;

801 
hashbË
[
	`hash_func
(
	`ç¡_»ad
(
Ï¡_hashed
, 4))] =†ast_hashed;

804 if((
¤c
 - 1è- 
sourû_c
 > 8)

806 if(
d¡
 - 
de¡š©iÚ_c
 - 
size
 == 0)

807  
size
;

813 
	}
}

815 
size_t
 
	$qlz_size_decom´es£d
(cÚ¡ *
sourû
)

817 
n
, 
r
;

818 
n
 = (((*
sourû
) & 2) == 2) ? 4 : 1;

819 
r
 = 
	`ç¡_»ad
(
sourû
 + 1 + 
n
,‚);

820 
r
 =„ & (0xfffffffà>> ((4 - 
n
)*8));

821  
r
;

822 
	}
}

824 
size_t
 
	$qlz_size_com´es£d
(cÚ¡ *
sourû
)

826 
n
, 
r
;

827 
n
 = (((*
sourû
) & 2) == 2) ? 4 : 1;

828 
r
 = 
	`ç¡_»ad
(
sourû
 + 1, 
n
);

829 
r
 =„ & (0xfffffffà>> ((4 - 
n
)*8));

830  
r
;

831 
	}
}

833 
size_t
 
	$qlz_com´ess
(cÚ¡ *
sourû
, *
de¡š©iÚ
, 
size_t
 
size
, *
sü©ch
)

836 *
bufãr_®igÃd
 = (*)
sü©ch
 + 8 - (((
size_t
)scratch) % 8);

837 cÚ¡ *(*
hashbË
)[
AND
 + 1] = (cÚ¡ *(*)[AND + 1])(
bufãr_®igÃd
 + 8);

838 
size_t
 *
bufãrsize
 = (size_ˆ*)
bufãr_®igÃd
;

839 *
¡»ambufãr
 = 
bufãr_®igÃd
 + 8 + 
HASH_SIZE
;

840 
r
;

841 
com´es£d
, 
ba£
;

842 *
hash_couÁ”
 = 
¡»ambufãr
 + 
STREAMING_MODE_ROUNDED
;

844 if(
size
 == 0 || size > 0xffffffff)

847 #ià(
COMPRESSION_LEVEL
 =ğ0 && 
STREAMING_MODE_ROUNDED
 == 0)

848 
	`mem£t
((*)
hashbË
, 0, 
HASH_SIZE
);

851 if(
size
 < 216)

852 
ba£
 = 3;

854 
ba£
 = 9;

857 ià(*
bufãrsize
 + 
size
 > 
STREAMING_MODE_ROUNDED
)

859 #ià(
COMPRESSION_LEVEL
 =ğ0 && 
STREAMING_MODE_ROUNDED
 != 0)

860 
	`mem£t
((*)
hashbË
, 0, 
HASH_SIZE
);

863 
r
 = 
ba£
 + 
	`qlz_com´ess_cÜe
(
sourû
, (*)
de¡š©iÚ
 + ba£, ()
size
, 
hashbË
, (cÚ¡ *)sourû, 
hash_couÁ”
);

864 #ià(
COMPRESSION_LEVEL
 =ğ0 && 
STREAMING_MODE_ROUNDED
 != 0)

865 
	`mem£t
((*)
hashbË
, 0, 
HASH_SIZE
);

868 if(
r
 =ğ
ba£
)

870 
	`memıy
(
de¡š©iÚ
 + 
ba£
, 
sourû
, 
size
);

871 
r
 = ()
size
 + 
ba£
;

872 
com´es£d
 = 0;

875 
com´es£d
 = 1;

876 *
bufãrsize
 = 0;

880 
	`memıy
(
¡»ambufãr
 + *
bufãrsize
, 
sourû
, 
size
);

881 
r
 = 
ba£
 + 
	`qlz_com´ess_cÜe
(
¡»ambufãr
 + *
bufãrsize
, (*)
de¡š©iÚ
 + ba£, ()
size
, 
hashbË
, sŒ—mbufãr, 
hash_couÁ”
);

883 if(
r
 =ğ
ba£
)

885 
	`memıy
(
de¡š©iÚ
 + 
ba£
, 
¡»ambufãr
 + *
bufãrsize
, 
size
);

886 
r
 = ()
size
 + 
ba£
;

887 
com´es£d
 = 0;

889 
	`mem£t
((*)
hashbË
, 0, 
HASH_SIZE
);

892 
com´es£d
 = 1;

893 *
bufãrsize
 +ğ
size
;

896 if(
ba£
 == 3)

898 *
de¡š©iÚ
 = ()(0 | 
com´es£d
);

899 *(
de¡š©iÚ
 + 1èğ()
r
;

900 *(
de¡š©iÚ
 + 2èğ()
size
;

904 *
de¡š©iÚ
 = ()(2 | 
com´es£d
);

905 
	`ç¡_wr™e
(
r
, 
de¡š©iÚ
 + 1, 4);

906 
	`ç¡_wr™e
(()
size
, 
de¡š©iÚ
 + 5, 4);

909 #ià(
COMPRESSION_LEVEL
 == 0)

910 *
de¡š©iÚ
 = (*destination) | 4;

913  (
size_t
)
r
;

914 
	}
}

918 
size_t
 
	$qlz_decom´ess
(cÚ¡ *
sourû
, *
de¡š©iÚ
, *
sü©ch
)

921 *
bufãr_®igÃd
 = (*)
sü©ch
 + 8 - (((
size_t
)scratch) % 8);

922 
size_t
 *
bufãrsize
 = (size_ˆ*)
bufãr_®igÃd
;

923 
h—d”Ën
 = 2*((((*
sourû
) & 2) == 2) ? 4 : 1) + 1;

925 *
¡»ambufãr
 = 
bufãr_®igÃd
 + 8;

926 cÚ¡ **
hashbË
 = (cÚ¡ **)(
¡»ambufãr
 + 
STREAMING_MODE_ROUNDED
);

928 
size_t
 
dsiz
 = 
	`qlz_size_decom´es£d
((*)
sourû
);

929 
size_t
 
csiz
 = 
	`qlz_size_com´es£d
((*)
sourû
);

930 ià(*
bufãrsize
 + 
	`qlz_size_decom´es£d
((*)
sourû
è> 
STREAMING_MODE_ROUNDED
)

932 if((*
sourû
 & 1) == 1)

933 
	`qlz_decom´ess_cÜe
((cÚ¡ *)
sourû
 + 
h—d”Ën
, 
de¡š©iÚ
, 
dsiz
, 
csiz
, (*)de¡š©iÚ, 
hashbË
);

935 
	`memıy
(
de¡š©iÚ
, 
sourû
 + 
h—d”Ën
, 
dsiz
);

936 *
bufãrsize
 = 0;

940 if((*
sourû
 & 1) == 1)

941 
	`qlz_decom´ess_cÜe
((cÚ¡ *)
sourû
 + 
h—d”Ën
, 
¡»ambufãr
 + *
bufãrsize
, 
dsiz
, 
csiz
, sŒ—mbufãr, 
hashbË
);

943 
	`memıy
(
¡»ambufãr
 + *
bufãrsize
, 
sourû
 + 
h—d”Ën
, 
dsiz
);

944 
	`memıy
(
de¡š©iÚ
, 
¡»ambufãr
 + *
bufãrsize
, 
dsiz
);

945 *
bufãrsize
 +ğ
dsiz
;

947  
dsiz
;

948 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/tests/compressor_test.cc

21 
	~"CommÚ/DyÇmicBufãr.h
"

22 
	~"CommÚ/FeUts.h
"

23 
	~"CommÚ/Logg”.h
"

24 
	~"CommÚ/Sy¡em.h
"

25 
	~"CommÚ/U§ge.h
"

27 
	~"Hy³¹abË/Lib/Com´essÜFaùÜy.h
"

28 
	~"Hy³¹abË/Lib/BlockCom´essiÚH—d”Comm™Log.h
"

30 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

32 
	gÇme¥aû
 {

33 cÚ¡ *
	gu§ge
[] = {

48 cÚ¡ 
	gMAGIC
[12] = { '-','-','-','-','-','-','-','-','-','-','-','-' };

50 
	$maš
(
¬gc
, **
¬gv
) {

51 
”rÜ
;

52 
off_t
 
Ën
;

53 
DyÇmicBufãr
 
	`šput
(0);

54 
DyÇmicBufãr
 
	`ouut1
(0);

55 
DyÇmicBufãr
 
	`ouut2
(0);

56 
BlockCom´essiÚCodec
 *
com´essÜ
;

57 
BlockCom´essiÚH—d”Comm™Log
 
	`h—d”
(
MAGIC
, 0, "foo");

59 ià(
¬gc
 =ğ1 || !
	`¡rcmp
(
¬gv
[1], "--help"))

60 
U§ge
::
	`dump_ªd_ex™
(
u§ge
);

62 
Sy¡em
::
	`š™Ÿlize
(
¬gv
[0]);

64 
com´essÜ
 = 
Com´essÜFaùÜy
::
	`ü—‹_block_codec
(
¬gv
[1]);

66 ià(!
com´essÜ
)

69 ià((
šput
.
buf
 = (
ušt8_t
 *)
FeUts
::
	`fe_to_bufãr
("./good-schema-1.xml", &
Ën
)) == 0) {

70 
	`HT_ERROR
("Problem†oading './good-schema-1.xml'");

73 
šput
.
±r
 = iÅut.
buf
 + 
Ën
;

75 ià((
”rÜ
 = 
com´essÜ
->
	`deæ©e
(
šput
, 
ouut1
, 
h—d”
)è!ğ
E¼Ü
::
OK
) {

76 
	`HT_ERRORF
("ProbËm deæ©šg - %s", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

80 ià((
”rÜ
 = 
com´essÜ
->
	`šæ©e
(
ouut1
, 
ouut2
, 
h—d”
)è!ğ
E¼Ü
::
OK
) {

81 
	`HT_ERRORF
("ProbËm inæ©šg - %s", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

85 ià(
šput
.
	`fl
(è!ğ
ouut2
.fill()) {

86 
	`HT_ERRORF
("IÅuˆËngth (%ldèdÛ nÙ m©ch ouuˆËngth (%ldèaá”†zØcodec", 
šput
.
	`fl
(), 
ouut2
.fill());

90 ià(
	`memcmp
(
šput
.
buf
, 
ouut2
.buf, iÅut.
	`fl
())) {

91 
	`HT_ERROR
("Input does‚ot match output‡fter†zo codec");

97 
	`memıy
(
šput
.
buf
, "foo", 3);

98 
šput
.
±r
 = iÅut.
buf
 + 3;

100 ià((
”rÜ
 = 
com´essÜ
->
	`deæ©e
(
šput
, 
ouut1
, 
h—d”
)è!ğ
E¼Ü
::
OK
) {

101 
	`HT_ERRORF
("ProbËm deæ©šg - %s", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

105 ià((
”rÜ
 = 
com´essÜ
->
	`šæ©e
(
ouut1
, 
ouut2
, 
h—d”
)è!ğ
E¼Ü
::
OK
) {

106 
	`HT_ERRORF
("ProbËm inæ©šg - %s", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

110 ià(
šput
.
	`fl
(è!ğ
ouut2
.fill()) {

111 
	`HT_ERRORF
("IÅuˆËngth (%ldèdÛ nÙ m©ch ouuˆËngth (%ldèaá”†zØcodec", 
šput
.
	`fl
(), 
ouut2
.fill());

115 ià(
	`memcmp
(
šput
.
buf
, 
ouut2
.buf, iÅut.
	`fl
())) {

116 
	`HT_ERROR
("Input does‚ot match output‡fter†zo codec");

121 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/tests/loadDataSourceTest.cc

21 
	~<c¡dlib
>

22 
	~<io¡»am
>

25 
	~<”ºo.h
>

26 
	~<fú.h
>

30 
	~"Hy³¹abË/Lib/KeyS³c.h
"

31 
	~"Hy³¹abË/Lib/LßdD©aSourû.h
"

33 
usšg
 
Çme¥aû
 
Hy³¹abË
;

34 
usšg
 
Çme¥aû
 
	g¡d
;

36 
	$maš
(
¬gc
, **
¬gv
) {

37 
LßdD©aSourû
 *
lds
;

38 
ušt64_t
 
time¡amp
;

39 
KeyS³c
 
key
;

40 
ušt8_t
 *
v®ue
;

41 
ušt32_t
 
v®ue_Ën
;

42 
fd
;

44 ià((
fd
 = 
	`İ’
("lßdD©aSourûTe¡.ouut", 
O_WRONLY
|
O_CREAT
|
O_TRUNC
, 0644)) < 0) {

45 
	`³¼Ü
("open");

49 
	`şo£
(2);

50 
	`dup
(
fd
);

52 
lds
 = 
Ãw
 
	`LßdD©aSourû
("loadDataSourceTest.dat", "", "");

54 
lds
->
	`Ãxt
(0, &
time¡amp
, &
key
, &
v®ue
, &
v®ue_Ën
, 0)) {

55 
û¼
 << "row=" << (cÚ¡ *)
key
.
row
 << " cŞumn_çmy=" << key.
cŞumn_çmy
;

56 ià(
key
.
cŞumn_qu®if›r_Ën
 > 0)

57 
û¼
 << " cŞumn_qu®if›r=" << (cÚ¡ *)
key
.
cŞumn_qu®if›r
;

58 
û¼
 << " v®ue=" << (cÚ¡ *)
v®ue
 << 
’dl
;

61 
d–‘e
 
lds
;

63 
	`şo£
(2);

64 
	`dup
(1);

66 ià(
	`sy¡em
("diff†oadDataSourceTest.output†oadDataSourceTest.golden") != 0)

70 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/tests/locationCacheTest.cc

21 
	~<f¡»am
>

22 
	~<ut™y
>

24 
	~"CommÚ/Numb”SŒ—m.h
"

25 
	~"CommÚ/U§ge.h
"

27 
	~"Hy³¹abË/Lib/LoÿtiÚCache.h
"

29 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

30 
usšg
 
Çme¥aû
 
	g¡d
;

32 
	gÇme¥aû
 {

33 cÚ¡ *
	gu§ge
[] = {

40 
	g·œ
<cÚ¡ *, cÚ¡ *> 
	tRowRªgeT
;

42 cÚ¡ 
	gMAX_RANGES
 = 33;

43 cÚ¡ 
	gMAX_WORDS
 = 90;

44 cÚ¡ 
	gMAX_SERVERIDS
 = 11;

46 
RowRªgeT
 
	g¿nges
[
MAX_RANGES
] = {

47 
RowRªgeT
("","allogene"),

48 
RowRªgeT
("allogene", "archtreasurer"),

49 
RowRªgeT
("archtreasurer", "beerocracy"),

50 
RowRªgeT
("beerocracy", "bulblet"),

51 
RowRªgeT
("bulblet", "chieftainship"),

52 
RowRªgeT
("chieftainship", "consolatory"),

53 
RowRªgeT
("consolatory", "deaconal"),

54 
RowRªgeT
("deaconal", "diumvirate"),

55 
RowRªgeT
("diumvirate", "Epicureanism"),

56 
RowRªgeT
("Epicureanism", "flaminica"),

57 
RowRªgeT
("flaminica", "globulet"),

58 
RowRªgeT
("globulet", "heterochromatin"),

59 
RowRªgeT
("heterochromatin", "impressionistically"),

60 
RowRªgeT
("impressionistically", "janker"),

61 
RowRªgeT
("janker", "linder"),

62 
RowRªgeT
("linder", "merohedrism"),

63 
RowRªgeT
("merohedrism", "mycodomatium"),

64 
RowRªgeT
("mycodomatium", "nunatak"),

65 
RowRªgeT
("nunatak", "oversound"),

66 
RowRªgeT
("oversound", "perkingly"),

67 
RowRªgeT
("perkingly", "polymely"),

68 
RowRªgeT
("polymely", "prosopyl"),

69 
RowRªgeT
("prosopyl", "reconsultation"),

70 
RowRªgeT
("reconsultation", "Saan"),

71 
RowRªgeT
("Saan", "setterwort"),

72 
RowRªgeT
("setterwort", "spherics"),

73 
RowRªgeT
("spherics", "sulphoarsenious"),

74 
RowRªgeT
("sulphoarsenious", "tetrazolyl"),

75 
RowRªgeT
("tetrazolyl", "trophic"),

76 
RowRªgeT
("trophic", "undoubtingness"),

77 
RowRªgeT
("undoubtingness", "unserrated"),

78 
RowRªgeT
("unserrated", "vowellessness"),

79 
RowRªgeT
("vowellessness", "")

82 cÚ¡ *
	gwÜds
[
MAX_WORDS
] = {

175 cÚ¡ *
	g£rv”Ids
[
MAX_SERVERIDS
] = {

190 
of¡»am
 
	goutfe
;

192 
Te¡Lookup
(
LoÿtiÚCache
 &
ÿche
, 
ušt32_t
 
bËId
, cÚ¡ *
rowKey
) {

193 
RªgeLoÿtiÚInfo
 
	g¿nge_loc_šfo
;

194 
	goutfe
 << "LOOKUP(" << 
	gbËId
 << ", " << 
	growKey
 << ") -> ";

196 ià(
	gÿche
.
lookup
(
bËId
, 
rowKey
, &
¿nge_loc_šfo
))

197 
	goutfe
 << 
	g¿nge_loc_šfo
.
	gloÿtiÚ
 << 
	g’dl
;

199 
	goutfe
 << "[NULL]" << 
	g’dl
;

205 
	$maš
(
¬gc
, **
¬gv
) {

206 
LoÿtiÚCache
 
	`ÿche
(68);

207 
Numb”SŒ—m
 
	`¿nd¡r
("./random.dat");

208 
ušt32_t
 
¿ngei
;

209 
ušt32_t
 
bËId
;

210 
ušt32_t
 
£rv”i
;

211 cÚ¡ *
¡¬t
, *
’d
;

212 
RªgeLoÿtiÚInfo
 
¿nge_loc_šfo
;

214 ià(
¬gc
 > 1 && (!
	`¡rcmp
(
¬gv
[1], "--help") || !strcmp(argv[1], "-?")))

215 
U§ge
::
	`dump_ªd_ex™
(
u§ge
);

217 
outfe
.
	`İ’
("./locationCacheTest.output");

219 
¿nge_loc_šfo
.
¡¬t_row
 = "bar";

220 
¿nge_loc_šfo
.
’d_row
 = "kite";

221 
¿nge_loc_šfo
.
loÿtiÚ
 = "234345";

222 
ÿche
.
	`š£¹
(0, 
¿nge_loc_šfo
);

224 
¿nge_loc_šfo
.
¡¬t_row
 = "foo";

225 
¿nge_loc_šfo
.
’d_row
 = "kite";

226 
¿nge_loc_šfo
.
loÿtiÚ
 = "234345";

227 
ÿche
.
	`š£¹
(0, 
¿nge_loc_šfo
);

229 
	`Te¡Lookup
(
ÿche
, 0, "foo");

230 
	`Te¡Lookup
(
ÿche
, 0, "food");

231 
	`Te¡Lookup
(
ÿche
, 0, "kite");

232 
	`Te¡Lookup
(
ÿche
, 0, "kited");

234 
size_t
 
i
=0; i<2000; i++) {

235 ià((
¿nd¡r
.
	`g‘IÁ
() % 3) == 0)

236 
	`Te¡Lookup
(
ÿche
, 
¿nd¡r
.
	`g‘IÁ
(è% 4, 
wÜds
[¿nd¡r.g‘IÁ(è% 
MAX_WORDS
]);

238 
¿ngei
 = 
¿nd¡r
.
	`g‘IÁ
(è% 
MAX_RANGES
;

239 
bËId
 = 
¿nd¡r
.
	`g‘IÁ
() % 4;

240 
£rv”i
 = 
¿nd¡r
.
	`g‘IÁ
(è% 
MAX_SERVERIDS
;

241 
¡¬t
 = (*
¿nges
[
¿ngei
].
fœ¡
 == 0) ? "[NULL]" :„anges[rangei].first;

242 
’d
 = (*
¿nges
[
¿ngei
].
£cÚd
 == 0) ? "[NULL]" :„anges[rangei].second;

243 
outfe
 << "INSERT(" << 
bËId
 << ", " << 
¡¬t
 << ", " << 
’d
 << ", " << 
£rv”Ids
[
£rv”i
] << 
’dl
 << 
æush
;

244 
¿nge_loc_šfo
.
¡¬t_row
 = 
¿nges
[
¿ngei
].
fœ¡
;

245 
¿nge_loc_šfo
.
’d_row
 = 
¿nges
[
¿ngei
].
£cÚd
;

246 
¿nge_loc_šfo
.
loÿtiÚ
 = 
£rv”Ids
[
£rv”i
];

247 
ÿche
.
	`š£¹
(
bËId
, 
¿nge_loc_šfo
);

251 
ÿche
.
	`di¥Ïy
(
outfe
);

253 
outfe
.
	`şo£
();

255 ià(
	`sy¡em
("diff ./locationCacheTest.output ./locationCacheTest.golden"))

259 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/tests/schemaTest.cc

23 
	~<”ºo.h
>

24 
	~<¡dio.h
>

25 
	~<¡dlib.h
>

26 
	~<¡ršg.h
>

27 
	~<sys/ty³s.h
>

28 
	~<sys/¡©.h
>

31 
	~"CommÚ/FeUts.h
"

32 
	~"CommÚ/Logg”.h
"

33 
	~"CommÚ/Te¡H¬Ãss.h
"

34 
	~"CommÚ/U§ge.h
"

36 
	~"Hy³¹abË/Lib/Schema.h
"

38 
usšg
 
Çme¥aû
 
Hy³¹abË
;

40 
	gÇme¥aû
 {

41 cÚ¡ *
	gu§ge
[] = {

48 cÚ¡ *
	gbadSchemas
[] = {

64 
	$maš
(
¬gc
, **
¬gv
) {

65 
off_t
 
Ën
;

66 cÚ¡ *
buf
;

67 
boŞ
 
gŞd’
 = 
çl£
;

68 
Te¡H¬Ãss
 
	`h¬Ãss
("schemaTest");

69 
Schema
 *
schema
;

71 ià(
¬gc
 > 1) {

72 ià(!
	`¡rcmp
(
¬gv
[1], "--golden"))

73 
gŞd’
 = 
Œue
;

75 
U§ge
::
	`dump_ªd_ex™
(
u§ge
);

78 
i
=0; 
badSchemas
[i] != 0; ++i) {

79 ià((
buf
 = 
FeUts
::
	`fe_to_bufãr
(
badSchemas
[
i
], &
Ën
)) == 0)

80 
h¬Ãss
.
	`di¥Ïy_”rÜ_ªd_ex™
();

81 
schema
 = 
Schema
::
	`Ãw_š¡ªû
(
buf
, 
Ën
);

82 ià(!
schema
->
	`is_v®id
()) {

83 
	`HT_ERRORF
("Schem¨P¬£ E¼Ü: %s", 
schema
->
	`g‘_”rÜ_¡ršg
());

85 
d–‘e
 
schema
;

86 
d–‘e
 [] 
buf
;

89 
schema
 = 
Ãw
 
	`Schema
();

91 
schema
->
	`İ’_acûss_group
();

92 
schema
->
	`£t_acûss_group_·¿m‘”
("name", "default");

93 
schema
->
	`İ’_cŞumn_çmy
();

94 
schema
->
	`£t_cŞumn_çmy_·¿m‘”
("Name", "default");

95 
schema
->
	`£t_cŞumn_çmy_·¿m‘”
("ttl", "2592000");

96 
schema
->
	`£t_cŞumn_çmy_·¿m‘”
("MaxVersions", "3");

97 
schema
->
	`şo£_cŞumn_çmy
();

98 
schema
->
	`şo£_acûss_group
();

100 
schema
->
	`İ’_acûss_group
();

101 
schema
->
	`£t_acûss_group_·¿m‘”
("name", "meta");

102 
schema
->
	`İ’_cŞumn_çmy
();

103 
schema
->
	`£t_cŞumn_çmy_·¿m‘”
("Name", "language");

104 
schema
->
	`şo£_cŞumn_çmy
();

105 
schema
->
	`İ’_cŞumn_çmy
();

106 
schema
->
	`£t_cŞumn_çmy_·¿m‘”
("Name", "checksum");

107 
schema
->
	`şo£_cŞumn_çmy
();

108 
schema
->
	`şo£_acûss_group
();

110 
¡d
::
¡ršg
 
schemaSŒ
;

111 
schema
->
	`»nd”
(
schemaSŒ
);

112 
FeUts
::
	`wr™e
(
h¬Ãss
.
	`g‘_log_fe_desütÜ
(), 
schemaSŒ
.
	`c_¡r
(), 
	`¡¾’
(schemaStr.c_str()));

114 
schemaSŒ
 = "";

115 
schema
->
	`assign_ids
();

116 
schema
->
	`»nd”
(
schemaSŒ
);

117 
FeUts
::
	`wr™e
(
h¬Ãss
.
	`g‘_log_fe_desütÜ
(), 
schemaSŒ
.
	`c_¡r
(), 
	`¡¾’
(schemaStr.c_str()));

119 
d–‘e
 
schema
;

121 ià(!
gŞd’
)

122 
h¬Ãss
.
	`v®id©e_ªd_ex™
("schemaTest.golden");

124 
h¬Ãss
.
	`»g’”©e_gŞd’_fe
("schemaTest.golden");

127 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/ConnectionHandler.cc

21 
	~"CommÚ/E¼Ü.h
"

22 
	~"CommÚ/Exû±iÚ.h
"

23 
	~"CommÚ/SŒšgExt.h
"

25 
	~"AsyncComm/AµliÿtiÚQueue.h
"

27 
	~"Hy³¹abË/Lib/Ma¡”PrÙocŞ.h
"

29 
	~"CÚÃùiÚHªdËr.h
"

30 
	~"Reque¡HªdËrC»©eTabË.h
"

31 
	~"Reque¡HªdËrDrİTabË.h
"

32 
	~"Reque¡HªdËrG‘Schema.h
"

33 
	~"Reque¡HªdËrStus.h
"

34 
	~"Reque¡HªdËrRegi¡”S”v”.h
"

35 
	~"Reque¡HªdËrR•ÜtS¶™.h
"

37 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

42 
	gCÚÃùiÚHªdËr
::
	$hªdË
(
Ev’tPŒ
 &
ev’tPŒ
) {

43 
commªd
 = -1;

45 ià(
ev’tPŒ
->
ty³
 =ğ
Ev’t
::
MESSAGE
) {

46 
AµliÿtiÚHªdËr
 *
»que¡HªdËr
 = 0;

50 
Œy
 {

51 ià(
ev’tPŒ
->
mes§geL’
 < (
št16_t
)) {

52 
¡d
::
¡ršg
 
mes§ge
 = "Truncated Request";

53 
throw
 
Ãw
 
	`PrÙocŞExû±iÚ
(
mes§ge
);

55 
	`memıy
(&
commªd
, 
ev’tPŒ
->
mes§ge
, (
št16_t
));

58 ià(
commªd
 < 0 || commªd >ğ
Ma¡”PrÙocŞ
::
COMMAND_MAX
) {

59 
¡d
::
¡ršg
 
mes§ge
 = (¡d::¡ršg)"Inv®id commªd (" + 
commªd
 + ")";

60 
throw
 
	`PrÙocŞExû±iÚ
(
mes§ge
);

63 
commªd
) {

64 
Ma¡”PrÙocŞ
::
COMMAND_CREATE_TABLE
:

65 
»que¡HªdËr
 = 
Ãw
 
	`Reque¡HªdËrC»©eTabË
(
m_comm
, 
m_ma¡”_±r
.
	`g‘
(), 
ev’tPŒ
);

67 
Ma¡”PrÙocŞ
::
COMMAND_DROP_TABLE
:

68 
»que¡HªdËr
 = 
Ãw
 
	`Reque¡HªdËrDrİTabË
(
m_comm
, 
m_ma¡”_±r
.
	`g‘
(), 
ev’tPŒ
);

70 
Ma¡”PrÙocŞ
::
COMMAND_GET_SCHEMA
:

71 
»que¡HªdËr
 = 
Ãw
 
	`Reque¡HªdËrG‘Schema
(
m_comm
, 
m_ma¡”_±r
.
	`g‘
(), 
ev’tPŒ
);

73 
Ma¡”PrÙocŞ
::
COMMAND_STATUS
:

74 
»que¡HªdËr
 = 
Ãw
 
	`Reque¡HªdËrStus
(
m_comm
, 
m_ma¡”_±r
.
	`g‘
(), 
ev’tPŒ
);

76 
Ma¡”PrÙocŞ
::
COMMAND_REGISTER_SERVER
:

77 
»que¡HªdËr
 = 
Ãw
 
	`Reque¡HªdËrRegi¡”S”v”
(
m_comm
, 
m_ma¡”_±r
.
	`g‘
(), 
ev’tPŒ
);

79 
Ma¡”PrÙocŞ
::
COMMAND_REPORT_SPLIT
:

80 
»que¡HªdËr
 = 
Ãw
 
	`Reque¡HªdËrR•ÜtS¶™
(
m_comm
, 
m_ma¡”_±r
.
	`g‘
(), 
ev’tPŒ
);

83 
¡d
::
¡ršg
 
mes§ge
 = (¡ršg)"Commªd cod" + 
commªd
 + "‚ot implemented";

84 
throw
 
	`PrÙocŞExû±iÚ
(
mes§ge
);

86 
m_­p_queue_±r
->
	`add
Ğ
»que¡HªdËr
 );

88 
	`ÿtch
 (
PrÙocŞExû±iÚ
 &
e
) {

89 
Re¥Ú£C®lback
 
	`cb
(
m_comm
, 
ev’tPŒ
);

90 
¡d
::
¡ršg
 
”rMsg
 = 
e
.
	`wh©
();

91 
	`HT_ERRORF
("PrÙocŞƒ¼Ü '%s'", 
e
.
	`wh©
());

92 
cb
.
	`”rÜ
(
E¼Ü
::
PROTOCOL_ERROR
, 
”rMsg
);

96 
	`HT_INFOF
("%s", 
ev’tPŒ
->
	`toSŒšg
().
	`c_¡r
());

99 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/ConnectionHandler.h

21 #iâdeà
HYPERTABLE_CONNECTIONHANDLER_H


22 
	#HYPERTABLE_CONNECTIONHANDLER_H


	)

24 
	~"AsyncComm/AµliÿtiÚQueue.h
"

25 
	~"AsyncComm/Di¥©chHªdËr.h
"

27 
	~"Ma¡”.h
"

29 
Çme¥aû
 
	gHy³¹abË
 {

33 şas 
	cCÚÃùiÚHªdËr
 : 
public
 
Di¥©chHªdËr
 {

34 
public
:

35 
CÚÃùiÚHªdËr
(
Comm
 *
comm
, 
AµliÿtiÚQueuePŒ
 &
­pQueuePŒ
, 
Ma¡”PŒ
 &
ma¡”PŒ
è: 
m_comm
(comm), 
m_­p_queue_±r
×µQueuePŒ), 
m_ma¡”_±r
(masterPtr) { ; }

36 
vœtu®
 
hªdË
(
Ev’tPŒ
 &
ev’tPŒ
);

38 
	g´iv©e
:

39 
Comm
 *
m_comm
;

40 
AµliÿtiÚQueuePŒ
 
	gm_­p_queue_±r
;

41 
Ma¡”PŒ
 
	gm_ma¡”_±r
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/DropTableDispatchHandler.cc

21 
	~"AsyncComm/PrÙocŞ.h
"

23 
	~"CommÚ/E¼Ü.h
"

24 
	~"CommÚ/Logg”.h
"

26 
	~"DrİTabËDi¥©chHªdËr.h
"

28 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

34 
	gDrİTabËDi¥©chHªdËr
::
DrİTabËDi¥©chHªdËr
(
¡d
::
¡ršg
 
bË_Çme
, 
Comm
 *
comm
, 
time_t
 
timeout
è: 
m_out¡ªdšg
(0), 
m_ş›Á
(comm,imeout), 
	$m_bË_Çme
(
bË_Çme
) {

36 
	}
}

43 
	gDrİTabËDi¥©chHªdËr
::
	$add
(
sockaddr_š
 &
addr
) {

44 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

45 
”rÜ
;

47 ià((
”rÜ
 = 
m_ş›Á
.
	`drİ_bË
(
addr
, 
m_bË_Çme
, 
this
)è!ğ
E¼Ü
::
OK
) {

48 
E¼ÜResuÉT
 
»suÉ
;

49 
»suÉ
.
addr
 =‡ddr;

50 
»suÉ
.
”rÜ
 =ƒrror;

51 
»suÉ
.
msg
 = "Sendƒrror";

52 
m_”rÜs
.
	`push_back
(
»suÉ
);

55 
m_out¡ªdšg
++;

56 
	}
}

63 
	gDrİTabËDi¥©chHªdËr
::
	$hªdË
(
Ev’tPŒ
 &
ev’t_±r
) {

64 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

65 
E¼ÜResuÉT
 
»suÉ
;

67 ià(
ev’t_±r
->
ty³
 =ğ
Ev’t
::
MESSAGE
) {

68 ià((
»suÉ
.
”rÜ
 = 
PrÙocŞ
::
	`»¥Ú£_code
(
ev’t_±r
)è!ğ
E¼Ü
::
OK
) {

69 
»suÉ
.
addr
 = 
ev’t_±r
->addr;

70 
»suÉ
.
msg
 = 
PrÙocŞ
::
	`¡ršg_fÜm©_mes§ge
(
ev’t_±r
);

71 
m_”rÜs
.
	`push_back
(
»suÉ
);

75 
»suÉ
.
”rÜ
 = 
ev’t_±r
->error;

76 
»suÉ
.
addr
 = 
ev’t_±r
->addr;

77 
»suÉ
.
msg
 = "";

78 
m_”rÜs
.
	`push_back
(
»suÉ
);

80 
m_out¡ªdšg
--;

81 ià(
m_out¡ªdšg
 == 0)

82 
m_cÚd
.
	`nÙify_®l
();

83 
	}
}

89 
boŞ
 
	gDrİTabËDi¥©chHªdËr
::
	$wa™_fÜ_com¶‘iÚ
() {

90 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

91 
m_out¡ªdšg
 > 0)

92 
m_cÚd
.
	`wa™
(
lock
);

93  
m_”rÜs
.
	`em±y
();

94 
	}
}

100 
	gDrİTabËDi¥©chHªdËr
::
g‘_”rÜs
(
veùÜ
<
E¼ÜResuÉT
> &
”rÜs
) {

101 
”rÜs
 = 
m_”rÜs
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/DropTableDispatchHandler.h

21 #iâdeà
HYPERTABLE_DROPTABLEDISPATCHHANDLER_H


22 
	#HYPERTABLE_DROPTABLEDISPATCHHANDLER_H


	)

24 
	~"AsyncComm/Comm.h
"

25 
	~"AsyncComm/Di¥©chHªdËr.h
"

26 
	~"AsyncComm/Ev’t.h
"

28 
	~"CommÚ/SockAddrM­.h
"

30 
	~"Hy³¹abË/Lib/RªgeS”v”Cl›Á.h
"

32 
Çme¥aû
 
	gHy³¹abË
 {

38 şas 
	cDrİTabËDi¥©chHªdËr
 : 
public
 
Di¥©chHªdËr
 {

40 
public
:

43 
sockaddr_š
 
addr
;

44 
	g”rÜ
;

45 
	g¡d
::
¡ršg
 
msg
;

46 } 
	tE¼ÜResuÉT
;

51 
DrİTabËDi¥©chHªdËr
(
¡d
::
¡ršg
 
bË_Çme
, 
Comm
 *
comm
, 
time_t
 
timeout
);

56 
add
(
sockaddr_š
 &
addr
);

65 
vœtu®
 
hªdË
(
Ev’tPŒ
 &
ev’t_±r
);

67 
boŞ
 
wa™_fÜ_com¶‘iÚ
();

69 
g‘_”rÜs
(
veùÜ
<
E¼ÜResuÉT
> &
”rÜs
);

71 
	g´iv©e
:

72 
boo¡
::
mu‹x
 
m_mu‹x
;

73 
	gboo¡
::
cÚd™iÚ
 
m_cÚd
;

74 
	gm_out¡ªdšg
;

75 
RªgeS”v”Cl›Á
 
	gm_ş›Á
;

76 
	g¡d
::
¡ršg
 
m_bË_Çme
;

77 
	gveùÜ
<
	gE¼ÜResuÉT
> 
	gm_”rÜs
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/EventHandlerServerJoined.cc

21 
	~"Ma¡”.h
"

22 
	~"Ev’tHªdËrS”v”Jošed.h
"

24 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

29 
	gEv’tHªdËrS”v”Jošed
::
	$run
() {

30 
m_ma¡”_±r
->
	`£rv”_jošed
(
m_loÿtiÚ
);

31 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/EventHandlerServerJoined.h

21 #iâdeà
HYPERTABLE_EVENTHANDLERSERVERJOINED_H


22 
	#HYPERTABLE_EVENTHANDLERSERVERJOINED_H


	)

24 
	~"CommÚ/RuÂabË.h
"

26 
	~"AsyncComm/AµliÿtiÚHªdËr.h
"

27 
	~"AsyncComm/Ev’t.h
"

29 
	~"Ma¡”.h
"

31 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

33 
Çme¥aû
 
	gHy³¹abË
 {

35 şas 
	cEv’tHªdËrS”v”Jošed
 : 
public
 
AµliÿtiÚHªdËr
 {

36 
public
:

37 
Ev’tHªdËrS”v”Jošed
(
Ma¡”PŒ
 &
ma¡”PŒ
, 
¡d
::
¡ršg
 &
loÿtiÚ
, 
Ev’tPŒ
 &
ev’tPŒ
è: 
AµliÿtiÚHªdËr
Óv’tPŒ), 
m_ma¡”_±r
(ma¡”PŒ), 
m_loÿtiÚ
(location) {

41 
vœtu®
 
run
();

43 
	g´iv©e
:

44 
Ma¡”PŒ
 
m_ma¡”_±r
;

45 
	g¡d
::
¡ršg
 
m_loÿtiÚ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/EventHandlerServerLeft.cc

21 
	~"Ma¡”.h
"

22 
	~"Ev’tHªdËrS”v”Leá.h
"

24 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

29 
	gEv’tHªdËrS”v”Leá
::
	$run
() {

30 
m_ma¡”_±r
->
	`£rv”_Ëá
(
m_loÿtiÚ
);

31 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/EventHandlerServerLeft.h

21 #iâdeà
HYPERTABLE_EVENTHANDLERSERVERLEFT_H


22 
	#HYPERTABLE_EVENTHANDLERSERVERLEFT_H


	)

24 
	~"CommÚ/RuÂabË.h
"

26 
	~"AsyncComm/AµliÿtiÚHªdËr.h
"

27 
	~"AsyncComm/Ev’t.h
"

29 
	~"Ma¡”.h
"

31 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

33 
Çme¥aû
 
	gHy³¹abË
 {

35 şas 
	cEv’tHªdËrS”v”Leá
 : 
public
 
AµliÿtiÚHªdËr
 {

36 
public
:

37 
Ev’tHªdËrS”v”Leá
(
Ma¡”PŒ
 &
ma¡”PŒ
, 
¡d
::
¡ršg
 
loÿtiÚ
, 
Ev’tPŒ
 &
ev’tPŒ
è: 
AµliÿtiÚHªdËr
Óv’tPŒ), 
m_ma¡”_±r
(ma¡”PŒ), 
m_loÿtiÚ
(location) {

41 
vœtu®
 
run
();

43 
	g´iv©e
:

44 
Ma¡”PŒ
 
m_ma¡”_±r
;

45 
	g¡d
::
¡ršg
 
m_loÿtiÚ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/HyperspaceSessionHandler.h

21 #iâdeà
HYPERSPACE_SESSIONHANDLER_H


22 
	#HYPERSPACE_SESSIONHANDLER_H


	)

24 
	~<io¡»am
>

26 
	~"Hy³r¥aû/SessiÚ.h
"

28 
Çme¥aû
 
	gHy³¹abË
 {

30 şas 
	cHy³r¥aûSessiÚHªdËr
 : 
public
 
Hy³r¥aû
::
SessiÚC®lback
 {

31 
public
:

32 
vœtu®
 
§ã
() {

33 
cout
 << "Hy³r¥aû sessiÚ s‹ = SAFE" << 
’dl
 << 
æush
;

35 
vœtu®
 
expœed
() {

36 
	gcout
 << "Hy³r¥aû sessiÚ s‹ = EXPIRED" << 
	g’dl
 << 
	gæush
;

38 
vœtu®
 
jeİ¬dy
() {

39 
	gcout
 << "Hy³r¥aû sessiÚ s‹ = JEOPARDY" << 
	g’dl
 << 
	gæush
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/Master.cc

21 
	~<®gÜ™hm
>

22 
	~<¡ršg
>

25 
	~<¬·/š‘.h
>

26 
	~<Ãtdb.h
>

27 
	~<Ãtš‘/š.h
>

28 
	~<sys/sock‘.h
>

29 
	~<sys/ty³s.h
>

32 
	~<boo¡/®gÜ™hm/¡ršg.hµ
>

34 
	~"CommÚ/FeUts.h
"

35 
	~"CommÚ/IÃtAddr.h
"

36 
	~"CommÚ/Sy¡em.h
"

38 
	~"DfsBrok”/Lib/Cl›Á.h
"

39 
	~"Hy³¹abË/Lib/LoÿtiÚCache.h
"

40 
	~"Hy³¹abË/Lib/RªgeS”v”Cl›Á.h
"

41 
	~"Hy³¹abË/Lib/Schema.h
"

42 
	~"Hy³r¥aû/DœEÁry.h
"

44 
	~"DrİTabËDi¥©chHªdËr.h
"

45 
	~"Ma¡”.h
"

46 
	~"S”v”sDœeùÜyHªdËr.h
"

47 
	~"S”v”LockFeHªdËr.h
"

48 
	~"RªgeS”v”S‹.h
"

50 
usšg
 
Çme¥aû
 
Hy³r¥aû
;

51 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

52 
usšg
 
Çme¥aû
 
	gHy³¹abË
::
DfsBrok”
;

53 
usšg
 
Çme¥aû
 
	g¡d
;

55 
Çme¥aû
 
	gHy³¹abË
 {

57 
	gMa¡”
::
Ma¡”
(
CÚÃùiÚMªag”PŒ
 &
cÚnMªag”PŒ
, 
Prİ”t›sPŒ
 &
´İs_±r
, 
AµliÿtiÚQueuePŒ
 &
­pQueuePŒ
è: 
m_´İs_±r
Õrİs_±r), 
m_cÚn_mªag”_±r
(cÚnMªag”PŒ), 
m_­p_queue_±r
×µQueuePŒ), 
m_v”bo£
(
çl£
), 
m_dfs_ş›Á
(0), 
m_š™Ÿlized
(false) {

58 
	g”rÜ
;

59 
Cl›Á
 *
	gdfsCl›Á
;

60 
ušt16_t
 
	gpÜt
;

62 
	gm_£rv”_m­_™”
 = 
m_£rv”_m­
.
begš
();

64 
	gm_hy³r¥aû_±r
 = 
Ãw
 
Hy³r¥aû
::
SessiÚ
(
cÚnMªag”PŒ
->
g‘_comm
(), 
´İs_±r
, &
m_hy³r¥aû_£ssiÚ_hªdËr
);

66 ià(!
	gm_hy³r¥aû_±r
->
wa™_fÜ_cÚÃùiÚ
(30)) {

67 
HT_ERROR
("Unableo connecto hyperspace,ƒxiting...");

68 
ex™
(1);

71 
	gm_v”bo£
 = 
´İs_±r
->
g‘_boŞ
("Hy³¹abË.V”bo£", 
çl£
);

73 ià((
	gpÜt
 = (
ušt16_t
)
´İs_±r
->
g‘_št
("Hypertable.Master.Port", 0)) == 0) {

74 
HT_ERROR
("Hypertable.Master.Port…roperty‚ot found in config file,ƒxiting...");

75 
ex™
(1);

78 
	gm_max_¿nge_by‹s
 = 
´İs_±r
->
g‘_št64
("Hypertable.RangeServer.Range.MaxBytes", 200000000LL);

83 
	gdfsCl›Á
 = 
Ãw
 
DfsBrok”
::
Cl›Á
(
cÚnMªag”PŒ
, 
´İs_±r
);

85 ià(
	gm_v”bo£
) {

86 
	gcout
 << "DfsBrok”.Ho¡=" << 
	g´İs_±r
->
g‘
("DfsBrok”.Ho¡", ""è<< 
	g’dl
;

87 
	gcout
 << "DfsBrok”.PÜt=" << 
	g´İs_±r
->
g‘
("DfsBrok”.PÜt", ""è<< 
	g’dl
;

88 
	gcout
 << "DfsBrok”.Timeout=" << 
	g´İs_±r
->
g‘
("DfsBrok”.Timeout", ""è<< 
	g’dl
;

91 ià(!
	gdfsCl›Á
->
wa™_fÜ_cÚÃùiÚ
(30)) {

92 
HT_ERROR
("Unableo connecto DFS Broker,ƒxiting...");

93 
ex™
(1);

96 
	gm_dfs_ş›Á
 = 
dfsCl›Á
;

98 
©omic_£t
(&
m_Ï¡_bË_id
, 0);

100 ià(!
š™Ÿlize
())

101 
ex™
(1);

105 
DyÇmicBufãr
 
v®ueBuf
(0);

106 
HªdËC®lbackPŒ
 
	gnuÎHªdËC®lback
;

107 
	giv®
;

108 
ušt32_t
 
	glockStus
;

109 
ušt32_t
 
	goæags
 = 
OPEN_FLAG_READ
 | 
OPEN_FLAG_WRITE
 | 
OPEN_FLAG_LOCK
;

111 ià((
	g”rÜ
 = 
m_hy³r¥aû_±r
->
İ’
("/hy³¹abË/ma¡”", 
oæags
, 
nuÎHªdËC®lback
, &
m_ma¡”_fe_hªdË
)è!ğ
E¼Ü
::
OK
) {

112 
HT_ERRORF
("Unableo open Hyperspace file '/hypertable/master' (%s) Try„e-running with --initialize",

113 
E¼Ü
::
g‘_‹xt
(
”rÜ
));

114 
ex™
(1);

117 ià((
	g”rÜ
 = 
m_hy³r¥aû_±r
->
Œy_lock
(
m_ma¡”_fe_hªdË
, 
LOCK_MODE_EXCLUSIVE
, &
lockStus
, &
m_ma¡”_fe_£qu’ûr
)è!ğ
E¼Ü
::
OK
) {

118 
HT_ERRORF
("ProbËm obššgƒxşusivlock oÀma¡” Hy³r¥aû f'/hy³¹abË/ma¡”' - %s", 
E¼Ü
::
g‘_‹xt
(
”rÜ
));

119 
ex™
(1);

122 ià(
	glockStus
 !ğ
LOCK_STATUS_GRANTED
) {

123 
HT_ERROR
("Unableo obtain†ock on '/hypertable/master' - conflict");

124 
ex™
(1);

129 
	g¡d
::
¡ršg
 
ho¡SŒ
, 
	gaddrSŒ
;

130 
ho¡’t
 *
	ghe
;

131 
	gIÃtAddr
::
g‘_ho¡Çme
(
ho¡SŒ
);

132 ià((
	ghe
 = 
g‘ho¡byÇme
(
ho¡SŒ
.
c_¡r
())) == 0) {

133 
HT_ERRORF
("ProbËm obššg‡dd»s fÜ ho¡Çm'%s'", 
ho¡SŒ
.
c_¡r
());

134 
ex™
(1);

136 
	gaddrSŒ
 = 
¡d
::
¡ršg
(
š‘_Áß
(*(
š_addr
 *)*
he
->
h_addr_li¡
)è+ ":" + ()
pÜt
;

137 ià((
	g”rÜ
 = 
m_hy³r¥aû_±r
->
©Œ_£t
(
m_ma¡”_fe_hªdË
, "add»ss", 
addrSŒ
.
c_¡r
(), 
¡¾’
×ddrSŒ.c_¡r()))è!ğ
E¼Ü
::
OK
) {

138 
HT_ERRORF
("ProbËm s‘tšg‡‰ribu‹ 'add»ss' oàhy³r¥aû f/hy³¹abË/ma¡” - %s", 
E¼Ü
::
g‘_‹xt
(
”rÜ
));

139 
ex™
(1);

143 ià((
	g”rÜ
 = 
m_hy³r¥aû_±r
->
©Œ_g‘
(
m_ma¡”_fe_hªdË
, "Ï¡_bË_id", 
v®ueBuf
)è!ğ
E¼Ü
::
OK
) {

144 ià(
”rÜ
 =ğ
E¼Ü
::
HYPERSPACE_ATTR_NOT_FOUND
) {

145 
ušt32_t
 
bË_id
 = 0;

146 ià((
	g”rÜ
 = 
m_hy³r¥aû_±r
->
©Œ_£t
(
m_ma¡”_fe_hªdË
, "Ï¡_bË_id", &
bË_id
, (
št32_t
))è!ğ
E¼Ü
::
OK
) {

147 
HT_ERRORF
("ProbËm s‘tšg‡‰ribu‹ 'Ï¡_bË_id' oàf/hy³¹abË/ma¡” - %s", 
E¼Ü
::
g‘_‹xt
(
”rÜ
));

148 
ex™
(1);

150 
	giv®
 = 0;

153 
HT_ERRORF
("ProbËm g‘tšg‡‰ribu‹ 'Ï¡_bË_id' from f/hy³¹abË/ma¡” - %s", 
E¼Ü
::
g‘_‹xt
(
”rÜ
));

154 
ex™
(1);

158 
as£¹
(
v®ueBuf
.
fl
(è=ğ(
št32_t
));

159 
memıy
(&
iv®
, 
v®ueBuf
.
buf
, (
št32_t
));

162 
©omic_£t
(&
m_Ï¡_bË_id
, 
iv®
);

163 ià(
	gm_v”bo£
)

164 
	gcout
 << "La¡ TabË ID: " << 
	giv®
 << 
	g’dl
;

170 
sÿn_£rv”s_dœeùÜy
();

172 
ma¡”_gc_¡¬t
(
´İs_±r
, 
m_th»ads
, 
m_m‘ad©a_bË_±r
, 
m_dfs_ş›Á
);

177 
	gMa¡”
::~
Ma¡”
() {

178 
d–‘e
 
m_dfs_ş›Á
;

186 
	gMa¡”
::
£rv”_jošed
(
¡d
::
¡ršg
 &
loÿtiÚ
) {

187 
HT_INFOF
("S”v” Jošed (%s)", 
loÿtiÚ
.
c_¡r
());

188 
	gcout
 << 
	gæush
;

196 
	gMa¡”
::
£rv”_Ëá
(
¡d
::
¡ršg
 &
loÿtiÚ
) {

197 
boo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

198 
	g”rÜ
;

199 
ušt32_t
 
	glockStus
;

200 
LockSequ’ûrT
 
	glockSequ’ûr
;

201 
	gS”v”M­T
::
™”©Ü
 
™”
 = 
m_£rv”_m­
.
fšd
(
loÿtiÚ
);

202 
	g¡d
::
¡ršg
 
hsF’ame
 = (
¡d
::¡ršg)"/hy³¹abË/£rv”s/" + 
loÿtiÚ
;

204 ià(
	g™”
 =ğ
m_£rv”_m­
.
’d
()) {

205 
HT_WARNF
("S”v” (%sènÙ found iÀm­", 
loÿtiÚ
.
c_¡r
());

210 ià(
	g™”
 =ğ
m_£rv”_m­_™”
)

211 
m_£rv”_m­_™”
++;

213 ià((
	g”rÜ
 = 
m_hy³r¥aû_±r
->
Œy_lock
((*
™”
).
£cÚd
->
hy³r¥aûHªdË
, 
LOCK_MODE_EXCLUSIVE
, &
lockStus
, &
lockSequ’ûr
)è!ğ
E¼Ü
::
OK
) {

214 
HT_ERRORF
("ProbËm obššgƒxşusivlock oÀma¡” Hy³r¥aû f'/hy³¹abË/ma¡”' - %s", 
E¼Ü
::
g‘_‹xt
(
”rÜ
));

218 ià(
	glockStus
 !ğ
LOCK_STATUS_GRANTED
) {

219 
HT_INFOF
("UÇbËØobš†ock oÀ£rv” f%s, ignÜšg...", 
loÿtiÚ
.
c_¡r
());

223 
	gm_hy³r¥aû_±r
->
uÆšk
(
hsF’ame
);

224 
	gm_hy³r¥aû_±r
->
şo£
((*
™”
).
£cÚd
->
hy³r¥aûHªdË
);

225 
	gm_£rv”_m­
.
”a£
(
™”
);

227 
HT_INFOF
("RªgeS”v”†o¡ it' lock oÀf%s, d–‘šg ...", 
hsF’ame
.
c_¡r
());

228 
	gcout
 << 
	gæush
;

240 
	gMa¡”
::
ü—‹_bË
(
Re¥Ú£C®lback
 *
cb
, cÚ¡ *
bËName
, cÚ¡ *
schemaSŒšg
) {

241 
	g”rÜ
;

242 
	g¡d
::
¡ršg
 
”rMsg
;

243 
	g¡d
::
¡ršg
 
bË_Çme_¡r
 = 
bËName
;

245 #ià
defšed
(
__APPLE__
)

246 
	gboo¡
::
to_uµ”
(
bË_Çme_¡r
);

249 ià((
	g”rÜ
 = 
ü—‹_bË
(
bË_Çme_¡r
.
c_¡r
(), 
schemaSŒšg
, 
”rMsg
)è!ğ
E¼Ü
::
OK
)

250 
cb
->
”rÜ
Ó¼Ü, 
”rMsg
);

252 
	gcb
->
»¥Ú£_ok
();

259 
	gMa¡”
::
g‘_schema
(
Re¥Ú£C®lbackG‘Schema
 *
cb
, cÚ¡ *
bËName
) {

260 
	g”rÜ
 = 
E¼Ü
::
OK
;

261 
	g¡d
::
¡ršg
 
bËFe
 = (
¡d
::¡ršg)"/hy³¹abË/bËs/" + 
bËName
;

262 
	g¡d
::
¡ršg
 
”rMsg
;

263 
DyÇmicBufãr
 
schemaBuf
(0);

264 
ušt64_t
 
	ghªdË
;

265 
boŞ
 
	gexi¡s
;

266 
HªdËC®lbackPŒ
 
	gnuÎHªdËC®lback
;

271 ià((
	g”rÜ
 = 
m_hy³r¥aû_±r
->
exi¡s
(
bËFe
, &exi¡s)è!ğ
E¼Ü
::
OK
) {

272 
”rMsg
 = (
¡d
::
¡ršg
)"ProbËm checkšg fÜƒxi¡’û oàbË '" + 
bËName
 + "' - " + 
E¼Ü
::
g‘_‹xt
(
”rÜ
);

273 
	gabÜt
;

279 ià((
	g”rÜ
 = 
m_hy³r¥aû_±r
->
İ’
(
bËFe
, 
OPEN_FLAG_READ
, 
nuÎHªdËC®lback
, &
hªdË
)è!ğ
E¼Ü
::
OK
) {

280 
”rMsg
 = "UÇbËØİ’ Hy³r¥aûabË f'" + 
bËFe
 + "' (" + 
E¼Ü
::
g‘_‹xt
(
”rÜ
) + ")";

281 
	gabÜt
;

287 ià((
	g”rÜ
 = 
m_hy³r¥aû_±r
->
©Œ_g‘
(
hªdË
, "schema", 
schemaBuf
)è!ğ
E¼Ü
::
OK
) {

288 
”rMsg
 = "ProbËm g‘tšg‡‰ribu‹ 'schema' fÜabË f'" + 
bËFe
 + "'";

289 
	gabÜt
;

292 
	gm_hy³r¥aû_±r
->
şo£
(
hªdË
);

294 
	gcb
->
»¥Ú£
((*)
schemaBuf
.
buf
);

296 ià(
	gm_v”bo£
) {

297 
HT_INFOF
("SucûssfuÎy f‘ched schem¨Ö’gth=%dèfÜabË '%s'", 
¡¾’
((*)
schemaBuf
.
buf
), 
bËName
);

300 
	gabÜt
:

301 ià(
”rÜ
 !ğ
E¼Ü
::
OK
) {

302 ià(
m_v”bo£
) {

303 
HT_ERRORF
("% '%s'", 
E¼Ü
::
g‘_‹xt
(
”rÜ
), 
”rMsg
.
c_¡r
());

305 
	gcb
->
”rÜ
Ó¼Ü, 
”rMsg
);

315 
	gMa¡”
::
»gi¡”_£rv”
(
Re¥Ú£C®lback
 *
cb
, cÚ¡ *
loÿtiÚ
, 
sockaddr_š
 &
addr
) {

316 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

317 
	g”rÜ
;

318 
RªgeS”v”S‹PŒ
 
	g¡©ePŒ
;

319 
	gS”v”M­T
::
™”©Ü
 
™”
;

320 
sockaddr_š
 
	g®Ÿs
;

321 
ušt32_t
 
	goæags
 = 
OPEN_FLAG_READ
 | 
OPEN_FLAG_WRITE
 | 
OPEN_FLAG_LOCK
;

322 
HªdËC®lbackPŒ
 
	glockFeHªdËr
;

323 
ušt32_t
 
	glockStus
;

324 
LockSequ’ûrT
 
	glockSequ’ûr
;

325 
	g¡d
::
¡ršg
 
hsF’ame
;

327 
HT_EXPECT
((
™”
 = 
m_£rv”_m­
.
fšd
(
loÿtiÚ
)è=ğm_£rv”_m­.
’d
(), 
E¼Ü
::
FAILED_EXPECTATION
);

329 
	g¡©ePŒ
 = 
Ãw
 
RªgeS”v”S‹
();

330 
	g¡©ePŒ
->
	gloÿtiÚ
 = 
loÿtiÚ
;

331 
	g¡©ePŒ
->
	gaddr
 = 
addr
;

333 ià(!
	gLoÿtiÚCache
::
loÿtiÚ_to_addr
(
loÿtiÚ
, 
®Ÿs
)) {

334 
HT_ERRORF
("ProbËm c»©šg‡dd»s äom†oÿtiÚ '%s'", 
loÿtiÚ
);

335 
	gcb
->
”rÜ
(
E¼Ü
::
INVALID_METADATA
, (
¡d
::
¡ršg
)"UÇbËØcÚv”ˆloÿtiÚ '" + 
loÿtiÚ
 + "'o‡ddress");

339 
Comm
 *
	gcomm
 = 
m_cÚn_mªag”_±r
->
g‘_comm
();

340 
	gcomm
->
£t_®Ÿs
(
addr
, 
®Ÿs
);

343 
	ghsF’ame
 = (
¡d
::
¡ršg
)"/hy³¹abË/£rv”s/" + 
loÿtiÚ
;

345 
	glockFeHªdËr
 = 
Ãw
 
S”v”LockFeHªdËr
(
¡©ePŒ
, 
this
, 
m_­p_queue_±r
);

347 ià((
	g”rÜ
 = 
m_hy³r¥aû_±r
->
İ’
(
hsF’ame
, 
oæags
, 
lockFeHªdËr
, &
¡©ePŒ
->
hy³r¥aûHªdË
)è!ğ
E¼Ü
::
OK
) {

348 
HT_ERRORF
("ProbËm o³nšg discov”ed s”v” f% - %s", 
hsF’ame
.
c_¡r
(), 
E¼Ü
::
g‘_‹xt
(
”rÜ
));

349 
	gcb
->
”rÜ
Ó¼Ü, (
¡d
::
¡ršg
)"ProbËm o³nšg discov”ed s”v” f'" + 
hsF’ame
 + "'");

353 ià((
	g”rÜ
 = 
m_hy³r¥aû_±r
->
Œy_lock
(
¡©ePŒ
->
hy³r¥aûHªdË
, 
LOCK_MODE_EXCLUSIVE
, &
lockStus
, &
lockSequ’ûr
)è!ğ
E¼Ü
::
OK
) {

354 
HT_ERRORF
("Problem‡ttemptingo obtainƒxclusive†ock on server Hyperspace file '%s' - %s",

355 
hsF’ame
.
c_¡r
(), 
E¼Ü
::
g‘_‹xt
(
”rÜ
));

356 
	gcb
->
”rÜ
Ó¼Ü, (
¡d
::
¡ršg
)"ProbËm‡‰em±šgØobšƒxşusivlock oÀ£rv” Hy³r¥aû f'" + 
hsF’ame
 + "'");

360 ià(
	glockStus
 =ğ
LOCK_STATUS_GRANTED
) {

361 
HT_INFOF
("Obšed†ock oÀ£rv” f%s,„emovšg...", 
hsF’ame
.
c_¡r
());

362 ià((
	g”rÜ
 = 
m_hy³r¥aû_±r
->
uÆšk
(
hsF’ame
)è!ğ
E¼Ü
::
OK
)

363 
HT_INFOF
("ProbËm d–‘šg Hy³r¥aû f%s", 
hsF’ame
.
c_¡r
());

364 ià((
	g”rÜ
 = 
m_hy³r¥aû_±r
->
şo£
(
¡©ePŒ
->
hy³r¥aûHªdË
)è!ğ
E¼Ü
::
OK
)

365 
HT_INFOF
("ProbËm closšg hªdË oÀd–‘šg Hy³r¥aû f%s", 
hsF’ame
.
c_¡r
());

368 
	gm_£rv”_m­
[
¡©ePŒ
->
loÿtiÚ
] = statePtr;

371 
	g¡d
::
¡ršg
 
addrSŒ
;

372 
HT_INFOF
("S”v” Regi¡”ed % -> %s", 
loÿtiÚ
, 
IÃtAddr
::
¡ršg_fÜm©
(
addrSŒ
, 
addr
));

373 
	gcout
 << 
	gæush
;

376 
	gcb
->
»¥Ú£_ok
();

381 ià(!
	gm_š™Ÿlized
) {

382 
	g”rÜ
;

383 
TabËId’tif›rT
 
	gbË
;

384 
RªgeT
 
	g¿nge
;

385 
RªgeS”v”Cl›Á
 
rsc
(
m_cÚn_mªag”_±r
->
g‘_comm
(), 30);

391 
	g¡d
::
¡ršg
 
”rMsg
;

392 
	g¡d
::
¡ršg
 
m‘ad©aSchemaFe
 = 
Sy¡em
::
š¡®lDœ
 + "/conf/METADATA.xml";

393 
off_t
 
	gschemaL’
;

394 cÚ¡ *
	gschemaSŒ
 = 
FeUts
::
fe_to_bufãr
(
m‘ad©aSchemaFe
.
c_¡r
(), &
schemaL’
);

396 ià((
	g”rÜ
 = 
ü—‹_bË
("METADATA", 
schemaSŒ
, 
”rMsg
)è!ğ
E¼Ü
::
OK
) {

397 
HT_ERRORF
("ProbËm c»©šg METADATAabË - %s", 
E¼Ü
::
g‘_‹xt
(
”rÜ
));

405 
	gm_m‘ad©a_bË_±r
 = 
Ãw
 
TabË
(
m_´İs_±r
, 
m_cÚn_mªag”_±r
->
g‘_comm
(), 
m_hy³r¥aû_±r
, "METADATA");

407 
	gm_m‘ad©a_bË_±r
->
g‘_id’tif›r
(&
bË
);

408 
	gbË
.
	gÇme
 = "METADATA";

413 
	g¿nge
.
	g¡¬tRow
 = 0;

414 
	g¿nge
.
	g’dRow
 = 
Key
::
END_ROOT_ROW
;

416 ià((
	g”rÜ
 = 
rsc
.
lßd_¿nge
(
®Ÿs
, 
bË
, 
¿nge
, 
m_max_¿nge_by‹s
, 0)è!ğ
E¼Ü
::
OK
) {

417 
¡d
::
¡ršg
 
addrSŒ
;

418 
HT_ERRORF
("Problem issuing 'load„ange' command for %s[..%s]‡t server %s",

419 
bË
.
Çme
, 
¿nge
.
’dRow
, 
IÃtAddr
::
¡ršg_fÜm©
(
addrSŒ
, 
®Ÿs
));

427 
TabËMutÜPŒ
 
	gmutÜ_±r
;

428 
KeyS³c
 
	gkey
;

429 
	g¡d
::
¡ršg
 
m‘ad©a_key_¡r
;

431 ià((
	g”rÜ
 = 
m_m‘ad©a_bË_±r
->
ü—‹_mutÜ
(
mutÜ_±r
)è!ğ
E¼Ü
::
OK
) {

433 
HT_ERROR
("Problem creating mutator on METADATAable");

434 
ex™
(1);

437 
	gm‘ad©a_key_¡r
 = 
¡d
::
¡ršg
("0:"è+ 
Key
::
END_ROW_MARKER
;

438 
	gkey
.
	grow
 = 
m‘ad©a_key_¡r
.
c_¡r
();

439 
	gkey
.
	grow_Ën
 = 
m‘ad©a_key_¡r
.
Ëngth
();

440 
	gkey
.
	gcŞumn_qu®if›r
 = 0;

441 
	gkey
.
	gcŞumn_qu®if›r_Ën
 = 0;

443 
	gŒy
 {

444 
	gkey
.
	gcŞumn_çmy
 = "StartRow";

445 
	gmutÜ_±r
->
£t
(0, 
key
, (
ušt8_t
 *)
Key
::
END_ROOT_ROW
, 
¡¾’
(Key::END_ROOT_ROW));

446 
	gmutÜ_±r
->
æush
();

448 
ÿtch
 (
Hy³¹abË
::
Exû±iÚ
 &
e
) {

450 
HT_ERRORF
("METADATA upd©”rÜ (row_key = %sè- % : %s", 
m‘ad©a_key_¡r
.
c_¡r
(), 
e
.
wh©
(), 
E¼Ü
::
g‘_‹xt
Ó.
code
()));

451 
ex™
(1);

457 
	g¿nge
.
	g¡¬tRow
 = 
Key
::
END_ROOT_ROW
;

458 
	g¿nge
.
	g’dRow
 = 
Key
::
END_ROW_MARKER
;

460 ià((
	g”rÜ
 = 
rsc
.
lßd_¿nge
(
®Ÿs
, 
bË
, 
¿nge
, 
m_max_¿nge_by‹s
, 0)è!ğ
E¼Ü
::
OK
) {

461 
¡d
::
¡ršg
 
addrSŒ
;

462 
HT_ERRORF
("Problem issuing 'load„ange' command for %s[..%s]‡t server %s",

463 
bË
.
Çme
, 
¿nge
.
’dRow
, 
IÃtAddr
::
¡ršg_fÜm©
(
addrSŒ
, 
®Ÿs
));

466 
	gm_š™Ÿlized
 = 
Œue
;

477 
	gMa¡”
::
»pÜt_¥l™
(
Re¥Ú£C®lback
 *
cb
, 
TabËId’tif›rT
 &
bË
, 
RªgeT
 &
¿nge
, 
ušt64_t
 
soá_lim™
) {

478 
	g”rÜ
;

479 
sockaddr_š
 
	gaddr
;

480 
RªgeS”v”Cl›Á
 
rsc
(
m_cÚn_mªag”_±r
->
g‘_comm
(), 30);

482 
HT_INFOF
("EÁ”šg„•Üt_¥l™ fÜ %s[%s:%s].", 
bË
.
Çme
, 
¿nge
.
¡¬tRow
,„ªge.
’dRow
);

484 
	gcb
->
»¥Ú£_ok
();

487 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

488 ià(
	gm_£rv”_m­_™”
 =ğ
m_£rv”_m­
.
’d
())

489 
m_£rv”_m­_™”
 = 
m_£rv”_m­
.
begš
();

490 
as£¹
(
m_£rv”_m­_™”
 !ğ
m_£rv”_m­
.
’d
());

491 
memıy
(&
addr
, &((*
m_£rv”_m­_™”
).
£cÚd
->addr), (
sockaddr_š
));

492 
HT_INFOF
("Assignšg‚ewly„•Ü‹d„ªg%s[%s:%s]Ø%s", 
bË
.
Çme
, 
¿nge
.
¡¬tRow
,„ªge.
’dRow
, (*
m_£rv”_m­_™”
).
fœ¡
.
c_¡r
());

493 
	gm_£rv”_m­_™”
++;

498 ià((
	g”rÜ
 = 
rsc
.
lßd_¿nge
(
addr
, 
bË
, 
¿nge
, 
soá_lim™
, 0)è!ğ
E¼Ü
::
OK
) {

499 
¡d
::
¡ršg
 
addrSŒ
;

500 
HT_ERRORF
("Problem issuing 'load„ange' command for %s[%s:%s]‡t server %s",

501 
bË
.
Çme
, 
¿nge
.
¡¬tRow
,„ªge.
’dRow
, 
IÃtAddr
::
¡ršg_fÜm©
(
addrSŒ
, 
addr
));

504 
HT_INFOF
("»pÜt_¥l™ fÜ %s[%s:%s] sucûssful.", 
bË
.
Çme
, 
¿nge
.
¡¬tRow
,„ªge.
’dRow
);

508 
	gMa¡”
::
drİ_bË
(
Re¥Ú£C®lback
 *
cb
, cÚ¡ *
bË_Çme
, 
boŞ
 
if_exi¡s
) {

509 
	g”rÜ
 = 
E¼Ü
::
OK
;

510 
	g§ved_”rÜ
 = 
E¼Ü
::
OK
;

511 
	g¡d
::
¡ršg
 
”r_msg
;

512 
	g¡d
::
¡ršg
 
bË_fe
 = (
¡d
::¡ršg)"/hy³¹abË/bËs/" + 
bË_Çme
;

513 
DyÇmicBufãr
 
v®ue_buf
(0);

514 
	giv®
;

515 
HªdËC®lbackPŒ
 
	gnuÎHªdËC®lback
;

516 
ušt64_t
 
	ghªdË
;

517 
	g¡d
::
¡ršg
 
bË_Çme_¡r
 = 
bË_Çme
;

519 #ià
defšed
(
__APPLE__
)

520 
	gboo¡
::
to_uµ”
(
bË_Çme_¡r
);

526 ià((
	g”rÜ
 = 
m_hy³r¥aû_±r
->
İ’
(
bË_fe
.
c_¡r
(), 
OPEN_FLAG_READ
, 
nuÎHªdËC®lback
, &
hªdË
)è!ğ
E¼Ü
::
OK
) {

527 ià(
if_exi¡s
 && 
”rÜ
 =ğ
E¼Ü
::
HYPERSPACE_BAD_PATHNAME
)

528 
cb
->
»¥Ú£_ok
();

530 
	gcb
->
”rÜ
Ó¼Ü, (
¡d
::
¡ršg
)"ProbËm o³nšg f'" + 
bË_fe
 + "'");

537 ià((
	g”rÜ
 = 
m_hy³r¥aû_±r
->
©Œ_g‘
(
hªdË
, "bË_id", 
v®ue_buf
)è!ğ
E¼Ü
::
OK
) {

538 
HT_ERRORF
("ProbËm g‘tšg‡‰ribu‹ 'bË_id' from f'%s' - %s", 
bË_fe
.
c_¡r
(), 
E¼Ü
::
g‘_‹xt
(
”rÜ
));

539 
	gcb
->
”rÜ
Ó¼Ü, (
¡d
::
¡ršg
)"ProbËm„—dšg‡‰ribu‹ 'bË_id' from f'" + 
bË_fe
 + "'");

546 ià((
	g”rÜ
 = 
m_hy³r¥aû_±r
->
şo£
(
hªdË
)è!ğ
E¼Ü
::
OK
) {

547 
HT_ERRORF
("ProbËm closšg hy³r¥aû hªdË %Îd - %s", ()
hªdË
, 
E¼Ü
::
g‘_‹xt
(
”rÜ
));

550 
as£¹
(
v®ue_buf
.
fl
(è=ğ(
št32_t
));

552 
memıy
(&
iv®
, 
v®ue_buf
.
buf
, (
št32_t
));

555 
	g¡¬t_row
[16];

556 
	g’d_row
[16];

557 
TabËSÿÂ”PŒ
 
	gsÿÂ”_±r
;

558 
SÿnS³cifiÿtiÚT
 
	gsÿn_¥ec
;

559 
C–lT
 
	gûÎ
;

560 
	g¡d
::
¡ršg
 
loÿtiÚ_¡r
;

561 
	g¡d
::
£t
<
¡d
::
¡ršg
> 
unique_loÿtiÚs
;

563 
¥rštf
(
¡¬t_row
, "%d:", 
iv®
);

564 
¥rštf
(
’d_row
, "%d:%s", 
iv®
, 
Key
::
END_ROW_MARKER
);

566 
	gsÿn_¥ec
.
	growLim™
 = 0;

567 
	gsÿn_¥ec
.
	gmax_v”siÚs
 = 1;

568 
	gsÿn_¥ec
.
	gcŞumns
.
ş—r
();

569 
	gsÿn_¥ec
.
	gcŞumns
.
push_back
("Location");

570 
	gsÿn_¥ec
.
	g¡¬tRow
 = 
¡¬t_row
;

571 
	gsÿn_¥ec
.
	g¡¬tRowInşusive
 = 
Œue
;

572 
	gsÿn_¥ec
.
	g’dRow
 = 
’d_row
;

573 
	gsÿn_¥ec
.
	g’dRowInşusive
 = 
Œue
;

574 
	gsÿn_¥ec
.
	gš‹rv®
.
	gfœ¡
 = 0;

575 
	gsÿn_¥ec
.
	gš‹rv®
.
	g£cÚd
 = 0;

576 
	gsÿn_¥ec
.
	g»tuº_d–‘es
=
çl£
;

578 ià((
	g”rÜ
 = 
m_m‘ad©a_bË_±r
->
ü—‹_sÿÂ”
(
sÿn_¥ec
, 
sÿÂ”_±r
)è!ğ
E¼Ü
::
OK
) {

579 
HT_ERRORF
("ProbËm c»©šg sÿÂ” oÀMETADATAabË - %s", 
E¼Ü
::
g‘_‹xt
(
”rÜ
));

580 
	gcb
->
”rÜ
(error, "Problem creating scanner on METADATAable");

584 
	gsÿÂ”_±r
->
Ãxt
(
ûÎ
)) {

585 
	gloÿtiÚ_¡r
 = 
¡d
::
¡ršg
((cÚ¡ *)
ûÎ
.
v®ue
, c–l.
v®ue_Ën
);

586 
	gboo¡
::
Œim
(
loÿtiÚ_¡r
);

587 ià(
	gloÿtiÚ_¡r
 !ğ"" && 
loÿtiÚ_¡r
 != "!")

588 
unique_loÿtiÚs
.
š£¹
(
loÿtiÚ_¡r
);

592 ià(!
	gunique_loÿtiÚs
.
em±y
()) {

593 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

594 
DrİTabËDi¥©chHªdËr
 
sync_hªdËr
(
bË_Çme_¡r
, 
m_cÚn_mªag”_±r
->
g‘_comm
(), 30);

595 
RªgeS”v”S‹PŒ
 
	g¡©e_±r
;

596 
	gS”v”M­T
::
™”©Ü
 
™”
;

598 
	g¡d
::
£t
<
¡d
::
¡ršg
>::
™”©Ü
 
loc_™”
 = 
unique_loÿtiÚs
.
begš
(); 
	gloc_™”
 !ğunique_loÿtiÚs.
’d
();†oc_iter++) {

599 ià((
	g™”
 = 
m_£rv”_m­
.
fšd
(*
loc_™”
)è!ğm_£rv”_m­.
’d
()) {

600 
sync_hªdËr
.
add
Ğ(*
™”
).
£cÚd
->
addr
 );

603 
	g§ved_”rÜ
 = 
E¼Ü
::
RANGESERVER_UNAVAILABLE
;

604 
	g”r_msg
 = *
loc_™”
;

608 ià(!
	gsync_hªdËr
.
wa™_fÜ_com¶‘iÚ
()) {

609 
	g¡d
::
veùÜ
<
DrİTabËDi¥©chHªdËr
::
E¼ÜResuÉT
> 
”rÜs
;

610 
	gsync_hªdËr
.
g‘_”rÜs
(
”rÜs
);

611 
size_t
 
	gi
=0; i<
	g”rÜs
.
size
(); i++) {

612 
HT_WARNF
("drİabËƒ¼Ü - % - %s", 
”rÜs
[
i
].
msg
.
c_¡r
(), 
E¼Ü
::
g‘_‹xt
Ó¼Üs[i].
”rÜ
));

614 
	gcb
->
”rÜ
(
”rÜs
[0].”rÜ,ƒ¼Üs[0].
msg
);

621 ià(
	g§ved_”rÜ
 !ğ
E¼Ü
::
OK
) {

622 
HT_ERRORF
("DROP TABLE faed '%s' - %s", 
”r_msg
.
c_¡r
(), 
E¼Ü
::
g‘_‹xt
(
”rÜ
));

623 
	gcb
->
”rÜ
(
§ved_”rÜ
, 
”r_msg
);

626 ià((
	g”rÜ
 = 
m_hy³r¥aû_±r
->
uÆšk
(
bË_fe
.
c_¡r
())è!ğ
E¼Ü
::
OK
) {

627 
HT_ERRORF
("ProbËm„emovšg hy³r¥aû f- %s", 
E¼Ü
::
g‘_‹xt
(
”rÜ
));

628 
	gcb
->
”rÜ
Ó¼Ü, (
¡d
::
¡ršg
)"ProbËm„emovšg f'" + 
bË_fe
 + "'");

632 
HT_INFOF
("DROP TABLE '%s' id=%d sucûss", 
bË_Çme_¡r
.
c_¡r
(), 
iv®
);

633 
	gcb
->
»¥Ú£_ok
();

634 
	gcout
 << 
	gæush
;

638 
	gMa¡”
::
ü—‹_bË
(cÚ¡ *
bËName
, cÚ¡ *
schemaSŒšg
, 
¡d
::
¡ršg
 &
”rMsg
) {

639 
”rÜ
 = 
E¼Ü
::
OK
;

640 
	g¡d
::
¡ršg
 
fš®Schema
 = "";

641 
	g¡d
::
¡ršg
 
bËFe
 = (
¡d
::¡ršg)"/hy³¹abË/bËs/" + 
bËName
;

642 
¡ršg
 
	gbËBa£Dœ
;

643 
¡ršg
 
	glgDœ
;

644 
Schema
 *
	gschema
 = 0;

645 
	gli¡
<
	gSchema
::
AcûssGroup
 *> *
lgLi¡
;

646 
boŞ
 
	gexi¡s
;

647 
HªdËC®lbackPŒ
 
	gnuÎHªdËC®lback
;

648 
ušt64_t
 
	ghªdË
;

649 
ušt32_t
 
	gbË_id
;

651 
	gm_hy³r¥aû_±r
->
£t_s’t_æag
(
Œue
);

656 ià((
	g”rÜ
 = 
m_hy³r¥aû_±r
->
exi¡s
(
bËFe
, &exi¡s)è!ğ
E¼Ü
::
OK
) {

657 
”rMsg
 = (
¡d
::
¡ršg
)"ProbËm checkšg fÜƒxi¡’û oàbË f'" + 
bËFe
 + "'";

658 
	gabÜt
;

660 ià(
	gexi¡s
) {

661 
	g”rMsg
 = 
bËName
;

662 
	g”rÜ
 = 
E¼Ü
::
MASTER_TABLE_EXISTS
;

663 
	gabÜt
;

669 
	gschema
 = 
Schema
::
Ãw_š¡ªû
(
schemaSŒšg
, 
¡¾’
(schemaString));

670 ià(!
	gschema
->
is_v®id
()) {

671 
	g”rMsg
 = 
schema
->
g‘_”rÜ_¡ršg
();

672 
	g”rÜ
 = 
E¼Ü
::
MASTER_BAD_SCHEMA
;

673 
	gabÜt
;

675 
	gschema
->
assign_ids
();

676 
	gschema
->
»nd”
(
fš®Schema
);

681 ià((
	g”rÜ
 = 
m_hy³r¥aû_±r
->
İ’
(
bËFe
, 
OPEN_FLAG_READ
|
OPEN_FLAG_WRITE
|
OPEN_FLAG_CREATE
, 
nuÎHªdËC®lback
, &
hªdË
)è!ğ
E¼Ü
::
OK
) {

682 
”rMsg
 = "UÇbËØü—‹ Hy³r¥aûabË f'" + 
bËFe
 + "' (" + 
E¼Ü
::
g‘_‹xt
(
”rÜ
) + ")";

683 
	gabÜt
;

690 ià(!
¡rcmp
(
bËName
, "METADATA"))

691 
	gbË_id
 = 0;

693 
	gbË_id
 = (
ušt32_t
)
©omic_šc_»tuº
(&
m_Ï¡_bË_id
);

694 ià((
	g”rÜ
 = 
m_hy³r¥aû_±r
->
©Œ_£t
(
m_ma¡”_fe_hªdË
, "Ï¡_bË_id", &
bË_id
, (
št32_t
))è!ğ
E¼Ü
::
OK
) {

695 
”rMsg
 = (
¡d
::
¡ršg
)"ProbËm s‘tšg‡‰ribu‹ 'Ï¡_bË_id' oàf/hy³¹abË/ma¡” - " + 
E¼Ü
::
g‘_‹xt
(
”rÜ
);

696 
	gabÜt
;

700 ià((
	g”rÜ
 = 
m_hy³r¥aû_±r
->
©Œ_£t
(
hªdË
, "bË_id", &
bË_id
, (
št32_t
))è!ğ
E¼Ü
::
OK
) {

701 
”rMsg
 = (
¡d
::
¡ršg
)"ProbËm s‘tšg‡‰ribu‹ 'bË_id' oàf" + 
bËFe
 + " - " + 
E¼Ü
::
g‘_‹xt
(
”rÜ
);

702 
	gabÜt
;

710 ià((
	g”rÜ
 = 
m_hy³r¥aû_±r
->
©Œ_£t
(
hªdË
, "schema", 
fš®Schema
.
c_¡r
(), 
¡¾’
(fš®Schema.c_¡r()))è!ğ
E¼Ü
::
OK
) {

711 
”rMsg
 = (
¡d
::
¡ršg
)"ProbËm c»©šg‡‰ribu‹ 'schema' fÜabË f'" + 
bËFe
 + "'";

712 
	gabÜt
;

715 
	gm_hy³r¥aû_±r
->
şo£
(
hªdË
);

720 
	gbËBa£Dœ
 = (
¡ršg
)"/hy³¹abË/bËs/" + 
bËName
 + "/";

721 
	glgLi¡
 = 
schema
->
g‘_acûss_group_li¡
();

722 
	gli¡
<
	gSchema
::
AcûssGroup
 *>::
™”©Ü
 
lgI‹r
 = 
lgLi¡
->
begš
(); 
	glgI‹r
 !ğlgLi¡->
’d
();†gIter++) {

723 
	glgDœ
 = 
bËBa£Dœ
 + (*
lgI‹r
)->
Çme
;

724 ià((
	g”rÜ
 = 
m_dfs_ş›Á
->
mkdœs
(
lgDœ
)è!ğ
E¼Ü
::
OK
) {

725 
”rMsg
 = (
¡ršg
)"ProbËm c»©šgabË dœeùÜy '" + 
lgDœ
 + "'";

726 
	gabÜt
;

733 ià(
	gbË_id
 != 0) {

734 
TabËMutÜPŒ
 
mutÜ_±r
;

735 
KeyS³c
 
	gkey
;

736 
	g¡d
::
¡ršg
 
m‘ad©a_key_¡r
;

737 
sockaddr_š
 
	gaddr
;

739 ià((
	g”rÜ
 = 
m_m‘ad©a_bË_±r
->
ü—‹_mutÜ
(
mutÜ_±r
)è!ğ
E¼Ü
::
OK
) {

741 
HT_ERROR
("Problem creating mutator on METADATAable");

742 
ex™
(1);

745 
	gm‘ad©a_key_¡r
 = 
¡d
::
¡ršg
(""è+ 
bË_id
 + ":" + 
Key
::
END_ROW_MARKER
;

746 
	gkey
.
	grow
 = 
m‘ad©a_key_¡r
.
c_¡r
();

747 
	gkey
.
	grow_Ën
 = 
m‘ad©a_key_¡r
.
Ëngth
();

748 
	gkey
.
	gcŞumn_qu®if›r
 = 0;

749 
	gkey
.
	gcŞumn_qu®if›r_Ën
 = 0;

751 
	gŒy
 {

752 
	gkey
.
	gcŞumn_çmy
 = "StartRow";

753 
	gmutÜ_±r
->
£t
(0, 
key
, 0, 0);

754 
	gmutÜ_±r
->
æush
();

756 
ÿtch
 (
Hy³¹abË
::
Exû±iÚ
 &
e
) {

758 
HT_ERRORF
("ProbËm upd©šg METADATA w™h‚ewabË infØÔow key = %sè- %s", 
m‘ad©a_key_¡r
.
c_¡r
(), 
e
.
wh©
());

759 
ex™
(1);

766 
TabËId’tif›rT
 
	gbË
;

767 
RªgeT
 
	g¿nge
;

768 
ušt64_t
 
	gsoá_lim™
;

769 
RªgeS”v”Cl›Á
 
rsc
(
m_cÚn_mªag”_±r
->
g‘_comm
(), 30);

771 
	gbË
.
	gÇme
 = 
bËName
;

772 
	gbË
.
	gid
 = 
bË_id
;

773 
	gbË
.
	gg’”©iÚ
 = 
schema
->
g‘_g’”©iÚ
();

775 
	g¿nge
.
	g¡¬tRow
 = 0;

776 
	g¿nge
.
	g’dRow
 = 
Key
::
END_ROW_MARKER
;

779 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

780 ià(
	gm_£rv”_m­_™”
 =ğ
m_£rv”_m­
.
’d
())

781 
m_£rv”_m­_™”
 = 
m_£rv”_m­
.
begš
();

782 
as£¹
(
m_£rv”_m­_™”
 !ğ
m_£rv”_m­
.
’d
());

783 
memıy
(&
addr
, &((*
m_£rv”_m­_™”
).
£cÚd
->addr), (
sockaddr_š
));

784 
HT_INFOF
("Assignšg fœ¡„ªg%s[%s:%s]Ø%s", 
bË
.
Çme
, 
¿nge
.
¡¬tRow
,„ªge.
’dRow
, (*
m_£rv”_m­_™”
).
fœ¡
.
c_¡r
());

785 
	gm_£rv”_m­_™”
++;

786 
	gsoá_lim™
 = 
m_max_¿nge_by‹s
 / 
¡d
::
mš
(64, ()
m_£rv”_m­
.
size
()*2);

789 ià((
	g”rÜ
 = 
rsc
.
lßd_¿nge
(
addr
, 
bË
, 
¿nge
, 
soá_lim™
, 0)è!ğ
E¼Ü
::
OK
) {

790 
¡d
::
¡ršg
 
addrSŒ
;

791 
HT_ERRORF
("Problem issuing 'load„ange' command for %s[..%s]‡t server %s",

792 
bË
.
Çme
, 
¿nge
.
’dRow
, 
IÃtAddr
::
¡ršg_fÜm©
(
addrSŒ
, 
addr
));

796 ià(
	gm_v”bo£
) {

797 
HT_INFOF
("SucûssfuÎy c»©edabË '%s' ID=%d", 
bËName
, 
bË_id
);

800 
	gabÜt
:

801 
m_hy³r¥aû_±r
->
£t_s’t_æag
(
çl£
);

802 
d–‘e
 
	gschema
;

803 ià(
	g”rÜ
 !ğ
E¼Ü
::
OK
) {

804 ià(
m_v”bo£
) {

805 
HT_ERRORF
("% '%s'", 
E¼Ü
::
g‘_‹xt
(
”rÜ
), 
”rMsg
.
c_¡r
());

808  
	g”rÜ
;

816 
boŞ
 
	gMa¡”
::
š™Ÿlize
() {

817 
”rÜ
;

818 
boŞ
 
	gexi¡s
;

819 
ušt64_t
 
	ghªdË
;

820 
HªdËC®lbackPŒ
 
	gnuÎHªdËC®lback
;

822 ià((
	g”rÜ
 = 
m_hy³r¥aû_±r
->
exi¡s
("/hy³¹abË/ma¡”", &exi¡s)è=ğ
E¼Ü
::
OK
 &&ƒxists &&

823 (
”rÜ
 = 
m_hy³r¥aû_±r
->
exi¡s
("/hy³¹abË/£rv”s", &exi¡s)è=ğ
E¼Ü
::
OK
 &&ƒxists)

824  
Œue
;

826 ià(!
ü—‹_hy³r¥aû_dœ
("/hypertable"))

827  
	gçl£
;

829 ià(!
ü—‹_hy³r¥aû_dœ
("/hypertable/servers"))

830  
	gçl£
;

832 ià(!
ü—‹_hy³r¥aû_dœ
("/hypertable/tables"))

833  
	gçl£
;

838 ià((
	g”rÜ
 = 
m_hy³r¥aû_±r
->
İ’
("/hy³¹abË/ma¡”", 
OPEN_FLAG_READ
|
OPEN_FLAG_WRITE
|
OPEN_FLAG_CREATE
, 
nuÎHªdËC®lback
, &
hªdË
)è!ğ
E¼Ü
::
OK
) {

839 
HT_ERRORF
("UÇbËØİ’ Hy³r¥aû f'/hy³¹abË/ma¡”' (%s)", 
E¼Ü
::
g‘_‹xt
(
”rÜ
));

840  
	gçl£
;

842 
	gm_ma¡”_fe_hªdË
 = 
hªdË
;

847 
ušt32_t
 
	gbË_id
 = 0;

848 ià((
	g”rÜ
 = 
m_hy³r¥aû_±r
->
©Œ_£t
(
m_ma¡”_fe_hªdË
, "Ï¡_bË_id", &
bË_id
, (
št32_t
))è!ğ
E¼Ü
::
OK
) {

849 
HT_ERRORF
("ProbËm s‘tšg‡‰ribu‹ 'Ï¡_bË_id' oàf/hy³¹abË/ma¡” - %s", 
E¼Ü
::
g‘_‹xt
(
”rÜ
));

850  
	gçl£
;

853 
	gm_hy³r¥aû_±r
->
şo£
(
hªdË
);

854 
	gm_ma¡”_fe_hªdË
 = 0;

859 ià((
	g”rÜ
 = 
m_hy³r¥aû_±r
->
İ’
("/hy³¹abË/roÙ", 
OPEN_FLAG_READ
|
OPEN_FLAG_WRITE
|
OPEN_FLAG_CREATE
, 
nuÎHªdËC®lback
, &
hªdË
)è!ğ
E¼Ü
::
OK
) {

860 
HT_ERRORF
("UÇbËØİ’ Hy³r¥aû f'/hy³¹abË/roÙ' (%s)", 
E¼Ü
::
g‘_‹xt
(
”rÜ
));

861  
	gçl£
;

863 
	gm_hy³r¥aû_±r
->
şo£
(
hªdË
);

865 
HT_INFO
("Successfully Initialized Hypertable.");

867  
	gŒue
;

874 
	gMa¡”
::
sÿn_£rv”s_dœeùÜy
() {

875 
boo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

876 
	g”rÜ
;

877 
HªdËC®lbackPŒ
 
	glockFeHªdËr
;

878 
	g¡d
::
veùÜ
<
DœEÁryT
> 
li¡šg
;

879 
ušt32_t
 
	glockStus
;

880 
LockSequ’ûrT
 
	glockSequ’ûr
;

881 
RªgeS”v”S‹PŒ
 
	g¡©ePŒ
;

882 
ušt32_t
 
	goæags
;

883 
	g¡d
::
¡ršg
 
hsF’ame
;

888 
	gm_£rv”s_dœ_ÿÎback_±r
 = 
Ãw
 
S”v”sDœeùÜyHªdËr
(
this
, 
m_­p_queue_±r
);

890 ià((
	g”rÜ
 = 
m_hy³r¥aû_±r
->
İ’
("/hy³¹abË/£rv”s", 
OPEN_FLAG_READ
, 
m_£rv”s_dœ_ÿÎback_±r
, &
m_£rv”s_dœ_hªdË
)è!ğ
E¼Ü
::
OK
) {

891 
HT_ERRORF
("Unableo open Hyperspace directory '/hypertable/servers' (%s) Try„e-running with --initialize",

892 
E¼Ü
::
g‘_‹xt
(
”rÜ
));

893 
ex™
(1);

896 ià((
	g”rÜ
 = 
m_hy³r¥aû_±r
->
»addœ
(
m_£rv”s_dœ_hªdË
, 
li¡šg
)è!ğ
E¼Ü
::
OK
) {

897 
HT_ERRORF
("ProbËm sÿÂšg Hy³r¥aû dœeùÜy '/hy³¹abË/£rv”s' - %s", 
E¼Ü
::
g‘_‹xt
(
”rÜ
));

898 
ex™
(1);

901 
	goæags
 = 
OPEN_FLAG_READ
 | 
OPEN_FLAG_WRITE
 | 
OPEN_FLAG_LOCK
;

903 
size_t
 
	gi
=0; i<
	gli¡šg
.
size
(); i++) {

905 
	g¡©ePŒ
 = 
Ãw
 
RªgeS”v”S‹
();

906 
	g¡©ePŒ
->
	gloÿtiÚ
 = 
li¡šg
[
i
].
Çme
;

908 
	ghsF’ame
 = (
¡d
::
¡ršg
)"/hy³¹abË/£rv”s/" + 
li¡šg
[
i
].
Çme
;

910 
	glockFeHªdËr
 = 
Ãw
 
S”v”LockFeHªdËr
(
¡©ePŒ
, 
this
, 
m_­p_queue_±r
);

912 ià((
	g”rÜ
 = 
m_hy³r¥aû_±r
->
İ’
(
hsF’ame
, 
oæags
, 
lockFeHªdËr
, &
¡©ePŒ
->
hy³r¥aûHªdË
)è!ğ
E¼Ü
::
OK
) {

913 
HT_ERRORF
("ProbËm o³nšg discov”ed s”v” f% - %s", 
hsF’ame
.
c_¡r
(), 
E¼Ü
::
g‘_‹xt
(
”rÜ
));

917 ià((
	g”rÜ
 = 
m_hy³r¥aû_±r
->
Œy_lock
(
¡©ePŒ
->
hy³r¥aûHªdË
, 
LOCK_MODE_EXCLUSIVE
, &
lockStus
, &
lockSequ’ûr
)è!ğ
E¼Ü
::
OK
) {

918 
HT_ERRORF
("ProbËm obššgƒxşusivlock oÀma¡” Hy³r¥aû f'/hy³¹abË/ma¡”' - %s", 
E¼Ü
::
g‘_‹xt
(
”rÜ
));

922 ià(
	glockStus
 =ğ
LOCK_STATUS_GRANTED
) {

923 
HT_INFOF
("Obšed†ock oÀ£rv” f%s,„emovšg...", 
hsF’ame
.
c_¡r
());

924 ià((
	g”rÜ
 = 
m_hy³r¥aû_±r
->
uÆšk
(
hsF’ame
)è!ğ
E¼Ü
::
OK
)

925 
HT_INFOF
("ProbËm d–‘šg Hy³r¥aû f%s", 
hsF’ame
.
c_¡r
());

926 ià((
	g”rÜ
 = 
m_hy³r¥aû_±r
->
şo£
(
¡©ePŒ
->
hy³r¥aûHªdË
)è!ğ
E¼Ü
::
OK
)

927 
HT_INFOF
("ProbËm closšg hªdË oÀd–‘šg Hy³r¥aû f%s", 
hsF’ame
.
c_¡r
());

930 
	gm_£rv”_m­
[
¡©ePŒ
->
loÿtiÚ
] = statePtr;

940 
boŞ
 
	gMa¡”
::
ü—‹_hy³r¥aû_dœ
(
¡d
::
¡ršg
 
dœ
) {

941 
”rÜ
;

942 
boŞ
 
	gexi¡s
;

947 ià((
	g”rÜ
 = 
m_hy³r¥aû_±r
->
exi¡s
(
dœ
, &exi¡s)è!ğ
E¼Ü
::
OK
) {

948 
HT_ERRORF
("ProbËm checkšg fÜƒxi¡’û oàdœeùÜy '%s' - %s", 
dœ
.
c_¡r
(), 
E¼Ü
::
g‘_‹xt
(
”rÜ
));

949  
	gçl£
;

952 ià(
	gexi¡s
)

953  
	gŒue
;

955 ià((
	g”rÜ
 = 
m_hy³r¥aû_±r
->
mkdœ
(
dœ
)è!ğ
E¼Ü
::
OK
) {

956 
HT_ERRORF
("ProbËm c»©šg dœeùÜy '%s' - %s", 
dœ
.
c_¡r
(), 
E¼Ü
::
g‘_‹xt
(
”rÜ
));

957  
	gçl£
;

960  
	gŒue
;

963 
	gMa¡”
::
još
() {

964 
m_­p_queue_±r
->
još
();

965 
	gm_th»ads
.
još_®l
();

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/Master.h

21 #iâdeà
HYPERTABLE_MASTER_H


22 
	#HYPERTABLE_MASTER_H


	)

24 
	~<ext/hash_m­
>

26 
	~<boo¡/th»ad/mu‹x.hµ
>

28 
	~"CommÚ/Th»ad.h
"

29 
	~"CommÚ/Prİ”t›s.h
"

30 
	~"CommÚ/Reã»nûCouÁ.h
"

31 
	~"CommÚ/SŒšgExt.h
"

33 
	~"AsyncComm/AµliÿtiÚQueue.h
"

34 
	~"AsyncComm/Comm.h
"

35 
	~"AsyncComm/CÚÃùiÚMªag”.h
"

36 
	~"AsyncComm/Ev’t.h
"

37 
	~"AsyncComm/Re¥Ú£C®lback.h
"

39 
	~"Hy³r¥aû/SessiÚ.h
"

41 
	~"Hy³¹abË/Lib/Fesy¡em.h
"

42 
	~"Hy³¹abË/Lib/TabË.h
"

43 
	~"Hy³¹abË/Lib/Ty³s.h
"

45 
	~"Hy³r¥aûSessiÚHªdËr.h
"

46 
	~"RªgeS”v”S‹.h
"

47 
	~"Re¥Ú£C®lbackG‘Schema.h
"

48 
	~"Ma¡”Gc.h
"

50 
Çme¥aû
 
	gHy³¹abË
 {

52 şas 
	cMa¡”
 : 
public
 
Reã»nûCouÁ
 {

53 
public
:

54 
Ma¡”
(
CÚÃùiÚMªag”PŒ
 &
cÚnMªag”PŒ
, 
Prİ”t›sPŒ
 &
´İs_±r
, 
AµliÿtiÚQueuePŒ
 &
­pQueuePŒ
);

55 ~
Ma¡”
();

57 
ü—‹_bË
(
Re¥Ú£C®lback
 *
cb
, cÚ¡ *
bËName
, cÚ¡ *
schemaSŒšg
);

58 
g‘_schema
(
Re¥Ú£C®lbackG‘Schema
 *
cb
, cÚ¡ *
bËName
);

59 
»gi¡”_£rv”
(
Re¥Ú£C®lback
 *
cb
, cÚ¡ *
loÿtiÚ
, 
sockaddr_š
 &
addr
);

60 
»pÜt_¥l™
(
Re¥Ú£C®lback
 *
cb
, 
TabËId’tif›rT
 &
bË
, 
RªgeT
 &
¿nge
, 
ušt64_t
 
soá_lim™
);

61 
drİ_bË
(
Re¥Ú£C®lback
 *
cb
, cÚ¡ *
bË_Çme
, 
boŞ
 
if_exi¡s
);

63 
£rv”_jošed
(
¡d
::
¡ršg
 &
loÿtiÚ
);

64 
£rv”_Ëá
(
¡d
::
¡ršg
 &
loÿtiÚ
);

66 
još
();

68 
	g´Ùeùed
:

69 
ü—‹_bË
(cÚ¡ *
bËName
, cÚ¡ *
schemaSŒšg
, 
¡d
::
¡ršg
 &
”rMsg
);

71 
	g´iv©e
:

72 
boŞ
 
š™Ÿlize
();

73 
sÿn_£rv”s_dœeùÜy
();

74 
boŞ
 
ü—‹_hy³r¥aû_dœ
(
¡d
::
¡ršg
 
dœ
);

76 
	gboo¡
::
mu‹x
 
m_mu‹x
;

77 
Prİ”t›sPŒ
 
	gm_´İs_±r
;

78 
CÚÃùiÚMªag”PŒ
 
	gm_cÚn_mªag”_±r
;

79 
AµliÿtiÚQueuePŒ
 
	gm_­p_queue_±r
;

80 
boŞ
 
	gm_v”bo£
;

81 
	gHy³r¥aû
::
SessiÚPŒ
 
m_hy³r¥aû_±r
;

82 
Fesy¡em
 *
	gm_dfs_ş›Á
;

83 
©omic_t
 
	gm_Ï¡_bË_id
;

84 
Hy³r¥aûSessiÚHªdËr
 
	gm_hy³r¥aû_£ssiÚ_hªdËr
;

85 
ušt64_t
 
	gm_ma¡”_fe_hªdË
;

86 
ušt64_t
 
	gm_£rv”s_dœ_hªdË
;

87 
LockSequ’ûrT
 
	gm_ma¡”_fe_£qu’ûr
;

88 
HªdËC®lbackPŒ
 
	gm_£rv”s_dœ_ÿÎback_±r
;

89 
TabËPŒ
 
	gm_m‘ad©a_bË_±r
;

90 
ušt64_t
 
	gm_max_¿nge_by‹s
;

93 
boŞ
 
	gm_š™Ÿlized
;

95 
	g__gnu_cxx
::
	thash_m­
<
	t¡d
::
	t¡ršg
, 
	tRªgeS”v”S‹PŒ
> 
	tS”v”M­T
;

97 
S”v”M­T
 
	gm_£rv”_m­
;

98 
	gS”v”M­T
::
™”©Ü
 
m_£rv”_m­_™”
;

100 
Th»adGroup
 
	gm_th»ads
;

102 
	gboo¡
::
	tšŒusive_±r
<
	tMa¡”
> 
	tMa¡”PŒ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/MasterGc.cc

20 
	~<uni¡d.h
>

21 
	~<c¡ršg
>

22 
	~"CommÚ/Sw“‹Ãr.h
"

23 
	~"CommÚ/Th»ad.h
"

24 
	~"CommÚ/Prİ”t›s.h
"

25 
	~"CommÚ/Ch¬SŒHashM­.h
"

26 
	~"Hy³¹abË/Lib/Fesy¡em.h
"

27 
	~"Hy³¹abË/Lib/TabË.h
"

28 
	~"Hy³¹abË/Lib/Ty³s.h
"

29 
	~"Ma¡”Gc.h
"

31 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

32 
usšg
 
Çme¥aû
 
	g¡d
;

34 
	gÇme¥aû
 {

36 
	gCh¬SŒHashM­
<> 
	tCouÁM­
;

38 
	sGcWÜk”
 {

39 
GcWÜk”
(
TabËPŒ
 &
m‘ad©a
, 
Fesy¡em
 *
fs
, 
š‹rv®
,

40 
boŞ
 
dryrun
 = 
çl£
è: 
m_m‘ad©a
(
m‘ad©a
),

41 
m_fs
(
fs
), 
m_š‹rv®
(
š‹rv®
), 
m_dryrun
(
dryrun
) {}

43 
	gTabËPŒ
 &
	gm_m‘ad©a
;

44 
Fesy¡em
 *
	gm_fs
;

45 
	gm_š‹rv®
;

46 
boŞ
 
	gm_dryrun
;

49 
sÿn_m‘ad©a
() {

50 
TabËSÿÂ”PŒ
 
	gsÿÂ”
;

51 
SÿnS³cifiÿtiÚT
 
	gsÿn_¥ec
;

53 
	gsÿn_¥ec
.
	growLim™
 = 0;

54 
	gsÿn_¥ec
.
	gmax_v”siÚs
 = 0;

55 
	gsÿn_¥ec
.
	gcŞumns
.
ş—r
();

56 
	gsÿn_¥ec
.
	gcŞumns
.
push_back
("Files");

57 
	gsÿn_¥ec
.
	g¡¬tRow
 = "";

58 
	gsÿn_¥ec
.
	g¡¬tRowInşusive
 = 
çl£
;

59 
	gsÿn_¥ec
.
	g’dRow
 = 
Key
::
END_ROW_MARKER
;;

60 
	gsÿn_¥ec
.
	g’dRowInşusive
 = 
çl£
;

61 
	gsÿn_¥ec
.
	gš‹rv®
.
	gfœ¡
 = 0;

62 
	gsÿn_¥ec
.
	gš‹rv®
.
	g£cÚd
 = 0;

63 
	gsÿn_¥ec
.
	g»tuº_d–‘es
=
çl£
;

65 
	g»t
 = 
m_m‘ad©a
->
ü—‹_sÿÂ”
(
sÿn_¥ec
, 
sÿÂ”
);

67 ià(
	g»t
 !ğ
E¼Ü
::
OK
) {

68 
HT_ERRORF
("Error creating scanner on METADATAable: %s",

69 
E¼Ü
::
g‘_‹xt
(
»t
));

72 
TabËMutÜPŒ
 
	gmutÜ
;

73 
	g»t
 = 
m_m‘ad©a
->
ü—‹_mutÜ
(
mutÜ
);

75 ià(
	g»t
 !ğ
E¼Ü
::
OK
) {

76 
HT_ERRORF
("Error creating mutator on METADATAable: %s",

77 
E¼Ü
::
g‘_‹xt
(
»t
));

80 
C–lT
 
	gûÎ
;

81 
¡ršg
 
	gÏ¡_row
;

82 
¡ršg
 
	gÏ¡_cq
;

83 
CouÁM­
 
	gfes_m­
;

84 
ušt64_t
 
	gÏ¡_time
 = 0;

85 
boŞ
 
	gfound_v®id_fes
 = 
Œue
;

86 
KeyS³c
 
	gkey
;

88 
mem£t
(&
key
, 0, (key));

89 
HT_DEBUG
("MasterGc: scanning metadata...");

91 
	gsÿÂ”
->
Ãxt
(
ûÎ
)) {

92 ià(
¡rcmp
("Fes", 
ûÎ
.
cŞumn_çmy
)) {

93 
HT_ERRORF
("Unexpected column family '%s', while scanning METADATA",

94 
ûÎ
.
cŞumn_çmy
);

97 ià(
	gÏ¡_row
 !ğ
ûÎ
.
row_key
) {

99 ià(!
found_v®id_fes
)

100 
d–‘e_row
(
key
, 
Ï¡_row
, 
mutÜ
);

102 
	gÏ¡_row
 = 
ûÎ
.
row_key
;

103 
	gÏ¡_time
 = 
ûÎ
.
time¡amp
;

104 
	gfound_v®id_fes
 = *
ûÎ
.
v®ue
 != '!';

106 ià(
	gfound_v®id_fes
)

107 
š£¹_fes
(
fes_m­
, (*)
ûÎ
.
v®ue
, c–l.
v®ue_Ën
, 1);

109 ià(
	gÏ¡_cq
 !ğ
ûÎ
.
cŞumn_qu®if›r
) {

111 
Ï¡_cq
 = 
ûÎ
.
cŞumn_qu®if›r
;

112 
	gÏ¡_time
 = 
ûÎ
.
time¡amp
;

113 
	gis_v®id_fes
 = *
ûÎ
.
v®ue
 != '!';

114 
	gfound_v®id_fes
 |ğ
is_v®id_fes
;

116 ià(
	gis_v®id_fes
)

117 
š£¹_fes
(
fes_m­
, (*)
ûÎ
.
v®ue
, c–l.
v®ue_Ën
, 1);

120 ià(
	gûÎ
.
	gtime¡amp
 > 
	gÏ¡_time
) {

121 
HT_ERROR
("Unexpectedimestamp order while scanning METADATA");

124 ià(*
	gûÎ
.
	gv®ue
 != '!')

125 
š£¹_fes
(
fes_m­
, (*)
ûÎ
.
v®ue
, c–l.
v®ue_Ën
);

129 ià(!
	gfound_v®id_fes
)

130 
d–‘e_row
(
key
, 
Ï¡_row
, 
mutÜ
);

132 
	gmutÜ
->
æush
();

133 
»­
(
fes_m­
);

137 
d–‘e_row
(
KeyS³c
 &
key
, cÚ¡ 
¡ršg
 &
row
, 
TabËMutÜPŒ
 &
mutÜ
) {

138 ià(
	grow
.
em±y
())

141 
	gkey
.
	grow
 = 
row
.
c_¡r
();

142 
	gkey
.
	grow_Ën
 = 
row
.
Ëngth
();

144 
HT_DEBUGF
("Ma¡”Gc: D–‘šg„ow %s", (*)
key
.
row
);

146 ià(!
	gm_dryrun
)

147 
	gmutÜ
->
£t_d–‘e
(0, 
key
);

151 
š£¹_fes
(
CouÁM­
 &
m­
, cÚ¡ *
buf
, 
size_t
 
Ën
, 
c
 = 0) {

152 cÚ¡ *
p
 = 
buf
, *
	gp0
 =…, *
	g’dp
 =… + 
Ën
 - 1;

154 
	gp
 < 
	g’dp
) {

155 *
	gp
 !ğ';' || 
p
[1] !ğ'\n' &&… < 
’dp
)

156 ++
p
;

158 ià(
	gp
 =ğ
’dp
)

161 
¡ršg
 
Çme
(
p0
, 
p
 -…0);

162 
	gp
 += 2;

163 
š£¹_fe
(
m­
, 
Çme
.
c_¡r
(), 
c
);

164 
	gp0
 = 
p
;

169 
š£¹_fe
(
CouÁM­
 &
m­
, cÚ¡ *
âame
, 
c
) {

170 
	gCouÁM­
::
InsR‘
 
»t
 = 
m­
.
š£¹
(
âame
, 
c
);

172 ià(!
	g»t
.
	g£cÚd
)

173 (*
	g»t
.
	gfœ¡
).
	g£cÚd
 +ğ
c
;

182 
»­
(
CouÁM­
 &
fes_m­
) {

183 
size_t
 
	gnf
 = 0, 
	gnd
 = 0;

184 
CouÁM­
 
	gdœs_m­
;

185 
	g»t
;

187 
fÜ—ch
 (cÚ¡ 
CouÁM­
::
v®ue_ty³
 &
v
, 
fes_m­
) {

188 ià(!
	gv
.
	g£cÚd
) {

191 
¡ršg
 
Çme
(
v
.
fœ¡
);

193 
HT_DEBUGF
("Ma¡”Gc:„emovšg f%s", 
v
.
fœ¡
);

195 ià(!
	gm_dryrun
) {

196 ià((
	g»t
 = 
m_fs
->
»move
(
Çme
)è!ğ
E¼Ü
::
OK
)

197 
HT_ERRORF
("E¼Ü„emovšg f'%s'", 
v
.
fœ¡
);

199 ++
	gnf
;

202 *
	gp
 = 
¡¼chr
(
v
.
fœ¡
, '/');

204 ià(
	gp
) {

205 
¡ršg
 
dœ_Çme
(
v
.
fœ¡
, 
p
 - v.first);

206 
š£¹_fe
(
dœs_m­
, 
dœ_Çme
.
c_¡r
(), 
v
.
£cÚd
);

209 
fÜ—ch
 (cÚ¡ 
CouÁM­
::
v®ue_ty³
 &
v
, 
dœs_m­
) {

210 ià(!
	gv
.
	g£cÚd
) {

212 
¡ršg
 
Çme
(
v
.
fœ¡
);

214 
HT_DEBUGF
("Ma¡”Gc:„emovšg dœeùÜy %s", 
v
.
fœ¡
);

216 ià(!
	gm_dryrun
) {

217 ià((
	g»t
 = 
m_fs
->
rmdœ
(
Çme
)è!ğ
E¼Ü
::
OK
)

218 
HT_ERRORF
("E¼Ü„emovšg dœeùÜy '%s'", 
v
.
fœ¡
);

220 ++
	gnd
;

225 
HT_DEBUGF
("Ma¡”Gc:„emoved %lu fes; %lu dœeùÜ›s", 
nf
, 
nd
);

229 
gc
() {

230 
	gŒy
 {

231 
sÿn_m‘ad©a
();

233 
ÿtch
 (
Exû±iÚ
 &
e
) {

234 
HT_ERRORF
("E¼Ü: caughˆexû±iÚ whgc'šg: %s", 
e
.
wh©
());

239 
İ”©Ü
()() {

241 
	g»maš
 = 
¦“p
(
m_š‹rv®
);

243 ià(
	g»maš
)

246 ià(
	gm_m‘ad©a
è
gc
();

247 
HT_INFOF
("MasterGc: METADATA‚ot„eady, willry‡gain in "

248 "%d secÚds", 
m_š‹rv®
);

250 } 
	gŒue
);

256 
Çme¥aû
 
	gHy³¹abË
 {

259 
ma¡”_gc_¡¬t
(
Prİ”t›sPŒ
 
´İs
, 
Th»adGroup
 &
th»ads
,

260 
TabËPŒ
 &
m‘ad©a
, 
Fesy¡em
 *
fs
) {

261 
	gš‹rv®
 = 
´İs
->
g‘_št
("Hypertable.Master.Gc.Interval", 300);

263 
	gth»ads
.
ü—‹_th»ad
(
GcWÜk”
(
m‘ad©a
, 
fs
, 
š‹rv®
));

265 
HT_INFOF
("Startedable file garbage collectionhread with interval: "

266 "%d secÚds", 
š‹rv®
);

270 
ma¡”_gc_Úû
(
TabËPŒ
 &
m‘ad©a
, 
Fesy¡em
 *
fs
, 
boŞ
 
dryrun
) {

271 
GcWÜk”
 
wÜk”
(
m‘ad©a
, 
fs
, 0, 
dryrun
);

272 
	gwÜk”
.
gc
();

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/MasterGc.h

20 #iâdeà
HYPERTABLE_TABLE_FILE_GC_H


21 
	#HYPERTABLE_TABLE_FILE_GC_H


	)

23 
Çme¥aû
 
	gHy³¹abË
 {

25 
ma¡”_gc_¡¬t
(
Prİ”t›sPŒ
 
´İs
, 
Th»adGroup
 &
th»ads
,

26 
TabËPŒ
 &
m‘ad©a
, 
Fesy¡em
 *
fs
);

28 
ma¡”_gc_Úû
(
TabËPŒ
 &
m‘ad©a
, 
Fesy¡em
 *
fs
,

29 
boŞ
 
dryrun
 = 
çl£
);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/RangeServerState.h

21 #iâdeà
HYPERTABLE_RANGESERVERSTATE_H


22 
	#HYPERTABLE_RANGESERVERSTATE_H


	)

24 
	~"CommÚ/Reã»nûCouÁ.h
"

26 
Çme¥aû
 
	gHy³¹abË
 {

28 şas 
	cRªgeS”v”S‹
 : 
public
 
Reã»nûCouÁ
 {

29 
public
:

30 
¡d
::
¡ršg
 
loÿtiÚ
;

31 
ušt64_t
 
	ghy³r¥aûHªdË
;

32 
sockaddr_š
 
	gaddr
;

35 
	gboo¡
::
	tšŒusive_±r
<
	tRªgeS”v”S‹
> 
	tRªgeS”v”S‹PŒ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/RequestHandlerCreateTable.cc

21 
	~"CommÚ/E¼Ü.h
"

22 
	~"CommÚ/Logg”.h
"

24 
	~"AsyncComm/Re¥Ú£C®lback.h
"

25 
	~"AsyncComm/S”Ÿliz©iÚ.h
"

27 
	~"Ma¡”.h
"

28 
	~"Reque¡HªdËrC»©eTabË.h
"

30 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

35 
	gReque¡HªdËrC»©eTabË
::
	$run
() {

36 
Re¥Ú£C®lback
 
	`cb
(
m_comm
, 
m_ev’t_±r
);

37 cÚ¡ *
bËName
;

38 cÚ¡ *
schemaSŒšg
;

39 
size_t
 
»maššg
 = 
m_ev’t_±r
->
mes§geL’
 - 2;

40 
ušt8_t
 *
msgPŒ
 = 
m_ev’t_±r
->
mes§ge
 + 2;

43 ià(!
S”Ÿliz©iÚ
::
	`decode_¡ršg
(&
msgPŒ
, &
»maššg
, &
bËName
))

44 
abÜt
;

47 ià(!
S”Ÿliz©iÚ
::
	`decode_¡ršg
(&
msgPŒ
, &
»maššg
, &
schemaSŒšg
))

48 
abÜt
;

50 
m_ma¡”
->
	`ü—‹_bË
(&
cb
, 
bËName
, 
schemaSŒšg
);

54 
abÜt
:

55 
	`HT_ERROR
("Encoding…roblem with Create Table message");

56 
cb
.
	`”rÜ
(
E¼Ü
::
PROTOCOL_ERROR
, "Encoding…roblem with Create Table message");

58 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/RequestHandlerCreateTable.h

21 #iâdeà
HYPERTABLE_REQUESTHANDLERCREATETABLE_H


22 
	#HYPERTABLE_REQUESTHANDLERCREATETABLE_H


	)

24 
	~"CommÚ/RuÂabË.h
"

26 
	~"AsyncComm/AµliÿtiÚHªdËr.h
"

27 
	~"AsyncComm/Comm.h
"

28 
	~"AsyncComm/Ev’t.h
"

30 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

32 
Çme¥aû
 
	gHy³¹abË
 {

34 
şass
 
	gMa¡”
;

36 şas 
	cReque¡HªdËrC»©eTabË
 : 
public
 
AµliÿtiÚHªdËr
 {

37 
public
:

38 
Reque¡HªdËrC»©eTabË
(
Comm
 *
comm
, 
Ma¡”
 *
ma¡”
, 
Ev’tPŒ
 &
ev’tPŒ
è: 
AµliÿtiÚHªdËr
Óv’tPŒ), 
m_comm
(comm), 
m_ma¡”
(master) {

42 
vœtu®
 
run
();

44 
	g´iv©e
:

45 
Comm
 *
m_comm
;

46 
Ma¡”
 *
	gm_ma¡”
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/RequestHandlerDropTable.cc

21 
	~"CommÚ/E¼Ü.h
"

22 
	~"CommÚ/Logg”.h
"

24 
	~"AsyncComm/Re¥Ú£C®lback.h
"

25 
	~"AsyncComm/S”Ÿliz©iÚ.h
"

27 
	~"Ma¡”.h
"

28 
	~"Reque¡HªdËrDrİTabË.h
"

30 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

35 
	gReque¡HªdËrDrİTabË
::
	$run
() {

36 
Re¥Ú£C®lback
 
	`cb
(
m_comm
, 
m_ev’t_±r
);

37 
boŞ
 
if_exi¡s
;

38 cÚ¡ *
bË_Çme
;

39 
size_t
 
»maššg
 = 
m_ev’t_±r
->
mes§geL’
 - 2;

40 
ušt8_t
 *
msgPŒ
 = 
m_ev’t_±r
->
mes§ge
 + 2;

43 ià(!
S”Ÿliz©iÚ
::
	`decode_boŞ
(&
msgPŒ
, &
»maššg
, &
if_exi¡s
))

44 
abÜt
;

47 ià(!
S”Ÿliz©iÚ
::
	`decode_¡ršg
(&
msgPŒ
, &
»maššg
, &
bË_Çme
))

48 
abÜt
;

50 
m_ma¡”
->
	`drİ_bË
(&
cb
, 
bË_Çme
, 
if_exi¡s
);

54 
abÜt
:

55 
	`HT_ERROR
("Encoding…roblem with Drop Table message");

56 
cb
.
	`”rÜ
(
E¼Ü
::
PROTOCOL_ERROR
, "Encoding…roblem with Drop Table message");

58 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/RequestHandlerDropTable.h

21 #iâdeà
HYPERTABLE_REQUESTHANDLERDROPTABLE_H


22 
	#HYPERTABLE_REQUESTHANDLERDROPTABLE_H


	)

24 
	~"CommÚ/RuÂabË.h
"

26 
	~"AsyncComm/AµliÿtiÚHªdËr.h
"

27 
	~"AsyncComm/Comm.h
"

28 
	~"AsyncComm/Ev’t.h
"

30 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

32 
Çme¥aû
 
	gHy³¹abË
 {

34 
şass
 
	gMa¡”
;

36 şas 
	cReque¡HªdËrDrİTabË
 : 
public
 
AµliÿtiÚHªdËr
 {

37 
public
:

38 
Reque¡HªdËrDrİTabË
(
Comm
 *
comm
, 
Ma¡”
 *
ma¡”
, 
Ev’tPŒ
 &
ev’tPŒ
è: 
AµliÿtiÚHªdËr
Óv’tPŒ), 
m_comm
(comm), 
m_ma¡”
(master) {

42 
vœtu®
 
run
();

44 
	g´iv©e
:

45 
Comm
 *
m_comm
;

46 
Ma¡”
 *
	gm_ma¡”
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/RequestHandlerGetSchema.cc

21 
	~"CommÚ/E¼Ü.h
"

22 
	~"CommÚ/Logg”.h
"

24 
	~"AsyncComm/Comm.h
"

25 
	~"AsyncComm/S”Ÿliz©iÚ.h
"

27 
	~"Ma¡”.h
"

28 
	~"Reque¡HªdËrG‘Schema.h
"

29 
	~"Re¥Ú£C®lbackG‘Schema.h
"

31 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

36 
	gReque¡HªdËrG‘Schema
::
	$run
() {

37 
Re¥Ú£C®lbackG‘Schema
 
	`cb
(
m_comm
, 
m_ev’t_±r
);

38 cÚ¡ *
bËName
;

39 
size_t
 
»maššg
 = 
m_ev’t_±r
->
mes§geL’
 - 2;

40 
ušt8_t
 *
msgPŒ
 = 
m_ev’t_±r
->
mes§ge
 + 2;

43 ià(!
S”Ÿliz©iÚ
::
	`decode_¡ršg
(&
msgPŒ
, &
»maššg
, &
bËName
)) {

44 
	`HT_ERROR
("Encoding…roblem with Create Table message");

45 
cb
.
	`”rÜ
(
E¼Ü
::
PROTOCOL_ERROR
, "Encoding…roblem with Create Table message");

49 
m_ma¡”
->
	`g‘_schema
(&
cb
, 
bËName
);

50 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/RequestHandlerGetSchema.h

21 #iâdeà
HYPERTABLE_REQUESTHANDLERGETSCHEMA_H


22 
	#HYPERTABLE_REQUESTHANDLERGETSCHEMA_H


	)

24 
	~"CommÚ/RuÂabË.h
"

26 
	~"AsyncComm/AµliÿtiÚHªdËr.h
"

27 
	~"AsyncComm/Ev’t.h
"

29 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

31 
Çme¥aû
 
	gHy³¹abË
 {

33 
şass
 
	gComm
;

34 
şass
 
	gMa¡”
;

36 şas 
	cReque¡HªdËrG‘Schema
 : 
public
 
AµliÿtiÚHªdËr
 {

37 
public
:

38 
Reque¡HªdËrG‘Schema
(
Comm
 *
comm
, 
Ma¡”
 *
ma¡”
, 
Ev’tPŒ
 &
ev’tPŒ
è: 
AµliÿtiÚHªdËr
Óv’tPŒ), 
m_comm
(comm), 
m_ma¡”
(master) {

42 
vœtu®
 
run
();

44 
	g´iv©e
:

45 
Comm
 *
m_comm
;

46 
Ma¡”
 *
	gm_ma¡”
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/RequestHandlerRegisterServer.cc

21 
	~"CommÚ/E¼Ü.h
"

22 
	~"CommÚ/Logg”.h
"

24 
	~"AsyncComm/Re¥Ú£C®lback.h
"

25 
	~"AsyncComm/S”Ÿliz©iÚ.h
"

27 
	~"Ma¡”.h
"

28 
	~"Reque¡HªdËrRegi¡”S”v”.h
"

30 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

35 
	gReque¡HªdËrRegi¡”S”v”
::
	$run
() {

36 
Re¥Ú£C®lback
 
	`cb
(
m_comm
, 
m_ev’t_±r
);

37 cÚ¡ *
loÿtiÚ
;

38 
size_t
 
»maššg
 = 
m_ev’t_±r
->
mes§geL’
 - 2;

39 
ušt8_t
 *
msgPŒ
 = 
m_ev’t_±r
->
mes§ge
 + 2;

42 ià(!
S”Ÿliz©iÚ
::
	`decode_¡ršg
(&
msgPŒ
, &
»maššg
, &
loÿtiÚ
))

43 
abÜt
;

45 
m_ma¡”
->
	`»gi¡”_£rv”
(&
cb
, 
loÿtiÚ
, 
m_ev’t_±r
->
addr
);

49 
abÜt
:

50 
	`HT_ERROR
("Encoding…roblem with Register Server message");

51 
cb
.
	`”rÜ
(
E¼Ü
::
PROTOCOL_ERROR
, "Encoding…roblem with Register Server message");

53 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/RequestHandlerRegisterServer.h

21 #iâdeà
HYPERTABLE_REQUESTHANDLERREGISTERSERVER_H


22 
	#HYPERTABLE_REQUESTHANDLERREGISTERSERVER_H


	)

24 
	~"CommÚ/RuÂabË.h
"

26 
	~"AsyncComm/AµliÿtiÚHªdËr.h
"

27 
	~"AsyncComm/Comm.h
"

28 
	~"AsyncComm/Ev’t.h
"

30 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

32 
Çme¥aû
 
	gHy³¹abË
 {

34 
şass
 
	gMa¡”
;

36 şas 
	cReque¡HªdËrRegi¡”S”v”
 : 
public
 
AµliÿtiÚHªdËr
 {

37 
public
:

38 
Reque¡HªdËrRegi¡”S”v”
(
Comm
 *
comm
, 
Ma¡”
 *
ma¡”
, 
Ev’tPŒ
 &
ev’tPŒ
è: 
AµliÿtiÚHªdËr
Óv’tPŒ), 
m_comm
(comm), 
m_ma¡”
(master) {

42 
vœtu®
 
run
();

44 
	g´iv©e
:

45 
Comm
 *
m_comm
;

46 
Ma¡”
 *
	gm_ma¡”
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/RequestHandlerReportSplit.cc

21 
	~"CommÚ/E¼Ü.h
"

22 
	~"CommÚ/Logg”.h
"

24 
	~"AsyncComm/Re¥Ú£C®lback.h
"

25 
	~"AsyncComm/S”Ÿliz©iÚ.h
"

27 
	~"Hy³¹abË/Lib/Ty³s.h
"

29 
	~"Ma¡”.h
"

30 
	~"Reque¡HªdËrR•ÜtS¶™.h
"

32 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

37 
	gReque¡HªdËrR•ÜtS¶™
::
	$run
() {

38 
Re¥Ú£C®lback
 
	`cb
(
m_comm
, 
m_ev’t_±r
);

39 
TabËId’tif›rT
 
bË
;

40 
RªgeT
 
¿nge
;

41 
ušt64_t
 
soá_lim™
;

42 
size_t
 
»maššg
 = 
m_ev’t_±r
->
mes§geL’
 - 2;

43 
ušt8_t
 *
msgPŒ
 = 
m_ev’t_±r
->
mes§ge
 + 2;

46 ià(!
	`DecodeTabËId’tif›r
(&
msgPŒ
, &
»maššg
, &
bË
))

47 
abÜt
;

50 ià(!
	`DecodeRªge
(&
msgPŒ
, &
»maššg
, &
¿nge
))

51 
abÜt
;

54 ià(!
S”Ÿliz©iÚ
::
	`decode_lÚg
(&
msgPŒ
, &
»maššg
, &
soá_lim™
))

55 
abÜt
;

57 
m_ma¡”
->
	`»pÜt_¥l™
(&
cb
, 
bË
, 
¿nge
, 
soá_lim™
);

61 
abÜt
:

62 
	`HT_ERROR
("Encoding…roblem with ReportSplit message");

63 
cb
.
	`”rÜ
(
E¼Ü
::
PROTOCOL_ERROR
, "Encoding…roblem with ReportSplit message");

64 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/RequestHandlerReportSplit.h

21 #iâdeà
HYPERTABLE_REQUESTHANDLERREPORTSPLIT_H


22 
	#HYPERTABLE_REQUESTHANDLERREPORTSPLIT_H


	)

24 
	~"CommÚ/RuÂabË.h
"

26 
	~"AsyncComm/AµliÿtiÚHªdËr.h
"

27 
	~"AsyncComm/Comm.h
"

28 
	~"AsyncComm/Ev’t.h
"

30 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

32 
Çme¥aû
 
	gHy³¹abË
 {

34 
şass
 
	gMa¡”
;

36 şas 
	cReque¡HªdËrR•ÜtS¶™
 : 
public
 
AµliÿtiÚHªdËr
 {

37 
public
:

38 
Reque¡HªdËrR•ÜtS¶™
(
Comm
 *
comm
, 
Ma¡”
 *
ma¡”
, 
Ev’tPŒ
 &
ev’tPŒ
è: 
AµliÿtiÚHªdËr
Óv’tPŒ), 
m_comm
(comm), 
m_ma¡”
(master) {

42 
vœtu®
 
run
();

44 
	g´iv©e
:

45 
Comm
 *
m_comm
;

46 
Ma¡”
 *
	gm_ma¡”
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/RequestHandlerStatus.cc

21 
	~"CommÚ/E¼Ü.h
"

22 
	~"CommÚ/Logg”.h
"

24 
	~"AsyncComm/Comm.h
"

26 
	~"Ma¡”.h
"

27 
	~"Reque¡HªdËrStus.h
"

29 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

34 
	gReque¡HªdËrStus
::
	$run
() {

35 
Re¥Ú£C®lback
 
	`cb
(
m_comm
, 
m_ev’t_±r
);

36 
cb
.
	`»¥Ú£_ok
();

37 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/RequestHandlerStatus.h

21 #iâdeà
HYPERTABLE_REQUESTHANDLERSTATUS_H


22 
	#HYPERTABLE_REQUESTHANDLERSTATUS_H


	)

24 
	~"CommÚ/RuÂabË.h
"

26 
	~"AsyncComm/AµliÿtiÚHªdËr.h
"

27 
	~"AsyncComm/Ev’t.h
"

29 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

31 
Çme¥aû
 
	gHy³¹abË
 {

33 
şass
 
	gComm
;

34 
şass
 
	gMa¡”
;

36 şas 
	cReque¡HªdËrStus
 : 
public
 
AµliÿtiÚHªdËr
 {

37 
public
:

38 
Reque¡HªdËrStus
(
Comm
 *
comm
, 
Ma¡”
 *
ma¡”
, 
Ev’tPŒ
 &
ev’tPŒ
è: 
AµliÿtiÚHªdËr
Óv’tPŒ), 
m_comm
(comm), 
m_ma¡”
(master) {

42 
vœtu®
 
run
();

44 
	g´iv©e
:

45 
Comm
 *
m_comm
;

46 
Ma¡”
 *
	gm_ma¡”
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/ResponseCallbackGetSchema.cc

21 
	~"CommÚ/E¼Ü.h
"

23 
	~"AsyncComm/CommBuf.h
"

24 
	~"AsyncComm/S”Ÿliz©iÚ.h
"

26 
	~"Re¥Ú£C®lbackG‘Schema.h
"

28 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

30 
	gRe¥Ú£C®lbackG‘Schema
::
	$»¥Ú£
(cÚ¡ *
schema
) {

31 
hbud”_
.
	`š™Ÿlize_äom_»que¡
(
m_ev’t_±r
->
h—d”
);

32 
CommBufPŒ
 
	`cbufPŒ
Ğ
Ãw
 
	`CommBuf
(
hbud”_
, 4 + 
S”Ÿliz©iÚ
::
	`’coded_Ëngth_¡ršg
(
schema
)) );

33 
cbufPŒ
->
	`­³nd_št
(
E¼Ü
::
OK
);

34 
cbufPŒ
->
	`­³nd_¡ršg
(
schema
);

35  
m_comm
->
	`£nd_»¥Ú£
(
m_ev’t_±r
->
addr
, 
cbufPŒ
);

36 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/ResponseCallbackGetSchema.h

21 #iâdeà
HYPERTABLE_RESPONSECALLBACKGETSCHEMA_H


22 
	#HYPERTABLE_RESPONSECALLBACKGETSCHEMA_H


	)

24 
	~"CommÚ/E¼Ü.h
"

26 
	~"AsyncComm/CommBuf.h
"

27 
	~"AsyncComm/Re¥Ú£C®lback.h
"

29 
Çme¥aû
 
	gHy³¹abË
 {

31 şas 
	cRe¥Ú£C®lbackG‘Schema
 : 
public
 
Re¥Ú£C®lback
 {

32 
public
:

33 
Re¥Ú£C®lbackG‘Schema
(
Comm
 *
comm
, 
Ev’tPŒ
 &
ev’tPŒ
è: 
Re¥Ú£C®lback
(comm,ƒventPtr) { ; }

34 
»¥Ú£
(cÚ¡ *
schema
);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/ServerLockFileHandler.cc

21 
	~"AsyncComm/AµliÿtiÚQueue.h
"

22 
	~"AsyncComm/Ev’t.h
"

24 
	~"Ma¡”.h
"

25 
	~"S”v”LockFeHªdËr.h
"

26 
	~"Ev’tHªdËrS”v”Leá.h
"

28 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

33 
	gS”v”LockFeHªdËr
::
	$lock_acquœed
(
ušt32_t
 
mode
) {

34 
	}
}

39 
S”v”LockFeHªdËr
::
	$lock_»Ëa£d
() {

40 
Ev’tPŒ
 
nuÎEv’t
;

41 
m_­p_queue_±r
->
	`add
Ğ
Ãw
 
	`Ev’tHªdËrS”v”Leá
(
m_ma¡”_±r
, 
m_¡©e_±r
->
loÿtiÚ
, 
nuÎEv’t
) );

42 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/ServerLockFileHandler.h

21 #iâdeà
HYPERTABLE_SERVERLOCKFILEHANDLER_H


22 
	#HYPERTABLE_SERVERLOCKFILEHANDLER_H


	)

24 
	~"AsyncComm/AµliÿtiÚQueue.h
"

26 
	~"Hy³r¥aû/HªdËC®lback.h
"

28 
usšg
 
Çme¥aû
 
	gHy³r¥aû
;

30 
Çme¥aû
 
	gHy³¹abË
 {

32 
şass
 
	gMa¡”
;

37 şas 
	cS”v”LockFeHªdËr
 : 
public
 
HªdËC®lback
 {

38 
public
:

39 
S”v”LockFeHªdËr
(
RªgeS”v”S‹PŒ
 &
¡©ePŒ
, 
Ma¡”PŒ
 
ma¡”PŒ
, 
AµliÿtiÚQueuePŒ
 &
­pQueuePŒ
è: 
HªdËC®lback
(
EVENT_MASK_LOCK_ACQUIRED
|
EVENT_MASK_LOCK_RELEASED
), 
m_¡©e_±r
(¡©ePŒ), 
m_ma¡”_±r
(ma¡”PŒ), 
m_­p_queue_±r
(appQueuePtr) { ; }

40 
vœtu®
 
lock_acquœed
(
ušt32_t
 
mode
);

41 
vœtu®
 
lock_»Ëa£d
();

42 
RªgeS”v”S‹PŒ
 
	gm_¡©e_±r
;

43 
Ma¡”PŒ
 
	gm_ma¡”_±r
;

44 
AµliÿtiÚQueuePŒ
 
	gm_­p_queue_±r
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/ServersDirectoryHandler.cc

21 
	~"Ev’tHªdËrS”v”Jošed.h
"

22 
	~"Ev’tHªdËrS”v”Leá.h
"

23 
	~"S”v”sDœeùÜyHªdËr.h
"

24 
	~"Ma¡”.h
"

26 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

31 
	gS”v”sDœeùÜyHªdËr
::
chd_node_added
(
¡d
::
¡ršg
 
Çme
) {

32 
Ev’tPŒ
 
nuÎEv’t
;

33 
	gm_­p_queue_±r
->
add
Ğ
Ãw
 
Ev’tHªdËrS”v”Jošed
(
m_ma¡”_±r
, 
Çme
, 
nuÎEv’t
) );

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/ServersDirectoryHandler.h

21 #iâdeà
HYPERTABLE_SERVERSDIRECTORYHANDLER_H


22 
	#HYPERTABLE_SERVERSDIRECTORYHANDLER_H


	)

24 
	~"AsyncComm/AµliÿtiÚQueue.h
"

26 
	~"Hy³r¥aû/HªdËC®lback.h
"

28 
	~"Ma¡”.h
"

30 
usšg
 
Çme¥aû
 
	gHy³r¥aû
;

32 
Çme¥aû
 
	gHy³¹abË
 {

37 şas 
	cS”v”sDœeùÜyHªdËr
 : 
public
 
HªdËC®lback
 {

38 
public
:

39 
S”v”sDœeùÜyHªdËr
(
Ma¡”PŒ
 
ma¡”PŒ
, 
AµliÿtiÚQueuePŒ
 &
­pQueuePŒ
è: 
HªdËC®lback
(
EVENT_MASK_CHILD_NODE_ADDED
), 
m_ma¡”_±r
(ma¡”PŒ), 
m_­p_queue_±r
(appQueuePtr) { ; }

40 
vœtu®
 
chd_node_added
(
¡d
::
¡ršg
 
Çme
);

41 
Ma¡”PŒ
 
	gm_ma¡”_±r
;

42 
AµliÿtiÚQueuePŒ
 
	gm_­p_queue_±r
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/htgc.cc

20 
	~<io¡»am
>

21 
	~"CommÚ/Th»ad.h
"

22 
	~"CommÚ/Sy¡em.h
"

23 
	~"CommÚ/Logg”.h
"

24 
	~"CommÚ/E¼Ü.h
"

25 
	~"Hy³¹abË/Lib/Cl›Á.h
"

26 
	~"DfsBrok”/Lib/Cl›Á.h
"

27 
	~"Ma¡”Gc.h
"

29 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

30 
usšg
 
Çme¥aû
 
	g¡d
;

32 
	gÇme¥aû
 {

35 
do_tfgc
(cÚ¡ *
cÚfig
, 
boŞ
 
debug
, boŞ 
dryrun
) {

36 ià(
	gdebug
)

37 
	gLogg”
::
£t_Ëv–
(
log4ıp
::
PriÜ™y
::
DEBUG
);

39 
	gŒy
 {

40 
Prİ”t›sPŒ
 
	g´İs
 = 
Ãw
 
Prİ”t›s
(
cÚfig
);

41 
Comm
 *
	gcomm
 = 
Ãw
 Comm();

42 
CÚÃùiÚMªag”PŒ
 
	gcÚn_mgr
 = 
Ãw
 
CÚÃùiÚMªag”
(
comm
);

43 
	gDfsBrok”
::
Cl›Á
 *
fs
 = 
Ãw
 
DfsBrok”
::Cl›Á(
cÚn_mgr
, 
´İs
);

44 
Cl›ÁPŒ
 
	ght_±r
 = 
Ãw
 
Hy³¹abË
::
Cl›Á
("‹¡gc", 
cÚfig
);

45 
TabËPŒ
 
	gbË_±r
;

47 
	g»t
 = 
ht_±r
->
İ’_bË
("METADATA", 
bË_±r
);

49 ià(
	g»t
 !ğ
E¼Ü
::
OK
) {

50 
û¼
 << "E¼Ü o³nšg METADATA" << 
’dl
;

51 
ex™
(1);

53 
ma¡”_gc_Úû
(
bË_±r
, 
fs
, 
dryrun
);

55 
ÿtch
 (
exû±iÚ
 &
e
) {

56 
	gû¼
 << "E¼Ü: "<< 
	ge
.
wh©
(è<< 
	g’dl
;

57 
ex™
(1);

64 
	$maš
(
ac
, *
av
[]) {

65 **
™
 = 
av
 + 1, **
¬g_’d
 =‡v + 
ac
;

66 
boŞ
 
debug
 = 
çl£
, 
dryrun
 = false;

67 *
cÚfig
 = "conf/hypertable.cfg";

68 
Sy¡em
::
	`š™Ÿlize
(
av
[0]);

70 ; 
™
 < 
¬g_’d
; ++it) {

71 ià(!
	`¡rcmp
("-d", *
™
))

72 
debug
 = 
Œue
;

73 ià(!
	`¡rcmp
("-n", *
™
))

74 
dryrun
 = 
Œue
;

75 ià(!
	`¡rcmp
("-f", *
™
))

76 
cÚfig
 = *++
™
;

78 
R—ùÜFaùÜy
::
	`š™Ÿlize
(4);

79 
	`do_tfgc
(
cÚfig
, 
debug
, 
dryrun
);

82 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/main.cc

21 
	~<io¡»am
>

22 
	~<f¡»am
>

23 
	~<¡ršg
>

26 
	~<pŞl.h
>

27 
	~<sys/ty³s.h
>

28 
	~<uni¡d.h
>

31 
	~"CommÚ/IÃtAddr.h
"

32 
	~"CommÚ/Sy¡em.h
"

33 
	~"CommÚ/U§ge.h
"

35 
	~"AsyncComm/AµliÿtiÚQueue.h
"

36 
	~"AsyncComm/Comm.h
"

37 
	~"AsyncComm/CÚÃùiÚHªdËrFaùÜy.h
"

39 
	~"CÚÃùiÚHªdËr.h
"

40 
	~"Ma¡”.h
"

42 
usšg
 
Çme¥aû
 
Hy³¹abË
;

43 
usšg
 
Çme¥aû
 
	g¡d
;

46 
	gÇme¥aû
 {

47 cÚ¡ *
	gu§ge
[] = {

60 cÚ¡ 
	gDEFAULT_PORT
 = 38050;

61 cÚ¡ 
	gDEFAULT_WORKERS
 = 20;

67 şas 
	cHªdËrFaùÜy
 : 
public
 
CÚÃùiÚHªdËrFaùÜy
 {

68 
public
:

69 
HªdËrFaùÜy
(
Comm
 *
comm
, 
AµliÿtiÚQueuePŒ
 &
­pQueuePŒ
, 
Ma¡”PŒ
 &
ma¡”_±r
è: 
m_comm
(comm), 
m_­p_queue_±r
×µQueuePŒ), 
m_ma¡”_±r
(master_ptr) { ; }

70 
vœtu®
 
g‘_š¡ªû
(
Di¥©chHªdËrPŒ
 &
dhp
) {

71 
	gdhp
 = 
Ãw
 
CÚÃùiÚHªdËr
(
m_comm
, 
m_­p_queue_±r
, 
m_ma¡”_±r
);

73 
	g´iv©e
:

74 
Comm
 *
m_comm
;

75 
AµliÿtiÚQueuePŒ
 
	gm_­p_queue_±r
;

76 
Ma¡”PŒ
 
	gm_ma¡”_±r
;

85 
	$maš
(
¬gc
, **
¬gv
) {

86 
¡ršg
 
cÚfigFe
 = "";

87 
¡ršg
 
pidFe
 = "";

88 
Prİ”t›sPŒ
 
´İs_±r
;

89 
boŞ
 
v”bo£
 = 
çl£
;

90 
Ma¡”PŒ
 
ma¡”_±r
;

91 
pÜt
, 
»aùÜCouÁ
, 
wÜk”CouÁ
;

92 
Comm
 *
comm
;

93 
AµliÿtiÚQueuePŒ
 
­p_queue_±r
;

94 
CÚÃùiÚMªag”PŒ
 
cÚnMªag”PŒ
;

95 
sockaddr_š
 
li¡’Addr
;

97 
Sy¡em
::
	`š™Ÿlize
(
¬gv
[0]);

99 ià(
¬gc
 > 1) {

100 
i
=1; i<
¬gc
; i++) {

101 ià(!
	`¡ºcmp
(
¬gv
[
i
], "--config=", 9))

102 
cÚfigFe
 = &
¬gv
[
i
][9];

103 ià(!
	`¡ºcmp
(
¬gv
[
i
], "--pidfile=", 10))

104 
pidFe
 = &
¬gv
[
i
][10];

105 ià(!
	`¡rcmp
(
¬gv
[
i
], "--verbose") || !strcmp(argv[i], "-v"))

106 
v”bo£
 = 
Œue
;

108 
U§ge
::
	`dump_ªd_ex™
(
u§ge
);

112 ià(
cÚfigFe
 == "")

113 
cÚfigFe
 = 
Sy¡em
::
š¡®lDœ
 + "/conf/hypertable.cfg";

115 
´İs_±r
 = 
Ãw
 
	`Prİ”t›s
(
cÚfigFe
);

117 ià(
v”bo£
)

118 
´İs_±r
->
	`£t
("Hypertable.Verbose", "true");

120 
pÜt
 = 
´İs_±r
->
	`g‘_št
("Hy³¹abË.Ma¡”.PÜt", 
DEFAULT_PORT
);

121 
»aùÜCouÁ
 = 
´İs_±r
->
	`g‘_št
("Hy³¹abË.Ma¡”.R—ùÜs", 
Sy¡em
::
	`g‘_´oûssÜ_couÁ
());

122 
wÜk”CouÁ
 = 
´İs_±r
->
	`g‘_št
("Hy³¹abË.Ma¡”.WÜk”s", 
DEFAULT_WORKERS
);

124 
R—ùÜFaùÜy
::
	`š™Ÿlize
(
»aùÜCouÁ
);

126 
comm
 = 
Ãw
 
	`Comm
();

127 
cÚnMªag”PŒ
 = 
Ãw
 
	`CÚÃùiÚMªag”
(
comm
);

129 ià(
v”bo£
) {

130 
cout
 << "CPU couÁ = " << 
Sy¡em
::
	`g‘_´oûssÜ_couÁ
(è<< 
’dl
;

131 
cout
 << "Hy³¹abË.Ma¡”.PÜt=" << 
pÜt
 << 
’dl
;

132 
cout
 << "Hy³¹abË.Ma¡”.WÜk”s=" << 
wÜk”CouÁ
 << 
’dl
;

133 
cout
 << "Hy³¹abË.Ma¡”.R—ùÜs=" << 
»aùÜCouÁ
 << 
’dl
;

136 
­p_queue_±r
 = 
Ãw
 
	`AµliÿtiÚQueue
(
wÜk”CouÁ
);

137 
ma¡”_±r
 = 
Ãw
 
	`Ma¡”
(
cÚnMªag”PŒ
, 
´İs_±r
, 
­p_queue_±r
);

139 
IÃtAddr
::
	`š™Ÿlize
(&
li¡’Addr
, 
INADDR_ANY
, 
pÜt
);

140 
CÚÃùiÚHªdËrFaùÜyPŒ
 
	`chfPŒ
(
Ãw
 
	`HªdËrFaùÜy
(
comm
, 
­p_queue_±r
, 
ma¡”_±r
));

141 
comm
->
	`li¡’
(
li¡’Addr
, 
chfPŒ
);

143 ià(
pidFe
 != "") {

144 
f¡»am
 
	`fe¡r
 (
pidFe
.
	`c_¡r
(), f¡»am::
out
);

145 
fe¡r
 << 
	`g‘pid
(è<< 
’dl
;

146 
fe¡r
.
	`şo£
();

149 
ma¡”_±r
->
	`još
();

151 
d–‘e
 
comm
;

153 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/AccessGroup.cc

21 
	~<®gÜ™hm
>

22 
	~<™”©Ü
>

23 
	~<veùÜ
>

25 
	~"CommÚ/E¼Ü.h
"

26 
	~"CommÚ/md5.h
"

28 
	~"AcûssGroup.h
"

29 
	~"C–lCache.h
"

30 
	~"C–lCacheSÿÂ”.h
"

31 
	~"C–lStÜeV0.h
"

32 
	~"Glob®.h
"

33 
	~"M”geSÿÂ”.h
"

34 
	~"M‘ad©aNÜm®.h
"

35 
	~"M‘ad©aRoÙ.h
"

38 
	gÇme¥aû
 {

39 cÚ¡ 
ušt32_t
 
	gDEFAULT_BLOCKSIZE
 = 65536;

43 
	gAcûssGroup
::
AcûssGroup
(
TabËId’tif›rT
 &
bË_id’tif›r
, 
SchemaPŒ
 &
schemaPŒ
, 
Schema
::AcûssGrou°*
ag
, 
RªgeT
 *
¿nge
è: 
C–lLi¡
(), 
m_mu‹x
(), 
m_schema_±r
(schemaPŒ), 
m_Çme
×g->
Çme
), 
m_¡Ües
(), 
m_ûÎ_ÿche_±r
(), 
m_Ãxt_bË_id
(0), 
m_disk_u§ge
(0), 
m_blocksize
(
DEFAULT_BLOCKSIZE
), 
m_com´essiÚ_¿tio
(1.0), 
m_is_roÙ
(
çl£
), 
m_Şde¡_ÿched_time¡amp
(0), 
m_cŞlisiÚs
(0), 
m_Ãeds_com·ùiÚ
(çl£), 
	$m_drİ
(
çl£
) {

44 
m_bË_Çme
 = 
bË_id’tif›r
.
Çme
;

45 
m_¡¬t_row
 = 
¿nge
->
¡¬tRow
;

46 
m_’d_row
 = 
¿nge
->
’dRow
;

47 
m_ûÎ_ÿche_±r
 = 
Ãw
 
	`C–lCache
();

49 
li¡
<
Schema
::
CŞumnFamy
 *>::
™”©Ü
 
™”
 = 
ag
->
cŞumns
.
	`begš
(); i‹¸!ğag->cŞumns.
	`’d
(); iter++) {

50 
m_cŞumn_çm›s
.
	`š£¹
((
ušt8_t
)(*
™”
)->
id
);

52 
	`Cİy
(
bË_id’tif›r
, 
m_bË_id’tif›r
);

53 ià(
ag
->
blocksize
 != 0)

54 
m_blocksize
 = 
ag
->
blocksize
;

56 
m_com´essÜ
 = (
ag
->
com´essÜ
 !ğ""è?‡g->com´essÜ : 
schemaPŒ
->
	`g‘_com´essÜ
();

58 
m_is_roÙ
 = (
bË_id’tif›r
.
id
 =ğ0 && *
¿nge
->
¡¬tRow
 =ğ0 && !
	`¡rcmp
Ôªge->
’dRow
, 
Key
::
END_ROOT_ROW
));

60 
m_š_memÜy
 = 
ag
->
š_memÜy
;

61 
	}
}

64 
	gAcûssGroup
::~
	$AcûssGroup
() {

65 ià(
m_drİ
) {

66 ià(
m_bË_id’tif›r
.
id
 == 0) {

67 
	`HT_ERROR
("~AccessGroup has drop bit set, butable is METADATA");

68 
	`F»e
(
m_bË_id’tif›r
);

71 
¡d
::
¡ršg
 
m‘ad©a_key
 = std::
	`¡ršg
(""è+ (
ušt32_t
)
m_bË_id’tif›r
.
id
 + ":" + 
m_’d_row
;

72 
”rÜ
;

73 
TabËMutÜPŒ
 
mutÜ_±r
;

74 
KeyS³c
 
key
;

76 ià((
”rÜ
 = 
Glob®
::
m‘ad©a_bË_±r
->
	`ü—‹_mutÜ
(
mutÜ_±r
)è!ğ
E¼Ü
::
OK
) {

77 
	`HT_ERRORF
("ProbËm c»©šg mutÜ oÀMETADATAabË - %s", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

78 
	`F»e
(
m_bË_id’tif›r
);

82 
Œy
 {

83 
key
.
row
 = 
m‘ad©a_key
.
	`c_¡r
();

84 
key
.
row_Ën
 = 
m‘ad©a_key
.
	`Ëngth
();

85 
key
.
cŞumn_çmy
 = "Files";

86 
key
.
cŞumn_qu®if›r
 = 
m_Çme
.
	`c_¡r
();

87 
key
.
cŞumn_qu®if›r_Ën
 = 
m_Çme
.
	`Ëngth
();

88 
mutÜ_±r
->
	`£t
(
key
, (
ušt8_t
 *)"!", 1);

89 
mutÜ_±r
->
	`æush
();

91 
	`ÿtch
 (
Hy³¹abË
::
Exû±iÚ
 &
e
) {

93 
	`HT_ERRORF
("Problem updating 'File' column of METADATA (%s) - %s",

94 
m‘ad©a_key
.
	`c_¡r
(), 
E¼Ü
::
	`g‘_‹xt
(
e
.
	`code
()));

97 
	`F»e
(
m_bË_id’tif›r
);

99 
	}
}

106 
	gAcûssGroup
::
	$add
(cÚ¡ 
By‹SŒšg32T
 *
key
, cÚ¡ By‹SŒšg32T *
v®ue
, 
ušt64_t
 
»®_time¡amp
) {

108 ià(
m_Şde¡_ÿched_time¡amp
 == 0)

109 
m_Şde¡_ÿched_time¡amp
 = 
»®_time¡amp
;

110  
m_ûÎ_ÿche_±r
->
	`add
(
key
, 
v®ue
, 
»®_time¡amp
);

111 
	}
}

114 
C–lLi¡SÿÂ”
 *
	gAcûssGroup
::
	$ü—‹_sÿÂ”
(
SÿnCÚ‹xtPŒ
 &
sÿnCÚ‹xtPŒ
) {

115 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

116 
M”geSÿÂ”
 *
sÿÂ”
 = 
Ãw
 
	`M”geSÿÂ”
(
sÿnCÚ‹xtPŒ
);

117 
sÿÂ”
->
	`add_sÿÂ”
Ğ
m_ûÎ_ÿche_±r
->
	`ü—‹_sÿÂ”
(
sÿnCÚ‹xtPŒ
) );

118 
size_t
 
i
=0; i<
m_¡Ües
.
	`size
(); i++)

119 
sÿÂ”
->
	`add_sÿÂ”
Ğ
m_¡Ües
[
i
]->
	`ü—‹_sÿÂ”
(
sÿnCÚ‹xtPŒ
) );

120  
sÿÂ”
;

121 
	}
}

123 
boŞ
 
	gAcûssGroup
::
	$šşude_š_sÿn
(
SÿnCÚ‹xtPŒ
 &
sÿnCÚ‹xtPŒ
) {

124 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

125 
¡d
::
£t
<
ušt8_t
>::
™”©Ü
 
™”
 = 
m_cŞumn_çm›s
.
	`begš
(); i‹¸!ğm_cŞumn_çm›s.
	`’d
(); iter++) {

126 ià(
sÿnCÚ‹xtPŒ
->
çmyMask
[*
™”
])

127  
Œue
;

129  
çl£
;

130 
	}
}

132 cÚ¡ *
	gAcûssGroup
::
	$g‘_¥l™_row
() {

133 
¡d
::
veùÜ
<¡d::
¡ršg
> 
¥l™_rows
;

134 
	`g‘_¥l™_rows
(
¥l™_rows
, 
Œue
);

135 ià(
¥l™_rows
.
	`size
() > 0) {

136 
	`sÜt
(
¥l™_rows
.
	`begš
(), s¶™_rows.
	`’d
());

137  (
¥l™_rows
[¥l™_rows.
	`size
()/2]).
	`c_¡r
();

140 
	}
}

142 
	gAcûssGroup
::
g‘_¥l™_rows
(
¡d
::
veùÜ
<¡d::
¡ršg
> &
¥l™_rows
, 
boŞ
 
šşude_ÿche
) {

143 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

144 cÚ¡ *
	grow
;

145 
size_t
 
	gi
=0; i<
	gm_¡Ües
.
size
(); i++) {

146 
	grow
 = 
m_¡Ües
[
i
]->
g‘_¥l™_row
();

147 ià(
	grow
)

148 
	g¥l™_rows
.
push_back
(
row
);

150 ià(
	gšşude_ÿche
)

151 
	gm_ûÎ_ÿche_±r
->
g‘_¥l™_rows
(
¥l™_rows
);

154 
	gAcûssGroup
::
g‘_ÿched_rows
(
¡d
::
veùÜ
<¡d::
¡ršg
> &
rows
) {

155 
m_ûÎ_ÿche_±r
->
g‘_rows
(
rows
);

158 
ušt64_t
 
	gAcûssGroup
::
	$disk_u§ge
() {

159 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

160  
m_disk_u§ge
 + (
ušt64_t
)(
m_com´essiÚ_¿tio
 * ()
m_ûÎ_ÿche_±r
->
	`memÜy_u£d
());

161 
	}
}

163 
	gAcûssGroup
::
	$g‘_com·ùiÚ_´iÜ™y_d©a
(
Com·ùiÚPriÜ™yD©aT
 &
´iÜ™y_d©a
) {

164 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

165 
´iÜ™y_d©a
.
ag
 = 
this
;

166 
´iÜ™y_d©a
.
Şde¡_ÿched_time¡amp
 = 
m_Şde¡_ÿched_time¡amp
;

167 
´iÜ™y_d©a
.
mem_u£d
 = 
m_ûÎ_ÿche_±r
->
	`memÜy_u£d
();

168 
´iÜ™y_d©a
.
disk_u£d
 = 
m_disk_u§ge
 + (
ušt64_t
)(
m_com´essiÚ_¿tio
 * ()
m_ûÎ_ÿche_±r
->
	`memÜy_u£d
());

169 
´iÜ™y_d©a
.
š_memÜy
 = 
m_š_memÜy
;

170 
´iÜ™y_d©a
.
d–‘es
 = 
m_ûÎ_ÿche_±r
->
	`g‘_d–‘e_couÁ
();

171 
	}
}

174 
	gAcûssGroup
::
	$add_ûÎ_¡Üe
(
C–lStÜePŒ
 &
ûÎ¡Üe_±r
, 
ušt32_t
 
id
) {

175 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

176 ià(
id
 >ğ
m_Ãxt_bË_id
)

177 
m_Ãxt_bË_id
 = 
id
+1;

178 
m_¡Ües
.
	`push_back
(
ûÎ¡Üe_±r
);

179 
m_disk_u§ge
 +ğ
ûÎ¡Üe_±r
->
	`disk_u§ge
();

180 ià(
m_com·ùiÚ_time¡amp
.
logiÿl
 == 0)

181 
ûÎ¡Üe_±r
->
	`g‘_time¡amp
(
m_com·ùiÚ_time¡amp
);

183 
Time¡amp
 
time¡amp
;

184 
ûÎ¡Üe_±r
->
	`g‘_time¡amp
(
time¡amp
);

185 ià(
time¡amp
.
»®
 > 
m_com·ùiÚ_time¡amp
.real)

186 
m_com·ùiÚ_time¡amp
 = 
time¡amp
;

188 
	}
}

191 
	gÇme¥aû
 {

192 
	sÉC–lStÜe
 {

193 
boŞ
 
İ”©Ü
()(cÚ¡ 
	gC–lStÜePŒ
 &
	gcsPŒ1
, cÚ¡ C–lStÜePŒ &
	gcsPŒ2
) const {

194  !(
	gcsPŒ1
->
disk_u§ge
(è< 
	gcsPŒ2
->disk_usage());

200 
	gAcûssGroup
::
	$run_com·ùiÚ
(
Time¡amp
 
time¡amp
, 
boŞ
 
majÜ
) {

201 
¡d
::
¡ršg
 
ûÎStÜeFe
;

202 
md5Dige¡SŒ
[33];

203 
f’ame
[16];

204 
By‹SŒšg32T
 *
key
 = 0;

205 
By‹SŒšg32T
 *
v®ue
 = 0;

206 
Key
 
keyComps
;

207 
C–lLi¡SÿÂ”PŒ
 
sÿÂ”PŒ
;

208 
size_t
 
bËIndex
 = 1;

209 
C–lStÜePŒ
 
ûÎStÜePŒ
;

210 
¡d
::
¡ršg
 
fes
;

211 
¡d
::
¡ršg
 
m‘ad©a_key_¡r
;

213 ià(!
majÜ
 && !
m_Ãeds_com·ùiÚ
)

216 
m_Ãeds_com·ùiÚ
 = 
çl£
;

219 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

220 ià(
m_š_memÜy
) {

221 
bËIndex
 = 0;

222 
	`HT_INFOF
("S¹šg InMemÜy Com·ùiÚ (%s.% ’d_row='%s')", 
m_bË_Çme
.
	`c_¡r
(), 
m_Çme
.c_¡r(), 
m_’d_row
.c_str());

224 ià(
majÜ
) {

226 ià(
m_ûÎ_ÿche_±r
->
	`memÜy_u£d
(è=ğ0 && 
m_¡Ües
.
	`size
(è<ğ(
size_t
)1)

228 
bËIndex
 = 0;

229 
	`HT_INFOF
("S¹šg MajÜ Com·ùiÚ (%s.%s)", 
m_bË_Çme
.
	`c_¡r
(), 
m_Çme
.c_str());

232 ià(
m_¡Ües
.
	`size
(è> (
size_t
)
Glob®
::
loÿl™yGroupMaxFes
) {

233 
ÉC–lStÜe
 
sÜtObj
;

234 
	`sÜt
(
m_¡Ües
.
	`begš
(), m_¡Ües.
	`’d
(), 
sÜtObj
);

235 
bËIndex
 = 
m_¡Ües
.
	`size
(è- 
Glob®
::
loÿl™yGroupM”geFes
;

236 
	`HT_INFOF
("S¹šg M”gšg Com·ùiÚ (%s.%s)", 
m_bË_Çme
.
	`c_¡r
(), 
m_Çme
.c_str());

239 
bËIndex
 = 
m_¡Ües
.
	`size
();

240 
	`HT_INFOF
("S¹šg MšÜ Com·ùiÚ (%s.%s)", 
m_bË_Çme
.
	`c_¡r
(), 
m_Çme
.c_str());

245 ià(
m_’d_row
 == "")

246 
	`mem£t
(
md5Dige¡SŒ
, '0', 24);

248 
	`md5_¡ršg
(
m_’d_row
.
	`c_¡r
(), 
md5Dige¡SŒ
);

249 
md5Dige¡SŒ
[24] = 0;

250 
	`¥rštf
(
f’ame
, "cs%d", 
m_Ãxt_bË_id
++);

251 
ûÎStÜeFe
 = (
¡ršg
)"/hy³¹abË/bËs/" + 
m_bË_Çme
 + "/" + 
m_Çme
 + "/" + 
md5Dige¡SŒ
 + "/" + 
f’ame
;

253 
ûÎStÜePŒ
 = 
Ãw
 
	`C–lStÜeV0
(
Glob®
::
dfs
);

255 ià(
ûÎStÜePŒ
->
	`ü—‹
(
ûÎStÜeFe
.
	`c_¡r
(), 
m_blocksize
, 
m_com´essÜ
) != 0) {

256 
	`HT_ERRORF
("ProbËm com·ùšg†oÿl™y grou°tØf'%s'", 
ûÎStÜeFe
.
	`c_¡r
());

261 
SÿnCÚ‹xtPŒ
 
sÿnCÚ‹xtPŒ
 = 
Ãw
 
	`SÿnCÚ‹xt
(
time¡amp
.
logiÿl
+1, 
m_schema_±r
);

263 ià(
m_š_memÜy
) {

264 
M”geSÿÂ”
 *
msÿÂ”
 = 
Ãw
 
	`M”geSÿÂ”
(
sÿnCÚ‹xtPŒ
, 
çl£
);

265 
msÿÂ”
->
	`add_sÿÂ”
Ğ
m_ûÎ_ÿche_±r
->
	`ü—‹_sÿÂ”
(
sÿnCÚ‹xtPŒ
) );

266 
sÿÂ”PŒ
 = 
msÿÂ”
;

268 ià(
majÜ
 || 
bËIndex
 < 
m_¡Ües
.
	`size
()) {

269 
M”geSÿÂ”
 *
msÿÂ”
 = 
Ãw
 
	`M”geSÿÂ”
(
sÿnCÚ‹xtPŒ
, !
majÜ
);

270 
msÿÂ”
->
	`add_sÿÂ”
Ğ
m_ûÎ_ÿche_±r
->
	`ü—‹_sÿÂ”
(
sÿnCÚ‹xtPŒ
) );

271 
size_t
 
i
=
bËIndex
; i<
m_¡Ües
.
	`size
(); i++)

272 
msÿÂ”
->
	`add_sÿÂ”
Ğ
m_¡Ües
[
i
]->
	`ü—‹_sÿÂ”
(
sÿnCÚ‹xtPŒ
) );

273 
sÿÂ”PŒ
 = 
msÿÂ”
;

276 
sÿÂ”PŒ
 = 
m_ûÎ_ÿche_±r
->
	`ü—‹_sÿÂ”
(
sÿnCÚ‹xtPŒ
);

279 
sÿÂ”PŒ
->
	`g‘
(&
key
, &
v®ue
)) {

281 ià(!
keyComps
.
	`lßd
(
key
)) {

282 
	`HT_ERROR
("Problem deserializing key/value…air");

286 ià(
keyComps
.
time¡amp
 <ğtime¡amp.
logiÿl
)

287 
ûÎStÜePŒ
->
	`add
(
key
, 
v®ue
, 
time¡amp
.
»®
);

289 
sÿÂ”PŒ
->
	`fÜw¬d
();

292 ià(
ûÎStÜePŒ
->
	`fš®ize
(
time¡amp
) != 0) {

293 
	`HT_ERRORF
("ProbËm fš®izšg C–lStÜ'%s'", 
ûÎStÜeFe
.
	`c_¡r
());

301 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

302 
C–lCachePŒ
 
tmp_ûÎ_ÿche_±r
;

305 
tmp_ûÎ_ÿche_±r
 = 
m_ûÎ_ÿche_±r
;

306 
tmp_ûÎ_ÿche_±r
->
	`lock
();

307 
m_cŞlisiÚs
 +ğ
m_ûÎ_ÿche_±r
->
	`g‘_cŞlisiÚ_couÁ
();

308 ià(
m_š_memÜy
)

309 
m_ûÎ_ÿche_±r
->
	`purge_d–‘es
();

311 
m_ûÎ_ÿche_±r
 = m_ûÎ_ÿche_±r->
	`¦iû_cİy
(
time¡amp
.
logiÿl
);

313 
m_Şde¡_ÿched_time¡amp
 = (
m_ûÎ_ÿche_±r
->
	`size
(è> 0è? 
time¡amp
.
»®
 + 1 : 0;

314 
tmp_ûÎ_ÿche_±r
->
	`uÆock
();

317 ià(
bËIndex
 < 
m_¡Ües
.
	`size
())

318 
m_¡Ües
.
	`»size
(
bËIndex
);

321 
m_¡Ües
.
	`push_back
(
ûÎStÜePŒ
);

323 
	`g‘_fes
(
fes
);

326 
m_disk_u§ge
 = 0;

327 
m_com´essiÚ_¿tio
 = 0.0;

328 
size_t
 
i
=0; i<
m_¡Ües
.
	`size
(); i++) {

329 
m_disk_u§ge
 +ğ
m_¡Ües
[
i
]->
	`disk_u§ge
();

330 
m_com´essiÚ_¿tio
 +ğ
m_¡Ües
[
i
]->
	`com´essiÚ_¿tio
();

332 
m_com´essiÚ_¿tio
 /ğ
m_¡Ües
.
	`size
();

334 
m_com·ùiÚ_time¡amp
 = 
time¡amp
;

338 
Œy
 {

339 ià(
m_is_roÙ
) {

340 
M‘ad©aRoÙ
 
	`m‘ad©a
(
m_schema_±r
);

341 
m‘ad©a
.
	`wr™e_fes
(
m_Çme
, 
fes
);

344 
M‘ad©aNÜm®
 
	`m‘ad©a
(
m_bË_id’tif›r
, 
m_’d_row
);

345 
m‘ad©a
.
	`wr™e_fes
(
m_Çme
, 
fes
);

348 
	`ÿtch
 (
Hy³¹abË
::
Exû±iÚ
 &
e
) {

350 
	`HT_ERRORF
("Problem updating 'File' column of METADATA (%d:%s) - %s",

351 
m_bË_id’tif›r
.
id
, 
m‘ad©a_key_¡r
.
	`c_¡r
(), 
E¼Ü
::
	`g‘_‹xt
(
e
.
	`code
()));

354 
	`HT_INFOF
("Fšished Com·ùiÚ (%s.%s)", 
m_bË_Çme
.
	`c_¡r
(), 
m_Çme
.c_str());

355 
	}
}

361 
	gAcûssGroup
::
shršk
(
¡d
::
¡ršg
 &
Ãw_¡¬t_row
) {

362 
boo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

363 
	g”rÜ
;

364 
C–lCachePŒ
 
	gŞd_ûÎ_ÿche_±r
 = 
m_ûÎ_ÿche_±r
;

365 
C–lCachePŒ
 
	gÃw_ûÎ_ÿche_±r
;

366 
SÿnCÚ‹xtPŒ
 
	gsÿnCÚ‹xtPŒ
 = 
Ãw
 
SÿnCÚ‹xt
(SÿnCÚ‹xt::
END_OF_TIME
, 
m_schema_±r
);

367 
C–lLi¡SÿÂ”PŒ
 
	gûÎ_ÿche_sÿÂ”_±r
;

368 
By‹SŒšg32T
 *
	gkey
;

369 
By‹SŒšg32T
 *
	gv®ue
;

370 
	g¡d
::
veùÜ
<
C–lStÜePŒ
> 
Ãw_¡Ües
;

371 
C–lStÜe
 *
	gÃw_ûÎ_¡Üe
;

373 
	gm_¡¬t_row
 = 
Ãw_¡¬t_row
;

375 
	gÃw_ûÎ_ÿche_±r
 = 
Ãw
 
C–lCache
();

376 
	gÃw_ûÎ_ÿche_±r
->
lock
();

378 
	gm_ûÎ_ÿche_±r
 = 
Ãw_ûÎ_ÿche_±r
;

380 
	gûÎ_ÿche_sÿÂ”_±r
 = 
Şd_ûÎ_ÿche_±r
->
ü—‹_sÿÂ”
(
sÿnCÚ‹xtPŒ
);

385 
	gûÎ_ÿche_sÿÂ”_±r
->
g‘
(&
key
, &
v®ue
)) {

386 ià(
¡rcmp
((cÚ¡ *)
key
->
d©a
, 
m_¡¬t_row
.
c_¡r
()) > 0)

387 
add
(
key
, 
v®ue
, 0);

388 
	gûÎ_ÿche_sÿÂ”_±r
->
fÜw¬d
();

391 
	gÃw_ûÎ_ÿche_±r
->
uÆock
();

396 
size_t
 
	gi
=0; i<
	gm_¡Ües
.
size
(); i++) {

397 
	g¡d
::
¡ršg
 
f’ame
 = 
m_¡Ües
[
i
]->
g‘_f’ame
();

398 
	gÃw_ûÎ_¡Üe
 = 
Ãw
 
C–lStÜeV0
(
Glob®
::
dfs
);

399 ià((
	g”rÜ
 = 
Ãw_ûÎ_¡Üe
->
İ’
(
f’ame
.
c_¡r
(), 
m_¡¬t_row
.c_¡r(), 
m_’d_row
.c_¡r())è!ğ
E¼Ü
::
OK
) {

400 
HT_ERRORF
("Problem opening cell store '%s' [%s:%s] - %s",

401 
f’ame
.
c_¡r
(), 
m_¡¬t_row
.c_¡r(), 
m_’d_row
.c_¡r(), 
E¼Ü
::
g‘_‹xt
(
”rÜ
));

402  
	g”rÜ
;

404 ià((
	g”rÜ
 = 
Ãw_ûÎ_¡Üe
->
lßd_šdex
()è!ğ
E¼Ü
::
OK
) {

405 
HT_ERRORF
("Problem†oading index of cell store '%s' [%s:%s] - %s",

406 
f’ame
.
c_¡r
(), 
m_¡¬t_row
.c_¡r(), 
m_’d_row
.c_¡r(), 
E¼Ü
::
g‘_‹xt
(
”rÜ
));

407  
	g”rÜ
;

409 
	gÃw_¡Ües
.
push_back
(
Ãw_ûÎ_¡Üe
);

412 
	gm_¡Ües
 = 
Ãw_¡Ües
;

414  
	gE¼Ü
::
OK
;

422 
	gAcûssGroup
::
g‘_fes
(
¡d
::
¡ršg
 &
‹xt
) {

423 
‹xt
 = "";

424 
size_t
 
	gi
=0; i<
	gm_¡Ües
.
size
(); i++)

425 
	g‹xt
 +ğ
m_¡Ües
[
i
]->
g‘_f’ame
() + ";\n";

432 
	gAcûssGroup
::
	$g‘_com·ùiÚ_time¡amp
(
Time¡amp
 &
time¡amp
) {

433 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

434 
time¡amp
 = 
m_com·ùiÚ_time¡amp
;

435 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/AccessGroup.h

20 #iâdeà
HYPERTABLE_ACCESSGROUP_H


21 
	#HYPERTABLE_ACCESSGROUP_H


	)

23 
	~<queue
>

24 
	~<¡ršg
>

25 
	~<veùÜ
>

27 
	~"Hy³¹abË/Lib/Schema.h
"

28 
	~"Hy³¹abË/Lib/Ty³s.h
"

30 
	~"C–lCache.h
"

31 
	~"C–lStÜe.h
"

32 
	~"RªgeInfo.h
"

33 
	~"Time¡amp.h
"

35 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

37 
Çme¥aû
 
	gHy³¹abË
 {

39 şas 
	cAcûssGroup
 : 
C–lLi¡
 {

41 
public
:

44 
AcûssGroup
 *
ag
;

45 
ušt64_t
 
	gŞde¡_ÿched_time¡amp
;

46 
ušt64_t
 
	gmem_u£d
;

47 
ušt64_t
 
	gdisk_u£d
;

48 
ušt32_t
 
	gd–‘es
;

49 
boŞ
 
	gš_memÜy
;

50 *
	gu£r_d©a
;

51 } 
	tCom·ùiÚPriÜ™yD©aT
;

53 
AcûssGroup
(
TabËId’tif›rT
 &
bË_id’tif›r
, 
SchemaPŒ
 &
schemaPŒ
, 
Schema
::AcûssGrou°*
ag
, 
RªgeT
 *
¿nge
);

54 
	gvœtu®
 ~
AcûssGroup
();

55 
vœtu®
 
add
(cÚ¡ 
By‹SŒšg32T
 *
key
, cÚ¡ By‹SŒšg32T *
v®ue
, 
ušt64_t
 
»®_time¡amp
);

57 
vœtu®
 cÚ¡ *
g‘_¥l™_row
();

58 
vœtu®
 
g‘_¥l™_rows
(
¡d
::
veùÜ
<¡d::
¡ršg
> &
¥l™_rows
, 
boŞ
 
šşude_ÿche
);

59 
vœtu®
 
g‘_ÿched_rows
(
¡d
::
veùÜ
<¡d::
¡ršg
> &
rows
);

61 
lock
(è{ 
	gboo¡
::
d‘a
::
th»ad
::
lock_İs
<
boo¡
::
mu‹x
>::lock(
m_mu‹x
); 
	gm_ûÎ_ÿche_±r
->lock(); }

62 
uÆock
(è{ 
	gm_ûÎ_ÿche_±r
->uÆock(); 
	gboo¡
::
d‘a
::
th»ad
::
lock_İs
<
boo¡
::
mu‹x
>::uÆock(
m_mu‹x
); }

64 
C–lLi¡SÿÂ”
 *
ü—‹_sÿÂ”
(
SÿnCÚ‹xtPŒ
 &
sÿnCÚ‹xtPŒ
);

66 
boŞ
 
šşude_š_sÿn
(
SÿnCÚ‹xtPŒ
 &
sÿnCÚ‹xtPŒ
);

67 
ušt64_t
 
disk_u§ge
();

68 
add_ûÎ_¡Üe
(
C–lStÜePŒ
 &
ûÎ¡Üe_±r
, 
ušt32_t
 
id
);

69 
run_com·ùiÚ
(
Time¡amp
 
time¡amp
, 
boŞ
 
majÜ
);

71 
g‘_com·ùiÚ_time¡amp
(
Time¡amp
 &
time¡amp
);

72 
ušt64_t
 
g‘_Şde¡_ÿched_time¡amp
() {

73 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

74  
	gm_Şde¡_ÿched_time¡amp
;

77 
g‘_com·ùiÚ_´iÜ™y_d©a
(
Com·ùiÚPriÜ™yD©aT
 &
´iÜ™y_d©a
);

79 
£t_com·ùiÚ_b™
(è{ 
	gm_Ãeds_com·ùiÚ
 = 
Œue
; }

81 
boŞ
 
Ãeds_com·ùiÚ
(è{  
	gm_Ãeds_com·ùiÚ
; }

83 cÚ¡ *
g‘_Çme
(è{  
	gm_Çme
.
c_¡r
(); }

85 
shršk
(
¡d
::
¡ršg
 &
Ãw_¡¬t_row
);

87 
g‘_fes
(
¡d
::
¡ršg
 &
‹xt
);

89 
ušt64_t
 
g‘_cŞlisiÚ_couÁ
() {

90 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

91  
	gm_cŞlisiÚs
 + 
	gm_ûÎ_ÿche_±r
->
g‘_cŞlisiÚ_couÁ
();

94 
ušt64_t
 
g‘_ÿched_couÁ
() {

95 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

96  
	gm_ûÎ_ÿche_±r
->
size
();

99 
drİ
(è{ 
	gm_drİ
 = 
Œue
; }

101 
	g´iv©e
:

102 
boo¡
::
mu‹x
 
m_mu‹x
;

103 
TabËId’tif›rT
 
	gm_bË_id’tif›r
;

104 
SchemaPŒ
 
	gm_schema_±r
;

105 
	g¡d
::
£t
<
ušt8_t
> 
m_cŞumn_çm›s
;

106 
	g¡d
::
¡ršg
 
m_Çme
;

107 
	g¡d
::
¡ršg
 
m_bË_Çme
;

108 
	g¡d
::
¡ršg
 
m_¡¬t_row
;

109 
	g¡d
::
¡ršg
 
m_’d_row
;

110 
	g¡d
::
veùÜ
<
C–lStÜePŒ
> 
m_¡Ües
;

111 
C–lCachePŒ
 
	gm_ûÎ_ÿche_±r
;

112 
ušt32_t
 
	gm_Ãxt_bË_id
;

113 
ušt64_t
 
	gm_disk_u§ge
;

114 
ušt32_t
 
	gm_blocksize
;

115 
	gm_com´essiÚ_¿tio
;

116 
	g¡d
::
¡ršg
 
m_com´essÜ
;

117 
boŞ
 
	gm_is_roÙ
;

118 
Time¡amp
 
	gm_com·ùiÚ_time¡amp
;

119 
ušt64_t
 
	gm_Şde¡_ÿched_time¡amp
;

120 
ušt64_t
 
	gm_cŞlisiÚs
;

121 
boŞ
 
	gm_Ãeds_com·ùiÚ
;

122 
boŞ
 
	gm_š_memÜy
;

123 
boŞ
 
	gm_drİ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/BlockCompressionHeaderCellStore.cc

21 
	~"CommÚ/E¼Ü.h
"

23 
	~"AsyncComm/S”Ÿliz©iÚ.h
"

25 
	~"BlockCom´essiÚH—d”C–lStÜe.h
"

27 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

29 
	gBlockCom´essiÚH—d”C–lStÜe
::
	$BlockCom´essiÚH—d”C–lStÜe
() {

30 
m_Ëngth
 = 0;

31 
m_zËngth
 = 0;

32 
m_ty³
 = 0;

33 
m_checksum
 = 0;

34 
	`mem£t
(
m_magic
, 0, 10);

35 
	}
}

40 
	gBlockCom´essiÚH—d”C–lStÜe
::
	$’code
(
ušt8_t
 **
buf_±r
) {

41 
	`memıy
(*
buf_±r
, 
m_magic
, 10);

42 (*
buf_±r
) += 10;

43 
S”Ÿliz©iÚ
::
	`’code_shÜt
(
buf_±r
, 
	`’coded_Ëngth
());

44 
S”Ÿliz©iÚ
::
	`’code_št
(
buf_±r
, 
m_Ëngth
);

45 
S”Ÿliz©iÚ
::
	`’code_št
(
buf_±r
, 
m_zËngth
);

46 
S”Ÿliz©iÚ
::
	`’code_shÜt
(
buf_±r
, 
m_ty³
);

47 
S”Ÿliz©iÚ
::
	`’code_št
(
buf_±r
, 
m_checksum
);

48 
	}
}

54 
	gBlockCom´essiÚH—d”C–lStÜe
::
	$decode_fixed
(
ušt8_t
 **
buf_±r
, 
size_t
 *
»maššg_±r
) {

55 
ušt16_t
 
h—d”_Ën
;

57 ià(*
»maššg_±r
 < 
	`’coded_Ëngth
())

58  
E¼Ü
::
BLOCK_COMPRESSOR_TRUNCATED
;

60 
	`memıy
(
m_magic
, *
buf_±r
, 10);

61 (*
buf_±r
) += 10;

62 *
»maššg_±r
 -= 10;

64 
S”Ÿliz©iÚ
::
	`decode_shÜt
(
buf_±r
, 
»maššg_±r
, &
h—d”_Ën
);

65 
S”Ÿliz©iÚ
::
	`decode_št
(
buf_±r
, 
»maššg_±r
, &
m_Ëngth
);

66 
S”Ÿliz©iÚ
::
	`decode_št
(
buf_±r
, 
»maššg_±r
, &
m_zËngth
);

67 
S”Ÿliz©iÚ
::
	`decode_shÜt
(
buf_±r
, 
»maššg_±r
, &
m_ty³
);

68 
S”Ÿliz©iÚ
::
	`decode_št
(
buf_±r
, 
»maššg_±r
, &
m_checksum
);

70  
E¼Ü
::
OK
;

71 
	}
}

77 
	gBlockCom´essiÚH—d”C–lStÜe
::
	$decode_v¬ŸbË
(
ušt8_t
 **
buf_±r
, 
size_t
 *
»maššg_±r
) {

78  
E¼Ü
::
OK
;

79 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/BlockCompressionHeaderCellStore.h

21 #iâdeà
HYPERTABLE_BLOCKCOMPRESSIONHEADERCELLSTORE_H


22 
	#HYPERTABLE_BLOCKCOMPRESSIONHEADERCELLSTORE_H


	)

24 
	~"Hy³¹abË/Lib/BlockCom´essiÚH—d”.h
"

26 
Çme¥aû
 
	gHy³¹abË
 {

31 şas 
	cBlockCom´essiÚH—d”C–lStÜe
 : 
public
 
BlockCom´essiÚH—d”
 {

32 
public
:

33 
BlockCom´essiÚH—d”C–lStÜe
();

34 
BlockCom´essiÚH—d”C–lStÜe
(cÚ¡ 
magic
[10]è{ 
£t_magic
(magic); }

36 
vœtu®
 
size_t
 
fixed_Ëngth
() {  26; }

37 
vœtu®
 
size_t
 
’coded_Ëngth
() {  26; }

38 
vœtu®
 
’code
(
ušt8_t
 **
buf_±r
);

39 
vœtu®
 
decode_fixed
(
ušt8_t
 **
buf_±r
, 
size_t
 *
»maššg_±r
);

40 
vœtu®
 
decode_v¬ŸbË
(
ušt8_t
 **
buf_±r
, 
size_t
 *
»maššg_±r
);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/CellCache.cc

21 
	~<ÿs£¹
>

22 
	~<io¡»am
>

24 
	~"CommÚ/Logg”.h
"

26 
	~"Hy³¹abË/Lib/Key.h
"

28 
	~"C–lCache.h
"

29 
	~"C–lCacheSÿÂ”.h
"

30 
	~"Glob®.h
"

32 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

33 
usšg
 
Çme¥aû
 
	g¡d
;

36 cÚ¡ 
ušt32_t
 
	gC–lCache
::
ALLOC_BIT_MASK
 = 0x80000000;

37 cÚ¡ 
ušt32_t
 
	gC–lCache
::
OFFSET_BIT_MASK
 = 0x7FFFFFFF;

43 
	gC–lCache
::~
	$C–lCache
() {

44 
ušt64_t
 
mem_ä“d
 = 0;

45 
ušt32_t
 
off£t
;

46 #ifdeà
STAT


47 
ušt32_t
 
sk³d
 = 0;

58 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_»fcouÁ_mu‹x
);

59 
m_»fcouÁ
 > 0)

60 
m_»fcouÁ_cÚd
.
	`wa™
(
lock
);

63 
C–lM­T
::
™”©Ü
 
™”
 = 
m_ûÎ_m­
.
	`begš
(); i‹¸!ğm_ûÎ_m­.
	`’d
(); iter++) {

64 ià(((*
™”
).
£cÚd
 & 
ALLOC_BIT_MASK
) == 0) {

65 
off£t
 = (*
™”
).
£cÚd
 & 
OFFSET_BIT_MASK
;

66 
mem_ä“d
 +ğ
off£t
 + 
	`L’gth
((
By‹SŒšg32T
 *)(((
ušt8_t
 *)(*
™”
).
fœ¡
) + offset));

67 
d–‘e
 [] (*
™”
).
fœ¡
;

69 #ifdeà
STAT


71 
sk³d
++;

75 #ifdeà
STAT


76 
cout
 << 
æush
;

77 
cout
 << "STAT[~C–lCache]\tmemÜy f»ed\t" << 
mem_ä“d
 << 
’dl
;

78 
cout
 << "STAT[~C–lCache]\‹Ár› sk³d\t" << 
sk³d
 << 
’dl
;

79 
cout
 << "STAT[~C–lCache]\‹Ár› tÙ®\t" << 
m_ûÎ_m­
.
	`size
(è<< 
’dl
;

82 
Glob®
::
memÜy_Œack”
.
	`»move_memÜy
(
mem_ä“d
);

83 
Glob®
::
memÜy_Œack”
.
	`»move_™ems
(
m_ûÎ_m­
.
	`size
());

85 ià(
m_chd
)

86 
m_chd
->
	`deüem’t_»fcouÁ
();

87 
	}
}

93 
	gC–lCache
::
	$add
(cÚ¡ 
By‹SŒšg32T
 *
key
, cÚ¡ By‹SŒšg32T *
v®ue
, 
ušt64_t
 
»®_time¡amp
) {

94 
size_t
 
kv_Ën
 = 
key
->
Ën
 + (2*(
št32_t
));

95 
By‹SŒšg32T
 *
ÃwKey
;

96 
By‹SŒšg32T
 *
ÃwV®ue
;

98 ()
»®_time¡amp
;

100 ià(
v®ue
) {

101 
kv_Ën
 +ğ
v®ue
->
Ën
;

102 
ÃwKey
 = (
By‹SŒšg32T
 *)
Ãw
 
ušt8_t
 [ 
kv_Ën
 ];

103 
ÃwV®ue
 = (
By‹SŒšg32T
 *)(
ÃwKey
->
d©a
 + 
key
->
Ën
);

104 
	`memıy
(
ÃwKey
, 
key
, (
št32_t
è+ key->
Ën
);

105 
	`memıy
(
ÃwV®ue
, 
v®ue
, (
št32_t
è+ v®ue->
Ën
);

108 
ÃwKey
 = (
By‹SŒšg32T
 *)
Ãw
 
ušt8_t
 [ 
kv_Ën
 ];

109 
ÃwV®ue
 = (
By‹SŒšg32T
 *)(
ÃwKey
->
d©a
 + 
key
->
Ën
);

110 
	`memıy
(
ÃwKey
, 
key
, (
št32_t
è+ key->
Ën
);

111 
ÃwV®ue
->
Ën
 = 0;

114 iàĞ! 
m_ûÎ_m­
.
	`š£¹
(
C–lM­T
::
	`v®ue_ty³
(
ÃwKey
, 
	`L’gth
ÒewKey))).
£cÚd
 ) {

115 
m_cŞlisiÚs
++;

116 
	`HT_WARNF
("CŞlisiÚ d‘eùed key in£¹ (row = %s)", (cÚ¡ *)
ÃwKey
->
d©a
);

117 
d–‘e
 [] 
ÃwKey
;

120 
m_memÜy_u£d
 +ğ
kv_Ën
;

121 iàĞ
key
->
d©a
[ key->
Ën
 - 9] <ğ
FLAG_DELETE_CELL
 )

122 
m_d–‘es
++;

126 
	}
}

130 cÚ¡ *
	gC–lCache
::
	$g‘_¥l™_row
() {

131 
	`as£¹
(!"CellCache::get_split_row‚ot implemented!");

133 
	}
}

137 
	gC–lCache
::
g‘_¥l™_rows
(
¡d
::
veùÜ
<¡d::
¡ršg
> &
¥l™_rows
) {

138 
boo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

139 ià(
	gm_ûÎ_m­
.
size
() > 2) {

140 
	gC–lM­T
::
cÚ¡_™”©Ü
 
™”
 = 
m_ûÎ_m­
.
begš
();

141 
size_t
 
	gi
=0, 
	gmid
 = 
m_ûÎ_m­
.
size
() / 2;

142 
	gi
=0; i<
	gmid
; i++)

143 
	g™”
++;

144 
	g¥l™_rows
.
push_back
((cÚ¡ *)(*
™”
).
fœ¡
->
d©a
);

150 
	gC–lCache
::
g‘_rows
(
¡d
::
veùÜ
<¡d::
¡ršg
> &
rows
) {

151 
boo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

152 cÚ¡ *
	gÏ¡_row
 = "";

153 
	gC–lM­T
::
cÚ¡_™”©Ü
 
™”
 = 
m_ûÎ_m­
.
begš
(); 
	g™”
 !ğm_ûÎ_m­.
’d
(); iter++) {

154 ià(
¡rcmp
((cÚ¡ *)(*
™”
).
fœ¡
->
d©a
, 
Ï¡_row
)) {

155 
	grows
.
push_back
((cÚ¡ *)(*
™”
).
fœ¡
->
d©a
);

156 
	gÏ¡_row
 = (cÚ¡ *)(*
™”
).
fœ¡
->
d©a
;

163 
C–lLi¡SÿÂ”
 *
	gC–lCache
::
	$ü—‹_sÿÂ”
(
SÿnCÚ‹xtPŒ
 &
sÿnCÚ‹xtPŒ
) {

164 
C–lCachePŒ
 
	`ûÎCachePŒ
(
this
);

165  
Ãw
 
	`C–lCacheSÿÂ”
(
ûÎCachePŒ
, 
sÿnCÚ‹xtPŒ
);

166 
	}
}

173 
C–lCache
 *
	gC–lCache
::
	$¦iû_cİy
(
ušt64_t
 
time¡amp
) {

174 
Key
 
keyComps
;

175 #ifdeà
STAT


176 
ušt64_t
 
drİ³d
 = 0;

179 
m_chd
 = 
Ãw
 
	`C–lCache
();

181 
C–lM­T
::
™”©Ü
 
™”
 = 
m_ûÎ_m­
.
	`begš
(); i‹¸!ğm_ûÎ_m­.
	`’d
(); iter++) {

183 ià(!
keyComps
.
	`lßd
((*
™”
).
fœ¡
)) {

184 
	`HT_ERROR
("Problem deserializing key/value…air");

188 ià(
keyComps
.
time¡amp
 >imestamp) {

189 
m_chd
->
m_ûÎ_m­
.
	`š£¹
(
C–lM­T
::
	`v®ue_ty³
((*
™”
).
fœ¡
, (*™”).
£cÚd
));

190 (*
™”
).
£cÚd
 |ğ
ALLOC_BIT_MASK
;

192 #ifdeà
STAT


194 
drİ³d
++;

198 #ifdeà
STAT


199 
cout
 << 
æush
;

200 
cout
 << "STAT[¦iû_cİy]\tdrİ³d\t" << 
drİ³d
 << 
’dl
;

203 
Glob®
::
memÜy_Œack”
.
	`add_™ems
(
m_chd
->
m_ûÎ_m­
.
	`size
());

205 
m_chd
->
	`šüem’t_»fcouÁ
();

207  
m_chd
;

208 
	}
}

214 
	gC–lCache
::
	$purge_d–‘es
() {

215 
Key
 
key_comps
;

216 
size_t
 
Ën
;

217 
boŞ
 
d–‘e_´e£Á
 = 
çl£
;

218 
DyÇmicBufãr
 
	`d–‘ed_row
(0);

219 
ušt64_t
 
d–‘ed_row_time¡amp
 = 0;

220 
DyÇmicBufãr
 
	`d–‘ed_cŞumn_çmy
(0);

221 
ušt64_t
 
d–‘ed_cŞumn_çmy_time¡amp
 = 0;

222 
DyÇmicBufãr
 
	`d–‘ed_ûÎ
(0);

223 
ušt64_t
 
d–‘ed_ûÎ_time¡amp
 = 0;

224 
C–lM­T
::
™”©Ü
 
™”
, 
tmp_™”
;

226 
™”
 = 
m_ûÎ_m­
.
	`begš
();

228 
™”
 !ğ
m_ûÎ_m­
.
	`’d
()) {

230 ià(!
key_comps
.
	`lßd
((*
™”
).
fœ¡
)) {

231 
	`HT_ERROR
("Problem deserializing key/value…air");

232 
™”
++;

236 ià(
key_comps
.
æag
 =ğ
FLAG_INSERT
) {

238 ià(
d–‘e_´e£Á
) {

239 ià(
d–‘ed_ûÎ
.
	`fl
() > 0) {

240 
Ën
 = (
key_comps
.
cŞumn_qu®if›r
 - key_comps.
row
è+ 
	`¡¾’
(key_comps.column_qualifier) + 1;

241 ià(
d–‘ed_ûÎ
.
	`fl
(è=ğ
Ën
 && !
	`memcmp
(d–‘ed_ûÎ.
buf
, 
key_comps
.
row
,†en)) {

242 ià(
key_comps
.
time¡amp
 < 
d–‘ed_ûÎ_time¡amp
) {

243 
tmp_™”
 = 
™”
;

244 
™”
++;

245 
m_ûÎ_m­
.
	`”a£
(
tmp_™”
);

248 
™”
++;

251 
d–‘ed_ûÎ
.
	`ş—r
();

253 ià(
d–‘ed_cŞumn_çmy
.
	`fl
() > 0) {

254 
Ën
 = 
key_comps
.
cŞumn_qu®if›r
 - key_comps.
row
;

255 ià(
d–‘ed_cŞumn_çmy
.
	`fl
(è=ğ
Ën
 && !
	`memcmp
(d–‘ed_cŞumn_çmy.
buf
, 
key_comps
.
row
,†en)) {

256 ià(
key_comps
.
time¡amp
 < 
d–‘ed_cŞumn_çmy_time¡amp
) {

257 
tmp_™”
 = 
™”
;

258 
™”
++;

259 
m_ûÎ_m­
.
	`”a£
(
tmp_™”
);

262 
™”
++;

265 
d–‘ed_cŞumn_çmy
.
	`ş—r
();

267 ià(
d–‘ed_row
.
	`fl
() > 0) {

268 
Ën
 = 
	`¡¾’
(
key_comps
.
row
) + 1;

269 ià(
d–‘ed_row
.
	`fl
(è=ğ
Ën
 && !
	`memcmp
(d–‘ed_row.
buf
, 
key_comps
.
row
,†en)) {

270 ià(
key_comps
.
time¡amp
 < 
d–‘ed_row_time¡amp
) {

271 
tmp_™”
 = 
™”
;

272 
™”
++;

273 
m_ûÎ_m­
.
	`”a£
(
tmp_™”
);

276 
™”
++;

279 
d–‘ed_row
.
	`ş—r
();

281 
d–‘e_´e£Á
 = 
çl£
;

283 
™”
++;

286 ià(
key_comps
.
æag
 =ğ
FLAG_DELETE_ROW
) {

287 
Ën
 = 
	`¡¾’
(
key_comps
.
row
) + 1;

288 ià(
d–‘e_´e£Á
 && 
d–‘ed_row
.
	`fl
(è=ğ
Ën
 && !
	`memcmp
(d–‘ed_row.
buf
, 
key_comps
.
row
,†en)) {

289 ià(
d–‘ed_row_time¡amp
 < 
key_comps
.
time¡amp
)

290 
d–‘ed_row_time¡amp
 = 
key_comps
.
time¡amp
;

293 
d–‘ed_row
.
	`£t
(
key_comps
.
row
, 
Ën
);

294 
d–‘ed_row_time¡amp
 = 
key_comps
.
time¡amp
;

295 
d–‘e_´e£Á
 = 
Œue
;

298 ià(
key_comps
.
æag
 =ğ
FLAG_DELETE_COLUMN_FAMILY
) {

299 
Ën
 = 
key_comps
.
cŞumn_qu®if›r
 - key_comps.
row
;

300 ià(
d–‘e_´e£Á
 && 
d–‘ed_cŞumn_çmy
.
	`fl
(è=ğ
Ën
 && !
	`memcmp
(d–‘ed_cŞumn_çmy.
buf
, 
key_comps
.
row
,†en)) {

301 ià(
d–‘ed_cŞumn_çmy_time¡amp
 < 
key_comps
.
time¡amp
)

302 
d–‘ed_cŞumn_çmy_time¡amp
 = 
key_comps
.
time¡amp
;

305 
d–‘ed_cŞumn_çmy
.
	`£t
(
key_comps
.
row
, 
Ën
);

306 
d–‘ed_cŞumn_çmy_time¡amp
 = 
key_comps
.
time¡amp
;

307 
d–‘e_´e£Á
 = 
Œue
;

310 ià(
key_comps
.
æag
 =ğ
FLAG_DELETE_CELL
) {

311 
Ën
 = (
key_comps
.
cŞumn_qu®if›r
 - key_comps.
row
è+ 
	`¡¾’
(key_comps.column_qualifier) + 1;

312 ià(
d–‘e_´e£Á
 && 
d–‘ed_ûÎ
.
	`fl
(è=ğ
Ën
 && !
	`memcmp
(d–‘ed_ûÎ.
buf
, 
key_comps
.
row
,†en)) {

313 ià(
d–‘ed_ûÎ_time¡amp
 < 
key_comps
.
time¡amp
)

314 
d–‘ed_ûÎ_time¡amp
 = 
key_comps
.
time¡amp
;

317 
d–‘ed_ûÎ
.
	`£t
(
key_comps
.
row
, 
Ën
);

318 
d–‘ed_ûÎ_time¡amp
 = 
key_comps
.
time¡amp
;

319 
d–‘e_´e£Á
 = 
Œue
;

322 
tmp_™”
 = 
™”
;

323 
™”
++;

324 
m_ûÎ_m­
.
	`”a£
(
tmp_™”
);

328 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/CellCache.h

20 #iâdeà
HYPERTABLE_CELLCACHE_H


21 
	#HYPERTABLE_CELLCACHE_H


	)

23 
	~<m­
>

25 
	~<boo¡/th»ad/cÚd™iÚ.hµ
>

26 
	~<boo¡/th»ad/mu‹x.hµ
>

27 
	~<boo¡/šŒusive_±r.hµ
>

29 
	~"C–lLi¡SÿÂ”.h
"

30 
	~"C–lLi¡.h
"

32 
Çme¥aû
 
	gHy³¹abË
 {

39 şas 
	cC–lCache
 : 
public
 
C–lLi¡
 {

41 
public
:

42 
C–lCache
(è: 
C–lLi¡
(), 
m_»fcouÁ
(0), 
m_chd
(0), 
m_memÜy_u£d
(0), 
m_d–‘es
(0), 
m_cŞlisiÚs
(0) { ; }

43 
	gvœtu®
 ~
C–lCache
();

55 
vœtu®
 
add
(cÚ¡ 
By‹SŒšg32T
 *
key
, cÚ¡ By‹SŒšg32T *
v®ue
, 
ušt64_t
 
»®_time¡amp
);

57 
vœtu®
 cÚ¡ *
g‘_¥l™_row
();

59 
vœtu®
 
g‘_¥l™_rows
(
¡d
::
veùÜ
<¡d::
¡ršg
> &
¥l™_rows
);

61 
vœtu®
 
g‘_rows
(
¡d
::
veùÜ
<¡d::
¡ršg
> &
rows
);

67 
vœtu®
 
C–lLi¡SÿÂ”
 *
ü—‹_sÿÂ”
(
SÿnCÚ‹xtPŒ
 &
sÿnCÚ‹xtPŒ
);

69 
lock
(è{ 
	gboo¡
::
d‘a
::
th»ad
::
lock_İs
<
boo¡
::
mu‹x
>::lock(
m_mu‹x
); }

70 
uÆock
(è{ 
	gboo¡
::
d‘a
::
th»ad
::
lock_İs
<
boo¡
::
mu‹x
>::uÆock(
m_mu‹x
); }

72 
size_t
 
size
(è{  
	gm_ûÎ_m­
.size(); }

83 
C–lCache
 *
¦iû_cİy
(
ušt64_t
 
time¡amp
);

88 
purge_d–‘es
();

94 
ušt64_t
 
memÜy_u£d
() {

95 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

97  
	gm_memÜy_u£d
 + (
	gm_ûÎ_m­
.
size
(è* (
	gC–lM­T
::
v®ue_ty³
));

100 
ušt32_t
 
g‘_cŞlisiÚ_couÁ
(è{  
	gm_cŞlisiÚs
; }

102 
ušt32_t
 
g‘_d–‘e_couÁ
(è{  
	gm_d–‘es
; }

104 
ä›nd
 
şass
 
	gC–lCacheSÿÂ”
;

106 
	g´Ùeùed
:

107 
¡d
::
	tm­
<cÚ¡ 
	tBy‹SŒšg32T
 *, 
	tušt32_t
, 
	tÉBy‹SŒšg32
> 
	tC–lM­T
;

109 cÚ¡ 
ušt32_t
 
	gALLOC_BIT_MASK
;

110 cÚ¡ 
ušt32_t
 
	gOFFSET_BIT_MASK
;

112 
šüem’t_»fcouÁ
() {

113 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_»fcouÁ_mu‹x
);

114 
	gm_»fcouÁ
++;

117 
deüem’t_»fcouÁ
() {

118 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_»fcouÁ_mu‹x
);

119 
	gm_»fcouÁ
--;

120 
	gm_»fcouÁ_cÚd
.
nÙify_®l
();

123 
	gboo¡
::
mu‹x
 
m_mu‹x
;

124 
	gboo¡
::
mu‹x
 
m_»fcouÁ_mu‹x
;

125 
	gboo¡
::
cÚd™iÚ
 
m_»fcouÁ_cÚd
;

126 
ušt32_t
 
	gm_»fcouÁ
;

127 
C–lCache
 *
	gm_chd
;

128 
C–lM­T
 
	gm_ûÎ_m­
;

129 
ušt64_t
 
	gm_memÜy_u£d
;

130 
ušt32_t
 
	gm_d–‘es
;

131 
ušt32_t
 
	gm_cŞlisiÚs
;

134 
	gboo¡
::
	tšŒusive_±r
<
	tC–lCache
> 
	tC–lCachePŒ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/CellCacheScanner.cc

21 
	~<ÿs£¹
>

23 
	~"CommÚ/Logg”.h
"

25 
	~"Hy³¹abË/Lib/Key.h
"

27 
	~"C–lCacheSÿÂ”.h
"

33 
	gC–lCacheSÿÂ”
::
	$C–lCacheSÿÂ”
(
C–lCachePŒ
 &
ûÎCachePŒ
, 
SÿnCÚ‹xtPŒ
 &
sÿnCÚ‹xtPŒ
è: 
	`C–lLi¡SÿÂ”
(sÿnCÚ‹xtPŒ), 
	`m_ûÎ_ÿche_±r
(ûÎCachePŒ), 
	`m_ûÎ_ÿche_mu‹x
(ûÎCachePŒ->
m_mu‹x
), 
	`m_cur_key
(0), 
	`m_cur_v®ue
(0), 
	$m_eos
(
çl£
) {

34 
By‹SŒšg32T
 *
bs
;

37 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_ûÎ_ÿche_mu‹x
);

38 
Key
 
keyComps
;

40 
	`as£¹
(
sÿnCÚ‹xtPŒ
->
¡¬t_row
 <ğsÿnCÚ‹xtPŒ->
’d_row
);

43 
bs
 = 
	`C»©e
(
sÿnCÚ‹xtPŒ
->
¡¬t_row
.
	`c_¡r
(), 
	`¡¾’
(scanContextPtr->start_row.c_str()));

44 
m_¡¬t_™”
 = 
m_ûÎ_ÿche_±r
->
m_ûÎ_m­
.
	`low”_bound
(
bs
);

45 
	`De¡roy
(
bs
);

48 
bs
 = 
	`C»©e
(
sÿnCÚ‹xtPŒ
->
’d_row
.
	`c_¡r
(), 
	`¡¾’
(scanContextPtr->end_row.c_str()));

49 
m_’d_™”
 = 
m_ûÎ_ÿche_±r
->
m_ûÎ_m­
.
	`low”_bound
(
bs
);

50 
	`De¡roy
(
bs
);

52 
m_cur_™”
 = 
m_¡¬t_™”
;

54 
m_cur_™”
 !ğ
m_’d_™”
) {

55 ià(!
keyComps
.
	`lßd
((*
m_cur_™”
).
fœ¡
)) {

56 
	`HT_ERROR
("Problem…arsing key!");

58 ià(
keyComps
.
æag
 =ğ
FLAG_DELETE_ROW
 || 
m_sÿn_cÚ‹xt_±r
->
çmyMask
[keyComps.
cŞumn_çmy_code
]) {

59 
m_cur_key
 = (*
m_cur_™”
).
fœ¡
;

60 
m_cur_v®ue
 = (
By‹SŒšg32T
 *)(((
ušt8_t
 *)(*
m_cur_™”
).
fœ¡
è+ (
C–lCache
::
OFFSET_BIT_MASK
 & (*m_cur_™”).
£cÚd
));

63 
m_cur_™”
++;

65 
m_eos
 = 
Œue
;

69 
	}
}

72 
boŞ
 
	gC–lCacheSÿÂ”
::
	$g‘
(
By‹SŒšg32T
 **
keyp
, By‹SŒšg32T **
v®u•
) {

73 ià(!
m_eos
) {

74 *
keyp
 = (
By‹SŒšg32T
 *)
m_cur_key
;

75 *
v®u•
 = (
By‹SŒšg32T
 *)
m_cur_v®ue
;

76  
Œue
;

78  
çl£
;

79 
	}
}

83 
	gC–lCacheSÿÂ”
::
	$fÜw¬d
() {

84 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_ûÎ_ÿche_mu‹x
);

85 
Key
 
keyComps
;

87 
m_cur_™”
++;

88 
m_cur_™”
 !ğ
m_’d_™”
) {

89 ià(!
keyComps
.
	`lßd
((*
m_cur_™”
).
fœ¡
)) {

90 
	`HT_ERROR
("Problem…arsing key!");

92 ià(
keyComps
.
æag
 =ğ
FLAG_DELETE_ROW
 || 
m_sÿn_cÚ‹xt_±r
->
çmyMask
[keyComps.
cŞumn_çmy_code
]) {

93 
m_cur_key
 = (*
m_cur_™”
).
fœ¡
;

94 
m_cur_v®ue
 = (
By‹SŒšg32T
 *)(((
ušt8_t
 *)(*
m_cur_™”
).
fœ¡
è+ (
C–lCache
::
OFFSET_BIT_MASK
 & (*m_cur_™”).
£cÚd
));

97 
m_cur_™”
++;

99 
m_eos
 = 
Œue
;

100 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/CellCacheScanner.h

20 #iâdeà
HYPERTABLE_CELLCACHESCANNER_H


21 
	#HYPERTABLE_CELLCACHESCANNER_H


	)

23 
	~"C–lCache.h
"

24 
	~"C–lLi¡SÿÂ”.h
"

25 
	~"SÿnCÚ‹xt.h
"

27 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

29 
Çme¥aû
 
	gHy³¹abË
 {

34 şas 
	cC–lCacheSÿÂ”
 : 
public
 
C–lLi¡SÿÂ”
 {

35 
public
:

36 
C–lCacheSÿÂ”
(
C–lCachePŒ
 &
ûÎCachePŒ
, 
SÿnCÚ‹xtPŒ
 &
sÿnCÚ‹xtPŒ
);

37 
	gvœtu®
 ~
C–lCacheSÿÂ”
() { ; }

38 
vœtu®
 
fÜw¬d
();

39 
vœtu®
 
boŞ
 
g‘
(
By‹SŒšg32T
 **
keyp
, By‹SŒšg32T **
v®u•
);

41 
	g´iv©e
:

42 
C–lCache
::
C–lM­T
::
™”©Ü
 
m_¡¬t_™”
;

43 
	gC–lCache
::
C–lM­T
::
™”©Ü
 
m_’d_™”
;

44 
	gC–lCache
::
C–lM­T
::
™”©Ü
 
m_cur_™”
;

45 
C–lCachePŒ
 
	gm_ûÎ_ÿche_±r
;

46 
	gboo¡
::
mu‹x
 &
m_ûÎ_ÿche_mu‹x
;

47 cÚ¡ 
By‹SŒšg32T
 *
	gm_cur_key
;

48 cÚ¡ 
By‹SŒšg32T
 *
	gm_cur_v®ue
;

49 
boŞ
 
	gm_eos
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/CellList.h

20 #iâdeà
HYPERTABLE_CELLLIST_H


21 
	#HYPERTABLE_CELLLIST_H


	)

23 
	~"CommÚ/©omic.h
"

24 
	~"CommÚ/By‹SŒšg.h
"

25 
	~"CommÚ/Reã»nûCouÁ.h
"

27 
	~"SÿnCÚ‹xt.h
"

29 
Çme¥aû
 
	gHy³¹abË
 {

31 
şass
 
	gC–lLi¡
;

32 
şass
 
	gC–lLi¡SÿÂ”
;

38 şas 
	cC–lLi¡
 : 
public
 
Reã»nûCouÁ
 {

39 
public
:

40 
vœtu®
 ~
C–lLi¡
() { ; }

50 
vœtu®
 
add
(cÚ¡ 
By‹SŒšg32T
 *
key
, cÚ¡ By‹SŒšg32T *
v®ue
, 
ušt64_t
 
»®_time¡amp
) = 0;

58 
vœtu®
 
C–lLi¡SÿÂ”
 *
ü—‹_sÿÂ”
(
SÿnCÚ‹xtPŒ
 &
sÿnCÚ‹xtPŒ
) {  0; }

66 
vœtu®
 cÚ¡ *
g‘_¥l™_row
() = 0;

76 
vœtu®
 cÚ¡ *
g‘_¡¬t_row
(è{  
	gm_¡¬t_row
.
c_¡r
(); }

86 
vœtu®
 cÚ¡ *
g‘_’d_row
(è{  
	gm_’d_row
.
c_¡r
(); }

88 
	g´Ùeùed
:

89 
¡d
::
¡ršg
 
m_¡¬t_row
;

90 
	g¡d
::
¡ršg
 
m_’d_row
;

92 
	gboo¡
::
	tšŒusive_±r
<
	tC–lLi¡
> 
	tC–lLi¡PŒ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/CellListScanner.h

20 #iâdeà
HYPERTABLE_CELLLISTSCANNER_H


21 
	#HYPERTABLE_CELLLISTSCANNER_H


	)

23 
	~"CommÚ/By‹SŒšg.h
"

24 
	~"CommÚ/DyÇmicBufãr.h
"

25 
	~"CommÚ/Reã»nûCouÁ.h
"

27 
	~"SÿnCÚ‹xt.h
"

29 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

31 
Çme¥aû
 
	gHy³¹abË
 {

33 şas 
	cC–lLi¡SÿÂ”
 : 
public
 
Reã»nûCouÁ
 {

34 
public
:

35 
C–lLi¡SÿÂ”
(
SÿnCÚ‹xtPŒ
 &
sÿnCÚ‹xtPŒ
è: 
m_sÿn_cÚ‹xt_±r
(scanContextPtr) { ; }

36 
	gvœtu®
 ~
C–lLi¡SÿÂ”
() { ; }

37 
vœtu®
 
fÜw¬d
() = 0;

38 
vœtu®
 
boŞ
 
g‘
(
By‹SŒšg32T
 **
keyp
, By‹SŒšg32T **
v®u•
) = 0;

40 
	g´Ùeùed
:

41 
SÿnCÚ‹xtPŒ
 
m_sÿn_cÚ‹xt_±r
;

44 
	gboo¡
::
	tšŒusive_±r
<
	tC–lLi¡SÿÂ”
> 
	tC–lLi¡SÿÂ”PŒ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/CellStore.h

20 #iâdeà
HYPERTABLE_CELLSTORE_H


21 
	#HYPERTABLE_CELLSTORE_H


	)

23 
	~<boo¡/šŒusive_±r.hµ
>

25 
	~"CommÚ/By‹SŒšg.h
"

27 
	~"C–lLi¡.h
"

28 
	~"C–lStÜeT¿”.h
"

29 
	~"Time¡amp.h
"

31 
Çme¥aû
 
	gHy³¹abË
 {

36 şas 
	cC–lStÜe
 : 
public
 
C–lLi¡
 {

37 
public
:

39 
vœtu®
 ~
C–lStÜe
() { ; }

41 
vœtu®
 
add
(cÚ¡ 
By‹SŒšg32T
 *
key
, cÚ¡ By‹SŒšg32T *
v®ue
, 
ušt64_t
 
»®_time¡amp
) = 0;

43 
vœtu®
 cÚ¡ *
g‘_¥l™_row
() = 0;

45 
vœtu®
 
C–lLi¡SÿÂ”
 *
ü—‹_sÿÂ”
(
SÿnCÚ‹xtPŒ
 &
sÿnCÚ‹xtPŒ
) {  0; }

55 
vœtu®
 
ü—‹
(cÚ¡ *
âame
, 
ušt32_t
 
blocksize
, cÚ¡ 
¡d
::
¡ršg
 &
com´essÜ
) = 0;

63 
vœtu®
 
fš®ize
(
Time¡amp
 &
time¡amp
) = 0;

75 
vœtu®
 
İ’
(cÚ¡ *
âame
, cÚ¡ *
¡¬t_row
, cÚ¡ *
’d_row
) = 0;

82 
vœtu®
 
lßd_šdex
() = 0;

91 
vœtu®
 
ušt32_t
 
g‘_blocksize
() = 0;

99 
vœtu®
 
g‘_time¡amp
(
Time¡amp
 &
time¡amp
) = 0;

107 
vœtu®
 
ušt64_t
 
disk_u§ge
() = 0;

114 
vœtu®
 
com´essiÚ_¿tio
() = 0;

121 
vœtu®
 
	g¡d
::
¡ršg
 &
g‘_f’ame
() = 0;

128 
vœtu®
 
C–lStÜeT¿”
 *
g‘_Œa”
() = 0;

132 
	gboo¡
::
	tšŒusive_±r
<
	tC–lStÜe
> 
	tC–lStÜePŒ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/CellStoreScannerV0.cc

21 
	~<ÿs£¹
>

23 
	~"CommÚ/E¼Ü.h
"

24 
	~"CommÚ/Sy¡em.h
"

26 
	~"BlockCom´essiÚH—d”C–lStÜe.h
"

27 
	~"Glob®.h
"

28 
	~"C–lStÜeSÿÂ”V0.h
"

30 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

32 
	gÇme¥aû
 {

33 cÚ¡ 
ušt32_t
 
	gMINIMUM_READAHEAD_AMOUNT
 = 65536;

39 
	gC–lStÜeSÿÂ”V0
::
	$C–lStÜeSÿÂ”V0
(
C–lStÜePŒ
 &
ûÎStÜePŒ
,

40 
SÿnCÚ‹xtPŒ
 &
sÿnCÚ‹xtPŒ
) :

41 
	`C–lLi¡SÿÂ”
(
sÿnCÚ‹xtPŒ
), 
	`m_ûÎ_¡Üe_±r
(
ûÎStÜePŒ
),

42 
	`m_ûÎ_¡Üe_v0
(
dyÇmic_ÿ¡
< 
C–lStÜeV0
*>(
m_ûÎ_¡Üe_±r
.
	`g‘
())),

43 
	`m_šdex
(
m_ûÎ_¡Üe_v0
->
m_šdex
), 
	`m_cur_key
(0), 
	`m_cur_v®ue
(0),

44 
	`m_check_fÜ_¿nge_’d
(
çl£
), 
	`m_’d_šşusive
(
Œue
),

45 
	`m_»adah—d
(
Œue
), 
	`m_fd
(-1), 
	`m_¡¬t_off£t
(0), 
	`m_’d_off£t
(0), 
	$m_»tuºed
(0) {

46 
By‹SŒšg32T
 *
key
;

47 
boŞ
 
¡¬t_šşusive
 = 
çl£
;

49 
	`as£¹
(
m_ûÎ_¡Üe_v0
);

50 
m_fe_id
 = 
m_ûÎ_¡Üe_v0
->m_file_id;

51 
m_zcodec
 = 
m_ûÎ_¡Üe_v0
->
	`ü—‹_block_com´essiÚ_codec
();

52 
	`mem£t
(&
m_block
, 0, (m_block));

56 
m_¡¬t_row
 = 
m_ûÎ_¡Üe_v0
->
	`g‘_¡¬t_row
();

57 ià(
m_¡¬t_row
 < 
sÿnCÚ‹xtPŒ
->
¡¬t_row
) {

58 
¡¬t_šşusive
 = 
Œue
;

59 
m_¡¬t_row
 = 
sÿnCÚ‹xtPŒ
->
¡¬t_row
;

63 
m_’d_row
 = 
m_ûÎ_¡Üe_v0
->
	`g‘_’d_row
();

64 ià(
sÿnCÚ‹xtPŒ
->
’d_row
 < 
m_’d_row
) {

65 
m_’d_šşusive
 = 
çl£
;

66 
m_’d_row
 = 
sÿnCÚ‹xtPŒ
->
’d_row
;

69 
key
 = 
	`C»©e
(
m_¡¬t_row
.
	`c_¡r
(), 
	`¡¾’
(m_start_row.c_str()));

70 ià(
¡¬t_šşusive
)

71 
m_™”
 = 
m_šdex
.
	`low”_bound
(
key
);

73 
m_™”
 = 
m_šdex
.
	`uµ”_bound
(
key
);

74 
	`De¡roy
(
key
);

76 
m_cur_key
 = 0;

78 ià(
m_™”
 =ğ
m_šdex
.
	`’d
())

84 ià(
m_¡¬t_row
 =ğ
m_’d_row
 || (
sÿnCÚ‹xtPŒ
->
¥ec
 && sÿnCÚ‹xtPŒ->¥ec->
rowLim™
 == 1)) {

85 
m_»adah—d
 = 
çl£
;

86 
	`mem£t
(&
m_block
, 0, (m_block));

87 ià(!
	`ãtch_Ãxt_block
()) {

88 
m_™”
 = 
m_šdex
.
	`’d
();

93 
”rÜ
;

94 
ušt32_t
 
buf_size
 = 
m_ûÎ_¡Üe_±r
->
	`g‘_blocksize
();

95 ià(
buf_size
 < 
MINIMUM_READAHEAD_AMOUNT
)

96 
buf_size
 = 
MINIMUM_READAHEAD_AMOUNT
;

98 
m_¡¬t_off£t
 = (*
m_™”
).
£cÚd
;

100 
key
 = 
	`C»©e
(
m_’d_row
.
	`c_¡r
(), 
	`¡¾’
(m_end_row.c_str()));

101 ià((
m_’d_™”
 = 
m_šdex
.
	`uµ”_bound
(
key
)è=ğm_šdex.
	`’d
())

102 
m_’d_off£t
 = 
m_ûÎ_¡Üe_v0
->
m_Œa”
.
fix_šdex_off£t
;

104 
C–lStÜeV0
::
IndexM­T
::
™”©Ü
 
™”_Ãxt
 = 
m_’d_™”
;

105 
™”_Ãxt
++;

106 ià(
™”_Ãxt
 =ğ
m_šdex
.
	`’d
())

107 
m_’d_off£t
 = 
m_ûÎ_¡Üe_v0
->
m_Œa”
.
fix_šdex_off£t
;

109 
m_’d_off£t
 = (*
™”_Ãxt
).
£cÚd
;

111 
	`De¡roy
(
key
);

113 ià((
”rÜ
 = 
m_ûÎ_¡Üe_v0
->
m_fesys
->
	`İ’_bufã»d
(
m_ûÎ_¡Üe_±r
->
	`g‘_f’ame
(), 
buf_size
, 2, &
m_fd
, 
m_¡¬t_off£t
, 
m_’d_off£t
)è!ğ
E¼Ü
::
OK
) {

115 
	`HT_ERRORF
("Problem opening cell store '%s' in„eadahead mode - %s",

116 
m_ûÎ_¡Üe_±r
->
	`g‘_f’ame
().
	`c_¡r
(), 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

117 
m_™”
 = 
m_šdex
.
	`’d
();

120 ià(!
	`ãtch_Ãxt_block_»adah—d
()) {

121 
m_™”
 = 
m_šdex
.
	`’d
();

129 
m_cur_key
 = (
By‹SŒšg32T
 *)
m_block
.
±r
;

130 
m_cur_v®ue
 = (
By‹SŒšg32T
 *)(
m_block
.
±r
 + 
	`L’gth
(
m_cur_key
));

132 ià(
¡¬t_šşusive
) {

133 
	`¡rcmp
((cÚ¡ *)
m_cur_key
->
d©a
, 
m_¡¬t_row
.
	`c_¡r
()) < 0) {

134 
m_block
.
±r
 = ((
ušt8_t
 *)
m_cur_v®ue
è+ 
	`L’gth
(m_cur_value);

135 ià(
m_block
.
±r
 >ğm_block.
’d
) {

136 
m_™”
 = 
m_šdex
.
	`’d
();

137 
	`HT_ERRORF
("UÇbËØfšd s¹ oà¿ngÔow='%s'èš %s", 
m_¡¬t_row
.
	`c_¡r
(), 
m_ûÎ_¡Üe_±r
->
	`g‘_f’ame
().c_str());

140 
m_cur_key
 = (
By‹SŒšg32T
 *)
m_block
.
±r
;

141 
m_cur_v®ue
 = (
By‹SŒšg32T
 *)(
m_block
.
±r
 + 
	`L’gth
(
m_cur_key
));

145 
	`¡rcmp
((cÚ¡ *)
m_cur_key
->
d©a
, 
m_¡¬t_row
.
	`c_¡r
()) <= 0) {

146 
m_block
.
±r
 = ((
ušt8_t
 *)
m_cur_v®ue
è+ 
	`L’gth
(m_cur_value);

147 ià(
m_block
.
±r
 >ğm_block.
’d
) {

148 ià(
m_»adah—d
) {

149 ià(!
	`ãtch_Ãxt_block_»adah—d
())

152 ià(!
	`ãtch_Ãxt_block
())

155 
m_cur_key
 = (
By‹SŒšg32T
 *)
m_block
.
±r
;

156 
m_cur_v®ue
 = (
By‹SŒšg32T
 *)(
m_block
.
±r
 + 
	`L’gth
(
m_cur_key
));

164 ià(
m_’d_šşusive
) {

165 ià(
	`¡rcmp
((cÚ¡ *)
m_cur_key
->
d©a
, 
m_’d_row
.
	`c_¡r
()) > 0) {

166 
m_™”
 = 
m_šdex
.
	`’d
();

171 ià(
	`¡rcmp
((cÚ¡ *)
m_cur_key
->
d©a
, 
m_’d_row
.
	`c_¡r
()) >= 0) {

172 
m_™”
 = 
m_šdex
.
	`’d
();

181 
Key
 
keyComps
;

182 ià(!
keyComps
.
	`lßd
(
m_cur_key
)) {

183 
	`HT_ERROR
("Problem…arsing key!");

185 ià(
keyComps
.
æag
 !ğ
FLAG_DELETE_ROW
 && !
m_sÿn_cÚ‹xt_±r
->
çmyMask
[keyComps.
cŞumn_çmy_code
])

186 
	`fÜw¬d
();

188 
	}
}

191 
	gC–lStÜeSÿÂ”V0
::~
	$C–lStÜeSÿÂ”V0
() {

192 
”rÜ
;

194 ià(
m_fd
 != -1) {

195 ià((
”rÜ
 = 
m_ûÎ_¡Üe_v0
->
m_fesys
->
	`şo£
(
m_fd
, 0)è!ğ
E¼Ü
::
OK
) {

196 
	`HT_ERRORF
("ProbËm closšg desütÜ %d fe=%s", 
m_fd
, 
m_ûÎ_¡Üe_±r
->
	`g‘_f’ame
().
	`c_¡r
());

200 ià(
m_»adah—d
)

201 
d–‘e
 [] 
m_block
.
ba£
;

203 ià(
m_block
.
ba£
 != 0)

204 
Glob®
::
blockCache
->
	`checkš
(
m_fe_id
, 
m_block
.
off£t
);

206 
d–‘e
 
m_zcodec
;

208 #ifdeà
STAT


209 
cout
 << 
æush
;

210 
cout
 << "STAT[~C–lStÜeSÿÂ”V0]\tg‘\t" << 
m_»tuºed
 << "\t";

211 
cout
 << 
m_ûÎ_¡Üe_v0
->
	`g‘_f’ame
(è<< "[" << 
m_¡¬t_row
 << ".." << 
m_’d_row
 << "]" << 
’dl
;

214 
	}
}

217 
boŞ
 
	gC–lStÜeSÿÂ”V0
::
	$g‘
(
By‹SŒšg32T
 **
keyp
, By‹SŒšg32T **
v®u•
) {

219 ià(
m_™”
 =ğ
m_šdex
.
	`’d
())

220  
çl£
;

222 #ifdeà
STAT


223 
m_»tuºed
++;

226 *
keyp
 = 
m_cur_key
;

227 *
v®u•
 = 
m_cur_v®ue
;

229  
Œue
;

230 
	}
}

234 
	gC–lStÜeSÿÂ”V0
::
	$fÜw¬d
() {

235 
Key
 
keyComps
;

237 
Œue
) {

239 ià(
m_™”
 =ğ
m_šdex
.
	`’d
())

242 
m_block
.
±r
 = ((
ušt8_t
 *)
m_cur_v®ue
è+ 
	`L’gth
(m_cur_value);

244 ià(
m_block
.
±r
 >ğm_block.
’d
) {

245 ià(
m_»adah—d
) {

246 ià(!
	`ãtch_Ãxt_block_»adah—d
())

249 ià(!
	`ãtch_Ãxt_block
())

253 
m_cur_key
 = (
By‹SŒšg32T
 *)
m_block
.
±r
;

254 
m_cur_v®ue
 = (
By‹SŒšg32T
 *)(
m_block
.
±r
 + 
	`L’gth
(
m_cur_key
));

256 ià(
m_check_fÜ_¿nge_’d
) {

257 ià(
m_’d_šşusive
) {

258 ià(
	`¡rcmp
((cÚ¡ *)
m_cur_key
->
d©a
, 
m_’d_row
.
	`c_¡r
()) > 0) {

259 
m_™”
 = 
m_šdex
.
	`’d
();

264 ià(
	`¡rcmp
((cÚ¡ *)
m_cur_key
->
d©a
, 
m_’d_row
.
	`c_¡r
()) >= 0) {

265 
m_™”
 = 
m_šdex
.
	`’d
();

274 ià(!
keyComps
.
	`lßd
(
m_cur_key
)) {

275 
	`HT_ERROR
("Problem…arsing key!");

278 ià(
keyComps
.
æag
 =ğ
FLAG_DELETE_ROW
 || 
m_sÿn_cÚ‹xt_±r
->
çmyMask
[keyComps.
cŞumn_çmy_code
])

281 
	}
}

297 
boŞ
 
	gC–lStÜeSÿÂ”V0
::
	$ãtch_Ãxt_block
() {

298 
ušt8_t
 *
buf
 = 0;

299 
boŞ
 
rv®
 = 
çl£
;

300 
”rÜ
;

303 ià(
m_block
.
ba£
 !ğ0 && m_block.
±r
 >ğm_block.
’d
) {

304 
Glob®
::
blockCache
->
	`checkš
(
m_fe_id
, 
m_block
.
off£t
);

305 
	`mem£t
(&
m_block
, 0, (m_block));

306 
m_™”
++;

309 ià(
m_block
.
ba£
 =ğ0 && 
m_™”
 !ğ
m_šdex
.
	`’d
()) {

310 
DyÇmicBufãr
 
	`ex·ndBufãr
(0);

311 
ušt32_t
 
Ën
;

313 
m_block
.
off£t
 = (*
m_™”
).
£cÚd
;

315 
C–lStÜeV0
::
IndexM­T
::
™”©Ü
 
™”Next
 = 
m_™”
;

316 
™”Next
++;

317 ià(
™”Next
 =ğ
m_šdex
.
	`’d
()) {

318 
m_block
.
zËngth
 = 
m_ûÎ_¡Üe_v0
->
m_Œa”
.
fix_šdex_off£t
 - m_block.
off£t
;

319 ià(
m_’d_row
.
	`c_¡r
()[0] != ()0xff)

320 
m_check_fÜ_¿nge_’d
 = 
Œue
;

323 ià(
	`¡rcmp
((cÚ¡ *)((*
™”Next
).
fœ¡
)->
d©a
, 
m_’d_row
.
	`c_¡r
()) >= 0)

324 
m_check_fÜ_¿nge_’d
 = 
Œue
;

325 
m_block
.
zËngth
 = (*
™”Next
).
£cÚd
 - m_block.
off£t
;

331 ià(!
Glob®
::
blockCache
->
	`checkout
(
m_fe_id
, (
ušt32_t
)
m_block
.
off£t
, &m_block.
ba£
, &
Ën
)) {

333 
buf
 = 
Ãw
 
ušt8_t
 [ 
m_block
.
zËngth
 ];

334 
ušt32_t
 
Ä—d
;

335 ià(
m_ûÎ_¡Üe_v0
->
m_fesys
->
	`´—d
(m_ûÎ_¡Üe_v0->
m_fd
, 
m_block
.
off£t
, m_block.
zËngth
, 
buf
, &
Ä—d
è!ğ
E¼Ü
::
OK
)

336 
abÜt
;

338 ià(
Ä—d
 > 0) {

340 
	`VK_MARK_DATA_REGION
((
ulÚg
)
buf
, 
Ä—d
);

345 
BlockCom´essiÚH—d”C–lStÜe
 
h—d”
;

346 
DyÇmicBufãr
 
	`šput
(0);

347 
šput
.
buf
 = buf;

348 
šput
.
±r
 = 
buf
 + 
m_block
.
zËngth
;

349 ià((
”rÜ
 = 
m_zcodec
->
	`šæ©e
(
šput
, 
ex·ndBufãr
, 
h—d”
)è!ğ
E¼Ü
::
OK
) {

350 
	`HT_ERRORF
("ProbËm inæ©šg c–È¡Ü(%sèblock - %s", 
m_ûÎ_¡Üe_±r
->
	`g‘_f’ame
().
	`c_¡r
(), 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

351 
šput
.
buf
 = 0;

352 
abÜt
;

354 
šput
.
buf
 = 0;

355 ià(!
h—d”
.
	`check_magic
(
C–lStÜeV0
::
DATA_BLOCK_MAGIC
)) {

356 
	`HT_ERROR
("Problem inflating cell store block - magic string mismatch");

357 
abÜt
;

362 
size_t
 
fl
;

363 
m_block
.
ba£
 = 
ex·ndBufãr
.
	`»Ëa£
(&
fl
);

364 
Ën
 = 
fl
;

367 ià(!
Glob®
::
blockCache
->
	`š£¹_ªd_checkout
(
m_fe_id
, (
ušt32_t
)
m_block
.
off£t
, m_block.
ba£
, 
Ën
)) {

368 
d–‘e
 [] 
m_block
.
ba£
;

369 ià(!
Glob®
::
blockCache
->
	`checkout
(
m_fe_id
, (
ušt32_t
)
m_block
.
off£t
, &m_block.
ba£
, &
Ën
)) {

370 
	`HT_ERRORF
("ProbËm checkšg ouˆblock from cachfeId=%d, off£t=%ld", 
m_fe_id
, (
ušt32_t
)
m_block
.
off£t
);

371 
DUMP_CORE
;

375 
m_block
.
±r
 = m_block.
ba£
;

376 
m_block
.
’d
 = m_block.
ba£
 + 
Ën
;

378 
rv®
 = 
Œue
;

381 
abÜt
:

382 
d–‘e
 [] 
buf
;

383  
rv®
;

384 
	}
}

400 
boŞ
 
	gC–lStÜeSÿÂ”V0
::
	$ãtch_Ãxt_block_»adah—d
() {

401 
”rÜ
;

402 
ušt8_t
 *
buf
 = 0;

403 
boŞ
 
rv®
 = 
çl£
;

406 ià(
m_block
.
ba£
 !ğ0 && m_block.
±r
 >ğm_block.
’d
) {

407 
d–‘e
 [] 
m_block
.
ba£
;

408 
	`mem£t
(&
m_block
, 0, (m_block));

409 
m_™”
++;

412 ià(
m_block
.
ba£
 =ğ0 && 
m_™”
 !ğ
m_šdex
.
	`’d
()) {

413 
DyÇmicBufãr
 
	`ex·ndBufãr
(0);

414 
ušt32_t
 
Ën
;

415 
ušt32_t
 
Ä—d
;

417 
m_block
.
off£t
 = (*
m_™”
).
£cÚd
;

418 
	`as£¹
(
m_block
.
off£t
 =ğ
m_¡¬t_off£t
);

420 
C–lStÜeV0
::
IndexM­T
::
™”©Ü
 
™”Next
 = 
m_™”
;

421 
™”Next
++;

422 ià(
™”Next
 =ğ
m_šdex
.
	`’d
()) {

423 
m_block
.
zËngth
 = 
m_ûÎ_¡Üe_v0
->
m_Œa”
.
fix_šdex_off£t
 - m_block.
off£t
;

424 ià(
m_’d_row
.
	`c_¡r
()[0] != ()0xff)

425 
m_check_fÜ_¿nge_’d
 = 
Œue
;

428 ià(
	`¡rcmp
((cÚ¡ *)((*
™”Next
).
fœ¡
)->
d©a
, 
m_’d_row
.
	`c_¡r
()) >= 0)

429 
m_check_fÜ_¿nge_’d
 = 
Œue
;

430 
m_block
.
zËngth
 = (*
™”Next
).
£cÚd
 - m_block.
off£t
;

434 
buf
 = 
Ãw
 
ušt8_t
 [ 
m_block
.
zËngth
 ];

436 ià((
”rÜ
 = 
m_ûÎ_¡Üe_v0
->
m_fesys
->
	`»ad
(
m_fd
, 
m_block
.
zËngth
, 
buf
, &
Ä—d
)è!ğ
E¼Ü
::
OK
) {

437 
	`HT_ERRORF
("Problem„eading %ld bytes from cell store file '%s'",

438 
m_block
.
zËngth
, 
m_ûÎ_¡Üe_±r
->
	`g‘_f’ame
().
	`c_¡r
());

439 
abÜt
;

442 
	`VK_MARK_DATA_REGION
((
ulÚg
)
buf
, 
Ä—d
);

444 ià(
Ä—d
 !ğ
m_block
.
zËngth
) {

445 
	`HT_ERRORF
("shÜˆ»ad %ld !ğ%ld", 
Ä—d
, 
m_block
.
zËngth
);

446 
DUMP_CORE
;

448 
	`as£¹
(
Ä—d
 =ğ
m_block
.
zËngth
);

449 
m_¡¬t_off£t
 +ğ
Ä—d
;

453 
BlockCom´essiÚH—d”C–lStÜe
 
h—d”
;

454 
DyÇmicBufãr
 
	`šput
(0);

455 
šput
.
buf
 = buf;

456 
šput
.
±r
 = 
buf
 + 
m_block
.
zËngth
;

457 ià((
”rÜ
 = 
m_zcodec
->
	`šæ©e
(
šput
, 
ex·ndBufãr
, 
h—d”
)è!ğ
E¼Ü
::
OK
) {

458 
	`HT_ERRORF
("ProbËm inæ©šg c–È¡Ü(%sèblock - %s", 
m_ûÎ_¡Üe_±r
->
	`g‘_f’ame
().
	`c_¡r
(), 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

459 
šput
.
buf
 = 0;

460 
abÜt
;

462 
šput
.
buf
 = 0;

463 ià(!
h—d”
.
	`check_magic
(
C–lStÜeV0
::
DATA_BLOCK_MAGIC
)) {

464 
	`HT_ERROR
("Problem inflating cell store block - magic string mismatch");

465 
abÜt
;

470 
size_t
 
fl
;

471 
m_block
.
ba£
 = 
ex·ndBufãr
.
	`»Ëa£
(&
fl
);

472 
Ën
 = 
fl
;

474 
m_block
.
±r
 = m_block.
ba£
;

475 
m_block
.
’d
 = m_block.
ba£
 + 
Ën
;

477 
rv®
 = 
Œue
;

480 
abÜt
:

481 
d–‘e
 [] 
buf
;

482  
rv®
;

483 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/CellStoreScannerV0.h

20 #iâdeà
HYPERTABLE_CELLSTORESCANNERVERSION1_H


21 
	#HYPERTABLE_CELLSTORESCANNERVERSION1_H


	)

23 
	~"CommÚ/DyÇmicBufãr.h
"

25 
	~"C–lStÜeV0.h
"

26 
	~"C–lLi¡SÿÂ”.h
"

28 
Çme¥aû
 
	gHy³¹abË
 {

30 
şass
 
	gBlockCom´essiÚCodec
;

31 
şass
 
	gC–lStÜe
;

33 şas 
	cC–lStÜeSÿÂ”V0
 : 
public
 
C–lLi¡SÿÂ”
 {

34 
public
:

35 
C–lStÜeSÿÂ”V0
(
C–lStÜePŒ
 &
ûÎStÜePŒ
, 
SÿnCÚ‹xtPŒ
 &
sÿnCÚ‹xtPŒ
);

36 
	gvœtu®
 ~
C–lStÜeSÿÂ”V0
();

37 
vœtu®
 
fÜw¬d
();

38 
vœtu®
 
boŞ
 
g‘
(
By‹SŒšg32T
 **
keyp
, By‹SŒšg32T **
v®u•
);

40 
	g´iv©e
:

43 
ušt32_t
 
off£t
;

44 
ušt32_t
 
	gzËngth
;

45 
ušt8_t
 *
	gba£
;

46 
ušt8_t
 *
	g±r
;

47 
ušt8_t
 *
	g’d
;

48 } 
	tBlockInfoT
;

50 
boŞ
 
ãtch_Ãxt_block
();

51 
boŞ
 
ãtch_Ãxt_block_»adah—d
();

52 
boŞ
 
š™Ÿlize
();

54 
C–lStÜePŒ
 
	gm_ûÎ_¡Üe_±r
;

55 
C–lStÜeV0
 *
	gm_ûÎ_¡Üe_v0
;

56 
	gC–lStÜeV0
::
IndexM­T
 &
m_šdex
;

58 
	gC–lStÜeV0
::
IndexM­T
::
™”©Ü
 
m_™”
;

59 
	gC–lStÜeV0
::
IndexM­T
::
™”©Ü
 
m_’d_™”
;

61 
BlockInfoT
 
	gm_block
;

62 
By‹SŒšg32T
 *
	gm_cur_key
;

63 
By‹SŒšg32T
 *
	gm_cur_v®ue
;

64 
BlockCom´essiÚCodec
 *
	gm_zcodec
;

65 
boŞ
 
	gm_check_fÜ_¿nge_’d
;

66 
boŞ
 
	gm_’d_šşusive
;

67 
	gm_fe_id
;

68 
	g¡d
::
¡ršg
 
m_¡¬t_row
;

69 
	g¡d
::
¡ršg
 
m_’d_row
;

70 
boŞ
 
	gm_»adah—d
;

71 
št32_t
 
	gm_fd
;

72 
ušt32_t
 
	gm_¡¬t_off£t
;

73 
ušt32_t
 
	gm_’d_off£t
;

74 
ušt32_t
 
	gm_»tuºed
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/CellStoreTrailer.h

21 #iâdeà
HYPERTABLE_CELLSTORETRAILER_H


22 
	#HYPERTABLE_CELLSTORETRAILER_H


	)

24 
	~<io¡»am
>

27 
	~<¡dšt.h
>

30 
Çme¥aû
 
Hy³¹abË
 {

35 şas 
	cC–lStÜeT¿”
 {

36 
public
:

38 
vœtu®
 ~
C–lStÜeT¿”
() { ; }

43 
vœtu®
 
ş—r
() = 0;

50 
vœtu®
 
size_t
 
size
() = 0;

57 
vœtu®
 
£rŸlize
(
ušt8_t
 *
buf
) = 0;

64 
vœtu®
 
de£rŸlize
(
ušt8_t
 *
buf
) = 0;

71 
vœtu®
 
di¥Ïy
(
¡d
::
o¡»am
 &
os
) = 0;

78 
šlše
 
¡d
::
o¡»am
 &
İ”©Ü
 <<(¡d::o¡»am &
os
, 
C–lStÜeT¿”
 &
Œa”
) {

79 
Œa”
.
di¥Ïy
(
os
);

80  
os
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/CellStoreTrailerV0.cc

21 
	~<io¡»am
>

23 
	~"AsyncComm/S”Ÿliz©iÚ.h
"

25 
	~"C–lStÜeT¿”V0.h
"

27 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

28 
usšg
 
Çme¥aû
 
	g¡d
;

34 
	gC–lStÜeT¿”V0
::
	$C–lStÜeT¿”V0
() {

35 
	`ş—r
();

36 
	}
}

41 
	gC–lStÜeT¿”V0
::
	$ş—r
() {

42 
fix_šdex_off£t
 = 0;

43 
v¬_šdex_off£t
 = 0;

44 
f‹r_off£t
 = 0;

45 
šdex_’Œ›s
 = 0;

46 
tÙ®_’Œ›s
 = 0;

47 
blocksize
 = 0;

48 
time¡amp
.
logiÿl
 = 0;

49 
time¡amp
.
»®
 = 0;

50 
com´essiÚ_¿tio
 = 0.0;

51 
com´essiÚ_ty³
 = 0;

52 
v”siÚ
 = 0;

53 
	}
}

59 
	gC–lStÜeT¿”V0
::
	$£rŸlize
(
ušt8_t
 *
buf
) {

60 
ušt8_t
 *
ba£
 = 
buf
;

61 
S”Ÿliz©iÚ
::
	`’code_št
(&
buf
, 
fix_šdex_off£t
);

62 
S”Ÿliz©iÚ
::
	`’code_št
(&
buf
, 
v¬_šdex_off£t
);

63 
S”Ÿliz©iÚ
::
	`’code_št
(&
buf
, 
f‹r_off£t
);

64 
S”Ÿliz©iÚ
::
	`’code_št
(&
buf
, 
šdex_’Œ›s
);

65 
S”Ÿliz©iÚ
::
	`’code_št
(&
buf
, 
tÙ®_’Œ›s
);

66 
S”Ÿliz©iÚ
::
	`’code_št
(&
buf
, 
blocksize
);

67 
S”Ÿliz©iÚ
::
	`’code_lÚg
(&
buf
, 
time¡amp
.
logiÿl
);

68 
S”Ÿliz©iÚ
::
	`’code_lÚg
(&
buf
, 
time¡amp
.
»®
);

69 
S”Ÿliz©iÚ
::
	`’code_št
(&
buf
, *((
ušt32_t
 *)&
com´essiÚ_¿tio
));

70 
S”Ÿliz©iÚ
::
	`’code_shÜt
(&
buf
, 
com´essiÚ_ty³
);

71 
S”Ÿliz©iÚ
::
	`’code_shÜt
(&
buf
, 
v”siÚ
);

72 
	`as£¹
((
buf
-
ba£
è=ğ()
C–lStÜeT¿”V0
::
	`size
());

73 ()
ba£
;

74 
	}
}

80 
	gC–lStÜeT¿”V0
::
	$de£rŸlize
(
ušt8_t
 *
buf
) {

81 
size_t
 
»maššg
 = 
C–lStÜeT¿”V0
::
	`size
();

82 
S”Ÿliz©iÚ
::
	`decode_št
(&
buf
, &
»maššg
, &
fix_šdex_off£t
);

83 
S”Ÿliz©iÚ
::
	`decode_št
(&
buf
, &
»maššg
, &
v¬_šdex_off£t
);

84 
S”Ÿliz©iÚ
::
	`decode_št
(&
buf
, &
»maššg
, &
f‹r_off£t
);

85 
S”Ÿliz©iÚ
::
	`decode_št
(&
buf
, &
»maššg
, &
šdex_’Œ›s
);

86 
S”Ÿliz©iÚ
::
	`decode_št
(&
buf
, &
»maššg
, &
tÙ®_’Œ›s
);

87 
S”Ÿliz©iÚ
::
	`decode_št
(&
buf
, &
»maššg
, &
blocksize
);

88 
S”Ÿliz©iÚ
::
	`decode_lÚg
(&
buf
, &
»maššg
, &
time¡amp
.
logiÿl
);

89 
S”Ÿliz©iÚ
::
	`decode_lÚg
(&
buf
, &
»maššg
, &
time¡amp
.
»®
);

90 
S”Ÿliz©iÚ
::
	`decode_št
(&
buf
, &
»maššg
, (
ušt32_t
 *)&
com´essiÚ_¿tio
);

91 
S”Ÿliz©iÚ
::
	`decode_shÜt
(&
buf
, &
»maššg
, &
com´essiÚ_ty³
);

92 
S”Ÿliz©iÚ
::
	`decode_shÜt
(&
buf
, &
»maššg
, &
v”siÚ
);

93 
	}
}

99 
	gC–lStÜeT¿”V0
::
di¥Ïy
(
¡d
::
o¡»am
 &
os
) {

100 
os
 << "fix_šdex_off£ˆğ" << 
fix_šdex_off£t
 << 
’dl
;

101 
	gos
 << "v¬_šdex_off£ˆğ" << 
	gv¬_šdex_off£t
 << 
	g’dl
;

102 
	gos
 << "f‹r_off£ˆğ" << 
	gf‹r_off£t
 << 
	g’dl
;

103 
	gos
 << "šdex_’Œ› ğ" << 
	gšdex_’Œ›s
 << 
	g’dl
;

104 
	gos
 << "tÙ®_’Œ› ğ" << 
	gtÙ®_’Œ›s
 << 
	g’dl
;

105 
	gos
 << "blocksizğ" << 
	gblocksize
 << 
	g’dl
;

106 
	gos
 << "time¡am°logiÿÈğ" << 
	gtime¡amp
.
	glogiÿl
 << 
	g’dl
;

107 
	gos
 << "time¡am°»® = " << 
	gtime¡amp
.
	g»®
 << 
	g’dl
;

108 
	gos
 << "com´essiÚ_¿tiØğ" << 
	gcom´essiÚ_¿tio
 << 
	g’dl
;

109 
	gos
 << "com´essiÚ_ty³ = " << 
	gcom´essiÚ_ty³
 << 
	g’dl
;

110 
	gos
 << "v”siÚ = " << 
	gv”siÚ
 << 
	g’dl
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/CellStoreTrailerV0.h

21 #iâdeà
HYPERTABLE_CELLSTORETRAILERV0_H


22 
	#HYPERTABLE_CELLSTORETRAILERV0_H


	)

25 
	~<¡dšt.h
>

28 
	~"C–lStÜeT¿”.h
"

29 
	~"Time¡amp.h
"

31 
Çme¥aû
 
Hy³¹abË
 {

33 şas 
	cC–lStÜeT¿”V0
 : 
public
 
C–lStÜeT¿”
 {

34 
public
:

35 
C–lStÜeT¿”V0
();

36 
vœtu®
 ~
C–lStÜeT¿”V0
() { ; }

37 
vœtu®
 
ş—r
();

38 
vœtu®
 
size_t
 
size
() {  48; }

39 
vœtu®
 
£rŸlize
(
ušt8_t
 *
buf
);

40 
vœtu®
 
de£rŸlize
(
ušt8_t
 *
buf
);

41 
vœtu®
 
di¥Ïy
(
¡d
::
o¡»am
 &
os
);

43 
ušt32_t
 
fix_šdex_off£t
;

44 
ušt32_t
 
v¬_šdex_off£t
;

45 
ušt32_t
 
f‹r_off£t
;

46 
ušt32_t
 
šdex_’Œ›s
;

47 
ušt32_t
 
tÙ®_’Œ›s
;

48 
ušt32_t
 
blocksize
;

49 
Time¡amp
 
time¡amp
;

50 
com´essiÚ_¿tio
;

51 
ušt16_t
 
com´essiÚ_ty³
;

52 
ušt16_t
 
v”siÚ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/CellStoreV0.cc

20 
	~<ÿs£¹
>

22 
	~<boo¡/®gÜ™hm/¡ršg.hµ
>

25 
	~<¡ršg.h
>

28 
	~"CommÚ/E¼Ü.h
"

29 
	~"CommÚ/Logg”.h
"

30 
	~"CommÚ/Sy¡em.h
"

32 
	~"AsyncComm/PrÙocŞ.h
"

34 
	~"Hy³¹abË/Lib/Com´essÜFaùÜy.h
"

35 
	~"Hy³¹abË/Lib/Key.h
"

37 
	~"BlockCom´essiÚH—d”C–lStÜe.h
"

38 
	~"C–lStÜeSÿÂ”V0.h
"

39 
	~"C–lStÜeV0.h
"

40 
	~"FeBlockCache.h
"

42 cÚ¡ 
C–lStÜeV0
::
DATA_BLOCK_MAGIC
[10] = { 'D','a','t','a','-','-','-','-','-','-' };

43 cÚ¡ 
	gC–lStÜeV0
::
INDEX_FIXED_BLOCK_MAGIC
[10] = { 'I','d','x','F','i','x','-','-','-','-' };

44 cÚ¡ 
	gC–lStÜeV0
::
INDEX_VARIABLE_BLOCK_MAGIC
[10] = { 'I','d','x','V','a','r','-','-','-','-' };

46 
	gÇme¥aû
 {

47 cÚ¡ 
ušt32_t
 
	gMAX_APPENDS_OUTSTANDING
 = 3;

50 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

52 
	gC–lStÜeV0
::
	$C–lStÜeV0
(
Fesy¡em
 *
fesys
è: 
	`m_fesys
(fesys), 
	`m_f’ame
(), 
	`m_fd
(-1), 
	`m_šdex
(),

53 
	`m_com´essÜ
(0), 
	`m_bufãr
(0), 
	`m_fix_šdex_bufãr
(0), 
	`m_v¬_šdex_bufãr
(0),

54 
	`m_out¡ªdšg_­³nds
(0), 
	`m_off£t
(0), 
	`m_Ï¡_key
(0), 
	`m_fe_Ëngth
(0), 
	`m_disk_u§ge
(0), 
	`m_fe_id
(0), 
	$m_uncom´es£d_blocksize
(0) {

55 
m_fe_id
 = 
FeBlockCache
::
	`g‘_Ãxt_fe_id
();

56 
	`as£¹
(() == 4);

57 
	}
}

61 
	gC–lStÜeV0
::~
	$C–lStÜeV0
() {

62 
”rÜ
;

63 
d–‘e
 
m_com´essÜ
;

64 ià(
m_fd
 != -1) {

65 ià((
”rÜ
 = 
m_fesys
->
	`şo£
(
m_fd
)è!ğ
E¼Ü
::
OK
) {

66 
	`HT_ERRORF
("ProbËm closšg HDFS cl›Á - %s", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

69 
	}
}

72 
BlockCom´essiÚCodec
 *
	gC–lStÜeV0
::
	$ü—‹_block_com´essiÚ_codec
() {

73  
Com´essÜFaùÜy
::
	`ü—‹_block_codec
(

74 (
BlockCom´essiÚCodec
::
Ty³
)
m_Œa”
.
com´essiÚ_ty³
);

75 
	}
}

79 
	gC–lStÜeV0
::
	$g‘_time¡amp
(
Time¡amp
 &
time¡amp
) {

80 
time¡amp
 = 
m_Œa”
.timestamp;

81 
	}
}

84 cÚ¡ *
	gC–lStÜeV0
::
	$g‘_¥l™_row
() {

85 ià(
m_¥l™_row
 != "")

86  
m_¥l™_row
.
	`c_¡r
();

88 
	}
}

91 
C–lLi¡SÿÂ”
 *
	gC–lStÜeV0
::
	$ü—‹_sÿÂ”
(
SÿnCÚ‹xtPŒ
 &
sÿnCÚ‹xtPŒ
) {

92 
C–lStÜePŒ
 
	`ûÎStÜePŒ
(
this
);

93  
Ãw
 
	`C–lStÜeSÿÂ”V0
(
ûÎStÜePŒ
, 
sÿnCÚ‹xtPŒ
);

94 
	}
}

97 
	gC–lStÜeV0
::
ü—‹
(cÚ¡ *
âame
, 
ušt32_t
 
blocksize
, cÚ¡ 
¡d
::
¡ršg
 &
com´essÜ
) {

98 
m_bufãr
.
»£rve
(
blocksize
*4);

100 
	gm_fd
 = -1;

101 
	gm_off£t
 = 0;

102 
	gm_Ï¡_key
 = 0;

103 
	gm_fix_šdex_bufãr
.
»£rve
(
blocksize
);

104 
	gm_v¬_šdex_bufãr
.
»£rve
(
blocksize
);

106 
	gm_uncom´es£d_d©a
 = 0.0;

107 
	gm_com´es£d_d©a
 = 0.0;

109 
	gm_Œa”
.
ş—r
();

110 
	gm_Œa”
.
	gblocksize
 = 
blocksize
;

111 
	gm_uncom´es£d_blocksize
 = 
blocksize
;

113 
	gm_f’ame
 = 
âame
;

115 
	gm_¡¬t_row
 = "";

116 
	gm_’d_row
 = 
Key
::
END_ROW_MARKER
;

118 ià(
	gcom´essÜ
.
em±y
())

119 
	gm_Œa”
.
	gcom´essiÚ_ty³
 = 
BlockCom´essiÚCodec
::
LZO
;

121 
	gm_Œa”
.
	gcom´essiÚ_ty³
 = 
Com´essÜFaùÜy
::
·r£_block_codec_¥ec
(

122 
com´essÜ
, 
m_com´essÜ_¬gs
);

123 
	gm_com´essÜ
 = 
Com´essÜFaùÜy
::
ü—‹_block_codec
(

124 (
BlockCom´essiÚCodec
::
Ty³
)
m_Œa”
.
com´essiÚ_ty³
,

125 
m_com´essÜ_¬gs
);

127  
	gm_fesys
->
ü—‹
(
m_f’ame
, 
Œue
, -1, -1, -1, &
m_fd
);

131 
	gC–lStÜeV0
::
	$add
(cÚ¡ 
By‹SŒšg32T
 *
key
, cÚ¡ By‹SŒšg32T *
v®ue
, 
ušt64_t
 
»®_time¡amp
) {

132 
”rÜ
;

133 
Ev’tPŒ
 
ev’tPŒ
;

134 
DyÇmicBufãr
 
	`zBufãr
(0);

136 ()
»®_time¡amp
;

138 ià(
m_bufãr
.
	`fl
(è> 
m_uncom´es£d_blocksize
) {

139 
BlockCom´essiÚH—d”C–lStÜe
 
	`h—d”
(
DATA_BLOCK_MAGIC
);

141 
	`add_šdex_’Œy
(
m_Ï¡_key
, 
m_off£t
);

143 
m_uncom´es£d_d©a
 +ğ()
m_bufãr
.
	`fl
();

144 
m_com´essÜ
->
	`deæ©e
(
m_bufãr
, 
zBufãr
, 
h—d”
);

145 
m_com´es£d_d©a
 +ğ()
zBufãr
.
	`fl
();

146 
m_bufãr
.
	`ş—r
();

148 
ušt64_t
 
Îv®
 = ((ušt64_t)
m_Œa”
.
blocksize
 * (ušt64_t)
m_uncom´es£d_d©a
è/ (ušt64_t)
m_com´es£d_d©a
;

149 
m_uncom´es£d_blocksize
 = (
ušt32_t
)
Îv®
;

151 ià(
m_out¡ªdšg_­³nds
 >ğ
MAX_APPENDS_OUTSTANDING
) {

152 ià(!
m_sync_hªdËr
.
	`wa™_fÜ_»¶y
(
ev’tPŒ
)) {

153 
	`HT_ERRORF
("ProbËm wr™šgØHDFS f'%s' : %s", 
m_f’ame
.
	`c_¡r
(), 
Hy³¹abË
::
PrÙocŞ
::
	`¡ršg_fÜm©_mes§ge
(
ev’tPŒ
).c_str());

156 
m_out¡ªdšg_­³nds
--;

159 
size_t
 
zËn
;

160 
ušt8_t
 *
zbuf
 = 
zBufãr
.
	`»Ëa£
(&
zËn
);

162 ià((
”rÜ
 = 
m_fesys
->
	`­³nd
(
m_fd
, 
zbuf
, 
zËn
, &
m_sync_hªdËr
)è!ğ
E¼Ü
::
OK
) {

163 
	`HT_ERRORF
("ProbËm wr™šgØHDFS f'%s' : %s", 
m_f’ame
.
	`c_¡r
(), 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

166 
m_out¡ªdšg_­³nds
++;

167 
m_off£t
 +ğ
zËn
;

170 
size_t
 
keyL’
 = (
št32_t
è+ 
key
->
Ën
;

171 
size_t
 
v®ueL’
 = (
št32_t
è+ 
v®ue
->
Ën
;

173 
m_bufãr
.
	`’su»
Ğ
keyL’
 + 
v®ueL’
 );

175 
m_Ï¡_key
 = (
By‹SŒšg32T
 *)
m_bufãr
.
	`addNoCheck
(
key
, 
keyL’
);

176 
m_bufãr
.
	`addNoCheck
(
v®ue
, 
v®ueL’
);

178 
m_Œa”
.
tÙ®_’Œ›s
++;

181 
	}
}

185 
	gC–lStÜeV0
::
	$fš®ize
(
Time¡amp
 &
time¡amp
) {

186 
Ev’tPŒ
 
ev’tPŒ
;

187 
”rÜ
 = -1;

188 
ušt8_t
 *
zbuf
;

189 
size_t
 
zËn
;

190 
DyÇmicBufãr
 
	`zBufãr
(0);

191 
size_t
 
Ën
;

192 
ušt8_t
 *
ba£
;

194 ià(
m_bufãr
.
	`fl
() > 0) {

195 
BlockCom´essiÚH—d”C–lStÜe
 
	`h—d”
(
DATA_BLOCK_MAGIC
);

197 
	`add_šdex_’Œy
(
m_Ï¡_key
, 
m_off£t
);

199 
m_uncom´es£d_d©a
 +ğ()
m_bufãr
.
	`fl
();

200 
m_com´essÜ
->
	`deæ©e
(
m_bufãr
, 
zBufãr
, 
h—d”
);

201 
m_com´es£d_d©a
 +ğ()
zBufãr
.
	`fl
();

202 
zbuf
 = 
zBufãr
.
	`»Ëa£
(&
zËn
);

204 ià(
m_out¡ªdšg_­³nds
 >ğ
MAX_APPENDS_OUTSTANDING
) {

205 ià(!
m_sync_hªdËr
.
	`wa™_fÜ_»¶y
(
ev’tPŒ
)) {

206 
	`HT_ERRORF
("ProbËm wr™šgØHDFS f'%s' : %s", 
m_f’ame
.
	`c_¡r
(), 
PrÙocŞ
::
	`¡ršg_fÜm©_mes§ge
(
ev’tPŒ
).c_str());

207 
abÜt
;

209 
m_out¡ªdšg_­³nds
--;

212 ià((
”rÜ
 = 
m_fesys
->
	`­³nd
(
m_fd
, 
zbuf
, 
zËn
, &
m_sync_hªdËr
)è!ğ
E¼Ü
::
OK
) {

213 
	`HT_ERRORF
("ProbËm wr™šgØHDFS f'%s' : %s", 
m_f’ame
.
	`c_¡r
(), 
PrÙocŞ
::
	`¡ršg_fÜm©_mes§ge
(
ev’tPŒ
).c_str());

214 
abÜt
;

216 
m_out¡ªdšg_­³nds
++;

217 
m_off£t
 +ğ
zËn
;

220 
m_Œa”
.
fix_šdex_off£t
 = 
m_off£t
;

221 
m_Œa”
.
time¡amp
 =imestamp;

222 
m_Œa”
.
com´essiÚ_¿tio
 = 
m_com´es£d_d©a
 / 
m_uncom´es£d_d©a
;

223 
m_Œa”
.
v”siÚ
 = 0;

228 
ba£
 = 
m_fix_šdex_bufãr
.
	`»Ëa£
(&
Ën
);

229 
m_fix_šdex_bufãr
.
	`»£rve
(
Ën
);

230 
m_fix_šdex_bufãr
.
	`addNoCheck
(
ba£
, 
Ën
);

231 
d–‘e
 [] 
ba£
;

232 
ba£
 = 
m_v¬_šdex_bufãr
.
	`»Ëa£
(&
Ën
);

233 
m_v¬_šdex_bufãr
.
	`»£rve
(
Ën
);

234 
m_v¬_šdex_bufãr
.
	`addNoCheck
(
ba£
, 
Ën
);

235 
d–‘e
 [] 
ba£
;

241 
BlockCom´essiÚH—d”C–lStÜe
 
	`h—d”
(
INDEX_FIXED_BLOCK_MAGIC
);

242 
m_com´essÜ
->
	`deæ©e
(
m_fix_šdex_bufãr
, 
zBufãr
, 
h—d”
);

243 
zbuf
 = 
zBufãr
.
	`»Ëa£
(&
zËn
);

246 ià(
m_fesys
->
	`­³nd
(
m_fd
, 
zbuf
, 
zËn
, &
m_sync_hªdËr
è!ğ
E¼Ü
::
OK
)

247 
abÜt
;

248 
m_out¡ªdšg_­³nds
++;

249 
m_off£t
 +ğ
zËn
;

255 
BlockCom´essiÚH—d”C–lStÜe
 
	`h—d”
(
INDEX_VARIABLE_BLOCK_MAGIC
);

256 
m_Œa”
.
v¬_šdex_off£t
 = 
m_off£t
;

257 
m_com´essÜ
->
	`deæ©e
(
m_v¬_šdex_bufãr
, 
zBufãr
, 
h—d”
, 
m_Œa”
.
	`size
());

263 
ušt32_t
 
off£t
;

264 
By‹SŒšg32T
 *
key
;

265 
m_fix_šdex_bufãr
.
±r
 = m_fix_šdex_bufãr.
buf
;

266 
m_v¬_šdex_bufãr
.
±r
 = m_v¬_šdex_bufãr.
buf
;

267 
size_t
 
i
=0; i<
m_Œa”
.
šdex_’Œ›s
; i++) {

269 
key
 = (
By‹SŒšg32T
 *)
m_v¬_šdex_bufãr
.
±r
;

270 
m_v¬_šdex_bufãr
.
±r
 +ğ(
št32_t
è+ 
key
->
Ën
;

272 
	`memıy
(&
off£t
, 
m_fix_šdex_bufãr
.
±r
, (offset));

273 
m_fix_šdex_bufãr
.
±r
 +ğ(
off£t
);

274 
m_šdex
.
	`š£¹
(m_šdex.
	`’d
(), 
IndexM­T
::
	`v®ue_ty³
(
key
, 
off£t
));

275 ià(
i
 =ğ
m_Œa”
.
šdex_’Œ›s
/2) {

276 
	`»cÜd_¥l™_row
((
By‹SŒšg32T
 *)
m_v¬_šdex_bufãr
.
±r
);

281 
d–‘e
 [] 
m_fix_šdex_bufãr
.
	`»Ëa£
();

284 
m_Œa”
.
f‹r_off£t
 = 
m_off£t
 + 
zBufãr
.
	`fl
();

287 
m_Œa”
.
	`£rŸlize
(
zBufãr
.
±r
);

288 
zBufãr
.
±r
 +ğ
m_Œa”
.
	`size
();

290 
zbuf
 = 
zBufãr
.
	`»Ëa£
(&
zËn
);

292 ià(
m_fesys
->
	`­³nd
(
m_fd
, 
zbuf
, 
zËn
è!ğ
E¼Ü
::
OK
)

293 
abÜt
;

294 
m_out¡ªdšg_­³nds
++;

295 
m_off£t
 +ğ
zËn
;

298 ià(
m_fesys
->
	`şo£
(
m_fd
è!ğ
E¼Ü
::
OK
)

299 
abÜt
;

302 
m_fe_Ëngth
 = 
m_off£t
;

305 ià((
”rÜ
 = 
m_fesys
->
	`İ’
(
m_f’ame
, &
m_fd
)è!ğ
E¼Ü
::
OK
)

306 
abÜt
;

308 
m_disk_u§ge
 = (
ušt32_t
)
m_fe_Ëngth
;

310 
”rÜ
 = 0;

312 
abÜt
:

313 
d–‘e
 
m_com´essÜ
;

314 
m_com´essÜ
 = 0;

316  
”rÜ
;

317 
	}
}

324 
	gC–lStÜeV0
::
	$add_šdex_’Œy
(cÚ¡ 
By‹SŒšg32T
 *
key
, 
ušt32_t
 
off£t
) {

326 
size_t
 
keyL’
 = (
št32_t
è+ 
key
->
Ën
;

327 
m_v¬_šdex_bufãr
.
	`’su»
Ğ
keyL’
 );

328 
	`memıy
(
m_v¬_šdex_bufãr
.
±r
, 
key
, 
keyL’
);

329 
m_v¬_šdex_bufãr
.
±r
 +ğ
keyL’
;

332 
m_fix_šdex_bufãr
.
	`’su»
((
off£t
));

333 
	`memıy
(
m_fix_šdex_bufãr
.
±r
, &
off£t
, (offset));

334 
m_fix_šdex_bufãr
.
±r
 +ğ(
off£t
);

336 
m_Œa”
.
šdex_’Œ›s
++;

337 
	}
}

344 
	gC–lStÜeV0
::
	$İ’
(cÚ¡ *
âame
, cÚ¡ *
¡¬t_row
, cÚ¡ *
’d_row
) {

345 
”rÜ
 = 0;

347 
m_¡¬t_row
 = (
¡¬t_row
) ? start_row : "";

348 
m_’d_row
 = (
’d_row
è?ƒnd_row : 
Key
::
END_ROW_MARKER
;

350 
m_fd
 = -1;

352 
m_f’ame
 = 
âame
;

355 ià((
”rÜ
 = 
m_fesys
->
	`Ëngth
(
m_f’ame
, (
št64_t
 *)&
m_fe_Ëngth
)è!ğ
E¼Ü
::
OK
)

356 
abÜt
;

358 ià(
m_fe_Ëngth
 < 
m_Œa”
.
	`size
()) {

359 
	`HT_ERRORF
("Bad†’gth oàC–lStÜf'%s' - %Îd", 
m_f’ame
.
	`c_¡r
(), 
m_fe_Ëngth
);

360 
abÜt
;

364 ià((
”rÜ
 = 
m_fesys
->
	`İ’
(
m_f’ame
, &
m_fd
)è!ğ
E¼Ü
::
OK
)

365 
abÜt
;

371 
ušt32_t
 
Ën
;

372 
ušt8_t
 *
Œa”_buf
 = 
Ãw
 ušt8_ˆ[ 
m_Œa”
.
	`size
() ];

374 ià((
”rÜ
 = 
m_fesys
->
	`´—d
(
m_fd
, 
m_fe_Ëngth
-
m_Œa”
.
	`size
(), m_Œa”.size(), 
Œa”_buf
, &
Ën
)è!ğ
E¼Ü
::
OK
) {

375 
	`HT_ERRORF
("ProbËm„—dšg¿” fÜ C–lStÜf'%s' - %s", 
m_f’ame
.
	`c_¡r
(), 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

376 
d–‘e
 [] 
Œa”_buf
;

377 
abÜt
;

380 ià(
Ën
 !ğ
m_Œa”
.
	`size
()) {

381 
	`HT_ERRORF
("Problem„eadingrailer for CellStore file '%s' - only„ead %d of %d bytes",

382 
m_f’ame
.
	`c_¡r
(), 
Ën
, 
m_Œa”
.
	`size
());

383 
d–‘e
 [] 
Œa”_buf
;

384 
abÜt
;

387 
m_Œa”
.
	`de£rŸlize
(
Œa”_buf
);

388 
d–‘e
 [] 
Œa”_buf
;

392 ià(
m_Œa”
.
v”siÚ
 != 0) {

393 
	`HT_ERRORF
("UnsuµÜ‹d C–lStÜv”siÚ (%dèfÜ f'%s'", 
m_Œa”
.
v”siÚ
, 
âame
);

394 
abÜt
;

396 ià(!(
m_Œa”
.
fix_šdex_off£t
 < m_Œa”.
v¬_šdex_off£t
 &&

397 
m_Œa”
.
v¬_šdex_off£t
 < 
m_fe_Ëngth
)) {

398 
	`HT_ERRORF
("Bad index offsets in CellStorerailer fix=%lld, var=%lld,†ength=%lld, file='%s'",

399 
m_Œa”
.
fix_šdex_off£t
, m_Œa”.
v¬_šdex_off£t
, 
m_fe_Ëngth
, 
âame
);

400 
abÜt
;

403  
E¼Ü
::
OK
;

405 
abÜt
:

406  
E¼Ü
::
LOCAL_IO_ERROR
;

407 
	}
}

410 
	gC–lStÜeV0
::
	$lßd_šdex
() {

411 
”rÜ
 = -1;

412 
ušt8_t
 *
buf
 = 0;

413 
ušt32_t
 
amouÁ
;

414 
ušt8_t
 *
vbuf
 = 0;

415 
ušt8_t
 *
fEnd
;

416 
ušt8_t
 *
vEnd
;

417 
ušt32_t
 
Ën
;

418 
BlockCom´essiÚH—d”C–lStÜe
 
h—d”
;

419 
DyÇmicBufãr
 
	`šput
(0);

421 
m_com´essÜ
 = 
	`ü—‹_block_com´essiÚ_codec
();

423 
amouÁ
 = (
m_fe_Ëngth
-
m_Œa”
.
	`size
()è- m_Œa”.
fix_šdex_off£t
;

424 
buf
 = 
Ãw
 
ušt8_t
 [ 
amouÁ
 ];

427 ià((
”rÜ
 = 
m_fesys
->
	`´—d
(
m_fd
, 
m_Œa”
.
fix_šdex_off£t
, 
amouÁ
, 
buf
, &
Ën
)è!ğ
E¼Ü
::
OK
)

428 
abÜt
;

430 ià(
Ën
 !ğ
amouÁ
) {

431 
	`HT_ERRORF
("ProbËm†ßdšg index fÜ C–lStÜ'%s' :r›dØ»ad %d buˆÚly gÙ %d", 
m_f’ame
.
	`c_¡r
(), 
amouÁ
, 
Ën
);

432 
abÜt
;

437 
šput
.
buf
 = buf;

438 
šput
.
±r
 = 
buf
 + (
m_Œa”
.
v¬_šdex_off£t
 - m_Œa”.
fix_šdex_off£t
);

439 ià((
”rÜ
 = 
m_com´essÜ
->
	`šæ©e
(
šput
, 
m_fix_šdex_bufãr
, 
h—d”
)è!ğ
E¼Ü
::
OK
) {

440 
	`HT_ERRORF
("Fixed index decom´essiÚƒ¼Ü - %s", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

441 
abÜt
;

443 ià(!
h—d”
.
	`check_magic
(
INDEX_FIXED_BLOCK_MAGIC
)) {

444 
”rÜ
 = 
E¼Ü
::
BLOCK_COMPRESSOR_BAD_MAGIC
;

445 
abÜt
;

449 
vbuf
 = 
buf
 + (
m_Œa”
.
v¬_šdex_off£t
-m_Œa”.
fix_šdex_off£t
);

450 
amouÁ
 = (
m_fe_Ëngth
-
m_Œa”
.
	`size
()è- m_Œa”.
v¬_šdex_off£t
;

454 
šput
.
buf
 = 
vbuf
;

455 
šput
.
±r
 = 
vbuf
 + 
amouÁ
;

456 ià((
”rÜ
 = 
m_com´essÜ
->
	`šæ©e
(
šput
, 
m_v¬_šdex_bufãr
, 
h—d”
)è!ğ
E¼Ü
::
OK
) {

457 
	`HT_ERRORF
("V¬ŸbË index decom´essiÚƒ¼Ü - %s", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

458 
abÜt
;

460 ià(!
h—d”
.
	`check_magic
(
INDEX_VARIABLE_BLOCK_MAGIC
)) {

461 
”rÜ
 = 
E¼Ü
::
BLOCK_COMPRESSOR_BAD_MAGIC
;

462 
abÜt
;

466 
m_šdex
.
	`ş—r
();

468 
By‹SŒšg32T
 *
key
;

469 
ušt32_t
 
off£t
;

472 
fEnd
 = 
m_fix_šdex_bufãr
.
±r
;

473 
m_fix_šdex_bufãr
.
±r
 = m_fix_šdex_bufãr.
buf
;

474 
vEnd
 = 
m_v¬_šdex_bufãr
.
±r
;

475 
m_v¬_šdex_bufãr
.
±r
 = m_v¬_šdex_bufãr.
buf
;

477 
size_t
 
i
=0; i< 
m_Œa”
.
šdex_’Œ›s
; i++) {

479 
	`as£¹
(
m_fix_šdex_bufãr
.
±r
 < 
fEnd
);

480 
	`as£¹
(
m_v¬_šdex_bufãr
.
±r
 < 
vEnd
);

483 
key
 = (
By‹SŒšg32T
 *)
m_v¬_šdex_bufãr
.
±r
;

484 
m_v¬_šdex_bufãr
.
±r
 +ğ(
št32_t
è+ 
key
->
Ën
;

487 
	`memıy
(&
off£t
, 
m_fix_šdex_bufãr
.
±r
, (offset));

488 
m_fix_šdex_bufãr
.
±r
 +ğ(
off£t
);

490 
m_šdex
.
	`š£¹
(m_šdex.
	`’d
(), 
IndexM­T
::
	`v®ue_ty³
(
key
, 
off£t
));

498 
ušt32_t
 
¡¬t
 = 0;

499 
ušt32_t
 
’d
 = (ušt32_t)
m_fe_Ëngth
;

500 
By‹SŒšg32T
 *
¡¬t_key
 = 
	`C»©e
(
m_¡¬t_row
.
	`c_¡r
(), 
	`¡¾’
(m_start_row.c_str()));

501 
By‹SŒšg32T
 *
’d_key
 = 
	`C»©e
(
m_’d_row
.
	`c_¡r
(), 
	`¡¾’
(m_end_row.c_str()));

502 
C–lStÜeV0
::
IndexM­T
::
cÚ¡_™”©Ü
 
™”
, 
mid_™”
, 
’d_™”
;

504 
™”
 = 
m_šdex
.
	`uµ”_bound
(
¡¬t_key
);

505 
¡¬t
 = (*
™”
).
£cÚd
;

507 ià((
’d_™”
 = 
m_šdex
.
	`low”_bound
(
’d_key
)è=ğm_šdex.
	`’d
())

508 
’d
 = 
m_fe_Ëngth
;

510 
’d
 = (*
™”
).
£cÚd
;

512 
m_disk_u§ge
 = 
’d
 - 
¡¬t
;

514 
	`De¡roy
(
¡¬t_key
);

515 
	`De¡roy
(
’d_key
);

517 
size_t
 
i
=0;

518 
mid_™”
=
™”
; i‹r!=
’d_™”
; ++™”,++
i
) {

519 ià((
i
%2)==0)

520 ++
mid_™”
;

522 ià(
mid_™”
 !ğ
m_šdex
.
	`’d
())

523 
	`»cÜd_¥l™_row
((*
mid_™”
).
fœ¡
);

527 
”rÜ
 = 0;

529 
abÜt
:

530 
šput
.
buf
 = 0;

531 
d–‘e
 
m_com´essÜ
;

532 
m_com´essÜ
 = 0;

533 
d–‘e
 [] 
m_fix_šdex_bufãr
.
	`»Ëa£
();

534 
d–‘e
 [] 
buf
;

535  
”rÜ
;

536 
	}
}

542 
	gC–lStÜeV0
::
	$di¥Ïy_block_šfo
() {

543 
By‹SŒšg32T
 *
Ï¡_key
 = 0;

544 
ušt32_t
 
Ï¡_off£t
 = 0;

545 
ušt32_t
 
block_size
;

546 
size_t
 
i
=0;

547 
IndexM­T
::
cÚ¡_™”©Ü
 
™”
 = 
m_šdex
.
	`begš
(); i‹¸!ğm_šdex.
	`’d
(); iter++) {

548 ià(
Ï¡_key
) {

549 
block_size
 = (*
™”
).
£cÚd
 - 
Ï¡_off£t
;

550 
cout
 << 
i
 << ": off£t=" << 
Ï¡_off£t
 << " size=" << 
block_size
 << "„ow=" << (cÚ¡ *)
Ï¡_key
->
d©a
 << 
’dl
;

551 
i
++;

553 
Ï¡_off£t
 = (*
™”
).
£cÚd
;

554 
Ï¡_key
 = (*
™”
).
fœ¡
;

556 ià(
Ï¡_key
) {

557 
block_size
 = 
m_Œa”
.
f‹r_off£t
 - 
Ï¡_off£t
;

558 
cout
 << 
i
 << ": off£t=" << 
Ï¡_off£t
 << " size=" << 
block_size
 << "„ow=" << (cÚ¡ *)
Ï¡_key
->
d©a
 << 
’dl
;

560 
	}
}

563 
	gC–lStÜeV0
::
	$»cÜd_¥l™_row
(cÚ¡ 
By‹SŒšg32T
 *
key
) {

564 
¡d
::
¡ršg
 
¥l™_row
 = (cÚ¡ *)
key
->
d©a
;

565 ià(
¥l™_row
 > 
m_¡¬t_row
 && s¶™_row < 
m_’d_row
)

566 
m_¥l™_row
 = 
¥l™_row
;

568 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/CellStoreV0.h

21 #iâdeà
HYPERTABLE_CELLSTOREV0_H


22 
	#HYPERTABLE_CELLSTOREV0_H


	)

24 
	~<m­
>

25 
	~<¡ršg
>

26 
	~<veùÜ
>

28 
	~"AsyncComm/Di¥©chHªdËrSynchrÚiz”.h
"

29 
	~"CommÚ/DyÇmicBufãr.h
"

31 
	~"Hy³¹abË/Lib/BlockCom´essiÚCodec.h
"

32 
	~"Hy³¹abË/Lib/Fesy¡em.h
"

34 
	~"C–lStÜe.h
"

35 
	~"C–lStÜeT¿”V0.h
"

37 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

42 
Çme¥aû
 
	gHy³¹abË
 {

43 
şass
 
	gBlockCom´essiÚCodec
;

44 
şass
 
	gCl›Á
;

45 
şass
 
	gPrÙocŞ
;

48 
Çme¥aû
 
	gHy³¹abË
 {

50 şas 
	cC–lStÜeV0
 : 
public
 
C–lStÜe
 {

52 
public
:

54 
C–lStÜeV0
(
Fesy¡em
 *
fesys
);

55 
	gvœtu®
 ~
C–lStÜeV0
();

57 
vœtu®
 
ü—‹
(cÚ¡ *
âame
, 
ušt32_t
 
blocksize
, cÚ¡ 
¡d
::
¡ršg
 &
com´essÜ
);

58 
vœtu®
 
add
(cÚ¡ 
By‹SŒšg32T
 *
key
, cÚ¡ By‹SŒšg32T *
v®ue
, 
ušt64_t
 
»®_time¡amp
);

59 
vœtu®
 
fš®ize
(
Time¡amp
 &
time¡amp
);

60 
vœtu®
 
İ’
(cÚ¡ *
âame
, cÚ¡ *
¡¬t_row
, cÚ¡ *
’d_row
);

61 
vœtu®
 
lßd_šdex
();

62 
vœtu®
 
ušt32_t
 
g‘_blocksize
(è{  
	gm_Œa”
.
	gblocksize
; }

63 
vœtu®
 
g‘_time¡amp
(
Time¡amp
 &
time¡amp
);

64 
vœtu®
 
ušt64_t
 
disk_u§ge
(è{  
	gm_disk_u§ge
; }

65 
vœtu®
 
com´essiÚ_¿tio
(è{  
	gm_Œa”
.
	gcom´essiÚ_¿tio
; }

66 
vœtu®
 cÚ¡ *
g‘_¥l™_row
();

67 
vœtu®
 
	g¡d
::
¡ršg
 &
g‘_f’ame
(è{  
m_f’ame
; }

68 
vœtu®
 
C–lLi¡SÿÂ”
 *
ü—‹_sÿÂ”
(
SÿnCÚ‹xtPŒ
 &
sÿnCÚ‹xtPŒ
);

70 
BlockCom´essiÚCodec
 *
ü—‹_block_com´essiÚ_codec
();

75 
di¥Ïy_block_šfo
();

77 
ä›nd
 
şass
 
	gC–lStÜeSÿÂ”V0
;

79 
vœtu®
 
C–lStÜeT¿”
 *
g‘_Œa”
(è{  &
	gm_Œa”
; }

81 
	g´Ùeùed
:

83 
add_šdex_’Œy
(cÚ¡ 
By‹SŒšg32T
 *
key
, 
ušt32_t
 
off£t
);

84 
»cÜd_¥l™_row
(cÚ¡ 
By‹SŒšg32T
 *
key
);

86 cÚ¡ 
	gDATA_BLOCK_MAGIC
[10];

87 cÚ¡ 
	gINDEX_FIXED_BLOCK_MAGIC
[10];

88 cÚ¡ 
	gINDEX_VARIABLE_BLOCK_MAGIC
[10];

90 
	gm­
<
	tBy‹SŒšg32T
 *, 
	tušt32_t
, 
	tÉBy‹SŒšg32
> 
	tIndexM­T
;

92 
Fesy¡em
 *
	gm_fesys
;

93 
	g¡d
::
¡ršg
 
m_f’ame
;

94 
št32_t
 
	gm_fd
;

95 
IndexM­T
 
	gm_šdex
;

96 
C–lStÜeT¿”V0
 
	gm_Œa”
;

97 
BlockCom´essiÚCodec
 *
	gm_com´essÜ
;

98 
DyÇmicBufãr
 
	gm_bufãr
;

99 
DyÇmicBufãr
 
	gm_fix_šdex_bufãr
;

100 
DyÇmicBufãr
 
	gm_v¬_šdex_bufãr
;

101 
Di¥©chHªdËrSynchrÚiz”
 
	gm_sync_hªdËr
;

102 
ušt32_t
 
	gm_out¡ªdšg_­³nds
;

103 
ušt32_t
 
	gm_off£t
;

104 
By‹SŒšg32T
 *
	gm_Ï¡_key
;

105 
ušt64_t
 
	gm_fe_Ëngth
;

106 
ušt32_t
 
	gm_disk_u§ge
;

107 
	g¡d
::
¡ršg
 
m_¥l™_row
;

108 
	gm_fe_id
;

109 
	gm_uncom´es£d_d©a
;

110 
	gm_com´es£d_d©a
;

111 
ušt32_t
 
	gm_uncom´es£d_blocksize
;

112 
	gBlockCom´essiÚCodec
::
Args
 
m_com´essÜ_¬gs
;

114 
	gboo¡
::
	tšŒusive_±r
<
	tC–lStÜeV0
> 
	tC–lStÜeV0PŒ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/ConnectionHandler.cc

20 
	~<io¡»am
>

23 
	~<pŞl.h
>

26 
	~"CommÚ/E¼Ü.h
"

27 
	~"CommÚ/Exû±iÚ.h
"

28 
	~"CommÚ/SŒšgExt.h
"

30 
	~"AsyncComm/AµliÿtiÚQueue.h
"

31 
	~"AsyncComm/Re¥Ú£C®lback.h
"

33 
	~"Hy³¹abË/Lib/Ma¡”Cl›Á.h
"

34 
	~"Hy³¹abË/Lib/RªgeS”v”PrÙocŞ.h
"

36 
	~"Reque¡HªdËrCom·ù.h
"

37 
	~"Reque¡HªdËrDe¡roySÿÂ”.h
"

38 
	~"Reque¡HªdËrDumpSts.h
"

39 
	~"Reque¡HªdËrLßdRªge.h
"

40 
	~"Reque¡HªdËrUpd©e.h
"

41 
	~"Reque¡HªdËrC»©eSÿÂ”.h
"

42 
	~"Reque¡HªdËrF‘chSÿnblock.h
"

43 
	~"Reque¡HªdËrDrİTabË.h
"

44 
	~"Reque¡HªdËrStus.h
"

46 
	~"CÚÃùiÚHªdËr.h
"

47 
	~"Ev’tHªdËrMa¡”CÚÃùiÚ.h
"

48 
	~"RªgeS”v”.h
"

51 
usšg
 
Çme¥aû
 
Hy³¹abË
;

56 
	gCÚÃùiÚHªdËr
::
	$CÚÃùiÚHªdËr
(
Comm
 *
comm
, 
AµliÿtiÚQueuePŒ
 &
­pQueuePŒ
, 
RªgeS”v”PŒ
 
¿ngeS”v”PŒ
, 
Ma¡”Cl›ÁPŒ
 &
ma¡”Cl›ÁPŒ
è: 
	`m_comm
(comm), 
	`m_­p_queue_±r
×µQueuePŒ), 
	`m_¿nge_£rv”_±r
ÔªgeS”v”PŒ), 
	`m_ma¡”_ş›Á_±r
(ma¡”Cl›ÁPŒ), 
	$m_shutdown
(
çl£
) {

58 
	}
}

63 
	gCÚÃùiÚHªdËr
::
	$CÚÃùiÚHªdËr
(
Comm
 *
comm
, 
AµliÿtiÚQueuePŒ
 &
­pQueuePŒ
, 
RªgeS”v”PŒ
 
¿ngeS”v”PŒ
è: 
	`m_comm
(comm), 
	`m_­p_queue_±r
×µQueuePŒ), 
	`m_¿nge_£rv”_±r
ÔªgeS”v”PŒ), 
	$m_shutdown
(
çl£
) {

65 
	}
}

71 
	gCÚÃùiÚHªdËr
::
	$hªdË
(
Ev’tPŒ
 &
ev’tPŒ
) {

72 
commªd
 = -1;

74 ià(
m_shutdown
)

77 ià(
ev’tPŒ
->
ty³
 =ğ
Ev’t
::
MESSAGE
) {

78 
AµliÿtiÚHªdËr
 *
»que¡HªdËr
 = 0;

82 
Œy
 {

83 ià(
ev’tPŒ
->
mes§geL’
 < (
št16_t
)) {

84 
¡d
::
¡ršg
 
mes§ge
 = "Truncated Request";

85 
throw
 
Ãw
 
	`PrÙocŞExû±iÚ
(
mes§ge
);

87 
	`memıy
(&
commªd
, 
ev’tPŒ
->
mes§ge
, (
št16_t
));

90 ià(
commªd
 < 0 || commªd >ğ
RªgeS”v”PrÙocŞ
::
COMMAND_MAX
) {

91 
¡d
::
¡ršg
 
mes§ge
 = (¡d::¡ršg)"Inv®id commªd (" + 
commªd
 + ")";

92 
throw
 
	`PrÙocŞExû±iÚ
(
mes§ge
);

95 
commªd
) {

96 
RªgeS”v”PrÙocŞ
::
COMMAND_COMPACT
:

97 
»que¡HªdËr
 = 
Ãw
 
	`Reque¡HªdËrCom·ù
(
m_comm
, 
m_¿nge_£rv”_±r
.
	`g‘
(), 
ev’tPŒ
);

99 
RªgeS”v”PrÙocŞ
::
COMMAND_LOAD_RANGE
:

100 
»que¡HªdËr
 = 
Ãw
 
	`Reque¡HªdËrLßdRªge
(
m_comm
, 
m_¿nge_£rv”_±r
.
	`g‘
(), 
ev’tPŒ
);

102 
RªgeS”v”PrÙocŞ
::
COMMAND_UPDATE
:

103 
»que¡HªdËr
 = 
Ãw
 
	`Reque¡HªdËrUpd©e
(
m_comm
, 
m_¿nge_£rv”_±r
.
	`g‘
(), 
ev’tPŒ
);

105 
RªgeS”v”PrÙocŞ
::
COMMAND_CREATE_SCANNER
:

106 
»que¡HªdËr
 = 
Ãw
 
	`Reque¡HªdËrC»©eSÿÂ”
(
m_comm
, 
m_¿nge_£rv”_±r
.
	`g‘
(), 
ev’tPŒ
);

108 
RªgeS”v”PrÙocŞ
::
COMMAND_DESTROY_SCANNER
:

109 
»que¡HªdËr
 = 
Ãw
 
	`Reque¡HªdËrDe¡roySÿÂ”
(
m_comm
, 
m_¿nge_£rv”_±r
.
	`g‘
(), 
ev’tPŒ
);

111 
RªgeS”v”PrÙocŞ
::
COMMAND_FETCH_SCANBLOCK
:

112 
»que¡HªdËr
 = 
Ãw
 
	`Reque¡HªdËrF‘chSÿnblock
(
m_comm
, 
m_¿nge_£rv”_±r
.
	`g‘
(), 
ev’tPŒ
);

114 
RªgeS”v”PrÙocŞ
::
COMMAND_DROP_TABLE
:

115 
»que¡HªdËr
 = 
Ãw
 
	`Reque¡HªdËrDrİTabË
(
m_comm
, 
m_¿nge_£rv”_±r
.
	`g‘
(), 
ev’tPŒ
);

117 
RªgeS”v”PrÙocŞ
::
COMMAND_STATUS
:

118 
»que¡HªdËr
 = 
Ãw
 
	`Reque¡HªdËrStus
(
m_comm
, 
m_¿nge_£rv”_±r
.
	`g‘
(), 
ev’tPŒ
);

120 
RªgeS”v”PrÙocŞ
::
COMMAND_SHUTDOWN
:

121 
m_shutdown
 = 
Œue
;

122 
	`HT_INFO
("Executing SHUTDOWN command.");

124 
Re¥Ú£C®lback
 
	`cb
(
m_comm
, 
ev’tPŒ
);

125 
cb
.
	`»¥Ú£_ok
();

127 
m_­p_queue_±r
->
	`shutdown
();

128 
m_­p_queue_±r
->
	`još
();

129 
m_­p_queue_±r
 = 0;

130 
m_¿nge_£rv”_±r
 = 0;

131 
m_ma¡”_ş›Á_±r
 = 0;

133 
RªgeS”v”PrÙocŞ
::
COMMAND_DUMP_STATS
:

134 
»que¡HªdËr
 = 
Ãw
 
	`Reque¡HªdËrDumpSts
(
m_comm
, 
m_¿nge_£rv”_±r
.
	`g‘
(), 
ev’tPŒ
);

137 
¡d
::
¡ršg
 
mes§ge
 = (¡ršg)"Commªd cod" + 
commªd
 + "‚ot implemented";

138 
throw
 
	`PrÙocŞExû±iÚ
(
mes§ge
);

140 
m_­p_queue_±r
->
	`add
Ğ
»que¡HªdËr
 );

142 
	`ÿtch
 (
PrÙocŞExû±iÚ
 &
e
) {

143 
Re¥Ú£C®lback
 
	`cb
(
m_comm
, 
ev’tPŒ
);

144 
¡d
::
¡ršg
 
”rMsg
 = 
e
.
	`wh©
();

145 
	`HT_ERRORF
("PrÙocŞƒ¼Ü '%s'", 
e
.
	`wh©
());

146 
cb
.
	`”rÜ
(
E¼Ü
::
PROTOCOL_ERROR
, 
”rMsg
);

149 ià(
ev’tPŒ
->
ty³
 =ğ
Ev’t
::
CONNECTION_ESTABLISHED
) {

151 
	`HT_INFOF
("%s", 
ev’tPŒ
->
	`toSŒšg
().
	`c_¡r
());

157 ià(
m_ma¡”_ş›Á_±r
)

158 
m_­p_queue_±r
->
	`add
Ğ
Ãw
 
	`Ev’tHªdËrMa¡”CÚÃùiÚ
(
m_ma¡”_ş›Á_±r
, 
m_¿nge_£rv”_±r
->
	`g‘_loÿtiÚ
(), 
ev’tPŒ
) );

161 
	`HT_INFOF
("%s", 
ev’tPŒ
->
	`toSŒšg
().
	`c_¡r
());

164 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/ConnectionHandler.h

21 #iâdeà
HYPERTABLE_RANGESERVER_CONNECTIONHANDLER_H


22 
	#HYPERTABLE_RANGESERVER_CONNECTIONHANDLER_H


	)

24 
	~"AsyncComm/AµliÿtiÚQueue.h
"

25 
	~"AsyncComm/Di¥©chHªdËr.h
"

27 
	~"Hy³¹abË/Lib/Ma¡”Cl›Á.h
"

29 
	~"RªgeS”v”.h
"

31 
Çme¥aû
 
	gHy³¹abË
 {

33 
şass
 
	gComm
;

37 şas 
	cCÚÃùiÚHªdËr
 : 
public
 
Di¥©chHªdËr
 {

38 
public
:

40 
CÚÃùiÚHªdËr
(
Comm
 *
comm
, 
AµliÿtiÚQueuePŒ
 &
­pQueue
, 
RªgeS”v”PŒ
 
¿ngeS”v”PŒ
, 
Ma¡”Cl›ÁPŒ
 &
ma¡”Cl›ÁPŒ
);

41 
CÚÃùiÚHªdËr
(
Comm
 *
comm
, 
AµliÿtiÚQueuePŒ
 &
­pQueue
, 
RªgeS”v”PŒ
 
¿ngeS”v”PŒ
);

43 
vœtu®
 
hªdË
(
Ev’tPŒ
 &
ev’tPŒ
);

45 
	g´iv©e
:

46 
Comm
 *
m_comm
;

47 
AµliÿtiÚQueuePŒ
 
	gm_­p_queue_±r
;

48 
RªgeS”v”PŒ
 
	gm_¿nge_£rv”_±r
;

49 
Ma¡”Cl›ÁPŒ
 
	gm_ma¡”_ş›Á_±r
;

50 
boŞ
 
	gm_shutdown
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/EventHandlerMasterConnection.cc

20 
	~<io¡»am
>

22 
	~"CommÚ/E¼Ü.h
"

23 
	~"CommÚ/Logg”.h
"

25 
	~"Hy³¹abË/Lib/Ma¡”Cl›Á.h
"

27 
	~"Ev’tHªdËrMa¡”CÚÃùiÚ.h
"

29 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

34 
	gEv’tHªdËrMa¡”CÚÃùiÚ
::
	$run
() {

35 
”rÜ
;

37 ià((
”rÜ
 = 
m_ma¡”_ş›Á_±r
->
	`»gi¡”_£rv”
Ğ
m_loÿtiÚ
 )è!ğ
E¼Ü
::
OK
) {

38 
	`HT_ERRORF
("ProbËm„egi¡”šg our£lve (%sèw™hhMa¡” - %s", 
m_loÿtiÚ
.
	`c_¡r
(), 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

42 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/EventHandlerMasterConnection.h

21 #iâdeà
HYPERTABLE_EVENTHANDLERMASTERCONNECTION_H


22 
	#HYPERTABLE_EVENTHANDLERMASTERCONNECTION_H


	)

24 
	~"AsyncComm/AµliÿtiÚHªdËr.h
"

26 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

28 
Çme¥aû
 
	gHy³¹abË
 {

30 
şass
 
	gMa¡”Cl›Á
;

32 şas 
	cEv’tHªdËrMa¡”CÚÃùiÚ
 : 
public
 
AµliÿtiÚHªdËr
 {

33 
public
:

34 
Ev’tHªdËrMa¡”CÚÃùiÚ
(
Ma¡”Cl›ÁPŒ
 &
ma¡”Cl›ÁPŒ
, 
¡d
::
¡ršg
 &
loÿtiÚ
, 
Ev’tPŒ
 &
ev’tPŒ
è: 
AµliÿtiÚHªdËr
Óv’tPŒ), 
m_ma¡”_ş›Á_±r
(ma¡”Cl›ÁPŒ), 
m_loÿtiÚ
(location) {

38 
vœtu®
 
run
();

40 
	g´iv©e
:

41 
Ma¡”Cl›ÁPŒ
 
m_ma¡”_ş›Á_±r
;

42 
	g¡d
::
¡ršg
 
m_loÿtiÚ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/FileBlockCache.cc

20 
	~<ÿs£¹
>

22 
	~"FeBlockCache.h
"

24 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

26 
©omic_t
 
	gFeBlockCache
::
ms_Ãxt_fe_id
 = 
ATOMIC_INIT
(0);

29 
	gFeBlockCache
::~
	$FeBlockCache
() {

30 
BlockM­T
::
™”©Ü
 
™”
 = 
m_block_m­
.
	`begš
(); i‹¸!ğm_block_m­.
	`’d
(); iter++) {

31 
d–‘e
 [] (*
™”
).
£cÚd
->
block
;

32 
	`d–‘e
 (*
™”
).
£cÚd
;

34 
	}
}

36 
boŞ
 
	gFeBlockCache
::
	$checkout
(
feId
, 
ušt32_t
 
off£t
, 
ušt8_t
 **
blockp
, ušt32_ˆ*
Ëngthp
) {

37 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

38 
CacheKeyT
 
key
;

39 
BlockM­T
::
™”©Ü
 
™”
;

41 
key
.
feId
 = fileId;

42 
key
.
off£t
 = offset;

44 ià((
™”
 = 
m_block_m­
.
	`fšd
(
key
)è=ğm_block_m­.
	`’d
())

45  
çl£
;

47 
	`move_to_h—d
((*
™”
).
£cÚd
);

49 (*
™”
).
£cÚd
->
»fCouÁ
++;

51 *
blockp
 = (*
™”
).
£cÚd
->
block
;

52 *
Ëngthp
 = (*
™”
).
£cÚd
->
Ëngth
;

53  
Œue
;

54 
	}
}

57 
	gFeBlockCache
::
	$checkš
(
feId
, 
ušt32_t
 
off£t
) {

58 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

59 
CacheKeyT
 
key
;

60 
BlockM­T
::
™”©Ü
 
™”
;

62 
key
.
feId
 = fileId;

63 
key
.
off£t
 = offset;

65 
™”
 = 
m_block_m­
.
	`fšd
(
key
);

67 
	`as£¹
(
™”
 !ğ
m_block_m­
.
	`’d
(è&& (*™”).
£cÚd
->
»fCouÁ
 > 0);

69 (*
™”
).
£cÚd
->
»fCouÁ
--;

70 
	}
}

73 
boŞ
 
	gFeBlockCache
::
	$š£¹_ªd_checkout
(
feId
, 
ušt32_t
 
off£t
, 
ušt8_t
 *
block
, ušt32_ˆ
Ëngth
) {

74 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

75 
CacheV®ueT
 *
ÿcheV®ue
 = 
Ãw
 CacheValueT;

76 
BlockM­T
::
™”©Ü
 
™”
;

78 
ÿcheV®ue
->
key
.
feId
 = fileId;

79 
ÿcheV®ue
->
key
.
off£t
 = offset;

81 ià((
™”
 = 
m_block_m­
.
	`fšd
(
ÿcheV®ue
->
key
)è!ğm_block_m­.
	`’d
()) {

82 
	`move_to_h—d
((*
™”
).
£cÚd
);

83 
d–‘e
 
ÿcheV®ue
;

84  
çl£
;

87 
ÿcheV®ue
->
block
 = block;

88 
ÿcheV®ue
->
Ëngth
 =†ength;

89 
ÿcheV®ue
->
»fCouÁ
 = 1;

91 ià(
m_h—d
 == 0) {

92 
ÿcheV®ue
->
Ãxt
 = cacheV®ue->
´ev
 = 0;

93 
m_h—d
 = 
m_
 = 
ÿcheV®ue
;

96 
m_h—d
->
Ãxt
 = 
ÿcheV®ue
;

97 
ÿcheV®ue
->
´ev
 = 
m_h—d
;

98 
ÿcheV®ue
->
Ãxt
 = 0;

99 
m_h—d
 = 
ÿcheV®ue
;

102 
m_block_m­
[
ÿcheV®ue
->
key
] = cacheValue;

103  
Œue
;

104 
	}
}

107 
	gFeBlockCache
::
	$move_to_h—d
(
CacheV®ueT
 *
ÿcheV®ue
) {

109 ià(
m_h—d
 =ğ
ÿcheV®ue
)

112 
ÿcheV®ue
->
Ãxt
->
´ev
 = cacheValue->prev;

113 ià(
ÿcheV®ue
->
´ev
 == 0)

114 
m_
 = 
ÿcheV®ue
->
Ãxt
;

116 
ÿcheV®ue
->
´ev
->
Ãxt
 = cacheValue->next;

118 
ÿcheV®ue
->
Ãxt
 = 0;

119 
m_h—d
->
Ãxt
 = 
ÿcheV®ue
;

120 
ÿcheV®ue
->
´ev
 = 
m_h—d
;

121 
m_h—d
 = 
ÿcheV®ue
;

122 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/FileBlockCache.h

20 #iâdeà
HYPERTABLE_FILEBLOCKCACHE_H


21 
	#HYPERTABLE_FILEBLOCKCACHE_H


	)

23 
	~<boo¡/th»ad/mu‹x.hµ
>

25 
	~<ext/hash_m­
>

27 
	~"CommÚ/©omic.h
"

29 
Çme¥aû
 
	gHy³¹abË
 {

31 şas 
	cFeBlockCache
 {

34 
	gfeId
;

35 
ušt32_t
 
	goff£t
;

36 } 
	tCacheKeyT
;

38 
	sÿche_v®ue
 {

39 
CacheKeyT
 
	gkey
;

40 
ÿche_v®ue
 *
	g´ev
;

41 
ÿche_v®ue
 *
	gÃxt
;

42 
ušt8_t
 *
	gblock
;

43 
ušt32_t
 
	gËngth
;

44 
ušt32_t
 
	g»fCouÁ
;

45 } 
	tCacheV®ueT
;

47 
©omic_t
 
	gms_Ãxt_fe_id
;

49 
	gpublic
:

51 
FeBlockCache
(
ušt64_t
 
maxMemÜy
è: 
m_mu‹x
(), 
m_block_m­
(), 
m_h—d
(0), 
m_
(0) { ; }

52 ~
FeBlockCache
();

53 
boŞ
 
checkout
(
feId
, 
ušt32_t
 
off£t
, 
ušt8_t
 **
blockp
, ušt32_ˆ*
Ëngthp
);

54 
checkš
(
feId
, 
ušt32_t
 
off£t
);

55 
boŞ
 
š£¹_ªd_checkout
(
feId
, 
ušt32_t
 
off£t
, 
ušt8_t
 *
block
, ušt32_ˆ
Ëngth
);

57 
g‘_Ãxt_fe_id
() {

58  
©omic_šc_»tuº
(&
ms_Ãxt_fe_id
);

61 
	g´iv©e
:

63 
move_to_h—d
(
CacheV®ueT
 *
ÿcheV®ue
);

65 
	shashCacheKey
 {

66 
size_t
 
İ”©Ü
()ĞcÚ¡ 
	gCacheKeyT
 &
	gkey
 ) const {

67  
	gkey
.
	gfeId
 ^ key.
	goff£t
;

71 
	seqCacheKey
 {

72 
boŞ
 
İ”©Ü
()(cÚ¡ 
	gCacheKeyT
 &
	gk1
, cÚ¡ CacheKeyT &
	gk2
) const {

73  
	gk1
.
	gfeId
 =ğ
k2
.
feId
 && 
k1
.
off£t
 == k2.offset;

77 
	g__gnu_cxx
::
	thash_m­
<
	tCacheKeyT
, 
	tCacheV®ueT
 *, 
	thashCacheKey
, 
	teqCacheKey
> 
	tBlockM­T
;

79 
	gboo¡
::
mu‹x
 
m_mu‹x
;

80 
BlockM­T
 
	gm_block_m­
;

81 
CacheV®ueT
 *
	gm_h—d
;

82 
CacheV®ueT
 *
	gm_
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/FillScanBlock.cc

22 
	~<¡dšt.h
>

25 
	~"FlSÿnBlock.h
"

27 
Çme¥aû
 
Hy³¹abË
 {

29 
boŞ
 
FlSÿnBlock
(
C–lLi¡SÿÂ”PŒ
 &
sÿÂ”PŒ
, 
ušt8_t
 *
d¡
, 
size_t
 
d¡L’
, 
ušt32_t
 *
ËÅ
) {

30 
ušt8_t
 *
±r
 = 
d¡
;

31 
ušt8_t
 *
’d
 = 
d¡
 + 
d¡L’
;

32 
By‹SŒšg32T
 *
key
;

33 
By‹SŒšg32T
 *
v®ue
;

34 
boŞ
 
mÜe
 = 
Œue
;

36 (
mÜe
 = 
sÿÂ”PŒ
->
g‘
(&
key
, &
v®ue
))) {

37 ià((
size_t
)(
’d
-
±r
è>ğ
L’gth
(
key
è+ L’gth(
v®ue
)) {

38 
memıy
(
±r
, 
key
, 
L’gth
(key));

39 
±r
 +ğ
L’gth
(
key
);

40 
memıy
(
±r
, 
v®ue
, 
L’gth
(value));

41 
±r
 +ğ
L’gth
(
v®ue
);

42 
sÿÂ”PŒ
->
fÜw¬d
();

48 *
ËÅ
 = 
±r
 - 
d¡
;

50  
mÜe
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/FillScanBlock.h

20 #iâdeà
HYPERTABLE_FILLSCANBLOCK_H


21 
	#HYPERTABLE_FILLSCANBLOCK_H


	)

23 
	~"C–lLi¡SÿÂ”.h
"

25 
Çme¥aû
 
	gHy³¹abË
 {

27 
boŞ
 
FlSÿnBlock
(
C–lLi¡SÿÂ”PŒ
 &
sÿÂ”PŒ
, 
ušt8_t
 *
d¡
, 
size_t
 
d¡L’
, 
ušt32_t
 *
ËÅ
);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/Global.cc

21 
	~<ÿs£¹
>

23 
	~"AsyncComm/AµliÿtiÚQueue.h
"

25 
	~"Glob®.h
"

27 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

29 
Çme¥aû
 
	gHy³¹abË
 {

31 
SessiÚPŒ
 
	gGlob®
::
hy³r¥aû_±r
 = 0;

32 
Fesy¡em
 *
	gGlob®
::
dfs
 = 0;

33 
Fesy¡em
 *
	gGlob®
::
logDfs
 = 0;

34 
Maš‹ÇnûQueue
 *
	gGlob®
::
maš‹Çnû_queue
 = 0;

35 
RªgeS”v”PrÙocŞ
 *
	gGlob®
::
´ÙocŞ
 = 0;

36 
boŞ
 
	gGlob®
::
v”bo£
 = 
çl£
;

37 
Comm™Log
 *
	gGlob®
::
log
 = 0;

38 
	g¡d
::
¡ršg
 
Glob®
::
logDœ
 = "";

39 
ušt64_t
 
	gGlob®
::
¿ngeMaxBy‹s
 = 0;

40 
št32_t
 
	gGlob®
::
loÿl™yGroupMaxFes
 = 0;

41 
št32_t
 
	gGlob®
::
loÿl™yGroupM”geFes
 = 0;

42 
št32_t
 
	gGlob®
::
loÿl™yGroupMaxMemÜy
 = 0;

43 
SÿÂ”M­
 
	gGlob®
::
sÿÂ”M­
;

44 
FeBlockCache
 *
	gGlob®
::
blockCache
 = 0;

45 
TabËPŒ
 
	gGlob®
::
m‘ad©a_bË_±r
 = 0;

46 
ušt64_t
 
	gGlob®
::
¿nge_m‘ad©a_max_by‹s
 = 0;

47 
MemÜyT¿ck”
 
	gGlob®
::
memÜy_Œack”
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/Global.h

20 #iâdeà
HYPERTABLE_RANGESERVER_GLOBAL_H


21 
	#HYPERTABLE_RANGESERVER_GLOBAL_H


	)

23 
	~<¡ršg
>

24 
	~<vk.h
>

26 
	~<boo¡/th»ad/mu‹x.hµ
>

27 
	~<boo¡/th»ad/th»ad.hµ
>

29 
	~"CommÚ/Prİ”t›s.h
"

30 
	~"AsyncComm/Comm.h
"

31 
	~"Hy³r¥aû/SessiÚ.h
"

32 
	~"Hy³¹abË/Lib/Comm™Log.h
"

33 
	~"Hy³¹abË/Lib/RªgeS”v”Cl›Á.h
"

34 
	~"Hy³¹abË/Lib/RªgeS”v”PrÙocŞ.h
"

35 
	~"Hy³¹abË/Lib/Schema.h
"

36 
	~"Hy³¹abË/Lib/Fesy¡em.h
"

37 
	~"Hy³¹abË/Lib/TabË.h
"

38 
	~"Hy³¹abË/Lib/Ty³s.h
"

40 
	~"FeBlockCache.h
"

41 
	~"Maš‹ÇnûQueue.h
"

42 
	~"MemÜyT¿ck”.h
"

43 
	~"SÿÂ”M­.h
"

44 
	~"TabËInfo.h
"

46 
Çme¥aû
 
	gHy³¹abË
 {

48 
şass
 
	gAµliÿtiÚQueue
;

50 şas 
	cGlob®
 {

51 
	gpublic
:

52 
Hy³r¥aû
::
SessiÚPŒ
 
hy³r¥aû_±r
;

53 
	gHy³¹abË
::
Fesy¡em
 *
dfs
;

54 
	gHy³¹abË
::
Fesy¡em
 *
logDfs
;

55 
	gHy³¹abË
::
Maš‹ÇnûQueue
 *
maš‹Çnû_queue
;

56 
	gHy³¹abË
::
RªgeS”v”PrÙocŞ
 *
´ÙocŞ
;

57 
boŞ
 
	gv”bo£
;

58 
Comm™Log
 *
	glog
;

59 
	g¡d
::
¡ršg
 
logDœ
;

60 
ušt64_t
 
	g¿ngeMaxBy‹s
;

61 
št32_t
 
	gloÿl™yGroupMaxFes
;

62 
št32_t
 
	gloÿl™yGroupM”geFes
;

63 
št32_t
 
	gloÿl™yGroupMaxMemÜy
;

64 
SÿÂ”M­
 
	gsÿÂ”M­
;

65 
	gHy³¹abË
::
FeBlockCache
 *
blockCache
;

66 
TabËPŒ
 
	gm‘ad©a_bË_±r
;

67 
ušt64_t
 
	g¿nge_m‘ad©a_max_by‹s
;

68 
	gHy³¹abË
::
MemÜyT¿ck”
 
memÜy_Œack”
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/HandlerFactory.h

21 #iâdeà
HYPERTABLE_HANDLERFACTORY_H


22 
	#HYPERTABLE_HANDLERFACTORY_H


	)

24 
	~"AsyncComm/AµliÿtiÚQueue.h
"

26 
	~"CÚÃùiÚHªdËr.h
"

27 
	~"RªgeS”v”.h
"

30 
Çme¥aû
 
	gHy³¹abË
 {

32 
şass
 
	gComm
;

37 şas 
	cHªdËrFaùÜy
 : 
public
 
CÚÃùiÚHªdËrFaùÜy
 {

38 
public
:

39 
HªdËrFaùÜy
(
Comm
 *
comm
, 
AµliÿtiÚQueuePŒ
 &
­pQueuePŒ
, 
RªgeS”v”PŒ
 
¿ngeS”v”PŒ
è: 
m_comm
(comm), 
m_­p_queue_±r
×µQueuePŒ), 
m_¿nge_£rv”_±r
(rangeServerPtr) { ; }

40 
vœtu®
 
g‘_š¡ªû
(
Di¥©chHªdËrPŒ
 &
dhp
) {

41 
	gdhp
 = 
Ãw
 
CÚÃùiÚHªdËr
(
m_comm
, 
m_­p_queue_±r
, 
m_¿nge_£rv”_±r
);

43 
	g´iv©e
:

44 
Comm
 *
m_comm
;

45 
AµliÿtiÚQueuePŒ
 
	gm_­p_queue_±r
;

46 
RªgeS”v”PŒ
 
	gm_¿nge_£rv”_±r
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/HyperspaceSessionHandler.cc

21 
	~"Hy³r¥aûSessiÚHªdËr.h
"

23 
usšg
 
Çme¥aû
 
	gHy³r¥aû
;

28 
	gHy³r¥aûSessiÚHªdËr
::
	$§ã
() {

29 
	`HT_INFO
("Hyperspace session state change: SAFE");

30 
	}
}

35 
	gHy³r¥aûSessiÚHªdËr
::
	$jeİ¬dy
() {

36 
	`HT_INFO
("Hyperspace session state change: JEOPARDY");

37 
	}
}

42 
	gHy³r¥aûSessiÚHªdËr
::
	$expœed
() {

43 
	`HT_ERROR
("Hyperspace sessionƒxpired. Exiting...");

44 
	`ex™
(1);

45 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/HyperspaceSessionHandler.h

21 #iâdeà
HYPERTABLE_HYPERSPACESESSIONHANDLER_H


22 
	#HYPERTABLE_HYPERSPACESESSIONHANDLER_H


	)

24 
	~"Hy³r¥aû/SessiÚ.h
"

26 
usšg
 
Çme¥aû
 
	gHy³r¥aû
;

28 
Çme¥aû
 
	gHy³¹abË
 {

30 
şass
 
	gRªgeS”v”
;

35 şas 
	cHy³r¥aûSessiÚHªdËr
 : 
public
 
SessiÚC®lback
 {

36 
public
:

37 
vœtu®
 
§ã
();

38 
vœtu®
 
expœed
();

39 
vœtu®
 
jeİ¬dy
();

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/MaintenanceQueue.h

21 #iâdeà
HYPERTABLE_MAINTENANCEQUEUE_H


22 
	#HYPERTABLE_MAINTENANCEQUEUE_H


	)

24 
	~<ÿs£¹
>

26 
	~"Maš‹ÇnûTask.h
"

28 
Çme¥aû
 
	gHy³¹abË
 {

32 şas 
	cMaš‹ÇnûQueue
 : 
public
 
Reã»nûCouÁ
 {

34 
	sÉMaš‹ÇnûTask
 {

35 
boŞ
 
İ”©Ü
()(cÚ¡ 
Maš‹ÇnûTask
 *
sm1
, cÚ¡ Maš‹ÇnûTask *
	gsm2
) const {

36  
xtime_cmp
(
sm1
->
¡¬t_time
, 
sm2
->start_time) >= 0;

40 
	g¡d
::
	t´iÜ™y_queue
<
	tMaš‹ÇnûTask
 *, 
	t¡d
::
	tveùÜ
<Maš‹ÇnûTask *>, 
	tÉMaš‹ÇnûTask
> 
	tMaš‹ÇnûQueueT
;

42 şas 
	cMaš‹ÇnûQueueS‹
 {

43 
	gpublic
:

44 
Maš‹ÇnûQueueS‹
(è: 
shutdown
(
çl£
) { ; }

45 
Maš‹ÇnûQueueT
 
	gqueue
;

46 
	gboo¡
::
mu‹x
 mutex;

47 
	gboo¡
::
cÚd™iÚ
 
cÚd
;

48 
boŞ
 
	gshutdown
;

51 şas 
	cWÜk”
 {

53 
	gpublic
:

55 
WÜk”
(
Maš‹ÇnûQueueS‹
 &
¡©e
è: 
m_¡©e
(state) { ; }

57 
İ”©Ü
()() {

58 
	gboo¡
::
xtime
 
now
, 
	gÃxt_wÜk
;

59 
Maš‹ÇnûTask
 *
	gsk
;

61 
	gŒue
) {

64 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_¡©e
.mutex);

66 
	gboo¡
::
xtime_g‘
(&
now
, 
boo¡
::
TIME_UTC
);

68 
	gm_¡©e
.
	gqueue
.
em±y
(è|| 
xtime_cmp
((
m_¡©e
.
queue
.
tİ
())->
¡¬t_time
, 
now
) > 0) {

70 ià(
	gm_¡©e
.
	gshutdown
)

73 ià(
	gm_¡©e
.
	gqueue
.
em±y
())

74 
	gm_¡©e
.
	gcÚd
.
wa™
(
lock
);

76 
	gÃxt_wÜk
 = (
m_¡©e
.
queue
.
tİ
())->
¡¬t_time
;

77 
	gm_¡©e
.
	gcÚd
.
timed_wa™
(
lock
, 
Ãxt_wÜk
);

79 
	gboo¡
::
xtime_g‘
(&
now
, 
boo¡
::
TIME_UTC
);

82 
	gsk
 = 
m_¡©e
.
queue
.
tİ
();

83 
	gm_¡©e
.
	gqueue
.
pİ
();

86 
	gŒy
 {

87 
	gsk
->
execu‹
();

89 
ÿtch
(
Hy³¹abË
::
Exû±iÚ
 &
e
) {

90 
HT_ERRORF
("% '%s'", 
e
.
code
(),ƒ.
wh©
());

93 
d–‘e
 
	gsk
;

97 
	g´iv©e
:

98 
Maš‹ÇnûQueueS‹
 &
m_¡©e
;

101 
Maš‹ÇnûQueueS‹
 
	gm_¡©e
;

102 
	gboo¡
::
th»ad_group
 
m_th»ads
;

103 
boŞ
 
	gjošed
;

105 
	gpublic
:

113 
Maš‹ÇnûQueue
(
wÜk”_couÁ
è: 
jošed
(
çl£
) {

114 
WÜk”
 WÜk”(
m_¡©e
);

115 
as£¹
 (
wÜk”_couÁ
 > 0);

116 
	gi
=0; i<
	gwÜk”_couÁ
; ++i)

117 
	gm_th»ads
.
ü—‹_th»ad
(
WÜk”
);

126 
shutdown
() {

127 
	gm_¡©e
.
	gshutdown
 = 
Œue
;

128 
	gm_¡©e
.
	gcÚd
.
nÙify_®l
();

135 
još
() {

136 ià(!
	gjošed
) {

137 
	gm_th»ads
.
još_®l
();

138 
	gjošed
 = 
Œue
;

148 
add
(
Maš‹ÇnûTask
 *
sk
) {

149 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_¡©e
.mutex);

150 
	gm_¡©e
.
	gqueue
.
push
(
sk
);

151 
	gm_¡©e
.
	gcÚd
.
nÙify_Úe
();

154 
	gboo¡
::
	tšŒusive_±r
<
	tMaš‹ÇnûQueue
> 
	tMaš‹ÇnûQueuePŒ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/MaintenanceTask.h

21 #iâdeà
HYPERTABLE_MAINTENANCETASK_H


22 
	#HYPERTABLE_MAINTENANCETASK_H


	)

24 
	~<boo¡/th»ad/xtime.hµ
>

26 
Çme¥aû
 
	gHy³¹abË
 {

28 şas 
	cMaš‹ÇnûTask
 {

29 
	gpublic
:

30 
Maš‹ÇnûTask
(
boo¡
::
xtime
 
¡¬t_time_
è: 
¡¬t_time
(start_time_) { ; }

31 
Maš‹ÇnûTask
(è{ 
	gboo¡
::
xtime_g‘
(&
¡¬t_time
, 
boo¡
::
TIME_UTC
); ; }

32 
	gvœtu®
 ~
Maš‹ÇnûTask
() { ; }

33 
vœtu®
 
execu‹
() = 0;

34 
	gboo¡
::
xtime
 
¡¬t_time
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/MaintenanceTaskCompaction.cc

21 
	~"Maš‹ÇnûTaskCom·ùiÚ.h
"

23 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

28 
	gMaš‹ÇnûTaskCom·ùiÚ
::
	$Maš‹ÇnûTaskCom·ùiÚ
(
RªgePŒ
 &
¿nge_±r
, 
boŞ
 
majÜ
è: 
	`Maš‹ÇnûTask
(), 
	`m_¿nge_±r
Ôªge_±r), 
	$m_majÜ
(
majÜ
) {

29 
	}
}

35 
	gMaš‹ÇnûTaskCom·ùiÚ
::
	$execu‹
() {

36 
m_¿nge_±r
->
	`do_com·ùiÚ
(
m_majÜ
);

37 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/MaintenanceTaskCompaction.h

21 #iâdeà
HYPERTABLE_MAINTENANCETASKCOMPACTION_H


22 
	#HYPERTABLE_MAINTENANCETASKCOMPACTION_H


	)

24 
	~"Rªge.h
"

25 
	~"Maš‹ÇnûTask.h
"

27 
Çme¥aû
 
	gHy³¹abË
 {

29 şas 
	cMaš‹ÇnûTaskCom·ùiÚ
 : 
public
 
Maš‹ÇnûTask
 {

30 
public
:

31 
Maš‹ÇnûTaskCom·ùiÚ
(
RªgePŒ
 &
¿nge_±r
, 
boŞ
 
majÜ
);

32 
vœtu®
 
execu‹
();

33 
	g´iv©e
:

34 
RªgePŒ
 
m_¿nge_±r
;

35 
boŞ
 
	gm_majÜ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/MaintenanceTaskLogCleanup.cc

21 
	~"Maš‹ÇnûTaskLogCËªup.h
"

22 
	~"RªgeS”v”.h
"

24 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

30 
	gMaš‹ÇnûTaskLogCËªup
::
	$Maš‹ÇnûTaskLogCËªup
(
RªgeS”v”
 *
¿nge_£rv”
è: 
	`Maš‹ÇnûTask
(), 
	$m_¿nge_£rv”
(
¿nge_£rv”
) {

31 
	}
}

38 
	gMaš‹ÇnûTaskLogCËªup
::
	$execu‹
() {

39 
m_¿nge_£rv”
->
	`log_ş—nup
();

40 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/MaintenanceTaskLogCleanup.h

21 #iâdeà
HYPERTABLE_MAINTENANCETASKLOGCLEANUP_H


22 
	#HYPERTABLE_MAINTENANCETASKLOGCLEANUP_H


	)

24 
	~"Rªge.h
"

25 
	~"Maš‹ÇnûTask.h
"

27 
Çme¥aû
 
	gHy³¹abË
 {

29 
şass
 
	gRªgeS”v”
;

31 şas 
	cMaš‹ÇnûTaskLogCËªup
 : 
public
 
Maš‹ÇnûTask
 {

32 
public
:

33 
Maš‹ÇnûTaskLogCËªup
(
RªgeS”v”
 *
¿nge_£rv”
);

34 
vœtu®
 
execu‹
();

35 
	g´iv©e
:

36 
RªgeS”v”
 *
m_¿nge_£rv”
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/MaintenanceTaskSplit.cc

21 
	~"Maš‹ÇnûTaskS¶™.h
"

23 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

29 
	gMaš‹ÇnûTaskS¶™
::
	$Maš‹ÇnûTaskS¶™
(
RªgePŒ
 &
¿nge_±r
è: 
	`Maš‹ÇnûTask
(), 
	$m_¿nge_±r
(
¿nge_±r
) {

30 
	}
}

37 
	gMaš‹ÇnûTaskS¶™
::
	$execu‹
() {

38 
m_¿nge_±r
->
	`do_¥l™
();

39 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/MaintenanceTaskSplit.h

21 #iâdeà
HYPERTABLE_MAINTENANCETASKSPLIT_H


22 
	#HYPERTABLE_MAINTENANCETASKSPLIT_H


	)

24 
	~"Rªge.h
"

25 
	~"Maš‹ÇnûTask.h
"

27 
Çme¥aû
 
	gHy³¹abË
 {

29 şas 
	cMaš‹ÇnûTaskS¶™
 : 
public
 
Maš‹ÇnûTask
 {

30 
public
:

31 
Maš‹ÇnûTaskS¶™
(
RªgePŒ
 &
¿nge_±r
);

32 
vœtu®
 
execu‹
();

33 
	g´iv©e
:

34 
RªgePŒ
 
m_¿nge_±r
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/MemoryTracker.h

21 #iâdeà
HYPERTABLE_MEMORYTRACKER_H


22 
	#HYPERTABLE_MEMORYTRACKER_H


	)

24 
	~<boo¡/th»ad/mu‹x.hµ
>

26 
Çme¥aû
 
	gHy³¹abË
 {

28 şas 
	cMemÜyT¿ck”
 {

29 
	gpublic
:

30 
MemÜyT¿ck”
(è: 
m_memÜy_u£d
(0), 
m_™em_couÁ
(0) { ; }

32 
add_memÜy
(
ušt64_t
 
amouÁ
) {

33 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

34 
	gm_memÜy_u£d
 +ğ
amouÁ
;

37 
»move_memÜy
(
ušt64_t
 
amouÁ
) {

38 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

39 
	gm_memÜy_u£d
 -ğ
amouÁ
;

42 
ušt64_t
 
g‘_memÜy
() {

43 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

44  
	gm_memÜy_u£d
;

47 
add_™ems
(
ušt64_t
 
couÁ
) {

48 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

49 
	gm_™em_couÁ
 +ğ
couÁ
;

52 
»move_™ems
(
ušt64_t
 
couÁ
) {

53 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

54 
	gm_™em_couÁ
 -ğ
couÁ
;

57 
ušt64_t
 
g‘_™ems
() {

58 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

59  
	gm_™em_couÁ
;

62 
	g´iv©e
:

63 
boo¡
::
mu‹x
 
m_mu‹x
;

64 
ušt64_t
 
	gm_memÜy_u£d
;

65 
ušt64_t
 
	gm_™em_couÁ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/MergeScanner.cc

21 
	~<ÿs£¹
>

23 
	~"CommÚ/Logg”.h
"

25 
	~"Hy³¹abË/Lib/Key.h
"

27 
	~"M”geSÿÂ”.h
"

29 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

34 
	gM”geSÿÂ”
::
	$M”geSÿÂ”
(
SÿnCÚ‹xtPŒ
 &
sÿnCÚ‹xtPŒ
, 
boŞ
 
»tuºD–‘es
è: 
	`C–lLi¡SÿÂ”
(sÿnCÚ‹xtPŒ), 
	`m_dÚe
(
çl£
), 
	`m_š™Ÿlized
(çl£), 
	`m_sÿÂ”s
(), 
	`m_queue
(), 
	`m_d–‘e_´e£Á
(çl£), 
	`m_d–‘ed_row
(0), 
	`m_d–‘ed_cŞumn_çmy
(0), 
	`m_d–‘ed_ûÎ
(0), 
	`m_»tuº_d–‘es
Ô‘uºD–‘es), 
	`m_row_couÁ
(0), 
	`m_row_lim™
(0), 
	`m_ûÎ_couÁ
(0), 
	`m_ûÎ_lim™
(0), 
	`m_ûÎ_cutoff
(0), 
	$m_´ev_key
(0) {

35 ià(
sÿnCÚ‹xtPŒ
->
¥ec
 != 0)

36 
m_row_lim™
 = 
sÿnCÚ‹xtPŒ
->
¥ec
->
rowLim™
;

37 
m_¡¬t_time¡amp
 = 
sÿnCÚ‹xtPŒ
->
š‹rv®
.
fœ¡
;

38 
m_’d_time¡amp
 = 
sÿnCÚ‹xtPŒ
->
š‹rv®
.
£cÚd
;

39 
	}
}

43 
	gM”geSÿÂ”
::
	$add_sÿÂ”
(
C–lLi¡SÿÂ”
 *
sÿÂ”
) {

44 
m_sÿÂ”s
.
	`push_back
(
sÿÂ”
);

45 
	}
}

49 
	gM”geSÿÂ”
::~
	$M”geSÿÂ”
() {

50 
size_t
 
i
=0; i<
m_sÿÂ”s
.
	`size
(); i++)

51 
d–‘e
 
m_sÿÂ”s
[
i
];

52 
	}
}

56 
	gM”geSÿÂ”
::
	$fÜw¬d
() {

57 
SÿÂ”S‹T
 
s¡©e
;

58 
Key
 
keyComps
;

59 
size_t
 
Ën
;

61 ià(
m_queue
.
	`em±y
())

64 
s¡©e
 = 
m_queue
.
	`tİ
();

70 
Œue
) {

72 
Œue
) {

74 
m_queue
.
	`pİ
();

75 
s¡©e
.
sÿÂ”
->
	`fÜw¬d
();

76 ià(
s¡©e
.
sÿÂ”
->
	`g‘
(&s¡©e.
key
, &s¡©e.
v®ue
))

77 
m_queue
.
	`push
(
s¡©e
);

79 ià(
m_queue
.
	`em±y
())

82 
s¡©e
 = 
m_queue
.
	`tİ
();

84 ià(!
keyComps
.
	`lßd
(
s¡©e
.
key
)) {

85 
	`HT_ERROR
("Problem decoding key!");

87 ià(
keyComps
.
time¡amp
 < 
m_¡¬t_time¡amp
) {

90 ià(
keyComps
.
æag
 =ğ
FLAG_DELETE_ROW
) {

91 
Ën
 = 
	`¡¾’
(
keyComps
.
row
) + 1;

92 ià(
m_d–‘e_´e£Á
 && 
m_d–‘ed_row
.
	`fl
(è=ğ
Ën
 && !
	`memcmp
(m_d–‘ed_row.
buf
, 
keyComps
.
row
,†en)) {

93 ià(
m_d–‘ed_row_time¡amp
 < 
keyComps
.
time¡amp
)

94 
m_d–‘ed_row_time¡amp
 = 
keyComps
.
time¡amp
;

97 
m_d–‘ed_row
.
	`ş—r
();

98 
m_d–‘ed_row
.
	`’su»
(
Ën
);

99 
	`memıy
(
m_d–‘ed_row
.
buf
, 
keyComps
.
row
, 
Ën
);

100 
m_d–‘ed_row
.
±r
 = m_d–‘ed_row.
buf
 + 
Ën
;

101 
m_d–‘ed_row_time¡amp
 = 
keyComps
.
time¡amp
;

102 
m_d–‘e_´e£Á
 = 
Œue
;

104 ià(
m_»tuº_d–‘es
)

107 ià(
keyComps
.
æag
 =ğ
FLAG_DELETE_COLUMN_FAMILY
) {

108 
Ën
 = 
keyComps
.
cŞumn_qu®if›r
 - keyComps.
row
;

109 ià(
m_d–‘e_´e£Á
 && 
m_d–‘ed_cŞumn_çmy
.
	`fl
(è=ğ
Ën
 && !
	`memcmp
(m_d–‘ed_cŞumn_çmy.
buf
, 
keyComps
.
row
,†en)) {

110 ià(
m_d–‘ed_cŞumn_çmy_time¡amp
 < 
keyComps
.
time¡amp
)

111 
m_d–‘ed_cŞumn_çmy_time¡amp
 = 
keyComps
.
time¡amp
;

114 
m_d–‘ed_cŞumn_çmy
.
	`ş—r
();

115 
m_d–‘ed_cŞumn_çmy
.
	`’su»
(
Ën
);

116 
	`memıy
(
m_d–‘ed_cŞumn_çmy
.
buf
, 
s¡©e
.
key
->
d©a
, 
Ën
);

117 
m_d–‘ed_cŞumn_çmy
.
±r
 = m_d–‘ed_cŞumn_çmy.
buf
 + 
Ën
;

118 
m_d–‘ed_cŞumn_çmy_time¡amp
 = 
keyComps
.
time¡amp
;

119 
m_d–‘e_´e£Á
 = 
Œue
;

121 ià(
m_»tuº_d–‘es
)

124 ià(
keyComps
.
æag
 =ğ
FLAG_DELETE_CELL
) {

125 
Ën
 = (
keyComps
.
cŞumn_qu®if›r
 - keyComps.
row
è+ 
	`¡¾’
(keyComps.column_qualifier) + 1;

126 ià(
m_d–‘e_´e£Á
 && 
m_d–‘ed_ûÎ
.
	`fl
(è=ğ
Ën
 && !
	`memcmp
(m_d–‘ed_ûÎ.
buf
, 
keyComps
.
row
,†en)) {

127 ià(
m_d–‘ed_ûÎ_time¡amp
 < 
keyComps
.
time¡amp
)

128 
m_d–‘ed_ûÎ_time¡amp
 = 
keyComps
.
time¡amp
;

131 
m_d–‘ed_ûÎ
.
	`ş—r
();

132 
m_d–‘ed_ûÎ
.
	`’su»
(
Ën
);

133 
	`memıy
(
m_d–‘ed_ûÎ
.
buf
, 
s¡©e
.
key
->
d©a
, 
Ën
);

134 
m_d–‘ed_ûÎ
.
±r
 = m_d–‘ed_ûÎ.
buf
 + 
Ën
;

135 
m_d–‘ed_ûÎ_time¡amp
 = 
keyComps
.
time¡amp
;

136 
m_d–‘e_´e£Á
 = 
Œue
;

138 ià(
m_»tuº_d–‘es
)

142 ià(
keyComps
.
time¡amp
 >ğ
m_’d_time¡amp
)

144 ià(!
m_»tuº_d–‘es
 && 
m_d–‘e_´e£Á
) {

145 ià(
m_d–‘ed_ûÎ
.
	`fl
() > 0) {

146 
Ën
 = (
keyComps
.
cŞumn_qu®if›r
 - keyComps.
row
è+ 
	`¡¾’
(keyComps.column_qualifier) + 1;

147 ià(
m_d–‘ed_ûÎ
.
	`fl
(è=ğ
Ën
 && !
	`memcmp
(m_d–‘ed_ûÎ.
buf
, 
keyComps
.
row
,†en)) {

148 ià(
keyComps
.
time¡amp
 < 
m_d–‘ed_ûÎ_time¡amp
)

152 
m_d–‘ed_ûÎ
.
	`ş—r
();

154 ià(
m_d–‘ed_cŞumn_çmy
.
	`fl
() > 0) {

155 
Ën
 = 
keyComps
.
cŞumn_qu®if›r
 - keyComps.
row
;

156 ià(
m_d–‘ed_cŞumn_çmy
.
	`fl
(è=ğ
Ën
 && !
	`memcmp
(m_d–‘ed_cŞumn_çmy.
buf
, 
keyComps
.
row
,†en)) {

157 ià(
keyComps
.
time¡amp
 < 
m_d–‘ed_cŞumn_çmy_time¡amp
)

161 
m_d–‘ed_cŞumn_çmy
.
	`ş—r
();

163 ià(
m_d–‘ed_row
.
	`fl
() > 0) {

164 
Ën
 = 
	`¡¾’
(
keyComps
.
row
) + 1;

165 ià(
m_d–‘ed_row
.
	`fl
(è=ğ
Ën
 && !
	`memcmp
(m_d–‘ed_row.
buf
, 
keyComps
.
row
,†en)) {

166 ià(
keyComps
.
time¡amp
 < 
m_d–‘ed_row_time¡amp
)

170 
m_d–‘ed_row
.
	`ş—r
();

172 
m_d–‘e_´e£Á
 = 
çl£
;

178 ià(
m_´ev_key
.
	`fl
() != 0) {

180 ià(
m_row_lim™
) {

181 ià(
	`¡rcmp
(
keyComps
.
row
, (cÚ¡ *)
m_´ev_key
.
buf
)) {

182 
m_row_couÁ
++;

183 ià(
m_row_couÁ
 >ğ
m_row_lim™
) {

184 
m_dÚe
 = 
Œue
;

187 
m_´ev_key
.
	`£t
(
s¡©e
.
key
->
d©a
, s¡©e.key->
Ën
);

188 
m_ûÎ_lim™
 = 
m_sÿn_cÚ‹xt_±r
->
çmyInfo
[
keyComps
.
cŞumn_çmy_code
].
max_v”siÚs
;

189 
m_ûÎ_cutoff
 = 
m_sÿn_cÚ‹xt_±r
->
çmyInfo
[
keyComps
.
cŞumn_çmy_code
].
cutoffTime
;

190 
m_ûÎ_couÁ
 = 0;

195 ià(
s¡©e
.
key
->
Ën
 =ğ
m_´ev_key
.
	`fl
() && sstate.key->len > 9 &&

196 !
	`memcmp
(
s¡©e
.
key
->
d©a
, 
m_´ev_key
.
buf
, s¡©e.key->
Ën
-9)) {

197 ià(
m_ûÎ_lim™
) {

198 
m_ûÎ_couÁ
++;

199 
m_´ev_key
.
	`£t
(
s¡©e
.
key
->
d©a
, s¡©e.key->
Ën
);

200 ià(
m_ûÎ_couÁ
 >ğ
m_ûÎ_lim™
)

205 
m_´ev_key
.
	`£t
(
s¡©e
.
key
->
d©a
, s¡©e.key->
Ën
);

206 
m_ûÎ_lim™
 = 
m_sÿn_cÚ‹xt_±r
->
çmyInfo
[
keyComps
.
cŞumn_çmy_code
].
max_v”siÚs
;

207 
m_ûÎ_cutoff
 = 
m_sÿn_cÚ‹xt_±r
->
çmyInfo
[
keyComps
.
cŞumn_çmy_code
].
cutoffTime
;

208 
m_ûÎ_couÁ
 = 0;

213 
m_´ev_key
.
	`£t
(
s¡©e
.
key
->
d©a
, s¡©e.key->
Ën
);

214 
m_ûÎ_lim™
 = 
m_sÿn_cÚ‹xt_±r
->
çmyInfo
[
keyComps
.
cŞumn_çmy_code
].
max_v”siÚs
;

215 
m_ûÎ_cutoff
 = 
m_sÿn_cÚ‹xt_±r
->
çmyInfo
[
keyComps
.
cŞumn_çmy_code
].
cutoffTime
;

216 
m_ûÎ_couÁ
 = 0;

223 
	}
}

227 
boŞ
 
	gM”geSÿÂ”
::
	$g‘
(
By‹SŒšg32T
 **
keyp
, By‹SŒšg32T **
v®u•
) {

229 ià(!
m_š™Ÿlized
)

230 
	`š™Ÿlize
();

232 ià(!
m_queue
.
	`em±y
(è&& !
m_dÚe
) {

233 cÚ¡ 
SÿÂ”S‹T
 &
s¡©e
 = 
m_queue
.
	`tİ
();

235 *
keyp
 = 
s¡©e
.
key
;

236 *
v®u•
 = 
s¡©e
.
v®ue
;

237  
Œue
;

239  
çl£
;

240 
	}
}

244 
	gM”geSÿÂ”
::
	$š™Ÿlize
() {

245 
SÿÂ”S‹T
 
s¡©e
;

246 !
m_queue
.
	`em±y
())

247 
m_queue
.
	`pİ
();

248 
size_t
 
i
=0; i<
m_sÿÂ”s
.
	`size
(); i++) {

249 ià(
m_sÿÂ”s
[
i
]->
	`g‘
(&
s¡©e
.
key
, &s¡©e.
v®ue
)) {

250 
s¡©e
.
sÿÂ”
 = 
m_sÿÂ”s
[
i
];

251 
m_queue
.
	`push
(
s¡©e
);

254 !
m_queue
.
	`em±y
()) {

255 
s¡©e
 = 
m_queue
.
	`tİ
();

256 
Key
 
keyComps
;

257 ià(!
keyComps
.
	`lßd
(
s¡©e
.
key
)) {

258 
	`as£¹
(!"MergeScanner::initialize() - Problem decoding key!");

261 ià(
keyComps
.
time¡amp
 < 
m_¡¬t_time¡amp
) {

262 
m_queue
.
	`pİ
();

263 
s¡©e
.
sÿÂ”
->
	`fÜw¬d
();

264 ià(
s¡©e
.
sÿÂ”
->
	`g‘
(&s¡©e.
key
, &s¡©e.
v®ue
))

265 
m_queue
.
	`push
(
s¡©e
);

269 ià(
keyComps
.
æag
 =ğ
FLAG_DELETE_ROW
) {

270 
size_t
 
Ën
 = 
	`¡¾’
(
keyComps
.
row
) + 1;

271 
m_d–‘ed_row
.
	`ş—r
();

272 
m_d–‘ed_row
.
	`’su»
(
Ën
);

273 
	`memıy
(
m_d–‘ed_row
.
buf
, 
keyComps
.
row
, 
Ën
);

274 
m_d–‘ed_row
.
±r
 = m_d–‘ed_row.
buf
 + 
Ën
;

275 
m_d–‘ed_row_time¡amp
 = 
keyComps
.
time¡amp
;

276 
m_d–‘e_´e£Á
 = 
Œue
;

277 ià(!
m_»tuº_d–‘es
)

278 
	`fÜw¬d
();

280 ià(
keyComps
.
æag
 =ğ
FLAG_DELETE_COLUMN_FAMILY
) {

281 
size_t
 
Ën
 = (
keyComps
.
cŞumn_qu®if›r
 - keyComps.
row
è+ 
	`¡¾’
(keyComps.column_qualifier) + 1;

282 
m_d–‘ed_cŞumn_çmy
.
	`ş—r
();

283 
m_d–‘ed_cŞumn_çmy
.
	`’su»
(
Ën
);

284 
	`memıy
(
m_d–‘ed_cŞumn_çmy
.
buf
, 
s¡©e
.
key
->
d©a
, 
Ën
);

285 
m_d–‘ed_cŞumn_çmy
.
±r
 = m_d–‘ed_cŞumn_çmy.
buf
 + 
Ën
;

286 
m_d–‘ed_cŞumn_çmy_time¡amp
 = 
keyComps
.
time¡amp
;

287 
m_d–‘e_´e£Á
 = 
Œue
;

288 ià(!
m_»tuº_d–‘es
)

289 
	`fÜw¬d
();

291 ià(
keyComps
.
æag
 =ğ
FLAG_DELETE_CELL
) {

292 
size_t
 
Ën
 = (
keyComps
.
cŞumn_qu®if›r
 - keyComps.
row
è+ 
	`¡¾’
(keyComps.column_qualifier) + 1;

293 
m_d–‘ed_ûÎ
.
	`ş—r
();

294 
m_d–‘ed_ûÎ
.
	`’su»
(
Ën
);

295 
	`memıy
(
m_d–‘ed_ûÎ
.
buf
, 
s¡©e
.
key
->
d©a
, 
Ën
);

296 
m_d–‘ed_ûÎ
.
±r
 = m_d–‘ed_ûÎ.
buf
 + 
Ën
;

297 
m_d–‘ed_ûÎ_time¡amp
 = 
keyComps
.
time¡amp
;

298 
m_d–‘e_´e£Á
 = 
Œue
;

299 ià(!
m_»tuº_d–‘es
)

300 
	`fÜw¬d
();

303 ià(
keyComps
.
time¡amp
 >ğ
m_’d_time¡amp
) {

304 
m_queue
.
	`pİ
();

305 
s¡©e
.
sÿÂ”
->
	`fÜw¬d
();

306 ià(
s¡©e
.
sÿÂ”
->
	`g‘
(&s¡©e.
key
, &s¡©e.
v®ue
))

307 
m_queue
.
	`push
(
s¡©e
);

310 
m_d–‘e_´e£Á
 = 
çl£
;

311 
m_´ev_key
.
	`£t
(
s¡©e
.
key
->
d©a
, s¡©e.key->
Ën
);

312 
m_ûÎ_lim™
 = 
m_sÿn_cÚ‹xt_±r
->
çmyInfo
[
keyComps
.
cŞumn_çmy_code
].
max_v”siÚs
;

313 
m_ûÎ_cutoff
 = 
m_sÿn_cÚ‹xt_±r
->
çmyInfo
[
keyComps
.
cŞumn_çmy_code
].
cutoffTime
;

314 
m_ûÎ_couÁ
 = 0;

319 
m_š™Ÿlized
 = 
Œue
;

320 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/MergeScanner.h

21 #iâdeà
HYPERTABLE_MERGESCANNER_H


22 
	#HYPERTABLE_MERGESCANNER_H


	)

24 
	~<queue
>

25 
	~<¡ršg
>

26 
	~<veùÜ
>

28 
	~"CommÚ/By‹SŒšg.h
"

29 
	~"CommÚ/DyÇmicBufãr.h
"

31 
	~"C–lLi¡SÿÂ”.h
"

33 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

35 
Çme¥aû
 
	gHy³¹abË
 {

37 şas 
	cM”geSÿÂ”
 : 
public
 
C–lLi¡SÿÂ”
 {

38 
public
:

41 
C–lLi¡SÿÂ”
 *
sÿÂ”
;

42 
By‹SŒšg32T
 *
	gkey
;

43 
By‹SŒšg32T
 *
	gv®ue
;

44 } 
	tSÿÂ”S‹T
;

46 
	sÉSÿÂ”S‹
 {

47 
boŞ
 
İ”©Ü
()(cÚ¡ 
	gSÿÂ”S‹T
 &
	gss1
, cÚ¡ SÿÂ”S‹T &
	gss2
) const {

48  !(*
	gss1
.
	gkey
 < *
	gss2
.key);

52 
M”geSÿÂ”
(
SÿnCÚ‹xtPŒ
 &
sÿnCÚ‹xtPŒ
, 
boŞ
 
»tuºD–‘es
=
Œue
);

53 
	gvœtu®
 ~
M”geSÿÂ”
();

54 
vœtu®
 
fÜw¬d
();

55 
vœtu®
 
boŞ
 
g‘
(
By‹SŒšg32T
 **
keyp
, By‹SŒšg32T **
v®u•
);

56 
add_sÿÂ”
(
C–lLi¡SÿÂ”
 *
sÿÂ”
);

58 
	g´iv©e
:

60 
š™Ÿlize
();

62 
boŞ
 
	gm_dÚe
;

63 
boŞ
 
	gm_š™Ÿlized
;

64 
	g¡d
::
veùÜ
<
C–lLi¡SÿÂ”
 *> 
m_sÿÂ”s
;

65 
	g¡d
::
´iÜ™y_queue
<
SÿÂ”S‹T
, std::
veùÜ
<SÿÂ”S‹T>, 
	gÉSÿÂ”S‹
> 
	gm_queue
;

66 
boŞ
 
	gm_d–‘e_´e£Á
;

67 
DyÇmicBufãr
 
	gm_d–‘ed_row
;

68 
ušt64_t
 
	gm_d–‘ed_row_time¡amp
;

69 
DyÇmicBufãr
 
	gm_d–‘ed_cŞumn_çmy
;

70 
ušt64_t
 
	gm_d–‘ed_cŞumn_çmy_time¡amp
;

71 
DyÇmicBufãr
 
	gm_d–‘ed_ûÎ
;

72 
ušt64_t
 
	gm_d–‘ed_ûÎ_time¡amp
;

73 
boŞ
 
	gm_»tuº_d–‘es
;

74 
ušt32_t
 
	gm_row_couÁ
;

75 
ušt32_t
 
	gm_row_lim™
;

76 
ušt32_t
 
	gm_ûÎ_couÁ
;

77 
ušt32_t
 
	gm_ûÎ_lim™
;

78 
ušt64_t
 
	gm_ûÎ_cutoff
;

79 
ušt64_t
 
	gm_¡¬t_time¡amp
;

80 
ušt64_t
 
	gm_’d_time¡amp
;

81 
DyÇmicBufãr
 
	gm_´ev_key
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/Metadata.h

21 #iâdeà
HYPERTABLE_METADATA_H


22 
	#HYPERTABLE_METADATA_H


	)

24 
Çme¥aû
 
	gHy³¹abË
 {

26 şas 
	cM‘ad©a
 {

27 
	gpublic
:

28 
vœtu®
 ~
M‘ad©a
() { ; }

29 
vœtu®
 
»£t_fes_sÿn
() = 0;

30 
vœtu®
 
boŞ
 
g‘_Ãxt_fes
(
¡d
::
¡ršg
 &
ag_Çme
, std::¡ršg &
fes
) = 0;

31 
vœtu®
 
wr™e_fes
(
¡d
::
¡ršg
 &
ag_Çme
, std::¡ršg &
fes
) = 0;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/MetadataNormal.cc

21 
	~<ÿs£¹
>

22 
	~<c¡ršg
>

24 
	~"CommÚ/E¼Ü.h
"

26 
	~"Hy³¹abË/Lib/TabËMutÜ.h
"

27 
	~"Hy³¹abË/Lib/TabËSÿÂ”.h
"

29 
	~"Glob®.h
"

30 
	~"M‘ad©aNÜm®.h
"

36 
	gM‘ad©aNÜm®
::
M‘ad©aNÜm®
(
TabËId’tif›rT
 &
id’tif›r
, 
¡d
::
¡ršg
 &
’d_row
è: 
	$m_fes_sÿÂ”_±r
(0) {

37 
m_m‘ad©a_key
 = 
¡d
::
	`¡ršg
(""è+ (
ušt32_t
)
id’tif›r
.
id
 + ":" + 
’d_row
;

38 
	`memıy
(&
m_id’tif›r
, &
id’tif›r
, (
TabËId’tif›rT
));

39 
	}
}

46 
	gM‘ad©aNÜm®
::~
	$M‘ad©aNÜm®
() {

47 
m_fes_sÿÂ”_±r
 = 0;

48 
	}
}

52 
	gM‘ad©aNÜm®
::
	$»£t_fes_sÿn
() {

53 
”rÜ
;

54 
SÿnS³cifiÿtiÚT
 
sÿn_¥ec
;

56 
sÿn_¥ec
.
rowLim™
 = 1;

57 
sÿn_¥ec
.
max_v”siÚs
 = 1;

58 
sÿn_¥ec
.
¡¬tRow
 = 
m_m‘ad©a_key
.
	`c_¡r
();

59 
sÿn_¥ec
.
¡¬tRowInşusive
 = 
Œue
;

60 
sÿn_¥ec
.
’dRow
 = 
m_m‘ad©a_key
.
	`c_¡r
();

61 
sÿn_¥ec
.
’dRowInşusive
 = 
Œue
;

62 
sÿn_¥ec
.
š‹rv®
.
fœ¡
 = 0;

63 
sÿn_¥ec
.
š‹rv®
.
£cÚd
 = 0;

64 
sÿn_¥ec
.
cŞumns
.
	`ş—r
();

65 
sÿn_¥ec
.
cŞumns
.
	`push_back
("Files");

66 
sÿn_¥ec
.
»tuº_d–‘es
 = 
çl£
;

68 ià((
”rÜ
 = 
Glob®
::
m‘ad©a_bË_±r
->
	`ü—‹_sÿÂ”
(
sÿn_¥ec
, 
m_fes_sÿÂ”_±r
)è!ğ
E¼Ü
::
OK
)

69 
throw
 
Hy³¹abË
::
	`Exû±iÚ
(
”rÜ
, "Problem creating scanner on METADATAable");

70 
	}
}

74 
boŞ
 
	gM‘ad©aNÜm®
::
g‘_Ãxt_fes
(
¡d
::
¡ršg
 &
ag_Çme
, std::¡ršg &
fes
) {

75 
C–lT
 
ûÎ
;

77 
as£¹
(
m_fes_sÿÂ”_±r
);

79 ià(
	gm_fes_sÿÂ”_±r
->
Ãxt
(
ûÎ
)) {

80 
as£¹
(!
¡rcmp
(
ûÎ
.
cŞumn_çmy
, "Files"));

81 
	gag_Çme
 = 
¡d
::
¡ršg
(
ûÎ
.
cŞumn_qu®if›r
);

82 
	gfes
 = 
¡d
::
¡ršg
((cÚ¡ *)
ûÎ
.
v®ue
, c–l.
v®ue_Ën
);

83  
	gŒue
;

86 
	gm_fes_sÿÂ”_±r
 = 0;

87  
	gçl£
;

92 
	gM‘ad©aNÜm®
::
wr™e_fes
(
¡d
::
¡ršg
 &
ag_Çme
, std::¡ršg &
fes
) {

93 
”rÜ
;

94 
TabËMutÜPŒ
 
	gmutÜ_±r
;

95 
KeyS³c
 
	gkey
;

97 ià((
	g”rÜ
 = 
Glob®
::
m‘ad©a_bË_±r
->
ü—‹_mutÜ
(
mutÜ_±r
)è!ğ
E¼Ü
::
OK
)

98 
throw
 
Hy³¹abË
::
Exû±iÚ
(
”rÜ
, "Problem creating mutator on METADATAable");

100 
	gkey
.
	grow
 = 
m_m‘ad©a_key
.
c_¡r
();

101 
	gkey
.
	grow_Ën
 = 
m_m‘ad©a_key
.
Ëngth
();

102 
	gkey
.
	gcŞumn_çmy
 = "Files";

103 
	gkey
.
	gcŞumn_qu®if›r
 = 
ag_Çme
.
c_¡r
();

104 
	gkey
.
	gcŞumn_qu®if›r_Ën
 = 
ag_Çme
.
Ëngth
();

105 
	gmutÜ_±r
->
£t
(0, 
key
, (
ušt8_t
 *)
fes
.
c_¡r
(), fes.
Ëngth
());

106 
	gmutÜ_±r
->
æush
();

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/MetadataNormal.h

21 #iâdeà
HYPERTABLE_METADATANORMAL_H


22 
	#HYPERTABLE_METADATANORMAL_H


	)

24 
	~<¡ršg
>

26 
	~"Hy³¹abË/Lib/TabËSÿÂ”.h
"

27 
	~"Hy³¹abË/Lib/Ty³s.h
"

29 
	~"M‘ad©a.h
"

31 
Çme¥aû
 
	gHy³¹abË
 {

32 şas 
	cM‘ad©aNÜm®
 : 
public
 
M‘ad©a
 {

34 
public
:

35 
M‘ad©aNÜm®
(
TabËId’tif›rT
 &
id’tif›r
, 
¡d
::
¡ršg
 &
’d_row
);

36 
	gvœtu®
 ~
M‘ad©aNÜm®
();

37 
vœtu®
 
»£t_fes_sÿn
();

38 
vœtu®
 
boŞ
 
g‘_Ãxt_fes
(
¡d
::
¡ršg
 &
ag_Çme
, std::¡ršg &
fes
);

39 
vœtu®
 
wr™e_fes
(
¡d
::
¡ršg
 &
ag_Çme
, std::¡ršg &
fes
);

41 
	g´iv©e
:

42 
TabËSÿÂ”PŒ
 
m_fes_sÿÂ”_±r
;

43 
TabËId’tif›rT
 
	gm_id’tif›r
;

44 
	g¡d
::
¡ršg
 
m_m‘ad©a_key
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/MetadataRoot.cc

21 
	~<ÿs£¹
>

22 
	~<c¡ršg
>

24 
	~"CommÚ/E¼Ü.h
"

26 
	~"Glob®.h
"

27 
	~"M‘ad©aRoÙ.h
"

33 
	gM‘ad©aRoÙ
::
	$M‘ad©aRoÙ
(
SchemaPŒ
 &
schema_±r
è: 
	$m_Ãxt
(0) {

34 
”rÜ
;

35 
HªdËC®lbackPŒ
 
nuÎC®lbackPŒ
;

36 
li¡
<
Schema
::
AcûssGroup
 *> *
ag_li¡
 = 
schema_±r
->
	`g‘_acûss_group_li¡
();

37 
li¡
<
Schema
::
AcûssGroup
 *>::
™”©Ü
 
ag_™”
 = 
ag_li¡
->
	`begš
();‡g_™” !ğag_li¡->
	`’d
();‡g_iter++)

38 
m_agÇmes
.
	`push_back
Ğ(*
ag_™”
)->
Çme
 );

40 ià((
”rÜ
 = 
Glob®
::
hy³r¥aû_±r
->
	`İ’
("/hy³¹abË/roÙ", 
OPEN_FLAG_READ
, 
nuÎC®lbackPŒ
, &
m_hªdË
)è!ğ
E¼Ü
::
OK
) {

41 
	`HT_ERRORF
("ProbËm c»©šg Hy³r¥aû„oÙ f'/hy³¹abË/roÙ' - %s", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

42 
DUMP_CORE
;

45 
	}
}

52 
	gM‘ad©aRoÙ
::~
	$M‘ad©aRoÙ
() {

53 
”rÜ
;

54 ià((
”rÜ
 = 
Glob®
::
hy³r¥aû_±r
->
	`şo£
(
m_hªdË
)è!ğ
E¼Ü
::
OK
) {

55 
	`HT_WARNF
("ProbËm closšg Hy³r¥aû hªdË - %s", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

57 
	}
}

61 
	gM‘ad©aRoÙ
::
	$»£t_fes_sÿn
() {

62 
m_Ãxt
 = 0;

63 
	}
}

67 
boŞ
 
	gM‘ad©aRoÙ
::
g‘_Ãxt_fes
(
¡d
::
¡ršg
 &
ag_Çme
, std::¡ršg &
fes
) {

68 
”rÜ
;

70 
	gm_Ãxt
 < 
	gm_agÇmes
.
size
()) {

71 
DyÇmicBufãr
 
v®ue
(0);

72 
	g¡d
::
¡ršg
 
©ŒÇme
 = (
¡d
::¡ršg)"fes." + 
m_agÇmes
[
m_Ãxt
];

73 
	gm_Ãxt
++;

74 
	gGlob®
::
hy³r¥aû_±r
->
£t_s’t_æag
(
Œue
);

75 ià((
	g”rÜ
 = 
Glob®
::
hy³r¥aû_±r
->
©Œ_g‘
(
m_hªdË
, 
©ŒÇme
.
c_¡r
(), 
v®ue
)è!ğ
E¼Ü
::
OK
) {

76 ià(
”rÜ
 =ğ
E¼Ü
::
HYPERSPACE_ATTR_NOT_FOUND
)

78 
HT_ERRORF
("Problem getting‡ttribute '%s' on Hyperspace file '/hypertable/root' - %s",

79 
©ŒÇme
.
c_¡r
(), 
E¼Ü
::
g‘_‹xt
(
”rÜ
));

80 
	gGlob®
::
hy³r¥aû_±r
->
£t_s’t_æag
(
çl£
);

81  
	gçl£
;

83 
	gfes
 = (cÚ¡ *)
v®ue
.
buf
;

84 
	gGlob®
::
hy³r¥aû_±r
->
£t_s’t_æag
(
çl£
);

85  
	gŒue
;

88 
	gGlob®
::
hy³r¥aû_±r
->
£t_s’t_æag
(
çl£
);

89  
	gçl£
;

94 
	gM‘ad©aRoÙ
::
wr™e_fes
(
¡d
::
¡ršg
 &
ag_Çme
, std::¡ršg &
fes
) {

95 
”rÜ
;

96 
	g¡d
::
¡ršg
 
©ŒÇme
 = (
¡d
::¡ršg)"fes." + 
ag_Çme
;

98 ià((
	g”rÜ
 = 
Glob®
::
hy³r¥aû_±r
->
©Œ_£t
(
m_hªdË
, 
©ŒÇme
.
c_¡r
(), 
fes
.c_¡r(), fes.
Ëngth
())è!ğ
E¼Ü
::
OK
)

99 
throw
 
Hy³¹abË
::
Exû±iÚ
(
”rÜ
, (
¡d
::
¡ršg
)"ProbËm c»©šg‡‰ribu‹ '" + 
©ŒÇme
 + "' on Hyperspace file '/hypertable/root'");

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/MetadataRoot.h

21 #iâdeà
HYPERTABLE_METADATAROOT_H


22 
	#HYPERTABLE_METADATAROOT_H


	)

24 
	~<¡ršg
>

25 
	~<veùÜ
>

27 
	~"Hy³¹abË/Lib/Schema.h
"

28 
	~"Hy³¹abË/Lib/TabËSÿÂ”.h
"

29 
	~"Hy³¹abË/Lib/Ty³s.h
"

31 
	~"M‘ad©a.h
"

33 
Çme¥aû
 
	gHy³¹abË
 {

34 şas 
	cM‘ad©aRoÙ
 : 
public
 
M‘ad©a
 {

36 
public
:

37 
M‘ad©aRoÙ
(
SchemaPŒ
 &
schema_±r
);

38 
	gvœtu®
 ~
M‘ad©aRoÙ
();

39 
vœtu®
 
»£t_fes_sÿn
();

40 
vœtu®
 
boŞ
 
g‘_Ãxt_fes
(
¡d
::
¡ršg
 &
ag_Çme
, std::¡ršg &
fes
);

41 
vœtu®
 
wr™e_fes
(
¡d
::
¡ršg
 &
ag_Çme
, std::¡ršg &
fes
);

43 
	g´iv©e
:

44 
¡d
::
veùÜ
< std::
¡ršg
 > 
m_agÇmes
;

45 
size_t
 
	gm_Ãxt
;

46 
ušt64_t
 
	gm_hªdË
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/Range.cc

20 
	~<ÿs£¹
>

21 
	~<¡ršg
>

22 
	~<veùÜ
>

25 
	~<pŞl.h
>

26 
	~<¡ršg.h
>

29 
	~<boo¡/®gÜ™hm/¡ršg.hµ
>

31 
	~"CommÚ/E¼Ü.h
"

32 
	~"CommÚ/FeUts.h
"

33 
	~"CommÚ/md5.h
"

35 
	~"Hy³¹abË/Lib/Comm™Log.h
"

36 
	~"Hy³¹abË/Lib/Comm™LogR—d”.h
"

39 
	~"C–lStÜeV0.h
"

40 
	~"Glob®.h
"

41 
	~"M”geSÿÂ”.h
"

42 
	~"M‘ad©aNÜm®.h
"

43 
	~"M‘ad©aRoÙ.h
"

44 
	~"Rªge.h
"

47 
usšg
 
Çme¥aû
 
Hy³¹abË
;

48 
usšg
 
Çme¥aû
 
	g¡d
;

51 
	gRªge
::
	$Rªge
(
Ma¡”Cl›ÁPŒ
 &
ma¡”_ş›Á_±r
, 
TabËId’tif›rT
 &
id’tif›r
, 
SchemaPŒ
 &
schemaPŒ
, 
RªgeT
 *
¿nge
, 
ušt64_t
 
soá_lim™
è: 
	`C–lLi¡
(), 
	`m_mu‹x
(), 
	`m_ma¡”_ş›Á_±r
(ma¡”_ş›Á_±r), 
	`m_schema
(schemaPŒ), 
	`m_maš‹Çnû_š_´og»ss
(
çl£
), 
	`m_Ï¡_logiÿl_time¡amp
(0), 
	`m_hŞd_upd©es
(çl£), 
	`m_upd©e_couÁ”
(0), 
	$m_added_š£¹s
(0) {

52 
AcûssGroup
 *
ag
;

54 
	`mem£t
(
m_added_d–‘es
, 0, 3*(
št64_t
));

56 ià(
soá_lim™
 =ğ0 || soá_lim™ > 
Glob®
::
¿ngeMaxBy‹s
)

57 
m_disk_lim™
 = 
Glob®
::
¿ngeMaxBy‹s
;

59 
m_disk_lim™
 = 
soá_lim™
;

61 
m_¥l™_time¡amp
.
logiÿl
 = 0;

62 
m_¥l™_time¡amp
.
»®
 = 0;

64 
	`Cİy
(
id’tif›r
, 
m_id’tif›r
);

66 
m_¡¬t_row
 = 
¿nge
->
¡¬tRow
;

67 
m_’d_row
 = 
¿nge
->
’dRow
;

69 
m_is_roÙ
 = (
m_id’tif›r
.
id
 =ğ0 && *
¿nge
->
¡¬tRow
 =ğ0 && !
	`¡rcmp
Ôªge->
’dRow
, 
Key
::
END_ROOT_ROW
));

71 
m_cŞumn_çmy_veùÜ
.
	`»size
Ğ
m_schema
->
	`g‘_max_cŞumn_çmy_id
() + 1 );

73 
li¡
<
Schema
::
AcûssGroup
 *> *
agLi¡
 = 
m_schema
->
	`g‘_acûss_group_li¡
();

75 
li¡
<
Schema
::
AcûssGroup
 *>::
™”©Ü
 
agI‹r
 = 
agLi¡
->
	`begš
();‡gI‹¸!ğagLi¡->
	`’d
();‡gIter++) {

76 
ag
 = 
Ãw
 
	`AcûssGroup
(
m_id’tif›r
, 
m_schema
, (*
agI‹r
), 
¿nge
);

77 
m_acûss_group_m­
[(*
agI‹r
)->
Çme
] = 
ag
;

78 
m_acûss_group_veùÜ
.
	`push_back
(
ag
);

79 
li¡
<
Schema
::
CŞumnFamy
 *>::
™”©Ü
 
cfI‹r
 = (*
agI‹r
)->
cŞumns
.
	`begš
(); cfI‹¸!ğ(*agI‹r)->cŞumns.
	`’d
(); cfIter++)

80 
m_cŞumn_çmy_veùÜ
[(*
cfI‹r
)->
id
] = 
ag
;

86 ià(
m_is_roÙ
) {

87 
M‘ad©aRoÙ
 
	`m‘ad©a
(
m_schema
);

88 
	`lßd_ûÎ_¡Ües
(&
m‘ad©a
);

91 
M‘ad©aNÜm®
 
	`m‘ad©a
(
m_id’tif›r
, 
m_’d_row
);

92 
	`lßd_ûÎ_¡Ües
(&
m‘ad©a
);

96 
	}
}

101 
	gRªge
::~
	$Rªge
() {

102 
	`F»e
(
m_id’tif›r
);

103 
size_t
 
i
=0; i<
m_acûss_group_veùÜ
.
	`size
(); i++)

104 
d–‘e
 
m_acûss_group_veùÜ
[
i
];

105 
	}
}

112 
	gRªge
::
	$lßd_ûÎ_¡Ües
(
M‘ad©a
 *
m‘ad©a
) {

113 
”rÜ
;

114 
AcûssGroup
 *
ag
;

115 
C–lStÜePŒ
 
ûÎStÜePŒ
;

116 
ušt32_t
 
csid
;

117 cÚ¡ *
ba£
, *
±r
, *
’d
;

118 
¡d
::
veùÜ
<¡d::
¡ršg
> 
csvec
;

119 
¡d
::
¡ršg
 
ag_Çme
;

120 
¡d
::
¡ršg
 
fes
;

121 
¡d
::
¡ršg
 
fe_¡r
;

123 
m‘ad©a
->
	`»£t_fes_sÿn
();

125 
m‘ad©a
->
	`g‘_Ãxt_fes
(
ag_Çme
, 
fes
)) {

126 
csvec
.
	`ş—r
();

128 ià((
ag
 = 
m_acûss_group_m­
[
ag_Çme
]) == 0) {

129 
	`HT_ERRORF
("UÄecognized‡cûs grou°Çm'%s' found iÀMETADATA fÜabË '%s'", 
ag_Çme
.
	`c_¡r
(), 
m_id’tif›r
.
Çme
);

133 
±r
 = 
ba£
 = (cÚ¡ *)
fes
.
	`c_¡r
();

134 
’d
 = 
ba£
 + 
	`¡¾’
(base);

135 
±r
 < 
’d
) {

137 *
±r
 !ğ';' &&…Œ < 
’d
)

138 
±r
++;

140 
fe_¡r
 = 
¡d
::
	`¡ršg
(
ba£
, 
±r
-base);

141 
boo¡
::
	`Œim
(
fe_¡r
);

143 ià(
fe_¡r
 != "")

144 
csvec
.
	`push_back
(
fe_¡r
);

146 ++
±r
;

147 
ba£
 = 
±r
;

150 
size_t
 
i
=0; i<
csvec
.
	`size
(); i++) {

152 
	`HT_INFOF
("drj Lßdšg C–lStÜ%s", 
csvec
[
i
].
	`c_¡r
());

154 
ûÎStÜePŒ
 = 
Ãw
 
	`C–lStÜeV0
(
Glob®
::
dfs
);

156 ià(!
	`exŒaù_csid_äom_·th
(
csvec
[
i
], &
csid
)) {

157 
	`HT_ERRORF
("UÇbËØexŒaù c–È¡ÜID from…©h '%s'", 
csvec
[
i
].
	`c_¡r
());

160 ià((
”rÜ
 = 
ûÎStÜePŒ
->
	`İ’
(
csvec
[
i
].
	`c_¡r
(), 
m_¡¬t_row
.c_¡r(), 
m_’d_row
.c_¡r())è!ğ
E¼Ü
::
OK
) {

162 
	`HT_ERRORF
("ProbËm o³nšg c–È¡Ü'%s', skpšg...", 
csvec
[
i
].
	`c_¡r
());

165 ià((
”rÜ
 = 
ûÎStÜePŒ
->
	`lßd_šdex
()è!ğ
E¼Ü
::
OK
) {

167 
	`HT_ERRORF
("ProbËm†ßdšg index oàûÎ stÜ'%s', skpšg...", 
csvec
[
i
].
	`c_¡r
());

171 
ag
->
	`add_ûÎ_¡Üe
(
ûÎStÜePŒ
, 
csid
);

176 
	}
}

182 
boŞ
 
	gRªge
::
exŒaù_csid_äom_·th
(
¡d
::
¡ršg
 &
·th
, 
ušt32_t
 *
csidp
) {

183 cÚ¡ *
	gba£
;

185 ià((
	gba£
 = 
¡¼chr
(
·th
.
c_¡r
(), '/')è=ğ0 || 
¡ºcmp
(
ba£
, "/cs", 3))

186 *
	gcsidp
 = 0;

188 *
	gcsidp
 = 
©oi
(
ba£
+3);

190  
	gŒue
;

197 
	gRªge
::
	$add
(cÚ¡ 
By‹SŒšg32T
 *
key
, cÚ¡ By‹SŒšg32T *
v®ue
, 
ušt64_t
 
»®_time¡amp
) {

198 
Key
 
keyComps
;

200 
	`HT_EXPECT
(
keyComps
.
	`lßd
(
key
), 
E¼Ü
::
FAILED_EXPECTATION
);

202 ià(
keyComps
.
cŞumn_çmy_code
 >ğ
m_cŞumn_çmy_veùÜ
.
	`size
()) {

203 
	`HT_ERRORF
("Bad cŞumÀçmy (%d)", 
keyComps
.
cŞumn_çmy_code
);

204  
E¼Ü
::
RANGESERVER_INVALID_COLUMNFAMILY
;

207 ià(
keyComps
.
time¡amp
 <ğ
m_Ï¡_logiÿl_time¡amp
) {

208 ià(
keyComps
.
æag
 =ğ
FLAG_INSERT
) {

209 
	`HT_ERRORF
("ProbËm‡ddšg key/v®u·œ, keyime¡m­ %Îu <ğ%Îu", 
keyComps
.
time¡amp
, 
m_Ï¡_logiÿl_time¡amp
);

210  
E¼Ü
::
RANGESERVER_TIMESTAMP_ORDER_ERROR
;

214 
m_Ï¡_logiÿl_time¡amp
 = 
keyComps
.
time¡amp
;

216 ià(
keyComps
.
æag
 =ğ
FLAG_DELETE_ROW
) {

217 
AcûssGroupM­T
::
™”©Ü
 
™”
 = 
m_acûss_group_m­
.
	`begš
(); i‹¸!ğm_acûss_group_m­.
	`’d
(); iter++) {

218 (*
™”
).
£cÚd
->
	`add
(
key
, 
v®ue
, 
»®_time¡amp
);

222 
m_cŞumn_çmy_veùÜ
[
keyComps
.
cŞumn_çmy_code
]->
	`add
(
key
, 
v®ue
, 
»®_time¡amp
);

224 ià(
keyComps
.
æag
 =ğ
FLAG_INSERT
)

225 
m_added_š£¹s
++;

227 
m_added_d–‘es
[
keyComps
.
æag
]++;

229  
E¼Ü
::
OK
;

230 
	}
}

233 
C–lLi¡SÿÂ”
 *
	gRªge
::
	$ü—‹_sÿÂ”
(
SÿnCÚ‹xtPŒ
 &
sÿnCÚ‹xtPŒ
) {

234 
boŞ
 
»tuº_d–‘es
 = 
sÿnCÚ‹xtPŒ
->
¥ec
 ? sÿnCÚ‹xtPŒ->¥ec->»tuº_d–‘e : 
çl£
;

235 
cout
 << 
æush
;

236 
M”geSÿÂ”
 *
msÿÂ”
 = 
Ãw
 
	`M”geSÿÂ”
(
sÿnCÚ‹xtPŒ
, 
»tuº_d–‘es
);

237 
AcûssGroupM­T
::
™”©Ü
 
™”
 = 
m_acûss_group_m­
.
	`begš
(); i‹¸!ğm_acûss_group_m­.
	`’d
(); iter++) {

238 ià((*
™”
).
£cÚd
->
	`šşude_š_sÿn
(
sÿnCÚ‹xtPŒ
))

239 
msÿÂ”
->
	`add_sÿÂ”
((*
™”
).
£cÚd
->
	`ü—‹_sÿÂ”
(
sÿnCÚ‹xtPŒ
));

241  
msÿÂ”
;

242 
	}
}

245 
ušt64_t
 
	gRªge
::
	$disk_u§ge
() {

246 
ušt64_t
 
u§ge
 = 0;

247 
size_t
 
i
=0; i<
m_acûss_group_veùÜ
.
	`size
(); i++)

248 
u§ge
 +ğ
m_acûss_group_veùÜ
[
i
]->
	`disk_u§ge
();

249  
u§ge
;

250 
	}
}

256 cÚ¡ *
	gRªge
::
	$g‘_¥l™_row
() {

257 
¡d
::
veùÜ
<¡d::
¡ršg
> 
¥l™_rows
;

258 
size_t
 
i
=0; i<
m_acûss_group_veùÜ
.
	`size
(); i++)

259 
m_acûss_group_veùÜ
[
i
]->
	`g‘_¥l™_rows
(
¥l™_rows
, 
çl£
);

265 ià(
¥l™_rows
.
	`size
(è< 
m_acûss_group_veùÜ
.size()) {

266 
size_t
 
i
=0; i<
m_acûss_group_veùÜ
.
	`size
(); i++)

267 
m_acûss_group_veùÜ
[
i
]->
	`g‘_¥l™_rows
(
¥l™_rows
, 
Œue
);

269 
	`sÜt
(
¥l™_rows
.
	`begš
(), s¶™_rows.
	`’d
());

281 ià(
¥l™_rows
.
	`size
() > 0) {

282 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

283 
m_¥l™_row
 = 
¥l™_rows
[¥l™_rows.
	`size
()/2];

284 ià(
m_¥l™_row
 <ğ
m_¡¬t_row
 || m_¥l™_row >ğ
m_’d_row
) {

285 
¥l™_rows
.
	`ş—r
();

286 
size_t
 
i
=0; i<
m_acûss_group_veùÜ
.
	`size
(); i++)

287 
m_acûss_group_veùÜ
[
i
]->
	`g‘_ÿched_rows
(
¥l™_rows
);

288 ià(
¥l™_rows
.
	`size
() > 0) {

289 
	`sÜt
(
¥l™_rows
.
	`begš
(), s¶™_rows.
	`’d
());

290 
m_¥l™_row
 = 
¥l™_rows
[¥l™_rows.
	`size
()/2];

291 ià(
m_¥l™_row
 <ğ
m_¡¬t_row
 || m_¥l™_row >ğ
m_’d_row
) {

292 
	`HT_FATALF
("UÇbËØd‘”mš¥l™„ow fÜ„ªg%s[%s..%s]", 
m_id’tif›r
.
Çme
, 
m_¡¬t_row
.
	`c_¡r
(), 
m_’d_row
.c_str());

293 
DUMP_CORE
;

297 
	`HT_FATALF
("UÇbËØd‘”mš¥l™„ow fÜ„ªg%s[%s..%s]", 
m_id’tif›r
.
Çme
, 
m_¡¬t_row
.
	`c_¡r
(), 
m_’d_row
.c_str());

298 
DUMP_CORE
;

303 
	`HT_FATALF
("UÇbËØd‘”mš¥l™„ow fÜ„ªg%s[%s..%s]", 
m_id’tif›r
.
Çme
, 
m_¡¬t_row
.
	`c_¡r
(), 
m_’d_row
.c_str());

304 
DUMP_CORE
;

306  
m_¥l™_row
.
	`c_¡r
();

307 
	}
}

314 
	gRªge
::
g‘_com·ùiÚ_´iÜ™y_d©a
(
¡d
::
veùÜ
<
AcûssGroup
::
Com·ùiÚPriÜ™yD©aT
> &
´iÜ™y_d©a_veùÜ
) {

315 
size_t
 
Ãxt_¦Ù
 = 
´iÜ™y_d©a_veùÜ
.
size
();

318 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

319 
	g´iÜ™y_d©a_veùÜ
.
»size
Ğ
´iÜ™y_d©a_veùÜ
.
size
(è+ 
m_acûss_group_veùÜ
.size() );

322 
size_t
 
	gi
=0; i<
	gm_acûss_group_veùÜ
.
size
(); i++) {

323 
	gm_acûss_group_veùÜ
[
i
]->
g‘_com·ùiÚ_´iÜ™y_d©a
(
´iÜ™y_d©a_veùÜ
[
Ãxt_¦Ù
]);

324 
	gÃxt_¦Ù
++;

330 
	gRªge
::
	$do_¥l™
() {

331 
¡d
::
¡ršg
 
¥l™LogDœ
;

332 
md5Dige¡SŒ
[33];

333 
”rÜ
;

334 
¡d
::
¡ršg
 
Şd_¡¬t_row
;

335 
TabËMutÜPŒ
 
mutÜ_±r
;

336 
KeyS³c
 
key
;

337 
¡d
::
¡ršg
 
m‘ad©a_key_¡r
;

339 
	`as£¹
(
m_maš‹Çnû_š_´og»ss
);

342 ià(
m_is_roÙ
) {

343 
	`HT_ERROR
("Split scheduled for„oot METADATA„ange");

344 
m_maš‹Çnû_š_´og»ss
 = 
çl£
;

349 
	`g‘_¥l™_row
();

354 
	`md5_¡ršg
(
m_¥l™_row
.
	`c_¡r
(), 
md5Dige¡SŒ
);

355 
md5Dige¡SŒ
[24] = 0;

356 
¡d
::
¡ršg
::
size_ty³
 
pos
 = 
Glob®
::
logDœ
.
	`rfšd
("´im¬y", Glob®::logDœ.
	`Ëngth
());

357 
	`as£¹
 (
pos
 !ğ
¡d
::
¡ršg
::
Åos
);

358 
¥l™LogDœ
 = 
Glob®
::
logDœ
.
	`sub¡r
(0, 
pos
è+ 
md5Dige¡SŒ
;

361 ià((
”rÜ
 = 
Glob®
::
logDfs
->
	`mkdœs
(
¥l™LogDœ
)è!ğ
E¼Ü
::
OK
) {

362 
	`HT_ERRORF
("ProbËm c»©šg DFS†og dœeùÜy '%s'", 
¥l™LogDœ
.
	`c_¡r
());

363 
	`ex™
(1);

369 ià((
”rÜ
 = 
Glob®
::
m‘ad©a_bË_±r
->
	`ü—‹_mutÜ
(
mutÜ_±r
)è!ğ
E¼Ü
::
OK
) {

371 
	`HT_ERROR
("Problem creating mutator on METADATAable");

375 
m‘ad©a_key_¡r
 = 
¡d
::
	`¡ršg
(""è+ (
ušt32_t
)
m_id’tif›r
.
id
 + ":" + 
m_’d_row
;

376 
key
.
row
 = 
m‘ad©a_key_¡r
.
	`c_¡r
();

377 
key
.
row_Ën
 = 
m‘ad©a_key_¡r
.
	`Ëngth
();

378 
key
.
cŞumn_qu®if›r
 = 0;

379 
key
.
cŞumn_qu®if›r_Ën
 = 0;

381 
Œy
 {

382 
key
.
cŞumn_çmy
 = "SplitPoint";

383 
mutÜ_±r
->
	`£t
(0, 
key
, (
ušt8_t
 *)
m_¥l™_row
.
	`c_¡r
(), m_¥l™_row.
	`Ëngth
());

384 
key
.
cŞumn_çmy
 = "SplitLogDir";

385 
mutÜ_±r
->
	`£t
(0, 
key
, (
ušt8_t
 *)
¥l™LogDœ
.
	`c_¡r
(), s¶™LogDœ.
	`Ëngth
());

386 
mutÜ_±r
->
	`æush
();

388 
	`ÿtch
 (
Hy³¹abË
::
Exû±iÚ
 &
e
) {

390 
	`HT_ERRORF
("ProbËm upd©šg METADATA w™h s¶™ infØÔow key = %sè- %s", 
m‘ad©a_key_¡r
.
	`c_¡r
(), 
e
.
	`wh©
());

398 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_maš‹Çnû_mu‹x
);

399 
Prİ”t›sPŒ
 
	`´İs_±r
(0);

402 
m_hŞd_upd©es
 = 
Œue
;

403 
m_upd©e_couÁ”
 > 0)

404 
m_upd©e_qu›sû_cÚd
.
	`wa™
(
lock
);

407 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

408 
m_¥l™_time¡amp
.
logiÿl
 = 
m_sÿÂ”_time¡amp_cÚŒŞËr
.
	`g‘_Şde¡_upd©e_time¡amp
();

409 ià(
m_¥l™_time¡amp
.
logiÿl
 =ğ0 || 
m_time¡amp
.logical < m_split_timestamp.logical)

410 
m_¥l™_time¡amp
 = 
m_time¡amp
;

412 
m_¥l™_time¡amp
.
»®
 = 
Glob®
::
log
->
	`g‘_time¡amp
();

413 
Şd_¡¬t_row
 = 
m_¡¬t_row
;

416 
m_¥l™_log_±r
 = 
Ãw
 
	`Comm™Log
(
Glob®
::
dfs
, 
¥l™LogDœ
, 
´İs_±r
);

419 
m_hŞd_upd©es
 = 
çl£
;

420 
m_maš‹Çnû_fšished_cÚd
.
	`nÙify_®l
();

428 
size_t
 
i
=0; i<
m_acûss_group_veùÜ
.
	`size
(); i++)

429 
m_acûss_group_veùÜ
[
i
]->
	`run_com·ùiÚ
(
m_¥l™_time¡amp
, 
Œue
);

437 
Œy
 {

438 
¡d
::
¡ršg
 
fes
;

439 
m‘ad©a_key_¡r
 = 
¡d
::
	`¡ršg
(""è+ (
ušt32_t
)
m_id’tif›r
.
id
 + ":" + 
m_¥l™_row
;

440 
key
.
row
 = 
m‘ad©a_key_¡r
.
	`c_¡r
();

441 
key
.
row_Ën
 = 
m‘ad©a_key_¡r
.
	`Ëngth
();

442 
key
.
cŞumn_qu®if›r
 = 0;

443 
key
.
cŞumn_qu®if›r_Ën
 = 0;

445 
key
.
cŞumn_çmy
 = "StartRow";

446 
mutÜ_±r
->
	`£t
(0, 
key
, (
ušt8_t
 *)
Şd_¡¬t_row
.
	`c_¡r
(), old_¡¬t_row.
	`Ëngth
());

447 
key
.
cŞumn_çmy
 = "SplitLogDir";

448 
mutÜ_±r
->
	`£t
(0, 
key
, (
ušt8_t
 *)
¥l™LogDœ
.
	`c_¡r
(), s¶™LogDœ.
	`Ëngth
());

450 
key
.
cŞumn_çmy
 = "Files";

451 
size_t
 
i
=0; i<
m_acûss_group_veùÜ
.
	`size
(); i++) {

452 
key
.
cŞumn_qu®if›r
 = 
m_acûss_group_veùÜ
[
i
]->
	`g‘_Çme
();

453 
key
.
cŞumn_qu®if›r_Ën
 = 
	`¡¾’
(
m_acûss_group_veùÜ
[
i
]->
	`g‘_Çme
());

454 
m_acûss_group_veùÜ
[
i
]->
	`g‘_fes
(
fes
);

455 
mutÜ_±r
->
	`£t
(0, 
key
, (
ušt8_t
 *)
fes
.
	`c_¡r
(), fes.
	`Ëngth
());

458 
m‘ad©a_key_¡r
 = 
¡d
::
	`¡ršg
(""è+ (
ušt32_t
)
m_id’tif›r
.
id
 + ":" + 
m_’d_row
;

459 
key
.
row
 = 
m‘ad©a_key_¡r
.
	`c_¡r
();

460 
key
.
row_Ën
 = 
m‘ad©a_key_¡r
.
	`Ëngth
();

461 
key
.
cŞumn_qu®if›r
 = 0;

462 
key
.
cŞumn_qu®if›r_Ën
 = 0;

464 
key
.
cŞumn_çmy
 = "StartRow";

465 
mutÜ_±r
->
	`£t
(0, 
key
, (
ušt8_t
 *)
m_¥l™_row
.
	`c_¡r
(), m_¥l™_row.
	`Ëngth
());

466 
key
.
cŞumn_çmy
 = "SplitLogDir";

467 
mutÜ_±r
->
	`£t
(0, 
key
, 0, 0);

468 
mutÜ_±r
->
	`æush
();

470 
	`ÿtch
 (
Hy³¹abË
::
Exû±iÚ
 &
e
) {

472 
	`HT_ERRORF
("ProbËm upd©šg METADATA w™h‚ew„ªgšfÜm©iÚ (row key = %sè- %s", 
m‘ad©a_key_¡r
.
	`c_¡r
(), 
e
.
	`wh©
());

473 
DUMP_CORE
;

480 ià(
m_id’tif›r
.
id
 == 0) {

481 
Œy
 {

483 
m‘ad©a_key_¡r
 = 
¡d
::
	`¡ršg
("0:"è+ 
m_¥l™_row
;

484 
key
.
row
 = 
m‘ad©a_key_¡r
.
	`c_¡r
();

485 
key
.
row_Ën
 = 
m‘ad©a_key_¡r
.
	`Ëngth
();

486 
key
.
cŞumn_qu®if›r
 = 0;

487 
key
.
cŞumn_qu®if›r_Ën
 = 0;

488 
key
.
cŞumn_çmy
 = "StartRow";

489 
mutÜ_±r
->
	`£t
(0, 
key
, (
ušt8_t
 *)
Şd_¡¬t_row
.
	`c_¡r
(), old_¡¬t_row.
	`Ëngth
());

492 
m‘ad©a_key_¡r
 = 
¡d
::
	`¡ršg
("0:"è+ 
m_’d_row
;

493 
key
.
row
 = 
m‘ad©a_key_¡r
.
	`c_¡r
();

494 
key
.
row_Ën
 = 
m‘ad©a_key_¡r
.
	`Ëngth
();

495 
mutÜ_±r
->
	`£t
(0, 
key
, (
ušt8_t
 *)
m_¥l™_row
.
	`c_¡r
(), m_¥l™_row.
	`Ëngth
());

496 
mutÜ_±r
->
	`æush
();

498 
	`ÿtch
 (
Hy³¹abË
::
Exû±iÚ
 &
e
) {

500 
	`HT_ERRORF
("ProbËm upd©šg ROOT METADATA„ªgÒew=%s,ƒxi¡šg=%sè- %s", 
m_¥l™_row
.
	`c_¡r
(), 
m_’d_row
.c_¡r(), 
e
.
	`wh©
());

501 
DUMP_CORE
;

510 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_maš‹Çnû_mu‹x
);

513 
m_hŞd_upd©es
 = 
Œue
;

514 
m_upd©e_couÁ”
 > 0)

515 
m_upd©e_qu›sû_cÚd
.
	`wa™
(
lock
);

520 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

521 
m_¡¬t_row
 = 
m_¥l™_row
;

522 
m_¥l™_time¡amp
.
	`ş—r
();

523 
m_¥l™_row
 = "";

525 
size_t
 
i
=0; i<
m_acûss_group_veùÜ
.
	`size
(); i++)

526 
m_acûss_group_veùÜ
[
i
]->
	`shršk
(
m_¡¬t_row
);

530 
m_hŞd_upd©es
 = 
çl£
;

531 
m_maš‹Çnû_fšished_cÚd
.
	`nÙify_®l
();

535 ià((
”rÜ
 = 
m_¥l™_log_±r
->
	`şo£
(
Glob®
::
log
->
	`g‘_time¡amp
())è!ğ
E¼Ü
::
OK
) {

536 
	`HT_ERRORF
("ProbËm closšg s¶™†og '%s' - %s", 
m_¥l™_log_±r
->
	`g‘_log_dœ
().
	`c_¡r
(), 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

538 
m_¥l™_log_±r
 = 0;

544 
RªgeT
 
¿nge
;

546 
¿nge
.
¡¬tRow
 = 
Şd_¡¬t_row
.
	`c_¡r
();

547 
¿nge
.
’dRow
 = 
m_¡¬t_row
.
	`c_¡r
();

550 
m_id’tif›r
.
g’”©iÚ
 = 
m_schema
->
	`g‘_g’”©iÚ
();

552 
	`HT_INFOF
("R•Ütšg‚ewly s¶™ ofà¿ng%s[%s..%s]ØMa¡”", 
m_id’tif›r
.
Çme
, 
¿nge
.
¡¬tRow
,„ªge.
’dRow
);

553 
cout
 << 
æush
;

554 ià(
m_disk_lim™
 < 
Glob®
::
¿ngeMaxBy‹s
) {

555 
m_disk_lim™
 *= 2;

556 ià(
m_disk_lim™
 > 
Glob®
::
¿ngeMaxBy‹s
)

557 
m_disk_lim™
 = 
Glob®
::
¿ngeMaxBy‹s
;

559 ià((
”rÜ
 = 
m_ma¡”_ş›Á_±r
->
	`»pÜt_¥l™
(
m_id’tif›r
, 
¿nge
, 
m_disk_lim™
)è!ğ
E¼Ü
::
OK
) {

560 
	`HT_ERRORF
("Problem„eporting split (table=%s, start_row=%s,ƒnd_row=%s)o master.",

561 
m_id’tif›r
.
Çme
, 
¿nge
.
¡¬tRow
,„ªge.
’dRow
);

565 
	`HT_INFOF
("S¶™ Com¶‘e. New Rªg’d_row=%s", 
m_¡¬t_row
.
	`c_¡r
());

567 
m_maš‹Çnû_š_´og»ss
 = 
çl£
;

568 
	}
}

571 
	gRªge
::
	$do_com·ùiÚ
(
boŞ
 
majÜ
) {

572 
	`run_com·ùiÚ
(
majÜ
);

573 
m_maš‹Çnû_š_´og»ss
 = 
çl£
;

574 
	}
}

577 
	gRªge
::
	$run_com·ùiÚ
(
boŞ
 
majÜ
) {

578 
Time¡amp
 
time¡amp
;

581 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_maš‹Çnû_mu‹x
);

584 
m_hŞd_upd©es
 = 
Œue
;

585 
m_upd©e_couÁ”
 > 0)

586 
m_upd©e_qu›sû_cÚd
.
	`wa™
(
lock
);

589 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

590 
time¡amp
 = 
m_time¡amp
;

594 
m_hŞd_upd©es
 = 
çl£
;

595 
m_maš‹Çnû_fšished_cÚd
.
	`nÙify_®l
();

608 
ušt64_t
 
‹mp_time¡amp
 = 
m_sÿÂ”_time¡amp_cÚŒŞËr
.
	`g‘_Şde¡_upd©e_time¡amp
();

609 ià(
‹mp_time¡amp
 !ğ0 &&emp_time¡am°< 
time¡amp
.
logiÿl
)

610 
time¡amp
.
logiÿl
 = 
‹mp_time¡amp
;

612 
size_t
 
i
=0; i<
m_acûss_group_veùÜ
.
	`size
(); i++)

613 
m_acûss_group_veùÜ
[
i
]->
	`run_com·ùiÚ
(
time¡amp
, 
majÜ
);

615 
	}
}

621 
	gRªge
::
	$dump_¡©s
() {

622 
¡d
::
¡ršg
 
¿nge_¡r
 = (¡d::¡ršg)
m_id’tif›r
.
Çme
 + "[" + 
m_¡¬t_row
 + ".." + 
m_’d_row
 + "]";

623 
ušt64_t
 
cŞlisiÚs
 = 0;

624 
ušt64_t
 
ÿched
 = 0;

625 
size_t
 
i
=0; i<
m_acûss_group_veùÜ
.
	`size
(); i++) {

626 
cŞlisiÚs
 +ğ
m_acûss_group_veùÜ
[
i
]->
	`g‘_cŞlisiÚ_couÁ
();

627 
ÿched
 +ğ
m_acûss_group_veùÜ
[
i
]->
	`g‘_ÿched_couÁ
();

629 
cout
 << "STAT\t" << 
¿nge_¡r
 << "\dded in£¹s\t" << 
m_added_š£¹s
 << 
’dl
;

630 
cout
 << "STAT\t" << 
¿nge_¡r
 << "\dded„ow d–‘es\t" << 
m_added_d–‘es
[0] << 
’dl
;

631 
cout
 << "STAT\t" << 
¿nge_¡r
 << "\dded càd–‘es\t" << 
m_added_d–‘es
[1] << 
’dl
;

632 
cout
 << "STAT\t" << 
¿nge_¡r
 << "\dded c–Èd–‘es\t" << 
m_added_d–‘es
[2] << 
’dl
;

633 
cout
 << "STAT\t" << 
¿nge_¡r
 << "\ddedÙ®\t" << (
m_added_š£¹s
 + 
m_added_d–‘es
[0] + m_added_d–‘es[1] + m_added_d–‘es[2]è<< 
’dl
;

634 
cout
 << "STAT\t" << 
¿nge_¡r
 << "\tcŞlisiÚs\t" << 
cŞlisiÚs
 << 
’dl
;

635 
cout
 << "STAT\t" << 
¿nge_¡r
 << "\tÿched\t" << 
ÿched
 << 
’dl
;

636 
cout
 << 
æush
;

637 
	}
}

640 
	gRªge
::
	$lock
() {

641 
AcûssGroupM­T
::
™”©Ü
 
™”
 = 
m_acûss_group_m­
.
	`begš
(); i‹¸!ğm_acûss_group_m­.
	`’d
(); iter++)

642 (*
™”
).
£cÚd
->
	`lock
();

643 
	}
}

646 
	gRªge
::
	$uÆock
(
ušt64_t
 
»®_time¡amp
) {

649 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

650 
m_time¡amp
.
logiÿl
 = 
m_Ï¡_logiÿl_time¡amp
;

651 
m_time¡amp
.
»®
 = 
»®_time¡amp
;

653 
AcûssGroupM­T
::
™”©Ü
 
™”
 = 
m_acûss_group_m­
.
	`begš
(); i‹¸!ğm_acûss_group_m­.
	`’d
(); iter++)

654 (*
™”
).
£cÚd
->
	`uÆock
();

655 
	}
}

661 
	gRªge
::
	$»¶ay_¥l™_log
(
¡ršg
 &
log_dœ
, 
ušt64_t
 
»®_time¡amp
) {

662 
”rÜ
;

663 
Comm™LogR—d”PŒ
 
comm™_log_»ad”_±r
 = 
Ãw
 
	`Comm™LogR—d”
(
Glob®
::
dfs
, 
log_dœ
);

664 
BlockCom´essiÚH—d”Comm™Log
 
h—d”
;

665 cÚ¡ 
ušt8_t
 *
ba£
, *
±r
, *
’d
;

666 
size_t
 
Ën
;

667 
By‹SŒšg32T
 *
key
, *
v®ue
;

668 
size_t
 
nblocks
 = 0;

669 
size_t
 
couÁ
 = 0;

671 
comm™_log_»ad”_±r
->
	`š™Ÿlize_»ad
(0);

673 
comm™_log_»ad”_±r
->
	`Ãxt_block
(&
ba£
, &
Ën
, &
h—d”
)) {

675 ià(
	`¡rcmp
(
m_id’tif›r
.
Çme
, 
h—d”
.
	`g‘_bËÇme
())) {

676 
	`HT_ERRORF
("TabË‚ammis-m©ch iÀ¥l™†og„•Ïy \"%s\" !ğ\"%s\"", 
m_id’tif›r
.
Çme
, 
h—d”
.
	`g‘_bËÇme
());

677  
E¼Ü
::
RANGESERVER_CORRUPT_COMMIT_LOG
;

680 
±r
 = 
ba£
;

681 
’d
 = 
ba£
 + 
Ën
;

683 
±r
 < 
’d
) {

684 
key
 = (
By‹SŒšg32T
 *)
±r
;

685 
±r
 +ğ
	`L’gth
(
key
);

686 
v®ue
 = (
By‹SŒšg32T
 *)
±r
;

687 
±r
 +ğ
	`L’gth
(
v®ue
);

688 
	`add
(
key
, 
v®ue
, 
»®_time¡amp
);

689 
couÁ
++;

691 
nblocks
++;

695 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

696 
	`HT_INFOF
("Replayed %d updates (%d blocks) from split†og '%s' into %s[%s..%s]",

697 
couÁ
, 
nblocks
, 
log_dœ
.
	`c_¡r
(), 
m_id’tif›r
.
Çme
, 
m_¡¬t_row
.c_¡r(), 
m_’d_row
.c_str());

700 
m_added_š£¹s
 = 0;

701 
	`mem£t
(
m_added_d–‘es
, 0, 3*(
št64_t
));

703 
”rÜ
 = 
comm™_log_»ad”_±r
->
	`Ï¡_”rÜ
();

705  
E¼Ü
::
OK
;

706 
	}
}

712 
	gRªge
::
	$šüem’t_upd©e_couÁ”
() {

713 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_maš‹Çnû_mu‹x
);

714 
m_hŞd_upd©es
)

715 
m_maš‹Çnû_fšished_cÚd
.
	`wa™
(
lock
);

716 
m_upd©e_couÁ”
++;

717 
	}
}

723 
	gRªge
::
	$deüem’t_upd©e_couÁ”
() {

724 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_maš‹Çnû_mu‹x
);

725 
m_upd©e_couÁ”
--;

726 ià(
m_hŞd_upd©es
 && 
m_upd©e_couÁ”
 == 0)

727 
m_upd©e_qu›sû_cÚd
.
	`nÙify_Úe
();

728 
	}
}

733 
ušt64_t
 
	gRªge
::
	$g‘_Ï‹¡_time¡amp
() {

734 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

735  
m_time¡amp
.
logiÿl
;

736 
	}
}

741 
ušt64_t
 
	gRªge
::
	$g‘_sÿn_time¡amp
() {

742 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

743 
ušt64_t
 
time¡amp
 = 
m_sÿÂ”_time¡amp_cÚŒŞËr
.
	`g‘_Şde¡_upd©e_time¡amp
();

744 ià(
time¡amp
 !ğ0 &&ime¡am°<ğ
m_time¡amp
.
logiÿl
)

745  
time¡amp
;

746  
m_time¡amp
.
logiÿl
;

747 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/Range.h

20 #iâdeà
HYPERTABLE_RANGE_H


21 
	#HYPERTABLE_RANGE_H


	)

23 
	~<m­
>

24 
	~<¡ršg
>

25 
	~<veùÜ
>

27 
	~<boo¡/th»ad/cÚd™iÚ.hµ
>

29 
	~"Hy³¹abË/Lib/Comm™Log.h
"

30 
	~"Hy³¹abË/Lib/Key.h
"

31 
	~"Hy³¹abË/Lib/Ma¡”Cl›Á.h
"

32 
	~"Hy³¹abË/Lib/Schema.h
"

34 
	~"AcûssGroup.h
"

35 
	~"C–lStÜe.h
"

36 
	~"M‘ad©a.h
"

37 
	~"RªgeInfo.h
"

38 
	~"SÿÂ”Time¡ampCÚŒŞËr.h
"

39 
	~"Maš‹ÇnûTask.h
"

40 
	~"Time¡amp.h
"

42 
Çme¥aû
 
	gHy³¹abË
 {

44 şas 
	cRªge
 : 
public
 
C–lLi¡
 {

46 
¡d
::
	tm­
<
	t¡ršg
, 
	tAcûssGroup
 *> 
	tAcûssGroupM­T
;

47 
	g¡d
::
	tveùÜ
<
	tAcûssGroup
 *> 
	tCŞumnFamyVeùÜT
;

49 
	gpublic
:

50 
Rªge
(
Ma¡”Cl›ÁPŒ
 &
ma¡”_ş›Á_±r
, 
TabËId’tif›rT
 &
id’tif›r
, 
SchemaPŒ
 &
schemaPŒ
, 
RªgeT
 *
¿nge
, 
ušt64_t
 
soá_lim™
);

51 
	gvœtu®
 ~
Rªge
();

52 
vœtu®
 
add
(cÚ¡ 
By‹SŒšg32T
 *
key
, cÚ¡ By‹SŒšg32T *
v®ue
, 
ušt64_t
 
»®_time¡amp
);

53 
vœtu®
 cÚ¡ *
g‘_¥l™_row
();

54 
lock
();

55 
uÆock
(
ušt64_t
 
»®_time¡amp
);

57 
ušt64_t
 
disk_u§ge
();

59 
C–lLi¡SÿÂ”
 *
ü—‹_sÿÂ”
(
SÿnCÚ‹xtPŒ
 &
sÿnCÚ‹xtPŒ
);

61 
¡ršg
 
¡¬t_row
() {

62 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

63  
	gm_¡¬t_row
;

73 
¡ršg
 
’d_row
() {

74  
	gm_’d_row
;

77 
¡ršg
 
bË_Çme
() {

78  (
	g¡d
::
¡ršg
)
m_id’tif›r
.
Çme
;

81 
ušt64_t
 
g‘_Ï‹¡_time¡amp
();

82 
ušt64_t
 
g‘_sÿn_time¡amp
();

84 
»¶ay_¥l™_log
(
¡ršg
 &
logDœ
, 
ušt64_t
 
»®_time¡amp
);

86 
g‘_com·ùiÚ_´iÜ™y_d©a
(
¡d
::
veùÜ
<
AcûssGroup
::
Com·ùiÚPriÜ™yD©aT
> &
´iÜ™y_d©a_veùÜ
);

89 
boŞ
 
‹¡_ªd_£t_maš‹Çnû
() {

90 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

91 
boŞ
 
	gŞd_v®ue
 = 
m_maš‹Çnû_š_´og»ss
;

92 
	gm_maš‹Çnû_š_´og»ss
 = 
Œue
;

93  
	gŞd_v®ue
;

96 
do_¥l™
();

97 
do_com·ùiÚ
(
boŞ
 
majÜ
=
çl£
);

99 
šüem’t_upd©e_couÁ”
();

100 
deüem’t_upd©e_couÁ”
();

102 
add_upd©e_time¡amp
(
ušt64_t
 
time¡amp
) {

103 
	gm_sÿÂ”_time¡amp_cÚŒŞËr
.
add_upd©e_time¡amp
(
time¡amp
);

106 
»move_upd©e_time¡amp
(
ušt64_t
 
time¡amp
) {

107 
	gm_sÿÂ”_time¡amp_cÚŒŞËr
.
»move_upd©e_time¡amp
(
time¡amp
);

110 
boŞ
 
g‘_¥l™_šfo
(
¡d
::
¡ršg
 &
¥l™_row
, 
Comm™LogPŒ
 &
¥l™LogPŒ
, 
ušt64_t
 *
¥l™S¹Time
) {

111 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

112 *
	g¥l™S¹Time
 = 
m_¥l™_time¡amp
.
logiÿl
;

113 ià(
	gm_¥l™_time¡amp
.
	glogiÿl
 == 0) {

114 
¥l™_row
 = "";

115  
	gçl£
;

117 
	g¥l™_row
 = 
m_¥l™_row
;

118 
	g¥l™LogPŒ
 = 
m_¥l™_log_±r
;

119  
	gŒue
;

122 
	g¡d
::
veùÜ
<
AcûssGroup
 *> &
acûss_group_veùÜ
(è{  
m_acûss_group_veùÜ
; }

123 
AcûssGroup
 *
g‘_acûss_group
(
¡ršg
 &
lgName
è{  
	gm_acûss_group_m­
[lgName]; }

125 
dump_¡©s
();

127 
ušt64_t
 
g‘_size_lim™
(è{  
	gm_disk_lim™
; }

129 
boŞ
 
is_roÙ
(è{  
	gm_is_roÙ
; }

131 
drİ
() {

132 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

133 
size_t
 
	gi
=0; i<
	gm_acûss_group_veùÜ
.
size
(); i++)

134 
	gm_acûss_group_veùÜ
[
i
]->
drİ
();

137 
	g´iv©e
:

139 
lßd_ûÎ_¡Ües
(
M‘ad©a
 *
m‘ad©a
);

141 
boŞ
 
exŒaù_csid_äom_·th
(
¡d
::
¡ršg
 &
·th
, 
ušt32_t
 *
¡ÜeIdp
);

143 
run_com·ùiÚ
(
boŞ
 
majÜ
=
çl£
);

145 
	gboo¡
::
mu‹x
 
m_mu‹x
;

146 
Ma¡”Cl›ÁPŒ
 
	gm_ma¡”_ş›Á_±r
;

147 
TabËId’tif›rT
 
	gm_id’tif›r
;

148 
SchemaPŒ
 
	gm_schema
;

149 
	g¡d
::
¡ršg
 
m_¡¬t_row
;

150 
	g¡d
::
¡ršg
 
m_’d_row
;

151 
By‹SŒšg32PŒ
 
	gm_¡¬t_key_±r
;

152 
By‹SŒšg32PŒ
 
	gm_’d_key_±r
;

153 
AcûssGroupM­T
 
	gm_acûss_group_m­
;

154 
	g¡d
::
veùÜ
<
AcûssGroup
 *> 
m_acûss_group_veùÜ
;

155 
CŞumnFamyVeùÜT
 
	gm_cŞumn_çmy_veùÜ
;

156 
boŞ
 
	gm_maš‹Çnû_š_´og»ss
;

158 
Time¡amp
 
	gm_time¡amp
;

159 
ušt64_t
 
	gm_Ï¡_logiÿl_time¡amp
;

160 
Time¡amp
 
	gm_¥l™_time¡amp
;

161 
	g¡d
::
¡ršg
 
m_¥l™_row
;

162 
Comm™LogPŒ
 
	gm_¥l™_log_±r
;

164 
	gboo¡
::
mu‹x
 
m_maš‹Çnû_mu‹x
;

165 
	gboo¡
::
cÚd™iÚ
 
m_maš‹Çnû_fšished_cÚd
;

166 
	gboo¡
::
cÚd™iÚ
 
m_upd©e_qu›sû_cÚd
;

167 
boŞ
 
	gm_hŞd_upd©es
;

168 
ušt32_t
 
	gm_upd©e_couÁ”
;

169 
boŞ
 
	gm_is_roÙ
;

170 
SÿÂ”Time¡ampCÚŒŞËr
 
	gm_sÿÂ”_time¡amp_cÚŒŞËr
;

171 
ušt64_t
 
	gm_added_d–‘es
[3];

172 
ušt64_t
 
	gm_added_š£¹s
;

173 
ušt64_t
 
	gm_disk_lim™
;

176 
	gboo¡
::
	tšŒusive_±r
<
	tRªge
> 
	tRªgePŒ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/RangeInfo.h

20 #iâdeà
HYPERTABLE_TABLETINFO_H


21 
	#HYPERTABLE_TABLETINFO_H


	)

23 
	~<£t
>

24 
	~<¡ršg
>

25 
	~<veùÜ
>

26 
	~<io¡»am
>

28 
	~<boo¡/th»ad/mu‹x.hµ
>

30 
	~"CommÚ/Reã»nûCouÁ.h
"

32 
Çme¥aû
 
	gHy³¹abË
 {

34 şas 
	cRªgeInfo
 : 
public
 
Reã»nûCouÁ
 {

35 
public
:

36 
RªgeInfo
(è: 
m_mu‹x
(), 
m_bË_Çme
(""), 
m_¡¬t_row
(""), 
m_’d_row
(""), 
m_log_dœ
(""), 
ûÎStÜes
(), 
m_¥l™_log_dœ
(""), 
m_¥l™_pošt
("") {

40 
g‘_bË_Çme
(
¡d
::
¡ršg
 &
bËName
) {

41 
boo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

42 
	gbËName
 = 
m_bË_Çme
;

44 
£t_bË_Çme
(
¡d
::
¡ršg
 &
bËName
) {

45 
boo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

46 
	gm_bË_Çme
 = 
bËName
;

49 
g‘_¡¬t_row
(
¡d
::
¡ršg
 &
¡¬tRow
) {

50 
boo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

51 
	g¡¬tRow
 = 
m_¡¬t_row
;

53 
£t_¡¬t_row
(
¡d
::
¡ršg
 &
¡¬tRow
) {

54 
boo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

55 
	gm_¡¬t_row
 = 
¡¬tRow
;

58 
g‘_’d_row
(
¡d
::
¡ršg
 &
’dRow
) {

59 
boo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

60 
	g’dRow
 = 
m_’d_row
;

62 
£t_’d_row
(
¡d
::
¡ršg
 &
’dRow
) {

63 
boo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

64 
	gm_’d_row
 = 
’dRow
;

67 
g‘_loÿtiÚ
(
¡d
::
¡ršg
 &
loÿtiÚ
) {

68 
boo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

69 
	gloÿtiÚ
 = 
m_loÿtiÚ
;

71 
£t_loÿtiÚ
(
¡d
::
¡ršg
 &
loÿtiÚ
) {

72 
boo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

73 
	gm_loÿtiÚ
 = 
loÿtiÚ
;

76 
g‘_log_dœ
(
¡d
::
¡ršg
 &
logDœ
) {

77 
boo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

78 
	glogDœ
 = 
m_log_dœ
;

80 
£t_log_dœ
(
¡d
::
¡ršg
 &
logDœ
) {

81 
boo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

82 
	gm_log_dœ
 = 
logDœ
;

85 
add_ûÎ_¡Üe
(
¡d
::
¡ršg
 &
ûÎStÜe
) {

86 
boo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

87 
	gûÎStÜes
.
š£¹
(
ûÎStÜe
);

89 
»move_ûÎ_¡Üe
(
¡d
::
¡ršg
 &
ûÎStÜe
) {

90 
boo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

91 
	gûÎStÜes
.
”a£
(
ûÎStÜe
);

93 
g‘_bËs
(
¡d
::
veùÜ
<¡d::
¡ršg
> &
bËVec
) {

94 
boo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

95 
	g¡d
::
£t
<
¡d
::
¡ršg
>::
™”©Ü
 
™”
 = 
ûÎStÜes
.
begš
(); 
	g™”
 !ğûÎStÜes.
’d
(); iter++)

96 
	gbËVec
.
push_back
(*
™”
);

99 
g‘_¥l™_log_dœ
(
¡d
::
¡ršg
 &
¥l™LogDœ
) {

100 
boo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

101 
	g¥l™LogDœ
 = 
m_¥l™_log_dœ
;

103 
£t_¥l™_log_dœ
(
¡d
::
¡ršg
 &
¥l™LogDœ
) {

104 
boo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

105 
	gm_¥l™_log_dœ
 = 
¥l™LogDœ
;

108 
g‘_¥l™_pošt
(
¡d
::
¡ršg
 &
¥l™Pošt
) {

109 
boo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

110 
	g¥l™Pošt
 = 
m_¥l™_pošt
;

112 
£t_¥l™_pošt
(
¡d
::
¡ršg
 &
¥l™Pošt
) {

113 
boo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

114 
	gm_¥l™_pošt
 = 
¥l™Pošt
;

117 
	g´iv©e
:

118 
boo¡
::
mu‹x
 
m_mu‹x
;

119 
	g¡d
::
¡ršg
 
m_bË_Çme
;

120 
	g¡d
::
¡ršg
 
m_¡¬t_row
;

121 
	g¡d
::
¡ršg
 
m_’d_row
;

122 
	g¡d
::
¡ršg
 
m_loÿtiÚ
;

123 
	g¡d
::
¡ršg
 
m_log_dœ
;

124 
	g¡d
::
£t
<
¡d
::
¡ršg
> 
ûÎStÜes
;

125 
	g¡d
::
¡ršg
 
m_¥l™_log_dœ
;

126 
	g¡d
::
¡ršg
 
m_¥l™_pošt
;

129 
	gboo¡
::
	tšŒusive_±r
<
	tRªgeInfo
> 
	tRªgeInfoPŒ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/RangeServer.cc

21 
	~<ÿs£¹
>

22 
	~<¡ršg
>

24 
	~<boo¡/sh¬ed_¬¿y.hµ
>

27 
	~<sys/time.h
>

28 
	~<sys/»sourû.h
>

31 
	~"CommÚ/By‹Ord”.h
"

32 
	~"CommÚ/FeUts.h
"

33 
	~"CommÚ/md5.h
"

34 
	~"CommÚ/SŒšgExt.h
"

35 
	~"CommÚ/Sy¡em.h
"

37 
	~"Hy³¹abË/Lib/Comm™Log.h
"

38 
	~"Hy³¹abË/Lib/RªgeS”v”PrÙocŞ.h
"

40 
	~"DfsBrok”/Lib/Cl›Á.h
"

42 
	~"FlSÿnBlock.h
"

43 
	~"Glob®.h
"

44 
	~"HªdËrFaùÜy.h
"

45 
	~"Maš‹ÇnûQueue.h
"

46 
	~"RªgeS”v”.h
"

47 
	~"SÿnCÚ‹xt.h
"

48 
	~"Maš‹ÇnûTaskCom·ùiÚ.h
"

49 
	~"Maš‹ÇnûTaskLogCËªup.h
"

50 
	~"Maš‹ÇnûTaskS¶™.h
"

52 
usšg
 
Çme¥aû
 
Hy³¹abË
;

53 
usšg
 
Çme¥aû
 
	g¡d
;

55 
	gÇme¥aû
 {

56 cÚ¡ 
	gDEFAULT_SCANBUF_SIZE
 = 32768;

57 cÚ¡ 
	gDEFAULT_PORT
 = 38060;

64 
	gRªgeS”v”
::
RªgeS”v”
(
Prİ”t›sPŒ
 &
´İs_±r
, 
CÚÃùiÚMªag”PŒ
 &
cÚn_mªag”_±r
, 
AµliÿtiÚQueuePŒ
 &
­p_queue_±r
, 
Hy³r¥aû
::
SessiÚPŒ
 &
hy³r¥aû_±r
è: 
m_´İs_±r
Õrİs_±r), 
m_v”bo£
(
çl£
), 
m_cÚn_mªag”_±r
(cÚn_mªag”_±r), 
m_­p_queue_±r
×µ_queue_±r), 
m_hy³r¥aû_±r
(hy³r¥aû_±r), 
	$m_Ï¡_comm™_log_ş—n
(0) {

65 
”rÜ
;

66 
ušt16_t
 
pÜt
;

67 
Comm
 *
comm
 = 
cÚn_mªag”_±r
->
	`g‘_comm
();

69 
Glob®
::
¿ngeMaxBy‹s
 = 
´İs_±r
->
	`g‘_št64
("Hypertable.RangeServer.Range.MaxBytes", 200000000LL);

70 
Glob®
::
loÿl™yGroupMaxFes
 = 
´İs_±r
->
	`g‘_št
("Hypertable.RangeServer.AccessGroup.MaxFiles", 10);

71 
Glob®
::
loÿl™yGroupM”geFes
 = 
´İs_±r
->
	`g‘_št
("Hypertable.RangeServer.AccessGroup.MergeFiles", 4);

72 
Glob®
::
loÿl™yGroupMaxMemÜy
 = 
´İs_±r
->
	`g‘_št
("Hypertable.RangeServer.AccessGroup.MaxMemory", 50000000);

73 
pÜt
 = 
´İs_±r
->
	`g‘_št
("Hy³¹abË.RªgeS”v”.PÜt", 
DEFAULT_PORT
);

74 
m_sÿÂ”_‰l
 = (
time_t
)
´İs_±r
->
	`g‘_št
("Hypertable.RangeServer.Scanner.Ttl", 120);

75 
m_tim”_š‹rv®
 = 
´İs_±r
->
	`g‘_št
("Hypertable.RangeServer.Timer.Interval", 60);

77 ià(
m_tim”_š‹rv®
 >= 1000) {

78 
	`HT_ERROR
("Hypertable.RangeServer.Timer.Interval…ropertyoo†arge,ƒxiting ...");

79 
	`ex™
(1);

82 ià(
m_sÿÂ”_‰l
 < (
time_t
)10) {

83 
	`HT_WARNF
("V®u%u fÜ Hy³¹abË.RªgeS”v”.SÿÂ”.‰Èi toØsm®l, s‘tšgØ10", ()
m_sÿÂ”_‰l
);

84 
m_sÿÂ”_‰l
 = (
time_t
)10;

87 
ušt64_t
 
blockCacheMemÜy
 = 
´İs_±r
->
	`g‘_št64
("Hypertable.RangeServer.BlockCache.MaxMemory", 200000000LL);

88 
Glob®
::
blockCache
 = 
Ãw
 
	`FeBlockCache
(
blockCacheMemÜy
);

90 
	`as£¹
(
Glob®
::
loÿl™yGroupM”geFes
 <ğGlob®::
loÿl™yGroupMaxFes
);

92 
m_v”bo£
 = 
´İs_±r
->
	`g‘_boŞ
("Hy³¹abË.V”bo£", 
çl£
);

94 ià(
Glob®
::
v”bo£
) {

95 
cout
 << "Hy³¹abË.RªgeS”v”.AcûssGroup.MaxFes=" << 
Glob®
::
loÿl™yGroupMaxFes
 << 
’dl
;

96 
cout
 << "Hy³¹abË.RªgeS”v”.AcûssGroup.MaxMemÜy=" << 
Glob®
::
loÿl™yGroupMaxMemÜy
 << 
’dl
;

97 
cout
 << "Hy³¹abË.RªgeS”v”.AcûssGroup.M”geFes=" << 
Glob®
::
loÿl™yGroupM”geFes
 << 
’dl
;

98 
cout
 << "Hy³¹abË.RªgeS”v”.BlockCache.MaxMemÜy=" << 
blockCacheMemÜy
 << 
’dl
;

99 
cout
 << "Hy³¹abË.RªgeS”v”.Rªge.MaxBy‹s=" << 
Glob®
::
¿ngeMaxBy‹s
 << 
’dl
;

100 
cout
 << "Hy³¹abË.RªgeS”v”.PÜt=" << 
pÜt
 << 
’dl
;

107 
Glob®
::
´ÙocŞ
 = 
Ãw
 
Hy³¹abË
::
	`RªgeS”v”PrÙocŞ
();

109 
DfsBrok”
::
Cl›Á
 *
dfsCl›Á
 = 
Ãw
 DfsBrok”::
	`Cl›Á
(
m_cÚn_mªag”_±r
, 
´İs_±r
);

111 ià(
m_v”bo£
) {

112 
cout
 << "DfsBrok”.Ho¡=" << 
´İs_±r
->
	`g‘
("DfsBrok”.Ho¡", ""è<< 
’dl
;

113 
cout
 << "DfsBrok”.PÜt=" << 
´İs_±r
->
	`g‘
("DfsBrok”.PÜt", ""è<< 
’dl
;

114 
cout
 << "DfsBrok”.Timeout=" << 
´İs_±r
->
	`g‘
("DfsBrok”.Timeout", ""è<< 
’dl
;

117 ià(!
dfsCl›Á
->
	`wa™_fÜ_cÚÃùiÚ
(30)) {

118 
	`HT_ERROR
("Unableo connecto DFS Broker,ƒxiting...");

119 
	`ex™
(1);

122 
Glob®
::
dfs
 = 
dfsCl›Á
;

128 cÚ¡ *
logHo¡
 = 
´İs_±r
->
	`g‘
("Hypertable.RangeServer.CommitLog.DfsBroker.Host", 0);

129 
ušt16_t
 
logPÜt
 = 
´İs_±r
->
	`g‘_št
("Hypertable.RangeServer.CommitLog.DfsBroker.Port", 0);

130 
sockaddr_š
 
addr
;

131 ià(
logHo¡
 != 0) {

132 
IÃtAddr
::
	`š™Ÿlize
(&
addr
, 
logHo¡
, 
logPÜt
);

133 
dfsCl›Á
 = 
Ãw
 
DfsBrok”
::
	`Cl›Á
(
m_cÚn_mªag”_±r
, 
addr
, 600);

134 ià(!
dfsCl›Á
->
	`wa™_fÜ_cÚÃùiÚ
(30)) {

135 
	`HT_ERROR
("Unableo connecto DFS Broker,ƒxiting...");

136 
	`ex™
(1);

138 
Glob®
::
logDfs
 = 
dfsCl›Á
;

141 
Glob®
::
logDfs
 = Glob®::
dfs
;

149 
timev®
 
tv®
;

150 
¡d
::
¡ršg
 
ho¡SŒ
;

151 
sockaddr_š
 
addr
;

153 
IÃtAddr
::
	`g‘_ho¡Çme
(
ho¡SŒ
);

154 ià(!
IÃtAddr
::
	`š™Ÿlize
(&
addr
, 
ho¡SŒ
.
	`c_¡r
(), 
pÜt
))

155 
	`ex™
(1);

157 
	`g‘timeofday
(&
tv®
, 0);

159 
m_loÿtiÚ
 = (
¡d
::
¡ršg
)
	`š‘_Áß
(
addr
.
sš_addr
è+ "_" + ()
pÜt
 + "_" + (
ušt32_t
)
tv®
.
tv_£c
;

162 ià(
	`dœeùÜy_š™Ÿlize
(
´İs_±r
è!ğ
E¼Ü
::
OK
)

163 
	`ex™
(1);

166 
Glob®
::
maš‹Çnû_queue
 = 
Ãw
 
	`Maš‹ÇnûQueue
(1);

172 
CÚÃùiÚHªdËrFaùÜyPŒ
 
	`chfPŒ
(
Ãw
 
	`HªdËrFaùÜy
(
comm
, 
m_­p_queue_±r
, 
this
));

173 
sockaddr_š
 
addr
;

174 
IÃtAddr
::
	`š™Ÿlize
(&
addr
, 
INADDR_ANY
, 
pÜt
);

175 ià((
”rÜ
 = 
comm
->
	`li¡’
(
addr
, 
chfPŒ
)è!ğ
E¼Ü
::
OK
) {

176 
	`HT_ERRORF
("Li¡’ƒ¼Ü‡dd»ss=%s:%d - %s", 
	`š‘_Áß
(
addr
.
sš_addr
), 
pÜt
, 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

177 
	`ex™
(1);

184 
m_ma¡”_ş›Á_±r
 = 
Ãw
 
	`Ma¡”Cl›Á
(
m_cÚn_mªag”_±r
, 
m_hy³r¥aû_±r
, 300, 
m_­p_queue_±r
);

185 
m_ma¡”_cÚÃùiÚ_hªdËr
 = 
Ãw
 
	`CÚÃùiÚHªdËr
(
comm
, 
m_­p_queue_±r
, 
this
, 
m_ma¡”_ş›Á_±r
);

186 
m_ma¡”_ş›Á_±r
->
	`š™Ÿ‹_cÚÃùiÚ
(
m_ma¡”_cÚÃùiÚ_hªdËr
);

187 
	}
}

193 
	gRªgeS”v”
::~
	$RªgeS”v”
() {

194 
d–‘e
 
Glob®
::
blockCache
;

195 
d–‘e
 
Glob®
::
´ÙocŞ
;

196 
m_hy³r¥aû_±r
 = 0;

197 
d–‘e
 
Glob®
::
dfs
;

198 ià(
Glob®
::
logDfs
 !ğGlob®::
dfs
)

199 
d–‘e
 
Glob®
::
logDfs
;

200 
Glob®
::
m‘ad©a_bË_±r
 = 0;

201 
m_ma¡”_ş›Á_±r
 = 0;

202 
m_cÚn_mªag”_±r
 = 0;

203 
m_­p_queue_±r
 = 0;

204 
	}
}

213 
	gRªgeS”v”
::
	$dœeùÜy_š™Ÿlize
(
Prİ”t›sPŒ
 &
´İs_±r
) {

214 
”rÜ
;

215 
boŞ
 
exi¡s
;

216 
¡d
::
¡ršg
 
tİDœ
;

221 ià((
”rÜ
 = 
m_hy³r¥aû_±r
->
	`exi¡s
("/hy³¹abË/£rv”s", &
exi¡s
)è!ğ
E¼Ü
::
OK
) {

222 
	`HT_ERRORF
("ProbËm checkšgƒxi¡’û oà'/hy³¹abË/£rv”s' Hy³r¥aû dœeùÜy - %s", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

223  
”rÜ
;

226 ià(!
exi¡s
) {

227 
	`HT_ERROR
("Hyperspace directory '/hypertable/servers' does‚otƒxist,ry„unning 'Hypertable.master --initialize' first");

228  
”rÜ
;

231 
tİDœ
 = (
¡d
::
¡ršg
)"/hy³¹abË/£rv”s/" + 
m_loÿtiÚ
;

237 
ušt32_t
 
oæags
 = 
OPEN_FLAG_READ
 | 
OPEN_FLAG_WRITE
 | 
OPEN_FLAG_CREATE
 | 
OPEN_FLAG_EXCL
 | 
OPEN_FLAG_LOCK_EXCLUSIVE
;

238 
HªdËC®lbackPŒ
 
nuÎC®lbackPŒ
;

240 ià((
”rÜ
 = 
m_hy³r¥aû_±r
->
	`İ’
(
tİDœ
.
	`c_¡r
(), 
oæags
, 
nuÎC®lbackPŒ
, &
m_exi¡’û_fe_hªdË
)è!ğ
E¼Ü
::
OK
) {

241 
	`HT_ERRORF
("ProbËm c»©šg Hy³r¥aû s”v”ƒxi¡ªû f'%s' - %s", 
tİDœ
.
	`c_¡r
(), 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

242 
	`ex™
(1);

245 ià((
”rÜ
 = 
m_hy³r¥aû_±r
->
	`g‘_£qu’ûr
(
m_exi¡’û_fe_hªdË
, &
m_exi¡’û_fe_£qu’ûr
)è!ğ
E¼Ü
::
OK
) {

246 
	`HT_ERRORF
("ProbËm obššg†ock sequ’û¸fÜ f'%s' - %s", 
tİDœ
.
	`c_¡r
(), 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

247 
	`ex™
(1);

250 
Glob®
::
logDœ
 = (
¡ršg
)
tİDœ
.
	`c_¡r
() + "/commit/primary";

255 ià((
”rÜ
 = 
Glob®
::
logDfs
->
	`mkdœs
(Glob®::
logDœ
)è!ğ
E¼Ü
::
OK
) {

256 
	`HT_ERRORF
("ProbËm c»©šg†oÿÈlog dœeùÜy '%s'", 
Glob®
::
logDœ
.
	`c_¡r
());

257  
”rÜ
;

260 ià(
Glob®
::
v”bo£
)

261 
cout
 << "logDœ=" << 
Glob®
::
logDœ
 << 
’dl
;

263 
Glob®
::
log
 = 
Ãw
 
	`Comm™Log
(Glob®::
logDfs
, Glob®::
logDœ
, 
´İs_±r
);

265  
E¼Ü
::
OK
;

266 
	}
}

273 
	gRªgeS”v”
::
	$com·ù
(
Re¥Ú£C®lback
 *
cb
, 
TabËId’tif›rT
 *
bË
, 
RªgeT
 *
¿nge
, 
ušt8_t
 
com·ùiÚ_ty³
) {

274 
”rÜ
 = 
E¼Ü
::
OK
;

275 
¡d
::
¡ršg
 
”rMsg
;

276 
TabËInfoPŒ
 
bËInfoPŒ
;

277 
RªgePŒ
 
¿nge_±r
;

278 
boŞ
 
majÜ
 = 
çl£
;

281 ià(
com·ùiÚ_ty³
 == 1)

282 
majÜ
 = 
Œue
;

284 ià(
Glob®
::
v”bo£
) {

285 
cout
 << *
bË
;

286 
cout
 << *
¿nge
;

287 
cout
 << "Com·ùiÚy³ = " << (
majÜ
 ? "majÜ" : "mšÜ"è<< 
’dl
;

293 ià(!
	`g‘_bË_šfo
(
bË
->
Çme
, 
bËInfoPŒ
)) {

294 
”rÜ
 = 
E¼Ü
::
RANGESERVER_RANGE_NOT_FOUND
;

295 
”rMsg
 = "NØ¿nge lßded fÜabË '" + (
¡d
::
¡ršg
)
bË
->
Çme
 + "'";

296 
abÜt
;

302 ià(!
bËInfoPŒ
->
	`g‘_¿nge
(
¿nge
, 
¿nge_±r
)) {

303 
”rÜ
 = 
E¼Ü
::
RANGESERVER_RANGE_NOT_FOUND
;

304 
”rMsg
 = (
¡d
::
¡ršg
)
bË
->
Çme
 + "[" + 
¿nge
->
¡¬tRow
 + ".." +„ªge->
’dRow
 + "]";

305 
abÜt
;

309 ià(!
¿nge_±r
->
	`‹¡_ªd_£t_maš‹Çnû
())

310 
Glob®
::
maš‹Çnû_queue
->
	`add
Ğ
Ãw
 
	`Maš‹ÇnûTaskCom·ùiÚ
(
¿nge_±r
, 
majÜ
) );

312 ià((
”rÜ
 = 
cb
->
	`»¥Ú£_ok
()è!ğ
E¼Ü
::
OK
) {

313 
	`HT_ERRORF
("ProbËm s’dšg OK„e¥Ú£ - %s", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

316 ià(
Glob®
::
v”bo£
) {

317 
	`HT_INFOF
("Compaction (%s) scheduled forable '%s'ƒnd„ow '%s'",

318 (
majÜ
 ? "majÜ" : "mšÜ"), 
bË
->
Çme
, 
¿nge
->
’dRow
);

321 
”rÜ
 = 
E¼Ü
::
OK
;

323 
abÜt
:

324 ià(
”rÜ
 !ğ
E¼Ü
::
OK
) {

325 
	`HT_ERRORF
("% '%s'", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
), 
”rMsg
.
	`c_¡r
());

326 ià((
”rÜ
 = 
cb
->
	`”rÜ
Ó¼Ü, 
”rMsg
)è!ğ
E¼Ü
::
OK
) {

327 
	`HT_ERRORF
("ProbËm s’dšgƒ¼Ü„e¥Ú£ - %s", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

330 
	}
}

337 
	gRªgeS”v”
::
	$ü—‹_sÿÂ”
(
Re¥Ú£C®lbackC»©eSÿÂ”
 *
cb
, 
TabËId’tif›rT
 *
bË
, 
RªgeT
 *
¿nge
, 
SÿnS³cifiÿtiÚT
 *
sÿn_¥ec
) {

338 
ušt8_t
 *
kvBufãr
 = 0;

339 
ušt32_t
 *
kvL’p
 = 0;

340 
”rÜ
 = 
E¼Ü
::
OK
;

341 
¡d
::
¡ršg
 
”rMsg
;

342 
TabËInfoPŒ
 
bËInfoPŒ
;

343 
RªgePŒ
 
¿ngePŒ
;

344 
C–lLi¡SÿÂ”PŒ
 
sÿÂ”PŒ
;

345 
boŞ
 
mÜe
 = 
Œue
;

346 
ušt32_t
 
id
;

347 
ušt64_t
 
sÿn_time¡amp
;

348 
SchemaPŒ
 
schemaPŒ
;

349 
SÿnCÚ‹xtPŒ
 
sÿnCÚ‹xtPŒ
;

351 ià(
Glob®
::
v”bo£
) {

352 
cout
 << "RªgeS”v”::ü—‹_sÿÂ”" << 
’dl
;

353 
cout
 << *
bË
;

354 
cout
 << *
¿nge
;

355 
cout
 << *
sÿn_¥ec
;

358 
Œy
 {

360 ià(!
	`g‘_bË_šfo
(
bË
->
Çme
, 
bËInfoPŒ
))

361 
throw
 
Hy³¹abË
::
	`Exû±iÚ
(
E¼Ü
::
RANGESERVER_RANGE_NOT_FOUND
,

362 (
¡d
::
¡ršg
)
bË
->
Çme
 + "[" + 
¿nge
->
¡¬tRow
 + ".." +„ªge->
’dRow
 + "]");

364 ià(!
bËInfoPŒ
->
	`g‘_¿nge
(
¿nge
, 
¿ngePŒ
))

365 
throw
 
Hy³¹abË
::
	`Exû±iÚ
(
E¼Ü
::
RANGESERVER_RANGE_NOT_FOUND
,

366 (
¡d
::
¡ršg
)
bË
->
Çme
 + "[" + 
¿nge
->
¡¬tRow
 + ".." +„ªge->
’dRow
 + "]");

368 
schemaPŒ
 = 
bËInfoPŒ
->
	`g‘_schema
();

370 
sÿn_time¡amp
 = 
¿ngePŒ
->
	`g‘_sÿn_time¡amp
();

372 ià(
sÿn_time¡amp
 != 0)

373 
sÿn_time¡amp
++;

375 
sÿnCÚ‹xtPŒ
 = 
Ãw
 
	`SÿnCÚ‹xt
(
sÿn_time¡amp
, 
sÿn_¥ec
, 
¿nge
, 
schemaPŒ
);

377 
sÿÂ”PŒ
 = 
¿ngePŒ
->
	`ü—‹_sÿÂ”
(
sÿnCÚ‹xtPŒ
);

380 ià(!
sÿÂ”PŒ
)

381 
throw
 
Hy³¹abË
::
	`Exû±iÚ
(
E¼Ü
::
RANGESERVER_RANGE_NOT_FOUND
,

382 (
¡d
::
¡ršg
)
bË
->
Çme
 + "[" + 
¿nge
->
¡¬tRow
 + ".." +„ªge->
’dRow
 + "]");

384 
kvBufãr
 = 
Ãw
 
ušt8_t
 [ (
št32_t
è+ 
DEFAULT_SCANBUF_SIZE
 ];

385 
kvL’p
 = (
ušt32_t
 *)
kvBufãr
;

387 
mÜe
 = 
	`FlSÿnBlock
(
sÿÂ”PŒ
, 
kvBufãr
+(
št32_t
), 
DEFAULT_SCANBUF_SIZE
, 
kvL’p
);

388 ià(
mÜe
)

389 
id
 = 
Glob®
::
sÿÂ”M­
.
	`put
(
sÿÂ”PŒ
, 
¿ngePŒ
);

391 
id
 = 0;

393 ià(
Glob®
::
v”bo£
) {

394 
	`HT_INFOF
("SucûssfuÎy c»©ed sÿÂ” (id=%dèÚabË '%s'", 
id
, 
bË
->
Çme
);

401 
mÜeFÏg
 = 
mÜe
 ? 0 : 1;

402 
ExtBufãrT
 
ext
;

403 
ext
.
buf
 = 
kvBufãr
;

404 
ext
.
Ën
 = (
št32_t
è+ *
kvL’p
;

405 ià((
”rÜ
 = 
cb
->
	`»¥Ú£
(
mÜeFÏg
, 
id
, 
ext
)è!ğ
E¼Ü
::
OK
) {

406 
	`HT_ERRORF
("ProbËm s’dšg OK„e¥Ú£ - %s", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

410 
	`ÿtch
 (
Hy³¹abË
::
Exû±iÚ
 &
e
) {

411 
”rÜ
;

412 
	`HT_ERRORF
("% '%s'", 
E¼Ü
::
	`g‘_‹xt
(
e
.
	`code
()),ƒ.
	`wh©
());

413 ià((
”rÜ
 = 
cb
->
	`”rÜ
(
e
.
	`code
(),ƒ.
	`wh©
())è!ğ
E¼Ü
::
OK
) {

414 
	`HT_ERRORF
("ProbËm s’dšgƒ¼Ü„e¥Ú£ - %s", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

417 
	}
}

420 
	gRªgeS”v”
::
	$de¡roy_sÿÂ”
(
Re¥Ú£C®lback
 *
cb
, 
ušt32_t
 
sÿÂ”Id
) {

421 
	`HT_INFOF
("de¡royšg sÿÂ” id=%u", 
sÿÂ”Id
);

422 
Glob®
::
sÿÂ”M­
.
	`»move
(
sÿÂ”Id
);

423 
cb
->
	`»¥Ú£_ok
();

424 
	}
}

427 
	gRªgeS”v”
::
	$ãtch_sÿnblock
(
Re¥Ú£C®lbackF‘chSÿnblock
 *
cb
, 
ušt32_t
 
sÿÂ”Id
) {

428 
¡ršg
 
”rMsg
;

429 
”rÜ
 = 
E¼Ü
::
OK
;

430 
C–lLi¡SÿÂ”PŒ
 
sÿÂ”PŒ
;

431 
RªgePŒ
 
¿ngePŒ
;

432 
boŞ
 
mÜe
 = 
Œue
;

433 
ušt8_t
 *
kvBufãr
 = 0;

434 
ušt32_t
 *
kvL’p
 = 0;

435 
ušt32_t
 
by‹sF‘ched
 = 0;

437 ià(
Glob®
::
v”bo£
) {

438 
cout
 << "RªgeS”v”::ãtch_sÿnblock" << 
’dl
;

439 
cout
 << "SÿÂ” ID = " << 
sÿÂ”Id
 << 
’dl
;

442 ià(!
Glob®
::
sÿÂ”M­
.
	`g‘
(
sÿÂ”Id
, 
sÿÂ”PŒ
, 
¿ngePŒ
)) {

443 
”rÜ
 = 
E¼Ü
::
RANGESERVER_INVALID_SCANNER_ID
;

444 
tbuf
[32];

445 
	`¥rštf
(
tbuf
, "%d", 
sÿÂ”Id
);

446 
”rMsg
 = (
¡ršg
)
tbuf
;

447 
abÜt
;

450 
kvBufãr
 = 
Ãw
 
ušt8_t
 [ (
št32_t
è+ 
DEFAULT_SCANBUF_SIZE
 ];

451 
kvL’p
 = (
ušt32_t
 *)
kvBufãr
;

453 
mÜe
 = 
	`FlSÿnBlock
(
sÿÂ”PŒ
, 
kvBufãr
+(
št32_t
), 
DEFAULT_SCANBUF_SIZE
, 
kvL’p
);

454 ià(!
mÜe
)

455 
Glob®
::
sÿÂ”M­
.
	`»move
(
sÿÂ”Id
);

456 
by‹sF‘ched
 = *
kvL’p
;

462 
mÜeFÏg
 = 
mÜe
 ? 0 : 1;

463 
ExtBufãrT
 
ext
;

464 
ext
.
buf
 = 
kvBufãr
;

465 
ext
.
Ën
 = (
št32_t
è+ *
kvL’p
;

466 ià((
”rÜ
 = 
cb
->
	`»¥Ú£
(
mÜeFÏg
, 
sÿÂ”Id
, 
ext
)è!ğ
E¼Ü
::
OK
) {

467 
	`HT_ERRORF
("ProbËm s’dšg OK„e¥Ú£ - %s", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

471 ià(
Glob®
::
v”bo£
) {

472 
	`HT_INFOF
("SucûssfuÎy f‘ched %d by‹ oàsÿÀd©a", 
by‹sF‘ched
);

475 
”rÜ
 = 
E¼Ü
::
OK
;

477 
abÜt
:

478 ià(
”rÜ
 !ğ
E¼Ü
::
OK
) {

479 
	`HT_ERRORF
("% '%s'", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
), 
”rMsg
.
	`c_¡r
());

480 ià((
”rÜ
 = 
cb
->
	`”rÜ
Ó¼Ü, 
”rMsg
)è!ğ
E¼Ü
::
OK
) {

481 
	`HT_ERRORF
("ProbËm s’dšgƒ¼Ü„e¥Ú£ - %s", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

484 
	}
}

490 
	gRªgeS”v”
::
	$lßd_¿nge
(
Re¥Ú£C®lback
 *
cb
, 
TabËId’tif›rT
 *
bË
, 
RªgeT
 *
¿nge
, 
ušt64_t
 
soá_lim™
, 
ušt16_t
 
æags
) {

491 
DyÇmicBufãr
 
	`’dRowBufãr
(0);

492 
¡d
::
¡ršg
 
”rMsg
;

493 
”rÜ
 = 
E¼Ü
::
OK
;

494 
SchemaPŒ
 
schemaPŒ
;

495 
TabËInfoPŒ
 
bËInfoPŒ
;

496 
RªgePŒ
 
¿ngePŒ
;

497 
¡ršg
 
bËHdfsDœ
;

498 
¡ršg
 
¿ngeHdfsDœ
;

499 
md5Dige¡SŒ
[33];

500 
boŞ
 
»gi¡”TabË
 = 
çl£
;

501 
boŞ
 
is_roÙ
 = !
	`¡rcmp
(
bË
->
Çme
, "METADATA"è&& (*
¿nge
->
¡¬tRow
 =ğ0è&& !¡rcmpÔªge->
’dRow
, 
Key
::
END_ROOT_ROW
);

502 
TabËSÿÂ”PŒ
 
sÿÂ”_±r
;

503 
TabËMutÜPŒ
 
mutÜ_±r
;

504 
SÿnS³cifiÿtiÚT
 
sÿn_¥ec
;

505 
C–lT
 
ûÎ
;

506 
KeyS³c
 
key
;

507 
¡d
::
¡ršg
 
m‘ad©a_key_¡r
;

508 
¡d
::
¡ršg
 
¡¬t_row
, 
¥l™_log_dœ
;

510 ià(
Glob®
::
v”bo£
) {

511 
cout
 << "lßd_¿nge" << 
’dl
;

512 
cout
 << *
bË
;

513 
cout
 << *
¿nge
;

514 
cout
 << "æag ğ" << 
æags
 << 
’dl
;

515 
cout
 << 
æush
;

518 
Œy
 {

523 ià(!
	`g‘_bË_šfo
(
bË
->
Çme
, 
bËInfoPŒ
)) {

524 
bËInfoPŒ
 = 
Ãw
 
	`TabËInfo
(
m_ma¡”_ş›Á_±r
, 
bË
, 
schemaPŒ
);

525 
»gi¡”TabË
 = 
Œue
;

531 ià((
”rÜ
 = 
	`v”ify_schema
(
bËInfoPŒ
, 
bË
->
g’”©iÚ
, 
”rMsg
)è!ğ
E¼Ü
::
OK
)

532 
throw
 
	`Exû±iÚ
(
”rÜ
, 
”rMsg
);

534 ià(
»gi¡”TabË
)

535 
	`£t_bË_šfo
(
bË
->
Çme
, 
bËInfoPŒ
);

540 ià(
bËInfoPŒ
->
	`g‘_¿nge
(
¿nge
, 
¿ngePŒ
))

541 
throw
 
	`Exû±iÚ
(
E¼Ü
::
RANGESERVER_RANGE_ALREADY_LOADED
, (
¡d
::
¡ršg
)
bË
->
Çme
 + "[" + 
¿nge
->
¡¬tRow
 + ".." +„ªge->
’dRow
 + "]");

546 ià(!
Glob®
::
m‘ad©a_bË_±r
) {

547 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

548 
Glob®
::
m‘ad©a_bË_±r
 = 
Ãw
 
	`TabË
(
m_´İs_±r
, 
m_cÚn_mªag”_±r
, Glob®::
hy³r¥aû_±r
, "METADATA");

556 ià(!
is_roÙ
) {

558 
m‘ad©a_key_¡r
 = 
¡d
::
	`¡ršg
(""è+ (
ušt32_t
)
bË
->
id
 + ":" + 
¿nge
->
’dRow
;

563 ià((
”rÜ
 = 
Glob®
::
m‘ad©a_bË_±r
->
	`ü—‹_mutÜ
(
mutÜ_±r
)è!ğ
E¼Ü
::
OK
)

564 
throw
 
	`Exû±iÚ
(
”rÜ
, "Problem creating mutator on METADATAable");

565 
key
.
row
 = 
m‘ad©a_key_¡r
.
	`c_¡r
();

566 
key
.
row_Ën
 = 
	`¡¾’
(
m‘ad©a_key_¡r
.
	`c_¡r
());

567 
key
.
cŞumn_çmy
 = "Location";

568 
key
.
cŞumn_qu®if›r
 = 0;

569 
key
.
cŞumn_qu®if›r_Ën
 = 0;

570 
mutÜ_±r
->
	`£t
(0, 
key
, (
ušt8_t
 *)
m_loÿtiÚ
.
	`c_¡r
(), 
	`¡¾’
(m_location.c_str()));

571 
mutÜ_±r
->
	`æush
();

573 
boŞ
 
gÙ_¡¬t_row
 = 
çl£
;

575 
sÿn_¥ec
.
rowLim™
 = 1;

576 
sÿn_¥ec
.
max_v”siÚs
 = 1;

577 
sÿn_¥ec
.
¡¬tRow
 = 
m‘ad©a_key_¡r
.
	`c_¡r
();

578 
sÿn_¥ec
.
¡¬tRowInşusive
 = 
Œue
;

579 
sÿn_¥ec
.
’dRow
 = 
m‘ad©a_key_¡r
.
	`c_¡r
();

580 
sÿn_¥ec
.
’dRowInşusive
 = 
Œue
;

581 
sÿn_¥ec
.
š‹rv®
.
fœ¡
 = 0;

582 
sÿn_¥ec
.
š‹rv®
.
£cÚd
 = 0;

584 
sÿn_¥ec
.
cŞumns
.
	`ş—r
();

585 
sÿn_¥ec
.
cŞumns
.
	`push_back
("StartRow");

586 
sÿn_¥ec
.
cŞumns
.
	`push_back
("SplitLogDir");

587 
sÿn_¥ec
.
»tuº_d–‘es
 = 
çl£
;

589 ià((
”rÜ
 = 
Glob®
::
m‘ad©a_bË_±r
->
	`ü—‹_sÿÂ”
(
sÿn_¥ec
, 
sÿÂ”_±r
)è!ğ
E¼Ü
::
OK
)

590 
throw
 
	`Exû±iÚ
(
”rÜ
, "Problem creating scanner on METADATAable");

592 
sÿÂ”_±r
->
	`Ãxt
(
ûÎ
)) {

593 ià(!
	`¡rcmp
(
ûÎ
.
cŞumn_çmy
, "StartRow")) {

594 ià(
ûÎ
.
v®ue_Ën
 > 0)

595 
¡¬t_row
 = 
¡d
::
	`¡ršg
((cÚ¡ *)
ûÎ
.
v®ue
, c–l.
v®ue_Ën
);

596 
gÙ_¡¬t_row
 = 
Œue
;

598 ià(!
	`¡rcmp
(
ûÎ
.
cŞumn_çmy
, "SplitLogDir")) {

599 ià(
ûÎ
.
v®ue_Ën
 > 0)

600 
¥l™_log_dœ
 = 
¡d
::
	`¡ršg
((cÚ¡ *)
ûÎ
.
v®ue
, c–l.
v®ue_Ën
);

604 
	`HT_ERROR
("Scanner„eturned column‚ot„equested.");

608 ià(!
gÙ_¡¬t_row
)

609 
throw
 
	`Exû±iÚ
(
E¼Ü
::
RANGESERVER_NO_METADATA_FOR_RANGE
, (
¡d
::
¡ršg
)"S¹Row fÜ METADATA[" + 
m‘ad©a_key_¡r
 + "]‚ot found");

612 ià(*
¿nge
->
¡¬tRow
 =ğ0 && 
¡¬t_row
 !ğ"" || 
	`¡rcmp
Ôªge->¡¬tRow, s¹_row.
	`c_¡r
()))

613 
throw
 
	`Exû±iÚ
(
E¼Ü
::
RANGESERVER_RANGE_MISMATCH
, (
¡d
::
¡ršg
)"S¹Row '" + std::
	`¡ršg
((cÚ¡ *)
ûÎ
.
v®ue
, c–l.
v®ue_Ën
è+ "' dÛ nÙ m©ch '" + 
¿nge
->
¡¬tRow
 + "'");

617 
ušt64_t
 
hªdË
;

618 
HªdËC®lbackPŒ
 
nuÎC®lbackPŒ
;

619 
ušt32_t
 
oæags
 = 
OPEN_FLAG_READ
 | 
OPEN_FLAG_WRITE
 | 
OPEN_FLAG_CREATE
;

621 
	`HT_INFO
("Loading„oot METADATA„ange");

623 ià((
”rÜ
 = 
m_hy³r¥aû_±r
->
	`İ’
("/hy³¹abË/roÙ", 
oæags
, 
nuÎC®lbackPŒ
, &
hªdË
)è!ğ
E¼Ü
::
OK
) {

624 
	`HT_ERRORF
("ProbËm c»©šg Hy³r¥aû„oÙ f'/hy³¹abË/roÙ' - %s", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

625 
DUMP_CORE
;

628 ià((
”rÜ
 = 
m_hy³r¥aû_±r
->
	`©Œ_£t
(
hªdË
, "loÿtiÚ", 
m_loÿtiÚ
.
	`c_¡r
(), 
	`¡¾’
(m_loÿtiÚ.c_¡r()))è!ğ
E¼Ü
::
OK
) {

629 
	`HT_ERRORF
("ProbËm c»©šg‡‰ribu‹ 'loÿtiÚ' oÀHy³r¥aû f'/hy³¹abË/roÙ' - %s", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

630 
DUMP_CORE
;

633 
m_hy³r¥aû_±r
->
	`şo£
(
hªdË
);

636 
schemaPŒ
 = 
bËInfoPŒ
->
	`g‘_schema
();

643 
	`as£¹
(*
¿nge
->
’dRow
 != 0);

644 
	`md5_¡ršg
(
¿nge
->
’dRow
, 
md5Dige¡SŒ
);

645 
md5Dige¡SŒ
[24] = 0;

646 
bËHdfsDœ
 = (
¡ršg
)"/hy³¹abË/bËs/" + (¡ršg)
bË
->
Çme
;

647 
li¡
<
Schema
::
AcûssGroup
 *> *
lgLi¡
 = 
schemaPŒ
->
	`g‘_acûss_group_li¡
();

648 
li¡
<
Schema
::
AcûssGroup
 *>::
™”©Ü
 
lgI‹r
 = 
lgLi¡
->
	`begš
();†gI‹¸!ğlgLi¡->
	`’d
();†gIter++) {

650 
¿ngeHdfsDœ
 = 
bËHdfsDœ
 + "/" + (*
lgI‹r
)->
Çme
 + "/" + 
md5Dige¡SŒ
;

651 ià((
”rÜ
 = 
Glob®
::
dfs
->
	`mkdœs
(
¿ngeHdfsDœ
)è!ğ
E¼Ü
::
OK
)

652 
throw
 
	`Exû±iÚ
(
”rÜ
, (
¡d
::
¡ršg
)"ProbËm c»©šg„ªgdœeùÜy '" + 
¿ngeHdfsDœ
 + "'");

656 
¿ngePŒ
 = 
Ãw
 
	`Rªge
(
m_ma¡”_ş›Á_±r
, *
bË
, 
schemaPŒ
, 
¿nge
, 
soá_lim™
);

665 ià(
¥l™_log_dœ
 != "") {

666 
ušt64_t
 
time¡amp
 = 
Glob®
::
log
->
	`g‘_time¡amp
();

667 ià((
”rÜ
 = 
Glob®
::
log
->
	`lšk_log
(
bË
->
Çme
, 
¥l™_log_dœ
.
	`c_¡r
(), 
time¡amp
)è!ğ
E¼Ü
::
OK
)

668 
throw
 
	`Exû±iÚ
(
”rÜ
, (
¡d
::
¡ršg
)"UÇbËØlškƒx‹º®†og '" + 
¥l™_log_dœ
 + "' into commit†og");

669 ià((
”rÜ
 = 
¿ngePŒ
->
	`»¶ay_¥l™_log
(
¥l™_log_dœ
, 
time¡amp
)è!ğ
E¼Ü
::
OK
)

670 
throw
 
	`Exû±iÚ
(
”rÜ
, (
¡d
::
¡ršg
)"ProbËm„•Ïyšg s¶™†og '" + 
¥l™_log_dœ
 + "'");

673 
bËInfoPŒ
->
	`add_¿nge
(
¿nge
, 
¿ngePŒ
);

675 ià((
”rÜ
 = 
cb
->
	`»¥Ú£_ok
()è!ğ
E¼Ü
::
OK
) {

676 
	`HT_ERRORF
("ProbËm s’dšg OK„e¥Ú£ - %s", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

679 
	`HT_INFOF
("SucûssfuÎy†ßded„ªg%s[%s..%s]", 
bË
->
Çme
, 
¿nge
->
¡¬tRow
,„ªge->
’dRow
);

683 
	`ÿtch
 (
Hy³¹abË
::
Exû±iÚ
 &
e
) {

684 
	`HT_ERRORF
("% '%s'", 
e
.
	`code
(),ƒ.
	`wh©
());

685 ià((
”rÜ
 = 
cb
->
	`”rÜ
(
e
.
	`code
(),ƒ.
	`wh©
())è!ğ
E¼Ü
::
OK
) {

686 
	`HT_ERRORF
("ProbËm s’dšgƒ¼Ü„e¥Ú£ - %s", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

689 
	}
}

692 
	gÇme¥aû
 {

695 cÚ¡ 
ušt8_t
 *
	gba£
;

696 
size_t
 
	gËn
;

697 } 
	tUpd©eRecT
;

700 
RªgePŒ
 
	g¿nge_±r
;

701 
ušt64_t
 
	gtime¡amp
;

702 } 
	tMšTime¡ampRecT
;

711 
	gRªgeS”v”
::
	$upd©e
(
Re¥Ú£C®lbackUpd©e
 *
cb
, 
TabËId’tif›rT
 *
bË
, 
BufãrT
 &
bufãr
) {

712 cÚ¡ 
ušt8_t
 *
mod_±r
;

713 cÚ¡ 
ušt8_t
 *
mod_’d
;

714 cÚ¡ 
ušt8_t
 *
add_ba£_±r
;

715 cÚ¡ 
ušt8_t
 *
add_’d_±r
;

716 
ušt8_t
 *
ts_±r
;

717 cÚ¡ 
ušt8_t
 
auto_ts
[8] = { 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff };

718 
¡ršg
 
”rMsg
;

719 
”rÜ
 = 
E¼Ü
::
OK
;

720 
TabËInfoPŒ
 
bËInfoPŒ
;

721 
ušt64_t
 
upd©e_time¡amp
 = 0;

722 
ušt64_t
 
mš_time¡amp
 = 0;

723 cÚ¡ *
row
;

724 
¡d
::
¡ršg
 
¥l™_row
;

725 
veùÜ
<
Upd©eRecT
> 
goMods
;

726 
veùÜ
<
Upd©eRecT
> 
¥l™Mods
;

727 
veùÜ
<
Upd©eRecT
> 
¡İMods
;

728 
Upd©eRecT
 
upd©e
;

729 
By‹SŒšg32PŒ
 
¥l™KeyPŒ
;

730 
Comm™LogPŒ
 
¥l™LogPŒ
;

731 
ušt64_t
 
¥l™S¹Time
;

732 
size_t
 
goSize
 = 0;

733 
size_t
 
¡İSize
 = 0;

734 
size_t
 
¥l™Size
 = 0;

735 
¡d
::
¡ršg
 
’dRow
;

736 
¡d
::
veùÜ
<
MšTime¡ampRecT
> 
mš_ts_veùÜ
;

737 
MšTime¡ampRecT
 
mš_ts_»c
;

738 
ušt64_t
 
Ãxt_time¡amp
;

739 
ušt64_t
 
‹mp_time¡amp
;

740 
ušt64_t
 
memÜy_added
 = 0;

741 
ušt64_t
 
™ems_added
 = 0;

743 
mš_ts_veùÜ
.
	`»£rve
(50);

745 ià(
Glob®
::
v”bo£
) {

746 
cout
 << "RªgeS”v”::upd©e" << 
’dl
;

747 
cout
 << *
bË
;

753 ià(!
	`g‘_bË_šfo
(
bË
->
Çme
, 
bËInfoPŒ
)) {

754 
ExtBufãrT
 
ext
;

755 
ext
.
buf
 = 
Ãw
 
ušt8_t
 [ 
bufãr
.
Ën
 ];

756 
	`memıy
(
ext
.
buf
, 
bufãr
.buf, bufãr.
Ën
);

757 
ext
.
Ën
 = 
bufãr
.len;

758 
	`HT_ERRORF
("UÇbËØfšdabË infØfÜabË '%s'", 
bË
->
Çme
);

759 ià((
”rÜ
 = 
cb
->
	`»¥Ú£
(
ext
)è!ğ
E¼Ü
::
OK
) {

760 
	`HT_ERRORF
("ProbËm s’dšg OK„e¥Ú£ - %s", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

765 cÚ¡ 
boŞ
 
is_roÙ
 = 
	`¡rcmp
(
bË
->
Çme
, "METADATA") == 0;

767 ià(!
is_roÙ
) {

769 
	`VK_MARK_DATA_REGION
(
bufãr
.
buf
, bufãr.
Ën
);

773 ià((
”rÜ
 = 
	`v”ify_schema
(
bËInfoPŒ
, 
bË
->
g’”©iÚ
, 
”rMsg
)è!ğ
E¼Ü
::
OK
) {

774 
	`HT_ERRORF
("%s", 
”rMsg
.
	`c_¡r
());

775 
cb
->
	`”rÜ
(
”rÜ
, 
”rMsg
);

779 
mod_’d
 = 
bufãr
.
buf
 + bufãr.
Ën
;

780 
mod_±r
 = 
bufãr
.
buf
;

782 
goMods
.
	`ş—r
();

784 
boo¡
::
d‘a
::
th»ad
::
lock_İs
<boo¡::
mu‹x
>::
	`lock
(
m_upd©e_mu‹x_a
);

786 
mod_±r
 < 
mod_’d
) {

788 
row
 = (cÚ¡ *)((
By‹SŒšg32T
 *)
mod_±r
)->
d©a
;

791 ià(!
bËInfoPŒ
->
	`fšd_cÚššg_¿nge
(
row
, 
mš_ts_»c
.
¿nge_±r
)) {

792 
upd©e
.
ba£
 = 
mod_±r
;

793 
mod_±r
 +ğ
	`L’gth
((cÚ¡ 
By‹SŒšg32T
 *)mod_ptr);

794 
mod_±r
 +ğ
	`L’gth
((cÚ¡ 
By‹SŒšg32T
 *)mod_ptr);

795 
upd©e
.
Ën
 = 
mod_±r
 - upd©e.
ba£
;

796 
¡İMods
.
	`push_back
(
upd©e
);

797 
¡İSize
 +ğ
upd©e
.
Ën
;

801 
add_ba£_±r
 = 
mod_±r
;

804 
mš_ts_»c
.
¿nge_±r
->
	`šüem’t_upd©e_couÁ”
();

807 
mš_time¡amp
 = 
mš_ts_»c
.
¿nge_±r
->
	`g‘_Ï‹¡_time¡amp
();

810 
upd©e_time¡amp
 = 
Glob®
::
log
->
	`g‘_time¡amp
();

812 
’dRow
 = 
mš_ts_»c
.
¿nge_±r
->
	`’d_row
();

815 
mš_ts_»c
.
¿nge_±r
->
	`g‘_¥l™_šfo
(
¥l™_row
, 
¥l™LogPŒ
, &
¥l™S¹Time
);

817 
¥l™Mods
.
	`ş—r
();

818 
¥l™Size
 = 0;

820 
Ãxt_time¡amp
 = 0;

821 
mš_ts_»c
.
time¡amp
 = 0;

823 
mod_±r
 < 
mod_’d
 && (
’dRow
 =ğ"" || (
	`¡rcmp
(
row
,ƒndRow.
	`c_¡r
()) <= 0))) {

826 
ts_±r
 = (
ušt8_t
 *)
mod_±r
 + 
	`L’gth
((cÚ¡ 
By‹SŒšg32T
 *)mod_ptr) - 8;

827 ià(!
	`memcmp
(
ts_±r
, 
auto_ts
, 8)) {

828 ià(
Ãxt_time¡amp
 == 0) {

829 
boo¡
::
xtime
 
now
;

830 
boo¡
::
	`xtime_g‘
(&
now
, boo¡::
TIME_UTC
);

831 
Ãxt_time¡amp
 = ((
ušt64_t
)
now
.
£c
 * 1000000000LLè+ (ušt64_têow.
n£c
;

834 
‹mp_time¡amp
 = ++
Ãxt_time¡amp
;

835 ià(
mš_ts_»c
.
time¡amp
 =ğ0 || 
‹mp_time¡amp
 < min_ts_rec.timestamp)

836 
mš_ts_»c
.
time¡amp
 = 
‹mp_time¡amp
;

837 
‹mp_time¡amp
 = 
	`By‹Ord”Sw­IÁ64
(temp_timestamp);

838 
‹mp_time¡amp
 = ~temp_timestamp;

839 
	`memıy
(
ts_±r
, &
‹mp_time¡amp
, 8);

840 
‹mp_time¡amp
 = 
Ãxt_time¡amp
;

843 
	`memıy
(&
‹mp_time¡amp
, 
ts_±r
, 8);

844 
‹mp_time¡amp
 = 
	`By‹Ord”Sw­IÁ64
(temp_timestamp);

845 
‹mp_time¡amp
 = ~temp_timestamp;

846 ià(*(
ts_±r
-1è> 
FLAG_DELETE_CELL
 && 
‹mp_time¡amp
 <ğ
mš_time¡amp
) {

847 
”rÜ
 = 
E¼Ü
::
RANGESERVER_TIMESTAMP_ORDER_ERROR
;

848 
”rMsg
 = (
¡ršg
)"Upd©time¡am°" + 
‹mp_time¡amp
 + " i <ğ´eviou¦y s“Àtime¡am°oà" + 
mš_time¡amp
;

849 
mš_ts_»c
.
¿nge_±r
->
	`deüem’t_upd©e_couÁ”
();

850 
boo¡
::
d‘a
::
th»ad
::
lock_İs
<boo¡::
mu‹x
>::
	`uÆock
(
m_upd©e_mu‹x_a
);

851 
abÜt
;

853 ià(
mš_ts_»c
.
time¡amp
 =ğ0 || 
‹mp_time¡amp
 < min_ts_rec.timestamp)

854 
mš_ts_»c
.
time¡amp
 = 
‹mp_time¡amp
;

857 
upd©e
.
ba£
 = 
mod_±r
;

858 
mod_±r
 +ğ
	`L’gth
((cÚ¡ 
By‹SŒšg32T
 *)mod_ptr);

859 
mod_±r
 +ğ
	`L’gth
((cÚ¡ 
By‹SŒšg32T
 *)mod_ptr);

860 
upd©e
.
Ën
 = 
mod_±r
 - upd©e.
ba£
;

861 ià(
¥l™S¹Time
 !ğ0 && 
‹mp_time¡amp
 > s¶™S¹Tim&& 
	`¡rcmp
(
row
, 
¥l™_row
.
	`c_¡r
()) <= 0) {

862 
¥l™Mods
.
	`push_back
(
upd©e
);

863 
¥l™Size
 +ğ
upd©e
.
Ën
;

866 
goMods
.
	`push_back
(
upd©e
);

867 
goSize
 +ğ
upd©e
.
Ën
;

869 
row
 = (cÚ¡ *)((
By‹SŒšg32T
 *)
mod_±r
)->
d©a
;

872 
add_’d_±r
 = 
mod_±r
;

877 
mš_ts_»c
.
time¡amp
--;

878 
mš_ts_»c
.
¿nge_±r
->
	`add_upd©e_time¡amp
Ğmš_ts_»c.
time¡amp
 );

879 
mš_ts_veùÜ
.
	`push_back
(
mš_ts_»c
);

881 ià(
¥l™Size
 > 0) {

882 
boo¡
::
sh¬ed_¬¿y
<
ušt8_t
> 
	`bufPŒ
Ğ
Ãw
 ušt8_ˆ[ 
¥l™Size
 ] );

883 
ušt8_t
 *
ba£
 = 
bufPŒ
.
	`g‘
();

884 
ušt8_t
 *
±r
 = 
ba£
;

886 
™ems_added
 +ğ
¥l™Mods
.
	`size
();

887 
memÜy_added
 +ğ
¥l™Size
;

889 
size_t
 
i
=0; i<
¥l™Mods
.
	`size
(); i++) {

890 
	`memıy
(
±r
, 
¥l™Mods
[
i
].
ba£
, s¶™Mods[i].
Ën
);

891 
±r
 +ğ
¥l™Mods
[
i
].
Ën
;

894 
	`HT_EXPECT
((
±r
-
ba£
è<ğ()
¥l™Size
, 
E¼Ü
::
FAILED_EXPECTATION
);

896 ià((
”rÜ
 = 
¥l™LogPŒ
->
	`wr™e
(
bË
->
Çme
, 
ba£
, 
±r
-ba£, 
upd©e_time¡amp
)è!ğ
E¼Ü
::
OK
) {

897 
”rMsg
 = (
¡ršg
)"ProbËm wr™šg " + ()(
±r
-
ba£
) + " byteso split†og";

898 
boo¡
::
d‘a
::
th»ad
::
lock_İs
<boo¡::
mu‹x
>::
	`uÆock
(
m_upd©e_mu‹x_a
);

899 
abÜt
;

906 
mš_ts_»c
.
¿nge_±r
->
	`lock
();

908 cÚ¡ 
ušt8_t
 *
±r
 = 
add_ba£_±r
;

909 cÚ¡ 
By‹SŒšg32T
 *
key
, *
v®ue
;

910 
±r
 < 
add_’d_±r
) {

911 
key
 = (cÚ¡ 
By‹SŒšg32T
 *)
±r
;

912 
±r
 +ğ
	`L’gth
(
key
);

913 
v®ue
 = (cÚ¡ 
By‹SŒšg32T
 *)
±r
;

914 
±r
 +ğ
	`L’gth
(
v®ue
);

915 
	`HT_EXPECT
(
mš_ts_»c
.
¿nge_±r
->
	`add
(
key
, 
v®ue
, 
upd©e_time¡amp
è=ğ
E¼Ü
::
OK
, E¼Ü::
FAILED_EXPECTATION
);

918 
mš_ts_»c
.
¿nge_±r
->
	`uÆock
(
upd©e_time¡amp
);

924 
¡d
::
veùÜ
<
AcûssGroup
::
Com·ùiÚPriÜ™yD©aT
> 
´iÜ™y_d©a_vec
;

925 
¡d
::
veùÜ
<
AcûssGroup
 *> 
com·ùiÚs
;

926 
ušt64_t
 
disk_u§ge
 = 0;

928 
mš_ts_»c
.
¿nge_±r
->
	`g‘_com·ùiÚ_´iÜ™y_d©a
(
´iÜ™y_d©a_vec
);

929 
size_t
 
i
=0; i<
´iÜ™y_d©a_vec
.
	`size
(); i++) {

930 
disk_u§ge
 +ğ
´iÜ™y_d©a_vec
[
i
].
disk_u£d
;

931 ià(!
´iÜ™y_d©a_vec
[
i
].
š_memÜy
 &&…riÜ™y_d©a_vec[i].
mem_u£d
 >ğ(
ušt32_t
)
Glob®
::
loÿl™yGroupMaxMemÜy
)

932 
com·ùiÚs
.
	`push_back
(
´iÜ™y_d©a_vec
[
i
].
ag
);

935 ià(!
mš_ts_»c
.
¿nge_±r
->
	`is_roÙ
() &&

936 (
disk_u§ge
 > 
mš_ts_»c
.
¿nge_±r
->
	`g‘_size_lim™
() ||

937 (
Glob®
::
¿nge_m‘ad©a_max_by‹s
 && 
bË
->
id
 =ğ0 && 
disk_u§ge
 > Global::range_metadata_max_bytes))) {

938 ià(!
mš_ts_»c
.
¿nge_±r
->
	`‹¡_ªd_£t_maš‹Çnû
())

939 
Glob®
::
maš‹Çnû_queue
->
	`add
Ğ
Ãw
 
	`Maš‹ÇnûTaskS¶™
(
mš_ts_»c
.
¿nge_±r
) );

941 ià(!
com·ùiÚs
.
	`em±y
()) {

942 ià(!
mš_ts_»c
.
¿nge_±r
->
	`‹¡_ªd_£t_maš‹Çnû
()) {

943 
size_t
 
i
=0; i<
com·ùiÚs
.
	`size
(); i++)

944 
com·ùiÚs
[
i
]->
	`£t_com·ùiÚ_b™
();

945 
Glob®
::
maš‹Çnû_queue
->
	`add
Ğ
Ãw
 
	`Maš‹ÇnûTaskCom·ùiÚ
(
mš_ts_»c
.
¿nge_±r
, 
çl£
) );

950 ià(
Glob®
::
v”bo£
) {

951 
	`HT_INFOF
("Added %d (%d s¶™ offèupd©e tØ'%s'", 
goMods
.
	`size
()+
¥l™Mods
.size(), s¶™Mods.size(), 
bË
->
Çme
);

955 
boo¡
::
d‘a
::
th»ad
::
lock_İs
<boo¡::
mu‹x
>::
	`lock
(
m_upd©e_mu‹x_b
);

956 
boo¡
::
d‘a
::
th»ad
::
lock_İs
<boo¡::
mu‹x
>::
	`uÆock
(
m_upd©e_mu‹x_a
);

961 ià(
goSize
 > 0) {

962 
boo¡
::
sh¬ed_¬¿y
<
ušt8_t
> 
	`bufPŒ
Ğ
Ãw
 ušt8_ˆ[ 
goSize
 ] );

963 
ušt8_t
 *
ba£
 = 
bufPŒ
.
	`g‘
();

964 
ušt8_t
 *
±r
 = 
ba£
;

966 
™ems_added
 +ğ
goMods
.
	`size
();

967 
memÜy_added
 +ğ
goSize
;

969 
size_t
 
i
=0; i<
goMods
.
	`size
(); i++) {

970 
	`memıy
(
±r
, 
goMods
[
i
].
ba£
, goMods[i].
Ën
);

971 
±r
 +ğ
goMods
[
i
].
Ën
;

974 
	`HT_EXPECT
((
±r
-
ba£
è<ğ()
goSize
, 
E¼Ü
::
FAILED_EXPECTATION
);

976 ià((
”rÜ
 = 
Glob®
::
log
->
	`wr™e
(
bË
->
Çme
, 
ba£
, 
±r
-ba£, 
upd©e_time¡amp
)è!ğ
E¼Ü
::
OK
) {

977 
”rMsg
 = (
¡ršg
)"ProbËm wr™šg " + ()(
±r
-
ba£
) + " byteso commit†og";

978 
boo¡
::
d‘a
::
th»ad
::
lock_İs
<boo¡::
mu‹x
>::
	`uÆock
(
m_upd©e_mu‹x_b
);

979 
abÜt
;

983 
boo¡
::
d‘a
::
th»ad
::
lock_İs
<boo¡::
mu‹x
>::
	`uÆock
(
m_upd©e_mu‹x_b
);

985 ià(
Glob®
::
v”bo£
) {

986 
	`HT_INFOF
("Drİ³d %d upd©e (out-of-¿nge)", 
¡İMods
.
	`size
());

989 
”rÜ
 = 
E¼Ü
::
OK
;

991 
abÜt
:

993 
Glob®
::
memÜy_Œack”
.
	`add_memÜy
(
memÜy_added
);

994 
Glob®
::
memÜy_Œack”
.
	`add_™ems
(
™ems_added
);

997 
ušt64_t
 
mt_memÜy
 = 
Glob®
::
memÜy_Œack”
.
	`g‘_memÜy
();

998 
ušt64_t
 
mt_™ems
 = 
Glob®
::
memÜy_Œack”
.
	`g‘_™ems
();

999 
ušt64_t
 
vm_e¡im©e
 = 
mt_memÜy
 + (
mt_™ems
*120);

1000 
	`HT_INFOF
("drj mem=%Îd i‹ms=%Îd vm-e¡%Îd", 
mt_memÜy
, 
mt_™ems
, 
vm_e¡im©e
);

1004 
size_t
 
i
=0; i<
mš_ts_veùÜ
.
	`size
(); i++) {

1005 
mš_ts_veùÜ
[
i
].
¿nge_±r
->
	`»move_upd©e_time¡amp
(mš_ts_veùÜ[i].
time¡amp
);

1006 
mš_ts_veùÜ
[
i
].
¿nge_±r
->
	`deüem’t_upd©e_couÁ”
();

1009 ià(
”rÜ
 =ğ
E¼Ü
::
OK
) {

1013 ià(
¡İSize
 > 0) {

1014 
ExtBufãrT
 
ext
;

1015 
ext
.
buf
 = 
Ãw
 
ušt8_t
 [ 
¡İSize
 ];

1016 
ušt8_t
 *
±r
 = 
ext
.
buf
;

1017 
size_t
 
i
=0; i<
¡İMods
.
	`size
(); i++) {

1018 
	`memıy
(
±r
, 
¡İMods
[
i
].
ba£
, stİMods[i].
Ën
);

1019 
±r
 +ğ
¡İMods
[
i
].
Ën
;

1021 
ext
.
Ën
 = 
±r
 -ƒxt.
buf
;

1022 ià((
”rÜ
 = 
cb
->
	`»¥Ú£
(
ext
)è!ğ
E¼Ü
::
OK
) {

1023 
	`HT_ERRORF
("ProbËm s’dšg OK„e¥Ú£ - %s", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

1027 ià((
”rÜ
 = 
cb
->
	`»¥Ú£_ok
()è!ğ
E¼Ü
::
OK
) {

1028 
	`HT_ERRORF
("ProbËm s’dšg OK„e¥Ú£ - %s", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

1033 
	`HT_ERRORF
("% '%s'", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
), 
”rMsg
.
	`c_¡r
());

1034 ià((
”rÜ
 = 
cb
->
	`”rÜ
Ó¼Ü, 
”rMsg
)è!ğ
E¼Ü
::
OK
) {

1035 
	`HT_ERRORF
("ProbËm s’dšgƒ¼Ü„e¥Ú£ - %s", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

1038 
	}
}

1042 
	gRªgeS”v”
::
	$drİ_bË
(
Re¥Ú£C®lback
 *
cb
, cÚ¡ *
bË_Çme
) {

1043 
”rÜ
;

1044 
TabËInfoPŒ
 
bË_šfo_±r
;

1045 
¡d
::
veùÜ
<
RªgePŒ
> 
¿nge_veùÜ
;

1046 
¡d
::
¡ršg
 
m‘ad©a_´efix
;

1047 
¡d
::
¡ršg
 
m‘ad©a_key
;

1048 
TabËMutÜPŒ
 
mutÜ_±r
;

1049 
KeyS³c
 
key
;

1051 ià(
Glob®
::
v”bo£
) {

1052 
	`HT_INFOF
("drİ_bË '%s'", 
bË_Çme
);

1053 
cout
 << 
æush
;

1057 ià((
”rÜ
 = 
Glob®
::
m‘ad©a_bË_±r
->
	`ü—‹_mutÜ
(
mutÜ_±r
)è!ğ
E¼Ü
::
OK
) {

1058 
	`HT_ERRORF
("ProbËm c»©šg mutÜ oÀMETADATAabË - %s", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

1059 
cb
->
	`”rÜ
(
”rÜ
, "Problem creating mutator on METADATAable");

1064 
	`mem£t
(&
key
, 0, (key));

1065 
key
.
cŞumn_çmy
 = "Location";

1067 
Œy
 {

1071 ià(
	`»move_bË_šfo
(
bË_Çme
, 
bË_šfo_±r
)) {

1072 
m‘ad©a_´efix
 = 
¡d
::
	`¡ršg
(""è+ 
bË_šfo_±r
->
	`g‘_id
() + ":";

1073 
bË_šfo_±r
->
	`g‘_¿nge_veùÜ
(
¿nge_veùÜ
);

1074 
size_t
 
i
=0; i<
¿nge_veùÜ
.
	`size
(); i++) {

1075 
¿nge_veùÜ
[
i
]->
	`drİ
();

1076 
m‘ad©a_key
 = 
m‘ad©a_´efix
 + 
¿nge_veùÜ
[
i
]->
	`’d_row
();

1077 
key
.
row
 = 
m‘ad©a_key
.
	`c_¡r
();

1078 
key
.
row_Ën
 = 
m‘ad©a_key
.
	`Ëngth
();

1079 
mutÜ_±r
->
	`£t
(
key
, "!", 1);

1081 
¿nge_veùÜ
.
	`ş—r
();

1084 
	`HT_ERRORF
("drİ_bË '%s' -abË‚Ù found", 
bË_Çme
);

1086 
mutÜ_±r
->
	`æush
();

1088 
	`ÿtch
 (
Hy³¹abË
::
Exû±iÚ
 &
e
) {

1089 
	`HT_ERRORF
("ProbËm cË¬šg 'LoÿtiÚ' cŞumn oàMETADATA - %s", 
E¼Ü
::
	`g‘_‹xt
(
e
.
	`code
()));

1090 
cb
->
	`”rÜ
(
e
.
	`code
(), "Problem clearing 'Location' columns of METADATA");

1094 ià(
Glob®
::
v”bo£
) {

1095 
	`HT_INFOF
("SucûssfuÎy drİ³dabË '%s'", 
bË_Çme
);

1096 
cout
 << 
æush
;

1099 
cb
->
	`»¥Ú£_ok
();

1100 
	}
}

1103 
	gRªgeS”v”
::
	$dump_¡©s
(
Re¥Ú£C®lback
 *
cb
) {

1104 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

1105 
¡d
::
veùÜ
<
RªgePŒ
> 
¿nge_vec
;

1107 
	`HT_INFO
("dump_stats");

1109 
TabËInfoM­T
::
™”©Ü
 
bË_™”
 = 
m_bË_šfo_m­
.
	`begš
();abË_™” !ğm_bË_šfo_m­.
	`’d
();able_iter++) {

1110 
¿nge_vec
.
	`ş—r
();

1111 (*
bË_™”
).
£cÚd
->
	`g‘_¿nge_veùÜ
(
¿nge_vec
);

1112 
size_t
 
i
=0; i<
¿nge_vec
.
	`size
(); i++)

1113 
¿nge_vec
[
i
]->
	`dump_¡©s
();

1115 
cb
->
	`»¥Ú£_ok
();

1116 
	}
}

1123 
boŞ
 
	gRªgeS”v”
::
g‘_bË_šfo
(
¡d
::
¡ršg
 
Çme
, 
TabËInfoPŒ
 &
šfo
) {

1124 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

1125 
	gTabËInfoM­T
::
™”©Ü
 
™”
 = 
m_bË_šfo_m­
.
fšd
(
Çme
);

1126 ià(
	g™”
 =ğ
m_bË_šfo_m­
.
’d
())

1127  
çl£
;

1128 
	gšfo
 = (*
™”
).
£cÚd
;

1129  
	gŒue
;

1136 
	gRªgeS”v”
::
£t_bË_šfo
(
¡d
::
¡ršg
 
Çme
, 
TabËInfoPŒ
 &
šfo
) {

1137 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

1138 
	gTabËInfoM­T
::
™”©Ü
 
™”
 = 
m_bË_šfo_m­
.
fšd
(
Çme
);

1139 ià(
	g™”
 !ğ
m_bË_šfo_m­
.
’d
())

1140 
m_bË_šfo_m­
.
”a£
(
™”
);

1141 
	gm_bË_šfo_m­
[
Çme
] = 
šfo
;

1148 
boŞ
 
	gRªgeS”v”
::
»move_bË_šfo
(
¡d
::
¡ršg
 
Çme
, 
TabËInfoPŒ
 &
šfo
) {

1149 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

1150 
	gTabËInfoM­T
::
™”©Ü
 
™”
 = 
m_bË_šfo_m­
.
fšd
(
Çme
);

1151 ià(
	g™”
 =ğ
m_bË_šfo_m­
.
’d
())

1152  
çl£
;

1153 
	gšfo
 = (*
™”
).
£cÚd
;

1154 
	gm_bË_šfo_m­
.
”a£
(
™”
);

1155  
	gŒue
;

1160 
	gRªgeS”v”
::
v”ify_schema
(
TabËInfoPŒ
 &
bËInfoPŒ
, 
g’”©iÚ
, 
¡d
::
¡ršg
 &
”rMsg
) {

1161 
¡d
::
¡ršg
 
bËFe
 = (¡d::¡ršg)"/hy³¹abË/bËs/" + 
bËInfoPŒ
->
g‘_Çme
();

1162 
DyÇmicBufãr
 
v®ueBuf
(0);

1163 
HªdËC®lbackPŒ
 
	gnuÎHªdËC®lback
;

1164 
	g”rÜ
;

1165 
ušt64_t
 
	ghªdË
;

1166 
SchemaPŒ
 
	gschemaPŒ
 = 
bËInfoPŒ
->
g‘_schema
();

1168 ià(
	gschemaPŒ
.
g‘
(è=ğ0 || 
schemaPŒ
->
g‘_g’”©iÚ
(è< 
g’”©iÚ
) {

1170 ià((
”rÜ
 = 
m_hy³r¥aû_±r
->
İ’
(
bËFe
.
c_¡r
(), 
OPEN_FLAG_READ
, 
nuÎHªdËC®lback
, &
hªdË
)è!ğ
E¼Ü
::
OK
) {

1171 
HT_ERRORF
("UÇbËØİ’ Hy³r¥aû f'%s' (%s)", 
bËFe
.
c_¡r
(), 
E¼Ü
::
g‘_‹xt
(
”rÜ
));

1172 
ex™
(1);

1175 ià((
	g”rÜ
 = 
m_hy³r¥aû_±r
->
©Œ_g‘
(
hªdË
, "schema", 
v®ueBuf
)è!ğ
E¼Ü
::
OK
) {

1176 
”rMsg
 = (
¡d
::
¡ršg
)"ProbËm g‘tšg 'schema'‡‰ribu‹ fÜ '" + 
bËFe
 + "'";

1177  
	g”rÜ
;

1180 
	gm_hy³r¥aû_±r
->
şo£
(
hªdË
);

1182 
	gschemaPŒ
 = 
Schema
::
Ãw_š¡ªû
((cÚ¡ *)
v®ueBuf
.
buf
, v®ueBuf.
fl
(), 
Œue
);

1183 ià(!
	gschemaPŒ
->
is_v®id
()) {

1184 
	g”rMsg
 = (
¡d
::
¡ršg
)"Schem¨P¬£ E¼Ü fÜabË '" + 
bËInfoPŒ
->
g‘_Çme
(è+ "' : " + 
schemaPŒ
->
g‘_”rÜ_¡ršg
();

1185  
	gE¼Ü
::
RANGESERVER_SCHEMA_PARSE_ERROR
;

1188 
	gbËInfoPŒ
->
upd©e_schema
(
schemaPŒ
);

1191 iàĞ
	gschemaPŒ
->
g‘_g’”©iÚ
(è< 
	gg’”©iÚ
 ) {

1192 
	g”rMsg
 = (
¡d
::
¡ršg
)"F‘ched Schem¨g’”©iÚ fÜabË '" + 
bËInfoPŒ
->
g‘_Çme
(è+ "' i " + 
schemaPŒ
->
g‘_g’”©iÚ
(è+ " buˆsuµl›d i " + 
g’”©iÚ
;

1193  
	gE¼Ü
::
RANGESERVER_GENERATION_MISMATCH
;

1197  
	gE¼Ü
::
OK
;

1202 
	gRªgeS”v”
::
	$do_maš‹Çnû
() {

1203 
timev®
 
tv®
;

1208 
Glob®
::
sÿÂ”M­
.
	`purge_expœed
(
m_sÿÂ”_‰l
);

1213 
	`g‘timeofday
(&
tv®
, 0);

1214 ià((
tv®
.
tv_£c
 - 
m_Ï¡_comm™_log_ş—n
è>ğ()(
m_tim”_š‹rv®
*4)/5) {

1216 
Glob®
::
maš‹Çnû_queue
->
	`add
Ğ
Ãw
 
	`Maš‹ÇnûTaskLogCËªup
(
this
) );

1217 
m_Ï¡_comm™_log_ş—n
 = 
tv®
.
tv_£c
;

1219 
	}
}

1226 
	gRªgeS”v”
::
	$log_ş—nup
() {

1227 
¡d
::
veùÜ
<
RªgePŒ
> 
¿nge_vec
;

1228 
¡d
::
veùÜ
<
AcûssGroup
::
Com·ùiÚPriÜ™yD©aT
> 
´iÜ™y_d©a_vec
;

1229 
¡d
::
m­
<
ušt64_t
, 
F¿gm’tPriÜ™yD©aT
> 
log_äag_m­
;

1230 
¡d
::
£t
<
size_t
> 
com·ùiÚ_£t
;

1231 
ušt64_t
 
time¡amp
, 
Şde¡_ÿched_time¡amp
 = 0;

1232 
ušt64_t
 
´uÃ_th»shŞd
 = 2 * 
Glob®
::
log
->
	`g‘_max_äagm’t_size
();

1235 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

1236 
TabËInfoM­T
::
™”©Ü
 
bË_™”
 = 
m_bË_šfo_m­
.
	`begš
();abË_™” !ğm_bË_šfo_m­.
	`’d
();able_iter++) {

1237 (*
bË_™”
).
£cÚd
->
	`g‘_¿nge_veùÜ
(
¿nge_vec
);

1244 
size_t
 
i
=0; i<
¿nge_vec
.
	`size
(); i++) {

1245 
size_t
 
¡¬t
 = 
´iÜ™y_d©a_vec
.
	`size
();

1246 
¿nge_vec
[
i
]->
	`g‘_com·ùiÚ_´iÜ™y_d©a
(
´iÜ™y_d©a_vec
);

1247 
size_t
 
j
=
¡¬t
; j<
´iÜ™y_d©a_vec
.
	`size
(); j++) {

1248 
´iÜ™y_d©a_vec
[
j
].
u£r_d©a
 = (*)
i
;

1249 ià((
time¡amp
 = 
´iÜ™y_d©a_vec
[
j
].
ag
->
	`g‘_Şde¡_ÿched_time¡amp
()) != 0) {

1250 ià(
Şde¡_ÿched_time¡amp
 =ğ0 || 
time¡amp
 < oldest_cached_timestamp)

1251 
Şde¡_ÿched_time¡amp
 = 
time¡amp
;

1256 
Glob®
::
log
->
	`lßd_äagm’t_´iÜ™y_m­
(
log_äag_m­
);

1261 
size_t
 
i
=0; i<
´iÜ™y_d©a_vec
.
	`size
(); i++) {

1262 
¡d
::
m­
<
ušt64_t
, 
F¿gm’tPriÜ™yD©aT
>::
™”©Ü
 
m­_™”
 = 
log_äag_m­
.
	`low”_bound
Ğ
´iÜ™y_d©a_vec
[
i
].
Şde¡_ÿched_time¡amp
 );

1263 
size_t
 
¿ngei
 = (size_t)
´iÜ™y_d©a_vec
[
i
].
u£r_d©a
;

1266 ià(
m­_™”
 =ğ
log_äag_m­
.
	`’d
())

1269 iàĞ
´iÜ™y_d©a_vec
[
i
].
Şde¡_ÿched_time¡amp
 > 0 && (*
m­_™”
).
£cÚd
.
cumuÏtive_size
 > 
´uÃ_th»shŞd
 ) {

1270 
¡d
::
¡ršg
 
¿nge_¡r
 = 
¿nge_vec
[
¿ngei
]->
	`bË_Çme
(è+ "[" +„ªge_vec[¿ngei]->
	`¡¬t_row
(è+ ".." +„ªge_vec[¿ngei]->
	`’d_row
(è+ "]." + 
´iÜ™y_d©a_vec
[
i
].
ag
->
	`g‘_Çme
();

1271 
´iÜ™y_d©a_vec
[
i
].
ag
->
	`£t_com·ùiÚ_b™
();

1272 
com·ùiÚ_£t
.
	`š£¹
Ğ
¿ngei
 );

1273 
	`HT_INFOF
("Compacting %s because cumulative†og size of %lldƒxceedshreshold %lld",

1274 
¿nge_¡r
.
	`c_¡r
(), (*
m­_™”
).
£cÚd
.
cumuÏtive_size
, 
´uÃ_th»shŞd
);

1281 
¡d
::
£t
<
size_t
>::
™”©Ü
 
™”
 = 
com·ùiÚ_£t
.
	`begš
(); i‹¸!ğcom·ùiÚ_£t.
	`’d
(); iter++) {

1282 ià(!
¿nge_vec
[*
™”
]->
	`‹¡_ªd_£t_maš‹Çnû
())

1283 
Glob®
::
maš‹Çnû_queue
->
	`add
Ğ
Ãw
 
	`Maš‹ÇnûTaskCom·ùiÚ
(
¿nge_vec
[*
™”
], 
çl£
) );

1289 ià(
Şde¡_ÿched_time¡amp
 != 0)

1290 
Glob®
::
log
->
	`purge
(
Şde¡_ÿched_time¡amp
);

1292 
	}
}

1298 
ušt64_t
 
	gRªgeS”v”
::
	$g‘_tim”_š‹rv®
() {

1299  
m_tim”_š‹rv®
*1000;

1300 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/RangeServer.h

21 #iâdeà
HYPERTABLE_RANGESERVER_H


22 
	#HYPERTABLE_RANGESERVER_H


	)

24 
	~"CommÚ/Prİ”t›s.h
"

25 
	~"CommÚ/Reã»nûCouÁ.h
"

27 
	~"AsyncComm/AµliÿtiÚQueue.h
"

28 
	~"AsyncComm/Comm.h
"

29 
	~"AsyncComm/Ev’t.h
"

30 
	~"AsyncComm/Re¥Ú£C®lback.h
"

32 
	~"Hy³r¥aû/SessiÚ.h
"

34 
	~"Hy³¹abË/Lib/Ma¡”Cl›Á.h
"

35 
	~"Hy³¹abË/Lib/Ty³s.h
"

37 
	~"Re¥Ú£C®lbackC»©eSÿÂ”.h
"

38 
	~"Re¥Ú£C®lbackF‘chSÿnblock.h
"

39 
	~"Re¥Ú£C®lbackUpd©e.h
"

40 
	~"TabËInfo.h
"

42 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

44 
Çme¥aû
 
	gHy³¹abË
 {

46 
şass
 
	gCÚÃùiÚHªdËr
;

48 şas 
	cRªgeS”v”
 : 
public
 
Reã»nûCouÁ
 {

49 
public
:

50 
RªgeS”v”
(
Prİ”t›sPŒ
 &
´İsPŒ
, 
CÚÃùiÚMªag”PŒ
 &
cÚn_mªag”_±r
, 
AµliÿtiÚQueuePŒ
 &
­p_queue_±r
, 
Hy³r¥aû
::
SessiÚPŒ
 &
hy³r¥aû_±r
);

51 
	gvœtu®
 ~
RªgeS”v”
();

53 
com·ù
(
Re¥Ú£C®lback
 *
cb
, 
TabËId’tif›rT
 *
bË
, 
RªgeT
 *
¿nge
, 
ušt8_t
 
com·ùiÚ_ty³
);

54 
ü—‹_sÿÂ”
(
Re¥Ú£C®lbackC»©eSÿÂ”
 *
cb
, 
TabËId’tif›rT
 *
bË
, 
RªgeT
 *
¿nge
, 
SÿnS³cifiÿtiÚT
 *
sÿn_¥ec
);

55 
de¡roy_sÿÂ”
(
Re¥Ú£C®lback
 *
cb
, 
ušt32_t
 
sÿÂ”Id
);

56 
ãtch_sÿnblock
(
Re¥Ú£C®lbackF‘chSÿnblock
 *
cb
, 
ušt32_t
 
sÿÂ”Id
);

57 
lßd_¿nge
(
Re¥Ú£C®lback
 *
cb
, 
TabËId’tif›rT
 *
bË
, 
RªgeT
 *
¿nge
, 
ušt64_t
 
soá_lim™
, 
ušt16_t
 
æags
);

58 
upd©e
(
Re¥Ú£C®lbackUpd©e
 *
cb
, 
TabËId’tif›rT
 *
bË
, 
BufãrT
 &
bufãr
);

59 
drİ_bË
(
Re¥Ú£C®lback
 *
cb
, cÚ¡ *
bË_Çme
);

60 
dump_¡©s
(
Re¥Ú£C®lback
 *
cb
);

61 
do_maš‹Çnû
();

62 
log_ş—nup
();

64 
ušt64_t
 
g‘_tim”_š‹rv®
();

66 
AµliÿtiÚQueuePŒ
 
g‘_­¶iÿtiÚ_queue_±r
(è{  
	gm_­p_queue_±r
; }

68 
	g¡d
::
¡ršg
 &
g‘_loÿtiÚ
(è{  
m_loÿtiÚ
; }

70 
ma¡”_chªge
();

72 
	g´iv©e
:

73 
dœeùÜy_š™Ÿlize
(
Prİ”t›sPŒ
 &
´İs_±r
);

75 
boŞ
 
g‘_bË_šfo
(
¡d
::
¡ršg
 
Çme
, 
TabËInfoPŒ
 &
šfo
);

76 
£t_bË_šfo
(
¡d
::
¡ršg
 
Çme
, 
TabËInfoPŒ
 &
šfo
);

77 
boŞ
 
»move_bË_šfo
(
¡d
::
¡ršg
 
Çme
, 
TabËInfoPŒ
 &
šfo
);

79 
v”ify_schema
(
TabËInfoPŒ
 &
bËInfoPŒ
, 
g’”©iÚ
, 
¡d
::
¡ršg
 &
”rMsg
);

81 
	g__gnu_cxx
::
	thash_m­
<
	t¡ršg
, 
	tTabËInfoPŒ
> 
	tTabËInfoM­T
;

83 
	gboo¡
::
mu‹x
 
m_mu‹x
;

84 
	gboo¡
::
mu‹x
 
m_upd©e_mu‹x_a
;

85 
	gboo¡
::
mu‹x
 
m_upd©e_mu‹x_b
;

86 
Prİ”t›sPŒ
 
	gm_´İs_±r
;

87 
boŞ
 
	gm_v”bo£
;

88 
Comm
 *
	gm_comm
;

89 
TabËInfoM­T
 
	gm_bË_šfo_m­
;

90 
CÚÃùiÚMªag”PŒ
 
	gm_cÚn_mªag”_±r
;

91 
AµliÿtiÚQueuePŒ
 
	gm_­p_queue_±r
;

92 
ušt64_t
 
	gm_exi¡’û_fe_hªdË
;

93 
LockSequ’ûrT
 
	gm_exi¡’û_fe_£qu’ûr
;

94 
	g¡d
::
¡ršg
 
m_loÿtiÚ
;

95 
CÚÃùiÚHªdËr
 *
	gm_ma¡”_cÚÃùiÚ_hªdËr
;

96 
Ma¡”Cl›ÁPŒ
 
	gm_ma¡”_ş›Á_±r
;

97 
	gHy³r¥aû
::
SessiÚPŒ
 
m_hy³r¥aû_±r
;

98 
time_t
 
	gm_sÿÂ”_‰l
;

99 
	gm_Ï¡_comm™_log_ş—n
;

100 
ušt64_t
 
	gm_tim”_š‹rv®
;

102 
	gboo¡
::
	tšŒusive_±r
<
	tRªgeS”v”
> 
	tRªgeS”v”PŒ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/RequestHandlerCompact.cc

21 
	~"CommÚ/E¼Ü.h
"

22 
	~"CommÚ/Logg”.h
"

24 
	~"AsyncComm/Re¥Ú£C®lback.h
"

25 
	~"AsyncComm/S”Ÿliz©iÚ.h
"

27 
	~"Hy³¹abË/Lib/Ty³s.h
"

29 
	~"RªgeS”v”.h
"

30 
	~"Reque¡HªdËrCom·ù.h
"

32 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

37 
	gReque¡HªdËrCom·ù
::
	$run
() {

38 
Re¥Ú£C®lback
 
	`cb
(
m_comm
, 
m_ev’t_±r
);

39 
TabËId’tif›rT
 
bË
;

40 
RªgeT
 
¿nge
;

41 
ušt8_t
 
com·ùiÚ_ty³
 = 0;

42 
size_t
 
»maššg
 = 
m_ev’t_±r
->
mes§geL’
 - 2;

43 
ušt8_t
 *
msgPŒ
 = 
m_ev’t_±r
->
mes§ge
 + 2;

46 ià(!
	`DecodeTabËId’tif›r
(&
msgPŒ
, &
»maššg
, &
bË
))

47 
abÜt
;

50 ià(!
	`DecodeRªge
(&
msgPŒ
, &
»maššg
, &
¿nge
))

51 
abÜt
;

54 ià(!
S”Ÿliz©iÚ
::
	`decode_by‹
(&
msgPŒ
, &
»maššg
, &
com·ùiÚ_ty³
))

55 
abÜt
;

57 
m_¿nge_£rv”
->
	`com·ù
(&
cb
, &
bË
, &
¿nge
, 
com·ùiÚ_ty³
);

61 
abÜt
:

62 
	`HT_ERROR
("Encoding…roblem with Compact message");

63 
cb
.
	`”rÜ
(
E¼Ü
::
PROTOCOL_ERROR
, "Encoding…roblem with Compact message");

65 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/RequestHandlerCompact.h

21 #iâdeà
HYPERTABLE_REQUESTHANDLERCOMPACT_H


22 
	#HYPERTABLE_REQUESTHANDLERCOMPACT_H


	)

24 
	~"CommÚ/RuÂabË.h
"

26 
	~"AsyncComm/AµliÿtiÚHªdËr.h
"

27 
	~"AsyncComm/Comm.h
"

28 
	~"AsyncComm/Ev’t.h
"

30 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

32 
Çme¥aû
 
	gHy³¹abË
 {

34 
şass
 
	gRªgeS”v”
;

36 şas 
	cReque¡HªdËrCom·ù
 : 
public
 
AµliÿtiÚHªdËr
 {

37 
public
:

38 
Reque¡HªdËrCom·ù
(
Comm
 *
comm
, 
RªgeS”v”
 *
¿ngeS”v”
, 
Ev’tPŒ
 &
ev’tPŒ
è: 
AµliÿtiÚHªdËr
Óv’tPŒ), 
m_comm
(comm), 
m_¿nge_£rv”
(rangeServer) {

42 
vœtu®
 
run
();

44 
	g´iv©e
:

45 
Comm
 *
m_comm
;

46 
RªgeS”v”
 *
	gm_¿nge_£rv”
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/RequestHandlerCreateScanner.cc

21 
	~"CommÚ/E¼Ü.h
"

22 
	~"CommÚ/Logg”.h
"

24 
	~"AsyncComm/Re¥Ú£C®lback.h
"

25 
	~"AsyncComm/S”Ÿliz©iÚ.h
"

27 
	~"Hy³¹abË/Lib/Ty³s.h
"

29 
	~"RªgeS”v”.h
"

30 
	~"Reque¡HªdËrC»©eSÿÂ”.h
"

32 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

37 
	gReque¡HªdËrC»©eSÿÂ”
::
	$run
() {

38 
Re¥Ú£C®lbackC»©eSÿÂ”
 
	`cb
(
m_comm
, 
m_ev’t_±r
);

39 
TabËId’tif›rT
 
bË
;

40 
RªgeT
 
¿nge
;

41 
SÿnS³cifiÿtiÚT
 
sÿn_¥ec
;

42 
size_t
 
»maššg
 = 
m_ev’t_±r
->
mes§geL’
 - 2;

43 
ušt8_t
 *
msgPŒ
 = 
m_ev’t_±r
->
mes§ge
 + 2;

46 ià(!
	`DecodeTabËId’tif›r
(&
msgPŒ
, &
»maššg
, &
bË
))

47 
abÜt
;

50 ià(!
	`DecodeRªge
(&
msgPŒ
, &
»maššg
, &
¿nge
))

51 
abÜt
;

54 ià(!
	`DecodeSÿnS³cifiÿtiÚ
(&
msgPŒ
, &
»maššg
, &
sÿn_¥ec
))

55 
abÜt
;

57 
m_¿nge_£rv”
->
	`ü—‹_sÿÂ”
(&
cb
, &
bË
, &
¿nge
, &
sÿn_¥ec
);

60 
abÜt
:

61 
	`HT_ERROR
("Encoding…roblem with CreateScanner message");

62 
cb
.
	`”rÜ
(
E¼Ü
::
PROTOCOL_ERROR
, "Encoding…roblem with CreateScanner message");

63 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/RequestHandlerCreateScanner.h

21 #iâdeà
HYPERTABLE_REQUESTHANDLERCREATESCANNER_H


22 
	#HYPERTABLE_REQUESTHANDLERCREATESCANNER_H


	)

24 
	~"CommÚ/RuÂabË.h
"

26 
	~"AsyncComm/AµliÿtiÚHªdËr.h
"

27 
	~"AsyncComm/Comm.h
"

28 
	~"AsyncComm/Ev’t.h
"

30 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

32 
Çme¥aû
 
	gHy³¹abË
 {

34 
şass
 
	gRªgeS”v”
;

36 şas 
	cReque¡HªdËrC»©eSÿÂ”
 : 
public
 
AµliÿtiÚHªdËr
 {

37 
public
:

38 
Reque¡HªdËrC»©eSÿÂ”
(
Comm
 *
comm
, 
RªgeS”v”
 *
¿ngeS”v”
, 
Ev’tPŒ
 &
ev’tPŒ
è: 
AµliÿtiÚHªdËr
Óv’tPŒ), 
m_comm
(comm), 
m_¿nge_£rv”
(rangeServer) {

42 
vœtu®
 
run
();

44 
	g´iv©e
:

45 
Comm
 *
m_comm
;

46 
RªgeS”v”
 *
	gm_¿nge_£rv”
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/RequestHandlerDestroyScanner.cc

21 
	~"CommÚ/E¼Ü.h
"

22 
	~"CommÚ/Logg”.h
"

24 
	~"AsyncComm/Re¥Ú£C®lback.h
"

25 
	~"AsyncComm/S”Ÿliz©iÚ.h
"

27 
	~"Hy³¹abË/Lib/Ty³s.h
"

29 
	~"RªgeS”v”.h
"

30 
	~"Reque¡HªdËrDe¡roySÿÂ”.h
"

32 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

37 
	gReque¡HªdËrDe¡roySÿÂ”
::
	$run
() {

38 
Re¥Ú£C®lback
 
	`cb
(
m_comm
, 
m_ev’t_±r
);

39 
ušt32_t
 
sÿÂ”Id
;

40 
size_t
 
»maššg
 = 
m_ev’t_±r
->
mes§geL’
 - 2;

41 
ušt8_t
 *
msgPŒ
 = 
m_ev’t_±r
->
mes§ge
 + 2;

44 ià(!
S”Ÿliz©iÚ
::
	`decode_št
(&
msgPŒ
, &
»maššg
, &
sÿÂ”Id
))

45 
abÜt
;

47 
m_¿nge_£rv”
->
	`de¡roy_sÿÂ”
(&
cb
, 
sÿÂ”Id
);

50 
abÜt
:

51 
	`HT_ERROR
("Encoding…roblem with DestroyScanner message");

52 
cb
.
	`”rÜ
(
E¼Ü
::
PROTOCOL_ERROR
, "Encoding…roblem with DestroyScanner message");

53 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/RequestHandlerDestroyScanner.h

21 #iâdeà
HYPERTABLE_REQUESTHANDLERDESTROYSCANNER_H


22 
	#HYPERTABLE_REQUESTHANDLERDESTROYSCANNER_H


	)

24 
	~"CommÚ/RuÂabË.h
"

26 
	~"AsyncComm/AµliÿtiÚHªdËr.h
"

27 
	~"AsyncComm/Comm.h
"

28 
	~"AsyncComm/Ev’t.h
"

30 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

32 
Çme¥aû
 
	gHy³¹abË
 {

34 
şass
 
	gRªgeS”v”
;

36 şas 
	cReque¡HªdËrDe¡roySÿÂ”
 : 
public
 
AµliÿtiÚHªdËr
 {

37 
public
:

38 
Reque¡HªdËrDe¡roySÿÂ”
(
Comm
 *
comm
, 
RªgeS”v”
 *
¿ngeS”v”
, 
Ev’tPŒ
 &
ev’tPŒ
è: 
AµliÿtiÚHªdËr
Óv’tPŒ), 
m_comm
(comm), 
m_¿nge_£rv”
(rangeServer) {

42 
vœtu®
 
run
();

44 
	g´iv©e
:

45 
Comm
 *
m_comm
;

46 
RªgeS”v”
 *
	gm_¿nge_£rv”
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/RequestHandlerDropTable.cc

21 
	~"CommÚ/E¼Ü.h
"

22 
	~"CommÚ/Logg”.h
"

24 
	~"AsyncComm/Re¥Ú£C®lback.h
"

25 
	~"AsyncComm/S”Ÿliz©iÚ.h
"

27 
	~"Hy³¹abË/Lib/Ty³s.h
"

29 
	~"RªgeS”v”.h
"

30 
	~"Reque¡HªdËrDrİTabË.h
"

32 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

37 
	gReque¡HªdËrDrİTabË
::
	$run
() {

38 
Re¥Ú£C®lback
 
	`cb
(
m_comm
, 
m_ev’t_±r
);

39 cÚ¡ *
bË_Çme
;

40 
size_t
 
»maššg
 = 
m_ev’t_±r
->
mes§geL’
 - 2;

41 
ušt8_t
 *
msgPŒ
 = 
m_ev’t_±r
->
mes§ge
 + 2;

44 ià(!
S”Ÿliz©iÚ
::
	`decode_¡ršg
(&
msgPŒ
, &
»maššg
, &
bË_Çme
))

45 
abÜt
;

47 
m_¿nge_£rv”
->
	`drİ_bË
(&
cb
, 
bË_Çme
);

51 
abÜt
:

52 
	`HT_ERROR
("Encoding…roblem with DROP TABLE message");

53 
cb
.
	`”rÜ
(
E¼Ü
::
PROTOCOL_ERROR
, "Encoding…roblem with DROP TABLE message");

54 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/RequestHandlerDropTable.h

21 #iâdeà
HYPERTABLE_REQUESTHANDLERDROPTABLE_H


22 
	#HYPERTABLE_REQUESTHANDLERDROPTABLE_H


	)

24 
	~"CommÚ/RuÂabË.h
"

26 
	~"AsyncComm/AµliÿtiÚHªdËr.h
"

27 
	~"AsyncComm/Comm.h
"

28 
	~"AsyncComm/Ev’t.h
"

30 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

32 
Çme¥aû
 
	gHy³¹abË
 {

34 
şass
 
	gRªgeS”v”
;

36 şas 
	cReque¡HªdËrDrİTabË
 : 
public
 
AµliÿtiÚHªdËr
 {

37 
public
:

38 
Reque¡HªdËrDrİTabË
(
Comm
 *
comm
, 
RªgeS”v”
 *
¿ngeS”v”
, 
Ev’tPŒ
 &
ev’tPŒ
è: 
AµliÿtiÚHªdËr
Óv’tPŒ), 
m_comm
(comm), 
m_¿nge_£rv”
(rangeServer) {

42 
vœtu®
 
run
();

44 
	g´iv©e
:

45 
Comm
 *
m_comm
;

46 
RªgeS”v”
 *
	gm_¿nge_£rv”
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/RequestHandlerDumpStats.cc

21 
	~"AsyncComm/Re¥Ú£C®lback.h
"

23 
	~"Reque¡HªdËrDumpSts.h
"

24 
	~"RªgeS”v”.h
"

26 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

31 
	gReque¡HªdËrDumpSts
::
	$run
() {

32 
Re¥Ú£C®lback
 
	`cb
(
m_comm
, 
m_ev’t_±r
);

33 
m_¿nge_£rv”
->
	`dump_¡©s
(&
cb
);

34 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/RequestHandlerDumpStats.h

21 #iâdeà
HYPERTABLE_REQUESTHANDLERDUMPSTATS_H


22 
	#HYPERTABLE_REQUESTHANDLERDUMPSTATS_H


	)

24 
	~"CommÚ/RuÂabË.h
"

26 
	~"AsyncComm/AµliÿtiÚHªdËr.h
"

27 
	~"AsyncComm/Comm.h
"

28 
	~"AsyncComm/Ev’t.h
"

30 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

32 
Çme¥aû
 
	gHy³¹abË
 {

34 
şass
 
	gRªgeS”v”
;

36 şas 
	cReque¡HªdËrDumpSts
 : 
public
 
AµliÿtiÚHªdËr
 {

37 
public
:

38 
Reque¡HªdËrDumpSts
(
Comm
 *
comm
, 
RªgeS”v”
 *
¿ngeS”v”
, 
Ev’tPŒ
 &
ev’tPŒ
è: 
AµliÿtiÚHªdËr
Óv’tPŒ), 
m_comm
(comm), 
m_¿nge_£rv”
(rangeServer) {

42 
vœtu®
 
run
();

44 
	g´iv©e
:

45 
Comm
 *
m_comm
;

46 
RªgeS”v”
 *
	gm_¿nge_£rv”
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/RequestHandlerFetchScanblock.cc

21 
	~"CommÚ/E¼Ü.h
"

22 
	~"CommÚ/Logg”.h
"

24 
	~"AsyncComm/Re¥Ú£C®lback.h
"

25 
	~"AsyncComm/S”Ÿliz©iÚ.h
"

27 
	~"Hy³¹abË/Lib/Ty³s.h
"

29 
	~"RªgeS”v”.h
"

30 
	~"Reque¡HªdËrF‘chSÿnblock.h
"

32 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

37 
	gReque¡HªdËrF‘chSÿnblock
::
	$run
() {

38 
Re¥Ú£C®lbackF‘chSÿnblock
 
	`cb
(
m_comm
, 
m_ev’t_±r
);

39 
ušt32_t
 
sÿÂ”Id
;

40 
size_t
 
»maššg
 = 
m_ev’t_±r
->
mes§geL’
 - 2;

41 
ušt8_t
 *
msgPŒ
 = 
m_ev’t_±r
->
mes§ge
 + 2;

44 ià(!
S”Ÿliz©iÚ
::
	`decode_št
(&
msgPŒ
, &
»maššg
, &
sÿÂ”Id
))

45 
abÜt
;

47 
m_¿nge_£rv”
->
	`ãtch_sÿnblock
(&
cb
, 
sÿÂ”Id
);

50 
abÜt
:

51 
	`HT_ERROR
("Encoding…roblem with FetchScanblock message");

52 
cb
.
	`”rÜ
(
E¼Ü
::
PROTOCOL_ERROR
, "Encoding…roblem with FetchScanblock message");

53 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/RequestHandlerFetchScanblock.h

21 #iâdeà
HYPERTABLE_REQUESTHANDLERFETCHSCANBLOCK_H


22 
	#HYPERTABLE_REQUESTHANDLERFETCHSCANBLOCK_H


	)

24 
	~"CommÚ/RuÂabË.h
"

26 
	~"AsyncComm/AµliÿtiÚHªdËr.h
"

27 
	~"AsyncComm/Comm.h
"

28 
	~"AsyncComm/Ev’t.h
"

30 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

32 
Çme¥aû
 
	gHy³¹abË
 {

34 
şass
 
	gRªgeS”v”
;

36 şas 
	cReque¡HªdËrF‘chSÿnblock
 : 
public
 
AµliÿtiÚHªdËr
 {

37 
public
:

38 
Reque¡HªdËrF‘chSÿnblock
(
Comm
 *
comm
, 
RªgeS”v”
 *
¿ngeS”v”
, 
Ev’tPŒ
 &
ev’tPŒ
è: 
AµliÿtiÚHªdËr
Óv’tPŒ), 
m_comm
(comm), 
m_¿nge_£rv”
(rangeServer) {

42 
vœtu®
 
run
();

44 
	g´iv©e
:

45 
Comm
 *
m_comm
;

46 
RªgeS”v”
 *
	gm_¿nge_£rv”
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/RequestHandlerLoadRange.cc

21 
	~"CommÚ/E¼Ü.h
"

22 
	~"CommÚ/Logg”.h
"

24 
	~"AsyncComm/Re¥Ú£C®lback.h
"

25 
	~"AsyncComm/S”Ÿliz©iÚ.h
"

27 
	~"Hy³¹abË/Lib/Ty³s.h
"

29 
	~"RªgeS”v”.h
"

30 
	~"Reque¡HªdËrLßdRªge.h
"

32 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

37 
	gReque¡HªdËrLßdRªge
::
	$run
() {

38 
Re¥Ú£C®lback
 
	`cb
(
m_comm
, 
m_ev’t_±r
);

39 
TabËId’tif›rT
 
bË
;

40 
RªgeT
 
¿nge
;

41 
ušt64_t
 
soá_lim™
;

42 
ušt16_t
 
æags
;

43 
size_t
 
»maššg
 = 
m_ev’t_±r
->
mes§geL’
 - 2;

44 
ušt8_t
 *
msgPŒ
 = 
m_ev’t_±r
->
mes§ge
 + 2;

47 ià(!
	`DecodeTabËId’tif›r
(&
msgPŒ
, &
»maššg
, &
bË
))

48 
abÜt
;

51 ià(!
	`DecodeRªge
(&
msgPŒ
, &
»maššg
, &
¿nge
))

52 
abÜt
;

55 ià(!
S”Ÿliz©iÚ
::
	`decode_lÚg
(&
msgPŒ
, &
»maššg
, &
soá_lim™
))

56 
abÜt
;

59 ià(!
S”Ÿliz©iÚ
::
	`decode_shÜt
(&
msgPŒ
, &
»maššg
, &
æags
))

60 
abÜt
;

62 
m_¿nge_£rv”
->
	`lßd_¿nge
(&
cb
, &
bË
, &
¿nge
, 
soá_lim™
, 
æags
);

66 
abÜt
:

67 
	`HT_ERROR
("Encoding…roblem with LoadRange message");

68 
cb
.
	`”rÜ
(
E¼Ü
::
PROTOCOL_ERROR
, "Encoding…roblem with LoadRange message");

69 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/RequestHandlerLoadRange.h

21 #iâdeà
HYPERTABLE_REQUESTHANDLERLOADRANGE_H


22 
	#HYPERTABLE_REQUESTHANDLERLOADRANGE_H


	)

24 
	~"CommÚ/RuÂabË.h
"

26 
	~"AsyncComm/AµliÿtiÚHªdËr.h
"

27 
	~"AsyncComm/Comm.h
"

28 
	~"AsyncComm/Ev’t.h
"

30 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

32 
Çme¥aû
 
	gHy³¹abË
 {

34 
şass
 
	gRªgeS”v”
;

36 şas 
	cReque¡HªdËrLßdRªge
 : 
public
 
AµliÿtiÚHªdËr
 {

37 
public
:

38 
Reque¡HªdËrLßdRªge
(
Comm
 *
comm
, 
RªgeS”v”
 *
¿ngeS”v”
, 
Ev’tPŒ
 &
ev’tPŒ
è: 
AµliÿtiÚHªdËr
Óv’tPŒ), 
m_comm
(comm), 
m_¿nge_£rv”
(rangeServer) {

42 
vœtu®
 
run
();

44 
	g´iv©e
:

45 
Comm
 *
m_comm
;

46 
RªgeS”v”
 *
	gm_¿nge_£rv”
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/RequestHandlerStatus.cc

21 
	~"AsyncComm/Re¥Ú£C®lback.h
"

23 
	~"Reque¡HªdËrStus.h
"

25 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

30 
	gReque¡HªdËrStus
::
	$run
() {

31 
Re¥Ú£C®lback
 
	`cb
(
m_comm
, 
m_ev’t_±r
);

32 
cb
.
	`»¥Ú£_ok
();

33 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/RequestHandlerStatus.h

21 #iâdeà
HYPERTABLE_REQUESTHANDLERSTATUS_H


22 
	#HYPERTABLE_REQUESTHANDLERSTATUS_H


	)

24 
	~"CommÚ/RuÂabË.h
"

26 
	~"AsyncComm/AµliÿtiÚHªdËr.h
"

27 
	~"AsyncComm/Comm.h
"

28 
	~"AsyncComm/Ev’t.h
"

30 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

32 
Çme¥aû
 
	gHy³¹abË
 {

34 
şass
 
	gRªgeS”v”
;

36 şas 
	cReque¡HªdËrStus
 : 
public
 
AµliÿtiÚHªdËr
 {

37 
public
:

38 
Reque¡HªdËrStus
(
Comm
 *
comm
, 
RªgeS”v”
 *
¿ngeS”v”
, 
Ev’tPŒ
 &
ev’tPŒ
è: 
AµliÿtiÚHªdËr
Óv’tPŒ), 
m_comm
(comm), 
m_¿nge_£rv”
(rangeServer) {

42 
vœtu®
 
run
();

44 
	g´iv©e
:

45 
Comm
 *
m_comm
;

46 
RªgeS”v”
 *
	gm_¿nge_£rv”
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/RequestHandlerUpdate.cc

21 
	~"CommÚ/E¼Ü.h
"

22 
	~"CommÚ/Logg”.h
"

24 
	~"AsyncComm/Re¥Ú£C®lback.h
"

25 
	~"AsyncComm/S”Ÿliz©iÚ.h
"

27 
	~"Hy³¹abË/Lib/Ty³s.h
"

29 
	~"RªgeS”v”.h
"

30 
	~"Reque¡HªdËrUpd©e.h
"

32 
	~<vk.h
>

34 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

39 
	gReque¡HªdËrUpd©e
::
	$run
() {

40 
Re¥Ú£C®lbackUpd©e
 
	`cb
(
m_comm
, 
m_ev’t_±r
);

41 
TabËId’tif›rT
 
bË
;

42 
size_t
 
»maššg
 = 
m_ev’t_±r
->
mes§geL’
 - 2;

43 
ušt8_t
 *
msgPŒ
 = 
m_ev’t_±r
->
mes§ge
 + 2;

44 
BufãrT
 
mods
;

47 ià(!
	`DecodeTabËId’tif›r
(&
msgPŒ
, &
»maššg
, &
bË
))

48 
abÜt
;

50 
mods
.
buf
 = 
msgPŒ
;

51 
mods
.
Ën
 = 
»maššg
;

54 
m_¿nge_£rv”
->
	`upd©e
(&
cb
, &
bË
, 
mods
);

58 
abÜt
:

59 
	`HT_ERROR
("Encoding…roblem with Update message");

60 
cb
.
	`”rÜ
(
E¼Ü
::
PROTOCOL_ERROR
, "Encoding…roblem with Update message");

62 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/RequestHandlerUpdate.h

21 #iâdeà
HYPERTABLE_REQUESTHANDLERUPDATE_H


22 
	#HYPERTABLE_REQUESTHANDLERUPDATE_H


	)

24 
	~"CommÚ/RuÂabË.h
"

26 
	~"AsyncComm/AµliÿtiÚHªdËr.h
"

27 
	~"AsyncComm/Comm.h
"

28 
	~"AsyncComm/Ev’t.h
"

30 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

32 
Çme¥aû
 
	gHy³¹abË
 {

34 
şass
 
	gRªgeS”v”
;

36 şas 
	cReque¡HªdËrUpd©e
 : 
public
 
AµliÿtiÚHªdËr
 {

37 
public
:

38 
Reque¡HªdËrUpd©e
(
Comm
 *
comm
, 
RªgeS”v”
 *
¿ngeS”v”
, 
Ev’tPŒ
 &
ev’tPŒ
è: 
AµliÿtiÚHªdËr
Óv’tPŒ), 
m_comm
(comm), 
m_¿nge_£rv”
(rangeServer) {

42 
vœtu®
 
run
();

44 
	g´iv©e
:

45 
Comm
 *
m_comm
;

46 
RªgeS”v”
 *
	gm_¿nge_£rv”
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/ResponseCallbackCreateScanner.cc

21 
	~"Re¥Ú£C®lbackC»©eSÿÂ”.h
"

23 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

25 
	gRe¥Ú£C®lbackC»©eSÿÂ”
::
	$»¥Ú£
(
mÜeFÏg
, 
št32_t
 
id
, 
ExtBufãrT
 &
ext
) {

26 
hbud”_
.
	`š™Ÿlize_äom_»que¡
(
m_ev’t_±r
->
h—d”
);

27 
CommBufPŒ
 
	`cbufPŒ
Ğ
Ãw
 
	`CommBuf
(
hbud”_
, 10, 
ext
.
buf
,ƒxt.
Ën
) );

28 
cbufPŒ
->
	`­³nd_št
(
E¼Ü
::
OK
);

29 
cbufPŒ
->
	`­³nd_shÜt
(
mÜeFÏg
);

30 
cbufPŒ
->
	`­³nd_št
(
id
);

31  
m_comm
->
	`£nd_»¥Ú£
(
m_ev’t_±r
->
addr
, 
cbufPŒ
);

32 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/ResponseCallbackCreateScanner.h

21 #iâdeà
HYPERTABLE_RESPONSECALLBACKCREATESCANNER_H


22 
	#HYPERTABLE_RESPONSECALLBACKCREATESCANNER_H


	)

24 
	~"CommÚ/E¼Ü.h
"

26 
	~"AsyncComm/CommBuf.h
"

27 
	~"AsyncComm/Re¥Ú£C®lback.h
"

29 
Çme¥aû
 
	gHy³¹abË
 {

31 şas 
	cRe¥Ú£C®lbackC»©eSÿÂ”
 : 
public
 
Re¥Ú£C®lback
 {

32 
public
:

33 
Re¥Ú£C®lbackC»©eSÿÂ”
(
Comm
 *
comm
, 
Ev’tPŒ
 &
ev’tPŒ
è: 
Re¥Ú£C®lback
(comm,ƒventPtr) { ; }

34 
»¥Ú£
(
mÜeFÏg
, 
št32_t
 
id
, 
ExtBufãrT
 &
ext
);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/ResponseCallbackFetchScanblock.cc

21 
	~"Re¥Ú£C®lbackF‘chSÿnblock.h
"

23 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

25 
	gRe¥Ú£C®lbackF‘chSÿnblock
::
	$»¥Ú£
(
mÜeFÏg
, 
št32_t
 
id
, 
ExtBufãrT
 &
ext
) {

26 
hbud”_
.
	`š™Ÿlize_äom_»que¡
(
m_ev’t_±r
->
h—d”
);

27 
CommBufPŒ
 
	`cbufPŒ
Ğ
Ãw
 
	`CommBuf
(
hbud”_
, 10, 
ext
.
buf
,ƒxt.
Ën
) );

28 
cbufPŒ
->
	`­³nd_št
(
E¼Ü
::
OK
);

29 
cbufPŒ
->
	`­³nd_shÜt
(
mÜeFÏg
);

30 
cbufPŒ
->
	`­³nd_št
(
id
);

31  
m_comm
->
	`£nd_»¥Ú£
(
m_ev’t_±r
->
addr
, 
cbufPŒ
);

32 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/ResponseCallbackFetchScanblock.h

21 #iâdeà
HYPERTABLE_RESPONSECALLBACKFETCHSCANBLOCK_H


22 
	#HYPERTABLE_RESPONSECALLBACKFETCHSCANBLOCK_H


	)

24 
	~"CommÚ/E¼Ü.h
"

26 
	~"AsyncComm/CommBuf.h
"

27 
	~"AsyncComm/Re¥Ú£C®lback.h
"

29 
Çme¥aû
 
	gHy³¹abË
 {

31 şas 
	cRe¥Ú£C®lbackF‘chSÿnblock
 : 
public
 
Re¥Ú£C®lback
 {

32 
public
:

33 
Re¥Ú£C®lbackF‘chSÿnblock
(
Comm
 *
comm
, 
Ev’tPŒ
 &
ev’tPŒ
è: 
Re¥Ú£C®lback
(comm,ƒventPtr) { ; }

34 
»¥Ú£
(
mÜeFÏg
, 
št32_t
 
id
, 
ExtBufãrT
 &
ext
);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/ResponseCallbackUpdate.cc

21 
	~"Re¥Ú£C®lbackUpd©e.h
"

23 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

25 
	gRe¥Ú£C®lbackUpd©e
::
	$»¥Ú£
(
ExtBufãrT
 &
ext
) {

26 
hbud”_
.
	`š™Ÿlize_äom_»que¡
(
m_ev’t_±r
->
h—d”
);

27 
CommBufPŒ
 
	`cbufPŒ
Ğ
Ãw
 
	`CommBuf
(
hbud”_
, 4, 
ext
.
buf
,ƒxt.
Ën
) );

28 
cbufPŒ
->
	`­³nd_št
(
E¼Ü
::
RANGESERVER_PARTIAL_UPDATE
);

29  
m_comm
->
	`£nd_»¥Ú£
(
m_ev’t_±r
->
addr
, 
cbufPŒ
);

30 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/ResponseCallbackUpdate.h

21 #iâdeà
HYPERTABLE_RESPONSECALLBACKUPDATE_H


22 
	#HYPERTABLE_RESPONSECALLBACKUPDATE_H


	)

24 
	~"CommÚ/E¼Ü.h
"

26 
	~"AsyncComm/CommBuf.h
"

27 
	~"AsyncComm/Re¥Ú£C®lback.h
"

29 
Çme¥aû
 
	gHy³¹abË
 {

31 şas 
	cRe¥Ú£C®lbackUpd©e
 : 
public
 
Re¥Ú£C®lback
 {

32 
public
:

33 
Re¥Ú£C®lbackUpd©e
(
Comm
 *
comm
, 
Ev’tPŒ
 &
ev’tPŒ
è: 
Re¥Ú£C®lback
(comm,ƒventPtr) { ; }

34 
»¥Ú£
(
ExtBufãrT
 &
ext
);

35 
usšg
 
	gRe¥Ú£C®lback
::
»¥Ú£_ok
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/ScanContext.cc

21 
	~<®gÜ™hm
>

22 
	~<ÿs£¹
>

24 
	~"CommÚ/Logg”.h
"

26 
	~"Hy³¹abË/Lib/Key.h
"

28 
	~"SÿnCÚ‹xt.h
"

30 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

32 cÚ¡ 
ušt64_t
 
	gSÿnCÚ‹xt
::
END_OF_TIME
 = (uint64_t)-1;

38 
	gSÿnCÚ‹xt
::
	$š™Ÿlize
(
ušt64_t
 
ts
, 
SÿnS³cifiÿtiÚT
 *
ss
, 
RªgeT
 *
¿nge_
, 
SchemaPŒ
 &
¥
) {

39 
Schema
::
CŞumnFamy
 *
cŞumnFamy
;

40 
ušt32_t
 
max_v”siÚs
 = 0;

43 ià(
ss
) {

44 
š‹rv®
.
fœ¡
 = 
ss
->interval.first;

45 
š‹rv®
.
£cÚd
 = (
ss
->š‹rv®.£cÚd !ğ0è? 
¡d
::
	`mš
(
ts
, ss->interval.second) :s;

48 
š‹rv®
.
fœ¡
 = 0;

49 
š‹rv®
.
£cÚd
 = 
ts
;

52 ià(
š‹rv®
.
£cÚd
 == 0)

53 
š‹rv®
.
£cÚd
 = 
END_OF_TIME
;

55 
¥ec
 = 
ss
;

56 
¿nge
 = 
¿nge_
;

58 ià(
¥ec
 == 0)

59 
	`mem£t
(
çmyMask
, 
Œue
, 256*(
boŞ
));

61 
	`mem£t
(
çmyMask
, 
çl£
, 256*(
boŞ
));

62 
max_v”siÚs
 = 
¥ec
->max_versions;

65 
	`mem£t
(
çmyInfo
, 0, 256*(
C–lF‹rInfoT
));

67 ià(
¥
) {

69 
schemaPŒ
 = 
¥
;

70 ià(
¥ec
 && s³c->
cŞumns
.
	`size
() > 0) {

71 
¡d
::
veùÜ
<cÚ¡ *>::
cÚ¡_™”©Ü
 
™”
 = 
¥ec
->
cŞumns
.
	`begš
(); i‹¸!ğ¥ec->cŞumns.
	`’d
(); iter++) {

72 
cŞumnFamy
 = 
schemaPŒ
->
	`g‘_cŞumn_çmy
(*
™”
);

74 ià(
cŞumnFamy
 == 0)

75 
throw
 
Hy³¹abË
::
	`Exû±iÚ
(
E¼Ü
::
RANGESERVER_INVALID_COLUMNFAMILY
, *
™”
);

77 
çmyMask
[
cŞumnFamy
->
id
] = 
Œue
;

78 ià(
cŞumnFamy
->
‰l
 == 0)

79 
çmyInfo
[
cŞumnFamy
->
id
].
cutoffTime
 = 0;

81 
çmyInfo
[
cŞumnFamy
->
id
].
cutoffTime
 = 
ts
 - ((
ušt64_t
)cŞumnFamy->
‰l
 * 1000000000LL);

82 ià(
max_v”siÚs
 == 0)

83 
çmyInfo
[
cŞumnFamy
->
id
].
max_v”siÚs
 = columnFamily->max_versions;

85 ià(
cŞumnFamy
->
max_v”siÚs
 == 0)

86 
çmyInfo
[
cŞumnFamy
->
id
].
max_v”siÚs
 = max_versions;

88 
çmyInfo
[
cŞumnFamy
->
id
].
max_v”siÚs
 = (max_versions < columnFamily->max_versions) ? max_versions : columnFamily->max_versions;

93 
li¡
<
Schema
::
AcûssGroup
 *> *
agLi¡
 = 
schemaPŒ
->
	`g‘_acûss_group_li¡
();

95 
çmyMask
[0] = 
Œue
;

96 
li¡
<
Schema
::
AcûssGroup
 *>::
™”©Ü
 
agI‹r
 = 
agLi¡
->
	`begš
();‡gI‹¸!ğagLi¡->
	`’d
();‡gIter++) {

97 
li¡
<
Schema
::
CŞumnFamy
 *>::
™”©Ü
 
cfI‹r
 = (*
agI‹r
)->
cŞumns
.
	`begš
(); cfI‹¸!ğ(*agI‹r)->cŞumns.
	`’d
(); cfIter++) {

98 ià((*
cfI‹r
)->
id
 == 0)

99 
throw
 
Hy³¹abË
::
	`Exû±iÚ
(
E¼Ü
::
RANGESERVER_SCHEMA_INVALID_CFID
, (
¡d
::
¡ršg
)"Bad ID fÜ CŞumÀFamy '" + (*
cfI‹r
)->
Çme
 + "'");

100 
çmyMask
[(*
cfI‹r
)->
id
] = 
Œue
;

101 ià((*
cfI‹r
)->
‰l
 == 0)

102 
çmyInfo
[(*
cfI‹r
)->
id
].
cutoffTime
 = 0;

104 
çmyInfo
[(*
cfI‹r
)->
id
].
cutoffTime
 = 
ts
 - ((
ušt64_t
)(*cfI‹r)->
‰l
 * 1000000000LL);

106 ià(
max_v”siÚs
 == 0)

107 
çmyInfo
[(*
cfI‹r
)->
id
].
max_v”siÚs
 = (*cfIter)->max_versions;

109 ià((*
cfI‹r
)->
max_v”siÚs
 == 0)

110 
çmyInfo
[(*
cfI‹r
)->
id
].
max_v”siÚs
 = max_versions;

112 
çmyInfo
[(*
cfI‹r
)->
id
].
max_v”siÚs
 = (max_versions < (*cfIter)->max_versions) ? max_versions : (*cfIter)->max_versions;

122 ià(
¥ec
) {

125 
¡¬t_row
 = 
¥ec
->
¡¬tRow
;

126 ià(!
¥ec
->
¡¬tRowInşusive
)

127 
¡¬t_row
.
	`­³nd
(1,1);

130 ià(
¥ec
->
’dRow
[0] == 0)

131 
’d_row
 = 
Key
::
END_ROW_MARKER
;

133 
’d_row
 = 
¥ec
->
’dRow
;

134 ià(
¥ec
->
’dRowInşusive
) {

135 
ušt8_t
 
Ï¡_ch¬
 = 
¥ec
->
’dRow
[
	`¡¾’
(spec->endRow)-1];

136 ià(
Ï¡_ch¬
 == 0xff)

137 
’d_row
.
	`­³nd
(1,1);

139 
’d_row
[
	`¡¾’
(
¥ec
->
’dRow
)-1] = (
Ï¡_ch¬
+1);

144 
¡¬t_row
 = "";

145 
’d_row
 = 
Key
::
END_ROW_MARKER
;

148 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/ScanContext.h

20 #iâdeà
HYPERTABLE_SCANCONTEXT_H


21 
	#HYPERTABLE_SCANCONTEXT_H


	)

23 
	~<ÿs£¹
>

24 
	~<ut™y
>

26 
	~"CommÚ/By‹SŒšg.h
"

27 
	~"CommÚ/E¼Ü.h
"

28 
	~"CommÚ/Reã»nûCouÁ.h
"

30 
	~"Hy³¹abË/Lib/Key.h
"

31 
	~"Hy³¹abË/Lib/Schema.h
"

32 
	~"Hy³¹abË/Lib/Ty³s.h
"

34 
Çme¥aû
 
	gHy³¹abË
 {

37 
ušt64_t
 
	gcutoffTime
;

38 
ušt32_t
 
	gmax_v”siÚs
;

39 } 
	tC–lF‹rInfoT
;

44 şas 
	cSÿnCÚ‹xt
 : 
public
 
Reã»nûCouÁ
 {

45 
public
:

47 cÚ¡ 
ušt64_t
 
END_OF_TIME
;

49 
SchemaPŒ
 
	gschemaPŒ
;

50 
SÿnS³cifiÿtiÚT
 *
	g¥ec
;

51 
RªgeT
 *
	g¿nge
;

52 
	g¡d
::
¡ršg
 
¡¬t_row
;

53 
	g¡d
::
¡ršg
 
’d_row
;

54 
	g¡d
::
·œ
<
ušt64_t
, 
	gušt64_t
> 
	gš‹rv®
;

55 
boŞ
 
	gçmyMask
[256];

56 
C–lF‹rInfoT
 
	gçmyInfo
[256];

66 
SÿnCÚ‹xt
(
ušt64_t
 
ts
, 
SÿnS³cifiÿtiÚT
 *
ss
, 
RªgeT
 *
¿nge_
, 
SchemaPŒ
 &
¥
) {

67 
š™Ÿlize
(
ts
, 
ss
, 
¿nge_
, 
¥
);

76 
SÿnCÚ‹xt
(
ušt64_t
 
ts
, 
SchemaPŒ
 &
¥
) {

77 
š™Ÿlize
(
ts
, 0, 0, 
¥
);

85 
SÿnCÚ‹xt
(
ušt64_t
 
ts
) {

86 
SchemaPŒ
 
	gschemaPŒ
;

87 
š™Ÿlize
(
ts
, 0, 0, 
schemaPŒ
);

90 
	g´iv©e
:

105 
š™Ÿlize
(
ušt64_t
 
ts
, 
SÿnS³cifiÿtiÚT
 *
ss
, 
RªgeT
 *
¿nge_
, 
SchemaPŒ
 &
¥
);

109 
	gboo¡
::
	tšŒusive_±r
<
	tSÿnCÚ‹xt
> 
	tSÿnCÚ‹xtPŒ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/ScannerMap.cc

21 
	~"SÿÂ”M­.h
"

23 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

25 
©omic_t
 
	gSÿÂ”M­
::
ms_Ãxt_id
 = 
ATOMIC_INIT
(0);

30 
ušt32_t
 
	gSÿÂ”M­
::
	$put
(
C–lLi¡SÿÂ”PŒ
 &
sÿÂ”PŒ
, 
RªgePŒ
 &
¿ngePŒ
) {

31 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

32 
SÿnInfoT
 
sÿnInfo
;

33 
sÿnInfo
.
sÿÂ”PŒ
 = scannerPtr;

34 
sÿnInfo
.
¿ngePŒ
 =„angePtr;

35 
sÿnInfo
.
Ï¡_acûss
 = 
	`g‘_time¡amp
();

36 
ušt32_t
 
id
 = 
	`©omic_šc_»tuº
(&
ms_Ãxt_id
);

37 
m_sÿÂ”_m­
[
id
] = 
sÿnInfo
;

38  
id
;

39 
	}
}

46 
boŞ
 
	gSÿÂ”M­
::
	$g‘
(
ušt32_t
 
id
, 
C–lLi¡SÿÂ”PŒ
 &
sÿÂ”PŒ
, 
RªgePŒ
 &
¿ngePŒ
) {

47 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

48 
C–lLi¡SÿÂ”M­T
::
™”©Ü
 
™”
 = 
m_sÿÂ”_m­
.
	`fšd
(
id
);

49 ià(
™”
 =ğ
m_sÿÂ”_m­
.
	`’d
())

50  
çl£
;

51 (*
™”
).
£cÚd
.
Ï¡_acûss
 = 
	`g‘_time¡amp
();

52 
sÿÂ”PŒ
 = (*
™”
).
£cÚd
.scannerPtr;

53 
¿ngePŒ
 = (*
™”
).
£cÚd
.rangePtr;

54  
Œue
;

55 
	}
}

62 
boŞ
 
	gSÿÂ”M­
::
	$»move
(
ušt32_t
 
id
) {

63 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

64  (
m_sÿÂ”_m­
.
	`”a£
(
id
è=ğ0è? 
çl£
 : 
Œue
;

65 
	}
}

67 
	gSÿÂ”M­
::
	$purge_expœed
(
time_t
 
expœe_time
) {

68 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

69 
time_t
 
now
 = 
	`g‘_time¡amp
();

70 
C–lLi¡SÿÂ”M­T
::
™”©Ü
 
™”
 = 
m_sÿÂ”_m­
.
	`begš
();

72 
™”
 !ğ
m_sÿÂ”_m­
.
	`’d
()) {

73 ià((
now
 - (*
™”
).
£cÚd
.
Ï¡_acûss
è> 
expœe_time
) {

74 
C–lLi¡SÿÂ”M­T
::
™”©Ü
 
tmp_™”
 = 
™”
;

75 
	`HT_WARNF
("De¡royšg sÿÂ” %d beÿu£ iˆha nÙ b“Àu£d iÀ%u secÚds", (*
™”
).
fœ¡
, (
ušt32_t
)
expœe_time
);

76 
™”
++;

77 (*
tmp_™”
).
£cÚd
.
sÿÂ”PŒ
 = 0;

78 (*
tmp_™”
).
£cÚd
.
¿ngePŒ
 = 0;

79 
m_sÿÂ”_m­
.
	`”a£
(
tmp_™”
);

82 
™”
++;

85 
	}
}

88 
time_t
 
	gSÿÂ”M­
::
	$g‘_time¡amp
() {

89 
boo¡
::
xtime
 
now
;

90 
boo¡
::
	`xtime_g‘
(&
now
, boo¡::
TIME_UTC
);

91  (
time_t
)
now
.
£c
;

92 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/ScannerMap.h

20 #iâdeà
HYPERTABLE_SCANNERMAP_H


21 
	#HYPERTABLE_SCANNERMAP_H


	)

23 
	~<boo¡/th»ad/mu‹x.hµ
>

25 
	~<ext/hash_m­
>

28 
	~<time.h
>

31 
	~"CommÚ/©omic.h
"

33 
	~"C–lLi¡SÿÂ”.h
"

34 
	~"Rªge.h
"

36 
Çme¥aû
 
Hy³¹abË
 {

38 şas 
	cSÿÂ”M­
 {

40 
public
:

41 
SÿÂ”M­
(è: 
m_mu‹x
() { ; }

42 
ušt32_t
 
put
(
C–lLi¡SÿÂ”PŒ
 &
sÿÂ”PŒ
, 
RªgePŒ
 &
¿ngePŒ
);

43 
boŞ
 
g‘
(
ušt32_t
 
id
, 
C–lLi¡SÿÂ”PŒ
 &
sÿÂ”PŒ
, 
RªgePŒ
 &
¿ngePŒ
);

44 
boŞ
 
»move
(
ušt32_t
 
id
);

45 
purge_expœed
(
time_t
 
expœe_time
);

47 
´iv©e
:

49 
time_t
 
g‘_time¡amp
();

51 
©omic_t
 
ms_Ãxt_id
;

53 
boo¡
::
mu‹x
 
m_mu‹x
;

55 
C–lLi¡SÿÂ”PŒ
 
sÿÂ”PŒ
;

56 
RªgePŒ
 
¿ngePŒ
;

57 
time_t
 
Ï¡_acûss
;

58 } 
	tSÿnInfoT
;

59 
__gnu_cxx
::
	thash_m­
<
	tušt32_t
, 
	tSÿnInfoT
> 
	tC–lLi¡SÿÂ”M­T
;

61 
C–lLi¡SÿÂ”M­T
 
m_sÿÂ”_m­
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/ScannerTimestampController.cc

21 
	~"SÿÂ”Time¡ampCÚŒŞËr.h
"

23 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

26 
	gSÿÂ”Time¡ampCÚŒŞËr
::
	$add_upd©e_time¡amp
(
ušt64_t
 
time¡amp
) {

27 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

28 
m_upd©e_time¡amps
.
	`push_back
(
time¡amp
);

29 
	}
}

32 
	gSÿÂ”Time¡ampCÚŒŞËr
::
	$»move_upd©e_time¡amp
(
ušt64_t
 
time¡amp
) {

33 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

34 
Upd©eTime¡ampCÚš”T
::
Áh_šdex
<1>::
ty³
 &
sÜ‹d_šdex
 = 
m_upd©e_time¡amps
.
g‘
<1>();

35 
sÜ‹d_šdex
.
	`”a£
(
time¡amp
);

36 
	}
}

39 
ušt64_t
 
	gSÿÂ”Time¡ampCÚŒŞËr
::
	$g‘_Şde¡_upd©e_time¡amp
() {

40 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

41 
Upd©eTime¡ampCÚš”T
::
cÚ¡_™”©Ü
 
™”
 = 
m_upd©e_time¡amps
.
	`begš
();

42 ià(
™”
 =ğ
m_upd©e_time¡amps
.
	`’d
())

44  *
™”
;

45 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/ScannerTimestampController.h

21 #iâdeà
HYPERTABLE_SCANNERTIMESTAMPCONTROLLER_H


22 
	#HYPERTABLE_SCANNERTIMESTAMPCONTROLLER_H


	)

24 
	~<boo¡/muÉi_šdex_cÚš”.hµ
>

25 
	~<boo¡/muÉi_šdex/£qu’ûd_šdex.hµ
>

26 
	~<boo¡/muÉi_šdex/Üd”ed_šdex.hµ
>

27 
	~<boo¡/muÉi_šdex/id’t™y.hµ
>

28 
	~<boo¡/th»ad/mu‹x.hµ
>

30 
usšg
 
Çme¥aû
 
	gboo¡
;

31 
usšg
 
Çme¥aû
 
	gboo¡
::
muÉi_šdex
;

33 
Çme¥aû
 
	gHy³¹abË
 {

35 şas 
	cSÿÂ”Time¡ampCÚŒŞËr
 {

37 
	gpublic
:

39 
add_upd©e_time¡amp
(
ušt64_t
 
time¡amµ
);

40 
»move_upd©e_time¡amp
(
ušt64_t
 
time¡amp
);

41 
ušt64_t
 
g‘_Şde¡_upd©e_time¡amp
();

43 
	g´iv©e
:

45 
muÉi_šdex_cÚš”
<

46 
	tušt64_t
,

47 
	tšdexed_by
<

48 
	t£qu’ûd
<>,

49 
	tÜd”ed_unique
<
	tid’t™y
<
	tušt64_t
> >

51 > 
	tUpd©eTime¡ampCÚš”T
;

53 
	gboo¡
::
mu‹x
 
m_mu‹x
;

54 
Upd©eTime¡ampCÚš”T
 
	gm_upd©e_time¡amps
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/TableInfo.cc

21 
	~"CommÚ/Logg”.h
"

23 
	~"TabËInfo.h
"

25 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

31 
	gTabËInfo
::
	$TabËInfo
(
Ma¡”Cl›ÁPŒ
 &
ma¡”_ş›Á_±r
, 
TabËId’tif›rT
 *
id’tif›r
, 
SchemaPŒ
 &
schemaPŒ
è: 
	`m_mu‹x
(), 
	`m_ma¡”_ş›Á_±r
(ma¡”_ş›Á_±r), 
	$m_schema
(
schemaPŒ
) {

32 
	`Cİy
(*
id’tif›r
, 
m_id’tif›r
);

34 
	}
}

39 
	gTabËInfo
::~
	$TabËInfo
() {

40 
	`F»e
(
m_id’tif›r
);

41 
	}
}

44 
	gTabËInfo
::
	$dump_¿nge_bË
() {

45 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

46 
RªgeM­T
::
™”©Ü
 
™”
 = 
m_¿nge_m­
.
	`begš
(); i‹¸!ğm_¿nge_m­.
	`’d
(); iter++) {

47 
cout
 << 
m_id’tif›r
.
Çme
 << "[" << (*
™”
).
£cÚd
->
	`¡¬t_row
(è<< ".." << (*™”).£cÚd->
	`’d_row
(è<< "]" << 
’dl
;

49 
	}
}

54 
boŞ
 
	gTabËInfo
::
	$g‘_¿nge
(
RªgeT
 *
¿nge
, 
RªgePŒ
 &
¿ngePŒ
) {

55 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

56 
¡ršg
 
’dRow
 = 
¿nge
->endRow;

58 
RªgeM­T
::
™”©Ü
 
™”
 = 
m_¿nge_m­
.
	`fšd
(
’dRow
);

60 ià(
™”
 =ğ
m_¿nge_m­
.
	`’d
())

61  
çl£
;

63 
¿ngePŒ
 = (*
™”
).
£cÚd
;

65 
¡ršg
 
¡¬tRow
 = 
¿ngePŒ
->
	`¡¬t_row
();

67 ià(
	`¡rcmp
(
¡¬tRow
.
	`c_¡r
(), 
¿nge
->startRow))

68  
çl£
;

70  
Œue
;

71 
	}
}

78 
	gTabËInfo
::
	$add_¿nge
(
RªgeT
 *
¿nge
, 
RªgePŒ
 &
¿ngePŒ
) {

79 
boo¡
::
mu‹x
::
scİed_lock
 
	`lock
(
m_mu‹x
);

80 
RªgeM­T
::
™”©Ü
 
™”
 = 
m_¿nge_m­
.
	`fšd
(
¿nge
->
’dRow
);

81 
	`as£¹
(
™”
 =ğ
m_¿nge_m­
.
	`’d
());

82 
m_¿nge_m­
[
¿nge
->
’dRow
] = 
¿ngePŒ
;

83 
	}
}

89 
boŞ
 
	gTabËInfo
::
fšd_cÚššg_¿nge
(
¡d
::
¡ršg
 
row
, 
RªgePŒ
 &
¿ngePŒ
) {

90 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

92 
	gRªgeM­T
::
™”©Ü
 
™”
 = 
m_¿nge_m­
.
low”_bound
(
row
);

94 ià(
	g™”
 =ğ
m_¿nge_m­
.
’d
())

95  
çl£
;

97 ià(
	grow
 <ğ(*
™”
).
£cÚd
->
¡¬t_row
())

98  
çl£
;

100 
	g¿ngePŒ
 = (*
™”
).
£cÚd
;

102  
	gŒue
;

105 
	gTabËInfo
::
g‘_¿nge_veùÜ
(
¡d
::
veùÜ
<
RªgePŒ
> &
¿nge_vec
) {

106 
RªgeM­T
::
™”©Ü
 
™”
 = 
m_¿nge_m­
.
begš
(); 
	g™”
 !ğm_¿nge_m­.
’d
(); iter++)

107 
	g¿nge_vec
.
push_back
((*
™”
).
£cÚd
);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/TableInfo.h

20 #iâdeà
HYPERTABLE_TABLEINFO_H


21 
	#HYPERTABLE_TABLEINFO_H


	)

23 
	~<m­
>

24 
	~<¡ršg
>

26 
	~<boo¡/th»ad/mu‹x.hµ
>

28 
	~"CommÚ/SŒšgExt.h
"

29 
	~"CommÚ/Reã»nûCouÁ.h
"

31 
	~"Hy³¹abË/Lib/Ma¡”Cl›Á.h
"

32 
	~"Hy³¹abË/Lib/Ty³s.h
"

34 
	~"Rªge.h
"

36 
Çme¥aû
 
	gHy³¹abË
 {

38 
şass
 
	gSchema
;

40 şas 
	cTabËInfo
 : 
public
 
Reã»nûCouÁ
 {

42 
public
:

43 
TabËInfo
(
Ma¡”Cl›ÁPŒ
 &
ma¡”_ş›Á_±r
, 
TabËId’tif›rT
 *
id’tif›r
, 
SchemaPŒ
 &
schemaPŒ
);

44 
	gvœtu®
 ~
TabËInfo
();

45 cÚ¡ *
g‘_Çme
(è{  
	gm_id’tif›r
.
	gÇme
; }

46 
ušt32_t
 
g‘_id
(è{  
	gm_id’tif›r
.
	gid
; }

47 
	gSchemaPŒ
 &
g‘_schema
() {

48 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

49  
	gm_schema
;

51 
upd©e_schema
(
SchemaPŒ
 &
schemaPŒ
) {

52 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

53 
	gm_schema
 = 
schemaPŒ
;

55 
boŞ
 
g‘_¿nge
(
RªgeT
 *
¿nge
, 
RªgePŒ
 &
¿ngePŒ
);

56 
add_¿nge
(
RªgeT
 *
¿nge
, 
RªgePŒ
 &
¿ngePŒ
);

57 
boŞ
 
fšd_cÚššg_¿nge
(
¡d
::
¡ršg
 
row
, 
RªgePŒ
 &
¿ngePŒ
);

59 
dump_¿nge_bË
();

61 
g‘_¿nge_veùÜ
(
¡d
::
veùÜ
<
RªgePŒ
> &
¿nge_vec
);

63 
	g´iv©e
:

65 
¡d
::
	tm­
<
	t¡d
::
	t¡ršg
, 
	tRªgePŒ
> 
	tRªgeM­T
;

67 
	gboo¡
::
mu‹x
 
m_mu‹x
;

68 
Ma¡”Cl›ÁPŒ
 
	gm_ma¡”_ş›Á_±r
;

69 
TabËId’tif›rT
 
	gm_id’tif›r
;

70 
	g¡d
::
¡ršg
 
m_Çme
;

71 
SchemaPŒ
 
	gm_schema
;

72 
RªgeM­T
 
	gm_¿nge_m­
;

75 
	gboo¡
::
	tšŒusive_±r
<
	tTabËInfo
> 
	tTabËInfoPŒ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/TimerHandler.cc

21 
	~"CommÚ/E¼Ü.h
"

22 
	~"CommÚ/Exû±iÚ.h
"

23 
	~"CommÚ/IÃtAddr.h
"

24 
	~"CommÚ/SŒšgExt.h
"

25 
	~"CommÚ/Sy¡em.h
"

27 
	~"Tim”HªdËr.h
"

29 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

35 
	gTim”HªdËr
::
	$Tim”HªdËr
(
Comm
 *
comm
, 
RªgeS”v”
 *
¿nge_£rv”
è: 
	`m_comm
(comm), 
	$m_¿nge_£rv”
(
¿nge_£rv”
) {

36 
”rÜ
;

38 ià((
”rÜ
 = 
m_comm
->
	`£t_tim”
(
¿nge_£rv”
->
	`g‘_tim”_š‹rv®
(), 
this
)è!ğ
E¼Ü
::
OK
) {

39 
	`HT_ERRORF
("ProbËm s‘tšgim” - %s", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

40 
	`ex™
(1);

44 
	}
}

50 
	gTim”HªdËr
::
hªdË
(
Hy³¹abË
::
Ev’tPŒ
 &
ev’t_±r
) {

51 
”rÜ
;

53 
	gŒy
 {

55 ià(
	gev’t_±r
->
	gty³
 =ğ
Hy³¹abË
::
Ev’t
::
TIMER
) {

56 
m_¿nge_£rv”
->
do_maš‹Çnû
();

57 ià((
	g”rÜ
 = 
m_comm
->
£t_tim”
(
m_¿nge_£rv”
->
g‘_tim”_š‹rv®
(), 
this
)è!ğ
E¼Ü
::
OK
) {

58 
HT_ERRORF
("ProbËm s‘tšgim” - %s", 
E¼Ü
::
g‘_‹xt
(
”rÜ
));

59 
ex™
(1);

63 
HT_ERRORF
("UÃx³ùedƒv’ˆ- %s", 
ev’t_±r
->
toSŒšg
().
c_¡r
());

66 
ÿtch
 (
Hy³¹abË
::
Exû±iÚ
 &
e
) {

67 
HT_ERRORF
("% '%s'", 
e
.
code
(),ƒ.
wh©
());

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/TimerHandler.h

21 #iâdeà
HYPERSPACE_TIMERHANDLER_H


22 
	#HYPERSPACE_TIMERHANDLER_H


	)

24 
	~<boo¡/sh¬ed_±r.hµ
>

26 
	~"AsyncComm/Comm.h
"

27 
	~"AsyncComm/Di¥©chHªdËr.h
"

29 
	~"RªgeS”v”.h
"

31 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

33 
Çme¥aû
 
	gHy³r¥aû
 {

37 şas 
	cTim”HªdËr
 : 
public
 
Di¥©chHªdËr
 {

38 
public
:

39 
Tim”HªdËr
(
Comm
 *
comm
, 
RªgeS”v”
 *
¿nge_£rv”
);

40 
vœtu®
 
hªdË
(
Hy³¹abË
::
Ev’tPŒ
 &
ev’t_±r
);

42 
	g´iv©e
:

43 
Comm
 *
m_comm
;

44 
RªgeS”v”
 *
	gm_¿nge_£rv”
;

46 
	gboo¡
::
	tšŒusive_±r
<
	tTim”HªdËr
> 
	tTim”HªdËrPŒ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/Timestamp.h

21 #iâdeà
HYPERTABLE_TIMESTAMP_H


22 
	#HYPERTABLE_TIMESTAMP_H


	)

25 
	~<¡dšt.h
>

28 
Çme¥aû
 
Hy³¹abË
 {

30 şas 
	cTime¡amp
 {

31 
public
:

32 
Time¡amp
(
ušt64_t
 
l
, ušt64_ˆ
r
è: 
logiÿl
Ö), 
»®
(r) { ; }

33 
Time¡amp
(è: 
logiÿl
(0), 
»®
(0) { ; }

34 
ş—r
(è{ 
logiÿl
 = 
»®
 = 0; }

35 
ušt64_t
 
logiÿl
;

36 
ušt64_t
 
»®
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/count_stored.cc

21 
	~<f¡»am
>

22 
	~<io¡»am
>

23 
	~<¡ršg
>

25 
	~"CommÚ/Sy¡em.h
"

26 
	~"CommÚ/U§ge.h
"

28 
	~"DfsBrok”/Lib/Cl›Á.h
"

30 
	~"Hy³¹abË/Lib/Cl›Á.h
"

31 
	~"Hy³¹abË/Lib/Key.h
"

32 
	~"Hy³¹abË/Lib/KeyS³c.h
"

34 
	~"C–lStÜeV0.h
"

35 
	~"C–lStÜeSÿÂ”V0.h
"

36 
	~"C–lStÜeT¿”.h
"

37 
	~"Glob®.h
"

40 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

41 
usšg
 
Çme¥aû
 
	g¡d
;

43 
	gÇme¥aû
 {

45 cÚ¡ *
	gu§ge
[] = {

58 
	g¡d
::
¡ršg
 
¡¬t_row
;

59 
	g¡d
::
¡ršg
 
’d_row
;

60 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> 
ûÎ_¡Ües
;

61 } 
	tRªgeC–lStÜeInfoT
;

64 
	g¡d
::
¡ršg
 
¡¬t_row
;

65 
	g¡d
::
¡ršg
 
’d_row
;

66 
	g¡d
::
¡ršg
 
fe
;

67 } 
	tC–lStÜeInfoT
;

71 
fl_ûÎ_¡Üe_veùÜ
(
Cl›ÁPŒ
 &
hy³¹abË_ş›Á_±r
, cÚ¡ *
bË_Çme
, 
¡d
::
veùÜ
<
C–lStÜeInfoT
> &
fe_veùÜ
);

74 
	$maš
(
¬gc
, **
¬gv
) {

75 
Comm
 *
comm
;

76 
CÚÃùiÚMªag”PŒ
 
cÚn_mªag”_±r
;

77 
DfsBrok”
::
Cl›Á
 *
ş›Á
;

78 
Cl›ÁPŒ
 
hy³¹abË_ş›Á_±r
;

79 
¡d
::
veùÜ
<
C–lStÜeInfoT
> 
fe_veùÜ
;

80 cÚ¡ *
bË_Çme
 = 0;

81 
boŞ
 
h™_¡¬t
 = 
çl£
;

82 
Prİ”t›sPŒ
 
´İs_±r
;

83 
¡ršg
 
cÚfig_fe
 = "";

84 
C–lStÜeV0PŒ
 
ûÎ_¡Üe_±r
;

85 
SÿnCÚ‹xtPŒ
 
	`sÿn_cÚ‹xt_±r
Ğ
Ãw
 
	`SÿnCÚ‹xt
(
SÿnCÚ‹xt
::
END_OF_TIME
) );

86 
By‹SŒšg32T
 *
key
;

87 
By‹SŒšg32T
 *
v®ue
;

88 
ušt64_t
 
tÙ®_couÁ
 = 0;

89 
ušt64_t
 
¡Üe_couÁ
 = 0;

91 
i
=1; i<
¬gc
; i++) {

92 ià(
¬gv
[
i
][0] == '-')

93 
U§ge
::
	`dump_ªd_ex™
(
u§ge
);

94 ià(
bË_Çme
 == 0)

95 
bË_Çme
 = 
¬gv
[
i
];

97 
U§ge
::
	`dump_ªd_ex™
(
u§ge
);

100 ià(
bË_Çme
 == 0)

101 
U§ge
::
	`dump_ªd_ex™
(
u§ge
);

103 
Œy
 {

105 
hy³¹abË_ş›Á_±r
 = 
Ãw
 
	`Cl›Á
(
¬gv
[0]);

107 
	`ÿtch
 (
¡d
::
exû±iÚ
 &
e
) {

108 
û¼
 << "”rÜ: " << 
e
.
	`wh©
(è<< 
’dl
;

112 ià(
cÚfig_fe
 == "")

113 
cÚfig_fe
 = 
Sy¡em
::
š¡®lDœ
 + "/conf/hypertable.cfg";

115 
´İs_±r
 = 
Ãw
 
	`Prİ”t›s
(
cÚfig_fe
);

117 
comm
 = 
Ãw
 
	`Comm
();

118 
cÚn_mªag”_±r
 = 
Ãw
 
	`CÚÃùiÚMªag”
(
comm
);

120 
ş›Á
 = 
Ãw
 
DfsBrok”
::
	`Cl›Á
(
cÚn_mªag”_±r
, 
´İs_±r
);

121 ià(!
ş›Á
->
	`wa™_fÜ_cÚÃùiÚ
(15)) {

122 
û¼
 << "”rÜ:imed ouˆwa™šg fÜ DFS brok”" << 
’dl
;

123 
	`ex™
(1);

126 
Glob®
::
blockCache
 = 
Ãw
 
	`FeBlockCache
(200000000LL);

128 
	`fl_ûÎ_¡Üe_veùÜ
(
hy³¹abË_ş›Á_±r
, 
bË_Çme
, 
fe_veùÜ
);

130 
size_t
 
i
=0; i<
fe_veùÜ
.
	`size
(); i++) {

135 
ûÎ_¡Üe_±r
 = 
Ãw
 
	`C–lStÜeV0
(
ş›Á
);

136 
C–lLi¡SÿÂ”
 *
sÿÂ”
 = 0;

138 ià(
ûÎ_¡Üe_±r
->
	`İ’
(
fe_veùÜ
[
i
].
fe
.
	`c_¡r
(), 0, 0) != 0)

141 ià(
ûÎ_¡Üe_±r
->
	`lßd_šdex
() != 0)

144 
h™_¡¬t
 = (
fe_veùÜ
[
i
].
¡¬t_row
 =ğ""è? 
Œue
 : 
çl£
;

146 
¡Üe_couÁ
 = 0;

148 
sÿÂ”
 = 
ûÎ_¡Üe_±r
->
	`ü—‹_sÿÂ”
(
sÿn_cÚ‹xt_±r
);

149 
sÿÂ”
->
	`g‘
(&
key
, &
v®ue
)) {

150 ià(!
h™_¡¬t
) {

151 ià(
	`¡rcmp
((cÚ¡ *)
key
->
d©a
, 
fe_veùÜ
[
i
].
¡¬t_row
.
	`c_¡r
()) <= 0) {

152 
sÿÂ”
->
	`fÜw¬d
();

155 
h™_¡¬t
 = 
Œue
;

157 ià(
	`¡rcmp
((cÚ¡ *)
key
->
d©a
, 
fe_veùÜ
[
i
].
’d_row
.
	`c_¡r
()) > 0)

159 
¡Üe_couÁ
++;

160 
sÿÂ”
->
	`fÜw¬d
();

162 
d–‘e
 
sÿÂ”
;

164 
cout
 << 
¡Üe_couÁ
 << "\t" << 
fe_veùÜ
[
i
].
fe
 << "[" << fe_veùÜ[i].
¡¬t_row
 << ".." << fe_veùÜ[i].
’d_row
 << "]" << 
’dl
;

165 
tÙ®_couÁ
 +ğ
¡Üe_couÁ
;

169 
cout
 << 
tÙ®_couÁ
 << "\tTOTAL" << 
’dl
;

172 
	}
}

179 
fl_ûÎ_¡Üe_veùÜ
(
Cl›ÁPŒ
 &
hy³¹abË_ş›Á_±r
, cÚ¡ *
bË_Çme
, 
¡d
::
veùÜ
<
C–lStÜeInfoT
> &
fe_veùÜ
) {

180 
”rÜ
;

181 
TabËPŒ
 
	gbË_±r
;

182 
TabËSÿÂ”PŒ
 
	gsÿÂ”_±r
;

183 
SÿnS³cifiÿtiÚT
 
	gsÿn_¥ec
;

184 
C–lT
 
	gûÎ
;

185 
ušt32_t
 
	gbË_id
;

186 
	g¡¬t_row
[16];

187 
	g’d_row
[16];

188 
RªgeC–lStÜeInfoT
 
	g¿nge_ûÎ_¡Üe_šfo
;

189 
C–lStÜeInfoT
 
	gûÎ_¡Üe_šfo
;

191 
	gŒy
 {

194 ià((
	g”rÜ
 = 
hy³¹abË_ş›Á_±r
->
İ’_bË
("METADATA", 
bË_±r
)è!ğ
E¼Ü
::
OK
) {

195 
û¼
 << "E¼Ü: uÇbËØİ’abË 'WebS”v”Log' - " << 
E¼Ü
::
g‘_‹xt
(
”rÜ
è<< 
’dl
;

196 
ex™
(1);

199 ià((
	g”rÜ
 = 
hy³¹abË_ş›Á_±r
->
g‘_bË_id
(
bË_Çme
, &
bË_id
)è!ğ
E¼Ü
::
OK
) {

200 
û¼
 << 
E¼Ü
::
g‘_‹xt
(
”rÜ
è<< 
’dl
;

201 
ex™
(1);

205 
	gsÿn_¥ec
.
	growLim™
 = 0;

206 
	gsÿn_¥ec
.
	gmax_v”siÚs
 = 1;

207 
¥rštf
(
¡¬t_row
, "%d:", 
bË_id
);

208 
	gsÿn_¥ec
.
	g¡¬tRow
 = 
¡¬t_row
;

209 
¥rštf
(
’d_row
, "%d:%s", 
bË_id
, 
Key
::
END_ROW_MARKER
);

210 
	gsÿn_¥ec
.
	g’dRow
 = 
’d_row
;

211 
	gsÿn_¥ec
.
	g¡¬tRowInşusive
 = 
sÿn_¥ec
.
’dRowInşusive
 = 
Œue
;

212 
	gsÿn_¥ec
.
	gcŞumns
.
ş—r
();

213 
	gsÿn_¥ec
.
	gcŞumns
.
push_back
("Files");

214 
	gsÿn_¥ec
.
	gcŞumns
.
push_back
("StartRow");

215 
	gsÿn_¥ec
.
	gš‹rv®
.
	gfœ¡
 = 
sÿn_¥ec
.
š‹rv®
.
£cÚd
 = 0;

216 
	gsÿn_¥ec
.
	g»tuº_d–‘es
 = 
çl£
;

219 ià((
	g”rÜ
 = 
bË_±r
->
ü—‹_sÿÂ”
(
sÿn_¥ec
, 
sÿÂ”_±r
)è!ğ
E¼Ü
::
OK
) {

220 
û¼
 << "E¼Ü:…robËm c»©šg sÿÂ” oÀbË 'WebS”v”Log' - " << 
E¼Ü
::
g‘_‹xt
(
”rÜ
è<< 
’dl
;

221 
ex™
(1);

225 
ÿtch
 (
¡d
::
exû±iÚ
 &
e
) {

226 
û¼
 << "”rÜ: " << 
e
.
wh©
(è<< 
’dl
;

227 
ex™
(1);

230 
	g¿nge_ûÎ_¡Üe_šfo
.
	g¡¬t_row
 = "";

231 
	g¿nge_ûÎ_¡Üe_šfo
.
	g’d_row
 = "";

232 
	g¿nge_ûÎ_¡Üe_šfo
.
	gûÎ_¡Ües
.
ş—r
();

235 
	gsÿÂ”_±r
->
Ãxt
(
ûÎ
)) {

236 ià(
¡rcmp
(
ûÎ
.
row_key
, 
¿nge_ûÎ_¡Üe_šfo
.
’d_row
.
c_¡r
())) {

237 ià(
	g¿nge_ûÎ_¡Üe_šfo
.
	g’d_row
 != "") {

238 cÚ¡ *
’d_row_c¡r
 = 
¡rchr
(
¿nge_ûÎ_¡Üe_šfo
.
’d_row
.
c_¡r
(), ':');

239 ià(
	g’d_row_c¡r
 == 0) {

240 
û¼
 << "”rÜ: m®-fÜmedƒnd„ow (missšg cŞÚè- " << 
¿nge_ûÎ_¡Üe_šfo
.
’d_row
 << 
’dl
;

241 
ex™
(1);

243 
	g’d_row_c¡r
++;

244 
	gûÎ_¡Üe_šfo
.
	g¡¬t_row
 = 
¿nge_ûÎ_¡Üe_šfo
.
¡¬t_row
;

245 
	gûÎ_¡Üe_šfo
.
	g’d_row
 = 
’d_row_c¡r
;

246 
size_t
 
	gi
=0; i<
	g¿nge_ûÎ_¡Üe_šfo
.
	gûÎ_¡Ües
.
size
(); i++) {

247 
	gûÎ_¡Üe_šfo
.
	gfe
 = 
¿nge_ûÎ_¡Üe_šfo
.
ûÎ_¡Ües
[
i
];

248 
	gfe_veùÜ
.
push_back
(
ûÎ_¡Üe_šfo
);

251 
	g¿nge_ûÎ_¡Üe_šfo
.
	g¡¬t_row
 = "";

252 
	g¿nge_ûÎ_¡Üe_šfo
.
	g’d_row
 = 
ûÎ
.
row_key
;

253 
	g¿nge_ûÎ_¡Üe_šfo
.
	gûÎ_¡Ües
.
ş—r
();

256 ià(!
¡rcmp
(
ûÎ
.
cŞumn_çmy
, "StartRow"))

257 
	g¿nge_ûÎ_¡Üe_šfo
.
	g¡¬t_row
 = 
¡d
::
¡ršg
((cÚ¡ *)
ûÎ
.
v®ue
, c–l.
v®ue_Ën
);

258 ià(!
¡rcmp
(
ûÎ
.
cŞumn_çmy
, "Files")) {

259 
	g¡d
::
¡ršg
 
fes
 = 
¡d
::¡ršg((cÚ¡ *)
ûÎ
.
v®ue
, c–l.
v®ue_Ën
);

260 *
	g±r
, *
	g§ve_±r
;

261 
	g±r
 = 
¡¹ok_r
((*)
fes
.
c_¡r
(), "\n\r;", &
§ve_±r
);

262 
	g±r
) {

263 
	g¿nge_ûÎ_¡Üe_šfo
.
	gûÎ_¡Ües
.
push_back
(
±r
);

264 
	g±r
 = 
¡¹ok_r
(0, "\n\r;", &
§ve_±r
);

268 
	gû¼
 << "UÃx³ùed cŞumÀçmyƒncouÁ”ed: '" << 
	gûÎ
.
	gcŞumn_çmy
 << 
	g’dl
;

269 
ex™
(1);

273 ià(!
	g¿nge_ûÎ_¡Üe_šfo
.
	gûÎ_¡Ües
.
em±y
()) {

274 cÚ¡ *
	g’d_row_c¡r
 = 
¡rchr
(
¿nge_ûÎ_¡Üe_šfo
.
’d_row
.
c_¡r
(), ':');

275 ià(
	g’d_row_c¡r
 == 0) {

276 
û¼
 << "”rÜ: m®-fÜmedƒnd„ow (missšg cŞÚè- " << 
¿nge_ûÎ_¡Üe_šfo
.
’d_row
 << 
’dl
;

277 
ex™
(1);

279 
	g’d_row_c¡r
++;

280 
	gûÎ_¡Üe_šfo
.
	g¡¬t_row
 = 
¿nge_ûÎ_¡Üe_šfo
.
¡¬t_row
;

281 
	gûÎ_¡Üe_šfo
.
	g’d_row
 = 
’d_row_c¡r
;

282 
size_t
 
	gi
=0; i<
	g¿nge_ûÎ_¡Üe_šfo
.
	gûÎ_¡Ües
.
size
(); i++) {

283 
	gûÎ_¡Üe_šfo
.
	gfe
 = 
¿nge_ûÎ_¡Üe_šfo
.
ûÎ_¡Ües
[
i
];

284 
	gfe_veùÜ
.
push_back
(
ûÎ_¡Üe_šfo
);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/csdump.cc

20 
	~<¡ršg
>

21 
	~<veùÜ
>

22 
	~<io¡»am
>

24 
	~<boo¡/®gÜ™hm/¡ršg.hµ
>

26 
	~"AsyncComm/Comm.h
"

27 
	~"AsyncComm/CÚÃùiÚMªag”.h
"

28 
	~"AsyncComm/R—ùÜFaùÜy.h
"

30 
	~"CommÚ/By‹SŒšg.h
"

31 
	~"CommÚ/IÃtAddr.h
"

32 
	~"CommÚ/Logg”.h
"

33 
	~"CommÚ/Sy¡em.h
"

34 
	~"CommÚ/U§ge.h
"

36 
	~"DfsBrok”/Lib/Cl›Á.h
"

38 
	~"Hy³¹abË/Lib/Key.h
"

40 
	~"C–lStÜeV0.h
"

41 
	~"C–lStÜeSÿÂ”V0.h
"

42 
	~"C–lStÜeT¿”.h
"

43 
	~"Glob®.h
"

45 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

46 
usšg
 
Çme¥aû
 
	g¡d
;

48 
	gÇme¥aû
 {

49 cÚ¡ 
ušt16_t
 
	gDEFAULT_DFSBROKER_PORT
 = 38030;

51 cÚ¡ *
	gu§ge
[] = {

68 
	$maš
(
¬gc
, **
¬gv
) {

69 
Comm
 *
comm
;

70 
CÚÃùiÚMªag”PŒ
 
cÚnMªag”PŒ
;

71 
DfsBrok”
::
Cl›Á
 *
ş›Á
;

72 
¡d
::
¡ršg
 
âame
 = "";

73 
By‹SŒšg32T
 *
key
;

74 
By‹SŒšg32T
 *
v®ue
;

75 
boŞ
 
dump_®l
 = 
çl£
;

76 
C–lStÜeV0PŒ
 
ûÎStÜePŒ
;

77 
boŞ
 
couÁ_keys
 = 
çl£
;

78 
ušt64_t
 
key_couÁ
 = 0;

79 
¡d
::
¡ršg
 
¡¬t_key
, 
’d_key
;

80 
boŞ
 
gÙ_’d_key
 = 
çl£
;

81 
boŞ
 
h™_¡¬t
 = 
çl£
;

82 
Prİ”t›sPŒ
 
´İs_±r
;

83 
¡ršg
 
cÚfigFe
 = "";

85 
R—ùÜFaùÜy
::
	`š™Ÿlize
(1);

86 
Sy¡em
::
	`š™Ÿlize
(
¬gv
[0]);

88 
i
=1; i<
¬gc
; i++) {

89 ià(!
	`¡rcmp
(
¬gv
[
i
], "-a"))

90 
dump_®l
 = 
Œue
;

91 ià(!
	`¡rcmp
(
¬gv
[
i
], "-c") || !strcmp(argv[i], "--count"))

92 
couÁ_keys
 = 
Œue
;

93 ià(!
	`¡ºcmp
(
¬gv
[
i
], "--start-key=", 12)) {

94 
¡¬t_key
 = &
¬gv
[
i
][12];

95 
boo¡
::
	`Œim_if
(
¡¬t_key
, boo¡::
	`is_ªy_of
("'\""));

97 ià(!
	`¡ºcmp
(
¬gv
[
i
], "--end-key=", 10)) {

98 
’d_key
 = &
¬gv
[
i
][10];

99 
boo¡
::
	`Œim_if
(
’d_key
, boo¡::
	`is_ªy_of
("'\""));

100 
gÙ_’d_key
 = 
Œue
;

102 ià(!
	`¡rcmp
(
¬gv
[
i
], "--help"))

103 
U§ge
::
	`dump_ªd_ex™
(
u§ge
);

104 ià(
âame
 == "")

105 
âame
 = 
¬gv
[
i
];

107 
U§ge
::
	`dump_ªd_ex™
(
u§ge
);

110 ià(
âame
 == "")

111 
U§ge
::
	`dump_ªd_ex™
(
u§ge
);

113 ià(
cÚfigFe
 == "")

114 
cÚfigFe
 = 
Sy¡em
::
š¡®lDœ
 + "/conf/hypertable.cfg";

116 
´İs_±r
 = 
Ãw
 
	`Prİ”t›s
(
cÚfigFe
);

118 ià(
¡¬t_key
 == "")

119 
h™_¡¬t
 = 
Œue
;

121 
comm
 = 
Ãw
 
	`Comm
();

122 
cÚnMªag”PŒ
 = 
Ãw
 
	`CÚÃùiÚMªag”
(
comm
);

124 
ş›Á
 = 
Ãw
 
DfsBrok”
::
	`Cl›Á
(
cÚnMªag”PŒ
, 
´İs_±r
);

125 ià(!
ş›Á
->
	`wa™_fÜ_cÚÃùiÚ
(15)) {

126 
û¼
 << "”rÜ:imed ouˆwa™šg fÜ DFS brok”" << 
’dl
;

127 
	`ex™
(1);

130 
Glob®
::
blockCache
 = 
Ãw
 
	`FeBlockCache
(200000000LL);

135 
ûÎStÜePŒ
 = 
Ãw
 
	`C–lStÜeV0
(
ş›Á
);

136 
C–lLi¡SÿÂ”
 *
sÿÂ”
 = 0;

138 ià(
ûÎStÜePŒ
->
	`İ’
(
âame
.
	`c_¡r
(), 0, 0) != 0)

141 ià(
ûÎStÜePŒ
->
	`lßd_šdex
() != 0)

148 ià(
dump_®l
 || 
couÁ_keys
) {

149 
SÿnCÚ‹xtPŒ
 
	`sÿnCÚ‹xtPŒ
Ğ
Ãw
 
	`SÿnCÚ‹xt
(
SÿnCÚ‹xt
::
END_OF_TIME
) );

151 
sÿÂ”
 = 
ûÎStÜePŒ
->
	`ü—‹_sÿÂ”
(
sÿnCÚ‹xtPŒ
);

152 
sÿÂ”
->
	`g‘
(&
key
, &
v®ue
)) {

153 ià(!
h™_¡¬t
) {

154 ià(
	`¡rcmp
((cÚ¡ *)
key
->
d©a
, 
¡¬t_key
.
	`c_¡r
()) <= 0) {

155 
sÿÂ”
->
	`fÜw¬d
();

158 
h™_¡¬t
 = 
Œue
;

160 ià(
gÙ_’d_key
 && 
	`¡rcmp
((cÚ¡ *)
key
->
d©a
, 
’d_key
.
	`c_¡r
()) > 0)

162 ià(
couÁ_keys
)

163 
key_couÁ
++;

165 
cout
 << 
	`Key
(
key
è<< 
’dl
;

166 
sÿÂ”
->
	`fÜw¬d
();

168 
d–‘e
 
sÿÂ”
;

171 ià(
couÁ_keys
) {

172 
cout
 << 
key_couÁ
 << 
’dl
;

179 
cout
 << 
’dl
;

180 
cout
 << "BLOCK INDEX:" << 
’dl
;

181 
ûÎStÜePŒ
->
	`di¥Ïy_block_šfo
();

187 
C–lStÜeT¿”
 *
Œa”
 = 
ûÎStÜePŒ
->
	`g‘_Œa”
();

189 
cout
 << 
’dl
;

190 
cout
 << "TRAILER:" << 
’dl
;

191 
cout
 << *
Œa”
;

193 
cout
 << 
’dl
;

194 
cout
 << "OTHER:" << 
’dl
;

195 
cout
 << "¥l™„ow '" << 
ûÎStÜePŒ
->
	`g‘_¥l™_row
(è<< "'" << 
’dl
;

198 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/main.cc

21 
	~<c¡dlib
>

22 
	~<c¡ršg
>

23 
	~<io¡»am
>

24 
	~<f¡»am
>

25 
	~<¡ršg
>

28 
	~<pŞl.h
>

29 
	~<sys/ty³s.h
>

30 
	~<uni¡d.h
>

33 
	~"CommÚ/IÃtAddr.h
"

34 
	~"CommÚ/Logg”.h
"

35 
	~"CommÚ/Prİ”t›s.h
"

36 
	~"CommÚ/Sy¡em.h
"

37 
	~"CommÚ/U§ge.h
"

39 
	~"AsyncComm/AµliÿtiÚQueue.h
"

40 
	~"AsyncComm/Comm.h
"

41 
	~"AsyncComm/CÚÃùiÚMªag”.h
"

43 
	~"CÚÃùiÚHªdËr.h
"

44 
	~"Glob®.h
"

45 
	~"Hy³r¥aûSessiÚHªdËr.h
"

46 
	~"RªgeS”v”.h
"

47 
	~"Tim”HªdËr.h
"

49 
usšg
 
Çme¥aû
 
Hy³¹abË
;

50 
usšg
 
Çme¥aû
 
	g¡d
;

53 
	gÇme¥aû
 {

54 cÚ¡ *
	gu§ge
[] = {

69 cÚ¡ 
	gDEFAULT_WORKERS
 = 20;

76 
	$maš
(
¬gc
, **
¬gv
) {

78 
CÚÃùiÚMªag”PŒ
 
cÚn_mªag”_±r
;

79 
AµliÿtiÚQueuePŒ
 
­p_queue_±r
;

80 
CommPŒ
 
comm_±r
;

81 
¡ršg
 
cÚfigFe
 = "";

82 
¡ršg
 
pidFe
 = "";

83 
»aùÜCouÁ
;

84 *
logBrok”
 = 0;

85 
Prİ”t›sPŒ
 
´İs_±r
;

86 
wÜk”CouÁ
;

87 
Tim”HªdËrPŒ
 
tim”_hªdËr_±r
;

89 
Sy¡em
::
	`š™Ÿlize
(
¬gv
[0]);

90 
Glob®
::
v”bo£
 = 
çl£
;

92 ià(
¬gc
 > 1) {

93 
i
=1; i<
¬gc
; i++) {

94 ià(!
	`¡ºcmp
(
¬gv
[
i
], "--config=", 9))

95 
cÚfigFe
 = &
¬gv
[
i
][9];

96 ià(!
	`¡ºcmp
(
¬gv
[
i
], "--log-broker=", 13))

97 
logBrok”
 = &
¬gv
[
i
][13];

98 ià(!
	`¡ºcmp
(
¬gv
[
i
], "--pidfile=", 10))

99 
pidFe
 = &
¬gv
[
i
][10];

100 ià(!
	`¡rcmp
(
¬gv
[
i
], "--verbose") || !strcmp(argv[i], "-v"))

101 
Glob®
::
v”bo£
 = 
Œue
;

103 
U§ge
::
	`dump_ªd_ex™
(
u§ge
);

110 
	`¤ªd
(()
	`g‘pid
());

112 ià(
cÚfigFe
 == "")

113 
cÚfigFe
 = 
Sy¡em
::
š¡®lDœ
 + "/conf/hypertable.cfg";

115 
´İs_±r
 = 
Ãw
 
	`Prİ”t›s
(
cÚfigFe
);

116 ià(
Glob®
::
v”bo£
)

117 
´İs_±r
->
	`£t
("Hypertable.Verbose", "true");

119 ià(
logBrok”
 != 0) {

120 *
pÜtSŒ
 = 
	`¡rchr
(
logBrok”
, ':');

121 ià(
pÜtSŒ
 == 0) {

122 
	`HT_ERROR
("Invalid‡ddress format for --log-broker, must be <host>:<port>");

123 
	`ex™
(1);

125 *
pÜtSŒ
++ = 0;

126 
´İs_±r
->
	`£t
("Hy³¹abË.RªgeS”v”.Comm™Log.DfsBrok”.Ho¡", 
logBrok”
);

127 
´İs_±r
->
	`£t
("Hy³¹abË.RªgeS”v”.Comm™Log.DfsBrok”.PÜt", 
pÜtSŒ
);

130 
»aùÜCouÁ
 = 
´İs_±r
->
	`g‘_št
("Hy³¹abË.RªgeS”v”.R—ùÜs", 
Sy¡em
::
	`g‘_´oûssÜ_couÁ
());

131 
R—ùÜFaùÜy
::
	`š™Ÿlize
(
»aùÜCouÁ
);

132 
comm_±r
 = 
Ãw
 
	`Comm
();

134 
wÜk”CouÁ
 = 
´İs_±r
->
	`g‘_št
("Hy³¹abË.RªgeS”v”.WÜk”s", 
DEFAULT_WORKERS
);

136 
cÚn_mªag”_±r
 = 
Ãw
 
	`CÚÃùiÚMªag”
(
comm_±r
.
	`g‘
());

137 
­p_queue_±r
 = 
Ãw
 
	`AµliÿtiÚQueue
(
wÜk”CouÁ
);

142 
Glob®
::
hy³r¥aû_±r
 = 
Ãw
 
Hy³r¥aû
::
	`SessiÚ
(
comm_±r
.
	`g‘
(), 
´İs_±r
,‚ew 
	`Hy³r¥aûSessiÚHªdËr
());

143 ià(!
Glob®
::
hy³r¥aû_±r
->
	`wa™_fÜ_cÚÃùiÚ
(30)) {

144 
	`HT_ERROR
("Unableo connecto hyperspace,ƒxiting...");

145 
	`ex™
(1);

148 
Glob®
::
¿nge_m‘ad©a_max_by‹s
 = 
´İs_±r
->
	`g‘_št64
("Hypertable.RangeServer.Range.MetadataMaxBytes", 0LL);

150 ià(
Glob®
::
v”bo£
) {

151 
cout
 << "CPU couÁ = " << 
Sy¡em
::
	`g‘_´oûssÜ_couÁ
(è<< 
’dl
;

152 
cout
 << "Hy³¹abË.RªgeS”v”.R—ùÜs=" << 
»aùÜCouÁ
 << 
’dl
;

153 ià(
Glob®
::
¿nge_m‘ad©a_max_by‹s
 != 0)

154 
cout
 << "Hy³¹abË.RªgeS”v”.Rªge.M‘ad©aMaxBy‹s=" << 
Glob®
::
¿nge_m‘ad©a_max_by‹s
 << 
’dl
;

157 
RªgeS”v”PŒ
 
¿nge_£rv”_±r
 = 
Ãw
 
	`RªgeS”v”
(
´İs_±r
, 
cÚn_mªag”_±r
, 
­p_queue_±r
, 
Glob®
::
hy³r¥aû_±r
);

159 ià(
pidFe
 != "") {

160 
f¡»am
 
	`fe¡r
 (
pidFe
.
	`c_¡r
(), f¡»am::
out
);

161 
fe¡r
 << 
	`g‘pid
(è<< 
’dl
;

162 
fe¡r
.
	`şo£
();

166 
tim”_hªdËr_±r
 = 
Ãw
 
	`Tim”HªdËr
(
comm_±r
.
	`g‘
(), 
¿nge_£rv”_±r
.get());

168 
­p_queue_±r
->
	`još
();

170 
Glob®
::
m‘ad©a_bË_±r
 = 0;

172 
R—ùÜFaùÜy
::
	`de¡roy
();

174 
	`HT_ERROR
("Exiting RangeServer.");

177 
	`ex™
(1);

178 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/dfsclient/CommandCopyFromLocal.cc

22 
	~<¡dio.h
>

25 
	~"CommÚ/E¼Ü.h
"

26 
	~"CommÚ/Logg”.h
"

28 
	~"CommªdCİyFromLoÿl.h
"

30 
usšg
 
Çme¥aû
 
Hy³¹abË
;

32 
	gÇme¥aû
 {

33 cÚ¡ 
	gBUFFER_SIZE
 = 32768;

37 cÚ¡ *
	gCommªdCİyFromLoÿl
::
ms_u§ge
[] = {

46 
	gCommªdCİyFromLoÿl
::
	$run
() {

47 
Di¥©chHªdËrSynchrÚiz”
 
syncHªdËr
;

48 
št32_t
 
fd
 = 0;

49 
”rÜ
 = 
E¼Ü
::
OK
;

50 
Ev’tPŒ
 
ev’tPŒ
;

51 
FILE
 *
å
 = 0;

52 
size_t
 
Ä—d
;

53 
¤cArg
 = 0;

54 
ušt8_t
 *
buf
;

56 ià(
m_¬gs
.
	`size
() != 2) {

57 
û¼
 << "WrÚg‚umb” oà¬gum’ts. Ty³ 'h–p' fÜ u§ge." << 
’dl
;

61 ià((
å
 = 
	`fİ’
(
m_¬gs
[
¤cArg
].
fœ¡
.
	`c_¡r
(), "r")) == 0) {

62 
	`³¼Ü
(
m_¬gs
[
¤cArg
].
fœ¡
.
	`c_¡r
());

63 
abÜt
;

66 ià((
”rÜ
 = 
m_ş›Á
->
	`ü—‹
(
m_¬gs
[
¤cArg
+1].
fœ¡
, 
Œue
, -1, -1, -1, &
fd
)è!ğ
E¼Ü
::
OK
)

67 
abÜt
;

70 
i
=0; i<3; i++) {

71 
buf
 = 
Ãw
 
ušt8_t
 [ 
BUFFER_SIZE
 ];

72 ià((
Ä—d
 = 
	`ä—d
(
buf
, 1, 
BUFFER_SIZE
, 
å
)) == 0)

73 
dÚe
;

74 ià((
”rÜ
 = 
m_ş›Á
->
	`­³nd
(
fd
, 
buf
, 
Ä—d
, &
syncHªdËr
)è!ğ
E¼Ü
::
OK
)

75 
dÚe
;

78 
Œue
) {

80 ià(!
syncHªdËr
.
	`wa™_fÜ_»¶y
(
ev’tPŒ
)) {

81 
	`HT_ERRORF
("%s", 
ev’tPŒ
->
	`toSŒšg
().
	`c_¡r
());

82 
abÜt
;

85 
buf
 = 
Ãw
 
ušt8_t
 [ 
BUFFER_SIZE
 ];

86 ià((
Ä—d
 = 
	`ä—d
(
buf
, 1, 
BUFFER_SIZE
, 
å
)) == 0)

88 ià((
”rÜ
 = 
m_ş›Á
->
	`­³nd
(
fd
, 
buf
, 
Ä—d
, &
syncHªdËr
)è!ğ
E¼Ü
::
OK
)

89 
abÜt
;

92 
dÚe
:

94 ià((
”rÜ
 = 
m_ş›Á
->
	`şo£
(
fd
)è!ğ
E¼Ü
::
OK
)

95 
abÜt
;

97 
abÜt
:

98 ià(
å
)

99 
	`fşo£
(
å
);

100 ià(
”rÜ
 != 0)

101 
û¼
 << 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
è<< 
’dl
;

102  
”rÜ
;

103 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/dfsclient/CommandCopyFromLocal.h

21 #iâdeà
HYPERTABLE_COMMANDCOPYFROMLOCAL_H


22 
	#HYPERTABLE_COMMANDCOPYFROMLOCAL_H


	)

24 
	~<veùÜ
>

26 
	~"CommÚ/IÁ”aùiveCommªd.h
"

28 
	~"DfsBrok”/Lib/Cl›Á.h
"

30 
Çme¥aû
 
	gHy³¹abË
 {

32 şas 
	cCommªdCİyFromLoÿl
 : 
public
 
IÁ”aùiveCommªd
 {

33 
public
:

34 
CommªdCİyFromLoÿl
(
DfsBrok”
::
Cl›Á
 *
ş›Á
è: 
m_ş›Á
(client) { ; }

35 
vœtu®
 cÚ¡ *
commªd_‹xt
() {  "copyFromLocal"; }

36 
vœtu®
 cÚ¡ **
u§ge
(è{  
	gms_u§ge
; }

37 
vœtu®
 
run
();

39 
	g´iv©e
:

40 cÚ¡ *
ms_u§ge
[];

42 
	gDfsBrok”
::
Cl›Á
 *
m_ş›Á
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/dfsclient/CommandCopyToLocal.cc

22 
	~<¡dio.h
>

25 
	~"CommÚ/E¼Ü.h
"

26 
	~"CommÚ/Logg”.h
"

27 
	~"CommÚ/U§ge.h
"

29 
	~"CommªdCİyToLoÿl.h
"

31 
usšg
 
Çme¥aû
 
Hy³¹abË
;

33 
	gÇme¥aû
 {

34 cÚ¡ 
	gBUFFER_SIZE
 = 32768;

38 cÚ¡ *
	gCommªdCİyToLoÿl
::
ms_u§ge
[] = {

48 
	gCommªdCİyToLoÿl
::
	$run
() {

49 
Di¥©chHªdËrSynchrÚiz”
 
syncHªdËr
;

50 
št32_t
 
fd
 = 0;

51 
”rÜ
 = 
E¼Ü
::
OK
;

52 
Ev’tPŒ
 
ev’tPŒ
;

53 
FILE
 *
å
 = 0;

54 
ušt64_t
 
¡¬tOff£t
 = 0;

55 
¤cArg
 = 0;

56 
ušt64_t
 
off£t
;

57 
ušt32_t
 
amouÁ
;

58 
ušt8_t
 *
d¡
;

60 ià(
m_¬gs
.
	`size
() < 2) {

61 
û¼
 << "Insuffic›Á‚umb” oà¬gum’ts" << 
’dl
;

65 ià(!
	`¡rcmp
(
m_¬gs
[0].
fœ¡
.
	`c_¡r
(), "--£ek"è&& m_¬gs[0].
£cÚd
 != "") {

66 
¡¬tOff£t
 = 
	`¡¹Ş
(
m_¬gs
[0].
£cÚd
.
	`c_¡r
(), 0, 10);

67 
¤cArg
 = 1;

70 ià((
å
 = 
	`fİ’
(
m_¬gs
[
¤cArg
+1].
fœ¡
.
	`c_¡r
(), "w+")) == 0) {

71 
	`³¼Ü
(
m_¬gs
[
¤cArg
+1].
fœ¡
.
	`c_¡r
());

72 
abÜt
;

75 ià((
”rÜ
 = 
m_ş›Á
->
	`İ’
(
m_¬gs
[
¤cArg
].
fœ¡
, &
fd
)è!ğ
E¼Ü
::
OK
)

76 
abÜt
;

78 ià(
¡¬tOff£t
 > 0) {

79 ià((
”rÜ
 = 
m_ş›Á
->
	`£ek
(
fd
, 
¡¬tOff£t
)è!ğ
E¼Ü
::
OK
)

80 
abÜt
;

83 ià((
”rÜ
 = 
m_ş›Á
->
	`»ad
(
fd
, 
BUFFER_SIZE
, &
syncHªdËr
)è!ğ
E¼Ü
::
OK
)

84 
abÜt
;

86 ià((
”rÜ
 = 
m_ş›Á
->
	`»ad
(
fd
, 
BUFFER_SIZE
, &
syncHªdËr
)è!ğ
E¼Ü
::
OK
)

87 
abÜt
;

89 ià((
”rÜ
 = 
m_ş›Á
->
	`»ad
(
fd
, 
BUFFER_SIZE
, &
syncHªdËr
)è!ğ
E¼Ü
::
OK
)

90 
abÜt
;

92 
syncHªdËr
.
	`wa™_fÜ_»¶y
(
ev’tPŒ
)) {

94 ià((
”rÜ
 = 
Fesy¡em
::
	`decode_»¥Ú£_»ad_h—d”
(
ev’tPŒ
, &
off£t
, &
amouÁ
, &
d¡
)è!ğ
E¼Ü
::
OK
)

95 
abÜt
;

97 ià(
amouÁ
 > 0) {

98 ià(
	`fwr™e
(
d¡
, 
amouÁ
, 1, 
å
) != 1) {

99 
	`³¼Ü
("write failed");

100 
abÜt
;

104 ià(
amouÁ
 < (
ušt32_t
)
BUFFER_SIZE
) {

105 
syncHªdËr
.
	`wa™_fÜ_»¶y
(
ev’tPŒ
);

109 ià((
”rÜ
 = 
m_ş›Á
->
	`»ad
(
fd
, 
BUFFER_SIZE
, &
syncHªdËr
)è!ğ
E¼Ü
::
OK
)

110 
abÜt
;

113 ià((
”rÜ
 = 
m_ş›Á
->
	`şo£
(
fd
)è!ğ
E¼Ü
::
OK
)

114 
abÜt
;

116 
abÜt
:

117 ià(
å
)

118 
	`fşo£
(
å
);

119 ià(
”rÜ
 != 0)

120 
û¼
 << 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
è<< 
’dl
;

121  
”rÜ
;

122 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/dfsclient/CommandCopyToLocal.h

21 #iâdeà
HYPERTABLE_COMMANDCOPYTOLOCAL_H


22 
	#HYPERTABLE_COMMANDCOPYTOLOCAL_H


	)

24 
	~<veùÜ
>

26 
	~"CommÚ/IÁ”aùiveCommªd.h
"

28 
	~"DfsBrok”/Lib/Cl›Á.h
"

30 
Çme¥aû
 
	gHy³¹abË
 {

32 şas 
	cCommªdCİyToLoÿl
 : 
public
 
IÁ”aùiveCommªd
 {

33 
public
:

34 
CommªdCİyToLoÿl
(
DfsBrok”
::
Cl›Á
 *
ş›Á
è: 
m_ş›Á
(client) { ; }

35 
vœtu®
 cÚ¡ *
commªd_‹xt
() {  "copyToLocal"; }

36 
vœtu®
 cÚ¡ **
u§ge
(è{  
	gms_u§ge
; }

37 
vœtu®
 
run
();

39 
	g´iv©e
:

40 cÚ¡ *
ms_u§ge
[];

42 
	gDfsBrok”
::
Cl›Á
 *
m_ş›Á
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/dfsclient/CommandLength.cc

21 
	~"CommÚ/E¼Ü.h
"

23 
	~"CommªdL’gth.h
"

25 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

27 cÚ¡ *
	gCommªdL’gth
::
ms_u§ge
[] = {

36 
	gCommªdL’gth
::
	$run
() {

37 
št64_t
 
Ëngth
 = -1;

39 ià(
m_¬gs
.
	`size
() < 1) {

40 
û¼
 << "E¼Ü:‚Øf’amsuµl›d" << 
’dl
;

44 
m_ş›Á
->
	`Ëngth
(
m_¬gs
[0].
fœ¡
, &
Ëngth
);

46 
cout
 << 
Ëngth
 << 
’dl
;

48  
E¼Ü
::
OK
;

49 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/dfsclient/CommandLength.h

21 #iâdeà
HYPERTABLE_COMMANDLENGTH_H


22 
	#HYPERTABLE_COMMANDLENGTH_H


	)

24 
	~<veùÜ
>

26 
	~"CommÚ/IÁ”aùiveCommªd.h
"

28 
	~"DfsBrok”/Lib/Cl›Á.h
"

30 
Çme¥aû
 
	gHy³¹abË
 {

32 şas 
	cCommªdL’gth
 : 
public
 
IÁ”aùiveCommªd
 {

33 
public
:

34 
CommªdL’gth
(
DfsBrok”
::
Cl›Á
 *
ş›Á
è: 
m_ş›Á
(client) { ; }

35 
vœtu®
 cÚ¡ *
commªd_‹xt
() {  "length"; }

36 
vœtu®
 cÚ¡ **
u§ge
(è{  
	gms_u§ge
; }

37 
vœtu®
 
run
();

39 
	g´iv©e
:

40 cÚ¡ *
ms_u§ge
[];

42 
	gDfsBrok”
::
Cl›Á
 *
m_ş›Á
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/dfsclient/CommandMkdirs.cc

21 
	~"CommÚ/E¼Ü.h
"

23 
	~"CommªdMkdœs.h
"

25 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

27 cÚ¡ *
	gCommªdMkdœs
::
ms_u§ge
[] = {

36 
	gCommªdMkdœs
::
	$run
() {

37 ià(
m_¬gs
.
	`size
() < 1) {

38 
û¼
 << "E¼Ü: NØdœeùÜy‚amsuµl›d." << 
’dl
;

41  
m_ş›Á
->
	`mkdœs
(
m_¬gs
[0].
fœ¡
);

42 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/dfsclient/CommandMkdirs.h

21 #iâdeà
HYPERTABLE_COMMANDMKDIRS_H


22 
	#HYPERTABLE_COMMANDMKDIRS_H


	)

24 
	~<veùÜ
>

26 
	~"CommÚ/IÁ”aùiveCommªd.h
"

28 
	~"DfsBrok”/Lib/Cl›Á.h
"

30 
Çme¥aû
 
	gHy³¹abË
 {

32 şas 
	cCommªdMkdœs
 : 
public
 
IÁ”aùiveCommªd
 {

33 
public
:

34 
CommªdMkdœs
(
DfsBrok”
::
Cl›Á
 *
ş›Á
è: 
m_ş›Á
(client) { ; }

35 
vœtu®
 cÚ¡ *
commªd_‹xt
() {  "mkdirs"; }

36 
vœtu®
 cÚ¡ **
u§ge
(è{  
	gms_u§ge
; }

37 
vœtu®
 
run
();

39 
	g´iv©e
:

40 cÚ¡ *
ms_u§ge
[];

42 
	gDfsBrok”
::
Cl›Á
 *
m_ş›Á
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/dfsclient/CommandRemove.cc

21 
	~"CommÚ/E¼Ü.h
"

23 
	~"CommªdRemove.h
"

25 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

27 cÚ¡ *
	gCommªdRemove
::
ms_u§ge
[] = {

36 
	gCommªdRemove
::
	$run
() {

37 ià(
m_¬gs
.
	`size
() < 1) {

38 
û¼
 << "E¼Ü:‚Øf’amsuµl›d." << 
’dl
;

42  
m_ş›Á
->
	`»move
(
m_¬gs
[0].
fœ¡
);

43 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/dfsclient/CommandRemove.h

21 #iâdeà
HYPERTABLE_COMMANDREMOVE_H


22 
	#HYPERTABLE_COMMANDREMOVE_H


	)

24 
	~<veùÜ
>

26 
	~"CommÚ/IÁ”aùiveCommªd.h
"

28 
	~"DfsBrok”/Lib/Cl›Á.h
"

30 
Çme¥aû
 
	gHy³¹abË
 {

32 şas 
	cCommªdRemove
 : 
public
 
IÁ”aùiveCommªd
 {

33 
public
:

34 
CommªdRemove
(
DfsBrok”
::
Cl›Á
 *
ş›Á
è: 
m_ş›Á
(client) { ; }

35 
vœtu®
 cÚ¡ *
commªd_‹xt
() {  "remove"; }

36 
vœtu®
 cÚ¡ **
u§ge
(è{  
	gms_u§ge
; }

37 
vœtu®
 
run
();

39 
	g´iv©e
:

40 cÚ¡ *
ms_u§ge
[];

42 
	gDfsBrok”
::
Cl›Á
 *
m_ş›Á
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/dfsclient/CommandRmdir.cc

21 
	~"CommÚ/E¼Ü.h
"

23 
	~"CommªdRmdœ.h
"

25 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

27 cÚ¡ *
	gCommªdRmdœ
::
ms_u§ge
[] = {

36 
	gCommªdRmdœ
::
	$run
() {

37 ià(
m_¬gs
.
	`size
() < 1) {

38 
û¼
 << "E¼Ü:‚Øf’amsuµl›d." << 
’dl
;

42  
m_ş›Á
->
	`rmdœ
(
m_¬gs
[0].
fœ¡
);

43 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/dfsclient/CommandRmdir.h

21 #iâdeà
HYPERTABLE_COMMANDRMDIR_H


22 
	#HYPERTABLE_COMMANDRMDIR_H


	)

24 
	~<veùÜ
>

26 
	~"CommÚ/IÁ”aùiveCommªd.h
"

28 
	~"DfsBrok”/Lib/Cl›Á.h
"

30 
Çme¥aû
 
	gHy³¹abË
 {

32 şas 
	cCommªdRmdœ
 : 
public
 
IÁ”aùiveCommªd
 {

33 
public
:

34 
CommªdRmdœ
(
DfsBrok”
::
Cl›Á
 *
ş›Á
è: 
m_ş›Á
(client) { ; }

35 
vœtu®
 cÚ¡ *
commªd_‹xt
() {  "rmdir"; }

36 
vœtu®
 cÚ¡ **
u§ge
(è{  
	gms_u§ge
; }

37 
vœtu®
 
run
();

39 
	g´iv©e
:

40 cÚ¡ *
ms_u§ge
[];

42 
	gDfsBrok”
::
Cl›Á
 *
m_ş›Á
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/dfsclient/CommandShutdown.cc

21 
	~"CommÚ/E¼Ü.h
"

22 
	~"CommÚ/U§ge.h
"

24 
	~"DfsBrok”/Lib/PrÙocŞ.h
"

26 
	~"CommªdShutdown.h
"

28 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

30 cÚ¡ *
	gCommªdShutdown
::
ms_u§ge
[] = {

42 
	gCommªdShutdown
::
	$run
() {

43 
Di¥©chHªdËrSynchrÚiz”
 
syncHªdËr
;

44 
ušt16_t
 
æags
 = 0;

45 
Ev’tPŒ
 
ev’tPŒ
;

47 ià(
m_¬gs
.
	`size
() > 0) {

48 ià(
m_¬gs
[0].
fœ¡
 == "now")

49 
æags
 |ğ
DfsBrok”
::
PrÙocŞ
::
SHUTDOWN_FLAG_IMMEDIATE
;

51 
U§ge
::
	`dump
(
ms_u§ge
);

56 
m_ş›Á
->
	`shutdown
(
æags
, &
syncHªdËr
);

58 
syncHªdËr
.
	`wa™_fÜ_»¶y
(
ev’tPŒ
);

60  
E¼Ü
::
OK
;

61 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/dfsclient/CommandShutdown.h

21 #iâdeà
HYPERTABLE_COMMANDSHUTDOWN_H


22 
	#HYPERTABLE_COMMANDSHUTDOWN_H


	)

24 
	~<veùÜ
>

26 
	~"CommÚ/IÁ”aùiveCommªd.h
"

28 
	~"DfsBrok”/Lib/Cl›Á.h
"

30 
Çme¥aû
 
	gHy³¹abË
 {

32 şas 
	cCommªdShutdown
 : 
public
 
IÁ”aùiveCommªd
 {

33 
public
:

34 
CommªdShutdown
(
DfsBrok”
::
Cl›Á
 *
ş›Á
è: 
m_ş›Á
(client) { ; }

35 
vœtu®
 cÚ¡ *
commªd_‹xt
() {  "shutdown"; }

36 
vœtu®
 cÚ¡ **
u§ge
(è{  
	gms_u§ge
; }

37 
vœtu®
 
run
();

39 
	g´iv©e
:

40 cÚ¡ *
ms_u§ge
[];

42 
	gDfsBrok”
::
Cl›Á
 *
m_ş›Á
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/dfsclient/dfsTest.cc

21 
	~<®gÜ™hm
>

22 
	~<f¡»am
>

23 
	~<io¡»am
>

24 
	~<¡ršg
>

25 
	~<veùÜ
>

28 
	~<pŞl.h
>

29 
	~<sigÇl.h
>

30 
	~<sys/ty³s.h
>

31 
	~<uni¡d.h
>

34 
	~<boo¡/th»ad/th»ad.hµ
>

36 
	~"CommÚ/E¼Ü.h
"

37 
	~"CommÚ/FeUts.h
"

38 
	~"CommÚ/IÃtAddr.h
"

39 
	~"CommÚ/Logg”.h
"

40 
	~"CommÚ/Sy¡em.h
"

41 
	~"CommÚ/U§ge.h
"

43 
	~"AsyncComm/Comm.h
"

44 
	~"AsyncComm/CÚÃùiÚMªag”.h
"

45 
	~"AsyncComm/Ev’t.h
"

46 
	~"AsyncComm/R—ùÜFaùÜy.h
"

48 
	~"DfsBrok”/Lib/Cl›Á.h
"

50 
	~"dfsTe¡Th»adFunùiÚ.h
"

52 
usšg
 
Çme¥aû
 
Hy³¹abË
;

53 
usšg
 
Çme¥aû
 
	g¡d
;

55 
	gÇme¥aû
 {

56 cÚ¡ 
ušt16_t
 
	gDEFAULT_DFSBROKER_PORT
 = 38030;

57 cÚ¡ *
	gu§ge
[] = {

70 
	$maš
(
¬gc
, **
¬gv
) {

71 
boo¡
::
th»ad
 *
th»ad1
, *
th»ad2
;

72 
sockaddr_š
 
addr
;

73 
Comm
 *
comm
;

74 
CÚÃùiÚMªag”PŒ
 
cÚnMªag”PŒ
;

75 
DfsBrok”
::
Cl›Á
 *
ş›Á
;

76 
buf
[32];

77 
¡d
::
¡ršg
 
‹¡Dœ
, 
outfeA
, 
outfeB
;

78 
”rÜ
;

80 
f¡»am
 
	`fe¡r
 ("dfsTe¡.out", f¡»am::
out
);

82 ià(
¬gc
 != 1)

83 
U§ge
::
	`dump_ªd_ex™
(
u§ge
);

85 
Sy¡em
::
	`š™Ÿlize
(
¬gv
[0]);

86 
R—ùÜFaùÜy
::
	`š™Ÿlize
(1);

88 
IÃtAddr
::
	`š™Ÿlize
(&
addr
, "loÿlho¡", 
DEFAULT_DFSBROKER_PORT
);

90 
comm
 = 
Ãw
 
	`Comm
();

91 
cÚnMªag”PŒ
 = 
Ãw
 
	`CÚÃùiÚMªag”
(
comm
);

92 
ş›Á
 = 
Ãw
 
DfsBrok”
::
	`Cl›Á
(
cÚnMªag”PŒ
, 
addr
, 15);

94 ià(!
ş›Á
->
	`wa™_fÜ_cÚÃùiÚ
(15)) {

95 
	`HT_ERROR
("Unableo connecto DFS");

99 
	`¥rštf
(
buf
, "/dfsTe¡%d", 
	`g‘pid
());

100 
‹¡Dœ
 = 
buf
;

101 ià((
”rÜ
 = 
ş›Á
->
	`mkdœs
(
‹¡Dœ
)è!ğ
E¼Ü
::
OK
) {

102 
	`HT_ERRORF
("ProbËm makšg DFS dœeùÜy '%s' - %s", 
‹¡Dœ
.
	`c_¡r
(), 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

103 
	`ex™
(1);

105 
outfeA
 = 
‹¡Dœ
 + "/output.a";

106 
outfeB
 = 
‹¡Dœ
 + "/output.b";

108 
dfsTe¡Th»adFunùiÚ
 
	`th»adFunc
(
ş›Á
, "/usr/share/dict/words");

110 
th»adFunc
.
	`£t_dfs_fe
(
outfeA
);

111 
th»adFunc
.
	`£t_ouut_fe
("output.a");

112 
th»ad1
 = 
Ãw
 
boo¡
::
	`th»ad
(
th»adFunc
);

114 
th»adFunc
.
	`£t_dfs_fe
(
outfeB
);

115 
th»adFunc
.
	`£t_ouut_fe
("output.b");

116 
th»ad2
 = 
Ãw
 
boo¡
::
	`th»ad
(
th»adFunc
);

118 
th»ad1
->
	`još
();

119 
th»ad2
->
	`još
();

125 
veùÜ
<
¡ršg
> 
li¡šg
;

127 ià((
”rÜ
 = 
ş›Á
->
	`»addœ
(
‹¡Dœ
, 
li¡šg
)è!ğ
E¼Ü
::
OK
) {

128 
	`HT_ERRORF
("ProbËm†i¡šg DFSe¡ dœeùÜy '%s' - %s", 
‹¡Dœ
.
	`c_¡r
(), 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

132 
	`sÜt
(
li¡šg
.
	`begš
(),†i¡šg.
	`’d
());

134 
size_t
 
i
=0; i<
li¡šg
.
	`size
(); i++)

135 
fe¡r
 << 
li¡šg
[
i
] << 
’dl
;

138 
fe¡r
.
	`şo£
();

140 ià(
	`sy¡em
("diff dfsTest.out dfsTest.golden"))

143 ià((
”rÜ
 = 
ş›Á
->
	`rmdœ
(
‹¡Dœ
)è!ğ
E¼Ü
::
OK
) {

144 
	`HT_ERRORF
("ProbËm„emovšg DFSe¡ dœeùÜy '%s' - %s", 
‹¡Dœ
.
	`c_¡r
(), 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

148 ià(
	`sy¡em
("diff /usr/share/dict/words output.a"))

151 ià(
	`sy¡em
("diff output.a output.b"))

155 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/dfsclient/dfsTestThreadFunction.cc

21 
	~<io¡»am
>

22 
	~<veùÜ
>

25 
	~<”ºo.h
>

26 
	~<sys/ty³s.h
>

27 
	~<sys/¡©.h
>

30 
	~"CommÚ/Logg”.h
"

32 
	~"CommªdCİyFromLoÿl.h
"

33 
	~"CommªdCİyToLoÿl.h
"

34 
	~"CommªdRemove.h
"

35 
	~"CommªdL’gth.h
"

36 
	~"CommªdMkdœs.h
"

37 
	~"dfsTe¡Th»adFunùiÚ.h
"

39 
usšg
 
Çme¥aû
 
Hy³¹abË
;

40 
usšg
 
Çme¥aû
 
	g¡d
;

45 
	gdfsTe¡Th»adFunùiÚ
::
	$İ”©Ü
()() {

46 
veùÜ
<cÚ¡ *> 
¬gs
;

47 
št64_t
 
ÜigSize
, 
dfsSize
;

48 
CommªdCİyFromLoÿl
 
	`cmdCİyFromLoÿl
(
m_ş›Á
);

49 
CommªdCİyToLoÿl
 
	`cmdCİyToLoÿl
(
m_ş›Á
);

50 
CommªdRemove
 
	`cmdRemove
(
m_ş›Á
);

52 
cmdCİyFromLoÿl
.
	`push_¬g
(
m_šput_fe
, "");

53 
cmdCİyFromLoÿl
.
	`push_¬g
(
m_dfs_fe
, "");

54 ià(
cmdCİyFromLoÿl
.
	`run
() != 0)

55 
	`ex™
(1);

57 
cmdCİyToLoÿl
.
	`push_¬g
(
m_dfs_fe
, "");

58 
cmdCİyToLoÿl
.
	`push_¬g
(
m_ouut_fe
, "");

59 ià(
cmdCİyToLoÿl
.
	`run
() != 0)

60 
	`ex™
(1);

63 
¡©
 
¡©buf
;

64 ià(
	`¡©
(
m_šput_fe
.
	`c_¡r
(), &
¡©buf
) != 0) {

65 
û¼
 << "UÇbËØ¡© f'" << 
m_šput_fe
 << "' - " << 
	`¡»¼Ü
(
”ºo
è<< 
’dl
;

66 
	`ex™
(1);

68 
ÜigSize
 = 
¡©buf
.
¡_size
;

71 
m_ş›Á
->
	`Ëngth
(
m_dfs_fe
, &
dfsSize
);

73 ià(
ÜigSize
 !ğ
dfsSize
) {

74 
	`HT_ERRORF
("L’gth mism©ch: %ld !ğ%ld", 
ÜigSize
, 
dfsSize
);

75 
	`ex™
(1);

83 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/dfsclient/dfsTestThreadFunction.h

21 
	~<¡ršg
>

26 
Çme¥aû
 
	gHy³¹abË
 {

27 
Çme¥aû
 
	gDfsBrok”
 {

28 
şass
 
	gCl›Á
;

32 şas 
	cdfsTe¡Th»adFunùiÚ
 {

33 
	mpublic
:

34 
dfsTe¡Th»adFunùiÚ
(
DfsBrok”
::
Cl›Á
 *
ş›Á
, 
¡d
::
¡ršg
 
šput
è: 
	$m_ş›Á
(
ş›Á
) {

35 
m_šput_fe
 = 
šput
;

37 
	`£t_dfs_fe
(
¡d
::
¡ršg
 
dfsFe
) {

38 
m_dfs_fe
 = 
dfsFe
;

39 
	}
}

40 
£t_ouut_fe
(
¡d
::
¡ršg
 
ouut
) {

41 
m_ouut_fe
 = 
ouut
;

43 
İ”©Ü
()();

45 
	g´iv©e
:

46 
DfsBrok”
::
Cl›Á
 *
m_ş›Á
;

47 
	g¡d
::
¡ršg
 
m_šput_fe
;

48 
	g¡d
::
¡ršg
 
m_ouut_fe
;

49 
	g¡d
::
¡ršg
 
m_dfs_fe
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/dfsclient/dfsclient.cc

21 
	~<c¡ršg
>

22 
	~<io¡»am
>

23 
	~<veùÜ
>

26 
	~<»adlše/»adlše.h
>

27 
	~<»adlše/hi¡Üy.h
>

30 
	~<boo¡/®gÜ™hm/¡ršg.hµ
>

31 
	~<boo¡/th»ad/cÚd™iÚ.hµ
>

32 
	~<boo¡/th»ad/mu‹x.hµ
>

34 
	~"CommÚ/E¼Ü.h
"

35 
	~"CommÚ/IÁ”aùiveCommªd.h
"

36 
	~"CommÚ/Prİ”t›s.h
"

37 
	~"CommÚ/Sy¡em.h
"

38 
	~"CommÚ/U§ge.h
"

39 
	~"AsyncComm/Comm.h
"

41 
	~"CommªdCİyFromLoÿl.h
"

42 
	~"CommªdCİyToLoÿl.h
"

43 
	~"CommªdL’gth.h
"

44 
	~"CommªdMkdœs.h
"

45 
	~"CommªdRemove.h
"

46 
	~"CommªdRmdœ.h
"

47 
	~"CommªdShutdown.h
"

49 
usšg
 
Çme¥aû
 
Hy³¹abË
;

50 
usšg
 
Çme¥aû
 
	g¡d
;

52 
	gÇme¥aû
 {

54 *
	glše_»ad
 = 0;

56 *
¾_g‘s
 () {

58 ià(
	glše_»ad
) {

59 
ä“
 (
lše_»ad
);

60 
	glše_»ad
 = (*)
NULL
;

64 
	glše_»ad
 = 
»adlše
 ("dfsclient> ");

67 ià(
	glše_»ad
 && *line_read)

68 
add_hi¡Üy
 (
lše_»ad
);

70  
	glše_»ad
;

73 cÚ¡ *
	gu§ge
[] = {

90 şas 
	cCÚÃùiÚHªdËr
 : 
public
 
Di¥©chHªdËr
 {

91 
public
:

93 
CÚÃùiÚHªdËr
(è: 
m_nÙif›d
(
çl£
), 
m_cÚÃùed
(false) { ; }

95 
vœtu®
 
hªdË
(
Ev’tPŒ
 &
ev’t_±r
) {

96 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

97 
	gm_nÙif›d
 = 
Œue
;

98 ià(
	gev’t_±r
->
	gty³
 =ğ
Ev’t
::
CONNECTION_ESTABLISHED
)

99 
m_cÚÃùed
 = 
Œue
;

100 ià(
	gev’t_±r
->
	gty³
 =ğ
Ev’t
::
ERROR
) {

101 
HT_ERRORF
("%s", 
ev’t_±r
->
toSŒšg
().
c_¡r
());

103 ià(
	gev’t_±r
->
	gty³
 =ğ
Ev’t
::
MESSAGE
) {

104 
HT_ERRORF
("%s", 
ev’t_±r
->
toSŒšg
().
c_¡r
());

106 
	gm_cÚd
.
nÙify_Úe
();

109 
boŞ
 
wa™_fÜ_nÙifiÿtiÚ
() {

110 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

111 ià(
	gm_nÙif›d
)

112  
	gm_cÚÃùed
;

113 
	gm_cÚd
.
wa™
(
lock
);

114  
	gm_cÚÃùed
;

117 
	g´iv©e
:

118 
boo¡
::
mu‹x
 
m_mu‹x
;

119 
	gboo¡
::
cÚd™iÚ
 
m_cÚd
;

120 
boŞ
 
	gm_nÙif›d
;

121 
boŞ
 
	gm_cÚÃùed
;

130 
	$maš
(
¬gc
, **
¬gv
) {

131 
”rÜ
;

132 cÚ¡ *
lše
;

133 *
ev®
 = 0;

134 
size_t
 
i
;

135 
¡ršg
 
cÚfig_fe
 = "";

136 
veùÜ
<
IÁ”aùiveCommªd
 *> 
commªds
;

137 
Comm
 *
comm
;

138 
DfsBrok”
::
Cl›Á
 *
ş›Á
;

139 
Prİ”t›sPŒ
 
´İs_±r
;

140 
CÚÃùiÚHªdËr
 *
cÚn_hªdËr
 = 
Ãw
 
	`CÚÃùiÚHªdËr
();

141 
Di¥©chHªdËrPŒ
 
hªdËr_±r
 = 
cÚn_hªdËr
;

143 
Sy¡em
::
	`š™Ÿlize
(
¬gv
[0]);

144 
R—ùÜFaùÜy
::
	`š™Ÿlize
((
ušt16_t
)
Sy¡em
::
	`g‘_´oûssÜ_couÁ
());

146 
i
=1; i<
¬gc
; i++) {

147 ià(!
	`¡ºcmp
(
¬gv
[
i
], "--config=", 9))

148 
cÚfig_fe
 = &
¬gv
[
i
][9];

149 ià(!
	`¡rcmp
(
¬gv
[
i
], "--eval")) {

150 
i
++;

151 ià(
i
 =ğ
¬gc
)

152 
U§ge
::
	`dump_ªd_ex™
(
u§ge
);

153 
ev®
 = 
¬gv
[
i
];

156 
U§ge
::
	`dump_ªd_ex™
(
u§ge
);

159 ià(
cÚfig_fe
 == "")

160 
cÚfig_fe
 = 
Sy¡em
::
š¡®lDœ
 + "/conf/hypertable.cfg";

162 
´İs_±r
 = 
Ãw
 
	`Prİ”t›s
Ğ
cÚfig_fe
 );

164 
comm
 = 
Ãw
 
	`Comm
();

167 cÚ¡ *
ho¡
;

168 
ušt16_t
 
pÜt
;

169 
sockaddr_š
 
addr
;

171 ià((
pÜt
 = (
ušt16_t
)
´İs_±r
->
	`g‘_št
("DfsBroker.Port", 0)) == 0) {

172 
	`HT_ERRORF
("DfsBrok”.PÜˆ´İ”ty‚Ù found iÀcÚfig f'%s'", 
cÚfig_fe
.
	`c_¡r
());

176 ià((
ho¡
 = 
´İs_±r
->
	`g‘
("DfsBroker.Host", (const *)0)) == 0) {

177 
	`HT_ERRORF
("DfsBrok”.Ho¡…rİ”ty‚Ù found iÀcÚfig f'%s'", 
cÚfig_fe
.
	`c_¡r
());

181 
IÃtAddr
::
	`š™Ÿlize
(&
addr
, 
ho¡
, 
pÜt
);

183 ià((
”rÜ
 = 
comm
->
	`cÚÃù
(
addr
, 
hªdËr_±r
)è!ğ
E¼Ü
::
OK
) {

184 
	`HT_ERRORF
("ProbËm cÚÃùšgØDfsBrok” - %s", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

188 ià(!
cÚn_hªdËr
->
	`wa™_fÜ_nÙifiÿtiÚ
()) {

189 
cout
 << "UÇbËØcÚÃùØDfsBrok”." << 
’dl
 << 
æush
;

192 
ş›Á
 = 
Ãw
 
DfsBrok”
::
	`Cl›Á
(
comm
, 
addr
, 15);

195 
commªds
.
	`push_back
Ğ
Ãw
 
	`CommªdCİyFromLoÿl
(
ş›Á
) );

196 
commªds
.
	`push_back
Ğ
Ãw
 
	`CommªdCİyToLoÿl
(
ş›Á
) );

197 
commªds
.
	`push_back
Ğ
Ãw
 
	`CommªdL’gth
(
ş›Á
) );

198 
commªds
.
	`push_back
Ğ
Ãw
 
	`CommªdMkdœs
(
ş›Á
) );

199 
commªds
.
	`push_back
Ğ
Ãw
 
	`CommªdRemove
(
ş›Á
) );

200 
commªds
.
	`push_back
Ğ
Ãw
 
	`CommªdRmdœ
(
ş›Á
) );

201 
commªds
.
	`push_back
Ğ
Ãw
 
	`CommªdShutdown
(
ş›Á
) );

206 ià(
ev®
 != 0) {

207 cÚ¡ *
¡r
;

208 
¡d
::
¡ršg
 
commªdSŒ
;

209 
¡r
 = 
	`¡¹ok
(
ev®
, ";");

210 
¡r
) {

211 
commªdSŒ
 = 
¡r
;

212 
boo¡
::
	`Œim
(
commªdSŒ
);

213 
i
=0; i<
commªds
.
	`size
(); i++) {

214 ià(
commªds
[
i
]->
	`m©ches
(
commªdSŒ
.
	`c_¡r
())) {

215 
commªds
[
i
]->
	`·r£_commªd_lše
(
commªdSŒ
.
	`c_¡r
());

216 ià(
commªds
[
i
]->
	`run
(è!ğ
E¼Ü
::
OK
)

221 ià(
i
 =ğ
commªds
.
	`size
()) {

222 
	`HT_ERRORF
("UÄecognized commªd : %s", 
commªdSŒ
.
	`c_¡r
());

225 
¡r
 = 
	`¡¹ok
(0, ";");

230 
cout
 << "W–comtØdsáoŞ,‡ commªd-lšš‹rçûØthDFS brok”." << 
’dl
;

231 
cout
 << "Ty³ 'h–p' fÜ‡ desütiÚ oàcommªds." << 
’dl
;

232 
cout
 << 
’dl
 << 
æush
;

234 
	`usšg_hi¡Üy
();

235 (
lše
 = 
	`¾_g‘s
()) != 0) {

237 ià(*
lše
 == 0)

240 
i
=0; i<
commªds
.
	`size
(); i++) {

241 ià(
commªds
[
i
]->
	`m©ches
(
lše
)) {

242 
commªds
[
i
]->
	`·r£_commªd_lše
(
lše
);

243 
commªds
[
i
]->
	`run
();

248 ià(
i
 =ğ
commªds
.
	`size
()) {

249 ià(!
	`¡rcmp
(
lše
, "quit") || !strcmp(line, "exit"))

250 
	`ex™
(0);

251 ià(!
	`¡rcmp
(
lše
, "help")) {

252 
cout
 << 
’dl
;

253 
i
=0; i<
commªds
.
	`size
(); i++) {

254 
U§ge
::
	`dump
(
commªds
[
i
]->
	`u§ge
());

255 
cout
 << 
’dl
;

259 
cout
 << "UÄecognized commªd." << 
’dl
;

265 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/dumplog/dumplog.cc

21 
	~<c¡dlib
>

22 
	~<io¡»am
>

25 
	~<Ãtdb.h
>

28 
	~"CommÚ/E¼Ü.h
"

29 
	~"CommÚ/IÃtAddr.h
"

30 
	~"CommÚ/Logg”.h
"

31 
	~"CommÚ/Prİ”t›s.h
"

32 
	~"CommÚ/Sy¡em.h
"

33 
	~"CommÚ/U§ge.h
"

35 
	~"AsyncComm/Comm.h
"

36 
	~"AsyncComm/CÚÃùiÚMªag”.h
"

37 
	~"AsyncComm/R—ùÜFaùÜy.h
"

39 
	~"DfsBrok”/Lib/Cl›Á.h
"

41 
	~"Hy³¹abË/Lib/Comm™LogR—d”.h
"

43 
usšg
 
Çme¥aû
 
Hy³¹abË
;

44 
usšg
 
Çme¥aû
 
	g¡d
;

46 
	gÇme¥aû
 {

48 cÚ¡ *
	gu§ge
[] = {

68 
	$maš
(
¬gc
, **
¬gv
) {

69 
¡ršg
 
cÚfigFe
 = "";

70 
¡ršg
 
log_dœ
;

71 
Prİ”t›sPŒ
 
´İs_±r
;

72 
boŞ
 
v”bo£
 = 
çl£
;

73 
CommPŒ
 
comm_±r
;

74 
CÚÃùiÚMªag”PŒ
 
cÚn_mªag”_±r
;

75 
DfsBrok”
::
Cl›Á
 *
dfs_ş›Á
;

76 
Comm™LogR—d”
 *
log_»ad”
;

78 
Sy¡em
::
	`š™Ÿlize
(
¬gv
[0]);

79 
R—ùÜFaùÜy
::
	`š™Ÿlize
((
ušt16_t
)
Sy¡em
::
	`g‘_´oûssÜ_couÁ
());

81 
i
=1; i<
¬gc
; i++) {

82 ià(!
	`¡ºcmp
(
¬gv
[
i
], "--config=", 9))

83 
cÚfigFe
 = &
¬gv
[
i
][9];

84 ià(!
	`¡rcmp
(
¬gv
[
i
], "--verbose") || !strcmp(argv[i], "-v"))

85 
v”bo£
 = 
Œue
;

86 ià(
log_dœ
 == "")

87 
log_dœ
 = 
¬gv
[
i
];

89 
U§ge
::
	`dump_ªd_ex™
(
u§ge
);

92 ià(
log_dœ
 == "")

93 
U§ge
::
	`dump_ªd_ex™
(
u§ge
);

95 ià(
cÚfigFe
 == "")

96 
cÚfigFe
 = 
Sy¡em
::
š¡®lDœ
 + "/conf/hypertable.cfg";

98 
´İs_±r
 = 
Ãw
 
	`Prİ”t›s
(
cÚfigFe
);

100 
comm_±r
 = 
Ãw
 
	`Comm
();

101 
cÚn_mªag”_±r
 = 
Ãw
 
	`CÚÃùiÚMªag”
(
comm_±r
.
	`g‘
());

107 cÚ¡ *
logHo¡
 = 
´İs_±r
->
	`g‘
("Hypertable.RangeServer.CommitLog.DfsBroker.Host", 0);

108 
ušt16_t
 
logPÜt
 = 
´İs_±r
->
	`g‘_št
("Hypertable.RangeServer.CommitLog.DfsBroker.Port", 0);

109 
sockaddr_š
 
addr
;

110 ià(
logHo¡
 != 0) {

111 
IÃtAddr
::
	`š™Ÿlize
(&
addr
, 
logHo¡
, 
logPÜt
);

112 
dfs_ş›Á
 = 
Ãw
 
DfsBrok”
::
	`Cl›Á
(
cÚn_mªag”_±r
, 
addr
, 600);

115 
dfs_ş›Á
 = 
Ãw
 
DfsBrok”
::
	`Cl›Á
(
cÚn_mªag”_±r
, 
´İs_±r
);

118 ià(!
dfs_ş›Á
->
	`wa™_fÜ_cÚÃùiÚ
(30)) {

119 
	`HT_ERROR
("Unableo connecto DFS Broker,ƒxiting...");

120 
	`ex™
(1);

124 
log_»ad”
 = 
Ãw
 
	`Comm™LogR—d”
(
dfs_ş›Á
, 
log_dœ
);

126 
log_»ad”
->
	`dump_log_m‘ad©a
();

128 
d–‘e
 
log_»ad”
;

131 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/CommandAttrDel.cc

21 
	~<io¡»am
>

23 
	~"CommÚ/E¼Ü.h
"

24 
	~"CommÚ/U§ge.h
"

26 
	~"CommªdA‰rD–.h
"

27 
	~"Glob®.h
"

28 
	~"Ut.h
"

30 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

31 
usšg
 
Çme¥aû
 
	gHy³r¥aû
;

32 
usšg
 
Çme¥aû
 
	g¡d
;

34 cÚ¡ *
	gCommªdA‰rD–
::
ms_u§ge
[] = {

40 
	gCommªdA‰rD–
::
	$run
() {

41 
ušt64_t
 
hªdË
;

43 ià(
m_¬gs
.
	`size
() != 2) {

44 
û¼
 << "WrÚg‚umb” oà¬gum’ts. Ty³ 'h–p' fÜ u§ge." << 
’dl
;

48 ià(
m_¬gs
[0].
£cÚd
 != "" || m_args[1].second != "") {

49 
û¼
 << "Inv®id ch¬aù” '=' iÀ¬gum’t." << 
’dl
;

53 ià(!
Ut
::
	`g‘_hªdË
(
m_¬gs
[0].
fœ¡
, &
hªdË
))

56  
m_£ssiÚ
->
	`©Œ_d–
(
hªdË
, 
m_¬gs
[1].
fœ¡
);

57 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/CommandAttrDel.h

21 #iâdeà
HYPERTABLE_COMMANDATTRDEL_H


22 
	#HYPERTABLE_COMMANDATTRDEL_H


	)

24 
	~"CommÚ/IÁ”aùiveCommªd.h
"

26 
	~"Hy³r¥aû/SessiÚ.h
"

28 
	~"Glob®.h
"

30 
Çme¥aû
 
	gHy³r¥aû
 {

32 şas 
	cCommªdA‰rD–
 : 
public
 
IÁ”aùiveCommªd
 {

33 
public
:

34 
CommªdA‰rD–
(
SessiÚ
 *
£ssiÚ
è: 
m_£ssiÚ
(session) { ; }

35 
vœtu®
 cÚ¡ *
commªd_‹xt
() {  "attrdel"; }

36 
vœtu®
 cÚ¡ **
u§ge
(è{  
	gms_u§ge
; }

37 
vœtu®
 
run
();

39 
	g´iv©e
:

40 cÚ¡ *
ms_u§ge
[];

41 
SessiÚ
 *
	gm_£ssiÚ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/CommandAttrGet.cc

21 
	~<io¡»am
>

23 
	~"CommÚ/DyÇmicBufãr.h
"

24 
	~"CommÚ/E¼Ü.h
"

25 
	~"CommÚ/U§ge.h
"

27 
	~"CommªdA‰rG‘.h
"

28 
	~"Glob®.h
"

29 
	~"Ut.h
"

31 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

32 
usšg
 
Çme¥aû
 
	gHy³r¥aû
;

33 
usšg
 
Çme¥aû
 
	g¡d
;

35 cÚ¡ *
	gCommªdA‰rG‘
::
ms_u§ge
[] = {

42 
	gCommªdA‰rG‘
::
	$run
() {

43 
ušt64_t
 
hªdË
;

44 
”rÜ
;

45 
DyÇmicBufãr
 
	`v®ue
(0);

47 ià(
m_¬gs
.
	`size
() < 2 || m_args.size() > 3) {

48 
û¼
 << "WrÚg‚umb” oà¬gum’ts. Ty³ 'h–p' fÜ u§ge." << 
’dl
;

52 ià(
m_¬gs
[0].
£cÚd
 != "" || m_args[1].second != "") {

53 
û¼
 << "Inv®id ch¬aù” '=' iÀ¬gum’t." << 
’dl
;

57 ià(!
Ut
::
	`g‘_hªdË
(
m_¬gs
[0].
fœ¡
, &
hªdË
))

60 ià((
”rÜ
 = 
m_£ssiÚ
->
	`©Œ_g‘
(
hªdË
, 
m_¬gs
[1].
fœ¡
, 
v®ue
)è=ğ
E¼Ü
::
OK
) {

61 ià(
m_¬gs
.
	`size
() == 3) {

62 ià(
m_¬gs
[2].
fœ¡
 == "short") {

63 ià(
v®ue
.
	`fl
() != 2) {

64 
û¼
 << "Ex³ùed 2 by‹ shÜt, buˆgÙ " << 
v®ue
.
	`fl
(è<< " by‹s" << 
’dl
;

65  
E¼Ü
::
HYPERSPACE_BAD_ATTRIBUTE
;

67 
sv®
;

68 
	`memıy
(&
sv®
, 
v®ue
.
buf
, 2);

69 
cout
 << 
sv®
 << 
’dl
;

71 ià(
m_¬gs
[2].
fœ¡
 == "int") {

72 ià(
v®ue
.
	`fl
() != 4) {

73 
û¼
 << "Ex³ùed 4 by‹ iÁ, buˆgÙ " << 
v®ue
.
	`fl
(è<< " by‹s" << 
’dl
;

74  
E¼Ü
::
HYPERSPACE_BAD_ATTRIBUTE
;

76 
ušt32_t
 
iv®
;

77 
	`memıy
(&
iv®
, 
v®ue
.
buf
, 4);

78 
cout
 << 
iv®
 << 
’dl
;

80 ià(
m_¬gs
[2].
fœ¡
 == "long") {

81 ià(
v®ue
.
	`fl
() != 8) {

82 
û¼
 << "Ex³ùed 8 by‹ iÁ, buˆgÙ " << 
v®ue
.
	`fl
(è<< " by‹s" << 
’dl
;

83  
E¼Ü
::
HYPERSPACE_BAD_ATTRIBUTE
;

85 
ušt64_t
 
lv®
;

86 
	`memıy
(&
lv®
, 
v®ue
.
buf
, 8);

87 
cout
 << 
lv®
 << 
’dl
;

91 
¡d
::
¡ršg
 
v®SŒ
 = std::
	`¡ršg
((cÚ¡ *)
v®ue
.
buf
, v®ue.
	`fl
());

92 
cout
 << 
v®SŒ
 << 
’dl
;

96  
”rÜ
;

97 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/CommandAttrGet.h

21 #iâdeà
HYPERTABLE_COMMANDATTRGET_H


22 
	#HYPERTABLE_COMMANDATTRGET_H


	)

24 
	~"CommÚ/IÁ”aùiveCommªd.h
"

26 
	~"Hy³r¥aû/SessiÚ.h
"

28 
	~"Glob®.h
"

30 
Çme¥aû
 
	gHy³r¥aû
 {

32 şas 
	cCommªdA‰rG‘
 : 
public
 
IÁ”aùiveCommªd
 {

33 
public
:

34 
CommªdA‰rG‘
(
SessiÚ
 *
£ssiÚ
è: 
m_£ssiÚ
(session) { ; }

35 
vœtu®
 cÚ¡ *
commªd_‹xt
() {  "attrget"; }

36 
vœtu®
 cÚ¡ **
u§ge
(è{  
	gms_u§ge
; }

37 
vœtu®
 
run
();

39 
	g´iv©e
:

40 cÚ¡ *
ms_u§ge
[];

41 
SessiÚ
 *
	gm_£ssiÚ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/CommandAttrSet.cc

21 
	~<io¡»am
>

23 
	~"CommÚ/E¼Ü.h
"

24 
	~"CommÚ/U§ge.h
"

26 
	~"CommªdA‰rS‘.h
"

27 
	~"Glob®.h
"

28 
	~"Ut.h
"

30 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

31 
usšg
 
Çme¥aû
 
	gHy³r¥aû
;

32 
usšg
 
Çme¥aû
 
	g¡d
;

34 cÚ¡ *
	gCommªdA‰rS‘
::
ms_u§ge
[] = {

40 
	gCommªdA‰rS‘
::
	$run
() {

41 
ušt64_t
 
hªdË
;

42 cÚ¡ *
v®ue
;

44 ià(
m_¬gs
.
	`size
() != 2) {

45 
û¼
 << "WrÚg‚umb” oà¬gum’ts. Ty³ 'h–p' fÜ u§ge." << 
’dl
;

49 ià(
m_¬gs
[0].
£cÚd
 != "") {

50 
û¼
 << "Inv®id‡rgum’ˆ- " << 
m_¬gs
[0].
£cÚd
 << 
’dl
;

54 ià(!
Ut
::
	`g‘_hªdË
(
m_¬gs
[0].
fœ¡
, &
hªdË
))

57 
v®ue
 = 
m_¬gs
[1].
£cÚd
.
	`c_¡r
();

59  
m_£ssiÚ
->
	`©Œ_£t
(
hªdË
, 
m_¬gs
[1].
fœ¡
, 
v®ue
, 
	`¡¾’
(value));

60 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/CommandAttrSet.h

21 #iâdeà
HYPERTABLE_COMMANDATTRSET_H


22 
	#HYPERTABLE_COMMANDATTRSET_H


	)

24 
	~"CommÚ/IÁ”aùiveCommªd.h
"

26 
	~"Hy³r¥aû/SessiÚ.h
"

28 
	~"Glob®.h
"

30 
Çme¥aû
 
	gHy³r¥aû
 {

32 şas 
	cCommªdA‰rS‘
 : 
public
 
IÁ”aùiveCommªd
 {

33 
public
:

34 
CommªdA‰rS‘
(
SessiÚ
 *
£ssiÚ
è: 
m_£ssiÚ
(session) { ; }

35 
vœtu®
 cÚ¡ *
commªd_‹xt
() {  "attrset"; }

36 
vœtu®
 cÚ¡ **
u§ge
(è{  
	gms_u§ge
; }

37 
vœtu®
 
run
();

39 
	g´iv©e
:

40 cÚ¡ *
ms_u§ge
[];

41 
SessiÚ
 *
	gm_£ssiÚ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/CommandClose.cc

21 
	~<io¡»am
>

23 
	~"CommÚ/E¼Ü.h
"

24 
	~"CommÚ/U§ge.h
"

26 
	~"CommªdClo£.h
"

27 
	~"Glob®.h
"

28 
	~"Ut.h
"

30 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

31 
usšg
 
Çme¥aû
 
	gHy³r¥aû
;

32 
usšg
 
Çme¥aû
 
	g¡d
;

34 cÚ¡ *
	gCommªdClo£
::
ms_u§ge
[] = {

40 
	gCommªdClo£
::
	$run
() {

41 
ušt64_t
 
hªdË
;

42 
”rÜ
;

44 ià(
m_¬gs
.
	`size
() != 1) {

45 
û¼
 << "WrÚg‚umb” oà¬gum’ts. Ty³ 'h–p' fÜ u§ge." << 
’dl
;

49 ià(
m_¬gs
[0].
£cÚd
 != "") {

50 
û¼
 << "Inv®id ch¬aù” '=' iÀ¬gum’t." << 
’dl
;

54 ià(!
Ut
::
	`g‘_hªdË
(
m_¬gs
[0].
fœ¡
, &
hªdË
))

57 ià((
”rÜ
 = 
m_£ssiÚ
->
	`şo£
(
hªdË
)è!ğ
E¼Ü
::
OK
) {

58 
	`HT_ERRORF
("E¼Üƒxecutšg CLOSE„eque¡ - %s", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

61  
”rÜ
;

62 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/CommandClose.h

21 #iâdeà
HYPERTABLE_COMMANDCLOSE_H


22 
	#HYPERTABLE_COMMANDCLOSE_H


	)

24 
	~"CommÚ/IÁ”aùiveCommªd.h
"

26 
	~"Hy³r¥aû/SessiÚ.h
"

28 
	~"Glob®.h
"

30 
Çme¥aû
 
	gHy³r¥aû
 {

32 şas 
	cCommªdClo£
 : 
public
 
IÁ”aùiveCommªd
 {

33 
public
:

34 
CommªdClo£
(
SessiÚ
 *
£ssiÚ
è: 
m_£ssiÚ
(session) { ; }

35 
vœtu®
 cÚ¡ *
commªd_‹xt
() {  "close"; }

36 
vœtu®
 cÚ¡ **
u§ge
(è{  
	gms_u§ge
; }

37 
vœtu®
 
run
();

39 
	g´iv©e
:

40 cÚ¡ *
ms_u§ge
[];

41 
SessiÚ
 *
	gm_£ssiÚ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/CommandCreate.cc

21 
	~<c¡ršg
>

22 
	~<io¡»am
>

24 
	~"CommÚ/E¼Ü.h
"

25 
	~"CommÚ/U§ge.h
"

27 
	~"CommªdC»©e.h
"

28 
	~"FeHªdËC®lback.h
"

29 
	~"Glob®.h
"

30 
	~"Ut.h
"

32 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

33 
usšg
 
Çme¥aû
 
	gHy³r¥aû
;

34 
usšg
 
Çme¥aû
 
	g¡d
;

36 cÚ¡ *
	gCommªdC»©e
::
ms_u§ge
[] = {

48 
	gCommªdC»©e
::
	$run
() {

49 
¡d
::
¡ršg
 
âame
 = "";

50 
æags
 = 0;

51 
ev’tMask
 = 0;

52 *
¡r
, *
Ï¡
;

53 
ušt64_t
 
hªdË
;

54 
”rÜ
;

55 
¡d
::
veùÜ
<
A‰ribu‹T
> 
š™A‰rs
;

56 
A‰ribu‹T
 
©Œ
;

58 
size_t
 
i
=0; i<
m_¬gs
.
	`size
(); i++) {

59 ià(
m_¬gs
[
i
].
fœ¡
 == "flags") {

60 
¡r
 = 
	`¡¹ok_r
((*)
m_¬gs
[
i
].
£cÚd
.
	`c_¡r
(), " \t|", &
Ï¡
);

61 
¡r
) {

62 ià(!
	`¡rcmp
(
¡r
, "READ"))

63 
æags
 |ğ
OPEN_FLAG_READ
;

64 ià(!
	`¡rcmp
(
¡r
, "WRITE"))

65 
æags
 |ğ
OPEN_FLAG_WRITE
;

66 ià(!
	`¡rcmp
(
¡r
, "LOCK"))

67 
æags
 |ğ
OPEN_FLAG_LOCK
;

68 ià(!
	`¡rcmp
(
¡r
, "TEMP"))

69 
æags
 |ğ
OPEN_FLAG_TEMP
;

70 ià(!
	`¡rcmp
(
¡r
, "LOCK_SHARED"))

71 
æags
 |ğ
OPEN_FLAG_LOCK_SHARED
;

72 ià(!
	`¡rcmp
(
¡r
, "LOCK_EXCLUSIVE"))

73 
æags
 |ğ
OPEN_FLAG_LOCK_EXCLUSIVE
;

74 
¡r
 = 
	`¡¹ok_r
(0, " \t|", &
Ï¡
);

77 ià(
m_¬gs
[
i
].
fœ¡
 == "event-mask") {

78 
¡r
 = 
	`¡¹ok_r
((*)
m_¬gs
[
i
].
£cÚd
.
	`c_¡r
(), " \t|", &
Ï¡
);

79 
¡r
) {

80 ià(!
	`¡rcmp
(
¡r
, "ATTR_SET"))

81 
ev’tMask
 |ğ
EVENT_MASK_ATTR_SET
;

82 ià(!
	`¡rcmp
(
¡r
, "ATTR_DEL"))

83 
ev’tMask
 |ğ
EVENT_MASK_ATTR_DEL
;

84 ià(!
	`¡rcmp
(
¡r
, "LOCK_ACQUIRED"))

85 
ev’tMask
 |ğ
EVENT_MASK_LOCK_ACQUIRED
;

86 ià(!
	`¡rcmp
(
¡r
, "LOCK_RELEASED"))

87 
ev’tMask
 |ğ
EVENT_MASK_LOCK_RELEASED
;

88 
¡r
 = 
	`¡¹ok_r
(0, " \t|", &
Ï¡
);

91 ià(
m_¬gs
[
i
].
fœ¡
.
	`fšd
("attr:", 0) == 0) {

92 
©Œ
.
Çme
 = 
m_¬gs
[
i
].
fœ¡
.
	`c_¡r
() + 5;

93 
©Œ
.
v®ue
 = 
m_¬gs
[
i
].
£cÚd
.
	`c_¡r
();

94 
©Œ
.
v®ueL’
 = 
	`¡¾’
((cÚ¡ *ï‰r.
v®ue
);

95 
š™A‰rs
.
	`push_back
(
©Œ
);

97 ià(
âame
 !ğ"" || 
m_¬gs
[
i
].
£cÚd
 != "") {

98 
û¼
 << "Inv®id‡rgum’ts. Ty³ 'h–p' fÜ u§ge." << 
’dl
;

102 
âame
 = 
m_¬gs
[
i
].
fœ¡
;

105 ià(
æags
 == 0) {

106 
û¼
 << "E¼Ü:‚Øæag suµl›d." << 
’dl
;

109 ià(
âame
 == "") {

110 
û¼
 << "E¼Ü:‚Øf’amsuµl›d." << 
’dl
;

116 
HªdËC®lbackPŒ
 
ÿÎbackPŒ
 = 
Ãw
 
	`FeHªdËC®lback
(
ev’tMask
);

118 ià((
”rÜ
 = 
m_£ssiÚ
->
	`ü—‹
(
âame
, 
æags
, 
ÿÎbackPŒ
, 
š™A‰rs
, &
hªdË
)è=ğ
E¼Ü
::
OK
) {

119 
¡d
::
¡ršg
 
nÜm®Name
;

120 
Ut
::
	`nÜm®ize_·thÇme
(
âame
, 
nÜm®Name
);

121 
Glob®
::
feM­
[
nÜm®Name
] = 
hªdË
;

123  
”rÜ
;

124 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/CommandCreate.h

21 #iâdeà
HYPERTABLE_COMMANDCREATE_H


22 
	#HYPERTABLE_COMMANDCREATE_H


	)

24 
	~"CommÚ/IÁ”aùiveCommªd.h
"

26 
	~"Hy³r¥aû/SessiÚ.h
"

28 
	~"Glob®.h
"

30 
Çme¥aû
 
	gHy³r¥aû
 {

32 şas 
	cCommªdC»©e
 : 
public
 
IÁ”aùiveCommªd
 {

33 
public
:

34 
CommªdC»©e
(
SessiÚ
 *
£ssiÚ
è: 
m_£ssiÚ
(session) { ; }

35 
vœtu®
 cÚ¡ *
commªd_‹xt
() {  "create"; }

36 
vœtu®
 cÚ¡ **
u§ge
(è{  
	gms_u§ge
; }

37 
vœtu®
 
run
();

39 
	g´iv©e
:

40 cÚ¡ *
ms_u§ge
[];

41 
SessiÚ
 *
	gm_£ssiÚ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/CommandDelete.cc

21 
	~<io¡»am
>

23 
	~"CommÚ/E¼Ü.h
"

24 
	~"CommÚ/U§ge.h
"

26 
	~"CommªdD–‘e.h
"

27 
	~"Glob®.h
"

29 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

30 
usšg
 
Çme¥aû
 
	gHy³r¥aû
;

31 
usšg
 
Çme¥aû
 
	g¡d
;

33 cÚ¡ *
	gCommªdD–‘e
::
ms_u§ge
[] = {

39 
	gCommªdD–‘e
::
	$run
() {

41 ià(
m_¬gs
.
	`size
() != 1) {

42 
û¼
 << "WrÚg‚umb” oà¬gum’ts. Ty³ 'h–p' fÜ u§ge." << 
’dl
;

46 ià(
m_¬gs
[0].
£cÚd
 != "") {

47 
û¼
 << "Inv®id‡rgum’ˆ- " << 
m_¬gs
[0].
£cÚd
 << 
’dl
;

51  
m_£ssiÚ
->
	`uÆšk
(
m_¬gs
[0].
fœ¡
);

52 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/CommandDelete.h

21 #iâdeà
HYPERTABLE_COMMANDDELETE_H


22 
	#HYPERTABLE_COMMANDDELETE_H


	)

24 
	~"CommÚ/IÁ”aùiveCommªd.h
"

26 
	~"Hy³r¥aû/SessiÚ.h
"

28 
	~"Glob®.h
"

30 
Çme¥aû
 
	gHy³r¥aû
 {

32 şas 
	cCommªdD–‘e
 : 
public
 
IÁ”aùiveCommªd
 {

33 
public
:

34 
CommªdD–‘e
(
SessiÚ
 *
£ssiÚ
è: 
m_£ssiÚ
(session) { ; }

35 
vœtu®
 cÚ¡ *
commªd_‹xt
() {  "delete"; }

36 
vœtu®
 cÚ¡ **
u§ge
(è{  
	gms_u§ge
; }

37 
vœtu®
 
run
();

39 
	g´iv©e
:

40 cÚ¡ *
ms_u§ge
[];

41 
SessiÚ
 *
	gm_£ssiÚ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/CommandExists.cc

21 
	~<io¡»am
>

23 
	~"CommÚ/E¼Ü.h
"

24 
	~"CommÚ/U§ge.h
"

26 
	~"CommªdExi¡s.h
"

27 
	~"Glob®.h
"

29 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

30 
usšg
 
Çme¥aû
 
	gHy³r¥aû
;

31 
usšg
 
Çme¥aû
 
	g¡d
;

33 cÚ¡ *
	gCommªdExi¡s
::
ms_u§ge
[] = {

39 
	gCommªdExi¡s
::
	$run
() {

40 
”rÜ
;

41 
boŞ
 
exi¡s
;

43 ià(
m_¬gs
.
	`size
() != 1) {

44 
û¼
 << "WrÚg‚umb” oà¬gum’ts. Ty³ 'h–p' fÜ u§ge." << 
’dl
;

48 ià(
m_¬gs
[0].
£cÚd
 != "") {

49 
û¼
 << "Inv®id‡rgum’ˆ- " << 
m_¬gs
[0].
£cÚd
 << 
’dl
;

53 ià((
”rÜ
 = 
m_£ssiÚ
->
	`exi¡s
(
m_¬gs
[0].
fœ¡
, &
exi¡s
)è=ğ
E¼Ü
::
OK
) {

54 ià(
exi¡s
)

55 
cout
 << "Œue" << 
’dl
;

57 
cout
 << "çl£" << 
’dl
;

58 
Glob®
::
ex™Stus
 = 1;

62  
”rÜ
;

63 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/CommandExists.h

21 #iâdeà
HYPERTABLE_COMMANDEXISTS_H


22 
	#HYPERTABLE_COMMANDEXISTS_H


	)

24 
	~"CommÚ/IÁ”aùiveCommªd.h
"

26 
	~"Hy³r¥aû/SessiÚ.h
"

28 
	~"Glob®.h
"

30 
Çme¥aû
 
	gHy³r¥aû
 {

32 şas 
	cCommªdExi¡s
 : 
public
 
IÁ”aùiveCommªd
 {

33 
public
:

34 
CommªdExi¡s
(
SessiÚ
 *
£ssiÚ
è: 
m_£ssiÚ
(session) { ; }

35 
vœtu®
 cÚ¡ *
commªd_‹xt
() {  "exists"; }

36 
vœtu®
 cÚ¡ **
u§ge
(è{  
	gms_u§ge
; }

37 
vœtu®
 
run
();

39 
	g´iv©e
:

40 cÚ¡ *
ms_u§ge
[];

41 
SessiÚ
 *
	gm_£ssiÚ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/CommandGetSequencer.cc

21 
	~<io¡»am
>

23 
	~"CommÚ/E¼Ü.h
"

24 
	~"CommÚ/U§ge.h
"

26 
	~"CommªdG‘Sequ’ûr.h
"

27 
	~"Glob®.h
"

28 
	~"Ut.h
"

30 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

31 
usšg
 
Çme¥aû
 
	gHy³r¥aû
;

32 
usšg
 
Çme¥aû
 
	g¡d
;

34 cÚ¡ *
	gCommªdG‘Sequ’ûr
::
ms_u§ge
[] = {

40 
	gCommªdG‘Sequ’ûr
::
	$run
() {

41 
ušt64_t
 
hªdË
;

42 
”rÜ
;

43 
LockSequ’ûrT
 
lock£q
;

45 ià(
m_¬gs
.
	`size
() != 1) {

46 
û¼
 << "WrÚg‚umb” oà¬gum’ts. Ty³ 'h–p' fÜ u§ge." << 
’dl
;

50 ià(
m_¬gs
[0].
£cÚd
 != "") {

51 
û¼
 << "Inv®id ch¬aù” '=' iÀ¬gum’t." << 
’dl
;

55 ià(!
Ut
::
	`g‘_hªdË
(
m_¬gs
[0].
fœ¡
, &
hªdË
))

58 ià((
”rÜ
 = 
m_£ssiÚ
->
	`g‘_£qu’ûr
(
hªdË
, &
lock£q
)è=ğ
E¼Ü
::
OK
)

59 
cout
 << "SEQUENCER‚ame=" << 
lock£q
.
Çme
 << " mode=" <<†ock£q.
mode
 << " g’”©iÚ=" <<†ock£q.
g’”©iÚ
 << 
’dl
 << 
æush
;

61  
”rÜ
;

62 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/CommandGetSequencer.h

21 #iâdeà
HYPERTABLE_COMMANDGETSEQUENCER_H


22 
	#HYPERTABLE_COMMANDGETSEQUENCER_H


	)

24 
	~"CommÚ/IÁ”aùiveCommªd.h
"

26 
	~"Hy³r¥aû/SessiÚ.h
"

28 
	~"Glob®.h
"

30 
Çme¥aû
 
	gHy³r¥aû
 {

32 şas 
	cCommªdG‘Sequ’ûr
 : 
public
 
IÁ”aùiveCommªd
 {

33 
public
:

34 
CommªdG‘Sequ’ûr
(
SessiÚ
 *
£ssiÚ
è: 
m_£ssiÚ
(session) { ; }

35 
vœtu®
 cÚ¡ *
commªd_‹xt
() {  "getseq"; }

36 
vœtu®
 cÚ¡ **
u§ge
(è{  
	gms_u§ge
; }

37 
vœtu®
 
run
();

39 
	g´iv©e
:

40 cÚ¡ *
ms_u§ge
[];

41 
SessiÚ
 *
	gm_£ssiÚ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/CommandLock.cc

21 
	~<io¡»am
>

23 
	~"CommÚ/E¼Ü.h
"

24 
	~"CommÚ/U§ge.h
"

26 
	~"CommªdLock.h
"

27 
	~"Glob®.h
"

28 
	~"Ut.h
"

30 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

31 
usšg
 
Çme¥aû
 
	gHy³r¥aû
;

32 
usšg
 
Çme¥aû
 
	g¡d
;

34 cÚ¡ *
	gCommªdLock
::
ms_u§ge
[] = {

41 
	gCommªdLock
::
	$run
() {

42 
ušt64_t
 
hªdË
;

43 
”rÜ
;

44 
ušt32_t
 
mode
 = 0;

45 
LockSequ’ûrT
 
lock£q
;

47 ià(
m_¬gs
.
	`size
() != 2) {

48 
û¼
 << "WrÚg‚umb” oà¬gum’ts. Ty³ 'h–p' fÜ u§ge." << 
’dl
;

52 ià(
m_¬gs
[0].
£cÚd
 != "" || m_args[1].second != "") {

53 
û¼
 << "Inv®id ch¬aù” '=' iÀ¬gum’t." << 
’dl
;

57 ià(
m_¬gs
[1].
fœ¡
 == "SHARED")

58 
mode
 = 
LOCK_MODE_SHARED
;

59 ià(
m_¬gs
[1].
fœ¡
 == "EXCLUSIVE")

60 
mode
 = 
LOCK_MODE_EXCLUSIVE
;

62 
û¼
 << "Inv®id modv®u(" << 
m_¬gs
[1].
£cÚd
 << ")" << 
’dl
;

66 ià(!
Ut
::
	`g‘_hªdË
(
m_¬gs
[0].
fœ¡
, &
hªdË
))

69 ià((
”rÜ
 = 
m_£ssiÚ
->
	`lock
(
hªdË
, 
mode
, &
lock£q
)è=ğ
E¼Ü
::
OK
)

70 
cout
 << "SEQUENCER‚ame=" << 
lock£q
.
Çme
 << " mode=" <<†ock£q.
mode
 << " g’”©iÚ=" <<†ock£q.
g’”©iÚ
 << 
’dl
 << 
æush
;

72  
”rÜ
;

73 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/CommandLock.h

21 #iâdeà
HYPERTABLE_COMMANDLOCK_H


22 
	#HYPERTABLE_COMMANDLOCK_H


	)

24 
	~"CommÚ/IÁ”aùiveCommªd.h
"

26 
	~"Hy³r¥aû/SessiÚ.h
"

28 
	~"Glob®.h
"

30 
Çme¥aû
 
	gHy³r¥aû
 {

32 şas 
	cCommªdLock
 : 
public
 
IÁ”aùiveCommªd
 {

33 
public
:

34 
CommªdLock
(
SessiÚ
 *
£ssiÚ
è: 
m_£ssiÚ
(session) { ; }

35 
vœtu®
 cÚ¡ *
commªd_‹xt
() {  "lock"; }

36 
vœtu®
 cÚ¡ **
u§ge
(è{  
	gms_u§ge
; }

37 
vœtu®
 
run
();

39 
	g´iv©e
:

40 cÚ¡ *
ms_u§ge
[];

41 
SessiÚ
 *
	gm_£ssiÚ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/CommandMkdir.cc

21 
	~<io¡»am
>

23 
	~"CommÚ/E¼Ü.h
"

24 
	~"CommÚ/U§ge.h
"

26 
	~"CommªdMkdœ.h
"

27 
	~"Glob®.h
"

29 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

30 
usšg
 
Çme¥aû
 
	gHy³r¥aû
;

31 
usšg
 
Çme¥aû
 
	g¡d
;

33 cÚ¡ *
	gCommªdMkdœ
::
ms_u§ge
[] = {

39 
	gCommªdMkdœ
::
	$run
() {

41 ià(
m_¬gs
.
	`size
() != 1) {

42 
û¼
 << "WrÚg‚umb” oà¬gum’ts. Ty³ 'h–p' fÜ u§ge." << 
’dl
;

46 ià(
m_¬gs
[0].
£cÚd
 != "") {

47 
û¼
 << "Inv®id‡rgum’ˆ- " << 
m_¬gs
[0].
£cÚd
 << 
’dl
;

51  
m_£ssiÚ
->
	`mkdœ
(
m_¬gs
[0].
fœ¡
);

52 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/CommandMkdir.h

21 #iâdeà
HYPERTABLE_COMMANDMKDIR_H


22 
	#HYPERTABLE_COMMANDMKDIR_H


	)

24 
	~"CommÚ/IÁ”aùiveCommªd.h
"

26 
	~"Hy³r¥aû/SessiÚ.h
"

28 
	~"Glob®.h
"

30 
Çme¥aû
 
	gHy³r¥aû
 {

32 şas 
	cCommªdMkdœ
 : 
public
 
IÁ”aùiveCommªd
 {

33 
public
:

34 
CommªdMkdœ
(
SessiÚ
 *
£ssiÚ
è: 
m_£ssiÚ
(session) { ; }

35 
vœtu®
 cÚ¡ *
commªd_‹xt
() {  "mkdir"; }

36 
vœtu®
 cÚ¡ **
u§ge
(è{  
	gms_u§ge
; }

37 
vœtu®
 
run
();

39 
	g´iv©e
:

40 cÚ¡ *
ms_u§ge
[];

41 
SessiÚ
 *
	gm_£ssiÚ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/CommandOpen.cc

21 
	~<c¡ršg
>

22 
	~<io¡»am
>

24 
	~"CommÚ/E¼Ü.h
"

25 
	~"CommÚ/U§ge.h
"

27 
	~"CommªdO³n.h
"

28 
	~"FeHªdËC®lback.h
"

29 
	~"Glob®.h
"

30 
	~"Ut.h
"

32 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

33 
usšg
 
Çme¥aû
 
	gHy³r¥aû
;

34 
usšg
 
Çme¥aû
 
	g¡d
;

36 cÚ¡ *
	gCommªdO³n
::
ms_u§ge
[] = {

45 
	gCommªdO³n
::
	$run
() {

46 
¡d
::
¡ršg
 
âame
 = "";

47 
æags
 = 0;

48 
ev’tMask
 = 0;

49 *
¡r
, *
Ï¡
;

50 
ušt64_t
 
hªdË
;

51 
”rÜ
;

53 
size_t
 
i
=0; i<
m_¬gs
.
	`size
(); i++) {

54 ià(
m_¬gs
[
i
].
fœ¡
 == "flags") {

55 
¡r
 = 
	`¡¹ok_r
((*)
m_¬gs
[
i
].
£cÚd
.
	`c_¡r
(), " \t|", &
Ï¡
);

56 
¡r
) {

57 ià(!
	`¡rcmp
(
¡r
, "READ"))

58 
æags
 |ğ
OPEN_FLAG_READ
;

59 ià(!
	`¡rcmp
(
¡r
, "WRITE"))

60 
æags
 |ğ
OPEN_FLAG_WRITE
;

61 ià(!
	`¡rcmp
(
¡r
, "LOCK"))

62 
æags
 |ğ
OPEN_FLAG_LOCK
;

63 ià(!
	`¡rcmp
(
¡r
, "CREATE"))

64 
æags
 |ğ
OPEN_FLAG_CREATE
;

65 ià(!
	`¡rcmp
(
¡r
, "EXCL"))

66 
æags
 |ğ
OPEN_FLAG_EXCL
;

67 ià(!
	`¡rcmp
(
¡r
, "TEMP"))

68 
æags
 |ğ
OPEN_FLAG_TEMP
;

69 ià(!
	`¡rcmp
(
¡r
, "LOCK_SHARED"))

70 
æags
 |ğ
OPEN_FLAG_LOCK_SHARED
;

71 ià(!
	`¡rcmp
(
¡r
, "LOCK_EXCLUSIVE"))

72 
æags
 |ğ
OPEN_FLAG_LOCK_EXCLUSIVE
;

73 
¡r
 = 
	`¡¹ok_r
(0, " \t|", &
Ï¡
);

76 ià(
m_¬gs
[
i
].
fœ¡
 == "event-mask") {

77 
¡r
 = 
	`¡¹ok_r
((*)
m_¬gs
[
i
].
£cÚd
.
	`c_¡r
(), " \t|", &
Ï¡
);

78 
¡r
) {

79 ià(!
	`¡rcmp
(
¡r
, "ATTR_SET"))

80 
ev’tMask
 |ğ
EVENT_MASK_ATTR_SET
;

81 ià(!
	`¡rcmp
(
¡r
, "ATTR_DEL"))

82 
ev’tMask
 |ğ
EVENT_MASK_ATTR_DEL
;

83 ià(!
	`¡rcmp
(
¡r
, "CHILD_NODE_ADDED"))

84 
ev’tMask
 |ğ
EVENT_MASK_CHILD_NODE_ADDED
;

85 ià(!
	`¡rcmp
(
¡r
, "CHILD_NODE_REMOVED"))

86 
ev’tMask
 |ğ
EVENT_MASK_CHILD_NODE_REMOVED
;

87 ià(!
	`¡rcmp
(
¡r
, "LOCK_ACQUIRED"))

88 
ev’tMask
 |ğ
EVENT_MASK_LOCK_ACQUIRED
;

89 ià(!
	`¡rcmp
(
¡r
, "LOCK_RELEASED"))

90 
ev’tMask
 |ğ
EVENT_MASK_LOCK_RELEASED
;

91 
¡r
 = 
	`¡¹ok_r
(0, " \t|", &
Ï¡
);

94 ià(
âame
 !ğ"" || 
m_¬gs
[
i
].
£cÚd
 != "") {

95 
û¼
 << "Inv®id‡rgum’ts. Ty³ 'h–p' fÜ u§ge." << 
’dl
;

99 
âame
 = 
m_¬gs
[
i
].
fœ¡
;

102 ià(
æags
 == 0) {

103 
û¼
 << "E¼Ü:‚Øæag suµl›d." << 
’dl
;

106 ià(
âame
 == "") {

107 
û¼
 << "E¼Ü:‚Øf’amsuµl›d." << 
’dl
;

113 
HªdËC®lbackPŒ
 
ÿÎbackPŒ
 = 
Ãw
 
	`FeHªdËC®lback
(
ev’tMask
);

115 ià((
”rÜ
 = 
m_£ssiÚ
->
	`İ’
(
âame
, 
æags
, 
ÿÎbackPŒ
, &
hªdË
)è=ğ
E¼Ü
::
OK
) {

116 
¡d
::
¡ršg
 
nÜm®Name
;

117 
Ut
::
	`nÜm®ize_·thÇme
(
âame
, 
nÜm®Name
);

118 
Glob®
::
feM­
[
nÜm®Name
] = 
hªdË
;

120  
”rÜ
;

121 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/CommandOpen.h

21 #iâdeà
HYPERTABLE_COMMANDOPEN_H


22 
	#HYPERTABLE_COMMANDOPEN_H


	)

24 
	~"CommÚ/IÁ”aùiveCommªd.h
"

26 
	~"Hy³r¥aû/SessiÚ.h
"

28 
	~"Glob®.h
"

30 
Çme¥aû
 
	gHy³r¥aû
 {

32 şas 
	cCommªdO³n
 : 
public
 
IÁ”aùiveCommªd
 {

33 
public
:

34 
CommªdO³n
(
SessiÚ
 *
£ssiÚ
è: 
m_£ssiÚ
(session) { ; }

35 
vœtu®
 cÚ¡ *
commªd_‹xt
() {  "open"; }

36 
vœtu®
 cÚ¡ **
u§ge
(è{  
	gms_u§ge
; }

37 
vœtu®
 
run
();

39 
	g´iv©e
:

40 cÚ¡ *
ms_u§ge
[];

41 
SessiÚ
 *
	gm_£ssiÚ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/CommandReaddir.cc

21 
	~<io¡»am
>

23 
	~"CommÚ/E¼Ü.h
"

24 
	~"CommÚ/U§ge.h
"

26 
	~"Hy³r¥aû/DœEÁry.h
"

28 
	~"CommªdR—ddœ.h
"

29 
	~"Glob®.h
"

30 
	~"Ut.h
"

32 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

33 
usšg
 
Çme¥aû
 
	gHy³r¥aû
;

34 
usšg
 
Çme¥aû
 
	g¡d
;

36 cÚ¡ *
	gCommªdR—ddœ
::
ms_u§ge
[] = {

43 
	gCommªdR—ddœ
::
	$run
() {

44 
ušt64_t
 
hªdË
;

45 
”rÜ
;

46 
¡d
::
veùÜ
<
DœEÁryT
> 
li¡šg
;

48 ià(
m_¬gs
.
	`size
() != 1) {

49 
û¼
 << "WrÚg‚umb” oà¬gum’ts. Ty³ 'h–p' fÜ u§ge." << 
’dl
;

53 ià(
m_¬gs
[0].
£cÚd
 != "") {

54 
û¼
 << "Inv®id ch¬aù” '=' iÀ¬gum’t." << 
’dl
;

58 ià(!
Ut
::
	`g‘_hªdË
(
m_¬gs
[0].
fœ¡
, &
hªdË
))

61 ià((
”rÜ
 = 
m_£ssiÚ
->
	`»addœ
(
hªdË
, 
li¡šg
)è=ğ
E¼Ü
::
OK
) {

62 
ÉDœEÁry
 
deComp
;

63 
	`sÜt
(
li¡šg
.
	`begš
(),†i¡šg.
	`’d
(), 
deComp
);

64 
size_t
 
i
=0; i<
li¡šg
.
	`size
(); i++) {

65 ià(
li¡šg
[
i
].
isDœeùÜy
)

66 
cout
 << "(dir) ";

68 
cout
 << " ";

69 
cout
 << 
li¡šg
[
i
].
Çme
 << 
’dl
;

73  
”rÜ
;

74 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/CommandReaddir.h

21 #iâdeà
HYPERTABLE_COMMANDREADDIR_H


22 
	#HYPERTABLE_COMMANDREADDIR_H


	)

24 
	~"CommÚ/IÁ”aùiveCommªd.h
"

26 
	~"Hy³r¥aû/SessiÚ.h
"

28 
	~"Glob®.h
"

30 
Çme¥aû
 
	gHy³r¥aû
 {

32 şas 
	cCommªdR—ddœ
 : 
public
 
IÁ”aùiveCommªd
 {

33 
public
:

34 
CommªdR—ddœ
(
SessiÚ
 *
£ssiÚ
è: 
m_£ssiÚ
(session) { ; }

35 
vœtu®
 cÚ¡ *
commªd_‹xt
() {  "readdir"; }

36 
vœtu®
 cÚ¡ **
u§ge
(è{  
	gms_u§ge
; }

37 
vœtu®
 
run
();

39 
	g´iv©e
:

40 cÚ¡ *
ms_u§ge
[];

41 
SessiÚ
 *
	gm_£ssiÚ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/CommandRelease.cc

21 
	~<io¡»am
>

23 
	~"CommÚ/E¼Ü.h
"

24 
	~"CommÚ/U§ge.h
"

26 
	~"CommªdR–—£.h
"

27 
	~"Glob®.h
"

28 
	~"Ut.h
"

30 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

31 
usšg
 
Çme¥aû
 
	gHy³r¥aû
;

32 
usšg
 
Çme¥aû
 
	g¡d
;

34 cÚ¡ *
	gCommªdR–—£
::
ms_u§ge
[] = {

41 
	gCommªdR–—£
::
	$run
() {

42 
ušt64_t
 
hªdË
;

43 
LockSequ’ûrT
 
lock£q
;

45 ià(
m_¬gs
.
	`size
() != 1) {

46 
û¼
 << "WrÚg‚umb” oà¬gum’ts. Ty³ 'h–p' fÜ u§ge." << 
’dl
;

50 ià(
m_¬gs
[0].
£cÚd
 != "") {

51 
û¼
 << "Inv®id ch¬aù” '=' iÀ¬gum’t." << 
’dl
;

55 ià(!
Ut
::
	`g‘_hªdË
(
m_¬gs
[0].
fœ¡
, &
hªdË
))

58  
m_£ssiÚ
->
	`»Ëa£
(
hªdË
);

59 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/CommandRelease.h

21 #iâdeà
HYPERTABLE_COMMANDRELEASE_H


22 
	#HYPERTABLE_COMMANDRELEASE_H


	)

24 
	~"CommÚ/IÁ”aùiveCommªd.h
"

26 
	~"Hy³r¥aû/SessiÚ.h
"

28 
	~"Glob®.h
"

30 
Çme¥aû
 
	gHy³r¥aû
 {

32 şas 
	cCommªdR–—£
 : 
public
 
IÁ”aùiveCommªd
 {

33 
public
:

34 
CommªdR–—£
(
SessiÚ
 *
£ssiÚ
è: 
m_£ssiÚ
(session) { ; }

35 
vœtu®
 cÚ¡ *
commªd_‹xt
() {  "release"; }

36 
vœtu®
 cÚ¡ **
u§ge
(è{  
	gms_u§ge
; }

37 
vœtu®
 
run
();

39 
	g´iv©e
:

40 cÚ¡ *
ms_u§ge
[];

41 
SessiÚ
 *
	gm_£ssiÚ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/CommandTryLock.cc

21 
	~<io¡»am
>

23 
	~"CommÚ/E¼Ü.h
"

24 
	~"CommÚ/U§ge.h
"

26 
	~"CommªdTryLock.h
"

27 
	~"Glob®.h
"

28 
	~"Ut.h
"

30 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

31 
usšg
 
Çme¥aû
 
	gHy³r¥aû
;

32 
usšg
 
Çme¥aû
 
	g¡d
;

34 cÚ¡ *
	gCommªdTryLock
::
ms_u§ge
[] = {

41 
	gCommªdTryLock
::
	$run
() {

42 
ušt64_t
 
hªdË
;

43 
”rÜ
;

44 
ušt32_t
 
mode
 = 0;

45 
LockSequ’ûrT
 
lock£q
;

46 
ušt32_t
 
¡©us
;

48 ià(
m_¬gs
.
	`size
() != 2) {

49 
û¼
 << "WrÚg‚umb” oà¬gum’ts. Ty³ 'h–p' fÜ u§ge." << 
’dl
;

53 ià(
m_¬gs
[0].
£cÚd
 != "" || m_args[1].second != "") {

54 
û¼
 << "Inv®id ch¬aù” '=' iÀ¬gum’t." << 
’dl
;

58 ià(
m_¬gs
[1].
fœ¡
 == "SHARED")

59 
mode
 = 
LOCK_MODE_SHARED
;

60 ià(
m_¬gs
[1].
fœ¡
 == "EXCLUSIVE")

61 
mode
 = 
LOCK_MODE_EXCLUSIVE
;

63 
û¼
 << "Inv®id modv®u(" << 
m_¬gs
[1].
£cÚd
 << ")" << 
’dl
;

67 ià(!
Ut
::
	`g‘_hªdË
(
m_¬gs
[0].
fœ¡
, &
hªdË
))

70 ià((
”rÜ
 = 
m_£ssiÚ
->
	`Œy_lock
(
hªdË
, 
mode
, &
¡©us
, &
lock£q
)è=ğ
E¼Ü
::
OK
) {

71 ià(
¡©us
 =ğ
LOCK_STATUS_GRANTED
)

72 
cout
 << "SEQUENCER‚ame=" << 
lock£q
.
Çme
 << " mode=" <<†ock£q.
mode
 << " g’”©iÚ=" <<†ock£q.
g’”©iÚ
 << 
’dl
 << 
æush
;

73 ià(
¡©us
 =ğ
LOCK_STATUS_BUSY
)

74 
cout
 << "busy" << 
’dl
;

76 
cout
 << "UnknowÀ¡©us: " << 
¡©us
 << 
’dl
;

80  
”rÜ
;

81 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/CommandTryLock.h

21 #iâdeà
HYPERTABLE_COMMANDTRYLOCK_H


22 
	#HYPERTABLE_COMMANDTRYLOCK_H


	)

24 
	~"CommÚ/IÁ”aùiveCommªd.h
"

26 
	~"Hy³r¥aû/SessiÚ.h
"

28 
	~"Glob®.h
"

30 
Çme¥aû
 
	gHy³r¥aû
 {

32 şas 
	cCommªdTryLock
 : 
public
 
IÁ”aùiveCommªd
 {

33 
public
:

34 
CommªdTryLock
(
SessiÚ
 *
£ssiÚ
è: 
m_£ssiÚ
(session) { ; }

35 
vœtu®
 cÚ¡ *
commªd_‹xt
() {  "trylock"; }

36 
vœtu®
 cÚ¡ **
u§ge
(è{  
	gms_u§ge
; }

37 
vœtu®
 
run
();

39 
	g´iv©e
:

40 cÚ¡ *
ms_u§ge
[];

41 
SessiÚ
 *
	gm_£ssiÚ
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/FileHandleCallback.h

21 #iâdeà
HYPERSPACE_FILEHANDLECALLBACK_H


22 
	#HYPERSPACE_FILEHANDLECALLBACK_H


	)

24 
	~"Hy³r¥aû/HªdËC®lback.h
"

26 
Çme¥aû
 
	gHy³r¥aû
 {

28 şas 
	cFeHªdËC®lback
 : 
public
 
HªdËC®lback
 {

29 
public
:

30 
FeHªdËC®lback
(
ušt32_t
 
ev’tMask
è: 
HªdËC®lback
(eventMask) { ; }

31 
vœtu®
 
©Œ_£t
(
¡d
::
¡ršg
 
Çme
è{ 
cout
 << "ATTR SET " <<‚am<< 
’dl
 << 
æush
; }

32 
vœtu®
 
©Œ_d–
(
¡d
::
¡ršg
 
Çme
è{ 
cout
 << "ATTR DEL " <<‚am<< 
’dl
 << 
æush
; }

33 
vœtu®
 
chd_node_added
(
¡d
::
¡ršg
 
Çme
è{ 
cout
 << "CHILD NODE ADDED " <<‚am<< 
’dl
 << 
æush
; }

34 
vœtu®
 
chd_node_»moved
(
¡d
::
¡ršg
 
Çme
è{ 
cout
 << "CHILD NODE REMOVED " <<‚am<< 
’dl
 << 
æush
; }

35 
vœtu®
 
lock_acquœed
(
ušt32_t
 
mode
) {

36 ià(
	gmode
 =ğ
LOCK_MODE_SHARED
)

37 
cout
 << "LOCK ACQUIRED sh¬ed" << 
’dl
 << 
æush
;

38 ià(
	gmode
 =ğ
LOCK_MODE_EXCLUSIVE
)

39 
cout
 << "LOCK ACQUIREDƒxşusive" << 
’dl
 << 
æush
;

41 
	gcout
 << "LOCK ACQUIRED " << 
	gmode
 << 
	g’dl
 << 
	gæush
;

43 
vœtu®
 
lock_»Ëa£d
(è{ 
	gcout
 << "LOCK RELEASED" << 
	g’dl
 << 
	gæush
; }

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/Global.cc

21 
	~"Glob®.h
"

23 
Çme¥aû
 
	gHy³r¥aû
 {

24 
	gGlob®
::
ex™Stus
 = 0;

25 
	g¡d
::
¡ršg
 
Glob®
::
cwd
 = "/";

26 
	gGlob®
::
FeM­T
 
Glob®
::
feM­
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/Global.h

21 #iâdeà
HYPERSPACE_GLOBAL_H


22 
	#HYPERSPACE_GLOBAL_H


	)

24 
	~<¡ršg
>

26 
	~"CommÚ/SŒšgExt.h
"

28 
Çme¥aû
 
	gHy³r¥aû
 {

30 
Çme¥aû
 
	gGlob®
 {

31 
ex™Stus
;

32 
¡d
::
¡ršg
 
cwd
;

33 
	g__gnu_cxx
::
	thash_m­
<
	t¡d
::
	t¡ršg
, 
	tušt64_t
> 
	tFeM­T
;

34 
FeM­T
 
feM­
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/Util.cc

21 
	~<io¡»am
>

22 
	~<¡ršg
>

24 
	~"Glob®.h
"

25 
	~"Ut.h
"

27 
	gHy³r¥aû
::
Ut
::
nÜm®ize_·thÇme
(
¡d
::
¡ršg
 
Çme
, std::¡ršg &
nÜm®Name
) {

28 
nÜm®Name
 = "";

29 ià(
	gÇme
[0] != '/')

30 
nÜm®Name
 += "/";

32 ià(
	gÇme
.
fšd
('/', 
Çme
.
Ëngth
()-1è=ğ
¡d
::
¡ršg
::
Åos
)

33 
nÜm®Name
 +ğ
Çme
;

35 
	gnÜm®Name
 +ğ
Çme
.
sub¡r
(0,‚ame.
Ëngth
()-1);

38 
boŞ
 
	gHy³r¥aû
::
Ut
::
g‘_hªdË
(
¡d
::
¡ršg
 
Çme
, 
ušt64_t
 *
hªdËp
) {

39 
	g¡d
::
¡ršg
 
nÜm®Name
;

41 
nÜm®ize_·thÇme
(
Çme
, 
nÜm®Name
);

43 
	gGlob®
::
FeM­T
::
™”©Ü
 
™”
 = 
Glob®
::
feM­
.
fšd
(
nÜm®Name
);

44 ià(
	g™”
 =ğ
Glob®
::
feM­
.
’d
()) {

45 
¡d
::
û¼
 << "UÇbËØfšd '" << 
nÜm®Name
 << "' iÀİ’ fm­" << std::
’dl
;

46  
	gçl£
;

48 *
	ghªdËp
 = (*
™”
).
£cÚd
;

49  
	gŒue
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/Util.h

21 #iâdeà
HYPERTABLE_UTIL_H


22 
	#HYPERTABLE_UTIL_H


	)

24 
Çme¥aû
 
	gHy³r¥aû
 {

26 
Çme¥aû
 
	gUt
 {

28 
nÜm®ize_·thÇme
(
¡d
::
¡ršg
 
Çme
, std::¡ršg &
nÜm®Name
);

29 
boŞ
 
g‘_hªdË
(
¡d
::
¡ršg
 
Çme
, 
ušt64_t
 *
hªdËp
);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/hyperspace.cc

21 
	~<c¡dio
>

22 
	~<¡ršg
>

23 
	~<veùÜ
>

25 
	~<boo¡/®gÜ™hm/¡ršg.hµ
>

26 
	~<boo¡/th»ad/exû±iÚs.hµ
>

29 
	~<»adlše/hi¡Üy.h
>

30 
	~<»adlše/»adlše.h
>

31 
	~<sys/pŞl.h
>

34 
	~"AsyncComm/Comm.h
"

35 
	~"AsyncComm/CommBuf.h
"

36 
	~"AsyncComm/H—d”Bud”.h
"

37 
	~"CommÚ/E¼Ü.h
"

38 
	~"CommÚ/IÃtAddr.h
"

39 
	~"CommÚ/IÁ”aùiveCommªd.h
"

40 
	~"CommÚ/Logg”.h
"

41 
	~"CommÚ/Prİ”t›s.h
"

42 
	~"CommÚ/Sy¡em.h
"

43 
	~"CommÚ/U§ge.h
"

45 
	~"Glob®.h
"

46 
	~"Hy³r¥aû/SessiÚ.h
"

48 
	~"CommªdMkdœ.h
"

49 
	~"CommªdD–‘e.h
"

50 
	~"CommªdO³n.h
"

51 
	~"CommªdC»©e.h
"

52 
	~"CommªdClo£.h
"

53 
	~"CommªdA‰rS‘.h
"

54 
	~"CommªdA‰rG‘.h
"

55 
	~"CommªdA‰rD–.h
"

56 
	~"CommªdExi¡s.h
"

57 
	~"CommªdR—ddœ.h
"

58 
	~"CommªdLock.h
"

59 
	~"CommªdTryLock.h
"

60 
	~"CommªdR–—£.h
"

61 
	~"CommªdG‘Sequ’ûr.h
"

63 
usšg
 
Çme¥aû
 
Hy³¹abË
;

64 
usšg
 
Çme¥aû
 
	g¡d
;

67 
	gÇme¥aû
 {

69 *
	glše_»ad
 = 0;

71 
boŞ
 
	ggTe¡Mode
 = 
çl£
;

72 
	g¡d
::
¡ršg
 
gIÅutSŒ
;

74 *
¾_g‘s
 () {

76 ià(
	ggTe¡Mode
) {

77 ià(!
g‘lše
(
cš
, 
gIÅutSŒ
))

79 
	gboo¡
::
Œim
(
gIÅutSŒ
);

80 ià(
	ggIÅutSŒ
.
fšd
("echo", 0è!ğ0 && 
gIÅutSŒ
.find("quit", 0) != 0)

81 
cout
 << 
gIÅutSŒ
 << 
’dl
;

82  (*)
	ggIÅutSŒ
.
c_¡r
();

85 ià(
	glše_»ad
) {

86 
ä“
 (
lše_»ad
);

87 
	glše_»ad
 = (*)
NULL
;

91 
	glše_»ad
 = 
»adlše
("hyperspace> ");

94 ià(
	glše_»ad
 && *line_read)

95 
add_hi¡Üy
 (
lše_»ad
);

97  
	glše_»ad
;

101 cÚ¡ *
	gu§ge
[] = {

124 cÚ¡ *
	gh–pT¿”
[] = {

141 şas 
	cNÙif›r
 {

143 
	mpublic
:

145 
	$NÙif›r
(cÚ¡ *
add»ssSŒ
) {

146 
Di¥©chHªdËrPŒ
 
	`nuÎHªdËr
(0);

147 
”rÜ
;

148 
m_comm
 = 
Ãw
 
	`Comm
();

149 ià(!
IÃtAddr
::
	`š™Ÿlize
(&
m_addr
, 
add»ssSŒ
)) {

150 
	`ex™
(1);

152 
IÃtAddr
::
	`š™Ÿlize
(&
m_£nd_addr
, 
INADDR_ANY
, 0);

153 ià((
”rÜ
 = 
m_comm
->
	`ü—‹_d©ag¿m_»ûive_sock‘
(&
m_£nd_addr
, 
nuÎHªdËr
)è!ğ
E¼Ü
::
OK
) {

154 
¡d
::
¡ršg
 
¡r
;

155 
	`HT_ERRORF
("ProbËm c»©šg UDP„eûivsock‘ % - %s", 
IÃtAddr
::
	`¡ršg_fÜm©
(
¡r
, 
m_£nd_addr
), 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

156 
	`ex™
(1);

160 
	$NÙif›r
(è: 
	$m_comm
(0) {

162 
	}
}

164 
	$nÙify
() {

165 ià(
m_comm
) {

166 
”rÜ
;

167 
CommBufPŒ
 
	`cbufPŒ
Ğ
Ãw
 
	`CommBuf
(
m_bud”
, 2) );

168 
cbufPŒ
->
	`­³nd_shÜt
(0);

169 ià((
”rÜ
 = 
m_comm
->
	`£nd_d©ag¿m
(
m_addr
, 
m_£nd_addr
, 
cbufPŒ
)è!ğ
E¼Ü
::
OK
) {

170 
	`HT_ERRORF
("ProbËm s’dšg d©ag¿m - %s", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

171 
	`ex™
(1);

174 
	}
}

176 
	g´iv©e
:

177 
Comm
 *
m_comm
;

178 
sockaddr_š
 
	gm_addr
;

179 
sockaddr_š
 
	gm_£nd_addr
;

180 
H—d”Bud”
 
	gm_bud”
;

187 şas 
	cSessiÚHªdËr
 : 
public
 
SessiÚC®lback
 {

188 
public
:

189 
vœtu®
 
	$jeİ¬dy
(è{ 
cout
 << "SESSION CALLBACK: Jeİ¬dy" << 
’dl
 << 
æush
; }

190 
vœtu®
 
	$§ã
(è{ 
cout
 << "SESSION CALLBACK: Saã" << 
’dl
 << 
æush
; 
	}
}

191 
vœtu®
 
	$expœed
(è{ 
cout
 << "SESSION CALLBACK: Expœed" << 
’dl
 << 
æush
; 
	}
}

199 
	$maš
(
¬gc
, **
¬gv
, **
’vp
) {

200 cÚ¡ *
lše
;

201 *
ev®
 = 0;

202 
size_t
 
i
;

203 
¡ršg
 
cÚfigFe
 = "";

204 
veùÜ
<
IÁ”aùiveCommªd
 *> 
commªds
;

205 
Comm
 *
comm
;

206 
Prİ”t›sPŒ
 
´İs_±r
;

207 
Hy³r¥aû
::
SessiÚ
 *
£ssiÚ
;

208 
SessiÚHªdËr
 
£ssiÚHªdËr
;

209 
boŞ
 
v”bo£
 = 
çl£
;

210 
”rÜ
;

211 
NÙif›r
 *
nÙif›r
 = 0;

213 
Sy¡em
::
	`š™Ÿlize
(
¬gv
[0]);

214 
R—ùÜFaùÜy
::
	`š™Ÿlize
((
ušt16_t
)
Sy¡em
::
	`g‘_´oûssÜ_couÁ
());

216 
cÚfigFe
 = 
Sy¡em
::
š¡®lDœ
 + "/conf/hypertable.cfg";

218 
i
=1; i<
¬gc
; i++) {

219 ià(!
	`¡ºcmp
(
¬gv
[
i
], "--config=", 9))

220 
cÚfigFe
 = &
¬gv
[
i
][9];

221 ià(!
	`¡rcmp
(
¬gv
[
i
], "--debug"))

222 
v”bo£
 = 
Œue
;

223 ià(!
	`¡rcmp
(
¬gv
[
i
], "--eval")) {

224 
i
++;

225 ià(
i
 =ğ
¬gc
)

226 
U§ge
::
	`dump_ªd_ex™
(
u§ge
);

227 
ev®
 = 
¬gv
[
i
];

229 ià(!
	`¡rcmp
(
¬gv
[
i
], "--test-mode")) {

230 
Logg”
::
	`£t_‹¡_mode
("hyperspace");

231 
gTe¡Mode
 = 
Œue
;

233 ià(!
	`¡ºcmp
(
¬gv
[
i
], "--notification-address=", 23))

234 
nÙif›r
 = 
Ãw
 
	`NÙif›r
(&
¬gv
[
i
][23]);

236 
U§ge
::
	`dump_ªd_ex™
(
u§ge
);

239 ià(
nÙif›r
 == 0)

240 
nÙif›r
 = 
Ãw
 
	`NÙif›r
();

242 
´İs_±r
 = 
Ãw
 
	`Prİ”t›s
Ğ
cÚfigFe
 );

244 ià(
v”bo£
)

245 
´İs_±r
->
	`£t
("Hypertable.Verbose", "true");

247 
comm
 = 
Ãw
 
	`Comm
();

249 
£ssiÚ
 = 
Ãw
 
	`SessiÚ
(
comm
, 
´İs_±r
, &
£ssiÚHªdËr
);

251 ià(!
£ssiÚ
->
	`wa™_fÜ_cÚÃùiÚ
(30)) {

252 
û¼
 << "UÇbËØe¡ablish sessiÚ w™h Hy”¥aû,ƒx™šg..." << 
’dl
;

253 
	`ex™
(1);

256 
commªds
.
	`push_back
Ğ
Ãw
 
	`CommªdMkdœ
(
£ssiÚ
) );

257 
commªds
.
	`push_back
Ğ
Ãw
 
	`CommªdD–‘e
(
£ssiÚ
) );

258 
commªds
.
	`push_back
Ğ
Ãw
 
	`CommªdO³n
(
£ssiÚ
) );

259 
commªds
.
	`push_back
Ğ
Ãw
 
	`CommªdC»©e
(
£ssiÚ
) );

260 
commªds
.
	`push_back
Ğ
Ãw
 
	`CommªdClo£
(
£ssiÚ
) );

261 
commªds
.
	`push_back
Ğ
Ãw
 
	`CommªdA‰rS‘
(
£ssiÚ
) );

262 
commªds
.
	`push_back
Ğ
Ãw
 
	`CommªdA‰rG‘
(
£ssiÚ
) );

263 
commªds
.
	`push_back
Ğ
Ãw
 
	`CommªdA‰rD–
(
£ssiÚ
) );

264 
commªds
.
	`push_back
Ğ
Ãw
 
	`CommªdExi¡s
(
£ssiÚ
) );

265 
commªds
.
	`push_back
Ğ
Ãw
 
	`CommªdR—ddœ
(
£ssiÚ
) );

266 
commªds
.
	`push_back
Ğ
Ãw
 
	`CommªdLock
(
£ssiÚ
) );

267 
commªds
.
	`push_back
Ğ
Ãw
 
	`CommªdTryLock
(
£ssiÚ
) );

268 
commªds
.
	`push_back
Ğ
Ãw
 
	`CommªdR–—£
(
£ssiÚ
) );

269 
commªds
.
	`push_back
Ğ
Ãw
 
	`CommªdG‘Sequ’ûr
(
£ssiÚ
) );

274 ià(
ev®
 != 0) {

275 cÚ¡ *
¡r
;

276 
¡d
::
¡ršg
 
commªdSŒ
;

277 
¡r
 = 
	`¡¹ok
(
ev®
, ";");

278 
¡r
) {

279 
Glob®
::
ex™Stus
 = 0;

280 
commªdSŒ
 = 
¡r
;

281 
boo¡
::
	`Œim
(
commªdSŒ
);

282 
i
=0; i<
commªds
.
	`size
(); i++) {

283 ià(
commªds
[
i
]->
	`m©ches
(
commªdSŒ
.
	`c_¡r
())) {

284 
commªds
[
i
]->
	`·r£_commªd_lše
(
commªdSŒ
.
	`c_¡r
());

285 ià((
”rÜ
 = 
commªds
[
i
]->
	`run
()è!ğ
E¼Ü
::
OK
) {

286 
û¼
 << 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
è<< 
’dl
;

292 ià(
i
 =ğ
commªds
.
	`size
()) {

293 
	`HT_ERRORF
("UÄecognized commªd : %s", 
commªdSŒ
.
	`c_¡r
());

296 
¡r
 = 
	`¡¹ok
(0, ";");

298  
Glob®
::
ex™Stus
;

301 
cout
 << "W–comtØthHy³r¥aû commªd iÁ”´‘”. Hy³r¥aû" << 
’dl
;

302 
cout
 << "i ¨glob®‚ame¥aû‡nd†ock s”viû fÜ†oo£ly-cou¶ed" << 
’dl
;

303 
cout
 << "di¡ribu‹d sy¡ems. Ty³ 'h–p' fÜ‡ desütiÚ oàcommªds." << 
’dl
;

304 
cout
 << 
’dl
 << 
æush
;

306 
	`usšg_hi¡Üy
();

307 (
lše
 = 
	`¾_g‘s
()) != 0) {

309 
Glob®
::
ex™Stus
 = 0;

311 ià(*
lše
 == 0)

314 
i
=0; i<
commªds
.
	`size
(); i++) {

315 ià(
commªds
[
i
]->
	`m©ches
(
lše
)) {

316 
commªds
[
i
]->
	`·r£_commªd_lše
(
lše
);

317 ià((
”rÜ
 = 
commªds
[
i
]->
	`run
()è!ğ
E¼Ü
::
OK
 &&ƒrror != -1)

318 
cout
 << 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
è<< 
’dl
;

319 
nÙif›r
->
	`nÙify
();

324 ià(
i
 =ğ
commªds
.
	`size
()) {

325 ià(!
	`¡rcmp
(
lše
, "quit") || !strcmp(line, "exit")) {

326 
nÙif›r
->
	`nÙify
();

327 
	`ex™
(0);

329 ià(!
	`¡ºcmp
(
lše
, "echo", 4)) {

330 
¡d
::
¡ršg
 
echoSŒ
 = std::
	`¡ršg
(
lše
);

331 
echoSŒ
 =ƒchoSŒ.
	`sub¡r
(4);

332 
boo¡
::
	`Œim_if
(
echoSŒ
, boo¡::
	`is_ªy_of
("\" \t"));

333 
cout
 << 
echoSŒ
 << 
’dl
;

334 
nÙif›r
->
	`nÙify
();

336 ià(!
	`¡rcmp
(
lše
, "pwd")) {

337 
cout
 << 
Glob®
::
cwd
 << 
’dl
;

338 
nÙif›r
->
	`nÙify
();

340 ià(!
	`¡rcmp
(
lše
, "help")) {

341 
cout
 << 
’dl
;

342 
i
=0; i<
commªds
.
	`size
(); i++) {

343 
U§ge
::
	`dump
(
commªds
[
i
]->
	`u§ge
());

344 
cout
 << 
’dl
;

346 
U§ge
::
	`dump
(
h–pT¿”
);

347 
nÙif›r
->
	`nÙify
();

350 
cout
 << "UÄecognized commªd." << 
’dl
;

351 
nÙif›r
->
	`nÙify
();

356 
d–‘e
 
£ssiÚ
;

357 
d–‘e
 
comm
;

358  
Glob®
::
ex™Stus
;

359 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/test/hyperspaceTest.cc

21 
	~<c¡dio
>

22 
	~<c¡dlib
>

23 
	~<c¡ršg
>

24 
	~<veùÜ
>

27 
	~<uni¡d.h
>

30 
	~"CommÚ/E¼Ü.h
"

31 
	~"CommÚ/IÃtAddr.h
"

32 
	~"CommÚ/Logg”.h
"

33 
	~"CommÚ/S”v”Launch”.h
"

34 
	~"CommÚ/Sy¡em.h
"

35 
	~"CommÚ/U§ge.h
"

37 
	~"AsyncComm/Comm.h
"

38 
	~"AsyncComm/CommBuf.h
"

39 
	~"AsyncComm/Di¥©chHªdËr.h
"

40 
	~"AsyncComm/H—d”Bud”.h
"

41 
	~"AsyncComm/R—ùÜFaùÜy.h
"

44 
usšg
 
Çme¥aû
 
Hy³¹abË
;

46 
	gÇme¥aû
 {

47 cÚ¡ *
	gu§ge
[] = {

60 şas 
	cNÙifiÿtiÚHªdËr
 : 
public
 
Di¥©chHªdËr
 {

62 
public
:

64 
NÙifiÿtiÚHªdËr
(è: 
Di¥©chHªdËr
() { ; }

66 
£t_³ndšg
(è{ 
	gm_³ndšg
 = 
Œue
; }

68 
vœtu®
 
hªdË
(
Ev’tPŒ
 &
ev’tPŒ
) {

69 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

70 
	gm_³ndšg
 = 
çl£
;

71 
	gm_cÚd
.
nÙify_®l
();

74 
wa™_fÜ_nÙifiÿtiÚ
() {

75 
	gboo¡
::
mu‹x
::
scİed_lock
 
lock
(
m_mu‹x
);

76 
	gm_³ndšg
)

77 
	gm_cÚd
.
wa™
(
lock
);

80 
	g´iv©e
:

81 
boo¡
::
mu‹x
 
m_mu‹x
;

82 
	gboo¡
::
cÚd™iÚ
 
m_cÚd
;

83 
boŞ
 
	gm_³ndšg
;

86 
NÙifiÿtiÚHªdËr
 *
	ggNÙifyHªdËr
 = 0;

88 
	$IssueCommªdNoWa™
(
fd
, cÚ¡ *
commªd
) {

89 ià(
	`wr™e
(
fd
, 
commªd
, 
	`¡¾’
(commªd)è!ğ(
ssize_t
)strlen(command)) {

90 
	`³¼Ü
("write");

91 
	`ex™
(1);

93 ià(
	`wr™e
(
fd
, "\n", 1) != 1) {

94 
	`³¼Ü
("write");

95 
	`ex™
(1);

97 
	}
}

99 
	$IssueCommªd
(
fd
, cÚ¡ *
commªd
) {

100 
gNÙifyHªdËr
->
	`£t_³ndšg
();

101 
	`IssueCommªdNoWa™
(
fd
, 
commªd
);

102 
gNÙifyHªdËr
->
	`wa™_fÜ_nÙifiÿtiÚ
();

103 
	}
}

105 
	ggFd1
, 
	ggFd2
, 
	ggFd3
;

106 
pid_t
 
	ggPid1
, 
	ggPid2
, 
	ggPid3
;

108 
OuutTe¡H—d”
(cÚ¡ *
Çme
);

109 
BasicTe¡
();

110 
NÙifiÿtiÚTe¡
();

111 
LockTe¡
();

112 
Ephem”®FeTe¡
();

113 
SessiÚExpœ©iÚTe¡
();

118 
	$maš
(
¬gc
, **
¬gv
) {

119 
¡d
::
veùÜ
<cÚ¡ *> 
ma¡”Args
;

120 
¡d
::
veùÜ
<cÚ¡ *> 
ş›ÁArgs
;

121 
”rÜ
;

122 
Comm
 *
comm
;

123 
sockaddr_š
 
addr
;

124 
ma¡”In¡®lDœ
[2048];

125 
Di¥©chHªdËrPŒ
 
dhp
;

127 ià(
¬gc
 > 1 && (!
	`¡rcmp
(
¬gv
[1], "-?") || !strcmp(argv[1], "--help")))

128 
U§ge
::
	`dump_ªd_ex™
(
u§ge
);

130 
gNÙifyHªdËr
 = 
Ãw
 
	`NÙifiÿtiÚHªdËr
();

132 
dhp
 = 
gNÙifyHªdËr
;

134 
Sy¡em
::
	`š™Ÿlize
(
¬gv
[0]);

135 
R—ùÜFaùÜy
::
	`š™Ÿlize
(1);

137 
comm
 = 
Ãw
 
	`Comm
();

139 ià(!
IÃtAddr
::
	`š™Ÿlize
(&
addr
, "23451"))

140 
	`ex™
(1);

142 ià((
”rÜ
 = 
comm
->
	`ü—‹_d©ag¿m_»ûive_sock‘
(&
addr
, 
dhp
)è!ğ
E¼Ü
::
OK
) {

143 
¡d
::
¡ršg
 
¡r
;

144 
	`HT_ERRORF
("ProbËm c»©šg UDP„eûivsock‘ % - %s", 
IÃtAddr
::
	`¡ršg_fÜm©
(
¡r
, 
addr
), 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

145 
	`ex™
(1);

148 
	`sy¡em
("/bin/rm -rf ./hsroot");

150 ià(
	`sy¡em
("mkdir ./hsroot") != 0) {

151 
	`HT_ERROR
("Unableo create ./hsroot directory");

152 
	`ex™
(1);

155 
	`¡rıy
(
ma¡”In¡®lDœ
, "--install-dir=");

156 
	`g‘cwd
(
ma¡”In¡®lDœ
+
	`¡¾’
("--install-dir="), 2000);

158 
ma¡”Args
.
	`push_back
("Hyperspace.Master");

159 
ma¡”Args
.
	`push_back
("--config=./hyperspaceTest.cfg");

160 
ma¡”Args
.
	`push_back
("--verbose");

161 
ma¡”Args
.
	`push_back
(
ma¡”In¡®lDœ
);

162 
ma¡”Args
.
	`push_back
((const *)0);

164 
ş›ÁArgs
.
	`push_back
("hyperspace");

165 
ş›ÁArgs
.
	`push_back
("--config=./hyperspaceTest.cfg");

166 
ş›ÁArgs
.
	`push_back
("--test-mode");

167 
ş›ÁArgs
.
	`push_back
("--notification-address=23451");

168 
ş›ÁArgs
.
	`push_back
((const *)0);

170 
	`uÆšk
("./Hyperspace.Master");

171 
	`lšk
("../../Hyperspace/Hyperspace.Master", "./Hyperspace.Master");

174 
S”v”Launch”
 
	`ma¡”
("./Hy³r¥aû.Ma¡”", (* cÚ¡ *)&
ma¡”Args
[0]);

175 
S”v”Launch”
 
	`ş›Á1
("./hy³r¥aû", (* cÚ¡ *)&
ş›ÁArgs
[0], "client1.out");

176 
S”v”Launch”
 
	`ş›Á2
("./hy³r¥aû", (* cÚ¡ *)&
ş›ÁArgs
[0], "client2.out");

177 
S”v”Launch”
 
	`ş›Á3
("./hy³r¥aû", (* cÚ¡ *)&
ş›ÁArgs
[0], "client3.out");

179 
gFd1
 = 
ş›Á1
.
	`g‘_wr™e_desütÜ
();

180 
gFd2
 = 
ş›Á2
.
	`g‘_wr™e_desütÜ
();

181 
gFd3
 = 
ş›Á3
.
	`g‘_wr™e_desütÜ
();

183 
gPid1
 = 
ş›Á1
.
	`g‘_pid
();

184 
gPid2
 = 
ş›Á2
.
	`g‘_pid
();

185 
gPid3
 = 
ş›Á3
.
	`g‘_pid
();

187 
	`BasicTe¡
();

188 
	`NÙifiÿtiÚTe¡
();

189 
	`LockTe¡
();

190 
	`Ephem”®FeTe¡
();

191 
	`SessiÚExpœ©iÚTe¡
();

193 
	`IssueCommªdNoWa™
(
gFd1
, "quit");

194 
	`IssueCommªdNoWa™
(
gFd2
, "quit");

195 
	`IssueCommªdNoWa™
(
gFd3
, "quit");

196 
	`pŞl
(0, 0, 1000);

199 ià(
	`sy¡em
("diff ./client1.out ./client1.golden"))

202 ià(
	`sy¡em
("diff ./client2.out ./client2.golden"))

205 ià(
	`sy¡em
("diff ./client3.out ./client3.golden"))

209 
	}
}

212 
	gÇme¥aû
 {

214 
OuutTe¡H—d”
(cÚ¡ *
Çme
) {

215 
	g¡d
::
¡ršg
 
commªdSŒ
 = (
¡d
::¡ršg)"echØ" + 
Çme
;

216 
IssueCommªd
(
gFd1
, "echo");

217 
IssueCommªd
(
gFd1
, 
commªdSŒ
.
c_¡r
());

218 
IssueCommªd
(
gFd2
, "echo");

219 
IssueCommªd
(
gFd2
, 
commªdSŒ
.
c_¡r
());

220 
IssueCommªd
(
gFd3
, "echo");

221 
IssueCommªd
(
gFd3
, 
commªdSŒ
.
c_¡r
());

224 
BasicTe¡
() {

225 
OuutTe¡H—d”
("<< BasicTest >>");

226 
IssueCommªd
(
gFd1
, "mkdir dir1");

227 
IssueCommªd
(
gFd1
, "mkdir how/now/brown/cow");

228 
IssueCommªd
(
gFd1
, "delete foo");

229 
IssueCommªd
(
gFd1
, "open foo flags=READ");

230 
IssueCommªd
(
gFd1
, "open foo flags=READ|CREATE");

231 
IssueCommªd
(
gFd1
, "open foo flags=READ|CREATE|EXCL");

232 
IssueCommªd
(
gFd1
, "lock foo EXCLUSIVE");

233 
IssueCommªd
(
gFd1
, "exists dir1");

234 
IssueCommªd
(
gFd1
, "exists foo");

235 
IssueCommªd
(
gFd1
, "exists bar");

236 
IssueCommªd
(
gFd1
, "attrget fooestattr");

237 
IssueCommªd
(
gFd1
, "open flags=READ /");

238 
IssueCommªd
(
gFd1
, "readdir /");

239 
IssueCommªd
(
gFd1
, "close /");

240 
IssueCommªd
(
gFd1
, "delete dir1");

241 
IssueCommªd
(
gFd1
, "close foo");

242 
IssueCommªd
(
gFd1
, "attrset fooestattr=\"Hello, World!\"");

243 
IssueCommªd
(
gFd1
, "attrget fooestattr");

244 
IssueCommªd
(
gFd1
, "attrdel fooestattr");

245 
IssueCommªd
(
gFd1
, "delete foo");

246 
IssueCommªd
(
gFd1
, "create foo flags=READ|WRITE‡ttr:msg1=\"Hello, World!\"‡ttr:msg2=\"How‚ow brown cow\"");

247 
IssueCommªd
(
gFd2
, "open foo flags=READ");

248 
IssueCommªd
(
gFd3
, "open foo flags=READ");

249 
IssueCommªd
(
gFd2
, "attrget foo msg1");

250 
IssueCommªd
(
gFd3
, "attrget foo msg2");

251 
IssueCommªd
(
gFd1
, "close foo");

252 
IssueCommªd
(
gFd2
, "close foo");

253 
IssueCommªd
(
gFd3
, "close foo");

254 
IssueCommªd
(
gFd1
, "delete foo");

257 
NÙifiÿtiÚTe¡
() {

258 
OuutTe¡H—d”
("<< NotificationTest >>");

259 
IssueCommªd
(
gFd1
, "mkdir dir1");

260 
IssueCommªd
(
gFd1
, "open dir1 flags=READ|CREATE|WRITEƒvent-mask=ATTR_SET|ATTR_DEL|CHILD_NODE_ADDED|CHILD_NODE_REMOVED|LOCK_ACQUIRED|LOCK_RELEASED");

261 
IssueCommªd
(
gFd2
, "mkdir dir1/foo");

262 
IssueCommªd
(
gFd2
, "delete dir1/foo");

263 
IssueCommªd
(
gFd2
, "open dir1 flags=READ|WRITE|LOCK");

264 
IssueCommªd
(
gFd2
, "attrset dir1 fox=\"Hello, World!\"");

265 
IssueCommªd
(
gFd2
, "attrget dir1 fox");

266 
IssueCommªd
(
gFd2
, "attrdel dir1 fox");

267 
IssueCommªd
(
gFd2
, "lock dir1 EXCLUSIVE");

268 
IssueCommªd
(
gFd2
, "release dir1");

269 
IssueCommªd
(
gFd1
, "close dir1");

270 
IssueCommªd
(
gFd2
, "close dir1");

271 
IssueCommªd
(
gFd2
, "delete dir1");

274 
LockTe¡
() {

275 
OuutTe¡H—d”
("<< LockTest >>");

276 
IssueCommªd
(
gFd1
, "open†ockfile flags=READ|CREATE|WRITEƒvent-mask=ATTR_SET|ATTR_DEL|CHILD_NODE_ADDED|CHILD_NODE_REMOVED|LOCK_ACQUIRED|LOCK_RELEASED");

277 
IssueCommªd
(
gFd2
, "open†ockfile flags=READ|WRITE|LOCK");

278 
IssueCommªd
(
gFd3
, "open†ockfile flags=READ|WRITE|LOCK");

279 
IssueCommªd
(
gFd2
, "lock†ockfile EXCLUSIVE");

280 
IssueCommªdNoWa™
(
gFd3
, "lock†ockfile EXCLUSIVE");

281 
pŞl
(0,0,1000);

282 
IssueCommªd
(
gFd2
, "release†ockfile");

283 
pŞl
(0,0,1000);

284 
IssueCommªd
(
gFd3
, "release†ockfile");

285 
IssueCommªd
(
gFd2
, "lock†ockfile SHARED");

286 
IssueCommªd
(
gFd3
, "lock†ockfile SHARED");

287 
IssueCommªd
(
gFd2
, "release†ockfile");

288 
IssueCommªd
(
gFd3
, "release†ockfile");

289 
IssueCommªd
(
gFd2
, "trylock†ockfile EXCLUSIVE");

290 
IssueCommªd
(
gFd3
, "trylock†ockfile EXCLUSIVE");

291 
IssueCommªd
(
gFd2
, "release†ockfile");

292 
IssueCommªd
(
gFd3
, "release†ockfile");

293 
IssueCommªd
(
gFd2
, "close†ockfile");

294 
IssueCommªd
(
gFd3
, "close†ockfile");

295 
IssueCommªd
(
gFd2
, "open†ockfile flags=READ|WRITE|LOCK_EXCLUSIVE");

296 
IssueCommªd
(
gFd3
, "open†ockfile flags=READ|WRITE|LOCK_EXCLUSIVE");

297 
IssueCommªd
(
gFd2
, "getseq†ockfile");

298 
IssueCommªd
(
gFd2
, "close†ockfile");

299 
IssueCommªd
(
gFd2
, "open†ockfile flags=READ|WRITE|LOCK_SHARED");

300 
IssueCommªd
(
gFd3
, "open†ockfile flags=READ|WRITE|LOCK_SHARED");

301 
IssueCommªd
(
gFd2
, "getseq†ockfile");

302 
IssueCommªd
(
gFd2
, "close†ockfile");

303 
IssueCommªd
(
gFd3
, "close†ockfile");

304 
IssueCommªd
(
gFd1
, "close†ockfile");

305 
IssueCommªd
(
gFd1
, "delete†ockfile");

308 
Ephem”®FeTe¡
() {

309 
OuutTe¡H—d”
("<< EphemeralFileTest >>");

310 
IssueCommªd
(
gFd1
, "mkdir dir1");

311 
IssueCommªd
(
gFd1
, "open dir1 flags=READ|CREATE|WRITEƒvent-mask=ATTR_SET|ATTR_DEL|CHILD_NODE_ADDED|CHILD_NODE_REMOVED|LOCK_ACQUIRED|LOCK_RELEASED");

312 
IssueCommªd
(
gFd2
, "open dir1/foo flags=READ|CREATE|WRITE|TEMP");

313 
IssueCommªd
(
gFd2
, "close dir1/foo");

314 
IssueCommªd
(
gFd1
, "close dir1");

315 
IssueCommªd
(
gFd1
, "delete dir1");

318 
SessiÚExpœ©iÚTe¡
() {

319 
OuutTe¡H—d”
("<< SessionExpirationTest >>");

320 
IssueCommªd
(
gFd1
, "mkdir dir1");

321 
IssueCommªd
(
gFd1
, "open dir1 flags=READ|CREATE|WRITEƒvent-mask=ATTR_SET|ATTR_DEL|CHILD_NODE_ADDED|CHILD_NODE_REMOVED|LOCK_ACQUIRED|LOCK_RELEASED");

322 
IssueCommªd
(
gFd2
, "open dir1/foo flags=READ|CREATE|WRITE|TEMP");

323 
IssueCommªd
(
gFd2
, "open dir1 flags=READ|WRITE|LOCK");

324 
IssueCommªd
(
gFd2
, "lock dir1 EXCLUSIVE");

325 ià(
kl
(
gPid2
, 
SIGSTOP
) == -1)

326 
³¼Ü
("kill");

327 
pŞl
(0, 0, 9000);

329 
IssueCommªd
(
gFd1
, "close dir1");

330 
IssueCommªd
(
gFd1
, "delete dir1");

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hypertable/hypertable.cc

21 
	~<c¡dlib
>

22 
	~<c¡ršg
>

23 
	~<io¡»am
>

24 
	~<queue
>

27 
	~<lim™s.h
>

28 
	~<pŞl.h
>

29 
	~<»adlše/»adlše.h
>

30 
	~<»adlše/hi¡Üy.h
>

31 
	~<sigÇl.h
>

34 
	~<boo¡/®gÜ™hm/¡ršg.hµ
>

35 
	~<boo¡/®gÜ™hm/¡ršg/şassifiÿtiÚ.hµ
>

36 
	~<boo¡/th»ad/exû±iÚs.hµ
>

38 
	~"CommÚ/FeUts.h
"

39 
	~"CommÚ/Prİ”t›s.h
"

40 
	~"CommÚ/Sy¡em.h
"

41 
	~"CommÚ/U§ge.h
"

43 
	~"Hy³¹abË/Lib/Cl›Á.h
"

44 
	~"Hy³¹abË/Lib/HqlCommªdIÁ”´‘”.h
"

46 
usšg
 
Çme¥aû
 
Hy³¹abË
;

47 
usšg
 
Çme¥aû
 
	g¡d
;

49 
	gÇme¥aû
 {

51 
¡ršg
 
	gg_accum
;

52 
boŞ
 
	gg_b©ch_mode
 = 
çl£
;

53 
boŞ
 
	gg_no_´om±
 = 
çl£
;

54 
boŞ
 
	gg_cÚt
 = 
çl£
;

55 *
	glše_»ad
 = 0;

56 
	g¡d
::
¡ršg
 
gIÅutSŒ
;

57 
	g¡d
::
¡ršg
 
g_hi¡Üy_fe
;

59 *
¾_g‘s
 () {

61 ià(
	glše_»ad
) {

62 
ä“
 (
lše_»ad
);

63 
	glše_»ad
 = (*)
NULL
;

67 ià(
	gg_b©ch_mode
 || 
	gg_no_´om±
) {

68 ià(!
g‘lše
(
cš
, 
gIÅutSŒ
))

70 
	gboo¡
::
Œim
(
gIÅutSŒ
);

71 ià(
	ggIÅutSŒ
.
fšd
("quit", 0) != 0)

72 
cout
 << 
gIÅutSŒ
 << 
’dl
;

73  (*)
	ggIÅutSŒ
.
c_¡r
();

75 ià(!
	gg_cÚt
)

76 
	glše_»ad
 = 
»adlše
("hypertable> ");

78 
	glše_»ad
 = 
»adlše
(" -> ");

81 ià(!
	gg_b©ch_mode
 && 
	glše_»ad
 && *line_read)

82 
add_hi¡Üy
 (
lše_»ad
);

84  
	glše_»ad
;

87 
‹rmš©iÚ_hªdËr
 (
signum
) {

88 
wr™e_hi¡Üy
(
g_hi¡Üy_fe
.
c_¡r
());

89 
ex™
(1);

92 cÚ¡ *
	gu§ge
[] = {

118 cÚ¡ *
	gh–p_‹xt
 =

135 
	$maš
(
¬gc
, **
¬gv
) {

136 cÚ¡ *
lše
;

137 
¡ršg
 
cÚfigFe
 = "";

138 
Cl›Á
 *
hy³¹abË
;

139 
queue
<
¡ršg
> 
commªd_queue
;

140 
¡d
::
¡ršg
 
commªd
;

141 
¡d
::
¡ršg
 
time¡amp_fÜm©
;

142 
¡d
::
¡ršg
 
sourû_commªds
;

143 cÚ¡ *
ba£
, *
±r
;

144 
HqlCommªdIÁ”´‘”
 *
š‹½
;

146 
g_hi¡Üy_fe
 = (
¡d
::
¡ršg
)
	`g‘’v
("HOME") + "/.hypertable_history";

148 
i
=1; i<
¬gc
; i++) {

149 ià(!
	`¡rcmp
(
¬gv
[
i
], "--batch") || !strcmp(argv[i], "-B"))

150 
g_b©ch_mode
 = 
Œue
;

151 ià(!
	`¡ºcmp
(
¬gv
[
i
], "--config=", 9))

152 
cÚfigFe
 = &
¬gv
[
i
][9];

153 ià(!
	`¡rcmp
(
¬gv
[
i
], "--no-prompt"))

154 
g_no_´om±
 = 
Œue
;

155 ià(!
	`¡ºcmp
(
¬gv
[
i
], "--timestamp-format=", 19)) {

156 
time¡amp_fÜm©
 = &
¬gv
[
i
][19];

157 
boo¡
::
	`Œim_if
(
time¡amp_fÜm©
, boo¡::
	`is_ªy_of
("'\""));

160 
U§ge
::
	`dump_ªd_ex™
(
u§ge
);

163 
Sy¡em
::
	`š™Ÿlize
(
¬gv
[0]);

164 
R—ùÜFaùÜy
::
	`š™Ÿlize
((
ušt16_t
)
Sy¡em
::
	`g‘_´oûssÜ_couÁ
());

166 ià(
cÚfigFe
 == "")

167 
cÚfigFe
 = 
Sy¡em
::
š¡®lDœ
 + "/conf/hypertable.cfg";

169 
hy³¹abË
 = 
Ãw
 
	`Cl›Á
(
¬gv
[0], 
cÚfigFe
);

171 
š‹½
 = 
hy³¹abË
->
	`ü—‹_hql_š‹½»‹r
();

173 ià(
time¡amp_fÜm©
 != "")

174 
š‹½
->
	`£t_time¡amp_ouut_fÜm©
(
time¡amp_fÜm©
);

176 ià(!
g_b©ch_mode
) {

178 
	`»ad_hi¡Üy
(
g_hi¡Üy_fe
.
	`c_¡r
());

180 
cout
 << "W–comtØthHQL commªd iÁ”´‘”." << 
’dl
;

181 
cout
 << 
’dl
;

182 
cout
 << "Ty³ 'h–p;' o¸'\\h' fÜ h–p. Ty³ '\\c'Øş—¸thbufãr." << 
’dl
;

183 
cout
 << 
’dl
 << 
æush
;

186 ià(
	`sigÇl
 (
SIGINT
, 
‹rmš©iÚ_hªdËr
è=ğ
SIG_IGN
)

187 
	`sigÇl
 (
SIGINT
, 
SIG_IGN
);

188 ià(
	`sigÇl
 (
SIGHUP
, 
‹rmš©iÚ_hªdËr
è=ğ
SIG_IGN
)

189 
	`sigÇl
 (
SIGHUP
, 
SIG_IGN
);

190 ià(
	`sigÇl
 (
SIGTERM
, 
‹rmš©iÚ_hªdËr
è=ğ
SIG_IGN
)

191 
	`sigÇl
 (
SIGTERM
, 
SIG_IGN
);

193 
g_accum
 = "";

194 ià(!
g_b©ch_mode
)

195 
	`usšg_hi¡Üy
();

196 (
lše
 = 
	`¾_g‘s
()) != 0) {

198 
Œy
 {

200 ià(*
lše
 == 0)

203 ià(!
	`¡ºÿ£cmp
(
lše
, "h–p", 4è|| !
	`¡ºcmp
(line, "\\h", 2) || *line == '?') {

204 
commªd
 = 
lše
;

205 
¡d
::
	`ŒªsfÜm
Ğ
commªd
.
	`begš
(), commªd.
	`’d
(), commªd.begš(), ::
tŞow”
 );

206 
	`Œim_if
(
commªd
, 
boo¡
::
	`is_ªy_of
(" \t\n\r;"));

207 ià(
commªd
 == "help" || command == "\\h" || command == "?")

208 
cout
 << 
h–p_‹xt
;

209 
š‹½
->
	`execu‹_lše
(
commªd
);

212 ià(!
	`¡rÿ£cmp
(
lše
, "qu™"è|| !¡rÿ£cmpÖše, "ex™"è|| !
	`¡rcmp
(line, "\\q")) {

213 ià(!
g_b©ch_mode
)

214 
	`wr™e_hi¡Üy
(
g_hi¡Üy_fe
.
	`c_¡r
());

217 ià(!
	`¡rÿ£cmp
(
lše
, "´št"è|| !
	`¡rcmp
(line, "\\p")) {

218 
cout
 << 
g_accum
 << 
’dl
;

221 ià(!
	`¡rÿ£cmp
(
lše
, "ş—r"è|| !
	`¡rcmp
(line, "\\c")) {

222 
g_accum
 = "";

223 
g_cÚt
 = 
çl£
;

226 ià(!
	`¡ºcmp
(
lše
, "source", 6) ||†ine[0] == '.') {

227 ià((
ba£
 = 
	`¡rchr
(
lše
, ' ')) == 0) {

228 
cout
 << "syÁaxƒ¼Ü: sourû o¸'.' mu¡ bfŞlowed by‡ s·û ch¬aù”" << 
’dl
;

231 
¡d
::
¡ršg
 
âame
 = 
ba£
;

232 
	`Œim_if
(
âame
, 
boo¡
::
	`is_ªy_of
(" \t\n\r;"));

233 
off_t
 
æ’
;

234 ià((
ba£
 = 
FeUts
::
	`fe_to_bufãr
(
âame
.
	`c_¡r
(), &
æ’
)) == 0)

236 
sourû_commªds
 = "";

237 
±r
 = 
	`¡¹ok
((*)
ba£
, "\n\r");

238 
±r
 != 0) {

239 
commªd
 = 
±r
;

240 
boo¡
::
	`Œim
(
commªd
);

241 ià(
commªd
.
	`fšd
("#") != 0)

242 
sourû_commªds
 +ğ
commªd
 + " ";

243 
±r
 = 
	`¡¹ok
(0, "\n\r");

245 ià(
sourû_commªds
 == "")

247 
d–‘e
 [] 
ba£
;

248 
lše
 = 
sourû_commªds
.
	`c_¡r
();

250 ià(!
	`¡ºÿ£cmp
(
lše
, "sy¡em", 6è|| !
	`¡ºcmp
(line, "\\!", 2)) {

251 
¡d
::
¡ršg
 
commªd
 = 
lše
;

252 
size_t
 
off£t
 = 
commªd
.
	`fšd_fœ¡_of
(' ');

253 ià(
off£t
 !ğ
¡d
::
¡ršg
::
Åos
) {

254 
commªd
 = commªd.
	`sub¡r
(
off£t
+1);

255 
	`Œim_if
(
commªd
, 
boo¡
::
	`is_ªy_of
(" \t\n\r;"));

256 
	`sy¡em
(
commªd
.
	`c_¡r
());

260 ià(!
	`¡rÿ£cmp
(
lše
, "¡©us"è|| !
	`¡rcmp
(line, "\\s")) {

261 
cout
 << 
’dl
 << "no status." <<ƒndl <<ƒndl;

269 
ba£
 = 
lše
;

270 
±r
 = 
	`¡rchr
(
ba£
, ';');

271 
±r
) {

272 
g_accum
 +ğ
	`¡ršg
(
ba£
, 
±r
-base);

273 ià(
g_accum
.
	`size
() > 0) {

274 
boo¡
::
	`Œim
(
g_accum
);

275 ià(
g_accum
.
	`fšd
("#") != 0)

276 
commªd_queue
.
	`push
(
g_accum
);

277 
g_accum
 = "";

278 
g_cÚt
 = 
çl£
;

280 
ba£
 = 
±r
+1;

281 
±r
 = 
	`¡rchr
(
ba£
, ';');

283 
commªd
 = 
	`¡ršg
(
ba£
);

284 
boo¡
::
	`Œim
(
commªd
);

285 ià(
commªd
 !ğ"" && commªd.
	`fšd
("#") != 0) {

286 
g_accum
 +ğ
commªd
;

287 
boo¡
::
	`Œim
(
g_accum
);

289 ià(
g_accum
 != "") {

290 
g_cÚt
 = 
Œue
;

291 
g_accum
 += " ";

294 !
commªd_queue
.
	`em±y
()) {

295 ià(
commªd_queue
.
	`äÚt
() == "quit" || command_queue.front() == "exit") {

296 ià(!
g_b©ch_mode
)

297 
	`wr™e_hi¡Üy
(
g_hi¡Üy_fe
.
	`c_¡r
());

300 
commªd
 = 
commªd_queue
.
	`äÚt
();

301 
commªd_queue
.
	`pİ
();

302 ià(!
	`¡ºcmp
(
commªd
.
	`c_¡r
(), "pause", 5)) {

303 
¡d
::
¡ršg
 
£c_¡r
 = 
commªd
.
	`sub¡r
(5);

304 
boo¡
::
	`Œim
(
£c_¡r
);

305 *
’d±r
;

306 
£cs
 = 
	`¡¹Ş
(
£c_¡r
.
	`c_¡r
(), &
’d±r
, 0);

307 ià(
£cs
 =ğ0 && 
”ºo
 =ğ
EINVAL
 || *
’d±r
 != 0) {

308 
cout
 << "”rÜ: inv®id secÚd ¥ecifiÿtiÚ" << 
’dl
;

309 ià(
g_b©ch_mode
)

313 
	`pŞl
(0, 0, 
£cs
*1000);

316 
š‹½
->
	`execu‹_lše
(
commªd
);

320 
	`ÿtch
 (
Hy³¹abË
::
Exû±iÚ
 &
e
) {

321 
û¼
 << "E¼Ü: " << 
e
.
	`wh©
(è<< " - " << 
E¼Ü
::
	`g‘_‹xt
Ó.
	`code
()è<< 
’dl
;

322 ià(
g_b©ch_mode
)

324 
g_accum
 = "";

325 !
commªd_queue
.
	`em±y
())

326 
commªd_queue
.
	`pİ
();

327 
g_cÚt
=
çl£
;

332 ià(!
g_b©ch_mode
)

333 
	`wr™e_hi¡Üy
(
g_hi¡Üy_fe
.
	`c_¡r
());

335 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hypertable/test/hypertable_test.cc

21 
	~<c¡dlib
>

22 
	~<io¡»am
>

23 
	~<¡ršg
>

26 
	~<sys/ty³s.h
>

27 
	~<uni¡d.h
>

30 
	~"CommÚ/FeUts.h
"

31 
	~"CommÚ/Logg”.h
"

32 
	~"CommÚ/Sy¡em.h
"

34 
usšg
 
Çme¥aû
 
Hy³¹abË
;

35 
usšg
 
Çme¥aû
 
	g¡d
;

38 
	gÇme¥aû
 {

39 cÚ¡ *
	g»quœedFes
[] = {

48 
	$maš
(
¬gc
, **
¬gv
) {

49 
¡d
::
¡ršg
 
commªdSŒ
;

51 
Sy¡em
::
	`š™Ÿlize
(
¬gv
[0]);

53 
i
=0; 
»quœedFes
[i]; i++) {

54 ià(!
FeUts
::
	`exi¡s
(
»quœedFes
[
i
])) {

55 
	`HT_ERRORF
("UÇbËØfšd '%s'", 
»quœedFes
[
i
]);

63 
commªdSŒ
 = (
¡d
::
¡ršg
)"./hypertable --no-prompt --config=hypertable.cfg < hypertable_test.hql > hypertable_test.output 2>&1";

64 ià(
	`sy¡em
(
commªdSŒ
.
	`c_¡r
()) != 0)

67 
commªdSŒ
 = (
¡d
::
¡ršg
)"diff hypertable_test.output hypertable_test.golden";

68 ià(
	`sy¡em
(
commªdSŒ
.
	`c_¡r
()) != 0)

72 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/merge_diff/merge_diff.cc

21 
	~<f¡»am
>

22 
	~<io¡»am
>

23 
	~<¡ršg
>

25 
	~"CommÚ/Sy¡em.h
"

26 
	~"CommÚ/U§ge.h
"

28 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

29 
usšg
 
Çme¥aû
 
	g¡d
;

31 
	gÇme¥aû
 {

33 cÚ¡ *
	gu§ge
[] = {

56 
	$maš
(
¬gc
, **
¬gv
) {

57 cÚ¡ *
fe_a
=0, *
fe_b
=0;

58 
boŞ
 
v”ify
=
çl£
;

59 
¡d
::
if¡»am
 
š_a
;

60 
¡d
::
if¡»am
 
š_b
;

61 
¡ršg
 
lše_a
, 
lše_b
;

62 
¡©e
 = 0;

63 
cmpv®
;

64 
boŞ
 
a_ÿched
 = 
çl£
;

65 
boŞ
 
b_ÿched
 = 
çl£
;

67 
Sy¡em
::
	`š™Ÿlize
(
¬gv
[0]);

69 
i
=1; i<
¬gc
; i++) {

70 ià(!
	`¡rcmp
(
¬gv
[
i
], "--verify"))

71 
v”ify
 = 
Œue
;

72 ià(
¬gv
[
i
][0] == '-')

73 
U§ge
::
	`dump_ªd_ex™
(
u§ge
);

74 ià(
fe_a
 == 0)

75 
fe_a
 = 
¬gv
[
i
];

76 ià(
fe_b
 == 0)

77 
fe_b
 = 
¬gv
[
i
];

79 
U§ge
::
	`dump_ªd_ex™
(
u§ge
);

82 ià(
fe_b
 == 0)

83 
U§ge
::
	`dump_ªd_ex™
(
u§ge
);

85 
š_a
.
	`İ’
(
fe_a
, 
if¡»am
::
š
);

86 
š_b
.
	`İ’
(
fe_b
, 
if¡»am
::
š
);

88 
š_a
.
	`good
()) {

90 ià(!
š_b
.
	`good
()) {

91 ià(
¡©e
 == 2)

92 
cout
 << "---" << 
’dl
;

93 ià(
a_ÿched
) {

94 
cout
 << "< " << 
lše_a
 << 
’dl
;

95 
a_ÿched
 = 
çl£
;

97 
š_a
.
	`good
()) {

98 ià(
	`g‘lše
(
š_a
, 
lše_a
))

99 
cout
 << "< " << 
lše_a
 << 
’dl
;

104 ià(!
a_ÿched
 && !
	`g‘lše
(
š_a
, 
lše_a
))

107 ià(!
b_ÿched
 && !
	`g‘lše
(
š_b
, 
lše_b
)) {

108 
a_ÿched
 = 
Œue
;

112 ià((
cmpv®
 = 
	`¡rcmp
(
lše_a
.
	`c_¡r
(), 
lše_b
.c_str())) < 0) {

113 
a_ÿched
 = 
çl£
;

114 
b_ÿched
 = 
Œue
;

115 ià(
¡©e
 == 2)

116 
cout
 << "---" << 
’dl
;

117 
¡©e
 = 1;

118 
cout
 << "< " << 
lše_a
 << 
’dl
;

120 ià(
cmpv®
 > 0) {

121 
a_ÿched
 = 
Œue
;

122 
b_ÿched
 = 
çl£
;

123 ià(
¡©e
 == 1)

124 
cout
 << "---" << 
’dl
;

125 
¡©e
 = 2;

126 
cout
 << "> " << 
lše_b
 << 
’dl
;

129 
a_ÿched
 = 
b_ÿched
 = 
çl£
;

133 ià(
š_b
.
	`good
()) {

134 ià(
¡©e
 == 1)

135 
cout
 << "---" << 
’dl
;

136 ià(
b_ÿched
) {

137 
cout
 << "> " << 
lše_b
 << 
’dl
;

138 
b_ÿched
 = 
çl£
;

140 
š_b
.
	`good
()) {

141 ià(
	`g‘lše
(
š_b
, 
lše_b
))

142 
cout
 << "> " << 
lše_b
 << 
’dl
;

146 
š_a
.
	`şo£
();

147 
š_b
.
	`şo£
();

150 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/rsclient/CommandCreateScanner.cc

21 
	~<cùy³
>

22 
	~<c¡dlib
>

23 
	~<c¡ršg
>

24 
	~<io¡»am
>

27 
	~<»gex.h
>

30 
	~"AsyncComm/Di¥©chHªdËrSynchrÚiz”.h
"

31 
	~"AsyncComm/Ev’t.h
"

33 
	~"CommÚ/E¼Ü.h
"

34 
	~"CommÚ/U§ge.h
"

36 
	~"Hy³¹abË/Lib/SÿnBlock.h
"

38 
	~"CommªdC»©eSÿÂ”.h
"

39 
	~"Di¥ÏySÿnD©a.h
"

40 
	~"P¬£RªgeS³c.h
"

42 
usšg
 
Çme¥aû
 
Hy³¹abË
;

43 
usšg
 
Çme¥aû
 
	g¡d
;

45 cÚ¡ *
	gCommªdC»©eSÿÂ”
::
ms_u§ge
[] = {

63 
št32_t
 
	gCommªdC»©eSÿÂ”
::
ms_sÿÂ”_id
 = -1;

64 
TabËInfo
 *
	gCommªdC»©eSÿÂ”
::
ms_bË_šfo
 = 0;

65 
boŞ
 
	gCommªdC»©eSÿÂ”
::
ms_di¥Ïy_v®ues
 = 
çl£
;

67 
	gCommªdC»©eSÿÂ”
::
	$run
() {

68 
”rÜ
;

69 
¡d
::
¡ršg
 
bËName
;

70 
¡d
::
¡ršg
 
¡¬tRow
;

71 
¡d
::
¡ršg
 
’dRow
;

72 
RªgeT
 
¿nge
;

73 
SÿnS³cifiÿtiÚT
 
sÿn_¥ec
;

74 *
Ï¡
;

75 cÚ¡ *
cŞumnSŒ
;

76 
SÿnBlock
 
sÿnblock
;

77 
SchemaPŒ
 
schema_±r
;

78 
TabËId’tif›rT
 *
bË
;

80 ià(
m_¬gs
.
	`size
() == 0) {

81 
û¼
 << "WrÚg‚umb” oà¬gum’ts. Ty³ 'h–p' fÜ u§ge." << 
’dl
;

85 ià(
m_¬gs
[0].
£cÚd
 !ğ"" || !
	`P¬£RªgeS³c
(m_¬gs[0].
fœ¡
, 
bËName
, 
¡¬tRow
, 
’dRow
)) {

86 
û¼
 << "Inv®id„ªg¥ecifiÿtiÚ." << 
’dl
;

90 
ms_bË_šfo
 = 
TabËInfo
::
m­
[
bËName
];

92 ià(
ms_bË_šfo
 == 0) {

93 
ms_bË_šfo
 = 
Ãw
 
	`TabËInfo
(
bËName
);

94 ià((
”rÜ
 = 
ms_bË_šfo
->
	`lßd
(
m_hy³r¥aû_±r
)è!ğ
E¼Ü
::
OK
)

95  
”rÜ
;

96 
TabËInfo
::
m­
[
bËName
] = 
ms_bË_šfo
;

99 
bË
 = 
ms_bË_šfo
->
	`g‘_bË_id’tif›r
();

100 
ms_bË_šfo
->
	`g‘_schema_±r
(
schema_±r
);

110 
¿nge
.
¡¬tRow
 = s¹Row.
	`c_¡r
();

111 
¿nge
.
’dRow
 =ƒndRow.
	`c_¡r
();

116 
sÿn_¥ec
.
rowLim™
 = 0;

117 
sÿn_¥ec
.
max_v”siÚs
 = 0;

118 
sÿn_¥ec
.
cŞumns
.
	`ş—r
();

119 
sÿn_¥ec
.
¡¬tRow
 = 0;

120 
sÿn_¥ec
.
¡¬tRowInşusive
 = 
Œue
;

121 
sÿn_¥ec
.
’dRow
 = 0;

122 
sÿn_¥ec
.
’dRowInşusive
 = 
Œue
;

123 
sÿn_¥ec
.
š‹rv®
.
fœ¡
 = 0;

124 
sÿn_¥ec
.
š‹rv®
.
£cÚd
 = 0;

125 
sÿn_¥ec
.
»tuº_d–‘es
 = 
çl£
;

127 
size_t
 
i
=1; i<
m_¬gs
.
	`size
(); i++) {

128 ià(
m_¬gs
[
i
].
£cÚd
 == "") {

129 
û¼
 << "NØv®usuµl›d fÜ '" << 
m_¬gs
[
i
].
fœ¡
 << "'" << 
’dl
;

132 ià(
m_¬gs
[
i
].
fœ¡
 == "row-limit")

133 
sÿn_¥ec
.
rowLim™
 = 
	`©oi
(
m_¬gs
[
i
].
£cÚd
.
	`c_¡r
());

134 ià(
m_¬gs
[
i
].
fœ¡
 == "max-versions")

135 
sÿn_¥ec
.
max_v”siÚs
 = 
	`©oi
(
m_¬gs
[
i
].
£cÚd
.
	`c_¡r
());

136 ià(
m_¬gs
[
i
].
fœ¡
 == "start")

137 
sÿn_¥ec
.
¡¬tRow
 = 
m_¬gs
[
i
].
£cÚd
.
	`c_¡r
();

138 ià(
m_¬gs
[
i
].
fœ¡
 == "end")

139 
sÿn_¥ec
.
’dRow
 = 
m_¬gs
[
i
].
£cÚd
.
	`c_¡r
();

140 ià(
m_¬gs
[
i
].
fœ¡
 == "row-range") {

141 ià(!
	`decode_row_¿nge_¥ec
(
m_¬gs
[
i
].
£cÚd
, 
sÿn_¥ec
))

144 ià(
m_¬gs
[
i
].
fœ¡
 == "start-time")

145 
sÿn_¥ec
.
š‹rv®
.
fœ¡
 = 
	`¡¹Şl
(
m_¬gs
[
i
].
£cÚd
.
	`c_¡r
(), 0, 10);

146 ià(
m_¬gs
[
i
].
fœ¡
 == "end-time")

147 
sÿn_¥ec
.
š‹rv®
.
£cÚd
 = 
	`¡¹Şl
(
m_¬gs
[
i
].£cÚd.
	`c_¡r
(), 0, 10);

148 ià(
m_¬gs
[
i
].
fœ¡
 == "display-values")

149 
ms_di¥Ïy_v®ues
 = 
Œue
;

150 ià(
m_¬gs
[
i
].
fœ¡
 == "columns") {

151 
cŞumnSŒ
 = 
	`¡¹ok_r
((*)
m_¬gs
[
i
].
£cÚd
.
	`c_¡r
(), ",", &
Ï¡
);

152 
cŞumnSŒ
) {

153 
sÿn_¥ec
.
cŞumns
.
	`push_back
(
cŞumnSŒ
);

154 
cŞumnSŒ
 = 
	`¡¹ok_r
(0, ",", &
Ï¡
);

162 ià((
”rÜ
 = 
m_¿nge_£rv”_±r
->
	`ü—‹_sÿÂ”
(
m_addr
, *
bË
, 
¿nge
, 
sÿn_¥ec
, 
sÿnblock
)è!ğ
E¼Ü
::
OK
)

163  
”rÜ
;

165 
ms_sÿÂ”_id
 = 
sÿnblock
.
	`g‘_sÿÂ”_id
();

167 cÚ¡ 
By‹SŒšg32T
 *
key
, *
v®ue
;

169 
sÿnblock
.
	`Ãxt
(
key
, 
v®ue
))

170 
	`Di¥ÏySÿnD©a
(
key
, 
v®ue
, 
schema_±r
, 
ms_di¥Ïy_v®ues
);

172 ià(
sÿnblock
.
	`eos
())

173 
ms_sÿÂ”_id
 = -1;

175  
E¼Ü
::
OK
;

176 
	}
}

182 
boŞ
 
	gCommªdC»©eSÿÂ”
::
decode_row_¿nge_¥ec
(
¡d
::
¡ršg
 &
¥ecSŒ
, 
SÿnS³cifiÿtiÚT
 &
sÿn_¥ec
) {

183 
»gex_t
 
	g»g
;

184 
»gm©ch_t
 
	gpm©ch
[5];

185 
	g”rÜ
;

186 
	g”rBuf
[256];

187 *
	gba£
 = (*)
¥ecSŒ
.
c_¡r
();

189 
	g”rBuf
[0] = 0;

191 
	g”rÜ
 = 
»gcomp
(&
»g
, "\\([([]\\)\\([^,]*\\),\\([^)]*\\)\\([])]\\)", 0);

192 ià(
	g”rÜ
 != 0) {

193 
»g”rÜ
(
”rÜ
, &
»g
, 
”rBuf
, 256);

194 
	gabÜt
;

197 
	g”rÜ
 = 
»gexec
(&
»g
, 
ba£
, 5, 
pm©ch
, 0);

198 ià(
	g”rÜ
 != 0) {

199 
»g”rÜ
(
”rÜ
, &
»g
, 
”rBuf
, 256);

200 
	gabÜt
;

203 
size_t
 
	gi
=0; i<5; i++) {

204 ià(
	gpm©ch
[
i
].
	grm_so
 == -1)

205 
abÜt
;

208 ià(
	gba£
[
pm©ch
[1].
	grm_so
] == '(')

209 
sÿn_¥ec
.
¡¬tRowInşusive
 = 
çl£
;

211 
	gsÿn_¥ec
.
	g¡¬tRowInşusive
 = 
Œue
;

213 ià(
	gba£
[
pm©ch
[4].
	grm_so
] == ')')

214 
sÿn_¥ec
.
’dRowInşusive
 = 
çl£
;

216 
	gsÿn_¥ec
.
	g’dRowInşusive
 = 
Œue
;

221 
	gpm©ch
[2].
	grm_so
 <…m©ch[2].
	grm_eo
 && 
is¥aû
(
ba£
[
pm©ch
[2].
rm_so
]))

222 
	gpm©ch
[2].
	grm_so
++;

224 
	gpm©ch
[2].
	grm_so
 <…m©ch[2].
	grm_eo
 && 
is¥aû
(
ba£
[
pm©ch
[2].
rm_eo
-1]))

225 
	gpm©ch
[2].
	grm_eo
--;

227 ià(
	gpm©ch
[2].
	grm_so
 <…m©ch[2].
	grm_eo
) {

228 
	gsÿn_¥ec
.
	g¡¬tRow
 = &
ba£
[
pm©ch
[2].
rm_so
];

229 
	gba£
[
pm©ch
[2].
	grm_eo
] = 0;

232 
	gsÿn_¥ec
.
	g¡¬tRow
 = 0;

237 
	gpm©ch
[3].
	grm_so
 <…m©ch[3].
	grm_eo
 && 
is¥aû
(
ba£
[
pm©ch
[3].
rm_so
]))

238 
	gpm©ch
[3].
	grm_so
++;

240 
	gpm©ch
[3].
	grm_so
 <…m©ch[3].
	grm_eo
 && 
is¥aû
(
ba£
[
pm©ch
[3].
rm_eo
-1]))

241 
	gpm©ch
[3].
	grm_eo
--;

243 ià(
	gpm©ch
[3].
	grm_so
 <…m©ch[3].
	grm_eo
) {

244 
	gsÿn_¥ec
.
	g’dRow
 = &
ba£
[
pm©ch
[3].
rm_so
];

245 
	gba£
[
pm©ch
[3].
	grm_eo
] = 0;

248 
	gsÿn_¥ec
.
	g’dRow
 = 0;

250 
»gä“
(&
»g
);

252  
	gŒue
;

254 
	gabÜt
:

255 ià(
”rBuf
[0] == 0)

256 
û¼
 << "Inv®id„ow„ªg¥ecifiÿtiÚ." << 
’dl
;

258 
	gû¼
 << "»gex: " << 
	g”rBuf
 << 
	g’dl
;

259  
	gçl£
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/rsclient/CommandCreateScanner.h

21 #iâdeà
HYPERTABLE_COMMANDCREATESCANNER_H


22 
	#HYPERTABLE_COMMANDCREATESCANNER_H


	)

24 
	~"CommÚ/IÁ”aùiveCommªd.h
"

26 
	~"Hy³¹abË/Lib/Ma¡”Cl›Á.h
"

27 
	~"Hy³¹abË/Lib/RªgeS”v”Cl›Á.h
"

28 
	~"Hy³¹abË/Lib/Schema.h
"

30 
	~"Hy³r¥aû/SessiÚ.h
"

32 
	~"TabËInfo.h
"

34 
Çme¥aû
 
	gHy³¹abË
 {

36 şas 
	cCommªdC»©eSÿÂ”
 : 
public
 
IÁ”aùiveCommªd
 {

37 
public
:

38 
CommªdC»©eSÿÂ”
(
sockaddr_š
 &
addr
, 
RªgeS”v”Cl›ÁPŒ
 &
¿nge_£rv”_±r
, 
Hy³r¥aû
::
SessiÚPŒ
 &
hy³r¥aû_±r
è: 
m_addr
×ddr), 
m_¿nge_£rv”_±r
Ôªge_£rv”_±r), 
m_hy³r¥aû_±r
(hyperspace_ptr) { ; }

39 
vœtu®
 cÚ¡ *
commªd_‹xt
() {  "create scanner"; }

40 
vœtu®
 cÚ¡ **
u§ge
(è{  
	gms_u§ge
; }

41 
vœtu®
 
run
();

43 
št32_t
 
	gms_sÿÂ”_id
;

44 
TabËInfo
 *
	gms_bË_šfo
;

45 
boŞ
 
	gms_di¥Ïy_v®ues
;

47 
	g´iv©e
:

49 
boŞ
 
decode_row_¿nge_¥ec
(
¡d
::
¡ršg
 &
¥ecSŒ
, 
SÿnS³cifiÿtiÚT
 &
sÿnS³c
);

51 cÚ¡ *
	gms_u§ge
[];

53 
sockaddr_š
 
	gm_addr
;

54 
RªgeS”v”Cl›ÁPŒ
 
	gm_¿nge_£rv”_±r
;

55 
	gHy³r¥aû
::
SessiÚPŒ
 
m_hy³r¥aû_±r
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/rsclient/CommandDestroyScanner.cc

21 
	~<c¡dlib
>

22 
	~<c¡ršg
>

23 
	~<io¡»am
>

25 
	~"AsyncComm/Di¥©chHªdËrSynchrÚiz”.h
"

26 
	~"AsyncComm/Ev’t.h
"

28 
	~"CommÚ/E¼Ü.h
"

29 
	~"CommÚ/U§ge.h
"

31 
	~"Hy³¹abË/Lib/SÿnBlock.h
"

33 
	~"CommªdC»©eSÿÂ”.h
"

34 
	~"CommªdDe¡roySÿÂ”.h
"

35 
	~"Di¥ÏySÿnD©a.h
"

36 
	~"P¬£RªgeS³c.h
"

38 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

39 
usšg
 
Çme¥aû
 
	g¡d
;

41 cÚ¡ *
	gCommªdDe¡roySÿÂ”
::
ms_u§ge
[] = {

52 
	gCommªdDe¡roySÿÂ”
::
	$run
() {

53 
št32_t
 
sÿÂ”Id
 = -1;

55 ià(
m_¬gs
.
	`size
() > 1) {

56 
û¼
 << "WrÚg‚umb” oà¬gum’ts. Ty³ 'h–p' fÜ u§ge." << 
’dl
;

60 ià(
CommªdC»©eSÿÂ”
::
ms_bË_šfo
 == 0) {

61 
û¼
 << "NØsÿÂ” infÜm©iÚ found, mu¡„uÀ\"ü—‹abË\" fœ¡" << 
’dl
;

65 ià(
m_¬gs
.
	`size
() > 0) {

66 ià(
m_¬gs
[0].
£cÚd
 != "") {

67 
û¼
 << "Inv®id sÿÂ” ID." << 
’dl
;

70 
sÿÂ”Id
 = 
	`©oi
(
m_¬gs
[0].
fœ¡
.
	`c_¡r
());

73 
sÿÂ”Id
 = 
CommªdC»©eSÿÂ”
::
ms_sÿÂ”_id
;

75  
m_¿nge_£rv”_±r
->
	`de¡roy_sÿÂ”
(
m_addr
, 
sÿÂ”Id
);

76 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/rsclient/CommandDestroyScanner.h

21 #iâdeà
HYPERTABLE_COMMANDDESTROYSCANNER_H


22 
	#HYPERTABLE_COMMANDDESTROYSCANNER_H


	)

24 
	~"CommÚ/IÁ”aùiveCommªd.h
"

26 
	~"Hy³¹abË/Lib/Ma¡”Cl›Á.h
"

27 
	~"Hy³¹abË/Lib/RªgeS”v”Cl›Á.h
"

29 
Çme¥aû
 
	gHy³¹abË
 {

31 şas 
	cCommªdDe¡roySÿÂ”
 : 
public
 
IÁ”aùiveCommªd
 {

32 
public
:

33 
CommªdDe¡roySÿÂ”
(
sockaddr_š
 &
addr
, 
RªgeS”v”Cl›ÁPŒ
 &
¿nge_£rv”_±r
è: 
m_addr
×ddr), 
m_¿nge_£rv”_±r
(range_server_ptr) { ; }

34 
vœtu®
 cÚ¡ *
commªd_‹xt
() {  "destroy scanner"; }

35 
vœtu®
 cÚ¡ **
u§ge
(è{  
	gms_u§ge
; }

36 
vœtu®
 
run
();

38 
	g´iv©e
:

39 cÚ¡ *
ms_u§ge
[];

41 
sockaddr_š
 
	gm_addr
;

42 
RªgeS”v”Cl›ÁPŒ
 
	gm_¿nge_£rv”_±r
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/rsclient/CommandFetchScanblock.cc

21 
	~<c¡dlib
>

22 
	~<c¡ršg
>

23 
	~<io¡»am
>

25 
	~"AsyncComm/Di¥©chHªdËrSynchrÚiz”.h
"

26 
	~"AsyncComm/Ev’t.h
"

28 
	~"CommÚ/E¼Ü.h
"

29 
	~"CommÚ/U§ge.h
"

31 
	~"Hy³¹abË/Lib/SÿnBlock.h
"

33 
	~"CommªdC»©eSÿÂ”.h
"

34 
	~"CommªdF‘chSÿnblock.h
"

35 
	~"Di¥ÏySÿnD©a.h
"

36 
	~"P¬£RªgeS³c.h
"

38 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

39 
usšg
 
Çme¥aû
 
	g¡d
;

41 cÚ¡ *
	gCommªdF‘chSÿnblock
::
ms_u§ge
[] = {

52 
	gCommªdF‘chSÿnblock
::
	$run
() {

53 
”rÜ
;

54 
SÿnBlock
 
sÿnblock
;

55 
št32_t
 
sÿÂ”Id
 = -1;

56 
SchemaPŒ
 
schema_±r
;

58 ià(
m_¬gs
.
	`size
() > 1) {

59 
û¼
 << "WrÚg‚umb” oà¬gum’ts. Ty³ 'h–p' fÜ u§ge." << 
’dl
;

63 ià(
CommªdC»©eSÿÂ”
::
ms_bË_šfo
 == 0) {

64 
û¼
 << "NØsÿÂ” infÜm©iÚ found, mu¡„uÀ\"ü—‹abË\" fœ¡" << 
’dl
;

68 ià(
m_¬gs
.
	`size
() > 0) {

69 ià(
m_¬gs
[0].
£cÚd
 != "") {

70 
û¼
 << "Inv®id sÿÂ” ID." << 
’dl
;

73 
sÿÂ”Id
 = 
	`©oi
(
m_¬gs
[0].
fœ¡
.
	`c_¡r
());

76 
sÿÂ”Id
 = 
CommªdC»©eSÿÂ”
::
ms_sÿÂ”_id
;

78 
CommªdC»©eSÿÂ”
::
ms_bË_šfo
->
	`g‘_schema_±r
(
schema_±r
);

83 ià((
”rÜ
 = 
m_¿nge_£rv”_±r
->
	`ãtch_sÿnblock
(
m_addr
, 
sÿÂ”Id
, 
sÿnblock
)è!ğ
E¼Ü
::
OK
)

84  
”rÜ
;

86 
CommªdC»©eSÿÂ”
::
ms_sÿÂ”_id
 = 
sÿnblock
.
	`g‘_sÿÂ”_id
();

88 cÚ¡ 
By‹SŒšg32T
 *
key
, *
v®ue
;

90 
sÿnblock
.
	`Ãxt
(
key
, 
v®ue
))

91 
	`Di¥ÏySÿnD©a
(
key
, 
v®ue
, 
schema_±r
, 
CommªdC»©eSÿÂ”
::
ms_di¥Ïy_v®ues
);

93 ià(
sÿnblock
.
	`eos
())

94 
CommªdC»©eSÿÂ”
::
ms_sÿÂ”_id
 = -1;

96  
E¼Ü
::
OK
;

97 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/rsclient/CommandFetchScanblock.h

21 #iâdeà
HYPERTABLE_COMMANDFETCHSCANBLOCK_H


22 
	#HYPERTABLE_COMMANDFETCHSCANBLOCK_H


	)

24 
	~"CommÚ/IÁ”aùiveCommªd.h
"

26 
	~"Hy³¹abË/Lib/Ma¡”Cl›Á.h
"

27 
	~"Hy³¹abË/Lib/RªgeS”v”Cl›Á.h
"

29 
Çme¥aû
 
	gHy³¹abË
 {

31 şas 
	cCommªdF‘chSÿnblock
 : 
public
 
IÁ”aùiveCommªd
 {

32 
public
:

33 
CommªdF‘chSÿnblock
(
sockaddr_š
 &
addr
, 
RªgeS”v”Cl›ÁPŒ
 &
¿nge_£rv”_±r
è: 
m_addr
×ddr), 
m_¿nge_£rv”_±r
(range_server_ptr) { ; }

34 
vœtu®
 cÚ¡ *
commªd_‹xt
() {  "fetch scanblock"; }

35 
vœtu®
 cÚ¡ **
u§ge
(è{  
	gms_u§ge
; }

36 
vœtu®
 
run
();

38 
	g´iv©e
:

39 cÚ¡ *
ms_u§ge
[];

41 
sockaddr_š
 
	gm_addr
;

42 
RªgeS”v”Cl›ÁPŒ
 
	gm_¿nge_£rv”_±r
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/rsclient/CommandLoadRange.cc

21 
	~<io¡»am
>

23 
	~"CommÚ/E¼Ü.h
"

24 
	~"CommÚ/U§ge.h
"

26 
	~"CommªdLßdRªge.h
"

27 
	~"P¬£RªgeS³c.h
"

28 
	~"TabËInfo.h
"

30 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

31 
usšg
 
Çme¥aû
 
	g¡d
;

33 cÚ¡ *
	gCommªdLßdRªge
::
ms_u§ge
[] = {

40 
	gCommªdLßdRªge
::
	$run
() {

41 
”rÜ
;

42 
¡d
::
¡ršg
 
bËName
;

43 
¡d
::
¡ršg
 
¡¬tRow
;

44 
¡d
::
¡ršg
 
’dRow
;

45 
TabËId’tif›rT
 *
bË
;

46 
RªgeT
 
¿nge
;

47 
TabËInfo
 *
bËInfo
;

49 ià(
m_¬gs
.
	`size
() != 1) {

50 
û¼
 << "WrÚg‚umb” oà¬gum’ts. Ty³ 'h–p' fÜ u§ge." << 
’dl
;

54 ià(
m_¬gs
[0].
£cÚd
 != "")

55 
U§ge
::
	`dump_ªd_ex™
(
ms_u§ge
);

57 ià(!
	`P¬£RªgeS³c
(
m_¬gs
[0].
fœ¡
, 
bËName
, 
¡¬tRow
, 
’dRow
)) {

58 
û¼
 << "”rÜ: Inv®id„ªg¥ecifiÿtiÚ." << 
’dl
;

61 
bËInfo
 = 
TabËInfo
::
m­
[
bËName
];

63 ià(
bËInfo
 == 0) {

64 
bËInfo
 = 
Ãw
 
	`TabËInfo
(
bËName
);

65 ià((
”rÜ
 = 
bËInfo
->
	`lßd
(
m_hy³r¥aû_±r
)è!ğ
E¼Ü
::
OK
)

66  
”rÜ
;

67 
TabËInfo
::
m­
[
bËName
] = 
bËInfo
;

69 
bË
 = 
bËInfo
->
	`g‘_bË_id’tif›r
();

71 
cout
 << "TabËNam = " << 
bËName
 << 
’dl
;

74 
cout
 << "S¹Row = " << 
¡¬tRow
 << 
’dl
;

75 
cout
 << "EndRow = " << 
’dRow
 << 
’dl
;

77 
¿nge
.
¡¬tRow
 = s¹Row.
	`c_¡r
();

78 
¿nge
.
’dRow
 =ƒndRow.
	`c_¡r
();

80 ià((
”rÜ
 = 
m_¿nge_£rv”_±r
->
	`lßd_¿nge
(
m_addr
, *
bË
, 
¿nge
, 200000000LL, 0)è!ğ
E¼Ü
::
OK
)

81  
”rÜ
;

83  
E¼Ü
::
OK
;

84 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/rsclient/CommandLoadRange.h

21 #iâdeà
HYPERTABLE_COMMANDLOADRANGE_H


22 
	#HYPERTABLE_COMMANDLOADRANGE_H


	)

24 
	~"CommÚ/IÁ”aùiveCommªd.h
"

26 
	~"Hy³¹abË/Lib/Ma¡”Cl›Á.h
"

27 
	~"Hy³¹abË/Lib/RªgeS”v”Cl›Á.h
"

29 
Çme¥aû
 
	gHy³¹abË
 {

31 şas 
	cCommªdLßdRªge
 : 
public
 
IÁ”aùiveCommªd
 {

32 
public
:

33 
CommªdLßdRªge
(
sockaddr_š
 &
addr
, 
RªgeS”v”Cl›ÁPŒ
 &
¿nge_£rv”_±r
, 
Hy³r¥aû
::
SessiÚPŒ
 &
hy³r¥aû_±r
è: 
m_addr
×ddr), 
m_¿nge_£rv”_±r
Ôªge_£rv”_±r), 
m_hy³r¥aû_±r
(hyperspace_ptr) { ; }

34 
vœtu®
 cÚ¡ *
commªd_‹xt
() {  "load„ange"; }

35 
vœtu®
 cÚ¡ **
u§ge
(è{  
	gms_u§ge
; }

36 
vœtu®
 
run
();

38 
	g´iv©e
:

39 cÚ¡ *
ms_u§ge
[];

41 
sockaddr_š
 
	gm_addr
;

42 
RªgeS”v”Cl›ÁPŒ
 
	gm_¿nge_£rv”_±r
;

43 
	gHy³r¥aû
::
SessiÚPŒ
 
m_hy³r¥aû_±r
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/rsclient/CommandShutdown.cc

21 
	~<c¡dlib
>

22 
	~<c¡ršg
>

23 
	~<io¡»am
>

25 
	~"CommÚ/E¼Ü.h
"

27 
	~"CommªdShutdown.h
"

29 
usšg
 
Çme¥aû
 
	gHy³¹abË
;

30 
usšg
 
Çme¥aû
 
	g¡d
;

32 cÚ¡ *
	gCommªdShutdown
::
ms_u§ge
[] = {

42 
	gCommªdShutdown
::
	$run
() {

43 
”rÜ
;

45 ià((
”rÜ
 = 
m_¿nge_£rv”_±r
->
	`shutdown
(
m_addr
)è!ğ
E¼Ü
::
OK
)

46  
”rÜ
;

48  
E¼Ü
::
OK
;

49 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/rsclient/CommandShutdown.h

21 #iâdeà
HYPERTABLE_COMMANDSHUTDOWN_H


22 
	#HYPERTABLE_COMMANDSHUTDOWN_H


	)

24 
	~"CommÚ/IÁ”aùiveCommªd.h
"

26 
	~"Hy³¹abË/Lib/Ma¡”Cl›Á.h
"

27 
	~"Hy³¹abË/Lib/RªgeS”v”Cl›Á.h
"

29 
Çme¥aû
 
	gHy³¹abË
 {

31 şas 
	cCommªdShutdown
 : 
public
 
IÁ”aùiveCommªd
 {

32 
public
:

33 
CommªdShutdown
(
sockaddr_š
 &
addr
, 
RªgeS”v”Cl›ÁPŒ
 &
¿nge_£rv”_±r
è: 
m_addr
×ddr), 
m_¿nge_£rv”_±r
(range_server_ptr) { ; }

34 
vœtu®
 cÚ¡ *
commªd_‹xt
() {  "shutdown"; }

35 
vœtu®
 cÚ¡ **
u§ge
(è{  
	gms_u§ge
; }

36 
vœtu®
 
run
();

38 
	g´iv©e
:

39 cÚ¡ *
ms_u§ge
[];

41 
sockaddr_š
 
	gm_addr
;

42 
RªgeS”v”Cl›ÁPŒ
 
	gm_¿nge_£rv”_±r
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/rsclient/CommandUpdate.cc

21 
	~<io¡»am
>

24 
	~<sys/ty³s.h
>

25 
	~<sys/¡©.h
>

28 
	~<boo¡/®gÜ™hm/¡ršg.hµ
>

30 
	~"CommÚ/E¼Ü.h
"

31 
	~"CommÚ/U§ge.h
"

33 
	~"AsyncComm/Di¥©chHªdËrSynchrÚiz”.h
"

34 
	~"AsyncComm/Ev’t.h
"

36 
	~"Hy³¹abË/Lib/Te¡D©a.h
"

37 
	~"Hy³¹abË/Lib/Te¡Sourû.h
"

39 
	~"CommªdUpd©e.h
"

40 
	~"P¬£RªgeS³c.h
"

41 
	~"TabËInfo.h
"

43 
	#BUFFER_SIZE
 65536

	)

45 
usšg
 
Çme¥aû
 
Hy³¹abË
;

46 
usšg
 
Çme¥aû
 
	g¡d
;

48 cÚ¡ *
	gCommªdUpd©e
::
ms_u§ge
[] = {

67 
	gCommªdUpd©e
::
	$run
() {

68 
Di¥©chHªdËrSynchrÚiz”
 
syncHªdËr
;

69 
”rÜ
;

70 
TabËId’tif›rT
 *
bË
;

71 
¡d
::
¡ršg
 
bËName
;

72 
SchemaPŒ
 
schema_±r
;

73 
Te¡D©a
 
td©a
;

74 
Te¡Sourû
 *
tsourû
 = 0;

75 
boŞ
 
out¡ªdšg
 = 
çl£
;

76 
¡©
 
¡©buf
;

77 
TabËInfo
 *
bË_šfo
;

79 ià(
m_¬gs
.
	`size
() != 2) {

80 
û¼
 << "WrÚg‚umb” oà¬gum’ts. Ty³ 'h–p' fÜ u§ge." << 
’dl
;

84 ià(
m_¬gs
[0].
£cÚd
 != "" || m_args[1].second != "")

85 
U§ge
::
	`dump_ªd_ex™
(
ms_u§ge
);

87 
bËName
 = 
m_¬gs
[0].
fœ¡
;

89 #ià
	`defšed
(
__APPLE__
)

90 
boo¡
::
	`to_uµ”
(
bËName
);

93 
bË_šfo
 = 
TabËInfo
::
m­
[
bËName
];

95 ià(
bË_šfo
 == 0) {

96 
bË_šfo
 = 
Ãw
 
	`TabËInfo
(
bËName
);

97 ià((
”rÜ
 = 
bË_šfo
->
	`lßd
(
m_hy³r¥aû_±r
)è!ğ
E¼Ü
::
OK
)

98  
”rÜ
;

99 
TabËInfo
::
m­
[
bËName
] = 
bË_šfo
;

102 
bË
 = 
bË_šfo
->
	`g‘_bË_id’tif›r
();

103 
bË_šfo
->
	`g‘_schema_±r
(
schema_±r
);

106 ià(
	`¡©
(
m_¬gs
[1].
fœ¡
.
	`c_¡r
(), &
¡©buf
) != 0) {

107 
	`HT_ERRORF
("UÇbËØ¡© d©¨f'%s' : %s", 
m_¬gs
[1].
£cÚd
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

108  
çl£
;

111 
tsourû
 = 
Ãw
 
	`Te¡Sourû
(
m_¬gs
[1].
fœ¡
, 
schema_±r
.
	`g‘
());

113 
ušt8_t
 *
£nd_buf
 = 0;

114 
size_t
 
£nd_buf_Ën
 = 0;

115 
DyÇmicBufãr
 
	`buf
(
BUFFER_SIZE
);

116 
By‹SŒšg32T
 *
key
, *
v®ue
;

117 
Ev’tPŒ
 
ev’tPŒ
;

119 
Œue
) {

121 
tsourû
->
	`Ãxt
(&
key
, &
v®ue
)) {

122 
buf
.
	`’su»
(
	`L’gth
(
key
è+ L’gth(
v®ue
));

123 
buf
.
	`addNoCheck
(
key
, 
	`L’gth
(key));

124 
buf
.
	`addNoCheck
(
v®ue
, 
	`L’gth
(value));

125 ià(
buf
.
	`fl
(è> 
BUFFER_SIZE
)

132 ià(
buf
.
	`fl
()) {

133 
¡d
::
veùÜ
<
By‹SŒšg32T
 *> 
keys
;

134 
ÉBy‹SŒšg32
 
Ébs32
;

135 
ušt8_t
 *
±r
;

136 
size_t
 
Ën
;

138 
±r
 = 
buf
.buf;

140 
±r
 < 
buf
.ptr) {

141 
key
 = (
By‹SŒšg32T
 *)
±r
;

142 
keys
.
	`push_back
(
key
);

143 
±r
 +ğ
	`L’gth
(
key
è+ L’gth(
	`Sk
(key));

146 
¡d
::
	`sÜt
(
keys
.
	`begš
(), keys.
	`’d
(), 
Ébs32
);

148 
£nd_buf
 = 
Ãw
 
ušt8_t
 [ 
buf
.
	`fl
() ];

149 
±r
 = 
£nd_buf
;

150 
size_t
 
i
=0; i<
keys
.
	`size
(); i++) {

151 
Ën
 = 
	`L’gth
(
keys
[
i
]è+ L’gth(
	`Sk
(keys[i]));

152 
	`memıy
(
±r
, 
keys
[
i
], 
Ën
);

153 
±r
 +ğ
Ën
;

155 
£nd_buf_Ën
 = 
±r
 - 
£nd_buf
;

156 
buf
.
	`ş—r
();

159 
£nd_buf_Ën
 = 0;

161 ià(
out¡ªdšg
) {

162 ià(!
syncHªdËr
.
	`wa™_fÜ_»¶y
(
ev’tPŒ
)) {

163 
”rÜ
 = 
PrÙocŞ
::
	`»¥Ú£_code
(
ev’tPŒ
);

164 ià(
”rÜ
 =ğ
E¼Ü
::
RANGESERVER_PARTIAL_UPDATE
)

165 
cout
 << "·¹ŸÈupd©e" << 
’dl
;

167 
	`HT_ERRORF
("upd©”rÜ : %s", (
PrÙocŞ
::
	`¡ršg_fÜm©_mes§ge
(
ev’tPŒ
)).
	`c_¡r
());

168  
”rÜ
;

172 
cout
 << "sucûss" << 
’dl
;

175 
out¡ªdšg
 = 
çl£
;

177 ià(
£nd_buf_Ën
 > 0) {

178 ià((
”rÜ
 = 
m_¿nge_£rv”_±r
->
	`upd©e
(
m_addr
, *
bË
, 
£nd_buf
, 
£nd_buf_Ën
, &
syncHªdËr
)è!ğ
E¼Ü
::
OK
) {

179 
	`HT_ERRORF
("ProbËm s’dšg upd©e - %s", 
E¼Ü
::
	`g‘_‹xt
(
”rÜ
));

180  
”rÜ
;

182 
out¡ªdšg
 = 
Œue
;

188 ià(
out¡ªdšg
) {

189 ià(!
syncHªdËr
.
	`wa™_fÜ_»¶y
(
ev’tPŒ
)) {

190 
”rÜ
 = 
PrÙocŞ
::
	`»¥Ú£_code
(
ev’tPŒ
);

191 ià(
”rÜ
 =ğ
E¼Ü
::
RANGESERVER_PARTIAL_UPDATE
)

192 
cout
 << "·¹ŸÈupd©e" << 
’dl
;

194 
	`HT_ERRORF
("upd©”rÜ : %s", (
PrÙocŞ
::
	`¡ršg_fÜm©_mes§ge
(
ev’tPŒ
)).
	`c_¡r
());

195  
”rÜ
;

199 
cout
 << "sucûss" << 
’dl
;

202  
E¼Ü
::
OK
;

203 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/rsclient/CommandUpdate.h

21 #iâdeà
HYPERTABLE_COMMANDUPDATE_H


22 
	#HYPERTABLE_COMMANDUPDATE_H


	)

24 
	~"CommÚ/IÁ”aùiveCommªd.h
"

26 
	~"Hy³¹abË/Lib/Ma¡”Cl›Á.h
"

27 
	~"Hy³¹abË/Lib/RªgeS”v”Cl›Á.h
"

29 
	~"Hy³r¥aû/SessiÚ.h
"

31 
Çme¥aû
 
	gHy³¹abË
 {

33 şas 
	cCommªdUpd©e
 : 
public
 
IÁ”aùiveCommªd
 {

34 
public
:

35 
CommªdUpd©e
(
sockaddr_š
 &
addr
, 
RªgeS”v”Cl›ÁPŒ
 &
¿nge_£rv”_±r
, 
Hy³r¥aû
::
SessiÚPŒ
 &
hy³r¥aû_±r
è: 
m_addr
×ddr), 
m_¿nge_£rv”_±r
Ôªge_£rv”_±r), 
m_hy³r¥aû_±r
(hyperspace_ptr) { ; }

36 
vœtu®
 cÚ¡ *
commªd_‹xt
() {  "update"; }

37 
vœtu®
 cÚ¡ **
u§ge
(è{  
	gms_u§ge
; }

38 
vœtu®
 
run
();

40 
	g´iv©e
:

41 cÚ¡ *
ms_u§ge
[];

43 
sockaddr_š
 
	gm_addr
;

44 
RªgeS”v”Cl›ÁPŒ
 
	gm_¿nge_£rv”_±r
;

45 
	gHy³r¥aû
::
SessiÚPŒ
 
m_hy³r¥aû_±r
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/rsclient/DisplayScanData.cc

20 
	~<io¡»am
>

22 
	~"Hy³¹abË/Lib/Key.h
"

24 
	~"Di¥ÏySÿnD©a.h
"

26 
Çme¥aû
 
	gHy³¹abË
 {

28 
Di¥ÏySÿnD©a
(cÚ¡ 
By‹SŒšg32T
 *
key
, cÚ¡ By‹SŒšg32T *
v®ue
, 
SchemaPŒ
 &
schemaPŒ
, 
boŞ
 
di¥Ïy_v®ues
) {

29 
Key
 
keyComps
(
key
);

30 
	gSchema
::
CŞumnFamy
 *
cf
;

32 ià(
	gkeyComps
.
	gæag
 =ğ
FLAG_DELETE_ROW
) {

33 
cout
 << 
keyComps
.
time¡amp
 << " " << keyComps.
row
 << " DELETE" << 
’dl
;

36 ià(
	gkeyComps
.
	gcŞumn_çmy_code
 > 0) {

37 
	gcf
 = 
schemaPŒ
->
g‘_cŞumn_çmy
(
keyComps
.
cŞumn_çmy_code
);

38 ià(
	gkeyComps
.
	gæag
 =ğ
FLAG_DELETE_CELL
)

39 
cout
 << 
keyComps
.
time¡amp
 << " " << keyComps.
row
 << " " << 
cf
->
Çme
 << ":" << keyComps.
cŞumn_qu®if›r
 << " DELETE" << 
’dl
;

41 
	gcout
 << 
	gkeyComps
.
	gtime¡amp
 << " " << keyComps.
	grow
 << " " << 
	gcf
->
	gÇme
 << ":" << keyComps.
	gcŞumn_qu®if›r
;

42 ià(
	gdi¥Ïy_v®ues
)

43 
	gcout
 << " " << (cÚ¡ *)
	gv®ue
->
	gd©a
;

44 
	gcout
 << 
	g’dl
;

48 
	gû¼
 << "Bad cŞumÀçmy (" << ()
	gkeyComps
.
	gcŞumn_çmy_code
 << "èfÜ„ow key " << keyComps.
	grow
;

49 ià(
	gdi¥Ïy_v®ues
)

50 
	gû¼
 << " v®ue=" << (cÚ¡ *)
	gv®ue
->
	gd©a
;

51 
	gû¼
 << 
	g’dl
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/rsclient/DisplayScanData.h

21 #iâdeà
HYPERTABLE_DISPLAYSCANDATA_H


22 
	#HYPERTABLE_DISPLAYSCANDATA_H


	)

24 
	~"CommÚ/By‹SŒšg.h
"

25 
	~"Hy³¹abË/Lib/Schema.h
"

27 
Çme¥aû
 
	gHy³¹abË
 {

29 
Di¥ÏySÿnD©a
(cÚ¡ 
By‹SŒšg32T
 *
key
, cÚ¡ By‹SŒšg32T *
v®ue
, 
SchemaPŒ
 &
schemaPŒ
, 
boŞ
 
di¥Ïy_v®ues
);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/rsclient/ParseRangeSpec.cc

21 
	~<boo¡/®gÜ™hm/¡ršg.hµ
>

23 
	~"Hy³¹abË/Lib/Key.h
"

25 
	~"P¬£RªgeS³c.h
"

27 
Çme¥aû
 
	gHy³¹abË
 {

29 
boŞ
 
P¬£RªgeS³c
(
¡d
::
¡ršg
 &
¥ec
, std::¡ršg &
bËName
, std::¡ršg &
¡¬tRow
, std::¡ršg &
’dRow
) {

30 cÚ¡ *
ba£
 = 
¥ec
.
c_¡r
();

31 cÚ¡ *
	g±r
, *
	gËáB¿ck‘
, *
	gdÙdÙ
, *
	grightB¿ck‘
;

33 ià((
	gËáB¿ck‘
 = 
¡rchr
(
ba£
, '[')) == 0)

34  
çl£
;

36 ià((
	gdÙdÙ
 = 
¡r¡r
(
ËáB¿ck‘
, "..")) == 0)

37  
çl£
;

39 ià((
	grightB¿ck‘
 = 
¡rchr
(
dÙdÙ
, ']')) == 0)

40  
çl£
;

42 
	gbËName
 = 
¡d
::
¡ršg
(
ba£
, 
ËáB¿ck‘
-base);

44 #ià
defšed
(
__APPLE__
)

45 
	gboo¡
::
to_uµ”
(
bËName
);

48 
	g±r
 = 
ËáB¿ck‘
+1;

49 ià(
	g±r
 =ğ
dÙdÙ
)

50 
¡¬tRow
 = "";

52 
	g¡¬tRow
 = 
¡d
::
¡ršg
(
±r
, 
dÙdÙ
-ptr);

53 
	gboo¡
::
Œim
(
¡¬tRow
);

54 
	gboo¡
::
Œim_if
(
¡¬tRow
, 
boo¡
::
is_ªy_of
("'\""));

55 ià(
	g¡¬tRow
.
rfšd
("??",
¡¬tRow
.
Ëngth
()) == (startRow.length()-2)) {

56 
size_t
 
off£t
 = 
¡¬tRow
.
Ëngth
() - 2;

57 
	g¡¬tRow
.
»¶aû
(
off£t
, 2, 2, ()0xff);

61 ià(
	g±r
 =ğ
rightB¿ck‘
)

62  
çl£
;

63 
	g±r
 = 
dÙdÙ
+2;

64 
	g’dRow
 = 
¡d
::
¡ršg
(
±r
, 
rightB¿ck‘
-ptr);

65 
	gboo¡
::
Œim
(
’dRow
);

66 
	gboo¡
::
Œim_if
(
’dRow
, 
boo¡
::
is_ªy_of
("'\""));

67 ià(
	g’dRow
.
rfšd
("??",
’dRow
.
Ëngth
()) == (endRow.length()-2)) {

68 
size_t
 
off£t
 = 
’dRow
.
Ëngth
() - 2;

69 
	g’dRow
.
»¶aû
(
off£t
, 2, 2, ()0xff);

72  
	gŒue
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/rsclient/ParseRangeSpec.h

21 #iâdeà
HYPERTABLE_PARSERANGESPEC_H


22 
	#HYPERTABLE_PARSERANGESPEC_H


	)

24 
	~<¡ršg
>

26 
Çme¥aû
 
	gHy³¹abË
 {

28 
boŞ
 
P¬£RªgeS³c
(
¡d
::
¡ršg
 &
¥ec
, std::¡ršg &
bËName
, std::¡ršg &
¡¬tRow
, std::¡ršg &
’dRow
);

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/rsclient/TableInfo.cc

21 
	~"CommÚ/DyÇmicBufãr.h
"

22 
	~"CommÚ/E¼Ü.h
"

23 
	~"CommÚ/Logg”.h
"

25 
	~"Hy³r¥aû/SessiÚ.h
"

27 
	~"TabËInfo.h
"

29 
Çme¥aû
 
	gHy³¹abË
 {

31 
	gTabËInfo
::
M­T
 
TabËInfo
::
m­
;

33 
	gTabËInfo
::
TabËInfo
(
¡d
::
¡ršg
 &
bË_Çme
) {

34 
mem£t
(&
m_bË
, 0, (
TabËId’tif›rT
));

35 
	gm_bË
.
	gÇme
 = 
Ãw
 [ 
¡¾’
(
bË_Çme
.
c_¡r
()) + 1 ];

36 
¡rıy
((*)
m_bË
.
Çme
, 
bË_Çme
.
c_¡r
());

39 
	gTabËInfo
::
lßd
(
Hy³r¥aû
::
SessiÚPŒ
 &
hy³r¥aû_±r
) {

40 
¡d
::
¡ršg
 
bË_fe
 = (¡d::¡ršg)"/hy³¹abË/bËs/" + 
m_bË
.
Çme
;

41 
DyÇmicBufãr
 
v®ueBuf
(0);

42 
	g”rÜ
;

43 
HªdËC®lbackPŒ
 
	gnuÎHªdËC®lback
;

44 
ušt64_t
 
	ghªdË
;

46 ià((
	g”rÜ
 = 
hy³r¥aû_±r
->
İ’
(
bË_fe
.
c_¡r
(), 
OPEN_FLAG_READ
, 
nuÎHªdËC®lback
, &
hªdË
)è!ğ
E¼Ü
::
OK
) {

47 
HT_ERRORF
("UÇbËØİ’ Hy³r¥aû f'%s' (%s)", 
bË_fe
.
c_¡r
(), 
E¼Ü
::
g‘_‹xt
(
”rÜ
));

48  
	g”rÜ
;

51 ià((
	g”rÜ
 = 
hy³r¥aû_±r
->
©Œ_g‘
(
hªdË
, "schema", 
v®ueBuf
)è!ğ
E¼Ü
::
OK
) {

52 
HT_ERRORF
("ProbËm g‘tšg 'schema'‡‰ribu‹ fÜ '%s' - %s", 
m_bË
.
Çme
, 
E¼Ü
::
g‘_‹xt
(
”rÜ
));

53  
	g”rÜ
;

56 
Schema
 *
	gschema
 = Schema::
Ãw_š¡ªû
((cÚ¡ *)
v®ueBuf
.
buf
, v®ueBuf.
fl
(), 
Œue
);

57 ià(!
	gschema
->
is_v®id
()) {

58 
HT_ERRORF
("Schem¨P¬£ E¼Ü: %s", 
schema
->
g‘_”rÜ_¡ršg
());

59 
d–‘e
 
	gschema
;

60  
	gE¼Ü
::
RANGESERVER_SCHEMA_PARSE_ERROR
;

62 
	gm_schema_±r
 = 
schema
;

64 
	gm_bË
.
	gg’”©iÚ
 = 
schema
->
g‘_g’”©iÚ
();

66 
	gv®ueBuf
.
ş—r
();

67 ià((
	g”rÜ
 = 
hy³r¥aû_±r
->
©Œ_g‘
(
hªdË
, "bË_id", 
v®ueBuf
)è!ğ
E¼Ü
::
OK
) {

68 
HT_ERRORF
("ProbËm g‘tšg‡‰ribu‹ 'bË_id' from '%s' - %s", 
m_bË
.
Çme
, 
E¼Ü
::
g‘_‹xt
(
”rÜ
));

69  
	g”rÜ
;

72 ià(
	gv®ueBuf
.
fl
(è!ğ(
št32_t
)) {

73 
HT_ERRORF
("%s/bË_id cÚš ¨bad v®ue", 
bË_fe
.
c_¡r
());

74  
	gE¼Ü
::
INVALID_METADATA
;

77 
memıy
(&
m_bË
.
id
, 
v®ueBuf
.
buf
, (
št32_t
));

79 
	ghy³r¥aû_±r
->
şo£
(
hªdË
);

81  
	gE¼Ü
::
OK
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/rsclient/TableInfo.h

21 #iâdeà
HYPERTABLE_RSCLIENT_TABLEINFO_H


22 
	#HYPERTABLE_RSCLIENT_TABLEINFO_H


	)

24 
	~<¡ršg
>

26 
	~<ext/hash_m­
>

28 
	~"Hy³¹abË/Lib/Schema.h
"

29 
	~"Hy³¹abË/Lib/Ty³s.h
"

31 
	~"Hy³r¥aû/SessiÚ.h
"

33 
Çme¥aû
 
	gHy³¹abË
 {

35 şas 
	cTabËInfo
 {

36 
	gpublic
:

37 
TabËInfo
(
¡d
::
¡ršg
 &
bË_Çme
);

39 
lßd
(
Hy³r¥aû
::
SessiÚPŒ
 &
hy³r¥aû_±r
);

41 
TabËId’tif›rT
 *
g‘_bË_id’tif›r
(è{  &
	gm_bË
; }

42 
g‘_schema_±r
(
SchemaPŒ
 &
schema_±r
è{ 
	gschema_±r
 = 
m_schema_±r
; }

44 
	g__gnu_cxx
::
	thash_m­
<
	t¡d
::
	t¡ršg
, 
	tTabËInfo
 *> 
	tM­T
;

46 
M­T
 
	gm­
;

48 
	g´iv©e
:

49 
TabËId’tif›rT
 
m_bË
;

50 
SchemaPŒ
 
	gm_schema_±r
;

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/rsclient/rsclient.cc

21 
	~<c¡dlib
>

22 
	~<c¡ršg
>

23 
	~<io¡»am
>

24 
	~<veùÜ
>

27 
	~<»adlše/»adlše.h
>

28 
	~<»adlše/hi¡Üy.h
>

31 
	~"CommÚ/IÁ”aùiveCommªd.h
"

32 
	~"CommÚ/Prİ”t›s.h
"

33 
	~"CommÚ/Sy¡em.h
"

34 
	~"CommÚ/U§ge.h
"

36 
	~"AsyncComm/Comm.h
"

37 
	~"AsyncComm/CÚÃùiÚMªag”.h
"

39 
	~"Hy³¹abË/Lib/RªgeS”v”Cl›Á.h
"

40 
	~"Hy³r¥aû/SessiÚ.h
"

42 
	~"CommªdC»©eSÿÂ”.h
"

43 
	~"CommªdDe¡roySÿÂ”.h
"

44 
	~"CommªdF‘chSÿnblock.h
"

45 
	~"CommªdLßdRªge.h
"

46 
	~"CommªdUpd©e.h
"

47 
	~"CommªdShutdown.h
"

49 
usšg
 
Çme¥aû
 
Hy³¹abË
;

50 
usšg
 
Çme¥aû
 
	g¡d
;

52 
	gÇme¥aû
 {

54 *
	glše_»ad
 = 0;

56 *
¾_g‘s
 () {

58 ià(
	glše_»ad
) {

59 
ä“
 (
lše_»ad
);

60 
	glše_»ad
 = (*)
NULL
;

64 
	glše_»ad
 = 
»adlše
 ("rsclient> ");

67 ià(
	glše_»ad
 && *line_read)

68 
add_hi¡Üy
 (
lše_»ad
);

70  
	glše_»ad
;

76 
P¬£S”v”Argum’t
(cÚ¡ *
¬g
, 
¡d
::
¡ršg
 &
ho¡
, 
ušt16_t
 *
pÜtPŒ
) {

77 cÚ¡ *
	g±r
 = 
¡rchr
(
¬g
, ':');

78 *
	gpÜtPŒ
 = 0;

79 ià(
	g±r
) {

80 
	gho¡
 = 
¡ršg
(
¬g
, 
±r
-arg);

81 *
	gpÜtPŒ
 = (
ušt16_t
)
©oi
(
±r
+1);

84 
	gho¡
 = 
¬g
;

92 
BudIÃtAdd»ss
(
sockaddr_š
 &
addr
, 
Prİ”t›sPŒ
 &
´İs_±r
, 
¡d
::
¡ršg
 &
u£rSuµl›dHo¡
, 
ušt16_t
 
u£rSuµl›dPÜt
) {

93 
	g¡d
::
¡ršg
 
ho¡
;

94 
ušt16_t
 
	gpÜt
;

96 ià(
	gu£rSuµl›dHo¡
 == "")

97 
ho¡
 = "localhost";

99 
	gho¡
 = 
u£rSuµl›dHo¡
;

101 ià(
	gu£rSuµl›dPÜt
 == 0)

102 
pÜt
 = (
ušt16_t
)
´İs_±r
->
g‘_št
("Hypertable.RangeServer.Port", 38060);

104 
	gpÜt
 = 
u£rSuµl›dPÜt
;

106 
mem£t
(&
addr
, 0, (
sockaddr_š
));

108 
ho¡’t
 *
	ghe
 = 
g‘ho¡byÇme
(
ho¡
.
c_¡r
());

109 ià(
	ghe
 == 0) {

110 
h”rÜ
("gethostbyname()");

111 
ex™
(1);

113 
memıy
(&
addr
.
sš_addr
.
s_addr
, 
he
->
h_addr_li¡
[0], (
ušt32_t
));

115 
	gaddr
.
	gsš_çmy
 = 
AF_INET
;

116 
	gaddr
.
	gsš_pÜt
 = 
htÚs
(
pÜt
);

120 cÚ¡ *
	gu§ge
[] = {

138 cÚ¡ *
	gh–pH—d”
[] = {

161 cÚ¡ *
	gh–pT¿”
[] = {

179 
	$maš
(
¬gc
, **
¬gv
) {

180 cÚ¡ *
lše
;

181 
¡ršg
 
cÚfigFe
 = "";

182 
¡ršg
 
ho¡
 = "";

183 
ušt16_t
 
pÜt
 = 0;

184 
sockaddr_š
 
addr
;

185 
veùÜ
<
IÁ”aùiveCommªd
 *> 
commªds
;

186 
Comm
 *
comm
;

187 
CÚÃùiÚMªag”
 *
cÚnMªag”
;

188 
Prİ”t›sPŒ
 
´İs_±r
;

189 
CommªdF‘chSÿnblock
 *
ãtchSÿnblock
;

190 
Hy³r¥aû
::
SessiÚPŒ
 
hy³r¥aû_±r
;

191 
RªgeS”v”Cl›ÁPŒ
 
¿nge_£rv”_±r
;

192 
¡d
::
¡ršg
 
hi¡Üy_fe
 = (¡d::¡ršg)
	`g‘’v
("HOME") + "/.rsclient_history";

194 
Sy¡em
::
	`š™Ÿlize
(
¬gv
[0]);

195 
R—ùÜFaùÜy
::
	`š™Ÿlize
((
ušt16_t
)
Sy¡em
::
	`g‘_´oûssÜ_couÁ
());

197 
i
=1; i<
¬gc
; i++) {

198 ià(!
	`¡ºcmp
(
¬gv
[
i
], "--config=", 9))

199 
cÚfigFe
 = &
¬gv
[
i
][9];

200 ià(!
	`¡ºcmp
(
¬gv
[
i
], "--server=", 9))

201 
	`P¬£S”v”Argum’t
(&
¬gv
[
i
][9], 
ho¡
, &
pÜt
);

203 
U§ge
::
	`dump_ªd_ex™
(
u§ge
);

206 ià(
cÚfigFe
 == "")

207 
cÚfigFe
 = 
Sy¡em
::
š¡®lDœ
 + "/conf/hypertable.cfg";

209 
´İs_±r
 = 
Ãw
 
	`Prİ”t›s
(
cÚfigFe
);

211 
	`BudIÃtAdd»ss
(
addr
, 
´İs_±r
, 
ho¡
, 
pÜt
);

213 
	`»ad_hi¡Üy
(
hi¡Üy_fe
.
	`c_¡r
());

215 
comm
 = 
Ãw
 
	`Comm
();

216 
cÚnMªag”
 = 
Ãw
 
	`CÚÃùiÚMªag”
(
comm
);

219 
¿nge_£rv”_±r
 = 
Ãw
 
	`RªgeS”v”Cl›Á
(
comm
, 30);

222 
cÚnMªag”
->
	`add
(
addr
, 30, "Range Server");

223 ià(!
cÚnMªag”
->
	`wa™_fÜ_cÚÃùiÚ
(
addr
, 30))

224 
û¼
 << "Timed ouˆwa™šg fÜ fÜ cÚÃùiÚØRªgS”v”. Ex™šg ..." << 
’dl
;

227 
hy³r¥aû_±r
 = 
Ãw
 
Hy³r¥aû
::
	`SessiÚ
(
cÚnMªag”
->
	`g‘_comm
(), 
´İs_±r
, 0);

228 ià(!
hy³r¥aû_±r
->
	`wa™_fÜ_cÚÃùiÚ
(30))

229 
	`ex™
(1);

231 
commªds
.
	`push_back
Ğ
Ãw
 
	`CommªdC»©eSÿÂ”
(
addr
, 
¿nge_£rv”_±r
, 
hy³r¥aû_±r
) );

232 
commªds
.
	`push_back
Ğ
Ãw
 
	`CommªdDe¡roySÿÂ”
(
addr
, 
¿nge_£rv”_±r
) );

233 
ãtchSÿnblock
 = 
Ãw
 
	`CommªdF‘chSÿnblock
(
addr
, 
¿nge_£rv”_±r
);

234 
commªds
.
	`push_back
Ğ
ãtchSÿnblock
 );

235 
commªds
.
	`push_back
Ğ
Ãw
 
	`CommªdLßdRªge
(
addr
, 
¿nge_£rv”_±r
, 
hy³r¥aû_±r
) );

236 
commªds
.
	`push_back
Ğ
Ãw
 
	`CommªdUpd©e
(
addr
, 
¿nge_£rv”_±r
, 
hy³r¥aû_±r
) );

237 
commªds
.
	`push_back
Ğ
Ãw
 
	`CommªdShutdown
(
addr
, 
¿nge_£rv”_±r
) );

239 
cout
 << "W–comtØthRªgS”v” commªd iÁ”´‘”." << 
’dl
;

240 
cout
 << "Ty³ 'h–p' fÜ‡ desütiÚ oàcommªds." << 
’dl
;

241 
cout
 << 
’dl
 << 
æush
;

243 
	`usšg_hi¡Üy
();

244 (
lše
 = 
	`¾_g‘s
()) != 0) {

245 
size_t
 
i
;

247 ià(*
lše
 == 0) {

248 ià(
CommªdC»©eSÿÂ”
::
ms_sÿÂ”_id
 != -1) {

249 
ãtchSÿnblock
->
	`ş—r_¬gs
();

250 
ãtchSÿnblock
->
	`run
();

255 
i
=0; i<
commªds
.
	`size
(); i++) {

256 ià(
commªds
[
i
]->
	`m©ches
(
lše
)) {

257 
commªds
[
i
]->
	`·r£_commªd_lše
(
lše
);

258 
commªds
[
i
]->
	`run
();

263 ià(
i
 =ğ
commªds
.
	`size
()) {

264 ià(!
	`¡rcmp
(
lše
, "quit") || !strcmp(line, "exit")) {

265 
	`wr™e_hi¡Üy
(
hi¡Üy_fe
.
	`c_¡r
());

266 
	`ex™
(0);

268 ià(!
	`¡rcmp
(
lše
, "help")) {

269 
U§ge
::
	`dump
(
h–pH—d”
);

270 
i
=0; i<
commªds
.
	`size
(); i++) {

271 
U§ge
::
	`dump
(
commªds
[
i
]->
	`u§ge
());

272 
cout
 << 
’dl
;

274 
U§ge
::
	`dump
(
h–pT¿”
);

277 
cout
 << "UÄecognized commªd." << 
’dl
;

282 
	`wr™e_hi¡Üy
(
hi¡Üy_fe
.
	`c_¡r
());

284 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/rsclient/tests/rsTest.cc

21 
	~<c¡dlib
>

22 
	~<io¡»am
>

23 
	~<¡ršg
>

26 
	~<sys/ty³s.h
>

27 
	~<uni¡d.h
>

30 
	~"CommÚ/FeUts.h
"

31 
	~"CommÚ/Logg”.h
"

32 
	~"CommÚ/Sy¡em.h
"

34 
usšg
 
Çme¥aû
 
Hy³¹abË
;

35 
usšg
 
Çme¥aû
 
	g¡d
;

38 
	gÇme¥aû
 {

39 cÚ¡ *
	g»quœedFes
[] = {

55 
	$maš
(
¬gc
, **
¬gv
) {

56 
¡d
::
¡ršg
 
commªdSŒ
;

58 
Sy¡em
::
	`š™Ÿlize
(
¬gv
[0]);

60 
i
=0; 
»quœedFes
[i]; i++) {

61 ià(!
FeUts
::
	`exi¡s
(
»quœedFes
[
i
])) {

62 
	`HT_ERRORF
("UÇbËØfšd '%s'", 
»quœedFes
[
i
]);

70 
commªdSŒ
 = (
¡d
::
¡ršg
)"../hypertable/hypertable --config=hypertable.cfg --batch < initialize.hql > init.out";

71 ià(
	`sy¡em
(
commªdSŒ
.
	`c_¡r
()) != 0)

78 
commªdSŒ
 = (
¡d
::
¡ršg
)"./rsclient --config=hypertable.cfg < Test1.cmd > Test1.output";

79 ià(
	`sy¡em
(
commªdSŒ
.
	`c_¡r
()) != 0)

82 
commªdSŒ
 = (
¡d
::
¡ršg
)"diff Test1.output Test1.golden";

83 ià(
	`sy¡em
(
commªdSŒ
.
	`c_¡r
()) != 0)

90 
commªdSŒ
 = (
¡d
::
¡ršg
)"./rsclient --config=hypertable.cfg < Test2.cmd > Test2.output";

91 ià(
	`sy¡em
(
commªdSŒ
.
	`c_¡r
()) != 0)

94 
commªdSŒ
 = (
¡d
::
¡ršg
)"diff Test2.output Test2.golden";

95 ià(
	`sy¡em
(
commªdSŒ
.
	`c_¡r
()) != 0)

102 
commªdSŒ
 = (
¡d
::
¡ršg
)"./rsclient --config=hypertable.cfg < Test3.cmd > Test3.output";

103 ià(
	`sy¡em
(
commªdSŒ
.
	`c_¡r
()) != 0)

106 
commªdSŒ
 = (
¡d
::
¡ršg
)"diff Test3.output Test3.golden";

107 ià(
	`sy¡em
(
commªdSŒ
.
	`c_¡r
()) != 0)

111 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/rsdump/rsdump.cc

21 
	~<c¡dlib
>

22 
	~<io¡»am
>

25 
	~<Ãtdb.h
>

28 
	~"CommÚ/E¼Ü.h
"

29 
	~"CommÚ/IÃtAddr.h
"

30 
	~"CommÚ/Logg”.h
"

31 
	~"CommÚ/Prİ”t›s.h
"

32 
	~"CommÚ/Sy¡em.h
"

33 
	~"CommÚ/U§ge.h
"

35 
	~"AsyncComm/AµliÿtiÚQueue.h
"

36 
	~"AsyncComm/Comm.h
"

37 
	~"AsyncComm/CÚÃùiÚMªag”.h
"

38 
	~"AsyncComm/R—ùÜFaùÜy.h
"

40 
	~"DfsBrok”/Lib/Cl›Á.h
"

42 
	~"Hy³r¥aû/SessiÚ.h
"

43 
	~"Hy³¹abË/Lib/Ma¡”Cl›Á.h
"

44 
	~"Hy³¹abË/Lib/RªgeS”v”Cl›Á.h
"

46 
usšg
 
Çme¥aû
 
Hy³¹abË
;

47 
usšg
 
Çme¥aû
 
	g¡d
;

49 
	gÇme¥aû
 {

51 cÚ¡ *
	gu§ge
[] = {

74 
	$maš
(
¬gc
, **
¬gv
) {

75 
¡ršg
 
cÚfigFe
 = "";

76 
¡ršg
 
ho¡Name
 = "";

77 
pÜt
 = 0;

78 
Prİ”t›sPŒ
 
´İs_±r
;

79 
sockaddr_š
 
addr
;

80 cÚ¡ *
ho¡Prİ”ty
 = 0;

81 cÚ¡ *
pÜtPrİ”ty
 = 0;

82 cÚ¡ *
pÜtSŒ
 = 0;

83 
Comm
 *
comm
 = 0;

84 
CÚÃùiÚMªag”PŒ
 
cÚnMªag”PŒ
;

85 
Hy³r¥aû
::
SessiÚPŒ
 
hy³r¥aûPŒ
;

86 
RªgeS”v”Cl›Á
 *
¿ngeS”v”
;

87 
AµliÿtiÚQueuePŒ
 
­pQueuePŒ
;

88 
”rÜ
;

89 
boŞ
 
v”bo£
 = 
çl£
;

91 
Sy¡em
::
	`š™Ÿlize
(
¬gv
[0]);

92 
R—ùÜFaùÜy
::
	`š™Ÿlize
((
ušt16_t
)
Sy¡em
::
	`g‘_´oûssÜ_couÁ
());

94 
i
=1; i<
¬gc
; i++) {

95 ià(!
	`¡ºcmp
(
¬gv
[
i
], "--config=", 9))

96 
cÚfigFe
 = &
¬gv
[
i
][9];

97 ià(!
	`¡ºcmp
(
¬gv
[
i
], "--host=", 7))

98 
ho¡Name
 = &
¬gv
[
i
][7];

99 ià(!
	`¡ºcmp
(
¬gv
[
i
], "--port=", 7))

100 
pÜtSŒ
 = &
¬gv
[
i
][7];

101 ià(!
	`¡rcmp
(
¬gv
[
i
], "--verbose") || !strcmp(argv[i], "-v"))

102 
v”bo£
 = 
Œue
;

104 
U§ge
::
	`dump_ªd_ex™
(
u§ge
);

107 ià(
cÚfigFe
 == "")

108 
cÚfigFe
 = 
Sy¡em
::
š¡®lDœ
 + "/conf/hypertable.cfg";

110 
´İs_±r
 = 
Ãw
 
	`Prİ”t›s
(
cÚfigFe
);

112 ià(
ho¡Name
 == "")

113 
ho¡Name
 = "localhost";

114 
pÜtPrİ”ty
 = "Hypertable.RangeServer.Port";

117 ià(
ho¡Name
 == "")

118 
ho¡Name
 = 
´İs_±r
->
	`g‘
(
ho¡Prİ”ty
, "localhost");

120 ià(
pÜtSŒ
 != 0)

121 
´İs_±r
->
	`£t
(
pÜtPrİ”ty
, 
pÜtSŒ
);

123 
pÜt
 = 
´İs_±r
->
	`g‘_št
(
pÜtPrİ”ty
, 0);

124 ià(
pÜt
 == 0 ||…ort < 1024 ||…ort >= 65536) {

125 
	`HT_ERRORF
("% nÙ s³cif›d o¸ouˆoà¿ng: %d", 
pÜtPrİ”ty
, 
pÜt
);

129 ià(!
IÃtAddr
::
	`š™Ÿlize
(&
addr
, 
ho¡Name
.
	`c_¡r
(), (
ušt16_t
)
pÜt
))

130 
abÜt
;

133 
´İs_±r
->
	`£t
("silent", "true");

135 
comm
 = 
Ãw
 
	`Comm
();

136 
cÚnMªag”PŒ
 = 
Ãw
 
	`CÚÃùiÚMªag”
(
comm
);

140 
cÚnMªag”PŒ
->
	`add
(
addr
, 30, "Range Server");

141 ià(!
cÚnMªag”PŒ
->
	`wa™_fÜ_cÚÃùiÚ
(
addr
, 2))

142 
abÜt
;

143 
¿ngeS”v”
 = 
Ãw
 
	`RªgeS”v”Cl›Á
(
comm
, 30);

144 ià((
”rÜ
 = 
¿ngeS”v”
->
	`dump_¡©s
(
addr
)è!ğ
E¼Ü
::
OK
)

145 
abÜt
;

148 
abÜt
:

150 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/serverup/serverup.cc

21 
	~<c¡dlib
>

22 
	~<io¡»am
>

25 
	~<Ãtdb.h
>

28 
	~"CommÚ/E¼Ü.h
"

29 
	~"CommÚ/IÃtAddr.h
"

30 
	~"CommÚ/Logg”.h
"

31 
	~"CommÚ/Prİ”t›s.h
"

32 
	~"CommÚ/Sy¡em.h
"

33 
	~"CommÚ/U§ge.h
"

35 
	~"AsyncComm/AµliÿtiÚQueue.h
"

36 
	~"AsyncComm/Comm.h
"

37 
	~"AsyncComm/CÚÃùiÚMªag”.h
"

38 
	~"AsyncComm/R—ùÜFaùÜy.h
"

40 
	~"DfsBrok”/Lib/Cl›Á.h
"

42 
	~"Hy³r¥aû/SessiÚ.h
"

43 
	~"Hy³¹abË/Lib/Ma¡”Cl›Á.h
"

44 
	~"Hy³¹abË/Lib/RªgeS”v”Cl›Á.h
"

46 
usšg
 
Çme¥aû
 
Hy³¹abË
;

47 
usšg
 
Çme¥aû
 
	g¡d
;

49 
	gÇme¥aû
 {

51 cÚ¡ *
	gu§ge
[] = {

87 
	$maš
(
¬gc
, **
¬gv
) {

88 
¡ršg
 
cÚfigFe
 = "";

89 
¡ršg
 
£rv”Name
 = "";

90 
¡ršg
 
ho¡Name
 = "";

91 
pÜt
 = 0;

92 
Prİ”t›sPŒ
 
´İs_±r
;

93 
sockaddr_š
 
addr
;

94 cÚ¡ *
ho¡Prİ”ty
 = 0;

95 cÚ¡ *
pÜtPrİ”ty
 = 0;

96 cÚ¡ *
pÜtSŒ
 = 0;

97 
Comm
 *
comm
 = 0;

98 
CÚÃùiÚMªag”PŒ
 
cÚnMªag”PŒ
;

99 
DfsBrok”
::
Cl›Á
 *
ş›Á
;

100 
Hy³r¥aû
::
SessiÚPŒ
 
hy³r¥aûPŒ
;

101 
RªgeS”v”Cl›Á
 *
¿ngeS”v”
;

102 
AµliÿtiÚQueuePŒ
 
­pQueuePŒ
;

103 
”rÜ
;

104 
boŞ
 
v”bo£
 = 
çl£
;

106 
Sy¡em
::
	`š™Ÿlize
(
¬gv
[0]);

107 
R—ùÜFaùÜy
::
	`š™Ÿlize
((
ušt16_t
)
Sy¡em
::
	`g‘_´oûssÜ_couÁ
());

109 
i
=1; i<
¬gc
; i++) {

110 ià(!
	`¡ºcmp
(
¬gv
[
i
], "--config=", 9))

111 
cÚfigFe
 = &
¬gv
[
i
][9];

112 ià(!
	`¡ºcmp
(
¬gv
[
i
], "--host=", 7))

113 
ho¡Name
 = &
¬gv
[
i
][7];

114 ià(!
	`¡ºcmp
(
¬gv
[
i
], "--port=", 7))

115 
pÜtSŒ
 = &
¬gv
[
i
][7];

116 ià(!
	`¡rcmp
(
¬gv
[
i
], "--verbose") || !strcmp(argv[i], "-v"))

117 
v”bo£
 = 
Œue
;

118 ià(
¬gv
[
i
][0] =ğ'-' || 
£rv”Name
 != "")

119 
U§ge
::
	`dump_ªd_ex™
(
u§ge
);

121 
£rv”Name
 = 
¬gv
[
i
];

124 ià(
cÚfigFe
 == "")

125 
cÚfigFe
 = 
Sy¡em
::
š¡®lDœ
 + "/conf/hypertable.cfg";

127 
´İs_±r
 = 
Ãw
 
	`Prİ”t›s
(
cÚfigFe
);

129 ià(
£rv”Name
 == "dfsbroker") {

130 
ho¡Prİ”ty
 = "DfsBroker.Host";

131 
pÜtPrİ”ty
 = "DfsBroker.Port";

133 ià(
£rv”Name
 == "hyperspace") {

134 
ho¡Prİ”ty
 = "Hyperspace.Master.Host";

135 
pÜtPrİ”ty
 = "Hyperspace.Master.Port";

137 ià(
£rv”Name
 == "master") {

138 
ho¡Prİ”ty
 = "Hypertable.Master.Host";

139 
pÜtPrİ”ty
 = "Hypertable.Master.Port";

141 ià(
£rv”Name
 == "rangeserver") {

142 ià(
ho¡Name
 == "")

143 
ho¡Name
 = "localhost";

144 
pÜtPrİ”ty
 = "Hypertable.RangeServer.Port";

147 
U§ge
::
	`dump_ªd_ex™
(
u§ge
);

150 ià(
ho¡Name
 == "")

151 
ho¡Name
 = 
´İs_±r
->
	`g‘
(
ho¡Prİ”ty
, "localhost");

152 ià(
£rv”Name
 != "rangeserver")

153 
´İs_±r
->
	`£t
(
ho¡Prİ”ty
, 
ho¡Name
.
	`c_¡r
());

155 ià(
pÜtSŒ
 != 0)

156 
´İs_±r
->
	`£t
(
pÜtPrİ”ty
, 
pÜtSŒ
);

158 
pÜt
 = 
´İs_±r
->
	`g‘_št
(
pÜtPrİ”ty
, 0);

159 ià(
pÜt
 == 0 ||…ort < 1024 ||…ort >= 65536) {

160 
	`HT_ERRORF
("% nÙ s³cif›d o¸ouˆoà¿ng: %d", 
pÜtPrİ”ty
, 
pÜt
);

164 ià(!
IÃtAddr
::
	`š™Ÿlize
(&
addr
, 
ho¡Name
.
	`c_¡r
(), (
ušt16_t
)
pÜt
))

165 
abÜt
;

168 
´İs_±r
->
	`£t
("silent", "true");

170 
comm
 = 
Ãw
 
	`Comm
();

171 
cÚnMªag”PŒ
 = 
Ãw
 
	`CÚÃùiÚMªag”
(
comm
);

172 
cÚnMªag”PŒ
->
	`£t_qu›t_mode
(
Œue
);

174 ià(
£rv”Name
 == "dfsbroker") {

175 
ş›Á
 = 
Ãw
 
DfsBrok”
::
	`Cl›Á
(
cÚnMªag”PŒ
, 
addr
, 30);

176 ià(!
ş›Á
->
	`wa™_fÜ_cÚÃùiÚ
(2))

177 
abÜt
;

178 ià((
”rÜ
 = 
ş›Á
->
	`¡©us
()è!ğ
E¼Ü
::
OK
)

179 
abÜt
;

181 ià(
£rv”Name
 == "hyperspace") {

182 
hy³r¥aûPŒ
 = 
Ãw
 
Hy³r¥aû
::
	`SessiÚ
(
cÚnMªag”PŒ
->
	`g‘_comm
(), 
´İs_±r
, 0);

183 ià(!
hy³r¥aûPŒ
->
	`wa™_fÜ_cÚÃùiÚ
(2))

184 
abÜt
;

185 ià((
”rÜ
 = 
hy³r¥aûPŒ
->
	`¡©us
()è!ğ
E¼Ü
::
OK
)

186 
abÜt
;

188 ià(
£rv”Name
 == "master") {

189 
Ma¡”Cl›ÁPŒ
 
ma¡”PŒ
;

191 
hy³r¥aûPŒ
 = 
Ãw
 
Hy³r¥aû
::
	`SessiÚ
(
cÚnMªag”PŒ
->
	`g‘_comm
(), 
´İs_±r
, 0);

193 ià(!
hy³r¥aûPŒ
->
	`wa™_fÜ_cÚÃùiÚ
(2))

194 
abÜt
;

196 
­pQueuePŒ
 = 
Ãw
 
	`AµliÿtiÚQueue
(1);

197 
ma¡”PŒ
 = 
Ãw
 
	`Ma¡”Cl›Á
(
cÚnMªag”PŒ
, 
hy³r¥aûPŒ
, 30, 
­pQueuePŒ
);

198 
ma¡”PŒ
->
	`£t_v”bo£_æag
(
çl£
);

199 ià(
ma¡”PŒ
->
	`š™Ÿ‹_cÚÃùiÚ
(0è!ğ
E¼Ü
::
OK
)

200 
abÜt
;

202 ià(!
ma¡”PŒ
->
	`wa™_fÜ_cÚÃùiÚ
(2))

203 
abÜt
;

205 ià((
”rÜ
 = 
ma¡”PŒ
->
	`¡©us
()è!ğ
E¼Ü
::
OK
)

206 
abÜt
;

208 ià(
£rv”Name
 == "rangeserver") {

209 
cÚnMªag”PŒ
->
	`add
(
addr
, 30, "Range Server");

210 ià(!
cÚnMªag”PŒ
->
	`wa™_fÜ_cÚÃùiÚ
(
addr
, 2))

211 
abÜt
;

212 
¿ngeS”v”
 = 
Ãw
 
	`RªgeS”v”Cl›Á
(
comm
, 30);

213 ià((
”rÜ
 = 
¿ngeS”v”
->
	`¡©us
(
addr
)è!ğ
E¼Ü
::
OK
)

214 
abÜt
;

217 ià(
v”bo£
)

218 
cout
 << "Œue" << 
’dl
;

221 
abÜt
:

222 ià(
v”bo£
)

223 
cout
 << "çl£" << 
’dl
;

225 
	}
}

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/boost-1_34-fix/boost/function/function_base.hpp

10 #iâdeà
BOOST_FUNCTION_BASE_HEADER


11 
	#BOOST_FUNCTION_BASE_HEADER


	)

13 
	~<¡dexû±
>

14 
	~<¡ršg
>

15 
	~<memÜy
>

16 
	~<Ãw
>

17 
	~<ty³šfo
>

18 
	~<funùiÚ®
>

19 
	~<boo¡/cÚfig.hµ
>

20 
	~<boo¡/as£¹.hµ
>

21 
	~<boo¡/ty³_Œa™s/is_š‹g¿l.hµ
>

22 
	~<boo¡/ty³_Œa™s/compos™e_Œa™s.hµ
>

23 
	~<boo¡/»f.hµ
>

24 
	~<boo¡/m¶/if.hµ
>

25 
	~<boo¡/d‘a/wÜk¬ound.hµ
>

26 
	~<boo¡/ty³_Œa™s/®ignm’t_of.hµ
>

27 #iâdeà
BOOST_NO_SFINAE


28 
	~"boo¡/ut™y/’abË_if.hµ
"

30 
	~"boo¡/m¶/boŞ.hµ
"

32 
	~<boo¡/funùiÚ_equ®.hµ
>

34 #ià
defšed
(
BOOST_MSVC
)

35 #´agm¨
w¬nšg
Ğ
push
 )

36 #´agm¨
w¬nšg
Ğ
di§bË
 : 4793 )

37 #´agm¨
w¬nšg
Ğ
di§bË
 : 4127 )

41 #ifdeà
BOOST_NO_EXCEPTION_STD_NAMESPACE


43 
	#BOOST_FUNCTION_STD_NS


	)

45 
	#BOOST_FUNCTION_STD_NS
 
¡d


	)

50 #ià(
defšed
(
__GNUC__
) && __GNUC__ >= 3) \

51 || 
defšed
(
_AIX
) \

52 || ( 
defšed
(
__sgi
è&& 
	$defšed
(
__ho¡_ms
))

53 
	~<c¡ršg
>

54 
	#BOOST_FUNCTION_COMPARE_TYPE_ID
(
X
,
Y
) \

55 (
¡d
::
	`¡rcmp
((
X
).
	`Çme
(),(
Y
).Çme()è=ğ0)

	)

57 
	#BOOST_FUNCTION_COMPARE_TYPE_ID
(
X
,
Y
è((X)==(Y))

	)

60 #ià
	`defšed
(
BOOST_MSVC
è&& BOOST_MSVC <ğ1300 || defšed(
__ICL
è&& __ICL <ğ600 || defšed(
__MWERKS__
è&& __MWERKS__ < 0x2406 && !defšed(
BOOST_STRICT_CONFIG
)

61 
	#BOOST_FUNCTION_TARGET_FIX
(
x
è
	)
x

63 
	#BOOST_FUNCTION_TARGET_FIX
(
x
)

	)

66 #ià
	`defšed
(
__sgi
è&& defšed(
_COMPILER_VERSION
è&& _COMPILER_VERSION <ğ730 && !defšed(
BOOST_STRICT_CONFIG
)

70 
Çme¥aû
 
boo¡
 {‚ame¥aû 
pythÚ
 {‚ame¥aû 
objeùs
 {

71 
şass
 
funùiÚ
;

72 }}
	}
}

75 #ià
defšed
 (
BOOST_NO_TEMPLATE_PARTIAL_SPECIALIZATION
) \

76 || 
defšed
(
BOOST_BCB_PARTIAL_SPECIALIZATION_BUG
) \

77 || !(
defšed
(
BOOST_STRICT_CONFIG
è|| !defšed(
__SUNPRO_CC
è|| 
	g__SUNPRO_CC
 > 0x540)

78 
	#BOOST_FUNCTION_NO_FUNCTION_TYPE_SYNTAX


	)

81 #ià!
BOOST_WORKAROUND
(
__BORLANDC__
, < 0x600)

82 
	#BOOST_FUNCTION_ENABLE_IF_NOT_INTEGRAL
(
FunùÜ
,
Ty³
) \

83 
ty³Çme
 ::
boo¡
::
’abË_if_c
<(::boo¡::
ty³_Œa™s
::
iû_nÙ
< \

84 (::
boo¡
::
is_š‹g¿l
<
FunùÜ
>::
v®ue
)>::value), \

85 
Ty³
>::
ty³


	)

89 
	#BOOST_FUNCTION_ENABLE_IF_NOT_INTEGRAL
(
FunùÜ
,
Ty³
) \

90 ::
boo¡
::
’abË_if_c
<(::boo¡::
ty³_Œa™s
::
iû_nÙ
< \

91 (::
boo¡
::
is_š‹g¿l
<
FunùÜ
>::
v®ue
)>::value), \

92 
Ty³
>::
ty³


	)

95 #ià!
defšed
(
BOOST_FUNCTION_NO_FUNCTION_TYPE_SYNTAX
)

96 
Çme¥aû
 
	gboo¡
 {

98 #ià
defšed
(
__sgi
è&& defšed(
_COMPILER_VERSION
è&& _COMPILER_VERSION <ğ730 && !defšed(
BOOST_STRICT_CONFIG
)

100 
şass
 
	gfunùiÚ_ba£
;

102 
	g‹m¶©e
<
ty³Çme
 
	gSigÇtu»
,

103 
ty³Çme
 
	gAÎoÿtÜ
 = 
¡d
::
®loÿtÜ
<
funùiÚ_ba£
> >

104 
şass
 
funùiÚ
;

106 
	g‹m¶©e
<
ty³Çme
 
	gSigÇtu»
,y³Çm
	gAÎoÿtÜ
 = 
¡d
::
®loÿtÜ
<> >

107 
şass
 
funùiÚ
;

110 
	g‹m¶©e
<
ty³Çme
 
	gSigÇtu»
,y³Çm
	gAÎoÿtÜ
>

111 
šlše
 
sw­
(
funùiÚ
<
SigÇtu»
, 
AÎoÿtÜ
>& 
f1
,

112 
funùiÚ
<
SigÇtu»
, 
AÎoÿtÜ
>& 
f2
)

114 
	gf1
.
sw­
(
f2
);

120 
Çme¥aû
 
	gboo¡
 {

121 
Çme¥aû
 
	gd‘a
 {

122 
Çme¥aû
 
	gfunùiÚ
 {

123 
şass
 
	gX
;

131 
	ufunùiÚ_bufãr


134 * 
	gobj_±r
;

138 cÚ¡ * 
	gcÚ¡_obj_±r
;

141 
mubË
 (*
	gfunc_±r
)();

144 
	sbound_memfunc_±r_t
 {

145 (
	gX
::*
memfunc_±r
)();

146 * 
	gobj_±r
;

147 } 
	gbound_memfunc_±r
;

150 
mubË
 
	gd©a
;

159 
	sunu§bË


161 
unu§bË
() {}

162 
	g‹m¶©e
<
ty³Çme
 
	gT
> 
unu§bË
(cÚ¡ 
T
&) {}

169 
	g‹m¶©e
<
ty³Çme
 
	gT
> 
	sfunùiÚ_»tuº_ty³
 { 
T
 
	tty³
; };

171 
	g‹m¶©e
<>

172 
	gfunùiÚ_»tuº_ty³
<>

174 
unu§bË
 
	tty³
;

178 
	efunùÜ_mªag”_İ”©iÚ_ty³
 {

179 
	gşÚe_funùÜ_g
,

180 
	gde¡roy_funùÜ_g
,

181 
	gcheck_funùÜ_ty³_g
,

182 
	gg‘_funùÜ_ty³_g


186 
	sfunùiÚ_±r_g
 {};

187 
	sfunùiÚ_obj_g
 {};

188 
	smemb”_±r_g
 {};

189 
	sfunùiÚ_obj_»f_g
 {};

191 
	g‹m¶©e
<
ty³Çme
 
	gF
>

192 şas 
	cg‘_funùiÚ_g


194 
ty³Çme
 
	tm¶
::
	tif_c
<(
	tis_poš‹r
<
	tF
>::
	tv®ue
),

195 
	tfunùiÚ_±r_g
,

196 
	tfunùiÚ_obj_g
>::
	tty³
 
	t±r_Ü_obj_g
;

198 
ty³Çme
 
	tm¶
::
	tif_c
<(
	tis_memb”_poš‹r
<
	tF
>::
	tv®ue
),

199 
	tmemb”_±r_g
,

200 
	t±r_Ü_obj_g
>::
	tty³
 
	t±r_Ü_obj_Ü_mem_g
;

202 
ty³Çme
 
	tm¶
::
	tif_c
<(
	tis_»ã»nû_w¿µ”
<
	tF
>::
	tv®ue
),

203 
	tfunùiÚ_obj_»f_g
,

204 
	t±r_Ü_obj_Ü_mem_g
>::
	tty³
 
	tÜ_»f_g
;

206 
	gpublic
:

207 
Ü_»f_g
 
	tty³
;

212 
	g‹m¶©e
<
ty³Çme
 
	gF
>

213 
	s»ã»nû_mªag”


215 
šlše
 

216 
mªage
(cÚ¡ 
funùiÚ_bufãr
& 
š_bufãr
, funùiÚ_bufãr& 
out_bufãr
,

217 
funùÜ_mªag”_İ”©iÚ_ty³
 
İ
)

219 
	gİ
) {

220 
	gşÚe_funùÜ_g
:

221 
out_bufãr
.
obj_±r
 = 
š_bufãr
.obj_ptr;

224 
	gde¡roy_funùÜ_g
:

225 
out_bufãr
.
obj_±r
 = 0;

228 
	gcheck_funùÜ_ty³_g
:

233 cÚ¡ 
BOOST_FUNCTION_STD_NS
::
ty³_šfo
& 
check_ty³
 =

234 *
¡©ic_ÿ¡
<cÚ¡ 
BOOST_FUNCTION_STD_NS
::
ty³_šfo
*>(
out_bufãr
.
cÚ¡_obj_±r
);

235 ià(
BOOST_FUNCTION_COMPARE_TYPE_ID
(
check_ty³
, 
ty³id
(
F
)))

236 
	gout_bufãr
.
	gobj_±r
 = 
š_bufãr
.
obj_±r
;

238 
	gout_bufãr
.
	gobj_±r
 = 0;

242 
	gg‘_funùÜ_ty³_g
:

243 
out_bufãr
.
cÚ¡_obj_±r
 = &
ty³id
(
F
);

253 
	g‹m¶©e
<
ty³Çme
 
	gF
>

254 
	sfunùiÚ_®lows_sm®l_objeù_İtimiz©iÚ


256 
	gBOOST_STATIC_CONSTANT


257 (
	gboŞ
,

258 
	gv®ue
 = (((
F
è<ğ(
funùiÚ_bufãr
) &&

259 (
®ignm’t_of
<
funùiÚ_bufãr
>::
v®ue


260 % 
®ignm’t_of
<
F
>::
v®ue
 == 0))));

267 
	g‹m¶©e
<
ty³Çme
 
	gFunùÜ
,y³Çm
	gAÎoÿtÜ
>

268 
	sfunùÜ_mªag”


270 
	g´iv©e
:

271 
FunùÜ
 
	tfunùÜ_ty³
;

274 
šlše
 

275 
mªag”
(cÚ¡ 
funùiÚ_bufãr
& 
š_bufãr
, funùiÚ_bufãr& 
out_bufãr
,

276 
funùÜ_mªag”_İ”©iÚ_ty³
 
İ
, 
funùiÚ_±r_g
)

278 ià(
	gİ
 =ğ
şÚe_funùÜ_g
)

279 
out_bufãr
.
func_±r
 = 
š_bufãr
.func_ptr;

280 ià(
	gİ
 =ğ
de¡roy_funùÜ_g
)

281 
out_bufãr
.
func_±r
 = 0;

283 cÚ¡ 
	gBOOST_FUNCTION_STD_NS
::
ty³_šfo
& 
check_ty³
 =

284 *
¡©ic_ÿ¡
<cÚ¡ 
BOOST_FUNCTION_STD_NS
::
ty³_šfo
*>(
out_bufãr
.
cÚ¡_obj_±r
);

285 ià(
BOOST_FUNCTION_COMPARE_TYPE_ID
(
check_ty³
, 
ty³id
(
FunùÜ
)))

286 
	gout_bufãr
.
	gobj_±r
 = &
š_bufãr
.
func_±r
;

288 
	gout_bufãr
.
	gobj_±r
 = 0;

293 
šlše
 

294 
mªag”
(cÚ¡ 
funùiÚ_bufãr
& 
š_bufãr
, funùiÚ_bufãr& 
out_bufãr
,

295 
funùÜ_mªag”_İ”©iÚ_ty³
 
İ
, 
m¶
::
Œue_
)

297 ià(
İ
 =ğ
şÚe_funùÜ_g
) {

298 cÚ¡ 
funùÜ_ty³
* 
š_funùÜ
 =

299 
»š‹½»t_ÿ¡
<cÚ¡ 
funùÜ_ty³
*>(&
š_bufãr
.
d©a
);

300 
Ãw
 ((*)&
out_bufãr
.
d©a
è
funùÜ_ty³
(*
š_funùÜ
);

301 } ià(
	gİ
 =ğ
de¡roy_funùÜ_g
) {

303 
»š‹½»t_ÿ¡
<
funùÜ_ty³
*>(&
out_bufãr
.
d©a
)->~
FunùÜ
();

305 cÚ¡ 
	gBOOST_FUNCTION_STD_NS
::
ty³_šfo
& 
check_ty³
 =

306 *
¡©ic_ÿ¡
<cÚ¡ 
BOOST_FUNCTION_STD_NS
::
ty³_šfo
*>(
out_bufãr
.
cÚ¡_obj_±r
);

307 ià(
BOOST_FUNCTION_COMPARE_TYPE_ID
(
check_ty³
, 
ty³id
(
FunùÜ
)))

308 
	gout_bufãr
.
	gobj_±r
 = &
š_bufãr
.
d©a
;

310 
	gout_bufãr
.
	gobj_±r
 = 0;

315 
šlše
 

316 
mªag”
(cÚ¡ 
funùiÚ_bufãr
& 
š_bufãr
, funùiÚ_bufãr& 
out_bufãr
,

317 
funùÜ_mªag”_İ”©iÚ_ty³
 
İ
, 
m¶
::
çl£_
)

319 #iâdeà
BOOST_NO_STD_ALLOCATOR


320 
ty³Çme
 
	tAÎoÿtÜ
::
	t‹m¶©e
 
	t»bšd
<
	tfunùÜ_ty³
>::
	tÙh”


321 
	t®loÿtÜ_ty³
;

322 
ty³Çme
 
	t®loÿtÜ_ty³
::
	tpoš‹r
 
	tpoš‹r_ty³
;

324 
funùÜ_ty³
* 
	tpoš‹r_ty³
;

327 #iâdeà
BOOST_NO_STD_ALLOCATOR


328 
®loÿtÜ_ty³
 
	g®loÿtÜ
;

331 ià(
	gİ
 =ğ
şÚe_funùÜ_g
) {

334 cÚ¡ 
funùÜ_ty³
* 
f
 =

335 (cÚ¡ 
funùÜ_ty³
*)(
š_bufãr
.
obj_±r
);

338 #iâdeà
BOOST_NO_STD_ALLOCATOR


339 
poš‹r_ty³
 
	gcİy
 = 
®loÿtÜ
.
®loÿ‹
(1);

340 
	g®loÿtÜ
.
cÚ¡ruù
(
cİy
, *
f
);

343 
funùÜ_ty³
* 
	gÃw_f
 = 
¡©ic_ÿ¡
<funùÜ_ty³*>(
cİy
);

345 
funùÜ_ty³
* 
	gÃw_f
 = 
Ãw
 funùÜ_ty³(*
f
);

347 
	gout_bufãr
.
	gobj_±r
 = 
Ãw_f
;

348 } ià(
	gİ
 =ğ
de¡roy_funùÜ_g
) {

350 
funùÜ_ty³
* 
f
 =

351 
¡©ic_ÿ¡
<
funùÜ_ty³
*>(
out_bufãr
.
obj_±r
);

353 #iâdeà
BOOST_NO_STD_ALLOCATOR


356 
poš‹r_ty³
 
	gviùim
 = 
¡©ic_ÿ¡
<poš‹r_ty³>(
f
);

359 
	g®loÿtÜ
.
de¡roy
(
viùim
);

360 
	g®loÿtÜ
.
d—Îoÿ‹
(
viùim
, 1);

362 
d–‘e
 
	gf
;

364 
	gout_bufãr
.
	gobj_±r
 = 0;

366 cÚ¡ 
	gBOOST_FUNCTION_STD_NS
::
ty³_šfo
& 
check_ty³
 =

367 *
¡©ic_ÿ¡
<cÚ¡ 
BOOST_FUNCTION_STD_NS
::
ty³_šfo
*>(
out_bufãr
.
cÚ¡_obj_±r
);

368 ià(
BOOST_FUNCTION_COMPARE_TYPE_ID
(
check_ty³
, 
ty³id
(
FunùÜ
)))

369 
	gout_bufãr
.
	gobj_±r
 = 
š_bufãr
.
obj_±r
;

371 
	gout_bufãr
.
	gobj_±r
 = 0;

378 
šlše
 

379 
mªag”
(cÚ¡ 
funùiÚ_bufãr
& 
š_bufãr
, funùiÚ_bufãr& 
out_bufãr
,

380 
funùÜ_mªag”_İ”©iÚ_ty³
 
İ
, 
funùiÚ_obj_g
)

382 
mªag”
(
š_bufãr
, 
out_bufãr
, 
İ
,

383 
m¶
::
boŞ_
<(
funùiÚ_®lows_sm®l_objeù_İtimiz©iÚ
<
funùÜ_ty³
>::
v®ue
)>());

388 
šlše
 

389 
mªag”
(cÚ¡ 
funùiÚ_bufãr
& 
š_bufãr
, funùiÚ_bufãr& 
out_bufãr
,

390 
funùÜ_mªag”_İ”©iÚ_ty³
 
İ
, 
memb”_±r_g
)

392 
mªag”
(
š_bufãr
, 
out_bufãr
, 
İ
, 
m¶
::
Œue_
());

395 
	gpublic
:

398 
šlše
 

399 
mªage
(cÚ¡ 
funùiÚ_bufãr
& 
š_bufãr
, funùiÚ_bufãr& 
out_bufãr
,

400 
funùÜ_mªag”_İ”©iÚ_ty³
 
İ
)

402 
ty³Çme
 
	tg‘_funùiÚ_g
<
	tfunùÜ_ty³
>::
	tty³
 
	tg_ty³
;

403 
	gİ
) {

404 
	gg‘_funùÜ_ty³_g
:

405 
out_bufãr
.
cÚ¡_obj_±r
 = &
ty³id
(
funùÜ_ty³
);

409 
mªag”
(
š_bufãr
, 
out_bufãr
, 
İ
, 
g_ty³
());

416 
	su£Ëss_ş—r_ty³
 {};

418 #ifdeà
BOOST_NO_SFINAE


424 
	g‹m¶©e
<
ty³Çme
 
	gFunùiÚ
,y³Çm
	gFunùÜ
>

425 
boŞ


426 
com·»_equ®
(cÚ¡ 
FunùiÚ
& 
f
, cÚ¡ 
FunùÜ
&, , 
m¶
::
boŞ_
<
Œue
>)

427 {  
f
.
em±y
(); }

429 
	g‹m¶©e
<
ty³Çme
 
	gFunùiÚ
,y³Çm
	gFunùÜ
>

430 
boŞ


431 
com·»_nÙ_equ®
(cÚ¡ 
FunùiÚ
& 
f
, cÚ¡ 
FunùÜ
&, ,

432 
m¶
::
boŞ_
<
Œue
>)

433 {  !
f
.
em±y
(); }

435 
	g‹m¶©e
<
ty³Çme
 
	gFunùiÚ
,y³Çm
	gFunùÜ
>

436 
boŞ


437 
com·»_equ®
(cÚ¡ 
FunùiÚ
& 
f
, cÚ¡ 
FunùÜ
& 
g
, ,

438 
m¶
::
boŞ_
<
çl£
>)

440 ià(cÚ¡ 
FunùÜ
* 
å
 = 
f
.
‹m¶©e
 
rg‘
<Functor>())

441  
funùiÚ_equ®
(*
å
, 
g
);

442  
	gçl£
;

445 
	g‹m¶©e
<
ty³Çme
 
	gFunùiÚ
,y³Çm
	gFunùÜ
>

446 
boŞ


447 
com·»_equ®
(cÚ¡ 
FunùiÚ
& 
f
, cÚ¡ 
»ã»nû_w¿µ”
<
FunùÜ
>& 
g
,

448 , 
m¶
::
boŞ_
<
çl£
>)

450 ià(cÚ¡ 
FunùÜ
* 
å
 = 
f
.
‹m¶©e
 
rg‘
<Functor>())

451  
å
 =ğ
g
.
g‘_poš‹r
();

452  
	gçl£
;

455 
	g‹m¶©e
<
ty³Çme
 
	gFunùiÚ
,y³Çm
	gFunùÜ
>

456 
boŞ


457 
com·»_nÙ_equ®
(cÚ¡ 
FunùiÚ
& 
f
, cÚ¡ 
FunùÜ
& 
g
, ,

458 
m¶
::
boŞ_
<
çl£
>)

460 ià(cÚ¡ 
FunùÜ
* 
å
 = 
f
.
‹m¶©e
 
rg‘
<Functor>())

461  !
funùiÚ_equ®
(*
å
, 
g
);

462  
	gŒue
;

465 
	g‹m¶©e
<
ty³Çme
 
	gFunùiÚ
,y³Çm
	gFunùÜ
>

466 
boŞ


467 
com·»_nÙ_equ®
(cÚ¡ 
FunùiÚ
& 
f
,

468 cÚ¡ 
»ã»nû_w¿µ”
<
FunùÜ
>& 
g
, ,

469 
m¶
::
boŞ_
<
çl£
>)

471 ià(cÚ¡ 
FunùÜ
* 
å
 = 
f
.
‹m¶©e
 
rg‘
<Functor>())

472  
å
 !ğ
g
.
g‘_poš‹r
();

473  
	gŒue
;

481 
	svbË_ba£


483 (*
	gmªag”
)(cÚ¡ 
	gfunùiÚ_bufãr
& 
	gš_bufãr
,

484 
	gfunùiÚ_bufãr
& 
	gout_bufãr
,

485 
funùÜ_mªag”_İ”©iÚ_ty³
 
	gİ
);

496 şas 
	cfunùiÚ_ba£


498 
	gpublic
:

499 
funùiÚ_ba£
(è: 
vbË
(0) { }

502 
boŞ
 
em±y
(ècÚ¡ {  !
vbË
; }

506 cÚ¡ 
	gBOOST_FUNCTION_STD_NS
::
ty³_šfo
& 
rg‘_ty³
() const

508 ià(!
vbË
è 
ty³id
();

510 
	gd‘a
::
funùiÚ
::
funùiÚ_bufãr
 
ty³
;

511 
	gvbË
->
mªag”
(
funùÜ
, 
ty³
, 
d‘a
::
funùiÚ
::
g‘_funùÜ_ty³_g
);

512  *
	g¡©ic_ÿ¡
<cÚ¡ 
	gBOOST_FUNCTION_STD_NS
::
ty³_šfo
*>(
ty³
.
cÚ¡_obj_±r
);

515 
	g‹m¶©e
<
ty³Çme
 
	gFunùÜ
>

516 
FunùÜ
* 
rg‘
()

518 ià(!
	gvbË
)  0;

520 
	gd‘a
::
funùiÚ
::
funùiÚ_bufãr
 
ty³_»suÉ
;

521 
	gty³_»suÉ
.
	gcÚ¡_obj_±r
 = &
ty³id
(
FunùÜ
);

522 
	gvbË
->
mªag”
(
funùÜ
, 
ty³_»suÉ
,

523 
d‘a
::
funùiÚ
::
check_funùÜ_ty³_g
);

524  
	g¡©ic_ÿ¡
<
	gFunùÜ
*>(
	gty³_»suÉ
.
	gobj_±r
);

527 
	g‹m¶©e
<
ty³Çme
 
	gFunùÜ
>

528 #ià
defšed
(
BOOST_MSVC
è&& 
BOOST_WORKAROUND
(BOOST_MSVC, < 1300)

529 cÚ¡ 
FunùÜ
* 
rg‘
( Functor * = 0 ) const

531 cÚ¡ 
FunùÜ
* 
rg‘
() const

534 ià(!
vbË
)  0;

536 
	gd‘a
::
funùiÚ
::
funùiÚ_bufãr
 
ty³_»suÉ
;

537 
	gty³_»suÉ
.
	gcÚ¡_obj_±r
 = &
ty³id
(
FunùÜ
);

538 
	gvbË
->
mªag”
(
funùÜ
, 
ty³_»suÉ
,

539 
d‘a
::
funùiÚ
::
check_funùÜ_ty³_g
);

542  (cÚ¡ 
	gFunùÜ
*)(
	gty³_»suÉ
.
	gobj_±r
);

545 
	g‹m¶©e
<
ty³Çme
 
	gF
>

546 
boŞ
 
cÚšs
(cÚ¡ 
F
& 
f
) const

548 #ià
defšed
(
BOOST_MSVC
è&& 
BOOST_WORKAROUND
(BOOST_MSVC, < 1300)

549 ià(cÚ¡ 
F
* 
	gå
 = 
this
->
rg‘
( (F*)0 ))

551 ià(cÚ¡ 
F
* 
å
 = 
this
->
‹m¶©e
 
rg‘
<F>())

554  
funùiÚ_equ®
(*
å
, 
f
);

556  
	gçl£
;

560 #ià
defšed
(
__GNUC__
è&& __GNUC__ =ğ3 && 
__GNUC_MINOR__
 <= 3

564 
	g‹m¶©e
<
ty³Çme
 
	gFunùÜ
>

565 
BOOST_FUNCTION_ENABLE_IF_NOT_INTEGRAL
(
FunùÜ
, 
boŞ
)

566 
	gİ”©Ü
==(
FunùÜ
 
g
) const

568 ià(cÚ¡ 
FunùÜ
* 
å
 = 
rg‘
<Functor>())

569  
funùiÚ_equ®
(*
å
, 
g
);

570  
	gçl£
;

573 
	g‹m¶©e
<
ty³Çme
 
	gFunùÜ
>

574 
BOOST_FUNCTION_ENABLE_IF_NOT_INTEGRAL
(
FunùÜ
, 
boŞ
)

575 
	gİ”©Ü
!=(
FunùÜ
 
g
) const

577 ià(cÚ¡ 
FunùÜ
* 
å
 = 
rg‘
<Functor>())

578  !
funùiÚ_equ®
(*
å
, 
g
);

579  
	gŒue
;

583 
	gpublic
:

584 cÚ¡ 
d‘a
::
funùiÚ
::
vbË_ba£
* 
vbË
;

585 
mubË
 
	gd‘a
::
funùiÚ
::
funùiÚ_bufãr
 
funùÜ
;

592 şas 
	cbad_funùiÚ_ÿÎ
 : 
public
 
¡d
::
ruÁime_”rÜ


594 
public
:

595 
bad_funùiÚ_ÿÎ
(è: 
¡d
::
ruÁime_”rÜ
("calloƒmpty boost::function") {}

598 #iâdeà
BOOST_NO_SFINAE


599 
šlše
 
boŞ
 
	gİ”©Ü
==(cÚ¡ 
funùiÚ_ba£
& 
f
,

600 
	gd‘a
::
funùiÚ
::
u£Ëss_ş—r_ty³
*)

602  
f
.
em±y
();

605 
šlše
 
boŞ
 
	gİ”©Ü
!=(cÚ¡ 
funùiÚ_ba£
& 
f
,

606 
	gd‘a
::
funùiÚ
::
u£Ëss_ş—r_ty³
*)

608  !
f
.
em±y
();

611 
šlše
 
boŞ
 
	gİ”©Ü
==(
d‘a
::
funùiÚ
::
u£Ëss_ş—r_ty³
*,

612 cÚ¡ 
	gfunùiÚ_ba£
& 
	gf
)

614  
	gf
.
em±y
();

617 
šlše
 
boŞ
 
	gİ”©Ü
!=(
d‘a
::
funùiÚ
::
u£Ëss_ş—r_ty³
*,

618 cÚ¡ 
	gfunùiÚ_ba£
& 
	gf
)

620  !
	gf
.
em±y
();

624 #ifdeà
BOOST_NO_SFINAE


626 
	g‹m¶©e
<
ty³Çme
 
	gFunùÜ
>

627 
šlše
 
boŞ
 
	gİ”©Ü
==(cÚ¡ 
funùiÚ_ba£
& 
f
, 
FunùÜ
 
	gg
)

629 
	gm¶
::
	tboŞ_
<(
	tis_š‹g¿l
<
	tFunùÜ
>::
	tv®ue
)> 
	tš‹g¿l
;

630  
	gd‘a
::
funùiÚ
::
com·»_equ®
(
f
, 
g
, 0, 
š‹g¿l
());

633 
	g‹m¶©e
<
ty³Çme
 
	gFunùÜ
>

634 
šlše
 
boŞ
 
	gİ”©Ü
==(
FunùÜ
 
g
, cÚ¡ 
	gfunùiÚ_ba£
& 
	gf
)

636 
	gm¶
::
	tboŞ_
<(
	tis_š‹g¿l
<
	tFunùÜ
>::
	tv®ue
)> 
	tš‹g¿l
;

637  
	gd‘a
::
funùiÚ
::
com·»_equ®
(
f
, 
g
, 0, 
š‹g¿l
());

640 
	g‹m¶©e
<
ty³Çme
 
	gFunùÜ
>

641 
šlše
 
boŞ
 
	gİ”©Ü
!=(cÚ¡ 
funùiÚ_ba£
& 
f
, 
FunùÜ
 
	gg
)

643 
	gm¶
::
	tboŞ_
<(
	tis_š‹g¿l
<
	tFunùÜ
>::
	tv®ue
)> 
	tš‹g¿l
;

644  
	gd‘a
::
funùiÚ
::
com·»_nÙ_equ®
(
f
, 
g
, 0, 
š‹g¿l
());

647 
	g‹m¶©e
<
ty³Çme
 
	gFunùÜ
>

648 
šlše
 
boŞ
 
	gİ”©Ü
!=(
FunùÜ
 
g
, cÚ¡ 
	gfunùiÚ_ba£
& 
	gf
)

650 
	gm¶
::
	tboŞ_
<(
	tis_š‹g¿l
<
	tFunùÜ
>::
	tv®ue
)> 
	tš‹g¿l
;

651  
	gd‘a
::
funùiÚ
::
com·»_nÙ_equ®
(
f
, 
g
, 0, 
š‹g¿l
());

655 #ià!(
defšed
(
__GNUC__
è&& __GNUC__ =ğ3 && 
__GNUC_MINOR__
 <= 3)

659 
	g‹m¶©e
<
ty³Çme
 
	gFunùÜ
>

660 
	$BOOST_FUNCTION_ENABLE_IF_NOT_INTEGRAL
(
FunùÜ
, 
boŞ
)

661 
İ”©Ü
==(cÚ¡ 
funùiÚ_ba£
& 
f
, 
FunùÜ
 
g
)

663 ià(cÚ¡ 
FunùÜ
* 
å
 = 
f
.
‹m¶©e
 
rg‘
<Functor>())

664  
	`funùiÚ_equ®
(*
å
, 
g
);

665  
çl£
;

666 
	}
}

668 
	g‹m¶©e
<
ty³Çme
 
	gFunùÜ
>

669 
	$BOOST_FUNCTION_ENABLE_IF_NOT_INTEGRAL
(
FunùÜ
, 
boŞ
)

670 
İ”©Ü
==(
FunùÜ
 
g
, cÚ¡ 
funùiÚ_ba£
& 
f
)

672 ià(cÚ¡ 
FunùÜ
* 
å
 = 
f
.
‹m¶©e
 
rg‘
<Functor>())

673  
	`funùiÚ_equ®
(
g
, *
å
);

674  
çl£
;

675 
	}
}

677 
	g‹m¶©e
<
ty³Çme
 
	gFunùÜ
>

678 
	$BOOST_FUNCTION_ENABLE_IF_NOT_INTEGRAL
(
FunùÜ
, 
boŞ
)

679 
İ”©Ü
!=(cÚ¡ 
funùiÚ_ba£
& 
f
, 
FunùÜ
 
g
)

681 ià(cÚ¡ 
FunùÜ
* 
å
 = 
f
.
‹m¶©e
 
rg‘
<Functor>())

682  !
	`funùiÚ_equ®
(*
å
, 
g
);

683  
Œue
;

684 
	}
}

686 
	g‹m¶©e
<
ty³Çme
 
	gFunùÜ
>

687 
	$BOOST_FUNCTION_ENABLE_IF_NOT_INTEGRAL
(
FunùÜ
, 
boŞ
)

688 
İ”©Ü
!=(
FunùÜ
 
g
, cÚ¡ 
funùiÚ_ba£
& 
f
)

690 ià(cÚ¡ 
FunùÜ
* 
å
 = 
f
.
‹m¶©e
 
rg‘
<Functor>())

691  !
	`funùiÚ_equ®
(
g
, *
å
);

692  
Œue
;

693 
	}
}

696 
	g‹m¶©e
<
ty³Çme
 
	gFunùÜ
>

697 
	$BOOST_FUNCTION_ENABLE_IF_NOT_INTEGRAL
(
FunùÜ
, 
boŞ
)

698 
İ”©Ü
==(cÚ¡ 
funùiÚ_ba£
& 
f
, 
»ã»nû_w¿µ”
<
FunùÜ
> 
g
)

700 ià(cÚ¡ 
FunùÜ
* 
å
 = 
f
.
‹m¶©e
 
rg‘
<Functor>())

701  
å
 =ğ
g
.
	`g‘_poš‹r
();

702  
çl£
;

703 
	}
}

705 
	g‹m¶©e
<
ty³Çme
 
	gFunùÜ
>

706 
	$BOOST_FUNCTION_ENABLE_IF_NOT_INTEGRAL
(
FunùÜ
, 
boŞ
)

707 
İ”©Ü
==(
»ã»nû_w¿µ”
<
FunùÜ
> 
g
, cÚ¡ 
funùiÚ_ba£
& 
f
)

709 ià(cÚ¡ 
FunùÜ
* 
å
 = 
f
.
‹m¶©e
 
rg‘
<Functor>())

710  
g
.
	`g‘_poš‹r
(è=ğ
å
;

711  
çl£
;

712 
	}
}

714 
	g‹m¶©e
<
ty³Çme
 
	gFunùÜ
>

715 
	$BOOST_FUNCTION_ENABLE_IF_NOT_INTEGRAL
(
FunùÜ
, 
boŞ
)

716 
İ”©Ü
!=(cÚ¡ 
funùiÚ_ba£
& 
f
, 
»ã»nû_w¿µ”
<
FunùÜ
> 
g
)

718 ià(cÚ¡ 
FunùÜ
* 
å
 = 
f
.
‹m¶©e
 
rg‘
<Functor>())

719  
å
 !ğ
g
.
	`g‘_poš‹r
();

720  
Œue
;

721 
	}
}

723 
	g‹m¶©e
<
ty³Çme
 
	gFunùÜ
>

724 
	$BOOST_FUNCTION_ENABLE_IF_NOT_INTEGRAL
(
FunùÜ
, 
boŞ
)

725 
İ”©Ü
!=(
»ã»nû_w¿µ”
<
FunùÜ
> 
g
, cÚ¡ 
funùiÚ_ba£
& 
f
)

727 ià(cÚ¡ 
FunùÜ
* 
å
 = 
f
.
‹m¶©e
 
rg‘
<Functor>())

728  
g
.
	`g‘_poš‹r
(è!ğ
å
;

729  
Œue
;

730 
	}
}

734 
Çme¥aû
 
	gd‘a
 {

735 
Çme¥aû
 
	gfunùiÚ
 {

736 
šlše
 
boŞ
 
has_em±y_rg‘
(cÚ¡ 
funùiÚ_ba£
* 
f
)

738  
	gf
->
em±y
();

741 #ià
BOOST_WORKAROUND
(
BOOST_MSVC
, <= 1310)

742 
šlše
 
boŞ
 
has_em±y_rg‘
(const *)

744  
	gçl£
;

747 
šlše
 
boŞ
 
has_em±y_rg‘
(...)

749  
	gçl£
;

756 #undeà
BOOST_FUNCTION_ENABLE_IF_NOT_INTEGRAL


757 #undeà
BOOST_FUNCTION_COMPARE_TYPE_ID


759 #ià
defšed
(
BOOST_MSVC
)

760 #´agm¨
w¬nšg
Ğ
pİ
 )

	@/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/boost-1_34-fix/boost/function/function_template.hpp

12 
	~<boo¡/funùiÚ/d‘a/´Şogue.hµ
>

14 #ià
defšed
(
BOOST_MSVC
)

15 #´agm¨
w¬nšg
Ğ
push
 )

16 #´agm¨
w¬nšg
Ğ
di§bË
 : 4127 )

19 
	#BOOST_FUNCTION_TEMPLATE_PARMS
 
	`BOOST_PP_ENUM_PARAMS
(
BOOST_FUNCTION_NUM_ARGS
, 
ty³Çme
 
T
)

	)

21 
	#BOOST_FUNCTION_TEMPLATE_ARGS
 
	`BOOST_PP_ENUM_PARAMS
(
BOOST_FUNCTION_NUM_ARGS
, 
T
)

	)

23 
	#BOOST_FUNCTION_PARM
(
J
,
I
,
D
è
	`BOOST_PP_CAT
(
T
,IèBOOST_PP_CAT(
a
,I)

	)

25 
	#BOOST_FUNCTION_PARMS
 
	`BOOST_PP_ENUM
(
BOOST_FUNCTION_NUM_ARGS
,
BOOST_FUNCTION_PARM
,
BOOST_PP_EMPTY
)

	)

27 
	#BOOST_FUNCTION_ARGS
 
	`BOOST_PP_ENUM_PARAMS
(
BOOST_FUNCTION_NUM_ARGS
, 
a
)

	)

29 
	#BOOST_FUNCTION_ARG_TYPE
(
J
,
I
,
D
) \

30 
	`BOOST_PP_CAT
(
	tT
,
	tI
è
	tBOOST_PP_CAT
(BOOST_PP_CAT(
	t¬g
, 
	tBOOST_PP_INC
(I)),
	t_ty³
);

	)

32 
	#BOOST_FUNCTION_ARG_TYPES
 
	`BOOST_PP_REPEAT
(
BOOST_FUNCTION_NUM_ARGS
,
BOOST_FUNCTION_ARG_TYPE
,
BOOST_PP_EMPTY
)

	)

35 #iâdeà
BOOST_NO_STD_ALLOCATOR


36 
	#BOOST_FUNCTION_DEFAULT_ALLOCATOR
 
¡d
::
®loÿtÜ
<
funùiÚ_ba£
>

	)

38 
	#BOOST_FUNCTION_DEFAULT_ALLOCATOR
 

	)

42 #ià
BOOST_FUNCTION_NUM_ARGS
 == 0

43 
	#BOOST_FUNCTION_COMMA


	)

45 
	#BOOST_FUNCTION_COMMA
 ,

	)

49 
	#BOOST_FUNCTION_FUNCTION
 
	`BOOST_JOIN
(
funùiÚ
,
BOOST_FUNCTION_NUM_ARGS
)

	)

50 
	#BOOST_FUNCTION_FUNCTION_INVOKER
 \

51 
	`BOOST_JOIN
(
funùiÚ_švok”
,
BOOST_FUNCTION_NUM_ARGS
)

	)

52 
	#BOOST_FUNCTION_VOID_FUNCTION_INVOKER
 \

53 
	`BOOST_JOIN
(
void_funùiÚ_švok”
,
BOOST_FUNCTION_NUM_ARGS
)

	)

54 
	#BOOST_FUNCTION_FUNCTION_OBJ_INVOKER
 \

55 
	`BOOST_JOIN
(
funùiÚ_obj_švok”
,
BOOST_FUNCTION_NUM_ARGS
)

	)

56 
	#BOOST_FUNCTION_VOID_FUNCTION_OBJ_INVOKER
 \

57 
	`BOOST_JOIN
(
void_funùiÚ_obj_švok”
,
BOOST_FUNCTION_NUM_ARGS
)

	)

58 
	#BOOST_FUNCTION_FUNCTION_REF_INVOKER
 \

59 
	`BOOST_JOIN
(
funùiÚ_»f_švok”
,
BOOST_FUNCTION_NUM_ARGS
)

	)

60 
	#BOOST_FUNCTION_VOID_FUNCTION_REF_INVOKER
 \

61 
	`BOOST_JOIN
(
void_funùiÚ_»f_švok”
,
BOOST_FUNCTION_NUM_ARGS
)

	)

62 
	#BOOST_FUNCTION_MEMBER_INVOKER
 \

63 
	`BOOST_JOIN
(
memb”_švok”
,
BOOST_FUNCTION_NUM_ARGS
)

	)

64 
	#BOOST_FUNCTION_VOID_MEMBER_INVOKER
 \

65 
	`BOOST_JOIN
(
void_memb”_švok”
,
BOOST_FUNCTION_NUM_ARGS
)

	)

66 
	#BOOST_FUNCTION_GET_FUNCTION_INVOKER
 \

67 
	`BOOST_JOIN
(
g‘_funùiÚ_švok”
,
BOOST_FUNCTION_NUM_ARGS
)

	)

68 
	#BOOST_FUNCTION_GET_FUNCTION_OBJ_INVOKER
 \

69 
	`BOOST_JOIN
(
g‘_funùiÚ_obj_švok”
,
BOOST_FUNCTION_NUM_ARGS
)

	)

70 
	#BOOST_FUNCTION_GET_FUNCTION_REF_INVOKER
 \

71 
	`BOOST_JOIN
(
g‘_funùiÚ_»f_švok”
,
BOOST_FUNCTION_NUM_ARGS
)

	)

72 
	#BOOST_FUNCTION_GET_MEMBER_INVOKER
 \

73 
	`BOOST_JOIN
(
g‘_memb”_švok”
,
BOOST_FUNCTION_NUM_ARGS
)

	)

74 
	#BOOST_FUNCTION_GET_INVOKER
 \

75 
	`BOOST_JOIN
(
g‘_švok”
,
BOOST_FUNCTION_NUM_ARGS
)

	)

76 
	#BOOST_FUNCTION_VTABLE
 
	`BOOST_JOIN
(
basic_vbË
,
BOOST_FUNCTION_NUM_ARGS
)

	)

78 #iâdeà
BOOST_NO_VOID_RETURNS


79 
	#BOOST_FUNCTION_VOID_RETURN_TYPE
 

	)

80 
	#BOOST_FUNCTION_RETURN
(
X
è
	)
X

82 
	#BOOST_FUNCTION_VOID_RETURN_TYPE
 
boo¡
::
d‘a
::
funùiÚ
::
unu§bË


	)

83 
	#BOOST_FUNCTION_RETURN
(
X
èX;  
	`BOOST_FUNCTION_VOID_RETURN_TYPE
 ()

	)

86 
Çme¥aû
 
	gboo¡
 {

87 
Çme¥aû
 
	gd‘a
 {

88 
Çme¥aû
 
	gfunùiÚ
 {

89 
	g‹m¶©e
<

90 
ty³Çme
 
	gFunùiÚPŒ
,

91 
ty³Çme
 
R
 
BOOST_FUNCTION_COMMA


92 
	gBOOST_FUNCTION_TEMPLATE_PARMS


94 
	sBOOST_FUNCTION_FUNCTION_INVOKER


96 
R
 
švoke
(
funùiÚ_bufãr
& 
funùiÚ_±r
 
BOOST_FUNCTION_COMMA


97 
BOOST_FUNCTION_PARMS
)

99 
FunùiÚPŒ
 
	gf
 = 
»š‹½»t_ÿ¡
<FunùiÚPŒ>(
funùiÚ_±r
.
func_±r
);

100  
f
(
BOOST_FUNCTION_ARGS
);

104 
	g‹m¶©e
<

105 
ty³Çme
 
	gFunùiÚPŒ
,

106 
ty³Çme
 
R
 
BOOST_FUNCTION_COMMA


107 
	gBOOST_FUNCTION_TEMPLATE_PARMS


109 
	sBOOST_FUNCTION_VOID_FUNCTION_INVOKER


111 
BOOST_FUNCTION_VOID_RETURN_TYPE


112 
švoke
(
funùiÚ_bufãr
& 
funùiÚ_±r
 
BOOST_FUNCTION_COMMA


113 
BOOST_FUNCTION_PARMS
)

116 
FunùiÚPŒ
 
	gf
 = 
»š‹½»t_ÿ¡
<FunùiÚPŒ>(
funùiÚ_±r
.
func_±r
);

117 
BOOST_FUNCTION_RETURN
(
f
(
BOOST_FUNCTION_ARGS
));

121 
	g‹m¶©e
<

122 
ty³Çme
 
	gFunùiÚObj
,

123 
ty³Çme
 
R
 
BOOST_FUNCTION_COMMA


124 
	gBOOST_FUNCTION_TEMPLATE_PARMS


126 
	sBOOST_FUNCTION_FUNCTION_OBJ_INVOKER


128 
R
 
švoke
(
funùiÚ_bufãr
& 
funùiÚ_obj_±r
 
BOOST_FUNCTION_COMMA


129 
BOOST_FUNCTION_PARMS
)

132 
FunùiÚObj
* 
	gf
;

133 ià(
	gfunùiÚ_®lows_sm®l_objeù_İtimiz©iÚ
<
	gFunùiÚObj
>::
v®ue
)

134 
f
 = 
»š‹½»t_ÿ¡
<
FunùiÚObj
*>(&
funùiÚ_obj_±r
.
d©a
);

136 
	gf
 = 
»š‹½»t_ÿ¡
<
FunùiÚObj
*>(
funùiÚ_obj_±r
.
obj_±r
);

137  (*
	gf
)(
	gBOOST_FUNCTION_ARGS
);

141 
	g‹m¶©e
<

142 
ty³Çme
 
	gFunùiÚObj
,

143 
ty³Çme
 
R
 
BOOST_FUNCTION_COMMA


144 
	gBOOST_FUNCTION_TEMPLATE_PARMS


146 
	sBOOST_FUNCTION_VOID_FUNCTION_OBJ_INVOKER


148 
BOOST_FUNCTION_VOID_RETURN_TYPE


149 
švoke
(
funùiÚ_bufãr
& 
funùiÚ_obj_±r
 
BOOST_FUNCTION_COMMA


150 
BOOST_FUNCTION_PARMS
)

153 
FunùiÚObj
* 
	gf
;

154 ià(
	gfunùiÚ_®lows_sm®l_objeù_İtimiz©iÚ
<
	gFunùiÚObj
>::
v®ue
)

155 
f
 = 
»š‹½»t_ÿ¡
<
FunùiÚObj
*>(&
funùiÚ_obj_±r
.
d©a
);

157 
	gf
 = 
»š‹½»t_ÿ¡
<
FunùiÚObj
*>(
funùiÚ_obj_±r
.
obj_±r
);

158 
BOOST_FUNCTION_RETURN
((*
f
)(
BOOST_FUNCTION_ARGS
));

162 
	g‹m¶©e
<

163 
ty³Çme
 
	gFunùiÚObj
,

164 
ty³Çme
 
R
 
BOOST_FUNCTION_COMMA


165 
	gBOOST_FUNCTION_TEMPLATE_PARMS


167 
	sBOOST_FUNCTION_FUNCTION_REF_INVOKER


169 
R
 
švoke
(
funùiÚ_bufãr
& 
funùiÚ_obj_±r
 
BOOST_FUNCTION_COMMA


170 
BOOST_FUNCTION_PARMS
)

173 
FunùiÚObj
* 
	gf
 =

174 
»š‹½»t_ÿ¡
<
FunùiÚObj
*>(
funùiÚ_obj_±r
.
obj_±r
);

175  (*
	gf
)(
	gBOOST_FUNCTION_ARGS
);

179 
	g‹m¶©e
<

180 
ty³Çme
 
	gFunùiÚObj
,

181 
ty³Çme
 
R
 
BOOST_FUNCTION_COMMA


182 
	gBOOST_FUNCTION_TEMPLATE_PARMS


184 
	sBOOST_FUNCTION_VOID_FUNCTION_REF_INVOKER


186 
BOOST_FUNCTION_VOID_RETURN_TYPE


187 
švoke
(
funùiÚ_bufãr
& 
funùiÚ_obj_±r
 
BOOST_FUNCTION_COMMA


188 
BOOST_FUNCTION_PARMS
)

191 
FunùiÚObj
* 
	gf
 =

192 
»š‹½»t_ÿ¡
<
FunùiÚObj
*>(
funùiÚ_obj_±r
.
obj_±r
);

193 
BOOST_FUNCTION_RETURN
((*
f
)(
BOOST_FUNCTION_ARGS
));

197 #ià
BOOST_FUNCTION_NUM_ARGS
 > 0

199 
	g‹m¶©e
<

200 
ty³Çme
 
	gMemb”PŒ
,

201 
ty³Çme
 
R
 
BOOST_FUNCTION_COMMA


202 
	gBOOST_FUNCTION_TEMPLATE_PARMS


204 
	sBOOST_FUNCTION_MEMBER_INVOKER


206 
R
 
švoke
(
funùiÚ_bufãr
& 
funùiÚ_obj_±r
 
BOOST_FUNCTION_COMMA


207 
BOOST_FUNCTION_PARMS
)

210 
Memb”PŒ
* 
	gf
 =

211 
»š‹½»t_ÿ¡
<
Memb”PŒ
*>(&
funùiÚ_obj_±r
.
d©a
);

212  
	gboo¡
::
mem_â
(*
f
)(
BOOST_FUNCTION_ARGS
);

216 
	g‹m¶©e
<

217 
ty³Çme
 
	gMemb”PŒ
,

218 
ty³Çme
 
R
 
BOOST_FUNCTION_COMMA


219 
	gBOOST_FUNCTION_TEMPLATE_PARMS


221 
	sBOOST_FUNCTION_VOID_MEMBER_INVOKER


223 
BOOST_FUNCTION_VOID_RETURN_TYPE


224 
švoke
(
funùiÚ_bufãr
& 
funùiÚ_obj_±r
 
BOOST_FUNCTION_COMMA


225 
BOOST_FUNCTION_PARMS
)

228 
Memb”PŒ
* 
	gf
 =

229 
»š‹½»t_ÿ¡
<
Memb”PŒ
*>(&
funùiÚ_obj_±r
.
d©a
);

230 
BOOST_FUNCTION_RETURN
(
boo¡
::
mem_â
(*
f
)(
BOOST_FUNCTION_ARGS
));

235 
	g‹m¶©e
<

236 
ty³Çme
 
	gFunùiÚPŒ
,

237 
ty³Çme
 
R
 
BOOST_FUNCTION_COMMA


238 
	gBOOST_FUNCTION_TEMPLATE_PARMS


240 
	sBOOST_FUNCTION_GET_FUNCTION_INVOKER


242 
ty³Çme
 
	tm¶
::
	tif_c
<(
	tis_void
<
	tR
>::
	tv®ue
),

243 
	tBOOST_FUNCTION_VOID_FUNCTION_INVOKER
<

244 
	tFunùiÚPŒ
,

245 
	tR
 
	tBOOST_FUNCTION_COMMA


246 
	tBOOST_FUNCTION_TEMPLATE_ARGS


248 
	tBOOST_FUNCTION_FUNCTION_INVOKER
<

249 
	tFunùiÚPŒ
,

250 
	tR
 
	tBOOST_FUNCTION_COMMA


251 
	tBOOST_FUNCTION_TEMPLATE_ARGS


253 >::
	tty³
ype;

256 
	g‹m¶©e
<

257 
ty³Çme
 
	gFunùiÚObj
,

258 
ty³Çme
 
R
 
BOOST_FUNCTION_COMMA


259 
	gBOOST_FUNCTION_TEMPLATE_PARMS


261 
	sBOOST_FUNCTION_GET_FUNCTION_OBJ_INVOKER


263 
ty³Çme
 
	tm¶
::
	tif_c
<(
	tis_void
<
	tR
>::
	tv®ue
),

264 
	tBOOST_FUNCTION_VOID_FUNCTION_OBJ_INVOKER
<

265 
	tFunùiÚObj
,

266 
	tR
 
	tBOOST_FUNCTION_COMMA


267 
	tBOOST_FUNCTION_TEMPLATE_ARGS


269 
	tBOOST_FUNCTION_FUNCTION_OBJ_INVOKER
<

270 
	tFunùiÚObj
,

271 
	tR
 
	tBOOST_FUNCTION_COMMA


272 
	tBOOST_FUNCTION_TEMPLATE_ARGS


274 >::
	tty³
ype;

277 
	g‹m¶©e
<

278 
ty³Çme
 
	gFunùiÚObj
,

279 
ty³Çme
 
R
 
BOOST_FUNCTION_COMMA


280 
	gBOOST_FUNCTION_TEMPLATE_PARMS


282 
	sBOOST_FUNCTION_GET_FUNCTION_REF_INVOKER


284 
ty³Çme
 
	tm¶
::
	tif_c
<(
	tis_void
<
	tR
>::
	tv®ue
),

285 
	tBOOST_FUNCTION_VOID_FUNCTION_REF_INVOKER
<

286 
	tFunùiÚObj
,

287 
	tR
 
	tBOOST_FUNCTION_COMMA


288 
	tBOOST_FUNCTION_TEMPLATE_ARGS


290 
	tBOOST_FUNCTION_FUNCTION_REF_INVOKER
<

291 
	tFunùiÚObj
,

292 
	tR
 
	tBOOST_FUNCTION_COMMA


293 
	tBOOST_FUNCTION_TEMPLATE_ARGS


295 >::
	tty³
ype;

298 #ià
BOOST_FUNCTION_NUM_ARGS
 > 0

300 
	g‹m¶©e
<

301 
ty³Çme
 
	gMemb”PŒ
,

302 
ty³Çme
 
R
 
BOOST_FUNCTION_COMMA


303 
	gBOOST_FUNCTION_TEMPLATE_PARMS


305 
	sBOOST_FUNCTION_GET_MEMBER_INVOKER


307 
ty³Çme
 
	tm¶
::
	tif_c
<(
	tis_void
<
	tR
>::
	tv®ue
),

308 
	tBOOST_FUNCTION_VOID_MEMBER_INVOKER
<

309 
	tMemb”PŒ
,

310 
	tR
 
	tBOOST_FUNCTION_COMMA


311 
	tBOOST_FUNCTION_TEMPLATE_ARGS


313 
	tBOOST_FUNCTION_MEMBER_INVOKER
<

314 
	tMemb”PŒ
,

315 
	tR
 
	tBOOST_FUNCTION_COMMA


316 
	tBOOST_FUNCTION_TEMPLATE_ARGS


318 >::
	tty³
ype;

331 
	g‹m¶©e
<
ty³Çme
 
	gTag
>

332 
	sBOOST_FUNCTION_GET_INVOKER
 { };

335 
	g‹m¶©e
<>

336 
	gBOOST_FUNCTION_GET_INVOKER
<
	gfunùiÚ_±r_g
>

338 
	g‹m¶©e
<
ty³Çme
 
	gFunùiÚPŒ
,

339 
ty³Çme
 
R
 
BOOST_FUNCTION_COMMA
 
	gBOOST_FUNCTION_TEMPLATE_PARMS
,

340 
ty³Çme
 
	gAÎoÿtÜ
>

341 
	s­¶y


343 
ty³Çme
 
	tBOOST_FUNCTION_GET_FUNCTION_INVOKER
<

344 
	tFunùiÚPŒ
,

345 
	tR
 
	tBOOST_FUNCTION_COMMA


346 
	tBOOST_FUNCTION_TEMPLATE_ARGS


347 >::
	tty³


348 
	tšvok”_ty³
;

350 
	gfunùÜ_mªag”
<
	tFunùiÚPŒ
, 
	tAÎoÿtÜ
> 
	tmªag”_ty³
;

354 #ià
BOOST_FUNCTION_NUM_ARGS
 > 0

356 
	g‹m¶©e
<>

357 
	gBOOST_FUNCTION_GET_INVOKER
<
	gmemb”_±r_g
>

359 
	g‹m¶©e
<
ty³Çme
 
	gMemb”PŒ
,

360 
ty³Çme
 
R
 
BOOST_FUNCTION_COMMA
 
	gBOOST_FUNCTION_TEMPLATE_PARMS
,

361 
ty³Çme
 
	gAÎoÿtÜ
>

362 
	s­¶y


364 
ty³Çme
 
	tBOOST_FUNCTION_GET_MEMBER_INVOKER
<

365 
	tMemb”PŒ
,

366 
	tR
 
	tBOOST_FUNCTION_COMMA


367 
	tBOOST_FUNCTION_TEMPLATE_ARGS


368 >::
	tty³


369 
	tšvok”_ty³
;

371 
	gfunùÜ_mªag”
<
	tMemb”PŒ
, 
	tAÎoÿtÜ
> 
	tmªag”_ty³
;

377 
	g‹m¶©e
<>

378 
	gBOOST_FUNCTION_GET_INVOKER
<
	gfunùiÚ_obj_g
>

380 
	g‹m¶©e
<
ty³Çme
 
	gFunùiÚObj
,

381 
ty³Çme
 
R
 
BOOST_FUNCTION_COMMA
 
	gBOOST_FUNCTION_TEMPLATE_PARMS
,

382 
ty³Çme
 
	gAÎoÿtÜ
>

383 
	s­¶y


385 
ty³Çme
 
	tBOOST_FUNCTION_GET_FUNCTION_OBJ_INVOKER
<

386 
	tFunùiÚObj
,

387 
	tR
 
	tBOOST_FUNCTION_COMMA


388 
	tBOOST_FUNCTION_TEMPLATE_ARGS


389 >::
	tty³


390 
	tšvok”_ty³
;

392 
	gfunùÜ_mªag”
<
	tFunùiÚObj
, 
	tAÎoÿtÜ
> 
	tmªag”_ty³
;

397 
	g‹m¶©e
<>

398 
	gBOOST_FUNCTION_GET_INVOKER
<
	gfunùiÚ_obj_»f_g
>

400 
	g‹m¶©e
<
ty³Çme
 
	gRefW¿µ”
,

401 
ty³Çme
 
R
 
BOOST_FUNCTION_COMMA
 
	gBOOST_FUNCTION_TEMPLATE_PARMS
,

402 
ty³Çme
 
	gAÎoÿtÜ
>

403 
	s­¶y


405 
ty³Çme
 
	tBOOST_FUNCTION_GET_FUNCTION_REF_INVOKER
<

406 
	tty³Çme
 
	tRefW¿µ”
::
	tty³
,

407 
	tR
 
	tBOOST_FUNCTION_COMMA


408 
	tBOOST_FUNCTION_TEMPLATE_ARGS


409 >::
	tty³


410 
	tšvok”_ty³
;

412 
	g»ã»nû_mªag”
<
	tty³Çme
 
	tRefW¿µ”
::
	tty³
> 
	tmªag”_ty³
;

419 
	g‹m¶©e
<
ty³Çme
 
R
 
BOOST_FUNCTION_COMMA
 
	gBOOST_FUNCTION_TEMPLATE_PARMS
,

420 
ty³Çme
 
	gAÎoÿtÜ
>

421 
	sBOOST_FUNCTION_VTABLE


423 #iâdeà
BOOST_NO_VOID_RETURNS


424 
R
 
	t»suÉ_ty³
;

426 
ty³Çme
 
	tfunùiÚ_»tuº_ty³
<
	tR
>::
	tty³
 
	t»suÉ_ty³
;

429 
»suÉ_ty³
 (*
	tšvok”_ty³
)(
	tfunùiÚ_bufãr
&

430 
	tBOOST_FUNCTION_COMMA


431 
	tBOOST_FUNCTION_TEMPLATE_ARGS
);

433 
	g‹m¶©e
<
ty³Çme
 
	gF
>

434 
boŞ
 
assign_to
(cÚ¡ 
F
& 
f
, 
funùiÚ_bufãr
& 
funùÜ
) const

436 
ty³Çme
 
	tg‘_funùiÚ_g
<
	tF
>::
	tty³
 
	tg
;

437  
assign_to
(
f
, 
funùÜ
, 
g
());

440 
ş—r
(
funùiÚ_bufãr
& 
funùÜ
) const

442 ià(
	gba£
.
	gmªag”
)

443 
	gba£
.
mªag”
(
funùÜ
, funùÜ, 
de¡roy_funùÜ_g
);

445 #iâdeà
BOOST_NO_PRIVATE_IN_AGGREGATE


446 
	g´iv©e
:

449 
‹m¶©e
<
ty³Çme
 
FunùiÚPŒ
>

450 
boŞ


451 
assign_to
(
FunùiÚPŒ
 
f
, 
funùiÚ_bufãr
& 
funùÜ
,

452 
funùiÚ_±r_g
) const

454 
	gthis
->
ş—r
(
funùÜ
);

455 ià(
	gf
) {

458 
	gfunùÜ
.
	gfunc_±r
 = ((*)())(
f
);

459  
	gŒue
;

461  
	gçl£
;

466 #ià
BOOST_FUNCTION_NUM_ARGS
 > 0

467 
	g‹m¶©e
<
ty³Çme
 
	gMemb”PŒ
>

468 
boŞ


469 
assign_to
(
Memb”PŒ
 
f
, 
funùiÚ_bufãr
& 
funùÜ
, 
memb”_±r_g
) const

471 ià(
	gf
) {

474 
assign_funùÜ
(
f
, 
funùÜ
, 
m¶
::
Œue_
());

475  
	gŒue
;

477  
	gçl£
;

484 
	g‹m¶©e
<
ty³Çme
 
	gFunùiÚObj
>

486 
assign_funùÜ
(cÚ¡ 
FunùiÚObj
& 
f
, 
funùiÚ_bufãr
& 
funùÜ
,

487 
m¶
::
Œue_
) const

489 
Ãw
 ((*)&
funùÜ
.
d©a
è
FunùiÚObj
(
f
);

493 
	g‹m¶©e
<
ty³Çme
 
	gFunùiÚObj
>

495 
assign_funùÜ
(cÚ¡ 
FunùiÚObj
& 
f
, 
funùiÚ_bufãr
& 
funùÜ
,

496 
m¶
::
çl£_
) const

498 #iâdeà
BOOST_NO_STD_ALLOCATOR


499 
ty³Çme
 
	tAÎoÿtÜ
::
	t‹m¶©e
 
	t»bšd
<
	tFunùiÚObj
>::
	tÙh”


500 
	t®loÿtÜ_ty³
;

501 
ty³Çme
 
	t®loÿtÜ_ty³
::
	tpoš‹r
 
	tpoš‹r_ty³
;

503 
®loÿtÜ_ty³
 
	g®loÿtÜ
;

504 
poš‹r_ty³
 
	gcİy
 = 
®loÿtÜ
.
®loÿ‹
(1);

505 
	g®loÿtÜ
.
cÚ¡ruù
(
cİy
, 
f
);

508 
	gfunùÜ
.
	gobj_±r
 = 
¡©ic_ÿ¡
<
FunùiÚObj
*>(
cİy
);

510 
	gfunùÜ
.
	gobj_±r
 = 
Ãw
 
FunùiÚObj
(
f
);

514 
	g‹m¶©e
<
ty³Çme
 
	gFunùiÚObj
>

515 
boŞ


516 
assign_to
(cÚ¡ 
FunùiÚObj
& 
f
, 
funùiÚ_bufãr
& 
funùÜ
,

517 
funùiÚ_obj_g
) const

519 ià(!
	gboo¡
::
d‘a
::
funùiÚ
::
has_em±y_rg‘
(
boo¡
::
add»ssof
(
f
))) {

520 
assign_funùÜ
(
f
, 
funùÜ
,

521 
m¶
::
boŞ_
<(
funùiÚ_®lows_sm®l_objeù_İtimiz©iÚ
<
FunùiÚObj
>::
v®ue
)>());

522  
	gŒue
;

524  
	gçl£
;

529 
	g‹m¶©e
<
ty³Çme
 
	gFunùiÚObj
>

530 
boŞ


531 
assign_to
(cÚ¡ 
»ã»nû_w¿µ”
<
FunùiÚObj
>& 
f
,

532 
funùiÚ_bufãr
& 
funùÜ
, 
funùiÚ_obj_»f_g
) const

534 ià(!
	gboo¡
::
d‘a
::
funùiÚ
::
has_em±y_rg‘
(
f
.
g‘_poš‹r
())) {

539 
funùÜ
.
cÚ¡_obj_±r
 = 
f
.
g‘_poš‹r
();

540  
	gŒue
;

542  
	gçl£
;

546 
	gpublic
:

547 
vbË_ba£
 
ba£
;

548 
švok”_ty³
 
	gšvok”
;

553 
	g‹m¶©e
<

554 
ty³Çme
 
R
 
BOOST_FUNCTION_COMMA


555 
	gBOOST_FUNCTION_TEMPLATE_PARMS
,

556 
ty³Çme
 
	gAÎoÿtÜ
 = 
BOOST_FUNCTION_DEFAULT_ALLOCATOR


558 
şass
 
BOOST_FUNCTION_FUNCTION
 : 
public
 
funùiÚ_ba£


560 #ià
BOOST_FUNCTION_NUM_ARGS
 == 1

562 , 
public
 
	g¡d
::
uÇry_funùiÚ
<
T0
,
	gR
>

564 #–ià
BOOST_FUNCTION_NUM_ARGS
 == 2

566 , 
public
 
	g¡d
::
bš¬y_funùiÚ
<
T0
,
	gT1
,
	gR
>

571 
	gpublic
:

572 #iâdeà
BOOST_NO_VOID_RETURNS


573 
R
 
	t»suÉ_ty³
;

575 
ty³Çme
 
	tboo¡
::
	td‘a
::
	tfunùiÚ
::
	tfunùiÚ_»tuº_ty³
<
	tR
>::
	tty³


576 
	t»suÉ_ty³
;

579 
	g´iv©e
:

580 
boo¡
::
	td‘a
::
	tfunùiÚ
::
	tBOOST_FUNCTION_VTABLE
<

581 
	tR
 
	tBOOST_FUNCTION_COMMA
 
	tBOOST_FUNCTION_TEMPLATE_ARGS
, 
	tAÎoÿtÜ
>

582 
	tvbË_ty³
;

584 
	sş—r_ty³
 {};

586 
	gpublic
:

587 
BOOST_STATIC_CONSTANT
(, 
¬gs
 = 
BOOST_FUNCTION_NUM_ARGS
);

590 
	g‹m¶©e
<
ty³Çme
 
	gArgs
>

591 
	ssig


593 
»suÉ_ty³
 
	tty³
;

596 #ià
BOOST_FUNCTION_NUM_ARGS
 == 1

597 
T0
 
	t¬gum’t_ty³
;

598 #–ià
BOOST_FUNCTION_NUM_ARGS
 == 2

599 
T0
 
	tfœ¡_¬gum’t_ty³
;

600 
T1
 
	t£cÚd_¬gum’t_ty³
;

603 
BOOST_STATIC_CONSTANT
(, 
¬™y
 = 
BOOST_FUNCTION_NUM_ARGS
);

604 
BOOST_FUNCTION_ARG_TYPES


606 
AÎoÿtÜ
 
	t®loÿtÜ_ty³
;

607 
BOOST_FUNCTION_FUNCTION
 
	t£lf_ty³
;

609 
BOOST_FUNCTION_FUNCTION
(è: 
funùiÚ_ba£
() { }

613 
‹m¶©e
<
ty³Çme
 
FunùÜ
>

614 
BOOST_FUNCTION_FUNCTION
(
FunùÜ
 
BOOST_FUNCTION_TARGET_FIX
(cÚ¡ &è
f


615 #iâdeà
BOOST_NO_SFINAE


616 ,
ty³Çme
 
’abË_if_c
<

617 (
boo¡
::
ty³_Œa™s
::
iû_nÙ
<

618 (
is_š‹g¿l
<
FunùÜ
>::
v®ue
)>::value),

619 >::
ty³
 = 0

622 
funùiÚ_ba£
()

624 
this
->
assign_to
(
f
);

627 #iâdeà
BOOST_NO_SFINAE


628 
BOOST_FUNCTION_FUNCTION
(
ş—r_ty³
*è: 
funùiÚ_ba£
() { }

630 
BOOST_FUNCTION_FUNCTION
(
z”o
è: 
funùiÚ_ba£
()

632 
BOOST_ASSERT
(
z”o
 == 0);

636 
BOOST_FUNCTION_FUNCTION
(cÚ¡ BOOST_FUNCTION_FUNCTION& 
f
è: 
funùiÚ_ba£
()

638 
this
->
assign_to_own
(
f
);

641 ~
BOOST_FUNCTION_FUNCTION
(è{ 
ş—r
(); }

643 #ià
BOOST_WORKAROUND
(
BOOST_MSVC
, < 1300)

646 
»suÉ_ty³
 
İ”©Ü
()(
	gBOOST_FUNCTION_PARMS
) const

648 ià(
	gthis
->
em±y
())

649 
	gboo¡
::
throw_exû±iÚ
(
bad_funùiÚ_ÿÎ
());

651  
	g»š‹½»t_ÿ¡
<cÚ¡ 
	gvbË_ty³
*>(
	gvbË
)->
	gšvok”


652 (
	gthis
->
funùÜ
 
BOOST_FUNCTION_COMMA
 
	gBOOST_FUNCTION_ARGS
);

655 
»suÉ_ty³
 
İ”©Ü
()(
	gBOOST_FUNCTION_PARMS
) const;

663 
	g‹m¶©e
<
ty³Çme
 
	gFunùÜ
>

664 #iâdeà
BOOST_NO_SFINAE


665 
ty³Çme
 
	g’abË_if_c
<

666 (
	gboo¡
::
ty³_Œa™s
::
iû_nÙ
<

667 (
is_š‹g¿l
<
FunùÜ
>::
v®ue
)>::value),

668 
	gBOOST_FUNCTION_FUNCTION
&>::
ty³


670 
BOOST_FUNCTION_FUNCTION
&

672 
İ”©Ü
=(
FunùÜ
 
BOOST_FUNCTION_TARGET_FIX
(cÚ¡ &è
f
)

674 
this
->
ş—r
();

675 #iâdeà
BOOST_NO_EXCEPTIONS


676 
	gŒy
 {

677 
	gthis
->
assign_to
(
f
);

678 } 
ÿtch
 (...) {

679 
	gvbË
 = 0;

680 
	gthrow
;

683 
	gthis
->
assign_to
(
f
);

685  *
	gthis
;

688 #iâdeà
BOOST_NO_SFINAE


689 
	gBOOST_FUNCTION_FUNCTION
& 
	gİ”©Ü
=(
ş—r_ty³
*)

691 
this
->
ş—r
();

692  *
	gthis
;

695 
	gBOOST_FUNCTION_FUNCTION
& 
	gİ”©Ü
=(
z”o
)

697 
BOOST_ASSERT
(
z”o
 == 0);

698 
	gthis
->
ş—r
();

699  *
	gthis
;

704 
	gBOOST_FUNCTION_FUNCTION
& 
	gİ”©Ü
=(cÚ¡ 
BOOST_FUNCTION_FUNCTION
& 
f
)

706 ià(&
f
 =ğ
this
)

707  *
this
;

709 
	gthis
->
ş—r
();

710 #iâdeà
BOOST_NO_EXCEPTIONS


711 
	gŒy
 {

712 
	gthis
->
assign_to_own
(
f
);

713 } 
ÿtch
 (...) {

714 
	gvbË
 = 0;

715 
	gthrow
;

718 
	gthis
->
assign_to_own
(
f
);

720  *
	gthis
;

723 
sw­
(
BOOST_FUNCTION_FUNCTION
& 
Ùh”
)

725 ià(&
	gÙh”
 =ğ
this
)

728 
BOOST_FUNCTION_FUNCTION
 
	gtmp
 = *
this
;

729 *
	gthis
 = 
Ùh”
;

730 
	gÙh”
 = 
tmp
;

734 
ş—r
()

736 ià(
	gvbË
) {

737 
	g»š‹½»t_ÿ¡
<cÚ¡ 
	gvbË_ty³
*>(
	gvbË
)->
ş—r
(
this
->
funùÜ
);

738 
	gvbË
 = 0;

742 #ià(
defšed
 
__SUNPRO_CC
è&& (__SUNPRO_CC <ğ0x530è&& !(defšed 
BOOST_NO_COMPILER_CONFIG
)

744 
İ”©Ü
 
boŞ
 (ècÚ¡ {  !
	gthis
->
em±y
(); }

746 
	g´iv©e
:

747 
	sdummy
 {

748 
nÚnuÎ
() {};

751 (
	gdummy
::*
	t§ã_boŞ
)();

753 
	gpublic
:

754 
İ”©Ü
 
§ã_boŞ
 () const

755 {  (
this
->
em±y
())? 0 : &
dummy
::
nÚnuÎ
; }

757 
boŞ
 
	gİ”©Ü
!() const

758 {  
	gthis
->
em±y
(); }

761 
	g´iv©e
:

762 
assign_to_own
(cÚ¡ 
BOOST_FUNCTION_FUNCTION
& 
f
)

764 ià(!
f
.
em±y
()) {

765 
this
->
vbË
 = 
f
.vtable;

766 
	gf
.
	gvbË
->
mªag”
(
f
.
funùÜ
, 
this
->functor,

767 
boo¡
::
d‘a
::
funùiÚ
::
şÚe_funùÜ_g
);

771 
	g‹m¶©e
<
ty³Çme
 
	gFunùÜ
>

772 
assign_to
(cÚ¡ 
FunùÜ
& 
f
)

774 
usšg
 
	gd‘a
::
funùiÚ
::
vbË_ba£
;

776 
ty³Çme
 
	td‘a
::
	tfunùiÚ
::
	tg‘_funùiÚ_g
<
	tFunùÜ
>::
	tty³
 
	tg
;

777 
	gd‘a
::
	tfunùiÚ
::
	tBOOST_FUNCTION_GET_INVOKER
<
	tg
> 
	tg‘_švok”
;

778 
ty³Çme
 
	tg‘_švok”
::

779 
	t‹m¶©e
 
	t­¶y
<
	tFunùÜ
, 
	tR
 
	tBOOST_FUNCTION_COMMA


780 
	tBOOST_FUNCTION_TEMPLATE_ARGS
, 
	tAÎoÿtÜ
>

781 
	thªdËr_ty³
;

783 
ty³Çme
 
	thªdËr_ty³
::
	tšvok”_ty³
 invoker_type;

784 
ty³Çme
 
	thªdËr_ty³
::
	tmªag”_ty³
 manager_type;

786 cÚ¡ 
vbË_ty³
 
	g¡Üed_vbË
 =

787 { { &
mªag”_ty³
::
mªage
 }, &
švok”_ty³
::
švoke
 };

789 ià(
	g¡Üed_vbË
.
assign_to
(
f
, 
funùÜ
)è
	gvbË
 = &
¡Üed_vbË
.
ba£
;

790 
	gvbË
 = 0;

794 
	g‹m¶©e
<
ty³Çme
 
R
 
BOOST_FUNCTION_COMMA
 
	gBOOST_FUNCTION_TEMPLATE_PARMS
 ,

795 
ty³Çme
 
	gAÎoÿtÜ
>

796 
šlše
 
sw­
(
BOOST_FUNCTION_FUNCTION
<

797 
R
 
BOOST_FUNCTION_COMMA


798 
BOOST_FUNCTION_TEMPLATE_ARGS
 ,

799 
AÎoÿtÜ


800 >& 
f1
,

801 
BOOST_FUNCTION_FUNCTION
<

802 
R
 
BOOST_FUNCTION_COMMA


803 
BOOST_FUNCTION_TEMPLATE_ARGS
,

804 
AÎoÿtÜ


805 >& 
f2
)

807 
	gf1
.
sw­
(
f2
);

810 #ià!
BOOST_WORKAROUND
(
BOOST_MSVC
, < 1300)

811 
	g‹m¶©e
<
ty³Çme
 
R
 
BOOST_FUNCTION_COMMA
 
	gBOOST_FUNCTION_TEMPLATE_PARMS
,

812 
ty³Çme
 
	gAÎoÿtÜ
>

813 
ty³Çme
 
	gBOOST_FUNCTION_FUNCTION
<

814 
R
 
BOOST_FUNCTION_COMMA
 
	gBOOST_FUNCTION_TEMPLATE_ARGS
,

815 
	gAÎoÿtÜ
>::
»suÉ_ty³


816 
BOOST_FUNCTION_FUNCTION
<
R
 
BOOST_FUNCTION_COMMA
 
BOOST_FUNCTION_TEMPLATE_ARGS
,

818 
	gAÎoÿtÜ
>

819 ::
İ”©Ü
()(
BOOST_FUNCTION_PARMS
) const

821 ià(
this
->
em±y
())

822 
boo¡
::
throw_exû±iÚ
(
bad_funùiÚ_ÿÎ
());

824  
	g»š‹½»t_ÿ¡
<cÚ¡ 
	gvbË_ty³
*>(
	gvbË
)->
	gšvok”


825 (
	gthis
->
funùÜ
 
BOOST_FUNCTION_COMMA
 
	gBOOST_FUNCTION_ARGS
);

830 
	g‹m¶©e
<
ty³Çme
 
R
 
BOOST_FUNCTION_COMMA
 
	gBOOST_FUNCTION_TEMPLATE_PARMS
 ,

831 
ty³Çme
 
	gAÎoÿtÜ
>

832 
	gİ”©Ü
==(cÚ¡ 
BOOST_FUNCTION_FUNCTION
<

833 
R
 
BOOST_FUNCTION_COMMA


834 
BOOST_FUNCTION_TEMPLATE_ARGS
 ,

835 
	gAÎoÿtÜ
>&,

836 cÚ¡ 
	gBOOST_FUNCTION_FUNCTION
<

837 
R
 
BOOST_FUNCTION_COMMA


838 
	gBOOST_FUNCTION_TEMPLATE_ARGS
 ,

839 
	gAÎoÿtÜ
>&);

840 
	g‹m¶©e
<
ty³Çme
 
R
 
BOOST_FUNCTION_COMMA
 
	gBOOST_FUNCTION_TEMPLATE_PARMS
 ,

841 
ty³Çme
 
	gAÎoÿtÜ
>

842 
	gİ”©Ü
!=(cÚ¡ 
BOOST_FUNCTION_FUNCTION
<

843 
R
 
BOOST_FUNCTION_COMMA


844 
BOOST_FUNCTION_TEMPLATE_ARGS
 ,

845 
	gAÎoÿtÜ
>&,

846 cÚ¡ 
	gBOOST_FUNCTION_FUNCTION
<

847 
R
 
BOOST_FUNCTION_COMMA


848 
	gBOOST_FUNCTION_TEMPLATE_ARGS
 ,

849 
	gAÎoÿtÜ
>&);

851 #ià!
defšed
(
BOOST_FUNCTION_NO_FUNCTION_TYPE_SYNTAX
)

853 #ià
BOOST_FUNCTION_NUM_ARGS
 == 0

854 
	#BOOST_FUNCTION_PARTIAL_SPEC
 
	`R
 ()

	)

856 
	#BOOST_FUNCTION_PARTIAL_SPEC
 
	`R
 (
	`BOOST_PP_ENUM_PARAMS
(
BOOST_FUNCTION_NUM_ARGS
,
T
))

	)

859 
	g‹m¶©e
<
ty³Çme
 
R
 
BOOST_FUNCTION_COMMA


860 
	gBOOST_FUNCTION_TEMPLATE_PARMS
,

861 
ty³Çme
 
	gAÎoÿtÜ
>

862 
şass
 
	gfunùiÚ
<
	gBOOST_FUNCTION_PARTIAL_SPEC
, 
	gAÎoÿtÜ
>

863 : 
public
 
BOOST_FUNCTION_FUNCTION
<
R
, 
BOOST_FUNCTION_TEMPLATE_ARGS


864 
BOOST_FUNCTION_COMMA
 
	gAÎoÿtÜ
>

866 
	gBOOST_FUNCTION_FUNCTION
<
	tR
, 
	tBOOST_FUNCTION_TEMPLATE_ARGS


867 
	tBOOST_FUNCTION_COMMA
 
	tAÎoÿtÜ
> 
	tba£_ty³
;

868 
funùiÚ
 
	t£lf_ty³
;

870 
	sş—r_ty³
 {};

872 
	gpublic
:

873 
ty³Çme
 
	tba£_ty³
::
	t®loÿtÜ_ty³
‡llocator_type;

875 
funùiÚ
(è: 
ba£_ty³
() {}

877 
‹m¶©e
<
ty³Çme
 
FunùÜ
>

878 
funùiÚ
(
FunùÜ
 
f


879 #iâdeà
BOOST_NO_SFINAE


880 ,
ty³Çme
 
’abË_if_c
<

881 (
boo¡
::
ty³_Œa™s
::
iû_nÙ
<

882 (
is_š‹g¿l
<
FunùÜ
>::
v®ue
)>::value),

883 >::
ty³
 = 0

886 
ba£_ty³
(
f
)

890 #iâdeà
BOOST_NO_SFINAE


891 
funùiÚ
(
ş—r_ty³
*è: 
ba£_ty³
() {}

894 
funùiÚ
(cÚ¡ 
£lf_ty³
& 
f
è: 
ba£_ty³
(
¡©ic_ÿ¡
<const base_type&>(f)){}

896 
funùiÚ
(cÚ¡ 
ba£_ty³
& 
f
è: ba£_ty³(
¡©ic_ÿ¡
<const base_type&>(f)){}

898 
£lf_ty³
& 
İ”©Ü
=(cÚ¡ s–f_ty³& 
f
)

900 
£lf_ty³
(
f
).
sw­
(*
this
);

901  *
	gthis
;

904 
	g‹m¶©e
<
ty³Çme
 
	gFunùÜ
>

905 #iâdeà
BOOST_NO_SFINAE


906 
ty³Çme
 
	g’abË_if_c
<

907 (
	gboo¡
::
ty³_Œa™s
::
iû_nÙ
<

908 (
is_š‹g¿l
<
FunùÜ
>::
v®ue
)>::value),

909 
	g£lf_ty³
&>::
ty³


911 
£lf_ty³
&

913 
İ”©Ü
=(
FunùÜ
 
f
)

915 
£lf_ty³
(
f
).
sw­
(*
this
);

916  *
	gthis
;

919 #iâdeà
BOOST_NO_SFINAE


920 
	g£lf_ty³
& 
	gİ”©Ü
=(
ş—r_ty³
*)

922 
this
->
ş—r
();

923  *
	gthis
;

927 
	g£lf_ty³
& 
	gİ”©Ü
=(cÚ¡ 
ba£_ty³
& 
f
)

929 
£lf_ty³
(
f
).
sw­
(*
this
);

930  *
	gthis
;

934 #undeà
BOOST_FUNCTION_PARTIAL_SPEC


940 #undeà
BOOST_FUNCTION_VTABLE


941 #undeà
BOOST_FUNCTION_GET_INVOKER


942 #undeà
BOOST_FUNCTION_DEFAULT_ALLOCATOR


943 #undeà
BOOST_FUNCTION_COMMA


944 #undeà
BOOST_FUNCTION_FUNCTION


945 #undeà
BOOST_FUNCTION_FUNCTION_INVOKER


946 #undeà
BOOST_FUNCTION_VOID_FUNCTION_INVOKER


947 #undeà
BOOST_FUNCTION_FUNCTION_OBJ_INVOKER


948 #undeà
BOOST_FUNCTION_VOID_FUNCTION_OBJ_INVOKER


949 #undeà
BOOST_FUNCTION_FUNCTION_REF_INVOKER


950 #undeà
BOOST_FUNCTION_VOID_FUNCTION_REF_INVOKER


951 #undeà
BOOST_FUNCTION_MEMBER_INVOKER


952 #undeà
BOOST_FUNCTION_VOID_MEMBER_INVOKER


953 #undeà
BOOST_FUNCTION_GET_FUNCTION_INVOKER


954 #undeà
BOOST_FUNCTION_GET_FUNCTION_OBJ_INVOKER


955 #undeà
BOOST_FUNCTION_GET_FUNCTION_REF_INVOKER


956 #undeà
BOOST_FUNCTION_GET_MEMBER_INVOKER


957 #undeà
BOOST_FUNCTION_TEMPLATE_PARMS


958 #undeà
BOOST_FUNCTION_TEMPLATE_ARGS


959 #undeà
BOOST_FUNCTION_PARMS


960 #undeà
BOOST_FUNCTION_PARM


961 #undeà
BOOST_FUNCTION_ARGS


962 #undeà
BOOST_FUNCTION_ARG_TYPE


963 #undeà
BOOST_FUNCTION_ARG_TYPES


964 #undeà
BOOST_FUNCTION_VOID_RETURN_TYPE


965 #undeà
BOOST_FUNCTION_RETURN


967 #ià
defšed
(
BOOST_MSVC
)

968 #´agm¨
w¬nšg
Ğ
pİ
 )

	@
1
.
0
530
48287
/home/galtekar/src/logreplay/bench/src/hypertable/cmake/CheckBoost.cc
/home/galtekar/src/logreplay/bench/src/hypertable/examples/apache_log/apache_log_load.cc
/home/galtekar/src/logreplay/bench/src/hypertable/examples/apache_log/apache_log_query.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/attic/Tools/hyperspace/CommandAttrDel.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/attic/Tools/hyperspace/CommandAttrDel.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/attic/Tools/hyperspace/CommandAttrGet.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/attic/Tools/hyperspace/CommandAttrGet.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/attic/Tools/hyperspace/CommandAttrSet.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/attic/Tools/hyperspace/CommandAttrSet.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/attic/Tools/hyperspace/CommandCreate.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/attic/Tools/hyperspace/CommandCreate.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/attic/Tools/hyperspace/CommandDelete.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/attic/Tools/hyperspace/CommandDelete.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/attic/Tools/hyperspace/CommandExists.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/attic/Tools/hyperspace/CommandExists.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/attic/Tools/hyperspace/CommandMkdirs.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/attic/Tools/hyperspace/CommandMkdirs.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/attic/Tools/hyperspace/hsTest.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/attic/Tools/hyperspace/hyperspace.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/ApplicationHandler.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/ApplicationQueue.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/Comm.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/Comm.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/CommBuf.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/ConnectionHandlerFactory.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/ConnectionManager.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/ConnectionManager.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/DispatchHandler.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/DispatchHandlerSynchronizer.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/DispatchHandlerSynchronizer.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/Event.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/Event.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/HandlerMap.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/Header.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/Header.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/HeaderBuilder.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/HeaderBuilder.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/IOHandler.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/IOHandler.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/IOHandlerAccept.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/IOHandlerAccept.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/IOHandlerData.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/IOHandlerData.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/IOHandlerDatagram.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/IOHandlerDatagram.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/PollTimeout.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/Protocol.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/Protocol.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/Reactor.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/Reactor.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/ReactorFactory.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/ReactorFactory.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/ReactorRunner.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/ReactorRunner.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/RequestCache.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/RequestCache.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/ResponseCallback.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/ResponseCallback.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/Serialization.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/Timer.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/sampleClient.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/testServer.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/tests/CommTestDatagramThreadFunction.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/tests/CommTestDatagramThreadFunction.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/tests/CommTestThreadFunction.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/tests/CommTestThreadFunction.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/tests/commTest.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/tests/commTestDatagram.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/tests/commTestReverseRequest.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/tests/commTestTimeout.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/AsyncComm/tests/commTestTimer.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/ByteOrder.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/ByteString.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/CharArena.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/CharStrHashMap.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/CharStrHashTraits.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/Checksum.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/Checksum.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/DynamicBuffer.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/Error.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/Error.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/Exception.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/FileUtils.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/FileUtils.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/HashMap.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/InetAddr.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/InetAddr.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/Init.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/Init.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/InteractiveCommand.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/InteractiveCommand.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/Logger.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/Logger.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/NumberStream.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/Properties.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/Properties.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/ReferenceCount.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/Runnable.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/ServerLauncher.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/SockAddrMap.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/StringExt.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/Sweetener.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/System.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/System.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/TestHarness.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/Thread.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/Usage.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/Usage.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/atomic.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/htConvert.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/md5.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Common/md5.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/Broker.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/Client.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/Client.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/ClientBufferedReaderHandler.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/ClientBufferedReaderHandler.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/ConnectionHandler.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/ConnectionHandler.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/ConnectionHandlerFactory.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/OpenFileMap.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/Protocol.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/Protocol.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/RequestHandlerAppend.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/RequestHandlerAppend.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/RequestHandlerClose.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/RequestHandlerClose.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/RequestHandlerCreate.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/RequestHandlerCreate.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/RequestHandlerFlush.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/RequestHandlerFlush.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/RequestHandlerLength.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/RequestHandlerLength.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/RequestHandlerMkdirs.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/RequestHandlerMkdirs.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/RequestHandlerOpen.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/RequestHandlerOpen.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/RequestHandlerPread.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/RequestHandlerPread.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/RequestHandlerRead.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/RequestHandlerRead.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/RequestHandlerReaddir.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/RequestHandlerReaddir.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/RequestHandlerRemove.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/RequestHandlerRemove.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/RequestHandlerRmdir.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/RequestHandlerRmdir.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/RequestHandlerSeek.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/RequestHandlerSeek.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/RequestHandlerStatus.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/RequestHandlerStatus.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/ResponseCallbackAppend.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/ResponseCallbackAppend.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/ResponseCallbackLength.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/ResponseCallbackLength.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/ResponseCallbackOpen.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/ResponseCallbackOpen.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/ResponseCallbackRead.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/ResponseCallbackRead.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/ResponseCallbackReaddir.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/Lib/ResponseCallbackReaddir.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/kosmos/KosmosBroker.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/kosmos/KosmosBroker.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/kosmos/main.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/local/LocalBroker.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/local/LocalBroker.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/DfsBroker/local/main.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/ClientConnectionHandler.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/ClientConnectionHandler.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/ClientHandleState.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/ClientKeepaliveHandler.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/ClientKeepaliveHandler.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/DirEntry.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/DirEntry.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/Event.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/Event.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/HandleCallback.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/HandleCallback.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/HandleData.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/LockSequencer.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/Master.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/Master.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/NodeData.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/Notification.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/Protocol.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/Protocol.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/RequestHandlerAttrDel.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/RequestHandlerAttrDel.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/RequestHandlerAttrGet.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/RequestHandlerAttrGet.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/RequestHandlerAttrSet.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/RequestHandlerAttrSet.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/RequestHandlerClose.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/RequestHandlerClose.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/RequestHandlerDelete.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/RequestHandlerDelete.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/RequestHandlerExists.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/RequestHandlerExists.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/RequestHandlerLock.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/RequestHandlerLock.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/RequestHandlerMkdir.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/RequestHandlerMkdir.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/RequestHandlerOpen.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/RequestHandlerOpen.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/RequestHandlerReaddir.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/RequestHandlerReaddir.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/RequestHandlerRelease.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/RequestHandlerRelease.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/RequestHandlerStatus.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/RequestHandlerStatus.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/ResponseCallbackAttrGet.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/ResponseCallbackAttrGet.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/ResponseCallbackExists.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/ResponseCallbackExists.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/ResponseCallbackLock.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/ResponseCallbackLock.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/ResponseCallbackOpen.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/ResponseCallbackOpen.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/ResponseCallbackReaddir.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/ResponseCallbackReaddir.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/ServerConnectionHandler.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/ServerConnectionHandler.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/ServerKeepaliveHandler.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/ServerKeepaliveHandler.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/Session.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/Session.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/SessionData.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hyperspace/main.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/ApacheLogParser.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/ApacheLogParser.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/BlockCompressionCodec.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/BlockCompressionCodecBmz.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/BlockCompressionCodecBmz.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/BlockCompressionCodecLzo.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/BlockCompressionCodecLzo.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/BlockCompressionCodecNone.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/BlockCompressionCodecNone.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/BlockCompressionCodecQuicklz.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/BlockCompressionCodecQuicklz.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/BlockCompressionCodecZlib.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/BlockCompressionCodecZlib.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/BlockCompressionHeader.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/BlockCompressionHeaderCommitLog.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/BlockCompressionHeaderCommitLog.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/Cell.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/Client.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/Client.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/CommitLog.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/CommitLog.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/CommitLogReader.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/CommitLogReader.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/CompressorFactory.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/CompressorFactory.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/DataSource.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/Defaults.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/Defaults.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/EventHandlerMasterChange.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/EventHandlerMasterChange.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/Filesystem.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/Filesystem.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/HqlCommandInterpreter.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/HqlCommandInterpreter.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/HqlHelpText.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/HqlHelpText.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/HqlParser.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/Key.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/Key.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/KeySpec.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/LoadDataSource.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/LoadDataSource.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/LocationCache.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/LocationCache.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/MasterClient.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/MasterClient.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/MasterFileHandler.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/MasterFileHandler.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/MasterProtocol.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/MasterProtocol.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/RangeLocationInfo.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/RangeLocator.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/RangeLocator.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/RangeServerClient.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/RangeServerClient.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/RangeServerProtocol.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/RangeServerProtocol.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/RootFileHandler.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/RootFileHandler.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/ScanBlock.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/ScanBlock.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/Schema.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/Schema.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/Table.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/Table.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/TableMutator.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/TableMutator.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/TableMutatorDispatchHandler.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/TableMutatorDispatchHandler.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/TableMutatorScatterBuffer.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/TableMutatorScatterBuffer.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/TableScanner.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/TableScanner.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/TestData.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/TestSource.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/TestSource.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/Types.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/Types.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/bmz/bmz-internal.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/bmz/bmz-test.c
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/bmz/bmz.c
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/bmz/bmz.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/bmz/bmzip.c
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/bmz/compat-c.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/bmz/test-helper.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/fletcher16.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/fletcher16.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/generate_test_data.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/lzo/lzoconf.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/lzo/lzodefs.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/lzo/minilzo.c
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/lzo/minilzo.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/quicklz.c
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/tests/compressor_test.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/tests/loadDataSourceTest.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/tests/locationCacheTest.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Lib/tests/schemaTest.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/ConnectionHandler.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/ConnectionHandler.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/DropTableDispatchHandler.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/DropTableDispatchHandler.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/EventHandlerServerJoined.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/EventHandlerServerJoined.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/EventHandlerServerLeft.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/EventHandlerServerLeft.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/HyperspaceSessionHandler.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/Master.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/Master.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/MasterGc.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/MasterGc.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/RangeServerState.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/RequestHandlerCreateTable.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/RequestHandlerCreateTable.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/RequestHandlerDropTable.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/RequestHandlerDropTable.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/RequestHandlerGetSchema.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/RequestHandlerGetSchema.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/RequestHandlerRegisterServer.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/RequestHandlerRegisterServer.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/RequestHandlerReportSplit.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/RequestHandlerReportSplit.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/RequestHandlerStatus.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/RequestHandlerStatus.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/ResponseCallbackGetSchema.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/ResponseCallbackGetSchema.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/ServerLockFileHandler.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/ServerLockFileHandler.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/ServersDirectoryHandler.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/ServersDirectoryHandler.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/htgc.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/Master/main.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/AccessGroup.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/AccessGroup.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/BlockCompressionHeaderCellStore.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/BlockCompressionHeaderCellStore.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/CellCache.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/CellCache.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/CellCacheScanner.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/CellCacheScanner.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/CellList.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/CellListScanner.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/CellStore.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/CellStoreScannerV0.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/CellStoreScannerV0.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/CellStoreTrailer.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/CellStoreTrailerV0.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/CellStoreTrailerV0.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/CellStoreV0.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/CellStoreV0.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/ConnectionHandler.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/ConnectionHandler.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/EventHandlerMasterConnection.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/EventHandlerMasterConnection.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/FileBlockCache.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/FileBlockCache.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/FillScanBlock.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/FillScanBlock.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/Global.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/Global.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/HandlerFactory.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/HyperspaceSessionHandler.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/HyperspaceSessionHandler.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/MaintenanceQueue.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/MaintenanceTask.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/MaintenanceTaskCompaction.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/MaintenanceTaskCompaction.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/MaintenanceTaskLogCleanup.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/MaintenanceTaskLogCleanup.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/MaintenanceTaskSplit.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/MaintenanceTaskSplit.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/MemoryTracker.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/MergeScanner.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/MergeScanner.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/Metadata.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/MetadataNormal.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/MetadataNormal.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/MetadataRoot.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/MetadataRoot.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/Range.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/Range.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/RangeInfo.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/RangeServer.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/RangeServer.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/RequestHandlerCompact.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/RequestHandlerCompact.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/RequestHandlerCreateScanner.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/RequestHandlerCreateScanner.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/RequestHandlerDestroyScanner.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/RequestHandlerDestroyScanner.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/RequestHandlerDropTable.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/RequestHandlerDropTable.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/RequestHandlerDumpStats.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/RequestHandlerDumpStats.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/RequestHandlerFetchScanblock.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/RequestHandlerFetchScanblock.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/RequestHandlerLoadRange.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/RequestHandlerLoadRange.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/RequestHandlerStatus.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/RequestHandlerStatus.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/RequestHandlerUpdate.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/RequestHandlerUpdate.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/ResponseCallbackCreateScanner.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/ResponseCallbackCreateScanner.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/ResponseCallbackFetchScanblock.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/ResponseCallbackFetchScanblock.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/ResponseCallbackUpdate.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/ResponseCallbackUpdate.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/ScanContext.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/ScanContext.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/ScannerMap.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/ScannerMap.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/ScannerTimestampController.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/ScannerTimestampController.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/TableInfo.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/TableInfo.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/TimerHandler.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/TimerHandler.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/Timestamp.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/count_stored.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/csdump.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Hypertable/RangeServer/main.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/dfsclient/CommandCopyFromLocal.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/dfsclient/CommandCopyFromLocal.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/dfsclient/CommandCopyToLocal.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/dfsclient/CommandCopyToLocal.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/dfsclient/CommandLength.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/dfsclient/CommandLength.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/dfsclient/CommandMkdirs.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/dfsclient/CommandMkdirs.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/dfsclient/CommandRemove.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/dfsclient/CommandRemove.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/dfsclient/CommandRmdir.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/dfsclient/CommandRmdir.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/dfsclient/CommandShutdown.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/dfsclient/CommandShutdown.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/dfsclient/dfsTest.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/dfsclient/dfsTestThreadFunction.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/dfsclient/dfsTestThreadFunction.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/dfsclient/dfsclient.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/dumplog/dumplog.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/CommandAttrDel.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/CommandAttrDel.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/CommandAttrGet.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/CommandAttrGet.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/CommandAttrSet.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/CommandAttrSet.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/CommandClose.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/CommandClose.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/CommandCreate.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/CommandCreate.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/CommandDelete.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/CommandDelete.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/CommandExists.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/CommandExists.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/CommandGetSequencer.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/CommandGetSequencer.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/CommandLock.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/CommandLock.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/CommandMkdir.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/CommandMkdir.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/CommandOpen.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/CommandOpen.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/CommandReaddir.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/CommandReaddir.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/CommandRelease.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/CommandRelease.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/CommandTryLock.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/CommandTryLock.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/FileHandleCallback.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/Global.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/Global.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/Util.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/Util.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/hyperspace.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hyperspace/test/hyperspaceTest.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hypertable/hypertable.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/hypertable/test/hypertable_test.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/merge_diff/merge_diff.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/rsclient/CommandCreateScanner.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/rsclient/CommandCreateScanner.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/rsclient/CommandDestroyScanner.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/rsclient/CommandDestroyScanner.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/rsclient/CommandFetchScanblock.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/rsclient/CommandFetchScanblock.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/rsclient/CommandLoadRange.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/rsclient/CommandLoadRange.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/rsclient/CommandShutdown.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/rsclient/CommandShutdown.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/rsclient/CommandUpdate.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/rsclient/CommandUpdate.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/rsclient/DisplayScanData.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/rsclient/DisplayScanData.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/rsclient/ParseRangeSpec.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/rsclient/ParseRangeSpec.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/rsclient/TableInfo.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/rsclient/TableInfo.h
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/rsclient/rsclient.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/rsclient/tests/rsTest.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/rsdump/rsdump.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/Tools/serverup/serverup.cc
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/boost-1_34-fix/boost/function/function_base.hpp
/home/galtekar/src/logreplay/bench/src/hypertable/src/cc/boost-1_34-fix/boost/function/function_template.hpp
